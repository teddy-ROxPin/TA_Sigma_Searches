
[Mimikatz Use - builtin]
description = This method detects mimikatz keywords in different Eventlogs (some of them only appear in older Mimikatz version that are however still used by different threat groups)
search = index=wineventlog* ((("dpapi::masterkey" OR "eo.oe.kiwi" OR "event::clear" OR "event::drop" OR "gentilkiwi.com" OR "kerberos::golden" OR "kerberos::ptc" OR "kerberos::ptt" OR "kerberos::tgt" OR "Kiwi Legit Printer" OR "lsadump::" OR "mimidrv.sys" OR "\\mimilib.dll" OR "misc::printnightmare" OR "misc::shadowcopies" OR "misc::skeleton" OR "privilege::backup" OR "privilege::debug" OR "privilege::driver" OR "sekurlsa::") NOT ((EventCode="15")))) | eval sigma_attack_tags="attack.s0002 attack.lateral_movement attack.credential_access car.2013-07-001 car.2019-04-004 attack.t1003.002 attack.t1003.004 attack.t1003.001 attack.t1003.006" | eval sigma_title="Mimikatz Use" | eval sigma_description="This method detects mimikatz keywords in different Eventlogs (some of them only appear in older Mimikatz version that are however still used by different threat groups)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Sysinternals Tools AppX Versions Execution - builtin]
description = Detects execution of Sysinternals tools via an AppX package. Attackers could instal the Sysinternals Suite to get access to tools such as psexec and procdump to avoid detection based on System paths
search = index=wineventlog* ((source="WinEventLog:Microsoft-Windows-AppModel-Runtime/Admin" EventCode="201" (ImageName="procdump.exe" OR ImageName="psloglist.exe" OR ImageName="psexec.exe" OR ImageName="livekd.exe" OR ImageName="ADExplorer.exe"))) | eval sigma_attack_tags="attack.defense_evasion attack.execution" | eval sigma_title="Sysinternals Tools AppX Versions Execution" | eval sigma_description="Detects execution of Sysinternals tools via an AppX package. Attackers could instal the Sysinternals Suite to get access to tools such as psexec and procdump to avoid detection based on System paths"
dispatch.earliest_time = -24h@h
alert.track = 0

[Azure AD Health Monitoring Agent Registry Keys Access - builtin]
description = This detection uses Windows security events to detect suspicious access attempts to the registry key of Azure AD Health monitoring agent.
This detection requires an access control entry (ACE) on the system access control list (SACL) of the following securable object HKLM\SOFTWARE\Microsoft\Microsoft Online\Reporting\MonitoringAgent.

search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (((EventCode="4656" OR EventCode="4663") ObjectType="Key" ObjectName="\\REGISTRY\\MACHINE\\SOFTWARE\\Microsoft\\Microsoft Online\\Reporting\\MonitoringAgent")) NOT (((ProcessName="*Microsoft.Identity.Health.Adfs.DiagnosticsAgent.exe*" OR ProcessName="*Microsoft.Identity.Health.Adfs.InsightsService.exe*" OR ProcessName="*Microsoft.Identity.Health.Adfs.MonitoringAgent.Startup.exe*" OR ProcessName="*Microsoft.Identity.Health.Adfs.PshSurrogate.exe*" OR ProcessName="*Microsoft.Identity.Health.Common.Clients.ResourceMonitor.exe*"))))) | eval sigma_attack_tags="attack.discovery attack.t1012" | eval sigma_title="Azure AD Health Monitoring Agent Registry Keys Access" | eval sigma_description="This detection uses Windows security events to detect suspicious access attempts to the registry key of Azure AD Health monitoring agent.
This detection requires an access control entry (ACE) on the system access control list (SACL) of the following securable object HKLM\SOFTWARE\Microsoft\Microsoft Online\Reporting\MonitoringAgent.
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Azure AD Health Service Agents Registry Keys Access - builtin]
description = This detection uses Windows security events to detect suspicious access attempts to the registry key values and sub-keys of Azure AD Health service agents (e.g AD FS).
Information from AD Health service agents can be used to potentially abuse some of the features provided by those services in the cloud (e.g. Federation).
This detection requires an access control entry (ACE) on the system access control list (SACL) of the following securable object: HKLM:\SOFTWARE\Microsoft\ADHealthAgent.
Make sure you set the SACL to propagate to its sub-keys.

search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (((EventCode="4656" OR EventCode="4663") ObjectType="Key" ObjectName="\\REGISTRY\\MACHINE\\SOFTWARE\\Microsoft\\ADHealthAgent")) NOT (((ProcessName="*Microsoft.Identity.Health.Adfs.DiagnosticsAgent.exe*" OR ProcessName="*Microsoft.Identity.Health.Adfs.InsightsService.exe*" OR ProcessName="*Microsoft.Identity.Health.Adfs.MonitoringAgent.Startup.exe*" OR ProcessName="*Microsoft.Identity.Health.Adfs.PshSurrogate.exe*" OR ProcessName="*Microsoft.Identity.Health.Common.Clients.ResourceMonitor.exe*"))))) | eval sigma_attack_tags="attack.discovery attack.t1012" | eval sigma_title="Azure AD Health Service Agents Registry Keys Access" | eval sigma_description="This detection uses Windows security events to detect suspicious access attempts to the registry key values and sub-keys of Azure AD Health service agents (e.g AD FS).
Information from AD Health service agents can be used to potentially abuse some of the features provided by those services in the cloud (e.g. Federation).
This detection requires an access control entry (ACE) on the system access control list (SACL) of the following securable object: HKLM:\SOFTWARE\Microsoft\ADHealthAgent.
Make sure you set the SACL to propagate to its sub-keys.
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Access Token Abuse - builtin]
description = This rule tries to detect token impersonation and theft. (Example: DuplicateToken(Ex) and ImpersonateLoggedOnUser with the LOGON32_LOGON_NEW_CREDENTIALS flag.)
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") EventCode="4624" LogonType="9" LogonProcessName="Advapi" AuthenticationPackageName="Negotiate" ImpersonationLevel="%%1833")) | eval sigma_attack_tags="attack.defense_evasion attack.privilege_escalation attack.t1134.001" | eval sigma_title="Access Token Abuse" | eval sigma_description="This rule tries to detect token impersonation and theft. (Example: DuplicateToken(Ex) and ImpersonateLoggedOnUser with the LOGON32_LOGON_NEW_CREDENTIALS flag.)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Powerview Add-DomainObjectAcl DCSync AD Extend Right - builtin]
description = Backdooring domain object to grant the rights associated with DCSync to a regular user or machine account using Powerview\Add-DomainObjectAcl DCSync Extended Right cmdlet, will allow to re-obtain the pwd hashes of any user/computer
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") ((EventCode="5136" AttributeLDAPDisplayName="ntSecurityDescriptor" (AttributeValue="*1131f6ad-9c07-11d1-f79f-00c04fc2dcd2*" OR AttributeValue="*1131f6aa-9c07-11d1-f79f-00c04fc2dcd2*" OR AttributeValue="*89e95b76-444d-4c62-991a-0facbeda640c*"))) NOT ((((ObjectClass="dnsNode" OR ObjectClass="dnsZoneScope" OR ObjectClass="dnsZone")))))) | eval sigma_attack_tags="attack.persistence attack.t1098" | eval sigma_title="Powerview Add-DomainObjectAcl DCSync AD Extend Right" | eval sigma_description="Backdooring domain object to grant the rights associated with DCSync to a regular user or machine account using Powerview\Add-DomainObjectAcl DCSync Extended Right cmdlet, will allow to re-obtain the pwd hashes of any user/computer"
dispatch.earliest_time = -24h@h
alert.track = 0

[AD Privileged Users or Groups Reconnaissance - builtin]
description = Detect priv users or groups recon based on 4661 eventid and known privileged users or groups SIDs
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") ((((EventCode="4661" (ObjectType="SAM_USER" OR ObjectType="SAM_GROUP"))) ((ObjectName="*-512" OR ObjectName="*-502" OR ObjectName="*-500" OR ObjectName="*-505" OR ObjectName="*-519" OR ObjectName="*-520" OR ObjectName="*-544" OR ObjectName="*-551" OR ObjectName="*-555") OR ObjectName="*admin*"))) NOT ((SubjectUserName="*$")))) | eval sigma_attack_tags="attack.discovery attack.t1087.002" | eval sigma_title="AD Privileged Users or Groups Reconnaissance" | eval sigma_description="Detect priv users or groups recon based on 4661 eventid and known privileged users or groups SIDs"
dispatch.earliest_time = -24h@h
alert.track = 0

[AD Object WriteDAC Access - builtin]
description = Detects WRITE_DAC access to a domain object
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") EventCode="4662" ObjectServer="DS" AccessMask="0x40000" (ObjectType="19195a5b-6da0-11d0-afd3-00c04fd930c9" OR ObjectType="domainDNS"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1222.001" | eval sigma_title="AD Object WriteDAC Access" | eval sigma_description="Detects WRITE_DAC access to a domain object"
dispatch.earliest_time = -24h@h
alert.track = 0

[Active Directory Replication from Non Machine Account - builtin]
description = Detects potential abuse of Active Directory Replication Service (ADRS) from a non machine account to request credentials.
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") ((EventCode="4662" AccessMask="0x100" (Properties="*1131f6aa-9c07-11d1-f79f-00c04fc2dcd2*" OR Properties="*1131f6ad-9c07-11d1-f79f-00c04fc2dcd2*" OR Properties="*89e95b76-444d-4c62-991a-0facbeda640c*"))) NOT ((SubjectUserName="*$") OR (SubjectUserName="MSOL_*")))) | table ComputerName,SubjectDomainName,SubjectUserName | eval sigma_attack_tags="attack.credential_access attack.t1003.006" | eval sigma_title="Active Directory Replication from Non Machine Account" | eval sigma_description="Detects potential abuse of Active Directory Replication Service (ADRS) from a non machine account to request credentials."
dispatch.earliest_time = -24h@h
alert.track = 0

[AD User Enumeration - builtin]
description = Detects access to a domain user from a non-machine account
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") ((EventCode="4662" ObjectType="*bf967aba-0de6-11d0-a285-00aa003049e2*")) NOT ((SubjectUserName="*$") OR (SubjectUserName="MSOL_*")))) | eval sigma_attack_tags="attack.discovery attack.t1087.002" | eval sigma_title="AD User Enumeration" | eval sigma_description="Detects access to a domain user from a non-machine account"
dispatch.earliest_time = -24h@h
alert.track = 0

[ADCS Certificate Template Configuration Vulnerability with Risky EKU - builtin]
description = Detects certificate creation with template allowing risk permission subject and risky EKU
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (((EventCode="4898" (TemplateContent="*1.3.6.1.5.5.7.3.2*" OR TemplateContent="*1.3.6.1.5.2.3.4*" OR TemplateContent="*1.3.6.1.4.1.311.20.2.2*" OR TemplateContent="*2.5.29.37.0*") TemplateContent="*CT_FLAG_ENROLLEE_SUPPLIES_SUBJECT*")) OR ((EventCode="4899" (NewTemplateContent="*1.3.6.1.5.5.7.3.2*" OR NewTemplateContent="*1.3.6.1.5.2.3.4*" OR NewTemplateContent="*1.3.6.1.4.1.311.20.2.2*" OR NewTemplateContent="*2.5.29.37.0*") NewTemplateContent="*CT_FLAG_ENROLLEE_SUPPLIES_SUBJECT*"))))) | eval sigma_attack_tags="attack.privilege_escalation attack.credential_access" | eval sigma_title="ADCS Certificate Template Configuration Vulnerability with Risky EKU" | eval sigma_description="Detects certificate creation with template allowing risk permission subject and risky EKU"
dispatch.earliest_time = -24h@h
alert.track = 0

[ADCS Certificate Template Configuration Vulnerability - builtin]
description = Detects certificate creation with template allowing risk permission subject
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (((EventCode="4898" TemplateContent="*CT_FLAG_ENROLLEE_SUPPLIES_SUBJECT*")) OR ((EventCode="4899" NewTemplateContent="*CT_FLAG_ENROLLEE_SUPPLIES_SUBJECT*"))))) | eval sigma_attack_tags="attack.privilege_escalation attack.credential_access" | eval sigma_title="ADCS Certificate Template Configuration Vulnerability" | eval sigma_description="Detects certificate creation with template allowing risk permission subject"
dispatch.earliest_time = -24h@h
alert.track = 0

[Add or Remove Computer from DC - builtin]
description = Detects the creation or removal of a computer. Can be used to detect attacks such as DCShadow via the creation of a new SPN.
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (EventCode="4741" OR EventCode="4743"))) | eval sigma_attack_tags="" | eval sigma_title="Add or Remove Computer from DC" | eval sigma_description="Detects the creation or removal of a computer. Can be used to detect attacks such as DCShadow via the creation of a new SPN."
dispatch.earliest_time = -24h@h
alert.track = 0

[User with Privileges Logon - builtin]
description = Detects logon with 'Special groups' and 'Special Privileges' can be thought of as Administrator groups or privileges.
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (EventCode="4672" OR EventCode="4964") NOT ((SubjectUserSid="S-1-5-18")))) | eval sigma_attack_tags="" | eval sigma_title="User with Privileges Logon" | eval sigma_description="Detects logon with 'Special groups' and 'Special Privileges' can be thought of as Administrator groups or privileges."
dispatch.earliest_time = -24h@h
alert.track = 0

[Admin User Remote Logon - builtin]
description = Detect remote login by Administrator user (depending on internal pattern).
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") EventCode="4624" LogonType="10" AuthenticationPackageName="Negotiate" TargetUserName="Admin*")) | eval sigma_attack_tags="attack.lateral_movement attack.t1078.001 attack.t1078.002 attack.t1078.003 car.2016-04-005" | eval sigma_title="Admin User Remote Logon" | eval sigma_description="Detect remote login by Administrator user (depending on internal pattern)."
dispatch.earliest_time = -24h@h
alert.track = 0

[Access to ADMIN$ Share - builtin]
description = Detects access to $ADMIN share
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") ((EventCode="5140" ShareName="Admin$")) NOT ((SubjectUserName="*$")))) | eval sigma_attack_tags="attack.lateral_movement attack.t1021.002" | eval sigma_title="Access to ADMIN$ Share" | eval sigma_description="Detects access to $ADMIN share"
dispatch.earliest_time = -24h@h
alert.track = 0

[Enabled User Right in AD to Control User Objects - builtin]
description = Detects scenario where if a user is assigned the SeEnableDelegationPrivilege right in Active Directory it would allow control of other AD user objects.
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") EventCode="4704" PrivilegeList="*SeEnableDelegationPrivilege*")) | eval sigma_attack_tags="attack.persistence attack.t1098" | eval sigma_title="Enabled User Right in AD to Control User Objects" | eval sigma_description="Detects scenario where if a user is assigned the SeEnableDelegationPrivilege right in Active Directory it would allow control of other AD user objects."
dispatch.earliest_time = -24h@h
alert.track = 0

[Active Directory User Backdoors - builtin]
description = Detects scenarios where one can control another users or computers account without having to use their credentials.
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (((EventCode="4738" NOT ((AllowedToDelegateTo="-") OR (NOT AllowedToDelegateTo="*")))) OR (((EventCode="5136" AttributeLDAPDisplayName="msDS-AllowedToDelegateTo")) OR ((EventCode="5136" ObjectClass="user" AttributeLDAPDisplayName="servicePrincipalName")) OR ((EventCode="5136" AttributeLDAPDisplayName="msDS-AllowedToActOnBehalfOfOtherIdentity")))))) | eval sigma_attack_tags="attack.t1098 attack.persistence" | eval sigma_title="Active Directory User Backdoors" | eval sigma_description="Detects scenarios where one can control another users or computers account without having to use their credentials."
dispatch.earliest_time = -24h@h
alert.track = 0

[Weak Encryption Enabled and Kerberoast - builtin]
description = Detects scenario where weak encryption is enabled for a user profile which could be used for hash/password cracking.
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") EventCode="4738" (((((NewUacValue="*8???" OR NewUacValue="*9???" OR NewUacValue="*A???" OR NewUacValue="*B???" OR NewUacValue="*C???" OR NewUacValue="*D???" OR NewUacValue="*E???" OR NewUacValue="*F???") NOT (((OldUacValue="*8???" OR OldUacValue="*9???" OR OldUacValue="*A???" OR OldUacValue="*B???" OR OldUacValue="*C???" OR OldUacValue="*D???" OR OldUacValue="*E???" OR OldUacValue="*F???"))))) OR (((NewUacValue="*1????" OR NewUacValue="*3????" OR NewUacValue="*5????" OR NewUacValue="*7????" OR NewUacValue="*9????" OR NewUacValue="*B????" OR NewUacValue="*D????" OR NewUacValue="*F????") NOT (((OldUacValue="*1????" OR OldUacValue="*3????" OR OldUacValue="*5????" OR OldUacValue="*7????" OR OldUacValue="*9????" OR OldUacValue="*B????" OR OldUacValue="*D????" OR OldUacValue="*F????")))))) OR (((NewUacValue="*8??" OR NewUacValue="*9??" OR NewUacValue="*A??" OR NewUacValue="*B??" OR NewUacValue="*C??" OR NewUacValue="*D??" OR NewUacValue="*E??" OR NewUacValue="*F??") NOT (((OldUacValue="*8??" OR OldUacValue="*9??" OR OldUacValue="*A??" OR OldUacValue="*B??" OR OldUacValue="*C??" OR OldUacValue="*D??" OR OldUacValue="*E??" OR OldUacValue="*F??")))))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.001" | eval sigma_title="Weak Encryption Enabled and Kerberoast" | eval sigma_description="Detects scenario where weak encryption is enabled for a user profile which could be used for hash/password cracking."
dispatch.earliest_time = -24h@h
alert.track = 0

[Hacktool Ruler - builtin]
description = This events that are generated when using the hacktool Ruler by Sensepost
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (((EventCode="4776" Workstation="RULER")) OR (((EventCode="4624" OR EventCode="4625") WorkstationName="RULER"))))) | eval sigma_attack_tags="attack.discovery attack.execution attack.t1087 attack.t1114 attack.t1059 attack.t1550.002" | eval sigma_title="Hacktool Ruler" | eval sigma_description="This events that are generated when using the hacktool Ruler by Sensepost"
dispatch.earliest_time = -24h@h
alert.track = 0

[Chafer Activity - Security - builtin]
description = Detects Chafer activity attributed to OilRig as reported in Nyotron report in March 2018
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") EventCode="4698" (TaskName="SC Scheduled Scan" OR TaskName="UpdatMachine"))) | eval sigma_attack_tags="attack.persistence attack.g0049 attack.t1053.005 attack.s0111 attack.t1543.003 attack.defense_evasion attack.t1112 attack.command_and_control attack.t1071.004" | eval sigma_title="Chafer Activity - Security" | eval sigma_description="Detects Chafer activity attributed to OilRig as reported in Nyotron report in March 2018"
dispatch.earliest_time = -24h@h
alert.track = 0

[Defrag Deactivation - Security - builtin]
description = Detects the deactivation and disabling of the Scheduled defragmentation task as seen by Slingshot APT group
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") EventCode="4701" TaskName="\\Microsoft\\Windows\\Defrag\\ScheduledDefrag")) | eval sigma_attack_tags="attack.persistence attack.t1053 attack.s0111" | eval sigma_title="Defrag Deactivation - Security" | eval sigma_description="Detects the deactivation and disabling of the Scheduled defragmentation task as seen by Slingshot APT group"
dispatch.earliest_time = -24h@h
alert.track = 0

[Operation Wocao Activity - Security - builtin]
description = Detects activity mentioned in Operation Wocao report
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") EventCode="4799" TargetUserName="Administr*" CallerProcessName="*\\checkadmin.exe")) | eval sigma_attack_tags="attack.discovery attack.t1012 attack.defense_evasion attack.t1036.004 attack.t1027 attack.execution attack.t1053.005 attack.t1059.001" | eval sigma_title="Operation Wocao Activity - Security" | eval sigma_description="Detects activity mentioned in Operation Wocao report"
dispatch.earliest_time = -24h@h
alert.track = 0

[Remote Task Creation via ATSVC Named Pipe - builtin]
description = Detects remote task creation via at.exe or API interacting with ATSVC namedpipe
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") EventCode="5145" ShareName="\\\\\*\\IPC$" RelativeTargetName="atsvc" Accesses="*WriteData*")) | eval sigma_attack_tags="attack.lateral_movement attack.persistence car.2013-05-004 car.2015-04-001 attack.t1053.002" | eval sigma_title="Remote Task Creation via ATSVC Named Pipe" | eval sigma_description="Detects remote task creation via at.exe or API interacting with ATSVC namedpipe"
dispatch.earliest_time = -24h@h
alert.track = 0

[Processes Accessing the Microphone and Webcam - builtin]
description = Potential adversaries accessing the microphone and webcam in an endpoint.
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (EventCode="4657" OR EventCode="4656" OR EventCode="4663") (ObjectName="*\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\CapabilityAccessManager\\ConsentStore\\microphone\\NonPackaged*" OR ObjectName="*\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\CapabilityAccessManager\\ConsentStore\\webcam\\NonPackaged*"))) | eval sigma_attack_tags="attack.collection attack.t1123" | eval sigma_title="Processes Accessing the Microphone and Webcam" | eval sigma_description="Potential adversaries accessing the microphone and webcam in an endpoint."
dispatch.earliest_time = -24h@h
alert.track = 0

[DCERPC SMB Spoolss Named Pipe - builtin]
description = Detects the use of the spoolss named pipe over SMB. This can be used to trigger the authentication via NTLM of any machine that has the spoolservice enabled.
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") EventCode="5145" ShareName="\\\\\*\\IPC$" RelativeTargetName="spoolss")) | eval sigma_attack_tags="attack.lateral_movement attack.t1021.002" | eval sigma_title="DCERPC SMB Spoolss Named Pipe" | eval sigma_description="Detects the use of the spoolss named pipe over SMB. This can be used to trigger the authentication via NTLM of any machine that has the spoolservice enabled."
dispatch.earliest_time = -24h@h
alert.track = 0

[DCOM InternetExplorer.Application Iertutil DLL Hijack - Security - builtin]
description = Detects a threat actor creating a file named `iertutil.dll` in the `C:\Program Files\Internet Explorer\` directory over the network for a DCOM InternetExplorer DLL Hijack scenario.
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") ((EventCode="5145" RelativeTargetName="*\\Internet Explorer\\iertutil.dll")) NOT ((SubjectUserName="*$")))) | eval sigma_attack_tags="attack.lateral_movement attack.t1021.002 attack.t1021.003" | eval sigma_title="DCOM InternetExplorer.Application Iertutil DLL Hijack - Security" | eval sigma_description="Detects a threat actor creating a file named `iertutil.dll` in the `C:\Program Files\Internet Explorer\` directory over the network for a DCOM InternetExplorer DLL Hijack scenario."
dispatch.earliest_time = -24h@h
alert.track = 0

[Mimikatz DC Sync - builtin]
description = Detects Mimikatz DC sync security events
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") ((EventCode="4662" (Properties="*Replicating Directory Changes All*" OR Properties="*1131f6ad-9c07-11d1-f79f-00c04fc2dcd2*" OR Properties="*1131f6aa-9c07-11d1-f79f-00c04fc2dcd2*" OR Properties="*9923a32a-3607-11d2-b9be-0000f87a36b2*" OR Properties="*89e95b76-444d-4c62-991a-0facbeda640c*") AccessMask="0x100")) NOT (((SubjectDomainName="Window Manager")) OR (((SubjectUserName="NT AUT*" OR SubjectUserName="MSOL_*"))) OR ((SubjectUserName="*$"))))) | eval sigma_attack_tags="attack.credential_access attack.s0002 attack.t1003.006" | eval sigma_title="Mimikatz DC Sync" | eval sigma_description="Detects Mimikatz DC sync security events"
dispatch.earliest_time = -24h@h
alert.track = 0

[Windows Defender Exclusion Set - builtin]
description = Detects scenarios where an windows defender exclusion was added in registry where an entity would want to bypass antivirus scanning from windows defender
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (EventCode="4657" OR EventCode="4656" OR EventCode="4660" OR EventCode="4663") ObjectName="*\\Microsoft\\Windows Defender\\Exclusions\\*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.001" | eval sigma_title="Windows Defender Exclusion Set" | eval sigma_description="Detects scenarios where an windows defender exclusion was added in registry where an entity would want to bypass antivirus scanning from windows defender"
dispatch.earliest_time = -24h@h
alert.track = 0

[Device Installation Blocked - builtin]
description = Detects an installation of a device that is forbidden by the system policy
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") EventCode="6423")) | eval sigma_attack_tags="" | eval sigma_title="Device Installation Blocked" | eval sigma_description="Detects an installation of a device that is forbidden by the system policy"
dispatch.earliest_time = -24h@h
alert.track = 0

[DiagTrackEoP Default Login Username - builtin]
description = Detects the default 'UserName' used by the DiagTrackEoP POC
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") EventCode="4624" LogonType="9" TargetOutboundUserName="thisisnotvaliduser")) | eval sigma_attack_tags="attack.privilege_escalation" | eval sigma_title="DiagTrackEoP Default Login Username" | eval sigma_description="Detects the default 'UserName' used by the DiagTrackEoP POC"
dispatch.earliest_time = -24h@h
alert.track = 0

[Disabling Windows Event Auditing - builtin]
description = Detects scenarios where system auditing (ie: windows event log auditing) is disabled.
This may be used in a scenario where an entity would want to bypass local logging to evade detection when windows event logging is enabled and reviewed.
Also, it is recommended to turn off 'Local Group Policy Object Processing' via GPO, which will make sure that Active Directory GPOs take precedence over local/edited computer policies via something such as 'gpedit.msc'.
Please note, that disabling 'Local Group Policy Object Processing' may cause an issue in scenarios of one off specific GPO modifications -- however it is recommended to perform these modifications in Active Directory anyways.

search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") EventCode="4719" (AuditPolicyChanges="*%%8448*" OR AuditPolicyChanges="*%%8450*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.002" | eval sigma_title="Disabling Windows Event Auditing" | eval sigma_description="Detects scenarios where system auditing (ie: windows event log auditing) is disabled.
This may be used in a scenario where an entity would want to bypass local logging to evade detection when windows event logging is enabled and reviewed.
Also, it is recommended to turn off 'Local Group Policy Object Processing' via GPO, which will make sure that Active Directory GPOs take precedence over local/edited computer policies via something such as 'gpedit.msc'.
Please note, that disabling 'Local Group Policy Object Processing' may cause an issue in scenarios of one off specific GPO modifications -- however it is recommended to perform these modifications in Active Directory anyways.
"
dispatch.earliest_time = -24h@h
alert.track = 0

[ETW Logging Disabled In .NET Processes - Registry - builtin]
description = Potential adversaries stopping ETW providers recording loaded .NET assemblies.
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (((EventCode="4657" ObjectName="*\\SOFTWARE\\Microsoft\\.NETFramework" ObjectValueName="ETWEnabled" NewValue="0")) OR ((EventCode="4657" ObjectName="*\\Environment*" (ObjectValueName="COMPlus_ETWEnabled" OR ObjectValueName="COMPlus_ETWFlags") NewValue="0"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1112 attack.t1562" | eval sigma_title="ETW Logging Disabled In .NET Processes - Registry" | eval sigma_description="Potential adversaries stopping ETW providers recording loaded .NET assemblies."
dispatch.earliest_time = -24h@h
alert.track = 0

[DPAPI Domain Backup Key Extraction - builtin]
description = Detects tools extracting LSA secret DPAPI domain backup key from Domain Controllers
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") EventCode="4662" ObjectType="SecretObject" AccessMask="0x2" ObjectName="*BCKUPKEY*")) | eval sigma_attack_tags="attack.credential_access attack.t1003.004" | eval sigma_title="DPAPI Domain Backup Key Extraction" | eval sigma_description="Detects tools extracting LSA secret DPAPI domain backup key from Domain Controllers"
dispatch.earliest_time = -24h@h
alert.track = 0

[DPAPI Domain Master Key Backup Attempt - builtin]
description = Detects anyone attempting a backup for the DPAPI Master Key. This events gets generated at the source and not the Domain Controller.
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") EventCode="4692")) | table ComputerName,SubjectDomainName,SubjectUserName | eval sigma_attack_tags="attack.credential_access attack.t1003.004" | eval sigma_title="DPAPI Domain Master Key Backup Attempt" | eval sigma_description="Detects anyone attempting a backup for the DPAPI Master Key. This events gets generated at the source and not the Domain Controller."
dispatch.earliest_time = -24h@h
alert.track = 0

[Security Event Log Cleared - builtin]
description = Checks for event id 1102 which indicates the security event log was cleared.
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") EventCode="1102" Provider_Name="Microsoft-Windows-Eventlog")) | table SubjectLogonId,SubjectUserName,SubjectUserSid,SubjectDomainName | eval sigma_attack_tags="attack.t1070.001" | eval sigma_title="Security Event Log Cleared" | eval sigma_description="Checks for event id 1102 which indicates the security event log was cleared."
dispatch.earliest_time = -24h@h
alert.track = 0

[CVE-2021-1675 Print Spooler Exploitation IPC Access - builtin]
description = Detects remote printer driver load from Detailed File Share in Security logs that are a sign of successful exploitation attempts against print spooler vulnerability CVE-2021-1675 and CVE-2021-34527
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") EventCode="5145" ShareName="\\\\\*\\IPC$" RelativeTargetName="spoolss" AccessMask="0x3" ObjectType="File")) | eval sigma_attack_tags="attack.execution attack.t1569 cve.2021.1675 cve.2021.34527" | eval sigma_title="CVE-2021-1675 Print Spooler Exploitation IPC Access" | eval sigma_description="Detects remote printer driver load from Detailed File Share in Security logs that are a sign of successful exploitation attempts against print spooler vulnerability CVE-2021-1675 and CVE-2021-34527"
dispatch.earliest_time = -24h@h
alert.track = 0

[External Disk Drive Or USB Storage Device - builtin]
description = Detects external diskdrives or plugged in USB devices , EventID 6416 on windows 10 or later
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (((EventCode="6416" ClassName="DiskDrive")) OR DeviceDescription="USB Mass Storage Device"))) | eval sigma_attack_tags="attack.t1091 attack.t1200 attack.lateral_movement attack.initial_access" | eval sigma_title="External Disk Drive Or USB Storage Device" | eval sigma_description="Detects external diskdrives or plugged in USB devices , EventID 6416 on windows 10 or later"
dispatch.earliest_time = -24h@h
alert.track = 0

[Enumeration via the Global Catalog - builtin]
description = Detects enumeration of the global catalog (that can be performed using BloodHound or others AD reconnaissance tools). Adjust Threshold according to domain width.
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") EventCode="5156" (DestPort="3268" OR DestPort="3269"))) | eventstats count as val by SourceAddress| search val > 2000 | eval sigma_attack_tags="attack.discovery attack.t1087.002" | eval sigma_title="Enumeration via the Global Catalog" | eval sigma_description="Detects enumeration of the global catalog (that can be performed using BloodHound or others AD reconnaissance tools). Adjust Threshold according to domain width."
dispatch.earliest_time = -24h@h
alert.track = 0

[Persistence and Execution at Scale via GPO Scheduled Task - builtin]
description = Detect lateral movement using GPO scheduled task, usually used to deploy ransomware at scale
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") EventCode="5145" ShareName="\\\\\*\\SYSVOL" RelativeTargetName="*ScheduledTasks.xml" (Accesses="*WriteData*" OR Accesses="*%%4417*"))) | eval sigma_attack_tags="attack.persistence attack.lateral_movement attack.t1053.005" | eval sigma_title="Persistence and Execution at Scale via GPO Scheduled Task" | eval sigma_description="Detect lateral movement using GPO scheduled task, usually used to deploy ransomware at scale"
dispatch.earliest_time = -24h@h
alert.track = 0

[Group Modification Logging - builtin]
description = Configure systems to issue a log entry and alert when an account is added to or removed from any group assigned administrative privileges.
Sigma detects
Event ID 4728 indicates a ‘Member is added to a Security Group’.
Event ID 4729 indicates a ‘Member is removed from a Security enabled-group’ .
Event ID 4730 indicates a ‘Security Group is deleted’.
The case is not applicable for Unix OS.
Supported OS - Windows 2008 R2 and 7, Windows 2012 R2 and 8.1, Windows 2016 and 10 Windows Server 2019, Windows Server 2000, Windows 2003 and XP.

search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (EventCode="4728" OR EventCode="4729" OR EventCode="4730" OR EventCode="633" OR EventCode="632" OR EventCode="634"))) | eval sigma_attack_tags="" | eval sigma_title="Group Modification Logging" | eval sigma_description="Configure systems to issue a log entry and alert when an account is added to or removed from any group assigned administrative privileges.
Sigma detects
Event ID 4728 indicates a ‘Member is added to a Security Group’.
Event ID 4729 indicates a ‘Member is removed from a Security enabled-group’ .
Event ID 4730 indicates a ‘Security Group is deleted’.
The case is not applicable for Unix OS.
Supported OS - Windows 2008 R2 and 7, Windows 2012 R2 and 8.1, Windows 2016 and 10 Windows Server 2019, Windows Server 2000, Windows 2003 and XP.
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Hidden Local User Creation - builtin]
description = Detects the creation of a local hidden user account which should not happen for event ID 4720.
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") EventCode="4720" TargetUserName="*$")) | table EventCode,AccountName | eval sigma_attack_tags="attack.persistence attack.t1136.001" | eval sigma_title="Hidden Local User Creation" | eval sigma_description="Detects the creation of a local hidden user account which should not happen for event ID 4720."
dispatch.earliest_time = -24h@h
alert.track = 0

[HybridConnectionManager Service Installation - builtin]
description = Rule to detect the Hybrid Connection Manager service installation.
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") EventCode="4697" ServiceName="HybridConnectionManager" ServiceFileName="*HybridConnectionManager*")) | eval sigma_attack_tags="attack.persistence attack.t1554" | eval sigma_title="HybridConnectionManager Service Installation" | eval sigma_description="Rule to detect the Hybrid Connection Manager service installation."
dispatch.earliest_time = -24h@h
alert.track = 0

[Impacket PsExec Execution - builtin]
description = Detects execution of Impacket's psexec.py.
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") EventCode="5145" ShareName="\\\\\*\\IPC$" (RelativeTargetName="*RemCom_stdin*" OR RelativeTargetName="*RemCom_stdout*" OR RelativeTargetName="*RemCom_stderr*"))) | eval sigma_attack_tags="attack.lateral_movement attack.t1021.002" | eval sigma_title="Impacket PsExec Execution" | eval sigma_description="Detects execution of Impacket's psexec.py."
dispatch.earliest_time = -24h@h
alert.track = 0

[Possible Impacket SecretDump Remote Activity - builtin]
description = Detect AD credential dumping using impacket secretdump HKTL
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") EventCode="5145" ShareName="\\\\\*\\ADMIN$" RelativeTargetName="*SYSTEM32\\*" RelativeTargetName="*.tmp*")) | eval sigma_attack_tags="attack.credential_access attack.t1003.002 attack.t1003.004 attack.t1003.003" | eval sigma_title="Possible Impacket SecretDump Remote Activity" | eval sigma_description="Detect AD credential dumping using impacket secretdump HKTL"
dispatch.earliest_time = -24h@h
alert.track = 0

[Invoke-Obfuscation CLIP+ Launcher - Security - builtin]
description = Detects Obfuscated use of Clip.exe to execute PowerShell
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Provider_Name="Microsoft-Windows-Security-Auditing" EventCode="4697" ServiceFileName="*cmd*" ServiceFileName="*&&*" ServiceFileName="*clipboard]::*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1027 attack.execution attack.t1059.001" | eval sigma_title="Invoke-Obfuscation CLIP+ Launcher - Security" | eval sigma_description="Detects Obfuscated use of Clip.exe to execute PowerShell"
dispatch.earliest_time = -24h@h
alert.track = 0

[Invoke-Obfuscation STDIN+ Launcher - Security - builtin]
description = Detects Obfuscated use of stdin to execute PowerShell
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") EventCode="4697" ServiceFileName="*cmd*" ServiceFileName="*powershell*" (ServiceFileName="*${input}*" OR ServiceFileName="*noexit*") (ServiceFileName="* /c *" OR ServiceFileName="* /r *"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1027 attack.execution attack.t1059.001" | eval sigma_title="Invoke-Obfuscation STDIN+ Launcher - Security" | eval sigma_description="Detects Obfuscated use of stdin to execute PowerShell"
dispatch.earliest_time = -24h@h
alert.track = 0

[Invoke-Obfuscation VAR+ Launcher - Security - builtin]
description = Detects Obfuscated use of Environment Variables to execute PowerShell
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") EventCode="4697" ServiceFileName="*cmd*" ServiceFileName="*\"set*" ServiceFileName="*-f*" (ServiceFileName="*/c*" OR ServiceFileName="*/r*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1027 attack.execution attack.t1059.001" | eval sigma_title="Invoke-Obfuscation VAR+ Launcher - Security" | eval sigma_description="Detects Obfuscated use of Environment Variables to execute PowerShell"
dispatch.earliest_time = -24h@h
alert.track = 0

[Invoke-Obfuscation COMPRESS OBFUSCATION - Security - builtin]
description = Detects Obfuscated Powershell via COMPRESS OBFUSCATION
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") EventCode="4697" ServiceFileName="*new-object*" ServiceFileName="*text.encoding]::ascii*" ServiceFileName="*readtoend*" (ServiceFileName="*system.io.compression.deflatestream*" OR ServiceFileName="*system.io.streamreader*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1027 attack.execution attack.t1059.001" | eval sigma_title="Invoke-Obfuscation COMPRESS OBFUSCATION - Security" | eval sigma_description="Detects Obfuscated Powershell via COMPRESS OBFUSCATION"
dispatch.earliest_time = -24h@h
alert.track = 0

[Invoke-Obfuscation RUNDLL LAUNCHER - Security - builtin]
description = Detects Obfuscated Powershell via RUNDLL LAUNCHER
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") EventCode="4697" ServiceFileName="*rundll32.exe*" ServiceFileName="*shell32.dll*" ServiceFileName="*shellexec_rundll*" ServiceFileName="*powershell*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1027 attack.execution attack.t1059.001" | eval sigma_title="Invoke-Obfuscation RUNDLL LAUNCHER - Security" | eval sigma_description="Detects Obfuscated Powershell via RUNDLL LAUNCHER"
dispatch.earliest_time = -24h@h
alert.track = 0

[Invoke-Obfuscation Via Stdin - Security - builtin]
description = Detects Obfuscated Powershell via Stdin in Scripts
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") EventCode="4697" ServiceFileName="*set*" ServiceFileName="*&&*" (ServiceFileName="*environment*" OR ServiceFileName="*invoke*" OR ServiceFileName="*${input)*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1027 attack.execution attack.t1059.001" | eval sigma_title="Invoke-Obfuscation Via Stdin - Security" | eval sigma_description="Detects Obfuscated Powershell via Stdin in Scripts"
dispatch.earliest_time = -24h@h
alert.track = 0

[Invoke-Obfuscation Via Use Clip - Security - builtin]
description = Detects Obfuscated Powershell via use Clip.exe in Scripts
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") EventCode="4697" ServiceFileName="*(Clipboard|i*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1027 attack.execution attack.t1059.001" | eval sigma_title="Invoke-Obfuscation Via Use Clip - Security" | eval sigma_description="Detects Obfuscated Powershell via use Clip.exe in Scripts"
dispatch.earliest_time = -24h@h
alert.track = 0

[Invoke-Obfuscation Via Use MSHTA - Security - builtin]
description = Detects Obfuscated Powershell via use MSHTA in Scripts
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") EventCode="4697" ServiceFileName="*mshta*" ServiceFileName="*vbscript:createobject*" ServiceFileName="*.run*" ServiceFileName="*window.close*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1027 attack.execution attack.t1059.001" | eval sigma_title="Invoke-Obfuscation Via Use MSHTA - Security" | eval sigma_description="Detects Obfuscated Powershell via use MSHTA in Scripts"
dispatch.earliest_time = -24h@h
alert.track = 0

[Invoke-Obfuscation Via Use Rundll32 - Security - builtin]
description = Detects Obfuscated Powershell via use Rundll32 in Scripts
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") EventCode="4697" ServiceFileName="*&&*" ServiceFileName="*rundll32*" ServiceFileName="*shell32.dll*" ServiceFileName="*shellexec_rundll*" (ServiceFileName="*value*" OR ServiceFileName="*invoke*" OR ServiceFileName="*comspec*" OR ServiceFileName="*iex*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1027 attack.execution attack.t1059.001" | eval sigma_title="Invoke-Obfuscation Via Use Rundll32 - Security" | eval sigma_description="Detects Obfuscated Powershell via use Rundll32 in Scripts"
dispatch.earliest_time = -24h@h
alert.track = 0

[Invoke-Obfuscation VAR++ LAUNCHER OBFUSCATION - Security - builtin]
description = Detects Obfuscated Powershell via VAR++ LAUNCHER
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") EventCode="4697" ServiceFileName="*&&set*" ServiceFileName="*cmd*" ServiceFileName="*/c*" ServiceFileName="*-f*" (ServiceFileName="*{0}*" OR ServiceFileName="*{1}*" OR ServiceFileName="*{2}*" OR ServiceFileName="*{3}*" OR ServiceFileName="*{4}*" OR ServiceFileName="*{5}*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1027 attack.execution attack.t1059.001" | eval sigma_title="Invoke-Obfuscation VAR++ LAUNCHER OBFUSCATION - Security" | eval sigma_description="Detects Obfuscated Powershell via VAR++ LAUNCHER"
dispatch.earliest_time = -24h@h
alert.track = 0

[ISO Image Mount - builtin]
description = Detects the mount of ISO images on an endpoint
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") ((EventCode="4663" ObjectServer="Security" ObjectType="File" ObjectName="\\Device\\CdRom*")) NOT ((ObjectName="\\Device\\CdRom0\\setup.exe")))) | eval sigma_attack_tags="attack.initial_access attack.t1566.001" | eval sigma_title="ISO Image Mount" | eval sigma_description="Detects the mount of ISO images on an endpoint"
dispatch.earliest_time = -24h@h
alert.track = 0

[First Time Seen Remote Named Pipe - builtin]
description = This detection excludes known namped pipes accessible remotely and notify on newly observed ones, may help to detect lateral movement and remote exec using named pipes
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") ((EventCode="5145" ShareName="\\\\\*\\IPC$")) NOT (((RelativeTargetName="atsvc" OR RelativeTargetName="samr" OR RelativeTargetName="lsarpc" OR RelativeTargetName="lsass" OR RelativeTargetName="winreg" OR RelativeTargetName="netlogon" OR RelativeTargetName="srvsvc" OR RelativeTargetName="protected_storage" OR RelativeTargetName="wkssvc" OR RelativeTargetName="browser" OR RelativeTargetName="netdfs" OR RelativeTargetName="svcctl" OR RelativeTargetName="spoolss" OR RelativeTargetName="ntsvcs" OR RelativeTargetName="LSM_API_service" OR RelativeTargetName="HydraLsPipe" OR RelativeTargetName="TermSrv_API_service" OR RelativeTargetName="MsFteWds" OR RelativeTargetName="sql\\query"))))) | eval sigma_attack_tags="attack.lateral_movement attack.t1021.002" | eval sigma_title="First Time Seen Remote Named Pipe" | eval sigma_description="This detection excludes known namped pipes accessible remotely and notify on newly observed ones, may help to detect lateral movement and remote exec using named pipes"
dispatch.earliest_time = -24h@h
alert.track = 0

[Correct Execution of Nltest.exe - builtin]
description = The attacker might use LOLBAS nltest.exe for discovery of domain controllers, domain trusts, parent domain and the current user permissions.
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") EventCode="4689" ProcessName="*nltest.exe" Status="0x0")) | table SubjectUserName,SubjectDomainName | eval sigma_attack_tags="attack.discovery attack.t1482 attack.t1018 attack.t1016" | eval sigma_title="Correct Execution of Nltest.exe" | eval sigma_description="The attacker might use LOLBAS nltest.exe for discovery of domain controllers, domain trusts, parent domain and the current user permissions."
dispatch.earliest_time = -24h@h
alert.track = 0

[LSASS Access from Non System Account - builtin]
description = Detects potential mimikatz-like tools accessing LSASS from non system account
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (((EventCode="4663" OR EventCode="4656") (AccessMask="0x40" OR AccessMask="0x1400" OR AccessMask="0x100000" OR AccessMask="0x1410" OR AccessMask="0x1010" OR AccessMask="0x1438" OR AccessMask="0x143a" OR AccessMask="0x1418" OR AccessMask="0x1f0fff" OR AccessMask="0x1f1fff" OR AccessMask="0x1f2fff" OR AccessMask="0x1f3fff" OR AccessMask="40" OR AccessMask="1400" OR AccessMask="1000" OR AccessMask="100000" OR AccessMask="1410" OR AccessMask="1010" OR AccessMask="1438" OR AccessMask="143a" OR AccessMask="1418" OR AccessMask="1f0fff" OR AccessMask="1f1fff" OR AccessMask="1f2fff" OR AccessMask="1f3fff") ObjectType="Process" ObjectName="*\\lsass.exe")) NOT (((SubjectUserName="*$")) OR ((ProcessName="C:\\Program Files*")) OR ((ProcessName="C:\\Windows\\System32\\wbem\\WmiPrvSE.exe" AccessMask="0x1410")) OR ((ProcessName="*\\SteamLibrary\\steamapps\\*"))))) | table ComputerName,ObjectName,SubjectUserName,ProcessName | eval sigma_attack_tags="attack.credential_access attack.t1003.001" | eval sigma_title="LSASS Access from Non System Account" | eval sigma_description="Detects potential mimikatz-like tools accessing LSASS from non system account"
dispatch.earliest_time = -24h@h
alert.track = 0

[Credential Dumping Tools Service Execution - Security - builtin]
description = Detects well-known credential dumping tools execution via service execution events
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") EventCode="4697" (ServiceFileName="*fgexec*" OR ServiceFileName="*dumpsvc*" OR ServiceFileName="*cachedump*" OR ServiceFileName="*mimidrv*" OR ServiceFileName="*gsecdump*" OR ServiceFileName="*servpw*" OR ServiceFileName="*pwdump*"))) | eval sigma_attack_tags="attack.credential_access attack.execution attack.t1003.001 attack.t1003.002 attack.t1003.004 attack.t1003.005 attack.t1003.006 attack.t1569.002 attack.s0005" | eval sigma_title="Credential Dumping Tools Service Execution - Security" | eval sigma_description="Detects well-known credential dumping tools execution via service execution events"
dispatch.earliest_time = -24h@h
alert.track = 0

[Malicious Service Installations - builtin]
description = Detects known malicious service installs that only appear in cases of lateral movement, credential dumping, and other suspicious activities.
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") EventCode="4697" ServiceName="javamtsup")) | eval sigma_attack_tags="attack.persistence attack.privilege_escalation attack.t1003 car.2013-09-005 attack.t1543.003 attack.t1569.002" | eval sigma_title="Malicious Service Installations" | eval sigma_description="Detects known malicious service installs that only appear in cases of lateral movement, credential dumping, and other suspicious activities."
dispatch.earliest_time = -24h@h
alert.track = 0

[WCE wceaux.dll Access - builtin]
description = Detects wceaux.dll access while WCE pass-the-hash remote command execution on source host
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (EventCode="4656" OR EventCode="4658" OR EventCode="4660" OR EventCode="4663") ObjectName="*\\wceaux.dll")) | eval sigma_attack_tags="attack.credential_access attack.t1003 attack.s0005" | eval sigma_title="WCE wceaux.dll Access" | eval sigma_description="Detects wceaux.dll access while WCE pass-the-hash remote command execution on source host"
dispatch.earliest_time = -24h@h
alert.track = 0

[Meterpreter or Cobalt Strike Getsystem Service Installation - Security - builtin]
description = Detects the use of getsystem Meterpreter/Cobalt Strike command by detecting a specific service installation
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") EventCode="4697" (((ServiceFileName="*cmd*" ServiceFileName="*/c*" ServiceFileName="*echo*" ServiceFileName="*\\pipe\\*")) OR ((ServiceFileName="*%COMSPEC%*" ServiceFileName="*/c*" ServiceFileName="*echo*" ServiceFileName="*\\pipe\\*")) OR ((ServiceFileName="*cmd.exe*" ServiceFileName="*/c*" ServiceFileName="*echo*" ServiceFileName="*\\pipe\\*")) OR ((ServiceFileName="*rundll32*" ServiceFileName="*.dll,a*" ServiceFileName="*/p:*"))))) | table ComputerName,SubjectDomainName,SubjectUserName,ServiceFileName | eval sigma_attack_tags="attack.privilege_escalation attack.t1134.001 attack.t1134.002" | eval sigma_title="Meterpreter or Cobalt Strike Getsystem Service Installation - Security" | eval sigma_description="Detects the use of getsystem Meterpreter/Cobalt Strike command by detecting a specific service installation"
dispatch.earliest_time = -24h@h
alert.track = 0

[NetNTLM Downgrade Attack - builtin]
description = Detects NetNTLM downgrade attack
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") EventCode="4657" ObjectName="*\\REGISTRY\\MACHINE\\SYSTEM*" ObjectName="*ControlSet*" ObjectName="*\\Control\\Lsa*" (ObjectValueName="LmCompatibilityLevel" OR ObjectValueName="NtlmMinClientSec" OR ObjectValueName="RestrictSendingNTLMTraffic"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.001 attack.t1112" | eval sigma_title="NetNTLM Downgrade Attack" | eval sigma_description="Detects NetNTLM downgrade attack"
dispatch.earliest_time = -24h@h
alert.track = 0

[Windows Network Access Suspicious desktop.ini Action - builtin]
description = Detects unusual processes accessing desktop.ini remotely over network share, which can be leveraged to alter how Explorer displays a folder's content (i.e. renaming files) without changing them on disk.
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") EventCode="5145" ObjectType="File" RelativeTargetName="*\\desktop.ini" (AccessList="*WriteData*" OR AccessList="*DELETE*" OR AccessList="*WriteDAC*" OR AccessList="*AppendData*" OR AccessList="*AddSubdirectory*"))) | eval sigma_attack_tags="attack.persistence attack.t1547.009" | eval sigma_title="Windows Network Access Suspicious desktop.ini Action" | eval sigma_description="Detects unusual processes accessing desktop.ini remotely over network share, which can be leveraged to alter how Explorer displays a folder's content (i.e. renaming files) without changing them on disk."
dispatch.earliest_time = -24h@h
alert.track = 0

[New or Renamed User Account with '$' in Attribute 'SamAccountName' - builtin]
description = Detects possible bypass EDR and SIEM via abnormal user account name.
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (((EventCode="4720" SamAccountName="*$*")) OR ((EventCode="4781" NewTargetUserName="*$*"))))) | table EventCode,SamAccountName,SubjectUserName,NewTargetUserName | eval sigma_attack_tags="attack.defense_evasion attack.t1036" | eval sigma_title="New or Renamed User Account with '$' in Attribute 'SamAccountName'" | eval sigma_description="Detects possible bypass EDR and SIEM via abnormal user account name."
dispatch.earliest_time = -24h@h
alert.track = 0

[Denied Access To Remote Desktop - builtin]
description = This event is generated when an authenticated user who is not allowed to log on remotely attempts to connect to this computer through Remote Desktop.
Often, this event can be generated by attackers when searching for available windows servers in the network.

search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") EventCode="4825")) | table EventCode,AccountName,ClientAddress | eval sigma_attack_tags="attack.lateral_movement attack.t1021.001" | eval sigma_title="Denied Access To Remote Desktop" | eval sigma_description="This event is generated when an authenticated user who is not allowed to log on remotely attempts to connect to this computer through Remote Desktop.
Often, this event can be generated by attackers when searching for available windows servers in the network.
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Successful Overpass the Hash Attempt - builtin]
description = Detects successful logon with logon type 9 (NewCredentials) which matches the Overpass the Hash behavior of e.g Mimikatz's sekurlsa::pth module.
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") EventCode="4624" LogonType="9" LogonProcessName="seclogo" AuthenticationPackageName="Negotiate")) | eval sigma_attack_tags="attack.lateral_movement attack.s0002 attack.t1550.002" | eval sigma_title="Successful Overpass the Hash Attempt" | eval sigma_description="Detects successful logon with logon type 9 (NewCredentials) which matches the Overpass the Hash behavior of e.g Mimikatz's sekurlsa::pth module."
dispatch.earliest_time = -24h@h
alert.track = 0

[Pass the Hash Activity 2 - builtin]
description = Detects the attack technique pass the hash which is used to move laterally inside the network
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (((EventCode="4624" SubjectUserSid="S-1-0-0" LogonType="3" LogonProcessName="NtLmSsp" KeyLength="0")) OR ((EventCode="4624" LogonType="9" LogonProcessName="seclogo"))) NOT ((TargetUserName="ANONYMOUS LOGON")))) | eval sigma_attack_tags="attack.lateral_movement attack.t1550.002" | eval sigma_title="Pass the Hash Activity 2" | eval sigma_description="Detects the attack technique pass the hash which is used to move laterally inside the network"
dispatch.earliest_time = -24h@h
alert.track = 0

[Possible PetitPotam Coerce Authentication Attempt - builtin]
description = Detect PetitPotam coerced authentication activity.
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") EventCode="5145" ShareName="\\\\\*" ShareName="*\\IPC$" RelativeTargetName="lsarpc" SubjectUserName="ANONYMOUS LOGON")) | eval sigma_attack_tags="attack.credential_access attack.t1187" | eval sigma_title="Possible PetitPotam Coerce Authentication Attempt" | eval sigma_description="Detect PetitPotam coerced authentication activity."
dispatch.earliest_time = -24h@h
alert.track = 0

[PetitPotam Suspicious Kerberos TGT Request - builtin]
description = Detect suspicious Kerberos TGT requests.
Once an attacer obtains a computer certificate by abusing Active Directory Certificate Services in combination with PetitPotam, the next step would be to leverage the certificate for malicious purposes.
One way of doing this is to request a Kerberos Ticket Granting Ticket using a tool like Rubeus.
This request will generate a 4768 event with some unusual fields depending on the environment.
This analytic will require tuning, we recommend filtering Account_Name to the Domain Controller computer accounts.

search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") ((EventCode="4768" TargetUserName="*$" CertThumbprint="*")) NOT (((IpAddress="::1")) OR ((CertThumbprint=""))))) | eval sigma_attack_tags="attack.credential_access attack.t1187" | eval sigma_title="PetitPotam Suspicious Kerberos TGT Request" | eval sigma_description="Detect suspicious Kerberos TGT requests.
Once an attacer obtains a computer certificate by abusing Active Directory Certificate Services in combination with PetitPotam, the next step would be to leverage the certificate for malicious purposes.
One way of doing this is to request a Kerberos Ticket Granting Ticket using a tool like Rubeus.
This request will generate a 4768 event with some unusual fields depending on the environment.
This analytic will require tuning, we recommend filtering Account_Name to the Domain Controller computer accounts.
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Possible DC Shadow Attack - builtin]
description = Detects DCShadow via create new SPN
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (((EventCode="4742" ServicePrincipalNames="*GC/*")) OR ((EventCode="5136" AttributeLDAPDisplayName="servicePrincipalName" AttributeValue="GC/*"))))) | eval sigma_attack_tags="attack.credential_access attack.t1207" | eval sigma_title="Possible DC Shadow Attack" | eval sigma_description="Detects DCShadow via create new SPN"
dispatch.earliest_time = -24h@h
alert.track = 0

[PowerShell Scripts Installed as Services - Security - builtin]
description = Detects powershell script installed as a Service
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") EventCode="4697" (ServiceFileName="*powershell*" OR ServiceFileName="*pwsh*"))) | eval sigma_attack_tags="attack.execution attack.t1569.002" | eval sigma_title="PowerShell Scripts Installed as Services - Security" | eval sigma_description="Detects powershell script installed as a Service"
dispatch.earliest_time = -24h@h
alert.track = 0

[Protected Storage Service Access - builtin]
description = Detects access to a protected_storage service over the network. Potential abuse of DPAPI to extract domain backup keys from Domain Controllers
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") EventCode="5145" ShareName="*IPC*" RelativeTargetName="protected_storage")) | eval sigma_attack_tags="attack.lateral_movement attack.t1021.002" | eval sigma_title="Protected Storage Service Access" | eval sigma_description="Detects access to a protected_storage service over the network. Potential abuse of DPAPI to extract domain backup keys from Domain Controllers"
dispatch.earliest_time = -24h@h
alert.track = 0

[Rare Schtasks Creations - builtin]
description = Detects rare scheduled tasks creations that only appear a few times per time frame and could reveal password dumpers, backdoor installs or other types of malicious code
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") EventCode="4698")) | eventstats count as val by TaskName| search val < 5 | eval sigma_attack_tags="attack.execution attack.privilege_escalation attack.persistence car.2013-08-001 attack.t1053.005" | eval sigma_title="Rare Schtasks Creations" | eval sigma_description="Detects rare scheduled tasks creations that only appear a few times per time frame and could reveal password dumpers, backdoor installs or other types of malicious code"
dispatch.earliest_time = -24h@h
alert.track = 0

[Scanner PoC for CVE-2019-0708 RDP RCE Vuln - builtin]
description = Detects the use of a scanner by zerosum0x0 that discovers targets vulnerable to  CVE-2019-0708 RDP RCE aka BlueKeep
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") EventCode="4625" TargetUserName="AAAAAAA")) | eval sigma_attack_tags="attack.lateral_movement attack.t1210 car.2013-07-002" | eval sigma_title="Scanner PoC for CVE-2019-0708 RDP RCE Vuln" | eval sigma_description="Detects the use of a scanner by zerosum0x0 that discovers targets vulnerable to  CVE-2019-0708 RDP RCE aka BlueKeep"
dispatch.earliest_time = -24h@h
alert.track = 0

[RDP Login from Localhost - builtin]
description = RDP login with localhost source address may be a tunnelled login
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") EventCode="4624" LogonType="10" (IpAddress="::1" OR IpAddress="127.0.0.1"))) | eval sigma_attack_tags="attack.lateral_movement car.2013-07-002 attack.t1021.001" | eval sigma_title="RDP Login from Localhost" | eval sigma_description="RDP login with localhost source address may be a tunnelled login"
dispatch.earliest_time = -24h@h
alert.track = 0

[RDP over Reverse SSH Tunnel WFP - builtin]
description = Detects svchost hosting RDP termsvcs communicating with the loopback address
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") ((EventCode="5156" (((SourcePort="3389" (DestAddress="127.*" OR DestAddress="::1"))) OR ((DestPort="3389" (SourceAddress="127.*" OR SourceAddress="::1")))))) NOT (((FilterOrigin="AppContainer Loopback")) OR (((Application="*\\thor.exe" OR Application="*\\thor64.exe")))))) | eval sigma_attack_tags="attack.defense_evasion attack.command_and_control attack.lateral_movement attack.t1090.001 attack.t1090.002 attack.t1021.001 car.2013-07-002" | eval sigma_title="RDP over Reverse SSH Tunnel WFP" | eval sigma_description="Detects svchost hosting RDP termsvcs communicating with the loopback address"
dispatch.earliest_time = -24h@h
alert.track = 0

[Register new Logon Process by Rubeus - builtin]
description = Detects potential use of Rubeus via registered new trusted logon process
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") EventCode="4611" LogonProcessName="User32LogonProcesss")) | eval sigma_attack_tags="attack.lateral_movement attack.privilege_escalation attack.t1558.003" | eval sigma_title="Register new Logon Process by Rubeus" | eval sigma_description="Detects potential use of Rubeus via registered new trusted logon process"
dispatch.earliest_time = -24h@h
alert.track = 0

[Remote PowerShell Sessions Network Connections (WinRM) - builtin]
description = Detects basic PowerShell Remoting (WinRM) by monitoring for network inbound connections to ports 5985 OR 5986
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") EventCode="5156" (DestPort="5985" OR DestPort="5986") LayerRTID="44")) | eval sigma_attack_tags="attack.execution attack.t1059.001" | eval sigma_title="Remote PowerShell Sessions Network Connections (WinRM)" | eval sigma_description="Detects basic PowerShell Remoting (WinRM) by monitoring for network inbound connections to ports 5985 OR 5986"
dispatch.earliest_time = -24h@h
alert.track = 0

[Replay Attack Detected - builtin]
description = Detects possible Kerberos Replay Attack on the domain controllers when 'KRB_AP_ERR_REPEAT' Kerberos response is sent to the client
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") EventCode="4649")) | eval sigma_attack_tags="" | eval sigma_title="Replay Attack Detected" | eval sigma_description="Detects possible Kerberos Replay Attack on the domain controllers when 'KRB_AP_ERR_REPEAT' Kerberos response is sent to the client"
dispatch.earliest_time = -24h@h
alert.track = 0

[SAM Registry Hive Handle Request - builtin]
description = Detects handles requested to SAM registry hive
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") EventCode="4656" ObjectType="Key" ObjectName="*\\SAM")) | table ComputerName,SubjectDomainName,SubjectUserName,ProcessName,ObjectName | eval sigma_attack_tags="attack.discovery attack.t1012 attack.credential_access attack.t1552.002" | eval sigma_title="SAM Registry Hive Handle Request" | eval sigma_description="Detects handles requested to SAM registry hive"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Computer Account Name Change CVE-2021-42287 - builtin]
description = Detects the renaming of an existing computer account to a account name that doesn't contain a $ symbol as seen in attacks against CVE-2021-42287
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") ((EventCode="4781" OldTargetUserName="*$*")) NOT ((NewTargetUserName="*$*")))) | table EventCode,SubjectUserName | eval sigma_attack_tags="" | eval sigma_title="Suspicious Computer Account Name Change CVE-2021-42287" | eval sigma_description="Detects the renaming of an existing computer account to a account name that doesn't contain a $ symbol as seen in attacks against CVE-2021-42287"
dispatch.earliest_time = -24h@h
alert.track = 0

[Scheduled Task Deletion - builtin]
description = Detects scheduled task deletion events. Scheduled tasks are likely to be deleted if not used for persistence. Malicious Software often creates tasks directly under the root node e.g. \TASKNAME
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") EventCode="4699" NOT (((TaskName="\\Microsoft\\Windows\\RemovalTools\\MRT_ERROR_HB")) OR ((TaskName="*\\Mozilla\\Firefox Default Browser Agent *"))))) | eval sigma_attack_tags="attack.execution attack.privilege_escalation car.2013-08-001 attack.t1053.005" | eval sigma_title="Scheduled Task Deletion" | eval sigma_description="Detects scheduled task deletion events. Scheduled tasks are likely to be deleted if not used for persistence. Malicious Software often creates tasks directly under the root node e.g. \TASKNAME"
dispatch.earliest_time = -24h@h
alert.track = 0

[SCM Database Handle Failure - builtin]
description = Detects non-system users failing to get a handle of the SCM database.
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") ((EventCode="4656" ObjectType="SC_MANAGER OBJECT" ObjectName="ServicesActive" AccessMask="0xf003f")) NOT ((SubjectLogonId="0x3e4")))) | eval sigma_attack_tags="attack.discovery attack.t1010" | eval sigma_title="SCM Database Handle Failure" | eval sigma_description="Detects non-system users failing to get a handle of the SCM database."
dispatch.earliest_time = -24h@h
alert.track = 0

[SCM Database Privileged Operation - builtin]
description = Detects non-system users performing privileged operation os the SCM database
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") ((EventCode="4674" ObjectType="SC_MANAGER OBJECT" ObjectName="servicesactive" PrivilegeList="SeTakeOwnershipPrivilege")) NOT ((SubjectLogonId="0x3e4" ProcessName="*:\\Windows\\System32\\services.exe")))) | eval sigma_attack_tags="attack.privilege_escalation attack.t1548" | eval sigma_title="SCM Database Privileged Operation" | eval sigma_description="Detects non-system users performing privileged operation os the SCM database"
dispatch.earliest_time = -24h@h
alert.track = 0

[Remote WMI ActiveScriptEventConsumers - builtin]
description = Detect potential adversaries leveraging WMI ActiveScriptEventConsumers remotely to move laterally in a network
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") ((EventCode="4624" LogonType="3" ProcessName="*scrcons.exe")) NOT ((TargetLogonId="0x3e7")))) | eval sigma_attack_tags="attack.lateral_movement attack.privilege_escalation attack.persistence attack.t1546.003" | eval sigma_title="Remote WMI ActiveScriptEventConsumers" | eval sigma_description="Detect potential adversaries leveraging WMI ActiveScriptEventConsumers remotely to move laterally in a network"
dispatch.earliest_time = -24h@h
alert.track = 0

[Remote Access Tool Services Have Been Installed - Security - builtin]
description = Detects service installation of different remote access tools software. These software are often abused by threat actors to perform
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") EventCode="4697" (ServiceFileName="*SSUService*" OR ServiceFileName="*SplashtopRemoteService*" OR ServiceFileName="*Atera*" OR ServiceFileName="*LogMeIn*" OR ServiceFileName="*LMIGuardianSvc*" OR ServiceFileName="*TeamViewer*" OR ServiceFileName="*RPCService*" OR ServiceFileName="*RPCPerformanceService*" OR ServiceFileName="*BASupportExpressStandaloneService*" OR ServiceFileName="*BASupportExpressSrvcUpdater*" OR ServiceFileName="*GoToMyPC*" OR ServiceFileName="*monblanking*" OR ServiceFileName="*RManService*" OR ServiceFileName="*GoToAssist*" OR ServiceFileName="*AmmyyAdmin*" OR ServiceFileName="*vncserver*" OR ServiceFileName="*Parsec*" OR ServiceFileName="*chromoting*" OR ServiceFileName="*Zoho*" OR ServiceFileName="*jumpcloud*"))) | eval sigma_attack_tags="attack.persistence attack.t1543.003 attack.t1569.002" | eval sigma_title="Remote Access Tool Services Have Been Installed - Security" | eval sigma_description="Detects service installation of different remote access tools software. These software are often abused by threat actors to perform"
dispatch.earliest_time = -24h@h
alert.track = 0

[Service Installed By Unusual Client - Security - builtin]
description = Detects a service installed by a client which has PID 0 or whose parent has PID 0
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") EventCode="4697" (ClientProcessId="0" OR ParentProcessId="0"))) | eval sigma_attack_tags="attack.privilege_escalation attack.t1543" | eval sigma_title="Service Installed By Unusual Client - Security" | eval sigma_description="Detects a service installed by a client which has PID 0 or whose parent has PID 0"
dispatch.earliest_time = -24h@h
alert.track = 0

[SMB Create Remote File Admin Share - builtin]
description = Look for non-system accounts SMB accessing a file with write (0x2) access mask via administrative share (i.e C$).
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") ((EventCode="5145" ShareName="*C$" AccessMask="0x2")) NOT ((SubjectUserName="*$")))) | eval sigma_attack_tags="attack.lateral_movement attack.t1021.002" | eval sigma_title="SMB Create Remote File Admin Share" | eval sigma_description="Look for non-system accounts SMB accessing a file with write (0x2) access mask via administrative share (i.e C$)."
dispatch.earliest_time = -24h@h
alert.track = 0

[Addition of Domain Trusts - builtin]
description = Addition of domains is seldom and should be verified for legitimacy.
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") EventCode="4706")) | eval sigma_attack_tags="attack.persistence attack.t1098" | eval sigma_title="Addition of Domain Trusts" | eval sigma_description="Addition of domains is seldom and should be verified for legitimacy."
dispatch.earliest_time = -24h@h
alert.track = 0

[Addition of SID History to Active Directory Object - builtin]
description = An attacker can use the SID history attribute to gain additional privileges.
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") ((EventCode="4765" OR EventCode="4766") OR ((((EventCode="4738" NOT (((SidHistory="-" OR SidHistory="%%1793"))))) NOT ((NOT SidHistory="*"))))))) | eval sigma_attack_tags="attack.persistence attack.privilege_escalation attack.t1134.005" | eval sigma_title="Addition of SID History to Active Directory Object" | eval sigma_description="An attacker can use the SID history attribute to gain additional privileges."
dispatch.earliest_time = -24h@h
alert.track = 0

[Failed Code Integrity Checks - builtin]
description = Detects code integrity failures such as missing page hashes or corrupted drivers due unauthorized modification. This could be a sign of tampered binaries.
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (EventCode="5038" OR EventCode="6281"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1027.001" | eval sigma_title="Failed Code Integrity Checks" | eval sigma_description="Detects code integrity failures such as missing page hashes or corrupted drivers due unauthorized modification. This could be a sign of tampered binaries."
dispatch.earliest_time = -24h@h
alert.track = 0

[Win Susp Computer Name Containing Samtheadmin - builtin]
description = Detects suspicious computer name samtheadmin-{1..100}$ generated by hacktool
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (((SamAccountName="SAMTHEADMIN-*" SamAccountName="*$")) OR ((TargetUserName="SAMTHEADMIN-*" TargetUserName="*$"))))) | table EventCode,SamAccountName,SubjectUserName,TargetUserName | eval sigma_attack_tags="cve.2021.42278 cve.2021.42287 attack.persistence attack.privilege_escalation attack.t1078" | eval sigma_title="Win Susp Computer Name Containing Samtheadmin" | eval sigma_description="Detects suspicious computer name samtheadmin-{1..100}$ generated by hacktool"
dispatch.earliest_time = -24h@h
alert.track = 0

[Password Change on Directory Service Restore Mode (DSRM) Account - builtin]
description = The Directory Service Restore Mode (DSRM) account is a local administrator account on Domain Controllers. Attackers may change the password to gain persistence.
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") EventCode="4794")) | eval sigma_attack_tags="attack.persistence attack.t1098" | eval sigma_title="Password Change on Directory Service Restore Mode (DSRM) Account" | eval sigma_description="The Directory Service Restore Mode (DSRM) account is a local administrator account on Domain Controllers. Attackers may change the password to gain persistence."
dispatch.earliest_time = -24h@h
alert.track = 0

[Security Eventlog Cleared - builtin]
description = One of the Windows Eventlogs has been cleared. e.g. caused by 'wevtutil cl' command execution
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (((EventCode="517" Provider_Name="Security")) OR ((EventCode="1102" Provider_Name="Microsoft-Windows-Eventlog"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1070.001 car.2016-04-002" | eval sigma_title="Security Eventlog Cleared" | eval sigma_description="One of the Windows Eventlogs has been cleared. e.g. caused by 'wevtutil cl' command execution"
dispatch.earliest_time = -24h@h
alert.track = 0

[Account Tampering - Suspicious Failed Logon Reasons - builtin]
description = This method uses uncommon error codes on failed logons to determine suspicious activity and tampering with accounts that have been disabled or somehow restricted.
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (((EventCode="4625" OR EventCode="4776") (Status="0xC0000072" OR Status="0xC000006F" OR Status="0xC0000070" OR Status="0xC0000413" OR Status="0xC000018C" OR Status="0xC000015B"))) NOT ((SubjectUserSid="S-1-0-0")))) | eval sigma_attack_tags="attack.persistence attack.defense_evasion attack.privilege_escalation attack.initial_access attack.t1078" | eval sigma_title="Account Tampering - Suspicious Failed Logon Reasons" | eval sigma_description="This method uses uncommon error codes on failed logons to determine suspicious activity and tampering with accounts that have been disabled or somehow restricted."
dispatch.earliest_time = -24h@h
alert.track = 0

[Failed Logon From Public IP - builtin]
description = A login from a public IP can indicate a misconfigured firewall or network boundary.
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") EventCode="4625" NOT (((IpAddress="*-*")) OR (((IpAddress="10.*" OR IpAddress="192.168.*" OR IpAddress="172.16.*" OR IpAddress="172.17.*" OR IpAddress="172.18.*" OR IpAddress="172.19.*" OR IpAddress="172.20.*" OR IpAddress="172.21.*" OR IpAddress="172.22.*" OR IpAddress="172.23.*" OR IpAddress="172.24.*" OR IpAddress="172.25.*" OR IpAddress="172.26.*" OR IpAddress="172.27.*" OR IpAddress="172.28.*" OR IpAddress="172.29.*" OR IpAddress="172.30.*" OR IpAddress="172.31.*" OR IpAddress="127.*" OR IpAddress="169.254.*"))) OR ((IpAddress="::1") OR ((IpAddress="fe80::*" OR IpAddress="fc00::*")))))) | eval sigma_attack_tags="attack.initial_access attack.persistence attack.t1078 attack.t1190 attack.t1133" | eval sigma_title="Failed Logon From Public IP" | eval sigma_description="A login from a public IP can indicate a misconfigured firewall or network boundary."
dispatch.earliest_time = -24h@h
alert.track = 0

[Password Spraying via Explicit Credentials - builtin]
description = Detects a single user failing to authenticate to multiple users using explicit credentials.
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") EventCode="4648" NOT ((SubjectUserName="*$")))) | eventstats dc(TargetUserName) as val by SubjectUserName | search val > 10 | eval sigma_attack_tags="attack.t1110.003 attack.initial_access attack.privilege_escalation" | eval sigma_title="Password Spraying via Explicit Credentials" | eval sigma_description="Detects a single user failing to authenticate to multiple users using explicit credentials."
dispatch.earliest_time = -24h@h
alert.track = 0

[Multiple Users Failing to Authenticate from Single Process - builtin]
description = Detects failed logins with multiple accounts from a single process on the system.
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") ((EventCode="4625" LogonType="2")) NOT ((ProcessName="-")))) | eventstats dc(TargetUserName) as val by ProcessName | search val > 10 | eval sigma_attack_tags="attack.t1110.003 attack.initial_access attack.privilege_escalation" | eval sigma_title="Multiple Users Failing to Authenticate from Single Process" | eval sigma_description="Detects failed logins with multiple accounts from a single process on the system."
dispatch.earliest_time = -24h@h
alert.track = 0

[Valid Users Failing to Authenticate From Single Source Using Kerberos - builtin]
description = Detects multiple failed logins with multiple valid domain accounts from a single source system using the Kerberos protocol.
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") ((EventCode="4771" Status="0x18")) NOT ((TargetUserName="*$")))) | eventstats dc(TargetUserName) as val by IpAddress | search val > 10 | eval sigma_attack_tags="attack.t1110.003 attack.initial_access attack.privilege_escalation" | eval sigma_title="Valid Users Failing to Authenticate From Single Source Using Kerberos" | eval sigma_description="Detects multiple failed logins with multiple valid domain accounts from a single source system using the Kerberos protocol."
dispatch.earliest_time = -24h@h
alert.track = 0

[Disabled Users Failing To Authenticate From Source Using Kerberos - builtin]
description = Detects failed logins with multiple disabled domain accounts from a single source system using the Kerberos protocol.
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") ((EventCode="4768" Status="0x12")) NOT ((TargetUserName="*$")))) | eventstats dc(TargetUserName) as val by IpAddress | search val > 10 | eval sigma_attack_tags="attack.t1110.003 attack.initial_access attack.privilege_escalation" | eval sigma_title="Disabled Users Failing To Authenticate From Source Using Kerberos" | eval sigma_description="Detects failed logins with multiple disabled domain accounts from a single source system using the Kerberos protocol."
dispatch.earliest_time = -24h@h
alert.track = 0

[Invalid Users Failing To Authenticate From Source Using Kerberos - builtin]
description = Detects failed logins with multiple invalid domain accounts from a single source system using the Kerberos protocol.
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") ((EventCode="4768" Status="0x6")) NOT ((TargetUserName="*$")))) | eventstats dc(TargetUserName) as val by IpAddress | search val > 10 | eval sigma_attack_tags="attack.t1110.003 attack.initial_access attack.privilege_escalation" | eval sigma_title="Invalid Users Failing To Authenticate From Source Using Kerberos" | eval sigma_description="Detects failed logins with multiple invalid domain accounts from a single source system using the Kerberos protocol."
dispatch.earliest_time = -24h@h
alert.track = 0

[Valid Users Failing to Authenticate from Single Source Using NTLM - builtin]
description = Detects failed logins with multiple valid domain accounts from a single source system using the NTLM protocol.
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") ((EventCode="4776" Status="*0xC000006A")) NOT ((TargetUserName="*$")))) | eventstats dc(TargetUserName) as val by Workstation | search val > 10 | eval sigma_attack_tags="attack.t1110.003 attack.initial_access attack.privilege_escalation" | eval sigma_title="Valid Users Failing to Authenticate from Single Source Using NTLM" | eval sigma_description="Detects failed logins with multiple valid domain accounts from a single source system using the NTLM protocol."
dispatch.earliest_time = -24h@h
alert.track = 0

[Invalid Users Failing To Authenticate From Single Source Using NTLM - builtin]
description = Detects failed logins with multiple invalid domain accounts from a single source system using the NTLM protocol.
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") ((EventCode="4776" Status="*0xC0000064")) NOT ((TargetUserName="*$")))) | eventstats dc(TargetUserName) as val by Workstation | search val > 10 | eval sigma_attack_tags="attack.t1110.003 attack.initial_access attack.privilege_escalation" | eval sigma_title="Invalid Users Failing To Authenticate From Single Source Using NTLM" | eval sigma_description="Detects failed logins with multiple invalid domain accounts from a single source system using the NTLM protocol."
dispatch.earliest_time = -24h@h
alert.track = 0

[Failed Logins with Different Accounts from Single Source System - builtin]
description = Detects suspicious failed logins with different user accounts from a single source system
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (EventCode="529" OR EventCode="4625") TargetUserName="*" WorkstationName="*")) | eventstats dc(TargetUserName) as val by WorkstationName | search val > 3 | eval sigma_attack_tags="attack.persistence attack.privilege_escalation attack.t1078" | eval sigma_title="Failed Logins with Different Accounts from Single Source System" | eval sigma_description="Detects suspicious failed logins with different user accounts from a single source system"
dispatch.earliest_time = -24h@h
alert.track = 0

[Failed NTLM Logins with Different Accounts from Single Source System - builtin]
description = Detects suspicious failed logins with different user accounts from a single source system
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") EventCode="4776" TargetUserName="*" Workstation="*")) | eventstats dc(TargetUserName) as val by Workstation | search val > 3 | eval sigma_attack_tags="attack.persistence attack.privilege_escalation attack.t1078" | eval sigma_title="Failed NTLM Logins with Different Accounts from Single Source System" | eval sigma_description="Detects suspicious failed logins with different user accounts from a single source system"
dispatch.earliest_time = -24h@h
alert.track = 0

[Multiple Users Remotely Failing To Authenticate From Single Source - builtin]
description = Detects a source system failing to authenticate against a remote host with multiple users.
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") ((EventCode="4625" LogonType="3")) NOT ((IpAddress="-")))) | eventstats dc(TargetUserName) as val by IpAddress | search val > 10 | eval sigma_attack_tags="attack.t1110.003 attack.initial_access attack.privilege_escalation" | eval sigma_title="Multiple Users Remotely Failing To Authenticate From Single Source" | eval sigma_description="Detects a source system failing to authenticate against a remote host with multiple users."
dispatch.earliest_time = -24h@h
alert.track = 0

[Kerberos Manipulation - builtin]
description = This method triggers on rare Kerberos Failure Codes caused by manipulations of Kerberos messages
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (EventCode="675" OR EventCode="4768" OR EventCode="4769" OR EventCode="4771") (FailureCode="0x9" OR FailureCode="0xA" OR FailureCode="0xB" OR FailureCode="0xF" OR FailureCode="0x10" OR FailureCode="0x11" OR FailureCode="0x13" OR FailureCode="0x14" OR FailureCode="0x1A" OR FailureCode="0x1F" OR FailureCode="0x21" OR FailureCode="0x22" OR FailureCode="0x23" OR FailureCode="0x24" OR FailureCode="0x26" OR FailureCode="0x27" OR FailureCode="0x28" OR FailureCode="0x29" OR FailureCode="0x2C" OR FailureCode="0x2D" OR FailureCode="0x2E" OR FailureCode="0x2F" OR FailureCode="0x31" OR FailureCode="0x32" OR FailureCode="0x3E" OR FailureCode="0x3F" OR FailureCode="0x40" OR FailureCode="0x41" OR FailureCode="0x43" OR FailureCode="0x44"))) | eval sigma_attack_tags="attack.credential_access attack.t1212" | eval sigma_title="Kerberos Manipulation" | eval sigma_description="This method triggers on rare Kerberos Failure Codes caused by manipulations of Kerberos messages"
dispatch.earliest_time = -24h@h
alert.track = 0

[KrbRelayUp Attack Pattern - builtin]
description = Detects logon events that have characteristics of events generated during an attack with KrbRelayUp and the like
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") EventCode="4624" LogonType="3" AuthenticationPackageName="Kerberos" IpAddress="127.0.0.1" TargetUserSid="S-1-5-21-*" TargetUserSid="*-500")) | eval sigma_attack_tags="attack.privilege_escalation attack.credential_access" | eval sigma_title="KrbRelayUp Attack Pattern" | eval sigma_description="Detects logon events that have characteristics of events generated during an attack with KrbRelayUp and the like"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious LDAP-Attributes Used - builtin]
description = Detects the usage of particular AttributeLDAPDisplayNames, which are known for data exchange via LDAP by the tool LDAPFragger and are additionally not commonly used in companies.
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") EventCode="5136" AttributeValue="*" (AttributeLDAPDisplayName="primaryInternationalISDNNumber" OR AttributeLDAPDisplayName="otherFacsimileTelephoneNumber" OR AttributeLDAPDisplayName="primaryTelexNumber"))) | eval sigma_attack_tags="attack.t1001.003 attack.command_and_control" | eval sigma_title="Suspicious LDAP-Attributes Used" | eval sigma_description="Detects the usage of particular AttributeLDAPDisplayNames, which are known for data exchange via LDAP by the tool LDAPFragger and are additionally not commonly used in companies."
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Windows ANONYMOUS LOGON Local Account Created - builtin]
description = Detects the creation of suspicious accounts similar to ANONYMOUS LOGON, such as using additional spaces. Created as an covering detection for exclusion of Logon Type 3 from ANONYMOUS LOGON accounts.
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") EventCode="4720" SamAccountName="*ANONYMOUS*" SamAccountName="*LOGON*")) | eval sigma_attack_tags="attack.persistence attack.t1136.001 attack.t1136.002" | eval sigma_title="Suspicious Windows ANONYMOUS LOGON Local Account Created" | eval sigma_description="Detects the creation of suspicious accounts similar to ANONYMOUS LOGON, such as using additional spaces. Created as an covering detection for exclusion of Logon Type 3 from ANONYMOUS LOGON accounts."
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Remote Logon with Explicit Credentials - builtin]
description = Detects suspicious processes logging on with explicit credentials
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") ((EventCode="4648" (ProcessName="*\\cmd.exe" OR ProcessName="*\\powershell.exe" OR ProcessName="*\\pwsh.exe" OR ProcessName="*\\winrs.exe" OR ProcessName="*\\wmic.exe" OR ProcessName="*\\net.exe" OR ProcessName="*\\net1.exe" OR ProcessName="*\\reg.exe"))) NOT (((TargetServerName="localhost")) OR ((SubjectUserName="*$" TargetUserName="*$"))))) | eval sigma_attack_tags="attack.t1078 attack.lateral_movement" | eval sigma_title="Suspicious Remote Logon with Explicit Credentials" | eval sigma_description="Detects suspicious processes logging on with explicit credentials"
dispatch.earliest_time = -24h@h
alert.track = 0

[Outgoing Logon with New Credentials - builtin]
description = Detects logon events that specify new credentials
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") EventCode="4624" LogonType="9")) | eval sigma_attack_tags="" | eval sigma_title="Outgoing Logon with New Credentials" | eval sigma_description="Detects logon events that specify new credentials"
dispatch.earliest_time = -24h@h
alert.track = 0

[Generic Password Dumper Activity on LSASS - builtin]
description = Detects process handle on LSASS process with certain access mask
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (((EventCode="4656" ObjectName="*\\lsass.exe" (AccessMask="*0x40*" OR AccessMask="*0x1400*" OR AccessMask="*0x100000*" OR AccessMask="*0x1410*" OR AccessMask="*0x1010*" OR AccessMask="*0x1438*" OR AccessMask="*0x143a*" OR AccessMask="*0x1418*" OR AccessMask="*0x1f0fff*" OR AccessMask="*0x1f1fff*" OR AccessMask="*0x1f2fff*" OR AccessMask="*0x1f3fff*"))) OR ((EventCode="4663" ObjectName="*\\lsass.exe" (AccessList="*4484*" OR AccessList="*4416*")))) NOT ((((ProcessName="*\\wmiprvse.exe" OR ProcessName="*\\taskmgr.exe" OR ProcessName="*\\procexp64.exe" OR ProcessName="*\\procexp.exe" OR ProcessName="*\\lsm.exe" OR ProcessName="*\\csrss.exe" OR ProcessName="*\\wininit.exe" OR ProcessName="*\\vmtoolsd.exe" OR ProcessName="*\\minionhost.exe" OR ProcessName="*\\VsTskMgr.exe" OR ProcessName="*\\thor.exe" OR ProcessName="*\\thor64.exe" OR ProcessName="*\\MicrosoftEdgeUpdate.exe" OR ProcessName="*\\GamingServices.exe" OR ProcessName="*\\svchost.exe" OR ProcessName="*\\MsMpEng.exe" OR ProcessName="*\\MRT.exe" OR ProcessName="*RtkAudUService64") (ProcessName="C:\\Windows\\System32\\*" OR ProcessName="C:\\Windows\\SysWow64\\*" OR ProcessName="C:\\Windows\\SysNative\\*" OR ProcessName="C:\\Program Files\\*" OR ProcessName="C:\\Program Files (x86)\\*" OR ProcessName="C:\\Windows\\Temp\\asgard2-agent\\*" OR ProcessName="C:\\ProgramData\\Microsoft\\Windows Defender\\Platform\\*"))) OR ((ProcessName="C:\\Program Files*")) OR ((ProcessName="C:\\Windows\\CCM\\CcmExec.exe")) OR (((ProcessName="C:\\Windows\\System32\\taskhostw.exe" OR ProcessName="C:\\Windows\\System32\\msiexec.exe"))) OR ((ProcessName="*\\SteamLibrary\\steamapps\\*"))))) | table ComputerName,SubjectDomainName,SubjectUserName,ProcessName,ProcessID | eval sigma_attack_tags="attack.credential_access car.2019-04-004 attack.t1003.001" | eval sigma_title="Generic Password Dumper Activity on LSASS" | eval sigma_description="Detects process handle on LSASS process with certain access mask"
dispatch.earliest_time = -24h@h
alert.track = 0

[Password Dumper Activity on LSASS - builtin]
description = Detects process handle on LSASS process with certain access mask and object type SAM_DOMAIN
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") EventCode="4656" ProcessName="*\\lsass.exe" AccessMask="0x705" ObjectType="SAM_DOMAIN")) | eval sigma_attack_tags="attack.credential_access attack.t1003.001" | eval sigma_title="Password Dumper Activity on LSASS" | eval sigma_description="Detects process handle on LSASS process with certain access mask and object type SAM_DOMAIN"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Multiple File Rename Or Delete Occurred - builtin]
description = Detects multiple file rename or delete events occurrence within a specified period of time by a same user (these events may signalize about ransomware activity).
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") EventCode="4663" ObjectType="File" AccessList="%%1537" Keywords="0x8020000000000000")) | eventstats count as val by SubjectLogonId| search val > 10 | eval sigma_attack_tags="attack.impact attack.t1486" | eval sigma_title="Suspicious Multiple File Rename Or Delete Occurred" | eval sigma_description="Detects multiple file rename or delete events occurrence within a specified period of time by a same user (these events may signalize about ransomware activity)."
dispatch.earliest_time = -24h@h
alert.track = 0

[Reconnaissance Activity - builtin]
description = Detects activity as 'net user administrator /domain' and 'net group domain admins /domain'
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") EventCode="4661" AccessMask="0x2d" (ObjectType="SAM_USER" OR ObjectType="SAM_GROUP") ObjectName="S-1-5-21-*" (ObjectName="*-500" OR ObjectName="*-512"))) | eval sigma_attack_tags="attack.discovery attack.t1087.002 attack.t1069.002 attack.s0039" | eval sigma_title="Reconnaissance Activity" | eval sigma_description="Detects activity as 'net user administrator /domain' and 'net group domain admins /domain'"
dispatch.earliest_time = -24h@h
alert.track = 0

[Password Protected ZIP File Opened (Suspicious Filenames) - builtin]
description = Detects the extraction of password protected ZIP archives with suspicious file names. See the filename variable for more details on which file has been opened.
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") EventCode="5379" TargetName="*Microsoft_Windows_Shell_ZipFolder:filename*" (TargetName="*invoice*" OR TargetName="*new order*" OR TargetName="*rechnung*" OR TargetName="*factura*" OR TargetName="*delivery*" OR TargetName="*purchase*" OR TargetName="*order*" OR TargetName="*payment*"))) | eval sigma_attack_tags="" | eval sigma_title="Password Protected ZIP File Opened (Suspicious Filenames)" | eval sigma_description="Detects the extraction of password protected ZIP archives with suspicious file names. See the filename variable for more details on which file has been opened."
dispatch.earliest_time = -24h@h
alert.track = 0

[Password Protected ZIP File Opened (Email Attachment) - builtin]
description = Detects the extraction of password protected ZIP archives. See the filename variable for more details on which file has been opened.
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") EventCode="5379" TargetName="*Microsoft_Windows_Shell_ZipFolder:filename*" TargetName="*\\Temporary Internet Files\\Content.Outlook*")) | eval sigma_attack_tags="" | eval sigma_title="Password Protected ZIP File Opened (Email Attachment)" | eval sigma_description="Detects the extraction of password protected ZIP archives. See the filename variable for more details on which file has been opened."
dispatch.earliest_time = -24h@h
alert.track = 0

[Password Protected ZIP File Opened - builtin]
description = Detects the extraction of password protected ZIP archives. See the filename variable for more details on which file has been opened.
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") ((EventCode="5379" TargetName="*Microsoft_Windows_Shell_ZipFolder:filename*")) NOT ((TargetName="*\\Temporary Internet Files\\Content.Outlook*")))) | eval sigma_attack_tags="" | eval sigma_title="Password Protected ZIP File Opened" | eval sigma_description="Detects the extraction of password protected ZIP archives. See the filename variable for more details on which file has been opened."
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Outbound Kerberos Connection - Security - builtin]
description = Detects suspicious outbound network activity via kerberos default port indicating possible lateral movement or first stage PrivEsc via delegation.
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") ((EventCode="5156" DestPort="88")) NOT ((((Application="C:\\Windows\\System32\\lsass.exe" OR Application="C:\\Program Files\\Google\\Chrome\\Application\\chrome.exe" OR Application="C:\\Program Files (x86)\\Google\\Chrome\\Application\\chrome.exe" OR Application="C:\\Program Files\\Mozilla Firefox\\firefox.exe" OR Application="C:\\Program Files (x86)\\Mozilla Firefox\\firefox.exe")))))) | eval sigma_attack_tags="attack.lateral_movement attack.t1558.003" | eval sigma_title="Suspicious Outbound Kerberos Connection - Security" | eval sigma_description="Detects suspicious outbound network activity via kerberos default port indicating possible lateral movement or first stage PrivEsc via delegation."
dispatch.earliest_time = -24h@h
alert.track = 0

[Possible Shadow Credentials Added - builtin]
description = Detects possible addition of shadow credentials to an active directory object.
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") EventCode="5136" AttributeLDAPDisplayName="msDS-KeyCredentialLink")) | eval sigma_attack_tags="attack.credential_access attack.t1556" | eval sigma_title="Possible Shadow Credentials Added" | eval sigma_description="Detects possible addition of shadow credentials to an active directory object."
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious PsExec Execution - builtin]
description = detects execution of psexec or paexec with renamed service name, this rule helps to filter out the noise if psexec is used for legit purposes or if attacker uses a different psexec client other than sysinternal one
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") ((EventCode="5145" ShareName="\\\\\*\\IPC$" (RelativeTargetName="*-stdin" OR RelativeTargetName="*-stdout" OR RelativeTargetName="*-stderr"))) NOT ((RelativeTargetName="PSEXESVC*")))) | eval sigma_attack_tags="attack.lateral_movement attack.t1021.002" | eval sigma_title="Suspicious PsExec Execution" | eval sigma_description="detects execution of psexec or paexec with renamed service name, this rule helps to filter out the noise if psexec is used for legit purposes or if attacker uses a different psexec client other than sysinternal one"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Access to Sensitive File Extensions - builtin]
description = Detects known sensitive file extensions accessed on a network share
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") EventCode="5145" (RelativeTargetName="*.pst" OR RelativeTargetName="*.ost" OR RelativeTargetName="*.msg" OR RelativeTargetName="*.nst" OR RelativeTargetName="*.oab" OR RelativeTargetName="*.edb" OR RelativeTargetName="*.nsf" OR RelativeTargetName="*.bak" OR RelativeTargetName="*.dmp" OR RelativeTargetName="*.kirbi" OR RelativeTargetName="*\\groups.xml" OR RelativeTargetName="*.rdp"))) | table ComputerName,SubjectDomainName,SubjectUserName,RelativeTargetName | eval sigma_attack_tags="attack.collection attack.t1039" | eval sigma_title="Suspicious Access to Sensitive File Extensions" | eval sigma_description="Detects known sensitive file extensions accessed on a network share"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Kerberos RC4 Ticket Encryption - builtin]
description = Detects service ticket requests using RC4 encryption type
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") ((EventCode="4769" TicketOptions="0x40810000" TicketEncryptionType="0x17")) NOT ((ServiceName="*$")))) | eval sigma_attack_tags="attack.credential_access attack.t1558.003" | eval sigma_title="Suspicious Kerberos RC4 Ticket Encryption" | eval sigma_description="Detects service ticket requests using RC4 encryption type"
dispatch.earliest_time = -24h@h
alert.track = 0

[RottenPotato Like Attack Pattern - builtin]
description = Detects logon events that have characteristics of events generated during an attack with RottenPotato and the like
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") EventCode="4624" LogonType="3" TargetUserName="ANONYMOUS LOGON" WorkstationName="-" (IpAddress="127.0.0.1" OR IpAddress="::1"))) | eval sigma_attack_tags="attack.privilege_escalation attack.credential_access attack.t1557.001" | eval sigma_title="RottenPotato Like Attack Pattern" | eval sigma_description="Detects logon events that have characteristics of events generated during an attack with RottenPotato and the like"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Scheduled Task Creation - builtin]
description = Detects suspicious scheduled task creation events. Based on attributes such as paths, commands line flags, etc.
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") EventCode="4698" (TaskContent="*\\AppData\\Local\\Temp\\*" OR TaskContent="*\\AppData\\Roaming\\*" OR TaskContent="*\\Users\\Public\\*" OR TaskContent="*\\WINDOWS\\Temp\\*" OR TaskContent="*C:\\Temp\\*" OR TaskContent="*\\Desktop\\*" OR TaskContent="*\\Downloads\\*" OR TaskContent="*\\Temporary Internet*" OR TaskContent="*C:\\ProgramData\\*" OR TaskContent="*C:\\Perflogs\\*") (TaskContent="*regsvr32*" OR TaskContent="*rundll32*" OR TaskContent="*cmd.exe</Command>*" OR TaskContent="*cmd</Command>*" OR TaskContent="*<Arguments>/c *" OR TaskContent="*<Arguments>/k *" OR TaskContent="*<Arguments>/r *" OR TaskContent="*powershell*" OR TaskContent="*pwsh*" OR TaskContent="*mshta*" OR TaskContent="*wscript*" OR TaskContent="*cscript*" OR TaskContent="*certutil*" OR TaskContent="*bitsadmin*" OR TaskContent="*bash.exe*" OR TaskContent="*bash *" OR TaskContent="*scrcons*" OR TaskContent="*wmic *" OR TaskContent="*wmic.exe*" OR TaskContent="*forfiles*" OR TaskContent="*scriptrunner*" OR TaskContent="*hh.exe*"))) | eval sigma_attack_tags="attack.execution attack.privilege_escalation attack.persistence attack.t1053.005" | eval sigma_title="Suspicious Scheduled Task Creation" | eval sigma_description="Detects suspicious scheduled task creation events. Based on attributes such as paths, commands line flags, etc."
dispatch.earliest_time = -24h@h
alert.track = 0

[Important Scheduled Task Deleted/Disabled - builtin]
description = Detects when adversaries stop services or processes by deleting or disabling their respective scheduled tasks in order to conduct data destructive activities
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (((EventCode="4699" OR EventCode="4701") (TaskName="*\\Windows\\SystemRestore\\SR*" OR TaskName="*\\Windows\\Windows Defender\\*" OR TaskName="*\\Windows\\BitLocker*" OR TaskName="*\\Windows\\WindowsBackup\\*" OR TaskName="*\\Windows\\WindowsUpdate\\*" OR TaskName="*\\Windows\\UpdateOrchestrator\\*" OR TaskName="*\\Windows\\ExploitGuard*"))) NOT (((Task="*\\Windows\\UpdateOrchestrator\\AC Power Download*")) OR ((SubjectUserName="*$"))))) | eval sigma_attack_tags="attack.execution attack.privilege_escalation attack.persistence attack.t1053.005" | eval sigma_title="Important Scheduled Task Deleted/Disabled" | eval sigma_description="Detects when adversaries stop services or processes by deleting or disabling their respective scheduled tasks in order to conduct data destructive activities"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Scheduled Task Update - builtin]
description = Detects update to a scheduled task event that contain suspicious keywords.
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") EventCode="4702" (TaskContentNew="*\\AppData\\Local\\Temp\\*" OR TaskContentNew="*\\AppData\\Roaming\\*" OR TaskContentNew="*\\Users\\Public\\*" OR TaskContentNew="*\\WINDOWS\\Temp\\*" OR TaskContentNew="*C:\\Temp\\*" OR TaskContentNew="*\\Desktop\\*" OR TaskContentNew="*\\Downloads\\*" OR TaskContentNew="*\\Temporary Internet*" OR TaskContentNew="*C:\\ProgramData\\*" OR TaskContentNew="*C:\\Perflogs\\*") (TaskContentNew="*regsvr32*" OR TaskContentNew="*rundll32*" OR TaskContentNew="*cmd.exe</Command>*" OR TaskContentNew="*cmd</Command>*" OR TaskContentNew="*<Arguments>/c *" OR TaskContentNew="*<Arguments>/k *" OR TaskContentNew="*<Arguments>/r *" OR TaskContentNew="*powershell*" OR TaskContentNew="*pwsh*" OR TaskContentNew="*mshta*" OR TaskContentNew="*wscript*" OR TaskContentNew="*cscript*" OR TaskContentNew="*certutil*" OR TaskContentNew="*bitsadmin*" OR TaskContentNew="*bash.exe*" OR TaskContentNew="*bash *" OR TaskContentNew="*scrcons*" OR TaskContentNew="*wmic *" OR TaskContentNew="*wmic.exe*" OR TaskContentNew="*forfiles*" OR TaskContentNew="*scriptrunner*" OR TaskContentNew="*hh.exe*"))) | eval sigma_attack_tags="attack.execution attack.privilege_escalation attack.persistence attack.t1053.005" | eval sigma_title="Suspicious Scheduled Task Update" | eval sigma_description="Detects update to a scheduled task event that contain suspicious keywords."
dispatch.earliest_time = -24h@h
alert.track = 0

[Secure Deletion with SDelete - builtin]
description = Detects renaming of file while deletion with SDelete tool.
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (EventCode="4656" OR EventCode="4663" OR EventCode="4658") (ObjectName="*.AAA" OR ObjectName="*.ZZZ"))) | eval sigma_attack_tags="attack.impact attack.defense_evasion attack.t1070.004 attack.t1027.005 attack.t1485 attack.t1553.002 attack.s0195" | eval sigma_title="Secure Deletion with SDelete" | eval sigma_description="Detects renaming of file while deletion with SDelete tool."
dispatch.earliest_time = -24h@h
alert.track = 0

[Unauthorized System Time Modification - builtin]
description = Detect scenarios where a potentially unauthorized application or user is modifying the system time.
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") EventCode="4616" NOT ((((ProcessName="C:\\Program Files\\VMware\\VMware Tools\\vmtoolsd.exe" OR ProcessName="C:\\Windows\\System32\\VBoxService.exe" OR ProcessName="C:\\Windows\\System32\\oobe\\msoobe.exe"))) OR ((ProcessName="C:\\Windows\\System32\\svchost.exe" SubjectUserSid="S-1-5-19"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1070.006" | eval sigma_title="Unauthorized System Time Modification" | eval sigma_description="Detect scenarios where a potentially unauthorized application or user is modifying the system time."
dispatch.earliest_time = -24h@h
alert.track = 0

[Login with WMI - builtin]
description = Detection of logins performed with WMI
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") EventCode="4624" ProcessName="*\\WmiPrvSE.exe")) | eval sigma_attack_tags="attack.execution attack.t1047" | eval sigma_title="Login with WMI" | eval sigma_description="Detection of logins performed with WMI"
dispatch.earliest_time = -24h@h
alert.track = 0

[Remote Service Activity via SVCCTL Named Pipe - builtin]
description = Detects remote service activity via remote access to the svcctl named pipe
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") EventCode="5145" ShareName="\\\\\*\\IPC$" RelativeTargetName="svcctl" Accesses="*WriteData*")) | eval sigma_attack_tags="attack.lateral_movement attack.persistence attack.t1021.002" | eval sigma_title="Remote Service Activity via SVCCTL Named Pipe" | eval sigma_description="Detects remote service activity via remote access to the svcctl named pipe"
dispatch.earliest_time = -24h@h
alert.track = 0

[SysKey Registry Keys Access - builtin]
description = Detects handle requests and access operations to specific registry keys to calculate the SysKey
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (EventCode="4656" OR EventCode="4663") ObjectType="key" (ObjectName="*lsa\\JD" OR ObjectName="*lsa\\GBG" OR ObjectName="*lsa\\Skew1" OR ObjectName="*lsa\\Data"))) | eval sigma_attack_tags="attack.discovery attack.t1012" | eval sigma_title="SysKey Registry Keys Access" | eval sigma_description="Detects handle requests and access operations to specific registry keys to calculate the SysKey"
dispatch.earliest_time = -24h@h
alert.track = 0

[Sysmon Channel Reference Deletion - builtin]
description = Potential threat actor tampering with Sysmon manifest and eventually disabling it
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (((EventCode="4657" (ObjectName="*WINEVT\\Publishers\\{5770385f-c22a-43e0-bf4c-06f5698ffbd9}*" OR ObjectName="*WINEVT\\Channels\\Microsoft-Windows-Sysmon/Operational*") ObjectValueName="Enabled" NewValue="0")) OR ((EventCode="4663" (ObjectName="*WINEVT\\Publishers\\{5770385f-c22a-43e0-bf4c-06f5698ffbd9}*" OR ObjectName="*WINEVT\\Channels\\Microsoft-Windows-Sysmon/Operational*") AccessMask="65536"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1112" | eval sigma_title="Sysmon Channel Reference Deletion" | eval sigma_description="Potential threat actor tampering with Sysmon manifest and eventually disabling it"
dispatch.earliest_time = -24h@h
alert.track = 0

[Tap Driver Installation - Security - builtin]
description = Well-known TAP software installation. Possible preparation for data exfiltration using tunnelling techniques
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") EventCode="4697" ServiceFileName="*tap0901*")) | eval sigma_attack_tags="attack.exfiltration attack.t1048" | eval sigma_title="Tap Driver Installation - Security" | eval sigma_description="Well-known TAP software installation. Possible preparation for data exfiltration using tunnelling techniques"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Teams Application Related ObjectAcess Event - builtin]
description = Detects an access to authentication tokens and accounts of Microsoft Teams desktop application.
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") ((EventCode="4663" (ObjectName="*\\Microsoft\\Teams\\Cookies*" OR ObjectName="*\\Microsoft\\Teams\\Local Storage\\leveldb*"))) NOT ((ProcessName="*\\Microsoft\\Teams\\current\\Teams.exe*")))) | eval sigma_attack_tags="attack.credential_access attack.t1528" | eval sigma_title="Suspicious Teams Application Related ObjectAcess Event" | eval sigma_description="Detects an access to authentication tokens and accounts of Microsoft Teams desktop application."
dispatch.earliest_time = -24h@h
alert.track = 0

[Transferring Files with Credential Data via Network Shares - builtin]
description = Transferring files with well-known filenames (sensitive files with credential data) using network shares
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Provider_Name="Microsoft-Windows-Security-Auditing" EventCode="5145" (RelativeTargetName="*\\mimidrv*" OR RelativeTargetName="*\\lsass*" OR RelativeTargetName="*\\windows\\minidump\\*" OR RelativeTargetName="*\\hiberfil*" OR RelativeTargetName="*\\sqldmpr*" OR RelativeTargetName="*\\sam*" OR RelativeTargetName="*\\ntds.dit*" OR RelativeTargetName="*\\security*"))) | eval sigma_attack_tags="attack.credential_access attack.t1003.002 attack.t1003.001 attack.t1003.003" | eval sigma_title="Transferring Files with Credential Data via Network Shares" | eval sigma_description="Transferring files with well-known filenames (sensitive files with credential data) using network shares"
dispatch.earliest_time = -24h@h
alert.track = 0

[User Added to Local Administrators - builtin]
description = This rule triggers on user accounts that are added to the local Administrators group, which could be legitimate activity or a sign of privilege escalation activity
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") ((((Provider_Name="Microsoft-Windows-Security-Auditing" EventCode="4732")) (TargetUserName="Administr*" OR TargetSid="S-1-5-32-544"))) NOT ((SubjectUserName="*$")))) | eval sigma_attack_tags="attack.privilege_escalation attack.t1078 attack.persistence attack.t1098" | eval sigma_title="User Added to Local Administrators" | eval sigma_description="This rule triggers on user accounts that are added to the local Administrators group, which could be legitimate activity or a sign of privilege escalation activity"
dispatch.earliest_time = -24h@h
alert.track = 0

[User Couldn't Call a Privileged Service 'LsaRegisterLogonProcess' - builtin]
description = The 'LsaRegisterLogonProcess' function verifies that the application making the function call is a logon process by checking that it has the SeTcbPrivilege privilege set. Possible Rubeus tries to get a handle to LSA.
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Provider_Name="Microsoft-Windows-Security-Auditing" EventCode="4673" Service="LsaRegisterLogonProcess()" Keywords="0x8010000000000000")) | eval sigma_attack_tags="attack.lateral_movement attack.privilege_escalation attack.t1558.003" | eval sigma_title="User Couldn't Call a Privileged Service 'LsaRegisterLogonProcess'" | eval sigma_description="The 'LsaRegisterLogonProcess' function verifies that the application making the function call is a logon process by checking that it has the SeTcbPrivilege privilege set. Possible Rubeus tries to get a handle to LSA."
dispatch.earliest_time = -24h@h
alert.track = 0

[Local User Creation - builtin]
description = Detects local user creation on windows servers, which shouldn't happen in an Active Directory environment. Apply this Sigma Use Case on your windows server logs and not on your DC logs.
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Provider_Name="Microsoft-Windows-Security-Auditing" EventCode="4720")) | table EventCode,AccountName,AccountDomain | eval sigma_attack_tags="attack.persistence attack.t1136.001" | eval sigma_title="Local User Creation" | eval sigma_description="Detects local user creation on windows servers, which shouldn't happen in an Active Directory environment. Apply this Sigma Use Case on your windows server logs and not on your DC logs."
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential Privileged System Service Operation - SeLoadDriverPrivilege - builtin]
description = Detects the usage of the 'SeLoadDriverPrivilege' privilege. This privilege is required to load or unload a device driver.
With this privilege, the user can dynamically load and unload device drivers or other code in to kernel mode.
This user right does not apply to Plug and Play device drivers.
If you exclude privileged users/admins and processes, which are allowed to do so, you are maybe left with bad programs trying to load malicious kernel drivers.
This will detect Ghost-In-The-Logs (https://github.com/bats3c/Ghost-In-The-Logs) and the usage of Sysinternals and various other tools. So you have to work with a whitelist to find the bad stuff.

search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") ((Provider_Name="Microsoft-Windows-Security-Auditing" EventCode="4673" PrivilegeList="SeLoadDriverPrivilege" Service="-")) NOT ((((ProcessName="C:\\Windows\\System32\\Dism.exe" OR ProcessName="C:\\Windows\\System32\\rundll32.exe" OR ProcessName="C:\\Windows\\System32\\fltMC.exe" OR ProcessName="C:\\Windows\\HelpPane.exe" OR ProcessName="C:\\Windows\\System32\\mmc.exe" OR ProcessName="C:\\Windows\\System32\\svchost.exe" OR ProcessName="C:\\Windows\\System32\\wimserv.exe" OR ProcessName="C:\\Windows\\System32\\RuntimeBroker.exe" OR ProcessName="C:\\Windows\\System32\\SystemSettingsBroker.exe" OR ProcessName="C:\\Windows\\explorer.exe"))) OR (((ProcessName="*\\procexp64.exe" OR ProcessName="*\\procexp.exe" OR ProcessName="*\\procmon64.exe" OR ProcessName="*\\procmon.exe" OR ProcessName="*\\Google\\Chrome\\Application\\chrome.exe" OR ProcessName="*\\AppData\\Local\\Microsoft\\Teams\\current\\Teams.exe"))) OR ((ProcessName="C:\\Program Files\\WindowsApps\\Microsoft*"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.001" | eval sigma_title="Potential Privileged System Service Operation - SeLoadDriverPrivilege" | eval sigma_description="Detects the usage of the 'SeLoadDriverPrivilege' privilege. This privilege is required to load or unload a device driver.
With this privilege, the user can dynamically load and unload device drivers or other code in to kernel mode.
This user right does not apply to Plug and Play device drivers.
If you exclude privileged users/admins and processes, which are allowed to do so, you are maybe left with bad programs trying to load malicious kernel drivers.
This will detect Ghost-In-The-Logs (https://github.com/bats3c/Ghost-In-The-Logs) and the usage of Sysinternals and various other tools. So you have to work with a whitelist to find the bad stuff.
"
dispatch.earliest_time = -24h@h
alert.track = 0

[User Logoff Event - builtin]
description = Detects a user log-off activity. Could be used for example to correlate information during forensic investigations
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (EventCode="4634" OR EventCode="4647"))) | eval sigma_attack_tags="" | eval sigma_title="User Logoff Event" | eval sigma_description="Detects a user log-off activity. Could be used for example to correlate information during forensic investigations"
dispatch.earliest_time = -24h@h
alert.track = 0

[VSSAudit Security Event Source Registration - builtin]
description = Detects the registration of the security event source VSSAudit. It would usually trigger when volume shadow copy operations happen.
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Provider_Name="Microsoft-Windows-Security-Auditing" AuditSourceName="VSSAudit" (EventCode="4904" OR EventCode="4905"))) | eval sigma_attack_tags="attack.credential_access attack.t1003.002" | eval sigma_title="VSSAudit Security Event Source Registration" | eval sigma_description="Detects the registration of the security event source VSSAudit. It would usually trigger when volume shadow copy operations happen."
dispatch.earliest_time = -24h@h
alert.track = 0

[WMI Persistence - Security - builtin]
description = Detects suspicious WMI event filter and command line event consumer based on WMI and Security Logs.
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") EventCode="4662" ObjectType="WMI Namespace" ObjectName="*subscription*")) | eval sigma_attack_tags="attack.persistence attack.privilege_escalation attack.t1546.003" | eval sigma_title="WMI Persistence - Security" | eval sigma_description="Detects suspicious WMI event filter and command line event consumer based on WMI and Security Logs."
dispatch.earliest_time = -24h@h
alert.track = 0

[T1047 Wmiprvse Wbemcomn DLL Hijack - builtin]
description = Detects a threat actor creating a file named `wbemcomn.dll` in the `C:\Windows\System32\wbem\` directory over the network for a WMI DLL Hijack scenario.
search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") ((Provider_Name="Microsoft-Windows-Security-Auditing" EventCode="5145" RelativeTargetName="*\\wbem\\wbemcomn.dll")) NOT ((SubjectUserName="*$")))) | eval sigma_attack_tags="attack.execution attack.t1047 attack.lateral_movement attack.t1021.002" | eval sigma_title="T1047 Wmiprvse Wbemcomn DLL Hijack" | eval sigma_description="Detects a threat actor creating a file named `wbemcomn.dll` in the `C:\Windows\System32\wbem\` directory over the network for a WMI DLL Hijack scenario."
dispatch.earliest_time = -24h@h
alert.track = 0

[Locked Workstation - builtin]
description = Automatically lock workstation sessions after a standard period of inactivity.
The case is not applicable for Unix OS. Supported OS - Windows 2008 R2 and 7, Windows 2012 R2 and 8.1, Windows 2016 and 10 Windows Server 2019.

search = index=wineventlog* (((source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") EventCode="4800")) | eval sigma_attack_tags="" | eval sigma_title="Locked Workstation" | eval sigma_description="Automatically lock workstation sessions after a standard period of inactivity.
The case is not applicable for Unix OS. Supported OS - Windows 2008 R2 and 7, Windows 2012 R2 and 8.1, Windows 2016 and 10 Windows Server 2019.
"
dispatch.earliest_time = -24h@h
alert.track = 0

[DNS Server Error Failed Loading the ServerLevelPluginDLL - builtin]
description = This rule detects a DNS server error in which a specified plugin DLL (in registry) could not be loaded
search = index=wineventlog* (EventCode="150" OR EventCode="770") | eval sigma_attack_tags="attack.defense_evasion attack.t1574.002" | eval sigma_title="DNS Server Error Failed Loading the ServerLevelPluginDLL" | eval sigma_description="This rule detects a DNS server error in which a specified plugin DLL (in registry) could not be loaded"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Download with BITS from Direct IP - builtin]
description = Detects a suspicious download using the BITS client from a direct IP. Adversaries may abuse BITS jobs to persistently execute or clean up after malicious payloads.
search = index=wineventlog* ((source="WinEventLog:Microsoft-Windows-Bits-Client/Operational" ((EventCode="16403" (RemoteName="*http://1*" OR RemoteName="*http://2*" OR RemoteName="*http://3*" OR RemoteName="*http://4*" OR RemoteName="*http://5*" OR RemoteName="*http://6*" OR RemoteName="*http://7*" OR RemoteName="*http://8*" OR RemoteName="*http://9*" OR RemoteName="*https://1*" OR RemoteName="*https://2*" OR RemoteName="*https://3*" OR RemoteName="*https://4*" OR RemoteName="*https://5*" OR RemoteName="*https://6*" OR RemoteName="*https://7*" OR RemoteName="*https://8*" OR RemoteName="*https://9*"))) NOT ((((RemoteName="*://10.*" OR RemoteName="*://192.168.*" OR RemoteName="*://172.16.*" OR RemoteName="*://172.17.*" OR RemoteName="*://172.18.*" OR RemoteName="*://172.19.*" OR RemoteName="*://172.20.*" OR RemoteName="*://172.21.*" OR RemoteName="*://172.22.*" OR RemoteName="*://172.23.*" OR RemoteName="*://172.24.*" OR RemoteName="*://172.25.*" OR RemoteName="*://172.26.*" OR RemoteName="*://172.27.*" OR RemoteName="*://172.28.*" OR RemoteName="*://172.29.*" OR RemoteName="*://172.30.*" OR RemoteName="*://172.31.*" OR RemoteName="*://127.*" OR RemoteName="*://169.254.*"))) OR (((RemoteName="*https://7-*" OR RemoteName="*http://7-*")))))) | eval sigma_attack_tags="attack.defense_evasion attack.persistence attack.t1197" | eval sigma_title="Suspicious Download with BITS from Direct IP" | eval sigma_description="Detects a suspicious download using the BITS client from a direct IP. Adversaries may abuse BITS jobs to persistently execute or clean up after malicious payloads."
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Download with BITS from Suspicious TLD - builtin]
description = Detects a suspicious download using the BITS client from a FQDN that is unusual. Adversaries may abuse BITS jobs to persistently execute or clean up after malicious payloads.
search = index=wineventlog* ((source="WinEventLog:Microsoft-Windows-Bits-Client/Operational" EventCode="16403" (RemoteName="*raw.githubusercontent.com*" OR RemoteName="*gist.githubusercontent.com*" OR RemoteName="*pastebin.com*" OR RemoteName="*cdn.discordapp.com/attachments/*" OR RemoteName="*mediafire.com*" OR RemoteName="*mega.nz*" OR RemoteName="*ddns.net*" OR RemoteName="*.paste.ee*" OR RemoteName="*.hastebin.com*" OR RemoteName="*.ghostbin.co/*" OR RemoteName="*ufile.io*" OR RemoteName="*storage.googleapis.com*" OR RemoteName="*anonfiles.com*" OR RemoteName="*send.exploit.in*" OR RemoteName="*transfer.sh*" OR RemoteName="*privatlab.net*" OR RemoteName="*privatlab.com*" OR RemoteName="*sendspace.com*" OR RemoteName="*pastetext.net*" OR RemoteName="*pastebin.pl*" OR RemoteName="*paste.ee*"))) | eval sigma_attack_tags="attack.defense_evasion attack.persistence attack.t1197" | eval sigma_title="Suspicious Download with BITS from Suspicious TLD" | eval sigma_description="Detects a suspicious download using the BITS client from a FQDN that is unusual. Adversaries may abuse BITS jobs to persistently execute or clean up after malicious payloads."
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Download File Extension with BITS - builtin]
description = Adversaries may abuse BITS jobs to persistently execute or clean up after malicious payloads.
Windows Background Intelligent Transfer Service (BITS) is a low-bandwidth, asynchronous file transfer mechanism exposed through [Component Object Model](https://attack.mitre.org/techniques/T1559/001)

search = index=wineventlog* ((source="WinEventLog:Microsoft-Windows-Bits-Client/Operational" ((EventCode="16403" (LocalName="*.bat" OR LocalName="*.dll" OR LocalName="*.exe" OR LocalName="*.ps1" OR LocalName="*.vbe" OR LocalName="*.vbs"))) NOT ((LocalName="*\\AppData\\*" RemoteName="*.com*")))) | eval sigma_attack_tags="attack.defense_evasion attack.persistence attack.t1197" | eval sigma_title="Suspicious Download File Extension with BITS" | eval sigma_description="Adversaries may abuse BITS jobs to persistently execute or clean up after malicious payloads.
Windows Background Intelligent Transfer Service (BITS) is a low-bandwidth, asynchronous file transfer mechanism exposed through [Component Object Model](https://attack.mitre.org/techniques/T1559/001)
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Download with BITS to Suspicious Folder - builtin]
description = Adversaries may abuse BITS jobs to persistently execute or clean up after malicious payloads.
Windows Background Intelligent Transfer Service (BITS) is a low-bandwidth, asynchronous file transfer mechanism exposed through [Component Object Model](https://attack.mitre.org/techniques/T1559/001)

search = index=wineventlog* ((source="WinEventLog:Microsoft-Windows-Bits-Client/Operational" EventCode="16403" (LocalName="*C:\\Users\\Public\\*" OR LocalName="*%public%*" OR LocalName="*\\Desktop\\*" OR LocalName="*C:\\PerfLogs\\*"))) | eval sigma_attack_tags="attack.defense_evasion attack.persistence attack.t1197" | eval sigma_title="Download with BITS to Suspicious Folder" | eval sigma_description="Adversaries may abuse BITS jobs to persistently execute or clean up after malicious payloads.
Windows Background Intelligent Transfer Service (BITS) is a low-bandwidth, asynchronous file transfer mechanism exposed through [Component Object Model](https://attack.mitre.org/techniques/T1559/001)
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Task Added by Powershell - builtin]
description = Adversaries may abuse BITS jobs to persistently execute or clean up after malicious payloads.
Windows Background Intelligent Transfer Service (BITS) is a low-bandwidth, asynchronous file transfer mechanism exposed through [Component Object Model](https://attack.mitre.org/techniques/T1559/001)

search = index=wineventlog* ((source="WinEventLog:Microsoft-Windows-Bits-Client/Operational" EventCode="3" (processPath="*\\powershell.exe" OR processPath="*\\pwsh.exe"))) | eval sigma_attack_tags="attack.defense_evasion attack.persistence attack.t1197" | eval sigma_title="Suspicious Task Added by Powershell" | eval sigma_description="Adversaries may abuse BITS jobs to persistently execute or clean up after malicious payloads.
Windows Background Intelligent Transfer Service (BITS) is a low-bandwidth, asynchronous file transfer mechanism exposed through [Component Object Model](https://attack.mitre.org/techniques/T1559/001)
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Task Added by Bitsadmin - builtin]
description = Adversaries may abuse BITS jobs to persistently execute or clean up after malicious payloads.
Windows Background Intelligent Transfer Service (BITS) is a low-bandwidth, asynchronous file transfer mechanism exposed through [Component Object Model](https://attack.mitre.org/techniques/T1559/001)

search = index=wineventlog* ((source="WinEventLog:Microsoft-Windows-Bits-Client/Operational" EventCode="3" processPath="*\\bitsadmin.exe")) | eval sigma_attack_tags="attack.defense_evasion attack.persistence attack.t1197" | eval sigma_title="Suspicious Task Added by Bitsadmin" | eval sigma_description="Adversaries may abuse BITS jobs to persistently execute or clean up after malicious payloads.
Windows Background Intelligent Transfer Service (BITS) is a low-bandwidth, asynchronous file transfer mechanism exposed through [Component Object Model](https://attack.mitre.org/techniques/T1559/001)
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Uncommon Download with BITS from Suspicious TLD - builtin]
description = Detects a suspicious download using the BITS client from a FQDN that is unusual. Adversaries may abuse BITS jobs to persistently execute or clean up after malicious payloads.
search = index=wineventlog* ((source="WinEventLog:Microsoft-Windows-Bits-Client/Operational" EventCode="16403" NOT (((RemoteName="*.com*" OR RemoteName="*.azureedge.net*" OR RemoteName="*.sfx.ms*" OR RemoteName="*download.mozilla.org*"))))) | eval sigma_attack_tags="attack.defense_evasion attack.persistence attack.t1197" | eval sigma_title="Suspicious Uncommon Download with BITS from Suspicious TLD" | eval sigma_description="Detects a suspicious download using the BITS client from a FQDN that is unusual. Adversaries may abuse BITS jobs to persistently execute or clean up after malicious payloads."
dispatch.earliest_time = -24h@h
alert.track = 0

[Microsoft Defender Blocked from Loading Unsigned DLL - builtin]
description = Detects Code Integrity (CI) engine blocking Microsoft Defender's processes (MpCmdRun and NisSrv) from loading unsigned DLLs which may be an attempt to sideload arbitrary DLL
search = index=wineventlog* (((source="WinEventLog:Microsoft-Windows-Security-Mitigations/Kernel Mode" OR source="WinEventLog:Microsoft-Windows-Security-Mitigations/User Mode") (EventCode="11" OR EventCode="12") (ProcessPath="*\\MpCmdRun.exe" OR ProcessPath="*\\NisSrv.exe"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1574.002" | eval sigma_title="Microsoft Defender Blocked from Loading Unsigned DLL" | eval sigma_description="Detects Code Integrity (CI) engine blocking Microsoft Defender's processes (MpCmdRun and NisSrv) from loading unsigned DLLs which may be an attempt to sideload arbitrary DLL"
dispatch.earliest_time = -24h@h
alert.track = 0

[Unsigned Binary Loaded From Suspicious Location - builtin]
description = Detects Code Integrity (CI) engine blocking processes from loading unsigned DLLs residing in suspicious locations
search = index=wineventlog* (((source="WinEventLog:Microsoft-Windows-Security-Mitigations/Kernel Mode" OR source="WinEventLog:Microsoft-Windows-Security-Mitigations/User Mode") (EventCode="11" OR EventCode="12") (ImageName="*\\Users\\Public\\*" OR ImageName="*\\PerfLogs\\*" OR ImageName="*\\Desktop\\*" OR ImageName="*\\Downloads\\*" OR ImageName="*\\AppData\\Local\\Temp\\*" OR ImageName="*C:\\Windows\\TEMP\\*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1574.002" | eval sigma_title="Unsigned Binary Loaded From Suspicious Location" | eval sigma_description="Detects Code Integrity (CI) engine blocking processes from loading unsigned DLLs residing in suspicious locations"
dispatch.earliest_time = -24h@h
alert.track = 0

[Sysmon Crash - builtin]
description = Detects application popup reporting a failure of the Sysmon service
search = index=wineventlog* ((source="WinEventLog:System" Provider_Name="Application Popup" EventCode="26" Caption="sysmon64.exe - Application Error")) | eval sigma_attack_tags="attack.defense_evasion attack.t1562" | eval sigma_title="Sysmon Crash" | eval sigma_description="Detects application popup reporting a failure of the Sysmon service"
dispatch.earliest_time = -24h@h
alert.track = 0

[Turla Service Install - builtin]
description = This method detects a service install of malicious services mentioned in Carbon Paper - Turla report by ESET
search = index=wineventlog* ((source="WinEventLog:System" Provider_Name="Service Control Manager" EventCode="7045" (ServiceName="srservice" OR ServiceName="ipvpn" OR ServiceName="hkmsvc"))) | eval sigma_attack_tags="attack.persistence attack.g0010 attack.t1543.003" | eval sigma_title="Turla Service Install" | eval sigma_description="This method detects a service install of malicious services mentioned in Carbon Paper - Turla report by ESET"
dispatch.earliest_time = -24h@h
alert.track = 0

[Chafer Activity - System - builtin]
description = Detects Chafer activity attributed to OilRig as reported in Nyotron report in March 2018
search = index=wineventlog* ((source="WinEventLog:System" Provider_Name="Service Control Manager" EventCode="7045" (ServiceName="SC Scheduled Scan" OR ServiceName="UpdatMachine"))) | eval sigma_attack_tags="attack.persistence attack.g0049 attack.t1053.005 attack.s0111 attack.t1543.003 attack.defense_evasion attack.t1112 attack.command_and_control attack.t1071.004" | eval sigma_title="Chafer Activity - System" | eval sigma_description="Detects Chafer activity attributed to OilRig as reported in Nyotron report in March 2018"
dispatch.earliest_time = -24h@h
alert.track = 0

[StoneDrill Service Install - builtin]
description = This method detects a service install of the malicious Microsoft Network Realtime Inspection Service service described in StoneDrill report by Kaspersky
search = index=wineventlog* ((source="WinEventLog:System" Provider_Name="Service Control Manager" EventCode="7045" ServiceName="NtsSrv" ImagePath="* LocalService")) | eval sigma_attack_tags="attack.persistence attack.g0064 attack.t1543.003" | eval sigma_title="StoneDrill Service Install" | eval sigma_description="This method detects a service install of the malicious Microsoft Network Realtime Inspection Service service described in StoneDrill report by Kaspersky"
dispatch.earliest_time = -24h@h
alert.track = 0

[Turla PNG Dropper Service - builtin]
description = This method detects malicious services mentioned in Turla PNG dropper report by NCC Group in November 2018
search = index=wineventlog* ((source="WinEventLog:System" Provider_Name="Service Control Manager" EventCode="7045" ServiceName="WerFaultSvc")) | eval sigma_attack_tags="attack.persistence attack.g0010 attack.t1543.003" | eval sigma_title="Turla PNG Dropper Service" | eval sigma_description="This method detects malicious services mentioned in Turla PNG dropper report by NCC Group in November 2018"
dispatch.earliest_time = -24h@h
alert.track = 0

[Windows Defender Threat Detection Disabled - Service - builtin]
description = Detects the 'Windows Defender Threat Protection' service has been disabled
search = index=wineventlog* ((source="WinEventLog:System" EventCode="7036" Provider_Name="Service Control Manager" (param1="Windows Defender Antivirus Service" OR param1="Service antivirus Microsoft Defender") param2="stopped")) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.001" | eval sigma_title="Windows Defender Threat Detection Disabled - Service" | eval sigma_description="Detects the 'Windows Defender Threat Protection' service has been disabled"
dispatch.earliest_time = -24h@h
alert.track = 0

[Eventlog Cleared - builtin]
description = One of the Windows Eventlogs has been cleared. e.g. caused by 'wevtutil cl' command execution
search = index=wineventlog* ((source="WinEventLog:System" ((EventCode="104" Provider_Name="Microsoft-Windows-Eventlog")) NOT (((Channel="System" OR Channel="Security" OR Channel="Application"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1070.001 car.2016-04-002" | eval sigma_title="Eventlog Cleared" | eval sigma_description="One of the Windows Eventlogs has been cleared. e.g. caused by 'wevtutil cl' command execution"
dispatch.earliest_time = -24h@h
alert.track = 0

[smbexec.py Service Installation - builtin]
description = Detects the use of smbexec.py tool by detecting a specific service installation
search = index=wineventlog* ((source="WinEventLog:System" Provider_Name="Service Control Manager" EventCode="7045" ServiceName="BTOBTO" ImagePath="*\\execute.bat")) | table ServiceName,ServiceFileName | eval sigma_attack_tags="attack.lateral_movement attack.execution attack.t1021.002 attack.t1569.002" | eval sigma_title="smbexec.py Service Installation" | eval sigma_description="Detects the use of smbexec.py tool by detecting a specific service installation"
dispatch.earliest_time = -24h@h
alert.track = 0

[Invoke-Obfuscation CLIP+ Launcher - System - builtin]
description = Detects Obfuscated use of Clip.exe to execute PowerShell
search = index=wineventlog* ((source="WinEventLog:System" Provider_Name="Service Control Manager" EventCode="7045" ImagePath="*cmd*" ImagePath="*clip*" ImagePath="*clipboard]::*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1027 attack.execution attack.t1059.001" | eval sigma_title="Invoke-Obfuscation CLIP+ Launcher - System" | eval sigma_description="Detects Obfuscated use of Clip.exe to execute PowerShell"
dispatch.earliest_time = -24h@h
alert.track = 0

[Invoke-Obfuscation STDIN+ Launcher - System - builtin]
description = Detects Obfuscated use of stdin to execute PowerShell
search = index=wineventlog* ((source="WinEventLog:System" ((Provider_Name="Service Control Manager" EventCode="7045" ImagePath="*cmd*" ImagePath="*powershell*" (ImagePath="*/c*" OR ImagePath="*/r*"))) (ImagePath="*noexit*" OR ((ImagePath="*input*" ImagePath="*$*"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1027 attack.execution attack.t1059.001" | eval sigma_title="Invoke-Obfuscation STDIN+ Launcher - System" | eval sigma_description="Detects Obfuscated use of stdin to execute PowerShell"
dispatch.earliest_time = -24h@h
alert.track = 0

[Invoke-Obfuscation VAR+ Launcher - System - builtin]
description = Detects Obfuscated use of Environment Variables to execute PowerShell
search = index=wineventlog* ((source="WinEventLog:System" Provider_Name="Service Control Manager" EventCode="7045" ImagePath="*cmd*" ImagePath="*\"set*" ImagePath="*-f*" (ImagePath="*/c*" OR ImagePath="*/r*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1027 attack.execution attack.t1059.001" | eval sigma_title="Invoke-Obfuscation VAR+ Launcher - System" | eval sigma_description="Detects Obfuscated use of Environment Variables to execute PowerShell"
dispatch.earliest_time = -24h@h
alert.track = 0

[Invoke-Obfuscation COMPRESS OBFUSCATION - System - builtin]
description = Detects Obfuscated Powershell via COMPRESS OBFUSCATION
search = index=wineventlog* ((source="WinEventLog:System" Provider_Name="Service Control Manager" EventCode="7045" ImagePath="*new-object*" ImagePath="*text.encoding]::ascii*" ImagePath="*readtoend*" (ImagePath="*:system.io.compression.deflatestream*" OR ImagePath="*system.io.streamreader*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1027 attack.execution attack.t1059.001" | eval sigma_title="Invoke-Obfuscation COMPRESS OBFUSCATION - System" | eval sigma_description="Detects Obfuscated Powershell via COMPRESS OBFUSCATION"
dispatch.earliest_time = -24h@h
alert.track = 0

[Invoke-Obfuscation RUNDLL LAUNCHER - System - builtin]
description = Detects Obfuscated Powershell via RUNDLL LAUNCHER
search = index=wineventlog* ((source="WinEventLog:System" Provider_Name="Service Control Manager" EventCode="7045" ImagePath="*rundll32.exe*" ImagePath="*shell32.dll*" ImagePath="*shellexec_rundll*" ImagePath="*powershell*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1027 attack.execution attack.t1059.001" | eval sigma_title="Invoke-Obfuscation RUNDLL LAUNCHER - System" | eval sigma_description="Detects Obfuscated Powershell via RUNDLL LAUNCHER"
dispatch.earliest_time = -24h@h
alert.track = 0

[Invoke-Obfuscation Via Stdin - System - builtin]
description = Detects Obfuscated Powershell via Stdin in Scripts
search = index=wineventlog* ((source="WinEventLog:System" Provider_Name="Service Control Manager" EventCode="7045" ImagePath="*set*" ImagePath="*&&*" (ImagePath="*environment*" OR ImagePath="*invoke*" OR ImagePath="*input*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1027 attack.execution attack.t1059.001" | eval sigma_title="Invoke-Obfuscation Via Stdin - System" | eval sigma_description="Detects Obfuscated Powershell via Stdin in Scripts"
dispatch.earliest_time = -24h@h
alert.track = 0

[Invoke-Obfuscation Via Use Clip - System - builtin]
description = Detects Obfuscated Powershell via use Clip.exe in Scripts
search = index=wineventlog* ((source="WinEventLog:System" Provider_Name="Service Control Manager" EventCode="7045" ImagePath="*(Clipboard|i*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1027 attack.execution attack.t1059.001" | eval sigma_title="Invoke-Obfuscation Via Use Clip - System" | eval sigma_description="Detects Obfuscated Powershell via use Clip.exe in Scripts"
dispatch.earliest_time = -24h@h
alert.track = 0

[Invoke-Obfuscation Via Use MSHTA - System - builtin]
description = Detects Obfuscated Powershell via use MSHTA in Scripts
search = index=wineventlog* ((source="WinEventLog:System" Provider_Name="Service Control Manager" EventCode="7045" ImagePath="*mshta*" ImagePath="*vbscript:createobject*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1027 attack.execution attack.t1059.001" | eval sigma_title="Invoke-Obfuscation Via Use MSHTA - System" | eval sigma_description="Detects Obfuscated Powershell via use MSHTA in Scripts"
dispatch.earliest_time = -24h@h
alert.track = 0

[Invoke-Obfuscation Via Use Rundll32 - System - builtin]
description = Detects Obfuscated Powershell via use Rundll32 in Scripts
search = index=wineventlog* ((source="WinEventLog:System" Provider_Name="Service Control Manager" EventCode="7045" ImagePath="*&&*" ImagePath="*rundll32*" ImagePath="*shell32.dll*" ImagePath="*shellexec_rundll*" (ImagePath="*value*" OR ImagePath="*invoke*" OR ImagePath="*comspec*" OR ImagePath="*iex*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1027 attack.execution attack.t1059.001" | eval sigma_title="Invoke-Obfuscation Via Use Rundll32 - System" | eval sigma_description="Detects Obfuscated Powershell via use Rundll32 in Scripts"
dispatch.earliest_time = -24h@h
alert.track = 0

[Invoke-Obfuscation VAR++ LAUNCHER OBFUSCATION - System - builtin]
description = Detects Obfuscated Powershell via VAR++ LAUNCHER
search = index=wineventlog* ((source="WinEventLog:System" Provider_Name="Service Control Manager" EventCode="7045" ImagePath="*&&set*" ImagePath="*cmd*" ImagePath="*/c*" ImagePath="*-f*" (ImagePath="*{0}*" OR ImagePath="*{1}*" OR ImagePath="*{2}*" OR ImagePath="*{3}*" OR ImagePath="*{4}*" OR ImagePath="*{5}*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1027 attack.execution attack.t1059.001" | eval sigma_title="Invoke-Obfuscation VAR++ LAUNCHER OBFUSCATION - System" | eval sigma_description="Detects Obfuscated Powershell via VAR++ LAUNCHER"
dispatch.earliest_time = -24h@h
alert.track = 0

[KDC RC4-HMAC Downgrade CVE-2022-37966 - builtin]
description = Detects the exploitation of a security bypass and elevation of privilege vulnerability with Authentication Negotiation by using weak RC4-HMAC negotiation
search = index=wineventlog* ((source="WinEventLog:System" EventCode="42" Provider_Name="Kerberos-Key-Distribution-Center" Level="2")) | eval sigma_attack_tags="attack.privilege_escalation" | eval sigma_title="KDC RC4-HMAC Downgrade CVE-2022-37966" | eval sigma_description="Detects the exploitation of a security bypass and elevation of privilege vulnerability with Authentication Negotiation by using weak RC4-HMAC negotiation"
dispatch.earliest_time = -24h@h
alert.track = 0

[KrbRelayUp Service Installation - builtin]
description = Detects service creation from KrbRelayUp tool used for privilege escalation in windows domain environments where LDAP signing is not enforced (the default settings)
search = index=wineventlog* ((source="WinEventLog:System" EventCode="7045" ServiceName="KrbSCM")) | eval sigma_attack_tags="attack.privilege_escalation attack.t1543" | eval sigma_title="KrbRelayUp Service Installation" | eval sigma_description="Detects service creation from KrbRelayUp tool used for privilege escalation in windows domain environments where LDAP signing is not enforced (the default settings)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Local Privilege Escalation Indicator TabTip - builtin]
description = Detects the invocation of TabTip via CLSID as seen when JuicyPotatoNG is used on a system in brute force mode
search = index=wineventlog* ((source="WinEventLog:System" EventCode="10001" param1="C:\\Program Files\\Common Files\\microsoft shared\\ink\\TabTip.exe" param2="2147943140" param3="{054AAE20-4BEA-4347-8A35-64A533254A9D}")) | eval sigma_attack_tags="attack.execution attack.t1557.001" | eval sigma_title="Local Privilege Escalation Indicator TabTip" | eval sigma_description="Detects the invocation of TabTip via CLSID as seen when JuicyPotatoNG is used on a system in brute force mode"
dispatch.earliest_time = -24h@h
alert.track = 0

[NTLMv1 Logon Between Client and Server - builtin]
description = Detects the reporting of NTLMv1 being used between a client and server
search = index=wineventlog* ((source="WinEventLog:System" Provider_Name="LsaSrv" EventCode="6038")) | table EventCode,Provider_Name | eval sigma_attack_tags="attack.execution attack.t1550.002 attack.s0363" | eval sigma_title="NTLMv1 Logon Between Client and Server" | eval sigma_description="Detects the reporting of NTLMv1 being used between a client and server"
dispatch.earliest_time = -24h@h
alert.track = 0

[Credential Dumping Tools Service Execution - System - builtin]
description = Detects well-known credential dumping tools execution via service execution events
search = index=wineventlog* ((source="WinEventLog:System" Provider_Name="Service Control Manager" EventCode="7045" (ImagePath="*fgexec*" OR ImagePath="*dumpsvc*" OR ImagePath="*cachedump*" OR ImagePath="*mimidrv*" OR ImagePath="*gsecdump*" OR ImagePath="*servpw*" OR ImagePath="*pwdump*"))) | eval sigma_attack_tags="attack.credential_access attack.execution attack.t1003.001 attack.t1003.002 attack.t1003.004 attack.t1003.005 attack.t1003.006 attack.t1569.002 attack.s0005" | eval sigma_title="Credential Dumping Tools Service Execution - System" | eval sigma_description="Detects well-known credential dumping tools execution via service execution events"
dispatch.earliest_time = -24h@h
alert.track = 0

[Meterpreter or Cobalt Strike Getsystem Service Installation - System - builtin]
description = Detects the use of getsystem Meterpreter/Cobalt Strike command by detecting a specific service installation
search = index=wineventlog* ((source="WinEventLog:System" ((Provider_Name="Service Control Manager" EventCode="7045")) (((ImagePath="*cmd*" ImagePath="*/c*" ImagePath="*echo*" ImagePath="*\\pipe\\*")) OR ((ImagePath="*%COMSPEC%*" ImagePath="*/c*" ImagePath="*echo*" ImagePath="*\\pipe\\*")) OR ((ImagePath="*cmd.exe*" ImagePath="*/c*" ImagePath="*echo*" ImagePath="*\\pipe\\*")) OR ((ImagePath="*rundll32*" ImagePath="*.dll,a*" ImagePath="*/p:*")) OR ImagePath="\\\\127.0.0.1\\ADMIN$\\*"))) | table ComputerName,SubjectDomainName,SubjectUserName,ImagePath | eval sigma_attack_tags="attack.privilege_escalation attack.t1134.001 attack.t1134.002" | eval sigma_title="Meterpreter or Cobalt Strike Getsystem Service Installation - System" | eval sigma_description="Detects the use of getsystem Meterpreter/Cobalt Strike command by detecting a specific service installation"
dispatch.earliest_time = -24h@h
alert.track = 0

[Moriya Rootkit - System - builtin]
description = Detects the use of Moriya rootkit as described in the securelist's Operation TunnelSnake report
search = index=wineventlog* ((source="WinEventLog:System" Provider_Name="Service Control Manager" EventCode="7045" ServiceName="ZzNetSvc")) | eval sigma_attack_tags="attack.persistence attack.privilege_escalation attack.t1543.003" | eval sigma_title="Moriya Rootkit - System" | eval sigma_description="Detects the use of Moriya rootkit as described in the securelist's Operation TunnelSnake report"
dispatch.earliest_time = -24h@h
alert.track = 0

[NTFS Vulnerability Exploitation - builtin]
description = This the exploitation of a NTFS vulnerability as reported without many details via Twitter
search = index=wineventlog* ((source="WinEventLog:System" Provider_Name="Ntfs" EventCode="55" Origin="File System Driver" Description="*contains a corrupted file record*" Description="*The name of the file is \"\\\"*")) | eval sigma_attack_tags="attack.impact attack.t1499.001" | eval sigma_title="NTFS Vulnerability Exploitation" | eval sigma_description="This the exploitation of a NTFS vulnerability as reported without many details via Twitter"
dispatch.earliest_time = -24h@h
alert.track = 0

[Windows Pcap Drivers - builtin]
description = Detects Windows Pcap driver installation based on a list of associated .sys files.
search = index=wineventlog* ((source="WinEventLog:System" EventCode="4697" (ServiceFileName="*pcap*" OR ServiceFileName="*npcap*" OR ServiceFileName="*npf*" OR ServiceFileName="*nm3*" OR ServiceFileName="*ndiscap*" OR ServiceFileName="*nmnt*" OR ServiceFileName="*windivert*" OR ServiceFileName="*USBPcap*" OR ServiceFileName="*pktmon*"))) | table EventCode,ServiceFileName,Account_Name,Computer_Name,Originating_Computer,ServiceName | eval sigma_attack_tags="attack.discovery attack.credential_access attack.t1040" | eval sigma_title="Windows Pcap Drivers" | eval sigma_description="Detects Windows Pcap driver installation based on a list of associated .sys files."
dispatch.earliest_time = -24h@h
alert.track = 0

[Zerologon Exploitation Using Well-known Tools - builtin]
description = This rule is designed to detect attempts to exploit Zerologon (CVE-2020-1472) vulnerability using mimikatz zerologon module or other exploits from machine with 'kali' hostname.
search = index=wineventlog* ((source="WinEventLog:System" (EventCode="5805" OR EventCode="5723") ("kali" OR "mimikatz"))) | eval sigma_attack_tags="attack.t1210 attack.lateral_movement" | eval sigma_title="Zerologon Exploitation Using Well-known Tools" | eval sigma_description="This rule is designed to detect attempts to exploit Zerologon (CVE-2020-1472) vulnerability using mimikatz zerologon module or other exploits from machine with 'kali' hostname."
dispatch.earliest_time = -24h@h
alert.track = 0

[PowerShell Scripts Installed as Services - builtin]
description = Detects powershell script installed as a Service
search = index=wineventlog* ((source="WinEventLog:System" Provider_Name="Service Control Manager" EventCode="7045" (ImagePath="*powershell*" OR ImagePath="*pwsh*"))) | eval sigma_attack_tags="attack.execution attack.t1569.002" | eval sigma_title="PowerShell Scripts Installed as Services" | eval sigma_description="Detects powershell script installed as a Service"
dispatch.earliest_time = -24h@h
alert.track = 0

[QuarksPwDump Clearing Access History - builtin]
description = Detects QuarksPwDump clearing access history in hive
search = index=wineventlog* ((source="WinEventLog:System" EventCode="16" Provider_Name="Microsoft-Windows-Kernel-General" HiveName="*\\AppData\\Local\\Temp\\SAM*" HiveName="*.dmp")) | eval sigma_attack_tags="attack.credential_access attack.t1003.002" | eval sigma_title="QuarksPwDump Clearing Access History" | eval sigma_description="Detects QuarksPwDump clearing access history in hive"
dispatch.earliest_time = -24h@h
alert.track = 0

[Rare Service Installations - builtin]
description = Detects rare service installs that only appear a few times per time frame and could reveal password dumpers, backdoor installs or other types of malicious services
search = index=wineventlog* ((source="WinEventLog:System" Provider_Name="Service Control Manager" EventCode="7045")) | eventstats count as val by ServiceName| search val < 5 | eval sigma_attack_tags="attack.persistence attack.privilege_escalation car.2013-09-005 attack.t1543.003" | eval sigma_title="Rare Service Installations" | eval sigma_description="Detects rare service installs that only appear a few times per time frame and could reveal password dumpers, backdoor installs or other types of malicious services"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential RDP Exploit CVE-2019-0708 - builtin]
description = Detect suspicious error on protocol RDP, potential CVE-2019-0708
search = index=wineventlog* ((source="WinEventLog:System" (EventCode="56" OR EventCode="50") Provider_Name="TermDD")) | eval sigma_attack_tags="attack.lateral_movement attack.t1210 car.2013-07-002" | eval sigma_title="Potential RDP Exploit CVE-2019-0708" | eval sigma_description="Detect suspicious error on protocol RDP, potential CVE-2019-0708"
dispatch.earliest_time = -24h@h
alert.track = 0

[Anydesk Remote Access Software Service Installation - builtin]
description = Detects the installation of the anydesk software service. Which could be an indication of anydesk abuse if you the software isn't already used.
search = index=wineventlog* ((source="WinEventLog:System" Provider_Name="Service Control Manager" EventCode="7045" ServiceName="AnyDesk Service")) | eval sigma_attack_tags="attack.persistence" | eval sigma_title="Anydesk Remote Access Software Service Installation" | eval sigma_description="Detects the installation of the anydesk software service. Which could be an indication of anydesk abuse if you the software isn't already used."
dispatch.earliest_time = -24h@h
alert.track = 0

[Hacktool Service Registration or Execution - builtin]
description = Detects PsExec service installation and execution events (service and Sysmon)
search = index=wineventlog* ((source="WinEventLog:System" ((Provider_Name="Service Control Manager" (EventCode="7045" OR EventCode="7036"))) ((ServiceName="*WCESERVICE*" OR ServiceName="*WCE SERVICE*" OR ServiceName="*winexesvc*" OR ServiceName="*DumpSvc*" OR ServiceName="*pwdump*" OR ServiceName="*gsecdump*" OR ServiceName="*cachedump*") OR ImagePath="*bypass*"))) | eval sigma_attack_tags="attack.execution attack.t1569.002 attack.s0029" | eval sigma_title="Hacktool Service Registration or Execution" | eval sigma_description="Detects PsExec service installation and execution events (service and Sysmon)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Mesh Agent Service Installation - builtin]
description = Detects a Mesh Agent service installation. Mesh Agent is used to remotely manage computers
search = index=wineventlog* ((source="WinEventLog:System" ((Provider_Name="Service Control Manager" EventCode="7045")) (ImagePath="*MeshAgent.exe*" OR ServiceName="*Mesh Agent*"))) | eval sigma_attack_tags="attack.command_and_control attack.t1219" | eval sigma_title="Mesh Agent Service Installation" | eval sigma_description="Detects a Mesh Agent service installation. Mesh Agent is used to remotely manage computers"
dispatch.earliest_time = -24h@h
alert.track = 0

[NetSupport Manager Service Install - builtin]
description = Detects NetSupport Manager service installation on the target system.
search = index=wineventlog* ((source="WinEventLog:System" ((Provider_Name="Service Control Manager" EventCode="7045")) (ImagePath="*\\NetSupport Manager\\client32.exe*" OR ServiceName="Client32"))) | eval sigma_attack_tags="attack.persistence" | eval sigma_title="NetSupport Manager Service Install" | eval sigma_description="Detects NetSupport Manager service installation on the target system."
dispatch.earliest_time = -24h@h
alert.track = 0

[PAExec Service Installation - builtin]
description = Detects PAExec service installation
search = index=wineventlog* ((source="WinEventLog:System" ((Provider_Name="Service Control Manager" EventCode="7045")) (ServiceName="PAExec-*" OR ImagePath="C:\\WINDOWS\\PAExec-*"))) | eval sigma_attack_tags="attack.execution attack.t1569.002" | eval sigma_title="PAExec Service Installation" | eval sigma_description="Detects PAExec service installation"
dispatch.earliest_time = -24h@h
alert.track = 0

[New PDQDeploy Service - Client Side - builtin]
description = Detects PDQDeploy service installation on the target system.
When a package is deployed via PDQDeploy it installs a remote service on the target machine with the name 'PDQDeployRunner-X' where 'X' is an integer starting from 1

search = index=wineventlog* ((source="WinEventLog:System" ((Provider_Name="Service Control Manager" EventCode="7045")) (ImagePath="*PDQDeployRunner-*" OR ServiceName="PDQDeployRunner-*"))) | eval sigma_attack_tags="attack.privilege_escalation attack.t1543.003" | eval sigma_title="New PDQDeploy Service - Client Side" | eval sigma_description="Detects PDQDeploy service installation on the target system.
When a package is deployed via PDQDeploy it installs a remote service on the target machine with the name 'PDQDeployRunner-X' where 'X' is an integer starting from 1
"
dispatch.earliest_time = -24h@h
alert.track = 0

[New PDQDeploy Service - Server Side - builtin]
description = Detects a PDQDeploy service installation which indicates that PDQDeploy was installed on the machines.
PDQDeploy can be abused by attackers to remotely install packages or execute commands on target machines

search = index=wineventlog* ((source="WinEventLog:System" ((Provider_Name="Service Control Manager" EventCode="7045")) (ImagePath="*PDQDeployService.exe*" OR (ServiceName="PDQDeploy" OR ServiceName="PDQ Deploy")))) | eval sigma_attack_tags="attack.privilege_escalation attack.t1543.003" | eval sigma_title="New PDQDeploy Service - Server Side" | eval sigma_description="Detects a PDQDeploy service installation which indicates that PDQDeploy was installed on the machines.
PDQDeploy can be abused by attackers to remotely install packages or execute commands on target machines
"
dispatch.earliest_time = -24h@h
alert.track = 0

[PsExec Service Installation - builtin]
description = Detects PsExec service installation and execution events (service and Sysmon)
search = index=wineventlog* ((source="WinEventLog:System" (((Provider_Name="Service Control Manager" EventCode="7045" ServiceName="PSEXESVC" ImagePath="*\\PSEXESVC.exe")) OR ((EventCode="7036" ServiceName="PSEXESVC"))))) | table EventCode,Process_Command_Line,ParentCommandLine,ServiceName,ServiceFileName,TargetFilename,PipeName | eval sigma_attack_tags="attack.execution attack.t1569.002 attack.s0029" | eval sigma_title="PsExec Service Installation" | eval sigma_description="Detects PsExec service installation and execution events (service and Sysmon)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Remote Access Tool Services Have Been Installed - System - builtin]
description = Detects service installation of different remote access tools software. These software are often abused by threat actors to perform
search = index=wineventlog* ((source="WinEventLog:System" Provider_Name="Service Control Manager" (EventCode="7045" OR EventCode="7036") (ServiceName="*SSUService*" OR ServiceName="*SplashtopRemoteService*" OR ServiceName="*Atera*" OR ServiceName="*LogMeIn*" OR ServiceName="*LMIGuardianSvc*" OR ServiceName="*TeamViewer*" OR ServiceName="*RPCService*" OR ServiceName="*RPCPerformanceService*" OR ServiceName="*BASupportExpressStandaloneService*" OR ServiceName="*BASupportExpressSrvcUpdater*" OR ServiceName="*GoToMyPC*" OR ServiceName="*monblanking*" OR ServiceName="*RManService*" OR ServiceName="*GoToAssist*" OR ServiceName="*AmmyyAdmin*" OR ServiceName="*vncserver*" OR ServiceName="*Parsec*" OR ServiceName="*chromoting*" OR ServiceName="*Zoho*" OR ServiceName="*jumpcloud*"))) | eval sigma_attack_tags="attack.persistence attack.t1543.003 attack.t1569.002" | eval sigma_title="Remote Access Tool Services Have Been Installed - System" | eval sigma_description="Detects service installation of different remote access tools software. These software are often abused by threat actors to perform"
dispatch.earliest_time = -24h@h
alert.track = 0

[Remote Utilities Host Service Install - builtin]
description = Detects Remote Utilities Host service installation on the target system.
search = index=wineventlog* ((source="WinEventLog:System" ((Provider_Name="Service Control Manager" EventCode="7045")) (((ImagePath="*\\rutserv.exe*" ImagePath="*-service*")) OR ServiceName="Remote Utilities - Host"))) | eval sigma_attack_tags="attack.persistence" | eval sigma_title="Remote Utilities Host Service Install" | eval sigma_description="Detects Remote Utilities Host service installation on the target system."
dispatch.earliest_time = -24h@h
alert.track = 0

[New Service Uses Double Ampersand in Path - builtin]
description = Detects a service installation that uses a suspicious double ampersand used in the image path value
search = index=wineventlog* ((source="WinEventLog:System" Provider_Name="Service Control Manager" EventCode="7045" ImagePath="*&&*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1027" | eval sigma_title="New Service Uses Double Ampersand in Path" | eval sigma_description="Detects a service installation that uses a suspicious double ampersand used in the image path value"
dispatch.earliest_time = -24h@h
alert.track = 0

[TacticalRMM Service Installation - builtin]
description = Detects a TacticalRMM service installation. Tactical RMM is a remote monitoring & management tool.
search = index=wineventlog* ((source="WinEventLog:System" ((Provider_Name="Service Control Manager" EventCode="7045")) (ImagePath="*tacticalrmm.exe*" OR ServiceName="*TacticalRMM Agent Service*"))) | eval sigma_attack_tags="attack.command_and_control attack.t1219" | eval sigma_title="TacticalRMM Service Installation" | eval sigma_description="Detects a TacticalRMM service installation. Tactical RMM is a remote monitoring & management tool."
dispatch.earliest_time = -24h@h
alert.track = 0

[DHCP Server Error Failed Loading the CallOut DLL - builtin]
description = This rule detects a DHCP server error in which a specified Callout DLL (in registry) could not be loaded
search = index=wineventlog* ((source="WinEventLog:System" (EventCode="1031" OR EventCode="1032" OR EventCode="1034") Provider_Name="Microsoft-Windows-DHCP-Server")) | eval sigma_attack_tags="attack.defense_evasion attack.t1574.002" | eval sigma_title="DHCP Server Error Failed Loading the CallOut DLL" | eval sigma_description="This rule detects a DHCP server error in which a specified Callout DLL (in registry) could not be loaded"
dispatch.earliest_time = -24h@h
alert.track = 0

[DHCP Server Loaded the CallOut DLL - builtin]
description = This rule detects a DHCP server in which a specified Callout DLL (in registry) was loaded
search = index=wineventlog* ((source="WinEventLog:System" EventCode="1033" Provider_Name="Microsoft-Windows-DHCP-Server")) | eval sigma_attack_tags="attack.defense_evasion attack.t1574.002" | eval sigma_title="DHCP Server Loaded the CallOut DLL" | eval sigma_description="This rule detects a DHCP server in which a specified Callout DLL (in registry) was loaded"
dispatch.earliest_time = -24h@h
alert.track = 0

[Important Windows Eventlog Cleared - builtin]
description = Detects the clearing of one of the Windows Core Eventlogs. e.g. caused by 'wevtutil cl' command execution
search = index=wineventlog* ((source="WinEventLog:System" EventCode="104" Provider_Name="Microsoft-Windows-Eventlog" (Channel="System" OR Channel="Security" OR Channel="Application"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1070.001 car.2016-04-002" | eval sigma_title="Important Windows Eventlog Cleared" | eval sigma_description="Detects the clearing of one of the Windows Core Eventlogs. e.g. caused by 'wevtutil cl' command execution"
dispatch.earliest_time = -24h@h
alert.track = 0

[ProcessHacker Privilege Elevation - builtin]
description = Detects a ProcessHacker tool that elevated privileges to a very high level
search = index=wineventlog* ((source="WinEventLog:System" Provider_Name="Service Control Manager" EventCode="7045" ServiceName="ProcessHacker*" AccountName="LocalSystem")) | eval sigma_attack_tags="attack.execution attack.privilege_escalation attack.t1543.003 attack.t1569.002" | eval sigma_title="ProcessHacker Privilege Elevation" | eval sigma_description="Detects a ProcessHacker tool that elevated privileges to a very high level"
dispatch.earliest_time = -24h@h
alert.track = 0

[RTCore Suspicious Service Installation - builtin]
description = Detects the installation of RTCore service. Which could be an indication of Micro-Star MSI Afterburner vulnerable driver abuse
search = index=wineventlog* ((source="WinEventLog:System" Provider_Name="Service Control Manager" EventCode="7045" ServiceName="RTCore64")) | eval sigma_attack_tags="attack.persistence" | eval sigma_title="RTCore Suspicious Service Installation" | eval sigma_description="Detects the installation of RTCore service. Which could be an indication of Micro-Star MSI Afterburner vulnerable driver abuse"
dispatch.earliest_time = -24h@h
alert.track = 0

[SAM Dump to AppData - builtin]
description = Detects suspicious SAM dump activity as cause by QuarksPwDump and other password dumpers
search = index=wineventlog* ((source="WinEventLog:System" Provider_Name="Microsoft-Windows-Kernel-General" EventCode="16" "\\AppData\\Local\\Temp\\SAM-" ".dmp")) | eval sigma_attack_tags="attack.credential_access attack.t1003.002" | eval sigma_title="SAM Dump to AppData" | eval sigma_description="Detects suspicious SAM dump activity as cause by QuarksPwDump and other password dumpers"
dispatch.earliest_time = -24h@h
alert.track = 0

[Service Installation in Suspicious Folder - builtin]
description = Detects service installation in suspicious folder appdata
search = index=wineventlog* ((source="WinEventLog:System" ((Provider_Name="Service Control Manager" EventCode="7045" (ImagePath="*\\AppData\\*" OR ImagePath="*\\\\127.0.0.1*" OR ImagePath="*\\\\localhost*"))) NOT (((ServiceName="Zoom Sharing Service" ImagePath="\"C:\\Program Files\\Common Files\\Zoom\\Support\\CptService.exe*"))))) | eval sigma_attack_tags="attack.persistence attack.privilege_escalation car.2013-09-005 attack.t1543.003" | eval sigma_title="Service Installation in Suspicious Folder" | eval sigma_description="Detects service installation in suspicious folder appdata"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Service Installation Script - builtin]
description = Detects suspicious service installation scripts
search = index=wineventlog* ((source="WinEventLog:System" Provider_Name="Service Control Manager" EventCode="7045" (ImagePath="* /c *" OR ImagePath="* /r *" OR ImagePath="* /k *") (ImagePath="*powershell*" OR ImagePath="*pwsh*" OR ImagePath="*wscript*" OR ImagePath="*cscript*" OR ImagePath="*mshta*" OR ImagePath="*rundll32*" OR ImagePath="*regsvr32*"))) | eval sigma_attack_tags="attack.persistence attack.privilege_escalation car.2013-09-005 attack.t1543.003" | eval sigma_title="Suspicious Service Installation Script" | eval sigma_description="Detects suspicious service installation scripts"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Service Installation - builtin]
description = Detects suspicious service installation commands
search = index=wineventlog* ((source="WinEventLog:System" ((((Provider_Name="Service Control Manager" EventCode="7045")) ((ImagePath="* -w hidden *" OR ImagePath="* -nop *" OR ImagePath="* -sta *" OR ImagePath="*\\Users\\Public\\*" OR ImagePath="*\\Windows\\Temp\\*" OR ImagePath="*\\Perflogs\\*" OR ImagePath="*\\\\.\\pipe*" OR ImagePath="*\\ADMIN$\\*" OR ImagePath="*C:\\Temp\\*" OR ImagePath="*.downloadstring(*" OR ImagePath="*.downloadfile(*") OR ((ImagePath="* -e*" (ImagePath="* JAB*" OR ImagePath="* SUVYI*" OR ImagePath="* SQBFAFgA*" OR ImagePath="* aWV4I*" OR ImagePath="* IAB*" OR ImagePath="* PAA*" OR ImagePath="* aQBlAHgA*")))))) NOT (((ImagePath="C:\\WINDOWS\\TEMP\\thor10-remote\\thor64.exe*")) OR ((ImagePath="C:\\ProgramData\\Microsoft\\Windows Defender\\Definition Updates\\*"))))) | eval sigma_attack_tags="attack.persistence attack.privilege_escalation car.2013-09-005 attack.t1543.003" | eval sigma_title="Suspicious Service Installation" | eval sigma_description="Detects suspicious service installation commands"
dispatch.earliest_time = -24h@h
alert.track = 0

[Windows Update Error - builtin]
description = Windows Update get some error Check if need a 0-days KB
search = index=wineventlog* ((source="WinEventLog:System" Provider_Name="Microsoft-Windows-WindowsUpdateClient" (EventCode="16" OR EventCode="20" OR EventCode="24" OR EventCode="213" OR EventCode="217"))) | eval sigma_attack_tags="attack.impact attack.resource_development attack.t1584" | eval sigma_title="Windows Update Error" | eval sigma_description="Windows Update get some error Check if need a 0-days KB"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Usage of CVE_2021_34484 or CVE 2022_21919 - builtin]
description = During exploitation of this vuln, two logs (providername:Microsoft-Windows-User Profiles Service) with eventid 1511 and 1515 (maybe lot of false positives with this event) are created. Moreover, it appears the directory \Users\TEMP is created may be created during the exploitation.Viewed on 2008 Server
search = index=wineventlog* ((source="WinEventLog:Application" EventCode="1511" Provider_Name="Microsoft-Windows-User Profiles Service")) | eval sigma_attack_tags="attack.execution" | eval sigma_title="Suspicious Usage of CVE_2021_34484 or CVE 2022_21919" | eval sigma_description="During exploitation of this vuln, two logs (providername:Microsoft-Windows-User Profiles Service) with eventid 1511 and 1515 (maybe lot of false positives with this event) are created. Moreover, it appears the directory \Users\TEMP is created may be created during the exploitation.Viewed on 2008 Server"
dispatch.earliest_time = -24h@h
alert.track = 0

[Service Installed By Unusual Client - System - builtin]
description = Detects a service installed by a client which has PID 0 or whose parent has PID 0
search = index=wineventlog* ((source="WinEventLog:System" Provider_Name="Service Control Manager" EventCode="7045" ProcessId="0")) | eval sigma_attack_tags="attack.privilege_escalation attack.t1543" | eval sigma_title="Service Installed By Unusual Client - System" | eval sigma_description="Detects a service installed by a client which has PID 0 or whose parent has PID 0"
dispatch.earliest_time = -24h@h
alert.track = 0

[Tap Driver Installation - builtin]
description = Well-known TAP software installation. Possible preparation for data exfiltration using tunnelling techniques
search = index=wineventlog* ((source="WinEventLog:System" Provider_Name="Service Control Manager" EventCode="7045" ImagePath="*tap0901*")) | eval sigma_attack_tags="attack.exfiltration attack.t1048" | eval sigma_title="Tap Driver Installation" | eval sigma_description="Well-known TAP software installation. Possible preparation for data exfiltration using tunnelling techniques"
dispatch.earliest_time = -24h@h
alert.track = 0

[Volume Shadow Copy Mount - builtin]
description = Detects volume shadow copy mount via windows event log
search = index=wineventlog* ((source="WinEventLog:System" Provider_Name="Microsoft-Windows-Ntfs" EventCode="98" DeviceName="*HarddiskVolumeShadowCopy*")) | eval sigma_attack_tags="attack.credential_access attack.t1003.002" | eval sigma_title="Volume Shadow Copy Mount" | eval sigma_description="Detects volume shadow copy mount via windows event log"
dispatch.earliest_time = -24h@h
alert.track = 0

[Vulnerable Netlogon Secure Channel Connection Allowed - builtin]
description = Detects that a vulnerable Netlogon secure channel connection was allowed, which could be an indicator of CVE-2020-1472.
search = index=wineventlog* ((source="WinEventLog:System" Provider_Name="NetLogon" EventCode="5829")) | table SAMAccountName | eval sigma_attack_tags="attack.privilege_escalation attack.t1548" | eval sigma_title="Vulnerable Netlogon Secure Channel Connection Allowed" | eval sigma_description="Detects that a vulnerable Netlogon secure channel connection was allowed, which could be an indicator of CVE-2020-1472."
dispatch.earliest_time = -24h@h
alert.track = 0

[Exploit SamAccountName Spoofing with Kerberos - builtin]
description = The attacker creates a computer object using those permissions with a password known to her.
After that she clears the attribute ServicePrincipalName on the computer object.
Because she created the object (CREATOR OWNER), she gets granted additional permissions and can do many changes to the object.

search = index=wineventlog* ((source="WinEventLog:System" (((Provider_Name="Microsoft-Windows-Kerberos-Key-Distribution-Center" (EventCode="35" OR EventCode="36" OR EventCode="37" OR EventCode="38"))) OR ((Provider_Name="Microsoft-Windows-Directory-Services-SAM" (EventCode="16990" OR EventCode="16991")))))) | table samAccountName | eval sigma_attack_tags="attack.credential_access attack.t1558.003" | eval sigma_title="Exploit SamAccountName Spoofing with Kerberos" | eval sigma_description="The attacker creates a computer object using those permissions with a password known to her.
After that she clears the attribute ServicePrincipalName on the computer object.
Because she created the object (CREATOR OWNER), she gets granted additional permissions and can do many changes to the object.
"
dispatch.earliest_time = -24h@h
alert.track = 0

[LSASS Access Detected via Attack Surface Reduction - builtin]
description = Detects Access to LSASS Process
search = index=wineventlog* ((source="WinEventLog:Microsoft-Windows-Windows Defender/Operational" ((EventCode="1121" Path="*\\lsass.exe")) NOT (((ProcessName="C:\\Windows\\Temp\\asgard2-agent\\*" (ProcessName="*\\thor64.exe" OR ProcessName="*\\thor.exe"))) OR (((ProcessName="C:\\Windows\\System32\\atiesrxx.exe" OR ProcessName="C:\\Windows\\System32\\CompatTelRunner.exe" OR ProcessName="C:\\Windows\\System32\\msiexec.exe" OR ProcessName="C:\\Windows\\System32\\nvwmi64.exe" OR ProcessName="C:\\Windows\\System32\\svchost.exe" OR ProcessName="C:\\Windows\\System32\\Taskmgr.exe" OR ProcessName="C:\\Windows\\System32\\wbem\\WmiPrvSE.exe" OR ProcessName="C:\\Windows\\SysWOW64\\msiexec.exe"))) OR (((ProcessName="C:\\Windows\\System32\\DriverStore\\*" OR ProcessName="C:\\WINDOWS\\Installer\\*" OR ProcessName="C:\\Program Files\\*" OR ProcessName="C:\\Program Files (x86)\\*")))))) | eval sigma_attack_tags="attack.credential_access attack.t1003.001" | eval sigma_title="LSASS Access Detected via Attack Surface Reduction" | eval sigma_description="Detects Access to LSASS Process"
dispatch.earliest_time = -24h@h
alert.track = 0

[Windows Defender AMSI Trigger Detected - builtin]
description = Detects triggering of AMSI by Windows Defender.
search = index=wineventlog* ((source="WinEventLog:Microsoft-Windows-Windows Defender/Operational" EventCode="1116" SourceName="AMSI")) | eval sigma_attack_tags="attack.execution attack.t1059" | eval sigma_title="Windows Defender AMSI Trigger Detected" | eval sigma_description="Detects triggering of AMSI by Windows Defender."
dispatch.earliest_time = -24h@h
alert.track = 0

[Windows Defender Threat Detection Disabled - builtin]
description = Detects disabling Windows Defender threat protection
search = index=wineventlog* ((source="WinEventLog:Microsoft-Windows-Windows Defender/Operational" (EventCode="5001" OR EventCode="5010" OR EventCode="5012" OR EventCode="5101"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.001" | eval sigma_title="Windows Defender Threat Detection Disabled" | eval sigma_description="Detects disabling Windows Defender threat protection"
dispatch.earliest_time = -24h@h
alert.track = 0

[Windows Defender Exclusions Added - builtin]
description = Detects the Setting of Windows Defender Exclusions
search = index=wineventlog* ((source="WinEventLog:Microsoft-Windows-Windows Defender/Operational" EventCode="5007" NewValue="*\\Microsoft\\Windows Defender\\Exclusions*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.001" | eval sigma_title="Windows Defender Exclusions Added" | eval sigma_description="Detects the Setting of Windows Defender Exclusions"
dispatch.earliest_time = -24h@h
alert.track = 0

[Windows Defender Exploit Guard Tamper - builtin]
description = Detects when someone is adding or removing applications or folder from exploit guard 'ProtectedFolders' and 'AllowedApplications'
search = index=wineventlog* ((source="WinEventLog:Microsoft-Windows-Windows Defender/Operational" (((EventCode="5007" NewValue="*\\Windows Defender\\Windows Defender Exploit Guard\\Controlled Folder Access\\AllowedApplications\\*" (NewValue="*\\Users\\Public\\*" OR NewValue="*\\AppData\\Local\\Temp\\*" OR NewValue="*\\Desktop\\*" OR NewValue="*\\PerfLogs\\*" OR NewValue="*\\Windows\\Temp\\*"))) OR ((EventCode="5007" OldValue="*\\Windows Defender\\Windows Defender Exploit Guard\\Controlled Folder Access\\ProtectedFolders\\*"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.001" | eval sigma_title="Windows Defender Exploit Guard Tamper" | eval sigma_description="Detects when someone is adding or removing applications or folder from exploit guard 'ProtectedFolders' and 'AllowedApplications'"
dispatch.earliest_time = -24h@h
alert.track = 0

[Windows Defender Malware Detection History Deletion - builtin]
description = Windows Defender logs when the history of detected infections is deleted. Log file will contain the message 'Windows Defender Antivirus has removed history of malware and other potentially unwanted software'.
search = index=wineventlog* ((source="WinEventLog:Microsoft-Windows-Windows Defender/Operational" EventCode="1013")) | table EventCode,EventType | eval sigma_attack_tags="attack.defense_evasion" | eval sigma_title="Windows Defender Malware Detection History Deletion" | eval sigma_description="Windows Defender logs when the history of detected infections is deleted. Log file will contain the message 'Windows Defender Antivirus has removed history of malware and other potentially unwanted software'."
dispatch.earliest_time = -24h@h
alert.track = 0

[PSExec and WMI Process Creations Block - builtin]
description = Detects blocking of process creations originating from PSExec and WMI commands
search = index=wineventlog* ((source="WinEventLog:Microsoft-Windows-Windows Defender/Operational" EventCode="1121" (ProcessName="*\\wmiprvse.exe" OR ProcessName="*\\psexesvc.exe"))) | eval sigma_attack_tags="attack.execution attack.lateral_movement attack.t1047 attack.t1569.002" | eval sigma_title="PSExec and WMI Process Creations Block" | eval sigma_description="Detects blocking of process creations originating from PSExec and WMI commands"
dispatch.earliest_time = -24h@h
alert.track = 0

[Win Defender Restored Quarantine File - builtin]
description = Detects the restoration of files from the defender quarantine
search = index=wineventlog* ((source="WinEventLog:Microsoft-Windows-Windows Defender/Operational" EventCode="1009")) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.001" | eval sigma_title="Win Defender Restored Quarantine File" | eval sigma_description="Detects the restoration of files from the defender quarantine"
dispatch.earliest_time = -24h@h
alert.track = 0

[Windows Defender Suspicious Configuration Changes - builtin]
description = Detects suspicious changes to the windows defender configuration
search = index=wineventlog* ((source="WinEventLog:Microsoft-Windows-Windows Defender/Operational" EventCode="5007" (NewValue="*\\Windows Defender\\DisableAntiSpyware *" OR NewValue="*\\Windows Defender\\Scan\\DisableRemovableDriveScanning *" OR NewValue="*\\Windows Defender\\Scan\\DisableScanningMappedNetworkDrivesForFullScan *" OR NewValue="*\\Windows Defender\\SpyNet\\DisableBlockAtFirstSeen *" OR NewValue="*\\Real-Time Protection\\SpyNetReporting *" OR NewValue="*\\Real-Time Protection\\SubmitSamplesConsent *"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.001" | eval sigma_title="Windows Defender Suspicious Configuration Changes" | eval sigma_description="Detects suspicious changes to the windows defender configuration"
dispatch.earliest_time = -24h@h
alert.track = 0

[Microsoft Defender Tamper Protection Trigger - builtin]
description = Detects blocked attempts to change any of Defender's settings such as 'Real Time Monitoring' and 'Behavior Monitoring'
search = index=wineventlog* ((source="WinEventLog:Microsoft-Windows-Windows Defender/Operational" EventCode="5013" (Value="*\\Windows Defender\\DisableAntiSpyware" OR Value="*\\Windows Defender\\DisableAntiVirus" OR Value="*\\Windows Defender\\Scan\\DisableArchiveScanning" OR Value="*\\Windows Defender\\Scan\\DisableScanningNetworkFiles" OR Value="*\\Real-Time Protection\\DisableRealtimeMonitoring" OR Value="*\\Real-Time Protection\\DisableBehaviorMonitoring" OR Value="*\\Real-Time Protection\\DisableIOAVProtection" OR Value="*\\Real-Time Protection\\DisableScriptScanning"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.001" | eval sigma_title="Microsoft Defender Tamper Protection Trigger" | eval sigma_description="Detects blocked attempts to change any of Defender's settings such as 'Real Time Monitoring' and 'Behavior Monitoring'"
dispatch.earliest_time = -24h@h
alert.track = 0

[Windows Defender Threat Detected - builtin]
description = Detects all actions taken by Windows Defender malware detection engines
search = index=wineventlog* ((source="WinEventLog:Microsoft-Windows-Windows Defender/Operational" (EventCode="1006" OR EventCode="1116" OR EventCode="1015" OR EventCode="1117"))) | eval sigma_attack_tags="attack.execution attack.t1059" | eval sigma_title="Windows Defender Threat Detected" | eval sigma_description="Detects all actions taken by Windows Defender malware detection engines"
dispatch.earliest_time = -24h@h
alert.track = 0

[Audit CVE Event - builtin]
description = Detects events generated by user-mode applications when they call the CveEventWrite API when a known vulnerability is trying to be exploited.
MS started using this log in Jan. 2020 with CVE-2020-0601 (a Windows CryptoAPI vulnerability.
Unfortunately, that is about the only instance of CVEs being written to this log.

search = index=wineventlog* ((source="WinEventLog:Application" (Provider_Name="Microsoft-Windows-Audit-CVE" OR Provider_Name="Audit-CVE") EventCode="1")) | eval sigma_attack_tags="attack.execution attack.t1203 attack.privilege_escalation attack.t1068 attack.defense_evasion attack.t1211 attack.credential_access attack.t1212 attack.lateral_movement attack.t1210 attack.impact attack.t1499.004" | eval sigma_title="Audit CVE Event" | eval sigma_description="Detects events generated by user-mode applications when they call the CveEventWrite API when a known vulnerability is trying to be exploited.
MS started using this log in Jan. 2020 with CVE-2020-0601 (a Windows CryptoAPI vulnerability.
Unfortunately, that is about the only instance of CVEs being written to this log.
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Relevant Anti-Virus Event - builtin]
description = This detection method points out highly relevant Antivirus events
search = index=wineventlog* ((source="WinEventLog:Application" ("HTool-" OR "Hacktool" OR "ASP/Backdoor" OR "JSP/Backdoor" OR "PHP/Backdoor" OR "Backdoor.ASP" OR "Backdoor.JSP" OR "Backdoor.PHP" OR "Webshell" OR "Portscan" OR "Mimikatz" OR ".WinCred." OR "PlugX" OR "Korplug" OR "Pwdump" OR "Chopper" OR "WmiExec" OR "Xscan" OR "Clearlog" OR "ASPXSpy" OR "Ransom" OR "Filecoder" OR "CobaltStr" OR "PWCrack" OR "DumpCreds" OR "MPreter" OR "Koadic" OR "Packed.Generic.347" OR "COBEACON" OR "Cometer" OR "Keylogger" OR "MeteTool") NOT (("Keygen" OR "Crack" OR "anti_ransomware_service.exe" OR "cyber-protect-service.exe") OR ((Level="4"))))) | eval sigma_attack_tags="attack.resource_development attack.t1588" | eval sigma_title="Relevant Anti-Virus Event" | eval sigma_description="This detection method points out highly relevant Antivirus events"
dispatch.earliest_time = -24h@h
alert.track = 0

[Application Uninstalled - builtin]
description = An application has been removed. Check if it is critical.
search = index=wineventlog* ((source="WinEventLog:Application" Provider_Name="MsiInstaller" (EventCode="11724" OR EventCode="1034"))) | eval sigma_attack_tags="attack.impact attack.t1489" | eval sigma_title="Application Uninstalled" | eval sigma_description="An application has been removed. Check if it is critical."
dispatch.earliest_time = -24h@h
alert.track = 0

[Dump Ntds.dit To Suspicious Location - builtin]
description = Detects potential abuse of ntdsutil to dump ntds.dit database to a suspicious location
search = index=wineventlog* ((source="WinEventLog:Application" Provider_Name="ESENT" EventCode="325" Data="*ntds.dit*" (Data="*\\Users\\Public\\*" OR Data="*\\Perflogs\\*" OR Data="*\\Temp\\*" OR Data="*\\Appdata\\*" OR Data="*\\Desktop\\*" OR Data="*\\Downloads\\*" OR Data="*C:\\ntds.dit*"))) | eval sigma_attack_tags="attack.execution" | eval sigma_title="Dump Ntds.dit To Suspicious Location" | eval sigma_description="Detects potential abuse of ntdsutil to dump ntds.dit database to a suspicious location"
dispatch.earliest_time = -24h@h
alert.track = 0

[Ntdsutil Abuse - builtin]
description = Detects potential abuse of ntdsutil to dump ntds.dit database
search = index=wineventlog* ((source="WinEventLog:Application" Provider_Name="ESENT" (EventCode="216" OR EventCode="325" OR EventCode="326" OR EventCode="327") Data="*ntds.dit*")) | eval sigma_attack_tags="attack.execution" | eval sigma_title="Ntdsutil Abuse" | eval sigma_description="Detects potential abuse of ntdsutil to dump ntds.dit database"
dispatch.earliest_time = -24h@h
alert.track = 0

[MSI Installation From Suspicious Locations - builtin]
description = Detects MSI package installation from suspicious locations
search = index=wineventlog* ((source="WinEventLog:Application" ((Provider_Name="MsiInstaller" (EventCode="1040" OR EventCode="1042") (Data="*\\Users\\Public\\*" OR Data="*\\PerfLogs\\*" OR Data="*\\Desktop\\*" OR Data="*C:\\Windows\\TEMP\\*" OR Data="*\\\\\*"))) NOT (((Data="*\\AppData\\Local\\Temp\\WinGet\\*")) OR ((Data="*C:\\Windows\\TEMP\\UpdHealthTools.msi*"))))) | eval sigma_attack_tags="attack.execution" | eval sigma_title="MSI Installation From Suspicious Locations" | eval sigma_description="Detects MSI package installation from suspicious locations"
dispatch.earliest_time = -24h@h
alert.track = 0

[MSI Installation From Web - builtin]
description = Detects installation of a remote msi file from web.
search = index=wineventlog* ((source="WinEventLog:Application" Provider_Name="MsiInstaller" (EventCode="1040" OR EventCode="1042") Data="*://*")) | eval sigma_attack_tags="attack.execution attack.t1218 attack.t1218.007" | eval sigma_title="MSI Installation From Web" | eval sigma_description="Detects installation of a remote msi file from web."
dispatch.earliest_time = -24h@h
alert.track = 0

[MSSQL Add Account To Sysadmin Role - builtin]
description = Detects when an attacker tries to backdoor the MSSQL server by adding a backdoor account to the sysadmin fixed server role
search = index=wineventlog* ((source="WinEventLog:Application" Provider_Name="MSSQLSERVER" EventCode="33205" Data="*object_name:sysadmin*" Data="*statement:alter server role [sysadmin] add member *")) | eval sigma_attack_tags="attack.persistence" | eval sigma_title="MSSQL Add Account To Sysadmin Role" | eval sigma_description="Detects when an attacker tries to backdoor the MSSQL server by adding a backdoor account to the sysadmin fixed server role"
dispatch.earliest_time = -24h@h
alert.track = 0

[MSSQL Disable Audit Settings - builtin]
description = Detects when an attacker calls the 'ALTER SERVER AUDIT' or 'DROP SERVER AUDIT' transaction in order to delete or disable audit logs on the server
search = index=wineventlog* ((source="WinEventLog:Application" Provider_Name="MSSQLSERVER" EventCode="33205" (Data="*statement:ALTER SERVER AUDIT*" OR Data="*statement:DROP SERVER AUDIT*"))) | eval sigma_attack_tags="attack.defense_evasion" | eval sigma_title="MSSQL Disable Audit Settings" | eval sigma_description="Detects when an attacker calls the 'ALTER SERVER AUDIT' or 'DROP SERVER AUDIT' transaction in order to delete or disable audit logs on the server"
dispatch.earliest_time = -24h@h
alert.track = 0

[MSSQL Extended Stored Procedure Backdoor Maggie - builtin]
description = This rule detects the execution of the extended storage procedure backdoor named Maggie in the context of Microsoft SQL server
search = index=wineventlog* ((source="WinEventLog:Application" Provider_Name="MSSQLSERVER" EventCode="8128" Message="*maggie*")) | eval sigma_attack_tags="attack.persistence attack.t1546" | eval sigma_title="MSSQL Extended Stored Procedure Backdoor Maggie" | eval sigma_description="This rule detects the execution of the extended storage procedure backdoor named Maggie in the context of Microsoft SQL server"
dispatch.earliest_time = -24h@h
alert.track = 0

[MSSQL SPProcoption Set - builtin]
description = Detects when the a stored procedure is set or cleared for automatic execution in MSSQL. A stored procedure that is set to automatic execution runs every time an instance of SQL Server is started
search = index=wineventlog* ((source="WinEventLog:Application" Provider_Name="MSSQLSERVER" EventCode="33205" Data="*object_name:sp_procoption*" Data="*statement:EXEC*")) | eval sigma_attack_tags="attack.persistence" | eval sigma_title="MSSQL SPProcoption Set" | eval sigma_description="Detects when the a stored procedure is set or cleared for automatic execution in MSSQL. A stored procedure that is set to automatic execution runs every time an instance of SQL Server is started"
dispatch.earliest_time = -24h@h
alert.track = 0

[MSSQL XPCmdshell Suspicious Execution - builtin]
description = Detects when the MSSQL 'xp_cmdshell' stored procedure is used to execute commands
search = index=wineventlog* ((source="WinEventLog:Application" Provider_Name="MSSQLSERVER" EventCode="33205" Data="*object_name:xp_cmdshell*" Data="*statement:EXEC*")) | eval sigma_attack_tags="attack.execution" | eval sigma_title="MSSQL XPCmdshell Suspicious Execution" | eval sigma_description="Detects when the MSSQL 'xp_cmdshell' stored procedure is used to execute commands"
dispatch.earliest_time = -24h@h
alert.track = 0

[MSSQL XPCmdshell Option Change - builtin]
description = Detects when the MSSQL 'xp_cmdshell' stored procedure setting is changed
search = index=wineventlog* ((source="WinEventLog:Application" Provider_Name="MSSQLSERVER" EventCode="15457" Data="*xp_cmdshell*")) | eval sigma_attack_tags="attack.execution" | eval sigma_title="MSSQL XPCmdshell Option Change" | eval sigma_description="Detects when the MSSQL 'xp_cmdshell' stored procedure setting is changed"
dispatch.earliest_time = -24h@h
alert.track = 0

[Atera Agent Installation - builtin]
description = Detects successful installation of Atera Remote Monitoring & Management (RMM) agent as recently found to be used by Conti operators
search = index=wineventlog* ((source="WinEventLog:Application" EventCode="1033" Provider_Name="MsiInstaller" Message="*AteraAgent*")) | eval sigma_attack_tags="attack.t1219" | eval sigma_title="Atera Agent Installation" | eval sigma_description="Detects successful installation of Atera Remote Monitoring & Management (RMM) agent as recently found to be used by Conti operators"
dispatch.earliest_time = -24h@h
alert.track = 0

[Restricted Software Access By SRP - builtin]
description = Detects restricted access to applications by the Software Restriction Policies (SRP) policy
search = index=wineventlog* ((source="WinEventLog:Application" Provider_Name="Microsoft-Windows-SoftwareRestrictionPolicies" (EventCode="865" OR EventCode="866" OR EventCode="867" OR EventCode="868" OR EventCode="882"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1072" | eval sigma_title="Restricted Software Access By SRP" | eval sigma_description="Detects restricted access to applications by the Software Restriction Policies (SRP) policy"
dispatch.earliest_time = -24h@h
alert.track = 0

[Backup Catalog Deleted - builtin]
description = Detects backup catalog deletions
search = index=wineventlog* ((source="WinEventLog:Application" EventCode="524" Provider_Name="Microsoft-Windows-Backup")) | eval sigma_attack_tags="attack.defense_evasion attack.t1070.004" | eval sigma_title="Backup Catalog Deleted" | eval sigma_description="Detects backup catalog deletions"
dispatch.earliest_time = -24h@h
alert.track = 0

[Microsoft Malware Protection Engine Crash - builtin]
description = This rule detects a suspicious crash of the Microsoft Malware Protection Engine
search = index=wineventlog* ((source="WinEventLog:Application" (((Provider_Name="Application Error" EventCode="1000")) OR ((Provider_Name="Windows Error Reporting" EventCode="1001"))) ((Data="*MsMpEng.exe*" Data="*mpengine.dll*")))) | eval sigma_attack_tags="attack.defense_evasion attack.t1211 attack.t1562.001" | eval sigma_title="Microsoft Malware Protection Engine Crash" | eval sigma_description="This rule detects a suspicious crash of the Microsoft Malware Protection Engine"
dispatch.earliest_time = -24h@h
alert.track = 0

[CVE-2020-0688 Exploitation via Eventlog - builtin]
description = Detects the exploitation of Microsoft Exchange vulnerability as described in CVE-2020-0688
search = index=wineventlog* ((source="WinEventLog:Application" ((EventCode="4" Provider_Name="MSExchange Control Panel" Level="Error")) "&__VIEWSTATE=")) | eval sigma_attack_tags="attack.initial_access attack.t1190" | eval sigma_title="CVE-2020-0688 Exploitation via Eventlog" | eval sigma_description="Detects the exploitation of Microsoft Exchange vulnerability as described in CVE-2020-0688"
dispatch.earliest_time = -24h@h
alert.track = 0

[LPE InstallerFileTakeOver PoC CVE-2021-41379 - builtin]
description = Detects PoC tool used to exploit LPE vulnerability CVE-2021-41379
search = index=wineventlog* ((source="WinEventLog:Application" EventCode="1033" Provider_Name="MsiInstaller" Data="*test pkg*")) | eval sigma_attack_tags="attack.initial_access attack.t1190" | eval sigma_title="LPE InstallerFileTakeOver PoC CVE-2021-41379" | eval sigma_description="Detects PoC tool used to exploit LPE vulnerability CVE-2021-41379"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential Credential Dumping Via WER - Application - builtin]
description = Detects windows error reporting event where the process that crashed is lsass. This could be the cause of an intentional crash by techniques such as Lsass-Shtinkering to dump credential
search = index=wineventlog* ((source="WinEventLog:Application" Provider_Name="Application Error" EventCode="1000" AppName="lsass.exe" ExceptionCode="c0000001")) | eval sigma_attack_tags="attack.credential_access attack.t1003.001" | eval sigma_title="Potential Credential Dumping Via WER - Application" | eval sigma_description="Detects windows error reporting event where the process that crashed is lsass. This could be the cause of an intentional crash by techniques such as Lsass-Shtinkering to dump credential"
dispatch.earliest_time = -24h@h
alert.track = 0

[Code Integrity Attempted DLL Load - builtin]
description = Detects attempted DLL load events that didn't meet anti-malware or Windows signing level requirements. It often means the file's signature is revoked or expired
search = index=wineventlog* ((source="WinEventLog:Microsoft-Windows-CodeIntegrity/Operational" EventCode="3033" NOT (((FileNameBuffer="*\\Program Files\\DTrace\\dtrace.dll" ProcessNameBuffer="*\\Windows\\System32\\svchost.exe" RequestedPolicy="12" ValidatedPolicy="1")) OR ((FileNameBuffer="*\\Windows\\System32\\DriverStore\\FileRepository\\*" FileNameBuffer="*\\igd10iumd64.dll" RequestedPolicy="7" ValidatedPolicy="1")) OR ((FileNameBuffer="*\\Windows\\System32\\nvspcap64.dll" (ProcessNameBuffer="*\\AppData\\Local\\Keybase\\Gui\\Keybase.exe" OR ProcessNameBuffer="*\\Microsoft\\Teams\\stage\\Teams.exe") RequestedPolicy="8" ValidatedPolicy="1")) OR ((FileNameBuffer="*\\Program Files\\Bonjour\\mdnsNSP.dll" (ProcessNameBuffer="*\\Windows\\System32\\svchost.exe" OR ProcessNameBuffer="*\\Windows\\System32\\SIHClient.exe") (RequestedPolicy="8" OR RequestedPolicy="12") ValidatedPolicy="1")) OR ((FileNameBuffer="*\\Microsoft Office\\root\\vfs\\ProgramFilesCommonX64\\Microsoft Shared\\OFFICE*" FileNameBuffer="*\\MSOXMLMF.DLL" RequestedPolicy="7" ValidatedPolicy="1")) OR ((FileNameBuffer="*\\Windows\\System32\\nvspcap64.dll" ProcessNameBuffer="*\\AppData\\Local\\slack\\app-*" ProcessNameBuffer="*\\slack.exe" RequestedPolicy="8" ValidatedPolicy="1")) OR (((FileNameBuffer="*\\Mozilla Firefox\\mozavcodec.dll" OR FileNameBuffer="*\\Mozilla Firefox\\mozavutil.dll") ProcessNameBuffer="*\\Mozilla Firefox\\firefox.exe" RequestedPolicy="8")) OR (((FileNameBuffer="*\\Program Files\\Avast Software\\Avast\\aswAMSI.dll" OR FileNameBuffer="*\\Program Files (x86)\\Avast Software\\Avast\\aswAMSI.dll") (RequestedPolicy="8" OR RequestedPolicy="12") ValidatedPolicy="1")) OR (((FileNameBuffer="*\\stdole.dll" OR FileNameBuffer="*\\msdatasrc.dll" OR FileNameBuffer="*\\adodb.dll") ProcessNameBuffer="*\\mscorsvw.exe" ProcessNameBuffer="*\\Windows\\Microsoft.NET\\*" RequestedPolicy="8" ValidatedPolicy="2")) OR ((FileNameBuffer="*\\Program Files\\Google\\Drive File Stream\\*" FileNameBuffer="*\\crashpad_handler.exe" ProcessNameBuffer="*\\Windows\\ImmersiveControlPanel\\SystemSettings.exe" RequestedPolicy="8" ValidatedPolicy="1"))))) | eval sigma_attack_tags="attack.execution" | eval sigma_title="Code Integrity Attempted DLL Load" | eval sigma_description="Detects attempted DLL load events that didn't meet anti-malware or Windows signing level requirements. It often means the file's signature is revoked or expired"
dispatch.earliest_time = -24h@h
alert.track = 0

[Code Integrity Blocked Driver Load - builtin]
description = Detects blocked load events that did not meet the authenticode signing level requirements or violated code integrity policy
search = index=wineventlog* ((source="WinEventLog:Microsoft-Windows-CodeIntegrity/Operational" EventCode="3077")) | eval sigma_attack_tags="attack.privilege_escalation attack.t1543" | eval sigma_title="Code Integrity Blocked Driver Load" | eval sigma_description="Detects blocked load events that did not meet the authenticode signing level requirements or violated code integrity policy"
dispatch.earliest_time = -24h@h
alert.track = 0

[Block Load Of Revoked Driver - builtin]
description = Detects blocked load attempts of revoked drivers
search = index=wineventlog* ((source="WinEventLog:Microsoft-Windows-CodeIntegrity/Operational" EventCode="3023")) | eval sigma_attack_tags="attack.privilege_escalation attack.t1543" | eval sigma_title="Block Load Of Revoked Driver" | eval sigma_description="Detects blocked load attempts of revoked drivers"
dispatch.earliest_time = -24h@h
alert.track = 0

[USB Device Plugged - builtin]
description = Detects plugged/unplugged USB devices
search = index=wineventlog* ((source="WinEventLog:Microsoft-Windows-DriverFrameworks-UserMode/Operational" (EventCode="2003" OR EventCode="2100" OR EventCode="2102"))) | eval sigma_attack_tags="attack.initial_access attack.t1200" | eval sigma_title="USB Device Plugged" | eval sigma_description="Detects plugged/unplugged USB devices"
dispatch.earliest_time = -24h@h
alert.track = 0

[NTLM Brute Force - builtin]
description = Detects common NTLM brute force device names
search = index=wineventlog* ((source="WinEventLog:Microsoft-Windows-NTLM/Operational" EventCode="8004" (WorkstationName="Rdesktop" OR WorkstationName="Remmina" OR WorkstationName="Freerdp" OR WorkstationName="Windows7" OR WorkstationName="Windows8" OR WorkstationName="Windows2012" OR WorkstationName="Windows2016" OR WorkstationName="Windows2019"))) | eval sigma_attack_tags="attack.credential_access attack.t1110" | eval sigma_title="NTLM Brute Force" | eval sigma_description="Detects common NTLM brute force device names"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential Remote Desktop Connection to Non-Domain Host - builtin]
description = Detects logons using NTLM to hosts that are potentially not part of the domain.
search = index=wineventlog* ((source="WinEventLog:Microsoft-Windows-NTLM/Operational" EventCode="8001" TargetName="TERMSRV*")) | table Computer,UserName,DomainName,TargetName | eval sigma_attack_tags="attack.command_and_control attack.t1219" | eval sigma_title="Potential Remote Desktop Connection to Non-Domain Host" | eval sigma_description="Detects logons using NTLM to hosts that are potentially not part of the domain."
dispatch.earliest_time = -24h@h
alert.track = 0

[OpenSSH Server Listening On Socket - builtin]
description = Detects scenarios where an attacker enables the OpenSSH server and server starts to listening on SSH socket.
search = index=wineventlog* ((source="WinEventLog:OpenSSH/Operational" EventCode="4" process="sshd" payload="Server listening on *")) | eval sigma_attack_tags="attack.lateral_movement attack.t1021.004" | eval sigma_title="OpenSSH Server Listening On Socket" | eval sigma_description="Detects scenarios where an attacker enables the OpenSSH server and server starts to listening on SSH socket."
dispatch.earliest_time = -24h@h
alert.track = 0

[File Was Not Allowed To Run - builtin]
description = Detect run not allowed files. Applocker is a very useful tool, especially on servers where unprivileged users have access. For example terminal servers. You need configure applocker and log collect to receive these events.
search = index=wineventlog* (((source="WinEventLog:Microsoft-Windows-AppLocker/MSI and Script" OR source="WinEventLog:Microsoft-Windows-AppLocker/EXE and DLL" OR source="WinEventLog:Microsoft-Windows-AppLocker/Packaged app-Deployment" OR source="WinEventLog:Microsoft-Windows-AppLocker/Packaged app-Execution") (EventCode="8004" OR EventCode="8007" OR EventCode="8022" OR EventCode="8025"))) | table PolicyName,RuleId,RuleName,TargetUser,TargetProcessId,FilePath,FileHash,Fqbn | eval sigma_attack_tags="attack.execution attack.t1204.002 attack.t1059.001 attack.t1059.003 attack.t1059.005 attack.t1059.006 attack.t1059.007" | eval sigma_title="File Was Not Allowed To Run" | eval sigma_description="Detect run not allowed files. Applocker is a very useful tool, especially on servers where unprivileged users have access. For example terminal servers. You need configure applocker and log collect to receive these events."
dispatch.earliest_time = -24h@h
alert.track = 0

[HybridConnectionManager Service Running - builtin]
description = Rule to detect the Hybrid Connection Manager service running on an endpoint.
search = index=wineventlog* (((EventCode="40300" OR EventCode="40301" OR EventCode="40302") ("HybridConnection" OR "sb://" OR "servicebus.windows.net" OR "HybridConnectionManage"))) | eval sigma_attack_tags="attack.persistence attack.t1554" | eval sigma_title="HybridConnectionManager Service Running" | eval sigma_description="Rule to detect the Hybrid Connection Manager service running on an endpoint."
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Cobalt Strike DNS Beaconing - DNS Client - builtin]
description = Detects a program that invoked suspicious DNS queries known from Cobalt Strike beacons
search = index=wineventlog* ((source="WinEventLog:Microsoft-Windows-DNS Client Events/Operational" EventCode="3008" ((QueryName="aaa.stage.*" OR QueryName="post.1*") OR QueryName="*.stage.123456.*"))) | eval sigma_attack_tags="attack.command_and_control attack.t1071.004" | eval sigma_title="Suspicious Cobalt Strike DNS Beaconing - DNS Client" | eval sigma_description="Detects a program that invoked suspicious DNS queries known from Cobalt Strike beacons"
dispatch.earliest_time = -24h@h
alert.track = 0

[DNS Query for Anonfiles.com Domain - DNS Client - builtin]
description = Detects DNS queries for anonfiles.com, which is an anonymous file upload platform often used for malicious purposes
search = index=wineventlog* ((source="WinEventLog:Microsoft-Windows-DNS Client Events/Operational" EventCode="3008" QueryName="*.anonfiles.com*")) | eval sigma_attack_tags="attack.exfiltration attack.t1567.002" | eval sigma_title="DNS Query for Anonfiles.com Domain - DNS Client" | eval sigma_description="Detects DNS queries for anonfiles.com, which is an anonymous file upload platform often used for malicious purposes"
dispatch.earliest_time = -24h@h
alert.track = 0

[DNS Query for MEGA.io Upload Domain - DNS Client - builtin]
description = Detects DNS queries for subdomains used for upload to MEGA.io
search = index=wineventlog* ((source="WinEventLog:Microsoft-Windows-DNS Client Events/Operational" EventCode="3008" QueryName="*userstorage.mega.co.nz*")) | eval sigma_attack_tags="attack.exfiltration attack.t1567.002" | eval sigma_title="DNS Query for MEGA.io Upload Domain - DNS Client" | eval sigma_description="Detects DNS queries for subdomains used for upload to MEGA.io"
dispatch.earliest_time = -24h@h
alert.track = 0

[Query Tor Onion Address - DNS Client - builtin]
description = Detects DNS resolution of an .onion address related to Tor routing networks
search = index=wineventlog* ((source="WinEventLog:Microsoft-Windows-DNS Client Events/Operational" EventCode="3008" QueryName="*.onion*")) | eval sigma_attack_tags="attack.command_and_control attack.t1090.003" | eval sigma_title="Query Tor Onion Address - DNS Client" | eval sigma_description="Detects DNS resolution of an .onion address related to Tor routing networks"
dispatch.earliest_time = -24h@h
alert.track = 0

[DNS Query for Ufile.io Upload Domain - DNS Client - builtin]
description = Detects DNS queries to 'ufile.io'. Which is often abused by malware for upload and exfiltration
search = index=wineventlog* ((source="WinEventLog:Microsoft-Windows-DNS Client Events/Operational" EventCode="3008" QueryName="*ufile.io*")) | eval sigma_attack_tags="attack.exfiltration attack.t1567.002" | eval sigma_title="DNS Query for Ufile.io Upload Domain - DNS Client" | eval sigma_description="Detects DNS queries to 'ufile.io'. Which is often abused by malware for upload and exfiltration"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Application Installed - builtin]
description = Detects suspicious application installed by looking at the added shortcut to the app resolver cache
search = index=wineventlog* ((source="WinEventLog:Microsoft-Windows-Shell-Core/Operational" (((EventCode="28115" (Name="*Zenmap*" OR Name="*AnyDesk*" OR Name="*wireshark*" OR Name="*openvpn*"))) OR ((EventCode="28115" (AppID="*zenmap.exe*" OR AppID="*prokzult ad*" OR AppID="*wireshark*" OR AppID="*openvpn*")))))) | eval sigma_attack_tags="attack.execution" | eval sigma_title="Suspicious Application Installed" | eval sigma_description="Detects suspicious application installed by looking at the added shortcut to the app resolver cache"
dispatch.earliest_time = -24h@h
alert.track = 0

[Standard User In High Privileged Group - builtin]
description = Detect standard users login that are part of high privileged groups such as the Administrator group
search = index=wineventlog* ((source="WinEventLog:Microsoft-Windows-LSA/Operational" ((EventCode="300" TargetUserSid="S-1-5-21-*" (SidList="*S-1-5-32-544*" OR SidList="*-500}*" OR SidList="*-518}*" OR SidList="*-519}*"))) NOT (((TargetUserSid="*-500" OR TargetUserSid="*-518" OR TargetUserSid="*-519"))))) | eval sigma_attack_tags="attack.credential_access attack.privilege_escalation" | eval sigma_title="Standard User In High Privileged Group" | eval sigma_description="Detect standard users login that are part of high privileged groups such as the Administrator group"
dispatch.earliest_time = -24h@h
alert.track = 0

[New Firewall Rule Added In Windows Firewall Exception List - builtin]
description = Detects when a rule has been added to the Windows Firewall exception list
search = index=wineventlog* ((source="WinEventLog:Microsoft-Windows-Windows Firewall With Advanced Security/Firewall" EventCode="2004" NOT (((Action="2")) OR (((ApplicationPath="C:\\Program Files\\*" OR ApplicationPath="C:\\Program Files (x86)\\*")) OR (ModifyingApplication="C:\\Windows\\System32\\oobe\\Setup.exe") OR (ModifyingApplication="C:\\Windows\\WinSxS\\*") OR ((ModifyingApplication="C:\\Windows\\SysWOW64\\msiexec.exe" OR ModifyingApplication="C:\\Windows\\System32\\svchost.exe" OR ModifyingApplication="C:\\Windows\\System32\\dllhost.exe" OR ModifyingApplication="C:\\Program Files\\Windows Defender\\MsMpEng.exe"))) OR ((ModifyingApplication="C:\\ProgramData\\Microsoft\\Windows Defender\\Platform\\*" ModifyingApplication="*\\MsMpEng.exe"))))) | eval sigma_attack_tags="" | eval sigma_title="New Firewall Rule Added In Windows Firewall Exception List" | eval sigma_description="Detects when a rule has been added to the Windows Firewall exception list"
dispatch.earliest_time = -24h@h
alert.track = 0

[Firewall Rule Modified In The Windows Firewall Exception List - builtin]
description = Detects when a rule has been modified in the windows firewall exception list
search = index=wineventlog* ((source="WinEventLog:Microsoft-Windows-Windows Firewall With Advanced Security/Firewall" EventCode="2005" NOT ((((ModifyingApplication="C:\\Program Files (x86)\\*" OR ModifyingApplication="C:\\Program Files\\*")))))) | eval sigma_attack_tags="" | eval sigma_title="Firewall Rule Modified In The Windows Firewall Exception List" | eval sigma_description="Detects when a rule has been modified in the windows firewall exception list"
dispatch.earliest_time = -24h@h
alert.track = 0

[All Rules Have Been Deleted From The Windows Firewall Configuration - builtin]
description = Detects when a all the rules have been deleted from the Windows Defender Firewall configuration
search = index=wineventlog* ((source="WinEventLog:Microsoft-Windows-Windows Firewall With Advanced Security/Firewall" EventCode="2033" NOT ((((ModifyingApplication="C:\\Program Files\\*" OR ModifyingApplication="C:\\Program Files (x86)\\*"))) OR ((ModifyingApplication="C:\\Windows\\System32\\svchost.exe")) OR ((ModifyingApplication="C:\\ProgramData\\Microsoft\\Windows Defender\\Platform\\*" ModifyingApplication="*\\MsMpEng.exe"))))) | eval sigma_attack_tags="" | eval sigma_title="All Rules Have Been Deleted From The Windows Firewall Configuration" | eval sigma_description="Detects when a all the rules have been deleted from the Windows Defender Firewall configuration"
dispatch.earliest_time = -24h@h
alert.track = 0

[A Rule Has Been Deleted From The Windows Firewall Exception List - builtin]
description = Detects when a singe rules or all of the rules have been deleted from the Windows Defender Firewall
search = index=wineventlog* ((source="WinEventLog:Microsoft-Windows-Windows Firewall With Advanced Security/Firewall" EventCode="2006" NOT ((((ModifyingApplication="C:\\Program Files\\*" OR ModifyingApplication="C:\\Program Files (x86)\\*"))) OR ((ModifyingApplication="C:\\Windows\\System32\\svchost.exe")) OR ((ModifyingApplication="C:\\ProgramData\\Microsoft\\Windows Defender\\Platform\\*" ModifyingApplication="*\\MsMpEng.exe"))))) | eval sigma_attack_tags="" | eval sigma_title="A Rule Has Been Deleted From The Windows Firewall Exception List" | eval sigma_description="Detects when a singe rules or all of the rules have been deleted from the Windows Defender Firewall"
dispatch.earliest_time = -24h@h
alert.track = 0

[The Windows Defender Firewall Service Failed To Load Group Policy - builtin]
description = Detects activity when The Windows Defender Firewall service failed to load Group Policy
search = index=wineventlog* ((source="WinEventLog:Microsoft-Windows-Windows Firewall With Advanced Security/Firewall" EventCode="2009")) | eval sigma_attack_tags="" | eval sigma_title="The Windows Defender Firewall Service Failed To Load Group Policy" | eval sigma_description="Detects activity when The Windows Defender Firewall service failed to load Group Policy"
dispatch.earliest_time = -24h@h
alert.track = 0

[Windows Defender Firewall Has Been Reset To Its Default Configuration - builtin]
description = Detects activity when Windows Defender Firewall has been reset to its default configuration
search = index=wineventlog* ((source="WinEventLog:Microsoft-Windows-Windows Firewall With Advanced Security/Firewall" EventCode="2032")) | eval sigma_attack_tags="" | eval sigma_title="Windows Defender Firewall Has Been Reset To Its Default Configuration" | eval sigma_description="Detects activity when Windows Defender Firewall has been reset to its default configuration"
dispatch.earliest_time = -24h@h
alert.track = 0

[Windows Firewall Settings Have Been Changed - builtin]
description = Detects activity when the settings of the Windows firewall have been changed
search = index=wineventlog* ((source="WinEventLog:Microsoft-Windows-Windows Firewall With Advanced Security/Firewall" (EventCode="2002" OR EventCode="2003" OR EventCode="2008"))) | eval sigma_attack_tags="" | eval sigma_title="Windows Firewall Settings Have Been Changed" | eval sigma_description="Detects activity when the settings of the Windows firewall have been changed"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Rejected SMB Guest Logon From IP - builtin]
description = Detect Attempt PrintNightmare (CVE-2021-1675) Remote code execution in Windows Spooler Service
search = index=wineventlog* ((source="WinEventLog:Microsoft-Windows-SmbClient/Security" EventCode="31017" UserName="" ServerName="\\1*")) | table Computer,Account_Name | eval sigma_attack_tags="attack.credential_access attack.t1110.001" | eval sigma_title="Suspicious Rejected SMB Guest Logon From IP" | eval sigma_description="Detect Attempt PrintNightmare (CVE-2021-1675) Remote code execution in Windows Spooler Service"
dispatch.earliest_time = -24h@h
alert.track = 0

[Failed Mounting of Hidden Share - builtin]
description = Detects repeated failed (outgoing) attempts to mount a hidden share
search = index=wineventlog* ((source="WinEventLog:Microsoft-Windows-SmbClient/Security" EventCode="31010" ShareName="*$")) | eventstats count as val | search val > 10 | table ShareName | eval sigma_attack_tags="attack.t1021.002 attack.lateral_movement" | eval sigma_title="Failed Mounting of Hidden Share" | eval sigma_description="Detects repeated failed (outgoing) attempts to mount a hidden share"
dispatch.earliest_time = -24h@h
alert.track = 0

[CVE-2021-1675 Print Spooler Exploitation - builtin]
description = Detects driver load events print service operational log that are a sign of successful exploitation attempts against print spooler vulnerability CVE-2021-1675
search = index=wineventlog* ((source="WinEventLog:Microsoft-Windows-PrintService/Operational" EventCode="316" ("UNIDRV.DLL, kernelbase.dll, " OR " 123 " OR " 1234 " OR "mimispool"))) | table DriverAdded | eval sigma_attack_tags="attack.execution attack.t1569 cve.2021.1675" | eval sigma_title="CVE-2021-1675 Print Spooler Exploitation" | eval sigma_description="Detects driver load events print service operational log that are a sign of successful exploitation attempts against print spooler vulnerability CVE-2021-1675"
dispatch.earliest_time = -24h@h
alert.track = 0

[Possible CVE-2021-1675 Print Spooler Exploitation - builtin]
description = Detects events of driver load errors in print service logs that could be a sign of successful exploitation attempts of print spooler vulnerability CVE-2021-1675
search = index=wineventlog* ((source="WinEventLog:Microsoft-Windows-PrintService/Admin" (((EventCode="808" (ErrorCode="0x45A" OR ErrorCode="0x7e"))) OR ("The print spooler failed to load a plug-in module" OR "MyExploit.dll" OR "evil.dll" OR "\\addCube.dll" OR "\\rev.dll" OR "\\rev2.dll" OR "\\main64.dll" OR "\\mimilib.dll" OR "\\mimispool.dll")) NOT (" registration timed out"))) | table PluginDllName | eval sigma_attack_tags="attack.execution attack.t1569 cve.2021.1675" | eval sigma_title="Possible CVE-2021-1675 Print Spooler Exploitation" | eval sigma_description="Detects events of driver load errors in print service logs that could be a sign of successful exploitation attempts of print spooler vulnerability CVE-2021-1675"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Digital Signature Of AppX Package - builtin]
description = Detects execution of AppX packages with known suspicious or malicious signature
search = index=wineventlog* ((source="WinEventLog:Microsoft-Windows-AppxPackaging/Operational" EventCode="157" subjectName="CN=Foresee Consulting Inc., O=Foresee Consulting Inc., L=North York, S=Ontario, C=CA, SERIALNUMBER=1004913-1, OID.1.3.6.1.4.1.311.60.2.1.3=CA, OID.2.5.4.15=Private Organization")) | eval sigma_attack_tags="attack.defense_evasion attack.execution" | eval sigma_title="Suspicious Digital Signature Of AppX Package" | eval sigma_description="Detects execution of AppX packages with known suspicious or malicious signature"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential Active Directory Reconnaissance/Enumeration Via LDAP - builtin]
description = Detects potential Active Directory enumeration via LDAP
search = index=wineventlog* ((source="WinEventLog:Microsoft-Windows-LDAP-Client/Debug" (((((EventCode="30" (SearchFilter="*(groupType:1.2.840.113556.1.4.803:=2147483648)*" OR SearchFilter="*(groupType:1.2.840.113556.1.4.803:=2147483656)*" OR SearchFilter="*(groupType:1.2.840.113556.1.4.803:=2147483652)*" OR SearchFilter="*(groupType:1.2.840.113556.1.4.803:=2147483650)*" OR SearchFilter="*(sAMAccountType=805306369)*" OR SearchFilter="*(sAMAccountType=805306368)*" OR SearchFilter="*(sAMAccountType=536870913)*" OR SearchFilter="*(sAMAccountType=536870912)*" OR SearchFilter="*(sAMAccountType=268435457)*" OR SearchFilter="*(sAMAccountType=268435456)*" OR SearchFilter="*(objectCategory=groupPolicyContainer)*" OR SearchFilter="*(objectCategory=organizationalUnit)*" OR SearchFilter="*(objectCategory=Computer)*" OR SearchFilter="*(objectCategory=nTDSDSA)*" OR SearchFilter="*(objectCategory=server)*" OR SearchFilter="*(objectCategory=domain)*" OR SearchFilter="*(objectCategory=person)*" OR SearchFilter="*(objectCategory=group)*" OR SearchFilter="*(objectCategory=user)*" OR SearchFilter="*(objectClass=trustedDomain)*" OR SearchFilter="*(objectClass=computer)*" OR SearchFilter="*(objectClass=server)*" OR SearchFilter="*(objectClass=group)*" OR SearchFilter="*(objectClass=user)*" OR SearchFilter="*(primaryGroupID=521)*" OR SearchFilter="*(primaryGroupID=516)*" OR SearchFilter="*(primaryGroupID=515)*" OR SearchFilter="*(primaryGroupID=512)*" OR SearchFilter="*Domain Admins*" OR SearchFilter="*objectGUID=\*" OR SearchFilter="*(schemaIDGUID=\*)*"))) NOT ((EventCode="30" (SearchFilter="*(domainSid=*)*" OR SearchFilter="*(objectSid=*)*"))))) OR ((EventCode="30" (SearchFilter="*(userAccountControl:1.2.840.113556.1.4.803:=4194304)*" OR SearchFilter="*(userAccountControl:1.2.840.113556.1.4.803:=2097152)*" OR SearchFilter="*!(userAccountControl:1.2.840.113556.1.4.803:=1048574)*" OR SearchFilter="*(userAccountControl:1.2.840.113556.1.4.803:=524288)*" OR SearchFilter="*(userAccountControl:1.2.840.113556.1.4.803:=65536)*" OR SearchFilter="*(userAccountControl:1.2.840.113556.1.4.803:=8192)*" OR SearchFilter="*(userAccountControl:1.2.840.113556.1.4.803:=544)*" OR SearchFilter="*!(UserAccountControl:1.2.840.113556.1.4.803:=2)*" OR SearchFilter="*msDS-AllowedToActOnBehalfOfOtherIdentity*" OR SearchFilter="*msDS-AllowedToDelegateTo*" OR SearchFilter="*msDS-GroupManagedServiceAccount*" OR SearchFilter="*(accountExpires=9223372036854775807)*" OR SearchFilter="*(accountExpires=0)*" OR SearchFilter="*(adminCount=1)*" OR SearchFilter="*ms-MCS-AdmPwd*")))))) | eval sigma_attack_tags="attack.discovery attack.t1069.002 attack.t1087.002 attack.t1482" | eval sigma_title="Potential Active Directory Reconnaissance/Enumeration Via LDAP" | eval sigma_description="Detects potential Active Directory enumeration via LDAP"
dispatch.earliest_time = -24h@h
alert.track = 0

[Possible Exploitation of Exchange RCE CVE-2021-42321 - builtin]
description = Detects log entries that appear in exploitation attempts against MS Exchange RCE CVE-2021-42321
search = index=wineventlog* ((source="WinEventLog:MSExchange Management" (EventCode="6" OR EventCode="8") (Data="*Cmdlet failed. Cmdlet Get-App, *" OR Data="*Task Get-App throwing unhandled exception: System.InvalidCastException:*"))) | eval sigma_attack_tags="attack.lateral_movement attack.t1210" | eval sigma_title="Possible Exploitation of Exchange RCE CVE-2021-42321" | eval sigma_description="Detects log entries that appear in exploitation attempts against MS Exchange RCE CVE-2021-42321"
dispatch.earliest_time = -24h@h
alert.track = 0

[ProxyLogon MSExchange OabVirtualDirectory - builtin]
description = Detects specific patterns found after a successful ProxyLogon exploitation in relation to a Commandlet invocation of Set-OabVirtualDirectory
search = index=wineventlog* ((source="WinEventLog:MSExchange Management" ((="OabVirtualDirectory" =" -ExternalUrl ")) ("eval(request" OR "http://f/<script" OR "\"unsafe\"};" OR "function Page_Load()"))) | eval sigma_attack_tags="attack.t1587.001 attack.resource_development" | eval sigma_title="ProxyLogon MSExchange OabVirtualDirectory" | eval sigma_description="Detects specific patterns found after a successful ProxyLogon exploitation in relation to a Commandlet invocation of Set-OabVirtualDirectory"
dispatch.earliest_time = -24h@h
alert.track = 0

[Certificate Request Export to Exchange Webserver - builtin]
description = Detects a write of an Exchange CSR to an untypical directory or with aspx name suffix which can be used to place a webshell
search = index=wineventlog* ((source="WinEventLog:MSExchange Management" ((="New-ExchangeCertificate" =" -GenerateRequest" =" -BinaryEncoded" =" -RequestFile")) ("\\\\localhost\\C$" OR "\\\\127.0.0.1\\C$" OR "C:\\inetpub" OR ".aspx"))) | eval sigma_attack_tags="attack.persistence attack.t1505.003" | eval sigma_title="Certificate Request Export to Exchange Webserver" | eval sigma_description="Detects a write of an Exchange CSR to an untypical directory or with aspx name suffix which can be used to place a webshell"
dispatch.earliest_time = -24h@h
alert.track = 0

[Mailbox Export to Exchange Webserver - builtin]
description = Detects a successful export of an Exchange mailbox to untypical directory or with aspx name suffix which can be used to place a webshell or the needed role assignment for it
search = index=wineventlog* ((source="WinEventLog:MSExchange Management" (((("New-MailboxExportRequest" OR " -Mailbox ") ("-FilePath \"\\\\" OR ".aspx"))) OR ("New-ManagementRoleAssignment" OR " -Role \"Mailbox Import Export\"" OR " -User ")))) | eval sigma_attack_tags="attack.persistence attack.t1505.003" | eval sigma_title="Mailbox Export to Exchange Webserver" | eval sigma_description="Detects a successful export of an Exchange mailbox to untypical directory or with aspx name suffix which can be used to place a webshell or the needed role assignment for it"
dispatch.earliest_time = -24h@h
alert.track = 0

[Remove Exported Mailbox from Exchange Webserver - builtin]
description = Detects removal of an exported Exchange mailbox which could be to cover tracks from ProxyShell exploit
search = index=wineventlog* ((source="WinEventLog:MSExchange Management" ="Remove-MailboxExportRequest" =" -Identity " =" -Confirm \"False\"")) | eval sigma_attack_tags="attack.defense_evasion attack.t1070" | eval sigma_title="Remove Exported Mailbox from Exchange Webserver" | eval sigma_description="Detects removal of an exported Exchange mailbox which could be to cover tracks from ProxyShell exploit"
dispatch.earliest_time = -24h@h
alert.track = 0

[Exchange Set OabVirtualDirectory ExternalUrl Property - builtin]
description = Rule to detect an adversary setting OabVirtualDirectory External URL property to a script in Exchange Management log
search = index=wineventlog* ((source="WinEventLog:MSExchange Management" ="Set-OabVirtualDirectory" ="ExternalUrl" ="Page_Load" ="script")) | eval sigma_attack_tags="attack.persistence attack.t1505.003" | eval sigma_title="Exchange Set OabVirtualDirectory ExternalUrl Property" | eval sigma_description="Rule to detect an adversary setting OabVirtualDirectory External URL property to a script in Exchange Management log"
dispatch.earliest_time = -24h@h
alert.track = 0

[Failed MSExchange Transport Agent Installation - builtin]
description = Detects a failed installation of a Exchange Transport Agent
search = index=wineventlog* ((source="WinEventLog:MSExchange Management" EventCode="6" Data="*Install-TransportAgent*")) | table AssemblyPath | eval sigma_attack_tags="attack.persistence attack.t1505.002" | eval sigma_title="Failed MSExchange Transport Agent Installation" | eval sigma_description="Detects a failed installation of a Exchange Transport Agent"
dispatch.earliest_time = -24h@h
alert.track = 0

[MSExchange Transport Agent Installation - Builtin - builtin]
description = Detects the Installation of a Exchange Transport Agent
search = index=wineventlog* ((source="WinEventLog:MSExchange Management" "Install-TransportAgent")) | table AssemblyPath | eval sigma_attack_tags="attack.persistence attack.t1505.002" | eval sigma_title="MSExchange Transport Agent Installation - Builtin" | eval sigma_description="Detects the Installation of a Exchange Transport Agent"
dispatch.earliest_time = -24h@h
alert.track = 0

[Deployment AppX Package Was Blocked By AppLocker - builtin]
description = Detects an appx package deployment that was blocked by AppLocker policy
search = index=wineventlog* ((source="WinEventLog:Microsoft-Windows-AppXDeploymentServer/Operational" EventCode="412")) | eval sigma_attack_tags="attack.defense_evasion" | eval sigma_title="Deployment AppX Package Was Blocked By AppLocker" | eval sigma_description="Detects an appx package deployment that was blocked by AppLocker policy"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential Malicious AppX Package Installation Attempts - builtin]
description = Detects potential installation or installation attempts of known malicious appx packages
search = index=wineventlog* ((source="WinEventLog:Microsoft-Windows-AppXDeploymentServer/Operational" (EventCode="400" OR EventCode="401") PackageFullName="*3669e262-ec02-4e9d-bcb4-3d008b4afac9*")) | eval sigma_attack_tags="attack.defense_evasion" | eval sigma_title="Potential Malicious AppX Package Installation Attempts" | eval sigma_description="Detects potential installation or installation attempts of known malicious appx packages"
dispatch.earliest_time = -24h@h
alert.track = 0

[Deployment Of The AppX Package Was Blocked By The Policy - builtin]
description = Detects an appx package deployment that was blocked by the local computer policy
search = index=wineventlog* ((source="WinEventLog:Microsoft-Windows-AppXDeploymentServer/Operational" (EventCode="441" OR EventCode="442" OR EventCode="453" OR EventCode="454"))) | eval sigma_attack_tags="attack.defense_evasion" | eval sigma_title="Deployment Of The AppX Package Was Blocked By The Policy" | eval sigma_description="Detects an appx package deployment that was blocked by the local computer policy"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious AppX Package Installation Attempt - builtin]
description = Detects an appx package installation with the error code '0x80073cff'. Whihc indicates that the package didn't meet the sgining requirements and could be suspicious
search = index=wineventlog* ((source="WinEventLog:Microsoft-Windows-AppXDeploymentServer/Operational" EventCode="401" ErrorCode="0x80073cff")) | eval sigma_attack_tags="attack.defense_evasion" | eval sigma_title="Suspicious AppX Package Installation Attempt" | eval sigma_description="Detects an appx package installation with the error code '0x80073cff'. Whihc indicates that the package didn't meet the sgining requirements and could be suspicious"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Remote AppX Package Locations - builtin]
description = Detects an appx package added the pipeline of the 'to be processed' packages which is downloaded from a suspicious domain
search = index=wineventlog* ((source="WinEventLog:Microsoft-Windows-AppXDeploymentServer/Operational" EventCode="854" (Path="*transfer.sh*" OR Path="*raw.githubusercontent.com*" OR Path="*gist.githubusercontent.com*" OR Path="*pastebin.com*" OR Path="*cdn.discordapp.com/attachments/*" OR Path="*mediafire.com*" OR Path="*mega.nz*" OR Path="*ddns.net*" OR Path="*.paste.ee*" OR Path="*.hastebin.com*" OR Path="*.ghostbin.co/*" OR Path="*ufile.io*" OR Path="*storage.googleapis.com*" OR Path="*anonfiles.com*" OR Path="*send.exploit.in*" OR Path="*privatlab.net*" OR Path="*privatlab.com*" OR Path="*sendspace.com*" OR Path="*pastetext.net*" OR Path="*pastebin.pl*" OR Path="*paste.ee*"))) | eval sigma_attack_tags="attack.defense_evasion" | eval sigma_title="Suspicious Remote AppX Package Locations" | eval sigma_description="Detects an appx package added the pipeline of the 'to be processed' packages which is downloaded from a suspicious domain"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious AppX Package Locations - builtin]
description = Detects an appx package added the pipeline of the 'to be processed' packages which is located in suspicious locations
search = index=wineventlog* ((source="WinEventLog:Microsoft-Windows-AppXDeploymentServer/Operational" EventCode="854" (Path="*C:\\Users\\Public\\*" OR Path="*/users/public/*" OR Path="*C:\\PerfLogs\\*" OR Path="*C:/perflogs/*" OR Path="*\\Desktop\\*" OR Path="*/desktop/*" OR Path="*\\Downloads\\*" OR Path="*/Downloads/*" OR Path="*C:\\Windows\\Temp\\*" OR Path="*C:/Windows/Temp/*" OR Path="*\\AppdData\\Local\\Temp\\*" OR Path="*/AppdData/Local/Temp/*"))) | eval sigma_attack_tags="attack.defense_evasion" | eval sigma_title="Suspicious AppX Package Locations" | eval sigma_description="Detects an appx package added the pipeline of the 'to be processed' packages which is located in suspicious locations"
dispatch.earliest_time = -24h@h
alert.track = 0

[Uncommon AppX Package Locations - builtin]
description = Detects an appx package added the pipeline of the 'to be processed' packages which is located in uncommon locations
search = index=wineventlog* ((source="WinEventLog:Microsoft-Windows-AppXDeploymentServer/Operational" EventCode="854" NOT ((((Path="*C:\\Program Files\\WindowsApps\\*" OR Path="*C:\\Program Files (x86)\\*" OR Path="*C:\\Windows\\SystemApps\\*" OR Path="*C:\\Windows\\PrintDialog\\*" OR Path="*C:\\Windows\\ImmersiveControlPanel\\*" OR Path="*x-windowsupdate://*" OR Path="*file:///C:/Program%20Files*"))) OR (((Path="*https://statics.teams.cdn.office.net/*" OR Path="*microsoft.com*")))))) | eval sigma_attack_tags="attack.defense_evasion" | eval sigma_title="Uncommon AppX Package Locations" | eval sigma_description="Detects an appx package added the pipeline of the 'to be processed' packages which is located in uncommon locations"
dispatch.earliest_time = -24h@h
alert.track = 0

[GALLIUM Artefacts - Builtin - builtin]
description = Detects artefacts associated with activity group GALLIUM - Microsoft Threat Intelligence Center indicators released in December 2019.
search = index=wineventlog* ((EventCode="257" (QNAME="asyspy256.ddns.net" OR QNAME="hotkillmail9sddcc.ddns.net" OR QNAME="rosaf112.ddns.net" OR QNAME="cvdfhjh1231.myftp.biz" OR QNAME="sz2016rose.ddns.net" OR QNAME="dffwescwer4325.myftp.biz" OR QNAME="cvdfhjh1231.ddns.net"))) | eval sigma_attack_tags="attack.credential_access attack.command_and_control attack.t1071" | eval sigma_title="GALLIUM Artefacts - Builtin" | eval sigma_description="Detects artefacts associated with activity group GALLIUM - Microsoft Threat Intelligence Center indicators released in December 2019."
dispatch.earliest_time = -24h@h
alert.track = 0

[Rare Scheduled Task Creations - builtin]
description = This rule detects rare scheduled task creations. Typically software gets installed on multiple systems and not only on a few. The aggregation and count function selects tasks with rare names.
search = index=wineventlog* ((source="WinEventLog:Microsoft-Windows-TaskScheduler/Operational" EventCode="106" NOT (((TaskName="\\Microsoft\\Windows\\Windows Defender\\Windows Defender Scheduled Scan"))))) | eventstats count as val by TaskName| search val < 5 | eval sigma_attack_tags="attack.persistence attack.s0111 attack.t1053.005" | eval sigma_title="Rare Scheduled Task Creations" | eval sigma_description="This rule detects rare scheduled task creations. Typically software gets installed on multiple systems and not only on a few. The aggregation and count function selects tasks with rare names."
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Security Scheduled Tasks Deleted - builtin]
description = Detects when adversaries stop services or processes by deleting their respective scheduled tasks in order to conduct data destructive activities
search = index=wineventlog* ((source="WinEventLog:Microsoft-Windows-TaskScheduler/Operational" ((EventCode="141" (TaskName="*\\Windows\\SystemRestore\\SR*" OR TaskName="*\\Windows\\Windows Defender\\*" OR TaskName="*\\Windows\\BitLocker*" OR TaskName="*\\Windows\\WindowsBackup\\*" OR TaskName="*\\Windows\\WindowsUpdate\\*" OR TaskName="*\\Windows\\UpdateOrchestrator\\*" OR TaskName="*\\Windows\\ExploitGuard*"))) NOT (((UserName="*AUTHORI*" OR UserName="*AUTORI*"))))) | eval sigma_attack_tags="attack.impact attack.t1489" | eval sigma_title="Suspicious Security Scheduled Tasks Deleted" | eval sigma_description="Detects when adversaries stop services or processes by deleting their respective scheduled tasks in order to conduct data destructive activities"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Scheduled Tasks Locations - builtin]
description = Detects the execution of Scheduled Tasks where the Program being run is located in a suspicious location or it's an unusale program to be run from a Scheduled Task
search = index=wineventlog* ((source="WinEventLog:Microsoft-Windows-TaskScheduler/Operational" EventCode="129" (Path="*C:\\Windows\\Temp\\*" OR Path="*\\AppData\\Local\\Temp\\*" OR Path="*\\Desktop\\*" OR Path="*\\Downloads\\*" OR Path="*\\Users\\Public\\*" OR Path="*C:\\Temp\\*" OR Path="*C:\\Windows\\System32\\calc.exe*" OR Path="*C:\\Windows\\System32\\regsvr32.exe*" OR Path="*C:\\Windows\\System32\\rundll32.exe*"))) | eval sigma_attack_tags="attack.persistence attack.t1053.005" | eval sigma_title="Suspicious Scheduled Tasks Locations" | eval sigma_description="Detects the execution of Scheduled Tasks where the Program being run is located in a suspicious location or it's an unusale program to be run from a Scheduled Task"
dispatch.earliest_time = -24h@h
alert.track = 0

[Loading Diagcab Package From Remote Path - builtin]
description = Detects loading of diagcab packages from a remote path, as seen in DogWalk vulnerability
search = index=wineventlog* ((source="WinEventLog:Microsoft-Windows-Diagnosis-Scripted/Operational" EventCode="101" PackagePath="*\\\\\*")) | eval sigma_attack_tags="attack.execution" | eval sigma_title="Loading Diagcab Package From Remote Path" | eval sigma_description="Detects loading of diagcab packages from a remote path, as seen in DogWalk vulnerability"
dispatch.earliest_time = -24h@h
alert.track = 0

[WMI Persistence - builtin]
description = Detects suspicious WMI event filter and command line event consumer based on WMI and Security Logs.
search = index=wineventlog* ((source="WinEventLog:Microsoft-Windows-WMI-Activity/Operational" (((EventCode="5861" ("ActiveScriptEventConsumer" OR "CommandLineEventConsumer" OR "CommandLineTemplate"))) OR EventCode="5859") NOT ((Provider="SCM Event Provider" Query="select * from MSFT_SCMEventLogEvent" Account_Name="S-1-5-32-544" PossibleCause="Permanent")))) | eval sigma_attack_tags="attack.persistence attack.privilege_escalation attack.t1546.003" | eval sigma_title="WMI Persistence" | eval sigma_description="Detects suspicious WMI event filter and command line event consumer based on WMI and Security Logs."
dispatch.earliest_time = -24h@h
alert.track = 0

[Ngrok Usage with Remote Desktop Service - builtin]
description = Detects cases in which ngrok, a reverse proxy tool, forwards events to the local RDP port, which could be a sign of malicious behaviour
search = index=wineventlog* ((source="WinEventLog:Microsoft-Windows-TerminalServices-LocalSessionManager/Operational" EventCode="21" Address="*16777216*")) | eval sigma_attack_tags="attack.command_and_control attack.t1090" | eval sigma_title="Ngrok Usage with Remote Desktop Service" | eval sigma_description="Detects cases in which ngrok, a reverse proxy tool, forwards events to the local RDP port, which could be a sign of malicious behaviour"
dispatch.earliest_time = -24h@h
alert.track = 0

[Nslookup PowerShell Download Cradle - powershell]
description = Detects suspicious powershell download cradle using nslookup. This cradle uses nslookup to extract payloads from DNS records
search = index=wineventlog* ((HostApplication="*powershell*" HostApplication="*nslookup*" (HostApplication="*-q=txt*" OR HostApplication="*-querytype=txt*"))) | eval sigma_attack_tags="attack.execution attack.t1059.001" | eval sigma_title="Nslookup PowerShell Download Cradle" | eval sigma_description="Detects suspicious powershell download cradle using nslookup. This cradle uses nslookup to extract payloads from DNS records"
dispatch.earliest_time = -24h@h
alert.track = 0

[Alternate PowerShell Hosts - powershell]
description = Detects alternate PowerShell hosts potentially bypassing detections looking for powershell.exe
search = index=wineventlog* ((HostApplication="*" NOT ((HostApplication="C:\\WINDOWS\\System32\\WindowsPowerShell\\v1.0\\powershell.exe*") OR (ContextInfo="*Citrix\\ConfigSync\\ConfigSync.ps1*")))) | eval sigma_attack_tags="attack.execution attack.t1059.001" | eval sigma_title="Alternate PowerShell Hosts" | eval sigma_description="Detects alternate PowerShell hosts potentially bypassing detections looking for powershell.exe"
dispatch.earliest_time = -24h@h
alert.track = 0

[Delete Volume Shadow Copies Via WMI With PowerShell - powershell]
description = Shadow Copies deletion using operating systems utilities via PowerShell
search = index=wineventlog* ((HostApplication="*Get-WmiObject*" HostApplication="* Win32_Shadowcopy*" (HostApplication="*Delete()*" OR HostApplication="*Remove-WmiObject*"))) | table HostApplication | eval sigma_attack_tags="attack.impact attack.t1490" | eval sigma_title="Delete Volume Shadow Copies Via WMI With PowerShell" | eval sigma_description="Shadow Copies deletion using operating systems utilities via PowerShell"
dispatch.earliest_time = -24h@h
alert.track = 0

[PowerShell Downgrade Attack - PowerShell - powershell]
description = Detects PowerShell downgrade attack by comparing the host versions with the actually used engine version 2.0
search = index=wineventlog* ((EngineVersion="2.*" NOT ((HostVersion="2.*")))) | eval sigma_attack_tags="attack.defense_evasion attack.execution attack.t1059.001" | eval sigma_title="PowerShell Downgrade Attack - PowerShell" | eval sigma_description="Detects PowerShell downgrade attack by comparing the host versions with the actually used engine version 2.0"
dispatch.earliest_time = -24h@h
alert.track = 0

[PowerShell Called from an Executable Version Mismatch - powershell]
description = Detects PowerShell called from an executable by the version mismatch method
search = index=wineventlog* (((EngineVersion="2.*" OR EngineVersion="4.*" OR EngineVersion="5.*") HostVersion="3.*")) | eval sigma_attack_tags="attack.defense_evasion attack.execution attack.t1059.001" | eval sigma_title="PowerShell Called from an Executable Version Mismatch" | eval sigma_description="Detects PowerShell called from an executable by the version mismatch method"
dispatch.earliest_time = -24h@h
alert.track = 0

[Netcat The Powershell Version - powershell]
description = Adversaries may use a non-application layer protocol for communication between host and C2 server or among infected hosts within a network
search = index=wineventlog* (HostApplication="*powercat *" OR HostApplication="*powercat.ps1*") | eval sigma_attack_tags="attack.command_and_control attack.t1095" | eval sigma_title="Netcat The Powershell Version" | eval sigma_description="Adversaries may use a non-application layer protocol for communication between host and C2 server or among infected hosts within a network"
dispatch.earliest_time = -24h@h
alert.track = 0

[Remote PowerShell Session (PS Classic) - powershell]
description = Detects remote PowerShell sessions
search = index=wineventlog* ((HostName="ServerRemoteHost" HostApplication="*wsmprovhost.exe*")) | eval sigma_attack_tags="attack.execution attack.t1059.001 attack.lateral_movement attack.t1021.006" | eval sigma_title="Remote PowerShell Session (PS Classic)" | eval sigma_description="Detects remote PowerShell sessions"
dispatch.earliest_time = -24h@h
alert.track = 0

[Renamed Powershell Under Powershell Channel - powershell]
description = Detects renamed powershell
search = index=wineventlog* ((HostName="ConsoleHost" NOT (((HostApplication="powershell.exe*" OR HostApplication="C:\\WINDOWS\\System32\\WindowsPowerShell\\v1.0\\powershell.exe*"))))) | eval sigma_attack_tags="attack.execution attack.t1059.001" | eval sigma_title="Renamed Powershell Under Powershell Channel" | eval sigma_description="Detects renamed powershell"
dispatch.earliest_time = -24h@h
alert.track = 0

[Abusable Invoke-ATHRemoteFXvGPUDisablementCommand - PowerShell - powershell]
description = RemoteFXvGPUDisablement.exe is an abusable, signed PowerShell host executable that was introduced in Windows 10 and Server 2019 (OS Build 17763.1339).
search = index=wineventlog* ((source="WinEventLog:Windows PowerShell" HostApplication="*Invoke-ATHRemoteFXvGPUDisablementCommand *" (HostApplication="*-ModuleName *" OR HostApplication="*-ModulePath *" OR HostApplication="*-ScriptBlock *" OR HostApplication="*-RemoteFXvGPUDisablementFilePath*"))) | table ComputerName,User,CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.t1218" | eval sigma_title="Abusable Invoke-ATHRemoteFXvGPUDisablementCommand - PowerShell" | eval sigma_description="RemoteFXvGPUDisablement.exe is an abusable, signed PowerShell host executable that was introduced in Windows 10 and Server 2019 (OS Build 17763.1339)."
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious PowerShell Download - powershell]
description = Detects suspicious PowerShell download command
search = index=wineventlog* ((HostApplication="*Net.WebClient*" (HostApplication="*.DownloadFile(*" OR HostApplication="*.DownloadString(*"))) | eval sigma_attack_tags="attack.execution attack.t1059.001" | eval sigma_title="Suspicious PowerShell Download" | eval sigma_description="Detects suspicious PowerShell download command"
dispatch.earliest_time = -24h@h
alert.track = 0

[Zip A Folder With PowerShell For Staging In Temp - PowerShell - powershell]
description = Use living off the land tools to zip a file and stage it in the Windows temporary folder for later exfiltration
search = index=wineventlog* ((source="WinEventLog:Windows PowerShell" HostApplication="*Compress-Archive *" HostApplication="* -Path *" HostApplication="* -DestinationPath *" HostApplication="*$env:TEMP\\*")) | eval sigma_attack_tags="attack.collection attack.t1074.001" | eval sigma_title="Zip A Folder With PowerShell For Staging In Temp - PowerShell" | eval sigma_description="Use living off the land tools to zip a file and stage it in the Windows temporary folder for later exfiltration"
dispatch.earliest_time = -24h@h
alert.track = 0

[Tamper Windows Defender - PSClassic - powershell]
description = Attempting to disable scheduled scanning and other parts of windows defender atp. Or set default actions to allow.
search = index=wineventlog* (((HostApplication="*Set-MpPreference*" (HostApplication="*DisableRealtimeMonitoring 1*" OR HostApplication="*DisableBehaviorMonitoring 1*" OR HostApplication="*DisableScriptScanning 1*" OR HostApplication="*DisableArchiveScanning 1*" OR HostApplication="*DisableBlockAtFirstSeen 1*" OR HostApplication="*DisableIOAVProtection 1*" OR HostApplication="*DisableIntrusionPreventionSystem 1*" OR HostApplication="*DisableRemovableDriveScanning 1*" OR HostApplication="*DisableScanningMappedNetworkDrivesForFullScan 1*" OR HostApplication="*DisableScanningNetworkFiles 1*" OR HostApplication="*DisableRealtimeMonitoring $true*" OR HostApplication="*DisableBehaviorMonitoring $true*" OR HostApplication="*DisableScriptScanning $true*" OR HostApplication="*DisableArchiveScanning $true*" OR HostApplication="*DisableBlockAtFirstSeen $true*" OR HostApplication="*DisableIOAVProtection $true*" OR HostApplication="*DisableIntrusionPreventionSystem $true*" OR HostApplication="*DisableRemovableDriveScanning $true*" OR HostApplication="*DisableScanningMappedNetworkDrivesForFullScan $true*" OR HostApplication="*DisableScanningNetworkFiles $true*"))) OR (((HostApplication="*Set-MpPreference*" HostApplication="*Allow*" (HostApplication="*LowThreatDefaultAction*" OR HostApplication="*ModerateThreatDefaultAction*" OR HostApplication="*HighThreatDefaultAction*"))) OR (HostApplication="*ltdefac *" OR HostApplication="*mtdefac *" OR HostApplication="*htdefac *" OR HostApplication="*stdefac *"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.001" | eval sigma_title="Tamper Windows Defender - PSClassic" | eval sigma_description="Attempting to disable scheduled scanning and other parts of windows defender atp. Or set default actions to allow."
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Non PowerShell WSMAN COM Provider - powershell]
description = Detects suspicious use of the WSMAN provider without PowerShell.exe as the host application.
search = index=wineventlog* ((source="WinEventLog:Windows PowerShell" ProviderName="WSMan" NOT ((HostApplication="*powershell*")))) | eval sigma_attack_tags="attack.execution attack.t1059.001 attack.lateral_movement attack.t1021.003" | eval sigma_title="Suspicious Non PowerShell WSMAN COM Provider" | eval sigma_description="Detects suspicious use of the WSMAN provider without PowerShell.exe as the host application."
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious XOR Encoded PowerShell Command Line - PowerShell - powershell]
description = Detects suspicious powershell process which includes bxor command, alternative obfuscation method to b64 encoded commands.
search = index=wineventlog* ((HostName="ConsoleHost" (HostApplication="*bxor*" OR HostApplication="*join*" OR HostApplication="*char*"))) | eval sigma_attack_tags="attack.execution attack.t1059.001" | eval sigma_title="Suspicious XOR Encoded PowerShell Command Line - PowerShell" | eval sigma_description="Detects suspicious powershell process which includes bxor command, alternative obfuscation method to b64 encoded commands."
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential Active Directory Enumeration Using AD Module - PsModule - powershell]
description = Detects usage of the 'Import-Module' cmdlet to load the 'Microsoft.ActiveDirectory.Management.dl' DLL. Which is often used by attackers to perform AD enumeration.
search = index=wineventlog* (((Payload="*Import-Module *" OR Payload="*ipmo *") Payload="*Microsoft.ActiveDirectory.Management.dll*")) | eval sigma_attack_tags="attack.reconnaissance attack.discovery attack.impact" | eval sigma_title="Potential Active Directory Enumeration Using AD Module - PsModule" | eval sigma_description="Detects usage of the 'Import-Module' cmdlet to load the 'Microsoft.ActiveDirectory.Management.dl' DLL. Which is often used by attackers to perform AD enumeration."
dispatch.earliest_time = -24h@h
alert.track = 0

[Alternate PowerShell Hosts - PowerShell Module - powershell]
description = Detects alternate PowerShell hosts potentially bypassing detections looking for powershell.exe
search = index=wineventlog* ((ContextInfo="*" NOT ((((ContextInfo="*= powershell*" OR ContextInfo="*= C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell*" OR ContextInfo="*= C:\\Windows\\SysWOW64\\WindowsPowerShell\\v1.0\\powershell*" OR ContextInfo="*= C:/Windows/System32/WindowsPowerShell/v1.0/powershell*" OR ContextInfo="*= C:/Windows/SysWOW64/WindowsPowerShell/v1.0/powershell*"))) OR ((ContextInfo="*= C:\\WINDOWS\\System32\\sdiagnhost.exe -Embedding*")) OR ((ContextInfo="*ConfigSyncRun.exe*")) OR ((ContextInfo="*C:\\Windows\\system32\\dsac.exe*")) OR ((ContextInfo="*C:\\Windows\\system32\\wsmprovhost.exe -Embedding*")) OR (((Payload="*Update-Help*" OR Payload="*Failed to update Help for the module*")))))) | eval sigma_attack_tags="attack.execution attack.t1059.001" | eval sigma_title="Alternate PowerShell Hosts - PowerShell Module" | eval sigma_description="Detects alternate PowerShell hosts potentially bypassing detections looking for powershell.exe"
dispatch.earliest_time = -24h@h
alert.track = 0

[Bad Opsec Powershell Code Artifacts - powershell]
description = focuses on trivial artifacts observed in variants of prevalent offensive ps1 payloads, including
Cobalt Strike Beacon, PoshC2, Powerview, Letmein, Empire, Powersploit, and other attack payloads 
that often undergo minimal changes by attackers due to bad opsec.

search = index=wineventlog* (Payload="*$DoIt*" OR Payload="*harmj0y*" OR Payload="*mattifestation*" OR Payload="*_RastaMouse*" OR Payload="*tifkin_*" OR Payload="*0xdeadbeef*") | eval sigma_attack_tags="attack.execution attack.t1059.001" | eval sigma_title="Bad Opsec Powershell Code Artifacts" | eval sigma_description="focuses on trivial artifacts observed in variants of prevalent offensive ps1 payloads, including
Cobalt Strike Beacon, PoshC2, Powerview, Letmein, Empire, Powersploit, and other attack payloads 
that often undergo minimal changes by attackers due to bad opsec.
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Clear PowerShell History - PowerShell Module - powershell]
description = Detects keywords that could indicate clearing PowerShell history
search = index=wineventlog* ((((Payload="*Set-PSReadlineOption*" Payload="*–HistorySaveStyle*" Payload="*SaveNothing*")) OR ((Payload="*Set-PSReadlineOption*" Payload="*-HistorySaveStyle*" Payload="*SaveNothing*"))) OR (((Payload="*del*" OR Payload="*Remove-Item*" OR Payload="*rm*") Payload="*(Get-PSReadlineOption).HistorySavePath*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1070.003" | eval sigma_title="Clear PowerShell History - PowerShell Module" | eval sigma_description="Detects keywords that could indicate clearing PowerShell history"
dispatch.earliest_time = -24h@h
alert.track = 0

[PowerShell Decompress Commands - powershell]
description = A General detection for specific decompress commands in PowerShell logs. This could be an adversary decompressing files.
search = index=wineventlog* Payload="*Expand-Archive*" | eval sigma_attack_tags="attack.defense_evasion attack.t1140" | eval sigma_title="PowerShell Decompress Commands" | eval sigma_description="A General detection for specific decompress commands in PowerShell logs. This could be an adversary decompressing files."
dispatch.earliest_time = -24h@h
alert.track = 0

[Malicious PowerShell Scripts - PoshModule - powershell]
description = Detects the execution of known offensive powershell scripts used for exploitation or reconnaissance
search = index=wineventlog* ((ContextInfo="*Add-ConstrainedDelegationBackdoor.ps1*" OR ContextInfo="*Add-Exfiltration.ps1*" OR ContextInfo="*Add-Persistence.ps1*" OR ContextInfo="*Add-RegBackdoor.ps1*" OR ContextInfo="*Add-RemoteRegBackdoor.ps1*" OR ContextInfo="*Add-ScrnSaveBackdoor.ps1*" OR ContextInfo="*Check-VM.ps1*" OR ContextInfo="*ConvertTo-ROT13.ps1*" OR ContextInfo="*Copy-VSS.ps1*" OR ContextInfo="*Create-MultipleSessions.ps1*" OR ContextInfo="*DNS_TXT_Pwnage.ps1*" OR ContextInfo="*Do-Exfiltration.ps1*" OR ContextInfo="*DomainPasswordSpray.ps1*" OR ContextInfo="*Download_Execute.ps1*" OR ContextInfo="*Download-Execute-PS.ps1*" OR ContextInfo="*Enabled-DuplicateToken.ps1*" OR ContextInfo="*Enable-DuplicateToken.ps1*" OR ContextInfo="*Execute-Command-MSSQL.ps1*" OR ContextInfo="*Execute-DNSTXT-Code.ps1*" OR ContextInfo="*Execute-OnTime.ps1*" OR ContextInfo="*ExetoText.ps1*" OR ContextInfo="*Exploit-Jboss.ps1*" OR ContextInfo="*Find-AVSignature.ps1*" OR ContextInfo="*Find-Fruit.ps1*" OR ContextInfo="*Find-GPOLocation.ps1*" OR ContextInfo="*Find-TrustedDocuments.ps1*" OR ContextInfo="*FireBuster.ps1*" OR ContextInfo="*FireListener.ps1*" OR ContextInfo="*Get-ApplicationHost.ps1*" OR ContextInfo="*Get-ChromeDump.ps1*" OR ContextInfo="*Get-ClipboardContents.ps1*" OR ContextInfo="*Get-ComputerDetail.ps1*" OR ContextInfo="*Get-FoxDump.ps1*" OR ContextInfo="*Get-GPPAutologon.ps1*" OR ContextInfo="*Get-GPPPassword.ps1*" OR ContextInfo="*Get-IndexedItem.ps1*" OR ContextInfo="*Get-Keystrokes.ps1*" OR ContextInfo="*Get-LSASecret.ps1*" OR ContextInfo="*Get-MicrophoneAudio.ps1*" OR ContextInfo="*Get-PassHashes.ps1*" OR ContextInfo="*Get-PassHints.ps1*" OR ContextInfo="*Get-RegAlwaysInstallElevated.ps1*" OR ContextInfo="*Get-RegAutoLogon.ps1*" OR ContextInfo="*Get-RickAstley.ps1*" OR ContextInfo="*Get-Screenshot.ps1*" OR ContextInfo="*Get-SecurityPackages.ps1*" OR ContextInfo="*Get-ServiceFilePermission.ps1*" OR ContextInfo="*Get-ServicePermission.ps1*" OR ContextInfo="*Get-ServiceUnquoted.ps1*" OR ContextInfo="*Get-SiteListPassword.ps1*" OR ContextInfo="*Get-System.ps1*" OR ContextInfo="*Get-TimedScreenshot.ps1*" OR ContextInfo="*Get-UnattendedInstallFile.ps1*" OR ContextInfo="*Get-Unconstrained.ps1*" OR ContextInfo="*Get-USBKeystrokes.ps1*" OR ContextInfo="*Get-VaultCredential.ps1*" OR ContextInfo="*Get-VulnAutoRun.ps1*" OR ContextInfo="*Get-VulnSchTask.ps1*" OR ContextInfo="*Get-WebConfig.ps1*" OR ContextInfo="*Get-WebCredentials.ps1*" OR ContextInfo="*Get-WLAN-Keys.ps1*" OR ContextInfo="*Gupt-Backdoor.ps1*" OR ContextInfo="*HTTP-Backdoor.ps1*" OR ContextInfo="*HTTP-Login.ps1*" OR ContextInfo="*Install-ServiceBinary.ps1*" OR ContextInfo="*Install-SSP.ps1*" OR ContextInfo="*Invoke-ACLScanner.ps1*" OR ContextInfo="*Invoke-ADSBackdoor.ps1*" OR ContextInfo="*Invoke-AmsiBypass.ps1*" OR ContextInfo="*Invoke-ARPScan.ps1*" OR ContextInfo="*Invoke-BackdoorLNK.ps1*" OR ContextInfo="*Invoke-BadPotato.ps1*" OR ContextInfo="*Invoke-BetterSafetyKatz.ps1*" OR ContextInfo="*Invoke-BruteForce.ps1*" OR ContextInfo="*Invoke-BypassUAC.ps1*" OR ContextInfo="*Invoke-Carbuncle.ps1*" OR ContextInfo="*Invoke-Certify.ps1*" OR ContextInfo="*Invoke-ConPtyShell.ps1*" OR ContextInfo="*Invoke-CredentialInjection.ps1*" OR ContextInfo="*Invoke-CredentialsPhish.ps1*" OR ContextInfo="*Invoke-DAFT.ps1*" OR ContextInfo="*Invoke-DCSync.ps1*" OR ContextInfo="*Invoke-Decode.ps1*" OR ContextInfo="*Invoke-DinvokeKatz.ps1*" OR ContextInfo="*Invoke-DllInjection.ps1*" OR ContextInfo="*Invoke-DowngradeAccount.ps1*" OR ContextInfo="*Invoke-EgressCheck.ps1*" OR ContextInfo="*Invoke-Encode.ps1*" OR ContextInfo="*Invoke-EventViewer.ps1*" OR ContextInfo="*Invoke-Eyewitness.ps1*" OR ContextInfo="*Invoke-FakeLogonScreen.ps1*" OR ContextInfo="*Invoke-Farmer.ps1*" OR ContextInfo="*Invoke-Get-RBCD-Threaded.ps1*" OR ContextInfo="*Invoke-Gopher.ps1*" OR ContextInfo="*Invoke-Grouper2.ps1*" OR ContextInfo="*Invoke-Grouper3.ps1*" OR ContextInfo="*Invoke-HandleKatz.ps1*" OR ContextInfo="*Invoke-Interceptor.ps1*" OR ContextInfo="*Invoke-Internalmonologue.ps1*" OR ContextInfo="*Invoke-Inveigh.ps1*" OR ContextInfo="*Invoke-InveighRelay.ps1*" OR ContextInfo="*Invoke-JSRatRegsvr.ps1*" OR ContextInfo="*Invoke-JSRatRundll.ps1*" OR ContextInfo="*Invoke-KrbRelay.ps1*" OR ContextInfo="*Invoke-KrbRelayUp.ps1*" OR ContextInfo="*Invoke-LdapSignCheck.ps1*" OR ContextInfo="*Invoke-Lockless.ps1*" OR ContextInfo="*Invoke-MalSCCM.ps1*" OR ContextInfo="*Invoke-Mimikatz.ps1*" OR ContextInfo="*Invoke-MimikatzWDigestDowngrade.ps1*" OR ContextInfo="*Invoke-Mimikittenz.ps1*" OR ContextInfo="*Invoke-MITM6.ps1*" OR ContextInfo="*Invoke-NanoDump.ps1*" OR ContextInfo="*Invoke-NetRipper.ps1*" OR ContextInfo="*Invoke-NetworkRelay.ps1*" OR ContextInfo="*Invoke-NinjaCopy.ps1*" OR ContextInfo="*Invoke-OxidResolver.ps1*" OR ContextInfo="*Invoke-P0wnedshell.ps1*" OR ContextInfo="*Invoke-P0wnedshellx86.ps1*" OR ContextInfo="*Invoke-Paranoia.ps1*" OR ContextInfo="*Invoke-PortScan.ps1*" OR ContextInfo="*Invoke-PoshRatHttp.ps1*" OR ContextInfo="*Invoke-PoshRatHttps.ps1*" OR ContextInfo="*Invoke-PostExfil.ps1*" OR ContextInfo="*Invoke-PowerDump.ps1*" OR ContextInfo="*Invoke-PowerShellIcmp.ps1*" OR ContextInfo="*Invoke-PowerShellTCP.ps1*" OR ContextInfo="*Invoke-PowerShellTcpOneLine.ps1*" OR ContextInfo="*Invoke-PowerShellTcpOneLineBind.ps1*" OR ContextInfo="*Invoke-PowerShellUdp.ps1*" OR ContextInfo="*Invoke-PowerShellUdpOneLine.ps1*" OR ContextInfo="*Invoke-PowerShellWMI.ps1*" OR ContextInfo="*Invoke-PowerThIEf.ps1*" OR ContextInfo="*Invoke-PPLDump.ps1*" OR ContextInfo="*Invoke-Prasadhak.ps1*" OR ContextInfo="*Invoke-PsExec.ps1*" OR ContextInfo="*Invoke-PsGcat.ps1*" OR ContextInfo="*Invoke-PsGcatAgent.ps1*" OR ContextInfo="*Invoke-PSInject.ps1*" OR ContextInfo="*Invoke-PsUaCme.ps1*" OR ContextInfo="*Invoke-ReflectivePEInjection.ps1*" OR ContextInfo="*Invoke-ReverseDNSLookup.ps1*" OR ContextInfo="*Invoke-Rubeus.ps1*" OR ContextInfo="*Invoke-RunAs.ps1*" OR ContextInfo="*Invoke-SafetyKatz.ps1*" OR ContextInfo="*Invoke-SauronEye.ps1*" OR ContextInfo="*Invoke-SCShell.ps1*" OR ContextInfo="*Invoke-Seatbelt.ps1*" OR ContextInfo="*Invoke-ServiceAbuse.ps1*" OR ContextInfo="*Invoke-SessionGopher.ps1*" OR ContextInfo="*Invoke-ShellCode.ps1*" OR ContextInfo="*Invoke-SMBScanner.ps1*" OR ContextInfo="*Invoke-Snaffler.ps1*" OR ContextInfo="*Invoke-Spoolsample.ps1*" OR ContextInfo="*Invoke-SSHCommand.ps1*" OR ContextInfo="*Invoke-SSIDExfil.ps1*" OR ContextInfo="*Invoke-StandIn.ps1*" OR ContextInfo="*Invoke-StickyNotesExtract.ps1*" OR ContextInfo="*Invoke-Tater.ps1*" OR ContextInfo="*Invoke-Thunderfox.ps1*" OR ContextInfo="*Invoke-ThunderStruck.ps1*" OR ContextInfo="*Invoke-TokenManipulation.ps1*" OR ContextInfo="*Invoke-Tokenvator.ps1*" OR ContextInfo="*Invoke-TotalExec.ps1*" OR ContextInfo="*Invoke-UrbanBishop.ps1*" OR ContextInfo="*Invoke-UserHunter.ps1*" OR ContextInfo="*Invoke-VoiceTroll.ps1*" OR ContextInfo="*Invoke-Whisker.ps1*" OR ContextInfo="*Invoke-WinEnum.ps1*" OR ContextInfo="*Invoke-winPEAS.ps1*" OR ContextInfo="*Invoke-WireTap.ps1*" OR ContextInfo="*Invoke-WmiCommand.ps1*" OR ContextInfo="*Invoke-WScriptBypassUAC.ps1*" OR ContextInfo="*Invoke-Zerologon.ps1*" OR ContextInfo="*Keylogger.ps1*" OR ContextInfo="*MailRaider.ps1*" OR ContextInfo="*New-HoneyHash.ps1*" OR ContextInfo="*OfficeMemScraper.ps1*" OR ContextInfo="*Offline_Winpwn.ps1*" OR ContextInfo="*Out-CHM.ps1*" OR ContextInfo="*Out-DnsTxt.ps1*" OR ContextInfo="*Out-Excel.ps1*" OR ContextInfo="*Out-HTA.ps1*" OR ContextInfo="*Out-Java.ps1*" OR ContextInfo="*Out-JS.ps1*" OR ContextInfo="*Out-Minidump.ps1*" OR ContextInfo="*Out-RundllCommand.ps1*" OR ContextInfo="*Out-SCF.ps1*" OR ContextInfo="*Out-SCT.ps1*" OR ContextInfo="*Out-Shortcut.ps1*" OR ContextInfo="*Out-WebQuery.ps1*" OR ContextInfo="*Out-Word.ps1*" OR ContextInfo="*Parse_Keys.ps1*" OR ContextInfo="*Port-Scan.ps1*" OR ContextInfo="*PowerBreach.ps1*" OR ContextInfo="*powercat.ps1*" OR ContextInfo="*PowerRunAsSystem.psm1*" OR ContextInfo="*PowerSharpPack.ps1*" OR ContextInfo="*PowerUp.ps1*" OR ContextInfo="*PowerUpSQL.ps1*" OR ContextInfo="*PowerView.ps1*" OR ContextInfo="*PSAsyncShell.ps1*" OR ContextInfo="*RemoteHashRetrieval.ps1*" OR ContextInfo="*Remove-Persistence.ps1*" OR ContextInfo="*Remove-PoshRat.ps1*" OR ContextInfo="*Remove-Update.ps1*" OR ContextInfo="*Run-EXEonRemote.ps1*" OR ContextInfo="*Schtasks-Backdoor.ps1*" OR ContextInfo="*Set-DCShadowPermissions.ps1*" OR ContextInfo="*Set-MacAttribute.ps1*" OR ContextInfo="*Set-RemotePSRemoting.ps1*" OR ContextInfo="*Set-RemoteWMI.ps1*" OR ContextInfo="*Set-Wallpaper.ps1*" OR ContextInfo="*Show-TargetScreen.ps1*" OR ContextInfo="*Speak.ps1*" OR ContextInfo="*Start-CaptureServer.ps1*" OR ContextInfo="*Start-WebcamRecorder.ps1*" OR ContextInfo="*StringToBase64.ps1*" OR ContextInfo="*TexttoExe.ps1*" OR ContextInfo="*VolumeShadowCopyTools.ps1*" OR ContextInfo="*WinPwn.ps1*" OR ContextInfo="*WSUSpendu.ps1*") OR ((ContextInfo="*Invoke-Sharp*" ContextInfo="*.ps1*"))) | eval sigma_attack_tags="attack.execution attack.t1059.001" | eval sigma_title="Malicious PowerShell Scripts - PoshModule" | eval sigma_description="Detects the execution of known offensive powershell scripts used for exploitation or reconnaissance"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Get-ADDBAccount Usage - powershell]
description = Detects suspicious invocation of the Get-ADDBAccount script that reads from a ntds.dit file and may be used to get access to credentials without using any credential dumpers
search = index=wineventlog* ((Payload="*Get-ADDBAccount*" Payload="*BootKey *" Payload="*DatabasePath *")) | eval sigma_attack_tags="attack.credential_access attack.t1003.003" | eval sigma_title="Suspicious Get-ADDBAccount Usage" | eval sigma_description="Detects suspicious invocation of the Get-ADDBAccount script that reads from a ntds.dit file and may be used to get access to credentials without using any credential dumpers"
dispatch.earliest_time = -24h@h
alert.track = 0

[PowerShell Get Clipboard - powershell]
description = A General detection for the Get-Clipboard commands in PowerShell logs. This could be an adversary capturing clipboard contents.
search = index=wineventlog* Payload="*Get-Clipboard*" | eval sigma_attack_tags="attack.collection attack.t1115" | eval sigma_title="PowerShell Get Clipboard" | eval sigma_description="A General detection for the Get-Clipboard commands in PowerShell logs. This could be an adversary capturing clipboard contents."
dispatch.earliest_time = -24h@h
alert.track = 0

[Invoke-Obfuscation COMPRESS OBFUSCATION - PowerShell Module - powershell]
description = Detects Obfuscated Powershell via COMPRESS OBFUSCATION
search = index=wineventlog* ((Payload="*new-object*" Payload="*text.encoding]::ascii*" (Payload="*system.io.compression.deflatestream*" OR Payload="*system.io.streamreader*") Payload="*readtoend")) | eval sigma_attack_tags="attack.defense_evasion attack.t1027 attack.execution attack.t1059.001" | eval sigma_title="Invoke-Obfuscation COMPRESS OBFUSCATION - PowerShell Module" | eval sigma_description="Detects Obfuscated Powershell via COMPRESS OBFUSCATION"
dispatch.earliest_time = -24h@h
alert.track = 0

[Invoke-Obfuscation RUNDLL LAUNCHER - PowerShell Module - powershell]
description = Detects Obfuscated Powershell via RUNDLL LAUNCHER
search = index=wineventlog* ((Payload="*rundll32.exe*" Payload="*shell32.dll*" Payload="*shellexec_rundll*" Payload="*powershell*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1027 attack.execution attack.t1059.001" | eval sigma_title="Invoke-Obfuscation RUNDLL LAUNCHER - PowerShell Module" | eval sigma_description="Detects Obfuscated Powershell via RUNDLL LAUNCHER"
dispatch.earliest_time = -24h@h
alert.track = 0

[Invoke-Obfuscation Via Use MSHTA - PowerShell Module - powershell]
description = Detects Obfuscated Powershell via use MSHTA in Scripts
search = index=wineventlog* ((Payload="*set*" Payload="*&&*" Payload="*mshta*" Payload="*vbscript:createobject*" Payload="*.run*" Payload="*(window.close)*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1027 attack.execution attack.t1059.001" | eval sigma_title="Invoke-Obfuscation Via Use MSHTA - PowerShell Module" | eval sigma_description="Detects Obfuscated Powershell via use MSHTA in Scripts"
dispatch.earliest_time = -24h@h
alert.track = 0

[Invoke-Obfuscation Via Use Rundll32 - PowerShell Module - powershell]
description = Detects Obfuscated Powershell via use Rundll32 in Scripts
search = index=wineventlog* ((Payload="*&&*" Payload="*rundll32*" Payload="*shell32.dll*" Payload="*shellexec_rundll*" (Payload="*value*" OR Payload="*invoke*" OR Payload="*comspec*" OR Payload="*iex*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1027 attack.execution attack.t1059.001" | eval sigma_title="Invoke-Obfuscation Via Use Rundll32 - PowerShell Module" | eval sigma_description="Detects Obfuscated Powershell via use Rundll32 in Scripts"
dispatch.earliest_time = -24h@h
alert.track = 0

[Malicious PowerShell Commandlets - PoshModule - powershell]
description = Detects Commandlet names from well-known PowerShell exploitation frameworks
search = index=wineventlog* (Payload="*Add-Exfiltration*" OR Payload="*Add-Persistence*" OR Payload="*Add-RegBackdoor*" OR Payload="*Add-RemoteRegBackdoor*" OR Payload="*Add-ScrnSaveBackdoor*" OR Payload="*Check-VM*" OR Payload="*ConvertTo-Rc4ByteStream*" OR Payload="*Decrypt-Hash*" OR Payload="*Do-Exfiltration*" OR Payload="*Enabled-DuplicateToken*" OR Payload="*Exploit-Jboss*" OR Payload="*Find-Fruit*" OR Payload="*Find-GPOLocation*" OR Payload="*Find-TrustedDocuments*" OR Payload="*Get-ApplicationHost*" OR Payload="*Get-ChromeDump*" OR Payload="*Get-ClipboardContents*" OR Payload="*Get-FoxDump*" OR Payload="*Get-GPPPassword*" OR Payload="*Get-IndexedItem*" OR Payload="*Get-Keystrokes*" OR Payload="*Get-LSASecret*" OR Payload="*Get-PassHashes*" OR Payload="*Get-RegAlwaysInstallElevated*" OR Payload="*Get-RegAutoLogon*" OR Payload="*Get-RemoteBootKey*" OR Payload="*Get-RemoteCachedCredential*" OR Payload="*Get-RemoteLocalAccountHash*" OR Payload="*Get-RemoteLSAKey*" OR Payload="*Get-RemoteMachineAccountHash*" OR Payload="*Get-RemoteNLKMKey*" OR Payload="*Get-RickAstley*" OR Payload="*Get-Screenshot*" OR Payload="*Get-SecurityPackages*" OR Payload="*Get-ServiceFilePermission*" OR Payload="*Get-ServicePermission*" OR Payload="*Get-ServiceUnquoted*" OR Payload="*Get-SiteListPassword*" OR Payload="*Get-System*" OR Payload="*Get-TimedScreenshot*" OR Payload="*Get-UnattendedInstallFile*" OR Payload="*Get-Unconstrained*" OR Payload="*Get-USBKeystrokes*" OR Payload="*Get-VaultCredential*" OR Payload="*Get-VulnAutoRun*" OR Payload="*Get-VulnSchTask*" OR Payload="*Gupt-Backdoor*" OR Payload="*HTTP-Login*" OR Payload="*Install-ServiceBinary*" OR Payload="*Install-SSP*" OR Payload="*Invoke-ACLScanner*" OR Payload="*Invoke-ADSBackdoor*" OR Payload="*Invoke-AllChecks*" OR Payload="*Invoke-ARPScan*" OR Payload="*Invoke-AzureHound*" OR Payload="*Invoke-BackdoorLNK*" OR Payload="*Invoke-BadPotato*" OR Payload="*Invoke-BetterSafetyKatz*" OR Payload="*Invoke-BypassUAC*" OR Payload="*Invoke-Carbuncle*" OR Payload="*Invoke-Certify*" OR Payload="*Invoke-ConPtyShell*" OR Payload="*Invoke-CredentialInjection*" OR Payload="*Invoke-DAFT*" OR Payload="*Invoke-DCSync*" OR Payload="*Invoke-DinvokeKatz*" OR Payload="*Invoke-DllInjection*" OR Payload="*Invoke-DomainPasswordSpray*" OR Payload="*Invoke-DowngradeAccount*" OR Payload="*Invoke-EgressCheck*" OR Payload="*Invoke-Eyewitness*" OR Payload="*Invoke-FakeLogonScreen*" OR Payload="*Invoke-Farmer*" OR Payload="*Invoke-Get-RBCD-Threaded*" OR Payload="*Invoke-Gopher*" OR Payload="*Invoke-Grouper*" OR Payload="*Invoke-HandleKatz*" OR Payload="*Invoke-ImpersonatedProcess*" OR Payload="*Invoke-ImpersonateSystem*" OR Payload="*Invoke-InteractiveSystemPowerShell*" OR Payload="*Invoke-Internalmonologue*" OR Payload="*Invoke-Inveigh*" OR Payload="*Invoke-InveighRelay*" OR Payload="*Invoke-KrbRelay*" OR Payload="*Invoke-LdapSignCheck*" OR Payload="*Invoke-Lockless*" OR Payload="*Invoke-MalSCCM*" OR Payload="*Invoke-Mimikatz*" OR Payload="*Invoke-Mimikittenz*" OR Payload="*Invoke-MITM6*" OR Payload="*Invoke-NanoDump*" OR Payload="*Invoke-NetRipper*" OR Payload="*Invoke-Nightmare*" OR Payload="*Invoke-NinjaCopy*" OR Payload="*Invoke-OfficeScrape*" OR Payload="*Invoke-OxidResolver*" OR Payload="*Invoke-P0wnedshell*" OR Payload="*Invoke-Paranoia*" OR Payload="*Invoke-PortScan*" OR Payload="*Invoke-PoshRatHttp*" OR Payload="*Invoke-PostExfil*" OR Payload="*Invoke-PowerDump*" OR Payload="*Invoke-PowerShellTCP*" OR Payload="*Invoke-PowerShellWMI*" OR Payload="*Invoke-PPLDump*" OR Payload="*Invoke-PsExec*" OR Payload="*Invoke-PSInject*" OR Payload="*Invoke-PsUaCme*" OR Payload="*Invoke-ReflectivePEInjection*" OR Payload="*Invoke-ReverseDNSLookup*" OR Payload="*Invoke-Rubeus*" OR Payload="*Invoke-RunAs*" OR Payload="*Invoke-SafetyKatz*" OR Payload="*Invoke-SauronEye*" OR Payload="*Invoke-SCShell*" OR Payload="*Invoke-Seatbelt*" OR Payload="*Invoke-ServiceAbuse*" OR Payload="*Invoke-ShadowSpray*" OR Payload="*Invoke-Sharp*" OR Payload="*Invoke-Shellcode*" OR Payload="*Invoke-SMBScanner*" OR Payload="*Invoke-Snaffler*" OR Payload="*Invoke-Spoolsample*" OR Payload="*Invoke-SpraySinglePassword*" OR Payload="*Invoke-SSHCommand*" OR Payload="*Invoke-StandIn*" OR Payload="*Invoke-StickyNotesExtract*" OR Payload="*Invoke-SystemCommand*" OR Payload="*Invoke-Tasksbackdoor*" OR Payload="*Invoke-Tater*" OR Payload="*Invoke-Thunderfox*" OR Payload="*Invoke-ThunderStruck*" OR Payload="*Invoke-TokenManipulation*" OR Payload="*Invoke-Tokenvator*" OR Payload="*Invoke-TotalExec*" OR Payload="*Invoke-UrbanBishop*" OR Payload="*Invoke-UserHunter*" OR Payload="*Invoke-VoiceTroll*" OR Payload="*Invoke-Whisker*" OR Payload="*Invoke-WinEnum*" OR Payload="*Invoke-winPEAS*" OR Payload="*Invoke-WireTap*" OR Payload="*Invoke-WmiCommand*" OR Payload="*Invoke-WScriptBypassUAC*" OR Payload="*Invoke-Zerologon*" OR Payload="*MailRaider*" OR Payload="*New-HoneyHash*" OR Payload="*New-InMemoryModule*" OR Payload="*Out-Minidump*" OR Payload="*Port-Scan*" OR Payload="*PowerBreach*" OR Payload="*powercat *" OR Payload="*PowerUp*" OR Payload="*PowerView*" OR Payload="*Remove-Update*" OR Payload="*Set-MacAttribute*" OR Payload="*Set-Wallpaper*" OR Payload="*Show-TargetScreen*" OR Payload="*Start-CaptureServer*" OR Payload="*Start-WebcamRecorder*" OR Payload="*VolumeShadowCopyTools*") | eval sigma_attack_tags="attack.execution attack.discovery attack.t1482 attack.t1087 attack.t1087.001 attack.t1087.002 attack.t1069.001 attack.t1069.002 attack.t1069 attack.t1059.001" | eval sigma_title="Malicious PowerShell Commandlets - PoshModule" | eval sigma_description="Detects Commandlet names from well-known PowerShell exploitation frameworks"
dispatch.earliest_time = -24h@h
alert.track = 0

[Remote PowerShell Session (PS Module) - powershell]
description = Detects remote PowerShell sessions
search = index=wineventlog* ((((ContextInfo="* = ServerRemoteHost *" ContextInfo="*wsmprovhost.exe*")) NOT (((ContextInfo="*\\Windows\\system32\\WindowsPowerShell\\v1.0\\Modules\\Microsoft.PowerShell.Archive\\Microsoft.PowerShell.Archive.psm1*"))))) | eval sigma_attack_tags="attack.execution attack.t1059.001 attack.lateral_movement attack.t1021.006" | eval sigma_title="Remote PowerShell Session (PS Module)" | eval sigma_description="Detects remote PowerShell sessions"
dispatch.earliest_time = -24h@h
alert.track = 0

[AD Groups Or Users Enumeration Using PowerShell - PoshModule - powershell]
description = Adversaries may attempt to find domain-level groups and permission settings.
The knowledge of domain-level permission groups can help adversaries determine which groups exist and which users belong to a particular group.
Adversaries may use this information to determine which users have elevated permissions, such as domain administrators.

search = index=wineventlog* (Payload="*get-ADPrincipalGroupMembership*" OR ContextInfo="*get-ADPrincipalGroupMembership*" OR ((Payload="*get-aduser*" Payload="*-f *" Payload="*-pr *" Payload="*DoesNotRequirePreAuth*")) OR ((ContextInfo="*get-aduser*" ContextInfo="*-f *" ContextInfo="*-pr *" ContextInfo="*DoesNotRequirePreAuth*"))) | eval sigma_attack_tags="attack.discovery attack.t1069.001" | eval sigma_title="AD Groups Or Users Enumeration Using PowerShell - PoshModule" | eval sigma_description="Adversaries may attempt to find domain-level groups and permission settings.
The knowledge of domain-level permission groups can help adversaries determine which groups exist and which users belong to a particular group.
Adversaries may use this information to determine which users have elevated permissions, such as domain administrators.
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Abusable Invoke-ATHRemoteFXvGPUDisablementCommand - PowerShell Module - powershell]
description = RemoteFXvGPUDisablement.exe is an abusable, signed PowerShell host executable that was introduced in Windows 10 and Server 2019 (OS Build 17763.1339).
search = index=wineventlog* ((ContextInfo="*Invoke-ATHRemoteFXvGPUDisablementCommand *" (ContextInfo="*-ModuleName *" OR ContextInfo="*-ModulePath *" OR ContextInfo="*-ScriptBlock *" OR ContextInfo="*-RemoteFXvGPUDisablementFilePath*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218" | eval sigma_title="Abusable Invoke-ATHRemoteFXvGPUDisablementCommand - PowerShell Module" | eval sigma_description="RemoteFXvGPUDisablement.exe is an abusable, signed PowerShell host executable that was introduced in Windows 10 and Server 2019 (OS Build 17763.1339)."
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious PowerShell Download - PoshModule - powershell]
description = Detects suspicious PowerShell download command
search = index=wineventlog* ((ContextInfo="*System.Net.WebClient*" (ContextInfo="*.DownloadFile(*" OR ContextInfo="*.DownloadString(*"))) | eval sigma_attack_tags="attack.execution attack.t1059.001" | eval sigma_title="Suspicious PowerShell Download - PoshModule" | eval sigma_description="Detects suspicious PowerShell download command"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious PowerShell Invocations - Generic - PowerShell Module - powershell]
description = Detects suspicious PowerShell invocation command parameters
search = index=wineventlog* (((ContextInfo="* -enc *" OR ContextInfo="* -EncodedCommand *" OR ContextInfo="* -ec *") (ContextInfo="* -w hidden *" OR ContextInfo="* -window hidden *" OR ContextInfo="* -windowstyle hidden *" OR ContextInfo="* -w 1 *") (ContextInfo="* -noni *" OR ContextInfo="* -noninteractive *"))) | eval sigma_attack_tags="attack.execution attack.t1059.001" | eval sigma_title="Suspicious PowerShell Invocations - Generic - PowerShell Module" | eval sigma_description="Detects suspicious PowerShell invocation command parameters"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious PowerShell Invocations - Specific - PowerShell Module - powershell]
description = Detects suspicious PowerShell invocation command parameters
search = index=wineventlog* (((((ContextInfo="*-nop*" ContextInfo="* -w *" ContextInfo="*hidden*" ContextInfo="* -c *" ContextInfo="*[Convert]::FromBase64String*")) OR ((ContextInfo="* -w *" ContextInfo="*hidden*" ContextInfo="*-noni*" ContextInfo="*-nop*" ContextInfo="* -c *" ContextInfo="*iex*" ContextInfo="*New-Object*")) OR ((ContextInfo="* -w *" ContextInfo="*hidden*" ContextInfo="*-ep*" ContextInfo="*bypass*" ContextInfo="*-Enc*")) OR ((ContextInfo="*powershell*" ContextInfo="*reg*" ContextInfo="*add*" ContextInfo="*HKCU\\software\\microsoft\\windows\\currentversion\\run*")) OR ((ContextInfo="*bypass*" ContextInfo="*-noprofile*" ContextInfo="*-windowstyle*" ContextInfo="*hidden*" ContextInfo="*new-object*" ContextInfo="*system.net.webclient*" ContextInfo="*.download*")) OR ((ContextInfo="*iex*" ContextInfo="*New-Object*" ContextInfo="*Net.WebClient*" ContextInfo="*.Download*"))) NOT ((((ContextInfo="*(New-Object System.Net.WebClient).DownloadString('https://community.chocolatey.org/install.ps1*" OR ContextInfo="*Write-ChocolateyWarning*")))))) | eval sigma_attack_tags="attack.execution attack.t1059.001" | eval sigma_title="Suspicious PowerShell Invocations - Specific - PowerShell Module" | eval sigma_description="Detects suspicious PowerShell invocation command parameters"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Get Local Groups Information - powershell]
description = Adversaries may attempt to find local system groups and permission settings.
The knowledge of local system permission groups can help adversaries determine which groups exist and which users belong to a particular group.
Adversaries may use this information to determine which users have elevated permissions, such as the users found within the local administrators group.

search = index=wineventlog* ((Payload="*get-localgroup*" OR Payload="*Get-LocalGroupMember*") OR (ContextInfo="*get-localgroup*" OR ContextInfo="*Get-LocalGroupMember*") OR ((Payload="*Get-WMIObject*" Payload="*Win32_Group*")) OR ((ContextInfo="*Get-WMIObject*" ContextInfo="*Win32_Group*"))) | eval sigma_attack_tags="attack.discovery attack.t1069.001" | eval sigma_title="Suspicious Get Local Groups Information" | eval sigma_description="Adversaries may attempt to find local system groups and permission settings.
The knowledge of local system permission groups can help adversaries determine which groups exist and which users belong to a particular group.
Adversaries may use this information to determine which users have elevated permissions, such as the users found within the local administrators group.
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Computer Machine Password by PowerShell - powershell]
description = The Reset-ComputerMachinePassword cmdlet changes the computer account password that the computers use to authenticate to the domain controllers in the domain.
You can use it to reset the password of the local computer.

search = index=wineventlog* ContextInfo="*Reset-ComputerMachinePassword*" | eval sigma_attack_tags="attack.initial_access attack.t1078" | eval sigma_title="Suspicious Computer Machine Password by PowerShell" | eval sigma_description="The Reset-ComputerMachinePassword cmdlet changes the computer account password that the computers use to authenticate to the domain controllers in the domain.
You can use it to reset the password of the local computer.
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Get Information for SMB Share - PowerShell Module - powershell]
description = Adversaries may look for folders and drives shared on remote systems as a means of identifying sources of information to gather as a precursor for Collection and
to identify potential systems of interest for Lateral Movement.
Networks often contain shared network drives and folders that enable users to access file directories on various systems across a network.

search = index=wineventlog* (Payload="*get-smbshare*" OR ContextInfo="*get-smbshare*") | eval sigma_attack_tags="attack.discovery attack.t1069.001" | eval sigma_title="Suspicious Get Information for SMB Share - PowerShell Module" | eval sigma_description="Adversaries may look for folders and drives shared on remote systems as a means of identifying sources of information to gather as a precursor for Collection and
to identify potential systems of interest for Lateral Movement.
Networks often contain shared network drives and folders that enable users to access file directories on various systems across a network.
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Zip A Folder With PowerShell For Staging In Temp  - PowerShell Module - powershell]
description = Use living off the land tools to zip a file and stage it in the Windows temporary folder for later exfiltration
search = index=wineventlog* ((ContextInfo="*Compress-Archive *" ContextInfo="* -Path *" ContextInfo="* -DestinationPath *" ContextInfo="*$env:TEMP\\*")) | eval sigma_attack_tags="attack.collection attack.t1074.001" | eval sigma_title="Zip A Folder With PowerShell For Staging In Temp  - PowerShell Module" | eval sigma_description="Use living off the land tools to zip a file and stage it in the Windows temporary folder for later exfiltration"
dispatch.earliest_time = -24h@h
alert.track = 0

[SyncAppvPublishingServer Bypass Powershell Restriction - PS Module - powershell]
description = Detects SyncAppvPublishingServer process execution which usually utilized by adversaries to bypass PowerShell execution restrictions.
search = index=wineventlog* ContextInfo="*SyncAppvPublishingServer.exe*" | eval sigma_attack_tags="attack.defense_evasion attack.t1218" | eval sigma_title="SyncAppvPublishingServer Bypass Powershell Restriction - PS Module" | eval sigma_description="Detects SyncAppvPublishingServer process execution which usually utilized by adversaries to bypass PowerShell execution restrictions."
dispatch.earliest_time = -24h@h
alert.track = 0

[AADInternals PowerShell Cmdlets Execution - PsScript - powershell]
description = Detects ADDInternals Cmdlet execution. A tool for administering Azure AD and Office 365. Which can be abused by threat actors to attack Azure AD or Office 365.
search = index=wineventlog* (ScriptBlockText="*Add-AADInt*" OR ScriptBlockText="*ConvertTo-AADInt*" OR ScriptBlockText="*Disable-AADInt*" OR ScriptBlockText="*Enable-AADInt*" OR ScriptBlockText="*Export-AADInt*" OR ScriptBlockText="*Get-AADInt*" OR ScriptBlockText="*Grant-AADInt*" OR ScriptBlockText="*Install-AADInt*" OR ScriptBlockText="*Invoke-AADInt*" OR ScriptBlockText="*Join-AADInt*" OR ScriptBlockText="*New-AADInt*" OR ScriptBlockText="*Open-AADInt*" OR ScriptBlockText="*Read-AADInt*" OR ScriptBlockText="*Register-AADInt*" OR ScriptBlockText="*Remove-AADInt*" OR ScriptBlockText="*Restore-AADInt*" OR ScriptBlockText="*Search-AADInt*" OR ScriptBlockText="*Send-AADInt*" OR ScriptBlockText="*Set-AADInt*" OR ScriptBlockText="*Start-AADInt*" OR ScriptBlockText="*Update-AADInt*") | eval sigma_attack_tags="attack.execution attack.reconnaissance attack.discovery attack.credential_access attack.impact" | eval sigma_title="AADInternals PowerShell Cmdlets Execution - PsScript" | eval sigma_description="Detects ADDInternals Cmdlet execution. A tool for administering Azure AD and Office 365. Which can be abused by threat actors to attack Azure AD or Office 365."
dispatch.earliest_time = -24h@h
alert.track = 0

[Access to Browser Login Data - powershell]
description = Adversaries may acquire credentials from web browsers by reading files specific to the target browser.
Web browsers commonly save credentials such as website usernames and passwords so that they do not need to be entered manually in the future.
Web browsers typically store the credentials in an encrypted format within a credential store.

search = index=wineventlog* ((ScriptBlockText="*Copy-Item*" ScriptBlockText="*-Destination*" (ScriptBlockText="*\\Opera Software\\Opera Stable\\Login Data*" OR ScriptBlockText="*\\Mozilla\\Firefox\\Profiles*" OR ScriptBlockText="*\\Microsoft\\Edge\\User Data\\Default*" OR ScriptBlockText="*\\Google\\Chrome\\User Data\\Default\\Login Data*" OR ScriptBlockText="*\\Google\\Chrome\\User Data\\Default\\Login Data For Account*"))) | eval sigma_attack_tags="attack.credential_access attack.t1555.003" | eval sigma_title="Access to Browser Login Data" | eval sigma_description="Adversaries may acquire credentials from web browsers by reading files specific to the target browser.
Web browsers commonly save credentials such as website usernames and passwords so that they do not need to be entered manually in the future.
Web browsers typically store the credentials in an encrypted format within a credential store.
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential WinAPI Calls Via PowerShell Scripts - powershell]
description = Detects use of WinAPI Functions in PowerShell scripts
search = index=wineventlog* (((ScriptBlockText="*AddSecurityPackage*" OR ScriptBlockText="*AdjustTokenPrivileges*" OR ScriptBlockText="*Advapi32*" OR ScriptBlockText="*CloseHandle*" OR ScriptBlockText="*CreateProcessWithToken*" OR ScriptBlockText="*CreateRemoteThread*" OR ScriptBlockText="*CreateThread*" OR ScriptBlockText="*CreateUserThread*" OR ScriptBlockText="*DangerousGetHandle*" OR ScriptBlockText="*DuplicateTokenEx*" OR ScriptBlockText="*EnumerateSecurityPackages*" OR ScriptBlockText="*FreeLibrary*" OR ScriptBlockText="*GetDelegateForFunctionPointer*" OR ScriptBlockText="*GetLogonSessionData*" OR ScriptBlockText="*GetModuleHandle*" OR ScriptBlockText="*GetProcAddress*" OR ScriptBlockText="*GetProcessHandle*" OR ScriptBlockText="*GetTokenInformation*" OR ScriptBlockText="*ImpersonateLoggedOnUser*" OR ScriptBlockText="*kernel32*" OR ScriptBlockText="*LoadLibrary*" OR ScriptBlockText="*memcpy*" OR ScriptBlockText="*MiniDumpWriteDump*" OR ScriptBlockText="*msvcrt*" OR ScriptBlockText="*ntdll*" OR ScriptBlockText="*OpenDesktop*" OR ScriptBlockText="*OpenProcess*" OR ScriptBlockText="*OpenProcessToken*" OR ScriptBlockText="*OpenThreadToken*" OR ScriptBlockText="*OpenWindowStation*" OR ScriptBlockText="*QueueUserApc*" OR ScriptBlockText="*ReadProcessMemory*" OR ScriptBlockText="*RevertToSelf*" OR ScriptBlockText="*RtlCreateUserThread*" OR ScriptBlockText="*secur32*" OR ScriptBlockText="*SetThreadToken*" OR ScriptBlockText="*VirtualAlloc*" OR ScriptBlockText="*VirtualFree*" OR ScriptBlockText="*VirtualProtect*" OR ScriptBlockText="*WaitForSingleObject*" OR ScriptBlockText="*WriteInt32*" OR ScriptBlockText="*WriteProcessMemory*" OR ScriptBlockText="*ZeroFreeGlobalAllocUnicode*") NOT (((ScriptBlockText="# Copyright 2016 Amazon.com, Inc. or its affiliates.*" ScriptBlockText="*function Import-SerialPortUtil *"))))) | eval sigma_attack_tags="attack.execution attack.t1059.001 attack.t1106" | eval sigma_title="Potential WinAPI Calls Via PowerShell Scripts" | eval sigma_description="Detects use of WinAPI Functions in PowerShell scripts"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential Active Directory Enumeration Using AD Module - PsScript - powershell]
description = Detects usage of the 'Import-Module' cmdlet to load the 'Microsoft.ActiveDirectory.Management.dl' DLL. Which is often used by attackers to perform AD enumeration.
search = index=wineventlog* (((ScriptBlockText="*Import-Module *" ScriptBlockText="*Microsoft.ActiveDirectory.Management.dll*")) OR ScriptBlockText="*ipmo Microsoft.ActiveDirectory.Management.dll*") | eval sigma_attack_tags="attack.reconnaissance attack.discovery attack.impact" | eval sigma_title="Potential Active Directory Enumeration Using AD Module - PsScript" | eval sigma_description="Detects usage of the 'Import-Module' cmdlet to load the 'Microsoft.ActiveDirectory.Management.dl' DLL. Which is often used by attackers to perform AD enumeration."
dispatch.earliest_time = -24h@h
alert.track = 0

[Powershell Add Name Resolution Policy Table Rule - powershell]
description = Detects powershell scripts that adds a Name Resolution Policy Table (NRPT) rule for the specified namespace.
This will bypass the default DNS server and uses a specified server for answering the query.

search = index=wineventlog* ((ScriptBlockText="*Add-DnsClientNrptRule*" ScriptBlockText="*-Namesp*" ScriptBlockText="*-NameSe*")) | eval sigma_attack_tags="attack.impact attack.t1565" | eval sigma_title="Powershell Add Name Resolution Policy Table Rule" | eval sigma_description="Detects powershell scripts that adds a Name Resolution Policy Table (NRPT) rule for the specified namespace.
This will bypass the default DNS server and uses a specified server for answering the query.
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Add New Windows Capability - ScriptBlock - powershell]
description = Detects usage of the 'Add-WindowsCapability' cmdlet to add new windows capabilities. Notable capabilities could be 'OpenSSH' and others.
search = index=wineventlog* ((ScriptBlockText="*Add-WindowsCapability *" ScriptBlockText="*OpenSSH.*")) | eval sigma_attack_tags="attack.execution" | eval sigma_title="Add New Windows Capability - ScriptBlock" | eval sigma_description="Detects usage of the 'Add-WindowsCapability' cmdlet to add new windows capabilities. Notable capabilities could be 'OpenSSH' and others."
dispatch.earliest_time = -24h@h
alert.track = 0

[PowerShell ADRecon Execution - powershell]
description = Detects execution of ADRecon.ps1 for AD reconnaissance which has been reported to be actively used by FIN7
search = index=wineventlog* (ScriptBlockText="*Function Get-ADRExcelComOb*" OR ScriptBlockText="*Get-ADRGPO*" OR ScriptBlockText="*Get-ADRDomainController*" OR ScriptBlockText="*ADRecon-Report.xlsx*") | eval sigma_attack_tags="attack.discovery attack.execution attack.t1059.001" | eval sigma_title="PowerShell ADRecon Execution" | eval sigma_description="Detects execution of ADRecon.ps1 for AD reconnaissance which has been reported to be actively used by FIN7"
dispatch.earliest_time = -24h@h
alert.track = 0

[AMSI Bypass Pattern Assembly GetType - powershell]
description = Detects code fragments found in small and obfuscated AMSI bypass PowerShell scripts
search = index=wineventlog* ((ScriptBlockText="*[Ref].Assembly.GetType*" ScriptBlockText="*SetValue($null,$true)*" ScriptBlockText="*NonPublic,Static*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.001 attack.execution" | eval sigma_title="AMSI Bypass Pattern Assembly GetType" | eval sigma_description="Detects code fragments found in small and obfuscated AMSI bypass PowerShell scripts"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential AMSI Bypass Using NULL Bits - ScriptBlockLogging - powershell]
description = Detects usage of special strings/null bits in order to potentially bypass AMSI functionalities
search = index=wineventlog* ((((source = "WinEventLog:Microsoft-Windows-PowerShell/Operational" OR source = "WinEventLog:PowerShellCore/Operational" OR source = "WinEventLog:PowerShellCore/Operational" OR sourcetype = "WinEventLog:Microsoft-Windows-PowerShell/Operational" OR sourcetype = "WinEventLog:PowerShellCore/Operational" OR sourcetype = "WinEventLog:PowerShellCore/Operational") OR source="WinEventLog:PowerShellCore/Operational") (ScriptBlockLogging="*if(0){{{0}}}' -f $(0 -as [char]) +*" OR ScriptBlockLogging="*#<NULL>*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.001" | eval sigma_title="Potential AMSI Bypass Using NULL Bits - ScriptBlockLogging" | eval sigma_description="Detects usage of special strings/null bits in order to potentially bypass AMSI functionalities"
dispatch.earliest_time = -24h@h
alert.track = 0

[Silence.EDA Detection - powershell]
description = Detects Silence EmpireDNSAgent as described in the Group-IP report
search = index=wineventlog* ((((source = "WinEventLog:Microsoft-Windows-PowerShell/Operational" OR source = "WinEventLog:PowerShellCore/Operational" OR source = "WinEventLog:PowerShellCore/Operational" OR sourcetype = "WinEventLog:Microsoft-Windows-PowerShell/Operational" OR sourcetype = "WinEventLog:PowerShellCore/Operational" OR sourcetype = "WinEventLog:PowerShellCore/Operational") OR source="WinEventLog:PowerShellCore/Operational") ScriptBlockText="*System.Diagnostics.Process*" ScriptBlockText="*Stop-Computer*" ScriptBlockText="*Restart-Computer*" ScriptBlockText="*Exception in execution*" ScriptBlockText="*$cmdargs*" ScriptBlockText="*Close-Dnscat2Tunnel*" ScriptBlockText="*set type=$LookupType`nserver*" ScriptBlockText="*$Command | nslookup 2>&1 | Out-String*" ScriptBlockText="*New-RandomDNSField*" ScriptBlockText="*[Convert]::ToString($SYNOptions, 16)*" ScriptBlockText="*$Session.Dead = $True*" ScriptBlockText="*$Session[\"Driver\"] -eq*")) | eval sigma_attack_tags="attack.execution attack.t1059.001 attack.command_and_control attack.t1071.004 attack.t1572 attack.impact attack.t1529 attack.g0091 attack.s0363" | eval sigma_title="Silence.EDA Detection" | eval sigma_description="Detects Silence EmpireDNSAgent as described in the Group-IP report"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential Data Exfiltration Via Audio File - powershell]
description = Detects potential exfiltration attempt via audio file using PowerShell
search = index=wineventlog* ((ScriptBlockText="*[System.Math]::*" ScriptBlockText="*[IO.FileMode]::*" ScriptBlockText="*BinaryWriter*" ScriptBlockText="*0x52*" ScriptBlockText="*0x49*" ScriptBlockText="*0x46*" ScriptBlockText="*0x57*" ScriptBlockText="*0x41*" ScriptBlockText="*0x56*" ScriptBlockText="*0x45*" ScriptBlockText="*0xAC*")) | eval sigma_attack_tags="attack.exfiltration" | eval sigma_title="Potential Data Exfiltration Via Audio File" | eval sigma_description="Detects potential exfiltration attempt via audio file using PowerShell"
dispatch.earliest_time = -24h@h
alert.track = 0

[Automated Collection Command PowerShell - powershell]
description = Once established within a system or network, an adversary may use automated techniques for collecting internal data.
search = index=wineventlog* (((ScriptBlockText="*.doc*" OR ScriptBlockText="*.docx*" OR ScriptBlockText="*.xls*" OR ScriptBlockText="*.xlsx*" OR ScriptBlockText="*.ppt*" OR ScriptBlockText="*.pptx*" OR ScriptBlockText="*.rtf*" OR ScriptBlockText="*.pdf*" OR ScriptBlockText="*.txt*") ScriptBlockText="*Get-ChildItem*" ScriptBlockText="* -Recurse *" ScriptBlockText="* -Include *")) | eval sigma_attack_tags="attack.collection attack.t1119" | eval sigma_title="Automated Collection Command PowerShell" | eval sigma_description="Once established within a system or network, an adversary may use automated techniques for collecting internal data."
dispatch.earliest_time = -24h@h
alert.track = 0

[Execution via CL_Invocation.ps1 (2 Lines) - powershell]
description = Detects Execution via SyncInvoke in CL_Invocation.ps1 module
search = index=wineventlog* (ScriptBlockText="*CL_Invocation.ps1*" OR ScriptBlockText="*SyncInvoke*") | eventstats dc(ScriptBlockText) as val by Computer | search val > 2 | eval sigma_attack_tags="attack.defense_evasion attack.t1216" | eval sigma_title="Execution via CL_Invocation.ps1 (2 Lines)" | eval sigma_description="Detects Execution via SyncInvoke in CL_Invocation.ps1 module"
dispatch.earliest_time = -24h@h
alert.track = 0

[Execution via CL_Invocation.ps1 - Powershell - powershell]
description = Detects Execution via SyncInvoke in CL_Invocation.ps1 module
search = index=wineventlog* ((ScriptBlockText="*CL_Invocation.ps1*" ScriptBlockText="*SyncInvoke*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1216" | eval sigma_title="Execution via CL_Invocation.ps1 - Powershell" | eval sigma_description="Detects Execution via SyncInvoke in CL_Invocation.ps1 module"
dispatch.earliest_time = -24h@h
alert.track = 0

[Execution via CL_Mutexverifiers.ps1 (2 Lines) - powershell]
description = Detects Execution via runAfterCancelProcess in CL_Mutexverifiers.ps1 module
search = index=wineventlog* (ScriptBlockText="*CL_Mutexverifiers.ps1*" OR ScriptBlockText="*runAfterCancelProcess*") | eventstats dc(ScriptBlockText) as val by Computer | search val > 2 | eval sigma_attack_tags="attack.defense_evasion attack.t1216" | eval sigma_title="Execution via CL_Mutexverifiers.ps1 (2 Lines)" | eval sigma_description="Detects Execution via runAfterCancelProcess in CL_Mutexverifiers.ps1 module"
dispatch.earliest_time = -24h@h
alert.track = 0

[Execution via CL_Mutexverifiers.ps1 - powershell]
description = Detects Execution via runAfterCancelProcess in CL_Mutexverifiers.ps1 module
search = index=wineventlog* ((ScriptBlockText="*CL_Mutexverifiers.ps1*" ScriptBlockText="*runAfterCancelProcess*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1216" | eval sigma_title="Execution via CL_Mutexverifiers.ps1" | eval sigma_description="Detects Execution via runAfterCancelProcess in CL_Mutexverifiers.ps1 module"
dispatch.earliest_time = -24h@h
alert.track = 0

[Clear PowerShell History - PowerShell - powershell]
description = Detects keywords that could indicate clearing PowerShell history
search = index=wineventlog* ((((ScriptBlockText="*Set-PSReadlineOption*" ScriptBlockText="*–HistorySaveStyle*" ScriptBlockText="*SaveNothing*")) OR ((ScriptBlockText="*Set-PSReadlineOption*" ScriptBlockText="*-HistorySaveStyle*" ScriptBlockText="*SaveNothing*"))) OR (((ScriptBlockText="*del*" OR ScriptBlockText="*Remove-Item*" OR ScriptBlockText="*rm*") ScriptBlockText="*(Get-PSReadlineOption).HistorySavePath*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1070.003" | eval sigma_title="Clear PowerShell History - PowerShell" | eval sigma_description="Detects keywords that could indicate clearing PowerShell history"
dispatch.earliest_time = -24h@h
alert.track = 0

[Clearing Windows Console History - powershell]
description = Identifies when a user attempts to clear console history. An adversary may clear the command history of a compromised account to conceal the actions undertaken during an intrusion.
search = index=wineventlog* (ScriptBlockText="*Clear-History*" OR (((ScriptBlockText="*Remove-Item*" OR ScriptBlockText="*rm*") (ScriptBlockText="*ConsoleHost_history.txt*" OR ScriptBlockText="*(Get-PSReadlineOption).HistorySavePath*")))) | eval sigma_attack_tags="attack.defense_evasion attack.t1070 attack.t1070.003" | eval sigma_title="Clearing Windows Console History" | eval sigma_description="Identifies when a user attempts to clear console history. An adversary may clear the command history of a compromised account to conceal the actions undertaken during an intrusion."
dispatch.earliest_time = -24h@h
alert.track = 0

[Computer Discovery And Export Via Get-ADComputer Cmdlet - PowerShell - powershell]
description = Detects usage of the Get-ADComputer cmdlet to collect computer information and output it to a file
search = index=wineventlog* ((ScriptBlockText="*Get-ADComputer *" ScriptBlockText="* -Filter \*" (ScriptBlockText="* | Select *" OR ScriptBlockText="*Out-File*" OR ScriptBlockText="*Set-Content*" OR ScriptBlockText="*Add-Content*"))) | eval sigma_attack_tags="attack.discovery attack.t1033" | eval sigma_title="Computer Discovery And Export Via Get-ADComputer Cmdlet - PowerShell" | eval sigma_description="Detects usage of the Get-ADComputer cmdlet to collect computer information and output it to a file"
dispatch.earliest_time = -24h@h
alert.track = 0

[Powershell Install a DLL in System Directory - powershell]
description = Uses PowerShell to install/copy a a file into a system directory such as 'System32' or 'SysWOW64'
search = index=wineventlog* ((ScriptBlockText="*Copy-Item *" ScriptBlockText="*-Destination *" (ScriptBlockText="*\\Windows\\System32*" OR ScriptBlockText="*\\Windows\\SysWOW64*"))) | eval sigma_attack_tags="attack.credential_access attack.t1556.002" | eval sigma_title="Powershell Install a DLL in System Directory" | eval sigma_description="Uses PowerShell to install/copy a a file into a system directory such as 'System32' or 'SysWOW64'"
dispatch.earliest_time = -24h@h
alert.track = 0

[PowerShell Create Local User - powershell]
description = Detects creation of a local user via PowerShell
search = index=wineventlog* ScriptBlockText="*New-LocalUser*" | eval sigma_attack_tags="attack.execution attack.t1059.001 attack.persistence attack.t1136.001" | eval sigma_title="PowerShell Create Local User" | eval sigma_description="Detects creation of a local user via PowerShell"
dispatch.earliest_time = -24h@h
alert.track = 0

[Create Volume Shadow Copy with Powershell - powershell]
description = Adversaries may attempt to access or create a copy of the Active Directory domain database in order to steal credential information
search = index=wineventlog* ((ScriptBlockText="*win32_shadowcopy*" ScriptBlockText="*).Create(*" ScriptBlockText="*ClientAccessible*")) | eval sigma_attack_tags="attack.credential_access attack.t1003.003" | eval sigma_title="Create Volume Shadow Copy with Powershell" | eval sigma_description="Adversaries may attempt to access or create a copy of the Active Directory domain database in order to steal credential information"
dispatch.earliest_time = -24h@h
alert.track = 0

[Data Compressed - PowerShell - powershell]
description = An adversary may compress data (e.g., sensitive documents) that is collected prior to exfiltration in order to make it portable and minimize the amount of data sent over the network.
search = index=wineventlog* ((ScriptBlockText="*-Recurse*" ScriptBlockText="*|*" ScriptBlockText="*Compress-Archive*")) | eval sigma_attack_tags="attack.exfiltration attack.t1560" | eval sigma_title="Data Compressed - PowerShell" | eval sigma_description="An adversary may compress data (e.g., sensitive documents) that is collected prior to exfiltration in order to make it portable and minimize the amount of data sent over the network."
dispatch.earliest_time = -24h@h
alert.track = 0

[Powershell Detect Virtualization Environment - powershell]
description = Adversaries may employ various system checks to detect and avoid virtualization and analysis environments.
This may include changing behaviors based on the results of checks for the presence of artifacts indicative of a virtual machine environment (VME) or sandbox

search = index=wineventlog* (((ScriptBlockText="*Get-WmiObject*" OR ScriptBlockText="*gwmi*") (ScriptBlockText="*MSAcpi_ThermalZoneTemperature*" OR ScriptBlockText="*Win32_ComputerSystem*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1497.001" | eval sigma_title="Powershell Detect Virtualization Environment" | eval sigma_description="Adversaries may employ various system checks to detect and avoid virtualization and analysis environments.
This may include changing behaviors based on the results of checks for the presence of artifacts indicative of a virtual machine environment (VME) or sandbox
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Disable Powershell Command History - powershell]
description = Detects scripts or commands that disabled the Powershell command history by removing psreadline module
search = index=wineventlog* ((ScriptBlockText="*Remove-Module*" ScriptBlockText="*psreadline*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1070.003" | eval sigma_title="Disable Powershell Command History" | eval sigma_description="Detects scripts or commands that disabled the Powershell command history by removing psreadline module"
dispatch.earliest_time = -24h@h
alert.track = 0

[Disable-WindowsOptionalFeature Command PowerShell - powershell]
description = Detect built in PowerShell cmdlet Disable-WindowsOptionalFeature, Deployment Image Servicing and Management tool.
Similar to DISM.exe, this cmdlet is used to enumerate, install, uninstall, configure, and update features and packages in Windows images

search = index=wineventlog* ((ScriptBlockText="*Disable-WindowsOptionalFeature*" ScriptBlockText="*-Online*" ScriptBlockText="*-FeatureName*" (ScriptBlockText="*Windows-Defender-Gui*" OR ScriptBlockText="*Windows-Defender-Features*" OR ScriptBlockText="*Windows-Defender*" OR ScriptBlockText="*Windows-Defender-ApplicationGuard*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.001" | eval sigma_title="Disable-WindowsOptionalFeature Command PowerShell" | eval sigma_description="Detect built in PowerShell cmdlet Disable-WindowsOptionalFeature, Deployment Image Servicing and Management tool.
Similar to DISM.exe, this cmdlet is used to enumerate, install, uninstall, configure, and update features and packages in Windows images
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Dnscat Execution - powershell]
description = Dnscat exfiltration tool execution
search = index=wineventlog* ScriptBlockText="*Start-Dnscat2*" | eval sigma_attack_tags="attack.exfiltration attack.t1048 attack.execution attack.t1059.001" | eval sigma_title="Dnscat Execution" | eval sigma_description="Dnscat exfiltration tool execution"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential In-Memory Execution Using Reflection.Assembly - powershell]
description = Detects usage of 'Reflection.Assembly' load functions to dynamically load assemblies in memory
search = index=wineventlog* ScriptBlockText="*[Reflection.Assembly]::load*" | eval sigma_attack_tags="" | eval sigma_title="Potential In-Memory Execution Using Reflection.Assembly" | eval sigma_description="Detects usage of 'Reflection.Assembly' load functions to dynamically load assemblies in memory"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential COM Objects Download Cradles Usage - PS Script - powershell]
description = Detects usage of COM objects that can be abused to download files in PowerShell by CLSID
search = index=wineventlog* ((ScriptBlockText="*[Type]::GetTypeFromCLSID(*" (ScriptBlockText="*0002DF01-0000-0000-C000-000000000046*" OR ScriptBlockText="*F6D90F16-9C73-11D3-B32E-00C04F990BB4*" OR ScriptBlockText="*F5078F35-C551-11D3-89B9-0000F81FE221*" OR ScriptBlockText="*88d96a0a-f192-11d4-a65f-0040963251e5*" OR ScriptBlockText="*AFBA6B42-5692-48EA-8141-DC517DCF0EF1*" OR ScriptBlockText="*AFB40FFD-B609-40A3-9828-F88BBE11E4E3*" OR ScriptBlockText="*88d96a0b-f192-11d4-a65f-0040963251e5*" OR ScriptBlockText="*2087c2f4-2cef-4953-a8ab-66779b670495*" OR ScriptBlockText="*000209FF-0000-0000-C000-000000000046*" OR ScriptBlockText="*00024500-0000-0000-C000-000000000046*"))) | eval sigma_attack_tags="" | eval sigma_title="Potential COM Objects Download Cradles Usage - PS Script" | eval sigma_description="Detects usage of COM objects that can be abused to download files in PowerShell by CLSID"
dispatch.earliest_time = -24h@h
alert.track = 0

[Dump Credentials from Windows Credential Manager With PowerShell - powershell]
description = Adversaries may search for common password storage locations to obtain user credentials.
Passwords are stored in several places on a system, depending on the operating system or application holding the credentials.

search = index=wineventlog* ((ScriptBlockText="*Get-PasswordVaultCredentials*" OR ScriptBlockText="*Get-CredManCreds*") OR ((ScriptBlockText="*New-Object*" ScriptBlockText="*Windows.Security.Credentials.PasswordVault*")) OR ((ScriptBlockText="*New-Object*" ScriptBlockText="*Microsoft.CSharp.CSharpCodeProvider*" ScriptBlockText="*[System.Runtime.InteropServices.RuntimeEnvironment]::GetRuntimeDirectory())*" ScriptBlockText="*Collections.ArrayList*" ScriptBlockText="*System.CodeDom.Compiler.CompilerParameters*"))) | eval sigma_attack_tags="attack.credential_access attack.t1555" | eval sigma_title="Dump Credentials from Windows Credential Manager With PowerShell" | eval sigma_description="Adversaries may search for common password storage locations to obtain user credentials.
Passwords are stored in several places on a system, depending on the operating system or application holding the credentials.
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential Suspicious Windows Feature Enabled - powershell]
description = Detects usage of the built-in PowerShell cmdlet 'Enable-WindowsOptionalFeature' used as a Deployment Image Servicing and Management tool.
Similar to DISM.exe, this cmdlet is used to enumerate, install, uninstall, configure, and update features and packages in Windows images

search = index=wineventlog* ((ScriptBlockText="*Enable-WindowsOptionalFeature*" ScriptBlockText="*-Online*" ScriptBlockText="*-FeatureName*" (ScriptBlockText="*TelnetServer*" OR ScriptBlockText="*Internet-Explorer-Optional-amd64*" OR ScriptBlockText="*TFTP*" OR ScriptBlockText="*SMB1Protocol*" OR ScriptBlockText="*Client-ProjFS*" OR ScriptBlockText="*Microsoft-Windows-Subsystem-Linux*"))) | eval sigma_attack_tags="attack.defense_evasion" | eval sigma_title="Potential Suspicious Windows Feature Enabled" | eval sigma_description="Detects usage of the built-in PowerShell cmdlet 'Enable-WindowsOptionalFeature' used as a Deployment Image Servicing and Management tool.
Similar to DISM.exe, this cmdlet is used to enumerate, install, uninstall, configure, and update features and packages in Windows images
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Enumerate Credentials from Windows Credential Manager With PowerShell - powershell]
description = Adversaries may search for common password storage locations to obtain user credentials.
Passwords are stored in several places on a system, depending on the operating system or application holding the credentials.

search = index=wineventlog* ((ScriptBlockText="*vaultcmd*" ScriptBlockText="*/listcreds:*" (ScriptBlockText="*Windows Credentials*" OR ScriptBlockText="*Web Credentials*"))) | eval sigma_attack_tags="attack.credential_access attack.t1555" | eval sigma_title="Enumerate Credentials from Windows Credential Manager With PowerShell" | eval sigma_description="Adversaries may search for common password storage locations to obtain user credentials.
Passwords are stored in several places on a system, depending on the operating system or application holding the credentials.
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Disable of ETW Trace - Powershell - powershell]
description = Detects usage of powershell cmdlets to disable or remove ETW trace sessions
search = index=wineventlog* (ScriptBlockText="*Remove-EtwTraceProvider *" OR ((ScriptBlockText="*Set-EtwTraceProvider *" ScriptBlockText="*0x11*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1070 attack.t1562.006 car.2016-04-002" | eval sigma_title="Disable of ETW Trace - Powershell" | eval sigma_description="Detects usage of powershell cmdlets to disable or remove ETW trace sessions"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious PowerShell Mailbox SMTP Forward Rule - powershell]
description = Detects usage of the powerShell Set-Mailbox Cmdlet to set-up an SMTP forwarding rule.
search = index=wineventlog* ((ScriptBlockText="*Set-Mailbox *" ScriptBlockText="* -DeliverToMailboxAndForward *" ScriptBlockText="* -ForwardingSmtpAddress *")) | eval sigma_attack_tags="attack.exfiltration" | eval sigma_title="Suspicious PowerShell Mailbox SMTP Forward Rule" | eval sigma_description="Detects usage of the powerShell Set-Mailbox Cmdlet to set-up an SMTP forwarding rule."
dispatch.earliest_time = -24h@h
alert.track = 0

[Powershell File and Directory Discovery - powershell]
description = Adversaries may enumerate files and directories or may search in specific locations of a host or network share for certain information within a file system.
Adversaries may use the information from [File and Directory Discovery](https://attack.mitre.org/techniques/T1083) during automated discovery to shape follow-on behaviors,
including whether or not the adversary fully infects the target and/or attempts specific actions.

search = index=wineventlog* (((ScriptBlockText="*ls*" OR ScriptBlockText="*get-childitem*" OR ScriptBlockText="*gci*") ScriptBlockText="*-recurse*")) | eval sigma_attack_tags="attack.discovery attack.t1083" | eval sigma_title="Powershell File and Directory Discovery" | eval sigma_description="Adversaries may enumerate files and directories or may search in specific locations of a host or network share for certain information within a file system.
Adversaries may use the information from [File and Directory Discovery](https://attack.mitre.org/techniques/T1083) during automated discovery to shape follow-on behaviors,
including whether or not the adversary fully infects the target and/or attempts specific actions.
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious FromBase64String Usage On Gzip Archive - Ps Script - powershell]
description = Detects attempts of decoding a base64 Gzip archive in a PowerShell script. This technique is often used as a method to load malicious content into memory afterward.
search = index=wineventlog* ((ScriptBlockText="*FromBase64String*" ScriptBlockText="*MemoryStream*" ScriptBlockText="*H4sI*")) | eval sigma_attack_tags="" | eval sigma_title="Suspicious FromBase64String Usage On Gzip Archive - Ps Script" | eval sigma_description="Detects attempts of decoding a base64 Gzip archive in a PowerShell script. This technique is often used as a method to load malicious content into memory afterward."
dispatch.earliest_time = -24h@h
alert.track = 0

[Active Directory Computers Enumeration with Get-AdComputer - powershell]
description = Detects usage of the 'Get-AdComputer' to enumerate Computers within Active Directory.
search = index=wineventlog* ((ScriptBlockText="*Get-AdComputer *" ScriptBlockText="*-Filter*")) | eval sigma_attack_tags="attack.discovery attack.t1018" | eval sigma_title="Active Directory Computers Enumeration with Get-AdComputer" | eval sigma_description="Detects usage of the 'Get-AdComputer' to enumerate Computers within Active Directory."
dispatch.earliest_time = -24h@h
alert.track = 0

[Active Directory Group Enumeration With Get-AdGroup - powershell]
description = Detects usage of the 'Get-AdGroup' cmdlet to enumerate Groups within Active Directory
search = index=wineventlog* ((ScriptBlockText="*Get-AdGroup *" ScriptBlockText="*-Filter*")) | eval sigma_attack_tags="attack.discovery attack.t1069.002" | eval sigma_title="Active Directory Group Enumeration With Get-AdGroup" | eval sigma_description="Detects usage of the 'Get-AdGroup' cmdlet to enumerate Groups within Active Directory"
dispatch.earliest_time = -24h@h
alert.track = 0

[Automated Collection Bookmarks Using Get-ChildItem PowerShell - powershell]
description = Adversaries may enumerate browser bookmarks to learn more about compromised hosts.
Browser bookmarks may reveal personal information about users (ex: banking sites, interests, social media, etc.) as well as details about
internal network resources such as servers, tools/dashboards, or other related infrastructure.

search = index=wineventlog* ((ScriptBlockText="*Get-ChildItem*" ScriptBlockText="* -Recurse *" ScriptBlockText="* -Path *" ScriptBlockText="* -Filter Bookmarks*" ScriptBlockText="* -ErrorAction SilentlyContinue*" ScriptBlockText="* -Force*")) | eval sigma_attack_tags="attack.discovery attack.t1217" | eval sigma_title="Automated Collection Bookmarks Using Get-ChildItem PowerShell" | eval sigma_description="Adversaries may enumerate browser bookmarks to learn more about compromised hosts.
Browser bookmarks may reveal personal information about users (ex: banking sites, interests, social media, etc.) as well as details about
internal network resources such as servers, tools/dashboards, or other related infrastructure.
"
dispatch.earliest_time = -24h@h
alert.track = 0

[PowerShell Hotfix Enumeration - powershell]
description = Detects call to 'Win32_QuickFixEngineering' in order to enumerate installed hotfixes often used in 'enum' scripts by attackers
search = index=wineventlog* ((ScriptBlockText="*Win32_QuickFixEngineering*" ScriptBlockText="*HotFixID*")) | eval sigma_attack_tags="attack.discovery" | eval sigma_title="PowerShell Hotfix Enumeration" | eval sigma_description="Detects call to 'Win32_QuickFixEngineering' in order to enumerate installed hotfixes often used in 'enum' scripts by attackers"
dispatch.earliest_time = -24h@h
alert.track = 0

[Import PowerShell Modules From Suspicious Directories - powershell]
description = Detects powershell scripts that import modules from suspicious directories
search = index=wineventlog* (ScriptBlockText="*Import-Module \"$Env:Temp\\*" OR ScriptBlockText="*Import-Module '$Env:Temp\\*" OR ScriptBlockText="*Import-Module $Env:Temp\\*" OR ScriptBlockText="*Import-Module \"$Env:Appdata\\*" OR ScriptBlockText="*Import-Module '$Env:Appdata\\*" OR ScriptBlockText="*Import-Module $Env:Appdata\\*" OR ScriptBlockText="*Import-Module C:\\Users\\Public\\*" OR ScriptBlockText="*ipmo \"$Env:Temp\\*" OR ScriptBlockText="*ipmo '$Env:Temp\\*" OR ScriptBlockText="*ipmo $Env:Temp\\*" OR ScriptBlockText="*ipmo \"$Env:Appdata\\*" OR ScriptBlockText="*ipmo '$Env:Appdata\\*" OR ScriptBlockText="*ipmo $Env:Appdata\\*" OR ScriptBlockText="*ipmo C:\\Users\\Public\\*") | eval sigma_attack_tags="attack.execution attack.t1059.001" | eval sigma_title="Import PowerShell Modules From Suspicious Directories" | eval sigma_description="Detects powershell scripts that import modules from suspicious directories"
dispatch.earliest_time = -24h@h
alert.track = 0

[Unsigned AppX Installation Attempt Using Add-AppxPackage - PsScript - powershell]
description = Detects usage of the 'Add-AppxPackage' or it's alias 'Add-AppPackage' to install unsigned AppX packages
search = index=wineventlog* (((ScriptBlockText="*Add-AppPackage *" OR ScriptBlockText="*Add-AppxPackage *") ScriptBlockText="* -AllowUnsigned*")) | eval sigma_attack_tags="attack.persistence attack.defense_evasion" | eval sigma_title="Unsigned AppX Installation Attempt Using Add-AppxPackage - PsScript" | eval sigma_description="Detects usage of the 'Add-AppxPackage' or it's alias 'Add-AppPackage' to install unsigned AppX packages"
dispatch.earliest_time = -24h@h
alert.track = 0

[Invoke-Obfuscation COMPRESS OBFUSCATION - PowerShell - powershell]
description = Detects Obfuscated Powershell via COMPRESS OBFUSCATION
search = index=wineventlog* ((ScriptBlockText="*new-object*" ScriptBlockText="*text.encoding]::ascii*" (ScriptBlockText="*system.io.compression.deflatestream*" OR ScriptBlockText="*system.io.streamreader*") ScriptBlockText="*readtoend")) | eval sigma_attack_tags="attack.defense_evasion attack.t1027 attack.execution attack.t1059.001" | eval sigma_title="Invoke-Obfuscation COMPRESS OBFUSCATION - PowerShell" | eval sigma_description="Detects Obfuscated Powershell via COMPRESS OBFUSCATION"
dispatch.earliest_time = -24h@h
alert.track = 0

[Invoke-Obfuscation RUNDLL LAUNCHER - PowerShell - powershell]
description = Detects Obfuscated Powershell via RUNDLL LAUNCHER
search = index=wineventlog* ((ScriptBlockText="*rundll32.exe*" ScriptBlockText="*shell32.dll*" ScriptBlockText="*shellexec_rundll*" ScriptBlockText="*powershell*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1027 attack.execution attack.t1059.001" | eval sigma_title="Invoke-Obfuscation RUNDLL LAUNCHER - PowerShell" | eval sigma_description="Detects Obfuscated Powershell via RUNDLL LAUNCHER"
dispatch.earliest_time = -24h@h
alert.track = 0

[Invoke-Obfuscation Via Use MSHTA - PowerShell - powershell]
description = Detects Obfuscated Powershell via use MSHTA in Scripts
search = index=wineventlog* ((ScriptBlockText="*set*" ScriptBlockText="*&&*" ScriptBlockText="*mshta*" ScriptBlockText="*vbscript:createobject*" ScriptBlockText="*.run*" ScriptBlockText="*(window.close)*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1027 attack.execution attack.t1059.001" | eval sigma_title="Invoke-Obfuscation Via Use MSHTA - PowerShell" | eval sigma_description="Detects Obfuscated Powershell via use MSHTA in Scripts"
dispatch.earliest_time = -24h@h
alert.track = 0

[Invoke-Obfuscation Via Use Rundll32 - PowerShell - powershell]
description = Detects Obfuscated Powershell via use Rundll32 in Scripts
search = index=wineventlog* ((ScriptBlockText="*&&*" ScriptBlockText="*rundll32*" ScriptBlockText="*shell32.dll*" ScriptBlockText="*shellexec_rundll*" (ScriptBlockText="*value*" OR ScriptBlockText="*invoke*" OR ScriptBlockText="*comspec*" OR ScriptBlockText="*iex*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1027 attack.execution attack.t1059.001" | eval sigma_title="Invoke-Obfuscation Via Use Rundll32 - PowerShell" | eval sigma_description="Detects Obfuscated Powershell via use Rundll32 in Scripts"
dispatch.earliest_time = -24h@h
alert.track = 0

[Powershell Keylogging - powershell]
description = Adversaries may log user keystrokes to intercept credentials as the user types them.
search = index=wineventlog* (ScriptBlockText="*Get-Keystrokes*" OR ((ScriptBlockText="*Get-ProcAddress user32.dll GetAsyncKeyState*" ScriptBlockText="*Get-ProcAddress user32.dll GetForegroundWindow*"))) | eval sigma_attack_tags="attack.collection attack.t1056.001" | eval sigma_title="Powershell Keylogging" | eval sigma_description="Adversaries may log user keystrokes to intercept credentials as the user types them."
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious PowerShell Mailbox Export to Share - PS - powershell]
description = Detects usage of the powerShell New-MailboxExportRequest Cmdlet to exports a mailbox to a remote or local share, as used in ProxyShell exploitations
search = index=wineventlog* ((ScriptBlockText="*New-MailboxExportRequest*" ScriptBlockText="* -Mailbox *" ScriptBlockText="* -FilePath \\\\\*")) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.exfiltration" | eval sigma_title="Suspicious PowerShell Mailbox Export to Share - PS" | eval sigma_description="Detects usage of the powerShell New-MailboxExportRequest Cmdlet to exports a mailbox to a remote or local share, as used in ProxyShell exploitations"
dispatch.earliest_time = -24h@h
alert.track = 0

[Malicious PowerShell Commandlets - ScriptBlock - powershell]
description = Detects Commandlet names from well-known PowerShell exploitation frameworks
search = index=wineventlog* (((ScriptBlockText="*Add-Exfiltration*" OR ScriptBlockText="*Add-Persistence*" OR ScriptBlockText="*Add-RegBackdoor*" OR ScriptBlockText="*Add-RemoteRegBackdoor*" OR ScriptBlockText="*Add-ScrnSaveBackdoor*" OR ScriptBlockText="*Check-VM*" OR ScriptBlockText="*ConvertTo-Rc4ByteStream*" OR ScriptBlockText="*Decrypt-Hash*" OR ScriptBlockText="*Do-Exfiltration*" OR ScriptBlockText="*Enabled-DuplicateToken*" OR ScriptBlockText="*Exploit-Jboss*" OR ScriptBlockText="*Find-Fruit*" OR ScriptBlockText="*Find-GPOLocation*" OR ScriptBlockText="*Find-TrustedDocuments*" OR ScriptBlockText="*Get-ApplicationHost*" OR ScriptBlockText="*Get-ChromeDump*" OR ScriptBlockText="*Get-ClipboardContents*" OR ScriptBlockText="*Get-FoxDump*" OR ScriptBlockText="*Get-GPPPassword*" OR ScriptBlockText="*Get-IndexedItem*" OR ScriptBlockText="*Get-Keystrokes*" OR ScriptBlockText="*Get-LSASecret*" OR ScriptBlockText="*Get-PassHashes*" OR ScriptBlockText="*Get-RegAlwaysInstallElevated*" OR ScriptBlockText="*Get-RegAutoLogon*" OR ScriptBlockText="*Get-RemoteBootKey*" OR ScriptBlockText="*Get-RemoteCachedCredential*" OR ScriptBlockText="*Get-RemoteLocalAccountHash*" OR ScriptBlockText="*Get-RemoteLSAKey*" OR ScriptBlockText="*Get-RemoteMachineAccountHash*" OR ScriptBlockText="*Get-RemoteNLKMKey*" OR ScriptBlockText="*Get-RickAstley*" OR ScriptBlockText="*Get-Screenshot*" OR ScriptBlockText="*Get-SecurityPackages*" OR ScriptBlockText="*Get-ServiceFilePermission*" OR ScriptBlockText="*Get-ServicePermission*" OR ScriptBlockText="*Get-ServiceUnquoted*" OR ScriptBlockText="*Get-SiteListPassword*" OR ScriptBlockText="*Get-System*" OR ScriptBlockText="*Get-TimedScreenshot*" OR ScriptBlockText="*Get-UnattendedInstallFile*" OR ScriptBlockText="*Get-Unconstrained*" OR ScriptBlockText="*Get-USBKeystrokes*" OR ScriptBlockText="*Get-VaultCredential*" OR ScriptBlockText="*Get-VulnAutoRun*" OR ScriptBlockText="*Get-VulnSchTask*" OR ScriptBlockText="*Gupt-Backdoor*" OR ScriptBlockText="*HTTP-Login*" OR ScriptBlockText="*Install-ServiceBinary*" OR ScriptBlockText="*Install-SSP*" OR ScriptBlockText="*Invoke-ACLScanner*" OR ScriptBlockText="*Invoke-ADSBackdoor*" OR ScriptBlockText="*Invoke-AllChecks*" OR ScriptBlockText="*Invoke-ARPScan*" OR ScriptBlockText="*Invoke-AzureHound*" OR ScriptBlockText="*Invoke-BackdoorLNK*" OR ScriptBlockText="*Invoke-BadPotato*" OR ScriptBlockText="*Invoke-BetterSafetyKatz*" OR ScriptBlockText="*Invoke-BypassUAC*" OR ScriptBlockText="*Invoke-Carbuncle*" OR ScriptBlockText="*Invoke-Certify*" OR ScriptBlockText="*Invoke-ConPtyShell*" OR ScriptBlockText="*Invoke-CredentialInjection*" OR ScriptBlockText="*Invoke-DAFT*" OR ScriptBlockText="*Invoke-DCSync*" OR ScriptBlockText="*Invoke-DinvokeKatz*" OR ScriptBlockText="*Invoke-DllInjection*" OR ScriptBlockText="*Invoke-DomainPasswordSpray*" OR ScriptBlockText="*Invoke-DowngradeAccount*" OR ScriptBlockText="*Invoke-EgressCheck*" OR ScriptBlockText="*Invoke-Eyewitness*" OR ScriptBlockText="*Invoke-FakeLogonScreen*" OR ScriptBlockText="*Invoke-Farmer*" OR ScriptBlockText="*Invoke-Get-RBCD-Threaded*" OR ScriptBlockText="*Invoke-Gopher*" OR ScriptBlockText="*Invoke-Grouper*" OR ScriptBlockText="*Invoke-HandleKatz*" OR ScriptBlockText="*Invoke-ImpersonatedProcess*" OR ScriptBlockText="*Invoke-ImpersonateSystem*" OR ScriptBlockText="*Invoke-InteractiveSystemPowerShell*" OR ScriptBlockText="*Invoke-Internalmonologue*" OR ScriptBlockText="*Invoke-Inveigh*" OR ScriptBlockText="*Invoke-InveighRelay*" OR ScriptBlockText="*Invoke-KrbRelay*" OR ScriptBlockText="*Invoke-LdapSignCheck*" OR ScriptBlockText="*Invoke-Lockless*" OR ScriptBlockText="*Invoke-MalSCCM*" OR ScriptBlockText="*Invoke-Mimikatz*" OR ScriptBlockText="*Invoke-Mimikittenz*" OR ScriptBlockText="*Invoke-MITM6*" OR ScriptBlockText="*Invoke-NanoDump*" OR ScriptBlockText="*Invoke-NetRipper*" OR ScriptBlockText="*Invoke-Nightmare*" OR ScriptBlockText="*Invoke-NinjaCopy*" OR ScriptBlockText="*Invoke-OfficeScrape*" OR ScriptBlockText="*Invoke-OxidResolver*" OR ScriptBlockText="*Invoke-P0wnedshell*" OR ScriptBlockText="*Invoke-Paranoia*" OR ScriptBlockText="*Invoke-PortScan*" OR ScriptBlockText="*Invoke-PoshRatHttp*" OR ScriptBlockText="*Invoke-PostExfil*" OR ScriptBlockText="*Invoke-PowerDump*" OR ScriptBlockText="*Invoke-PowerShellTCP*" OR ScriptBlockText="*Invoke-PowerShellWMI*" OR ScriptBlockText="*Invoke-PPLDump*" OR ScriptBlockText="*Invoke-PsExec*" OR ScriptBlockText="*Invoke-PSInject*" OR ScriptBlockText="*Invoke-PsUaCme*" OR ScriptBlockText="*Invoke-ReflectivePEInjection*" OR ScriptBlockText="*Invoke-ReverseDNSLookup*" OR ScriptBlockText="*Invoke-Rubeus*" OR ScriptBlockText="*Invoke-RunAs*" OR ScriptBlockText="*Invoke-SafetyKatz*" OR ScriptBlockText="*Invoke-SauronEye*" OR ScriptBlockText="*Invoke-SCShell*" OR ScriptBlockText="*Invoke-Seatbelt*" OR ScriptBlockText="*Invoke-ServiceAbuse*" OR ScriptBlockText="*Invoke-ShadowSpray*" OR ScriptBlockText="*Invoke-Sharp*" OR ScriptBlockText="*Invoke-Shellcode*" OR ScriptBlockText="*Invoke-SMBScanner*" OR ScriptBlockText="*Invoke-Snaffler*" OR ScriptBlockText="*Invoke-Spoolsample*" OR ScriptBlockText="*Invoke-SpraySinglePassword*" OR ScriptBlockText="*Invoke-SSHCommand*" OR ScriptBlockText="*Invoke-StandIn*" OR ScriptBlockText="*Invoke-StickyNotesExtract*" OR ScriptBlockText="*Invoke-SystemCommand*" OR ScriptBlockText="*Invoke-Tasksbackdoor*" OR ScriptBlockText="*Invoke-Tater*" OR ScriptBlockText="*Invoke-Thunderfox*" OR ScriptBlockText="*Invoke-ThunderStruck*" OR ScriptBlockText="*Invoke-TokenManipulation*" OR ScriptBlockText="*Invoke-Tokenvator*" OR ScriptBlockText="*Invoke-TotalExec*" OR ScriptBlockText="*Invoke-UrbanBishop*" OR ScriptBlockText="*Invoke-UserHunter*" OR ScriptBlockText="*Invoke-VoiceTroll*" OR ScriptBlockText="*Invoke-Whisker*" OR ScriptBlockText="*Invoke-WinEnum*" OR ScriptBlockText="*Invoke-winPEAS*" OR ScriptBlockText="*Invoke-WireTap*" OR ScriptBlockText="*Invoke-WmiCommand*" OR ScriptBlockText="*Invoke-WScriptBypassUAC*" OR ScriptBlockText="*Invoke-Zerologon*" OR ScriptBlockText="*MailRaider*" OR ScriptBlockText="*New-HoneyHash*" OR ScriptBlockText="*New-InMemoryModule*" OR ScriptBlockText="*Out-Minidump*" OR ScriptBlockText="*Port-Scan*" OR ScriptBlockText="*PowerBreach*" OR ScriptBlockText="*powercat *" OR ScriptBlockText="*PowerUp*" OR ScriptBlockText="*PowerView*" OR ScriptBlockText="*Remove-Update*" OR ScriptBlockText="*Set-MacAttribute*" OR ScriptBlockText="*Set-Wallpaper*" OR ScriptBlockText="*Show-TargetScreen*" OR ScriptBlockText="*Start-CaptureServer*" OR ScriptBlockText="*Start-WebcamRecorder*" OR ScriptBlockText="*VolumeShadowCopyTools*") NOT ((((ScriptBlockText="*Get-SystemDriveInfo*" OR ScriptBlockText="*C:\\ProgramData\\Amazon\\EC2-Windows\\Launch\\Module\\*"))) OR ((ScriptBlockText="# Copyright 2016 Amazon.com, Inc. or its affiliates. All Rights Reserved*"))))) | eval sigma_attack_tags="attack.execution attack.discovery attack.t1482 attack.t1087 attack.t1087.001 attack.t1087.002 attack.t1069.001 attack.t1069.002 attack.t1069 attack.t1059.001" | eval sigma_title="Malicious PowerShell Commandlets - ScriptBlock" | eval sigma_description="Detects Commandlet names from well-known PowerShell exploitation frameworks"
dispatch.earliest_time = -24h@h
alert.track = 0

[Malicious PowerShell Keywords - powershell]
description = Detects keywords from well-known PowerShell exploitation frameworks
search = index=wineventlog* (ScriptBlockText="*AdjustTokenPrivileges*" OR ScriptBlockText="*IMAGE_NT_OPTIONAL_HDR64_MAGIC*" OR ScriptBlockText="*Microsoft.Win32.UnsafeNativeMethods*" OR ScriptBlockText="*ReadProcessMemory.Invoke*" OR ScriptBlockText="*SE_PRIVILEGE_ENABLED*" OR ScriptBlockText="*LSA_UNICODE_STRING*" OR ScriptBlockText="*MiniDumpWriteDump*" OR ScriptBlockText="*PAGE_EXECUTE_READ*" OR ScriptBlockText="*SECURITY_DELEGATION*" OR ScriptBlockText="*TOKEN_ADJUST_PRIVILEGES*" OR ScriptBlockText="*TOKEN_ALL_ACCESS*" OR ScriptBlockText="*TOKEN_ASSIGN_PRIMARY*" OR ScriptBlockText="*TOKEN_DUPLICATE*" OR ScriptBlockText="*TOKEN_ELEVATION*" OR ScriptBlockText="*TOKEN_IMPERSONATE*" OR ScriptBlockText="*TOKEN_INFORMATION_CLASS*" OR ScriptBlockText="*TOKEN_PRIVILEGES*" OR ScriptBlockText="*TOKEN_QUERY*" OR ScriptBlockText="*Metasploit*" OR ScriptBlockText="*Mimikatz*") | eval sigma_attack_tags="attack.execution attack.t1059.001" | eval sigma_title="Malicious PowerShell Keywords" | eval sigma_description="Detects keywords from well-known PowerShell exploitation frameworks"
dispatch.earliest_time = -24h@h
alert.track = 0

[Live Memory Dump Using Powershell - powershell]
description = Detects usage of a PowerShell command to dump the live memory of a Windows machine
search = index=wineventlog* ((ScriptBlockText="*Get-StorageDiagnosticInfo*" ScriptBlockText="*-IncludeLiveDump*")) | eval sigma_attack_tags="attack.t1003" | eval sigma_title="Live Memory Dump Using Powershell" | eval sigma_description="Detects usage of a PowerShell command to dump the live memory of a Windows machine"
dispatch.earliest_time = -24h@h
alert.track = 0

[Modify Group Policy Settings - ScriptBlockLogging - powershell]
description = Detect malicious GPO modifications can be used to implement many other malicious behaviors.
search = index=wineventlog* ((ScriptBlockText="*\\SOFTWARE\\Policies\\Microsoft\\Windows\\System*" (ScriptBlockText="*GroupPolicyRefreshTimeDC*" OR ScriptBlockText="*GroupPolicyRefreshTimeOffsetDC*" OR ScriptBlockText="*GroupPolicyRefreshTime*" OR ScriptBlockText="*GroupPolicyRefreshTimeOffset*" OR ScriptBlockText="*EnableSmartScreen*" OR ScriptBlockText="*ShellSmartScreenLevel*"))) | eval sigma_attack_tags="attack.defense_evasion attack.privilege_escalation attack.t1484.001" | eval sigma_title="Modify Group Policy Settings - ScriptBlockLogging" | eval sigma_description="Detect malicious GPO modifications can be used to implement many other malicious behaviors."
dispatch.earliest_time = -24h@h
alert.track = 0

[Malicious Nishang PowerShell Commandlets - powershell]
description = Detects Commandlet names and arguments from the Nishang exploitation framework
search = index=wineventlog* (ScriptBlockText="*Add-ConstrainedDelegationBackdoor*" OR ScriptBlockText="*Copy-VSS*" OR ScriptBlockText="*Create-MultipleSessions*" OR ScriptBlockText="*DataToEncode*" OR ScriptBlockText="*DNS_TXT_Pwnage*" OR ScriptBlockText="*Do-Exfiltration-Dns*" OR ScriptBlockText="*Download_Execute*" OR ScriptBlockText="*Download-Execute-PS*" OR ScriptBlockText="*DownloadAndExtractFromRemoteRegistry*" OR ScriptBlockText="*DumpCerts*" OR ScriptBlockText="*DumpCreds*" OR ScriptBlockText="*DumpHashes*" OR ScriptBlockText="*Enable-DuplicateToken*" OR ScriptBlockText="*Enable-Duplication*" OR ScriptBlockText="*Execute-Command-MSSQL*" OR ScriptBlockText="*Execute-DNSTXT-Code*" OR ScriptBlockText="*Execute-OnTime*" OR ScriptBlockText="*ExetoText*" OR ScriptBlockText="*exfill*" OR ScriptBlockText="*ExfilOption*" OR ScriptBlockText="*FakeDC*" OR ScriptBlockText="*FireBuster*" OR ScriptBlockText="*FireListener*" OR ScriptBlockText="*Get-Information *" OR ScriptBlockText="*Get-PassHints*" OR ScriptBlockText="*Get-Web-Credentials*" OR ScriptBlockText="*Get-WebCredentials*" OR ScriptBlockText="*Get-WLAN-Keys*" OR ScriptBlockText="*HTTP-Backdoor*" OR ScriptBlockText="*Invoke-AmsiBypass*" OR ScriptBlockText="*Invoke-BruteForce*" OR ScriptBlockText="*Invoke-CredentialsPhish*" OR ScriptBlockText="*Invoke-Decode*" OR ScriptBlockText="*Invoke-Encode*" OR ScriptBlockText="*Invoke-Interceptor*" OR ScriptBlockText="*Invoke-JSRatRegsvr*" OR ScriptBlockText="*Invoke-JSRatRundll*" OR ScriptBlockText="*Invoke-MimikatzWDigestDowngrade*" OR ScriptBlockText="*Invoke-NetworkRelay*" OR ScriptBlockText="*Invoke-PowerShellIcmp*" OR ScriptBlockText="*Invoke-PowerShellUdp*" OR ScriptBlockText="*Invoke-Prasadhak*" OR ScriptBlockText="*Invoke-PSGcat*" OR ScriptBlockText="*Invoke-PsGcatAgent*" OR ScriptBlockText="*Invoke-SessionGopher*" OR ScriptBlockText="*Invoke-SSIDExfil*" OR ScriptBlockText="*LoggedKeys*" OR ScriptBlockText="*Nishang*" OR ScriptBlockText="*NotAllNameSpaces*" OR ScriptBlockText="*Out-CHM*" OR ScriptBlockText="*OUT-DNSTXT*" OR ScriptBlockText="*Out-HTA*" OR ScriptBlockText="*Out-RundllCommand*" OR ScriptBlockText="*Out-SCF*" OR ScriptBlockText="*Out-SCT*" OR ScriptBlockText="*Out-Shortcut*" OR ScriptBlockText="*Out-WebQuery*" OR ScriptBlockText="*Out-Word*" OR ScriptBlockText="*Parse_Keys*" OR ScriptBlockText="*Password-List*" OR ScriptBlockText="*Powerpreter*" OR ScriptBlockText="*Remove-Persistence*" OR ScriptBlockText="*Remove-PoshRat*" OR ScriptBlockText="*Remove-Update*" OR ScriptBlockText="*Run-EXEonRemote*" OR ScriptBlockText="*Set-DCShadowPermissions*" OR ScriptBlockText="*Set-RemotePSRemoting*" OR ScriptBlockText="*Set-RemoteWMI*" OR ScriptBlockText="*Shellcode32*" OR ScriptBlockText="*Shellcode64*" OR ScriptBlockText="*StringtoBase64*" OR ScriptBlockText="*TexttoExe*") | eval sigma_attack_tags="attack.execution attack.t1059.001" | eval sigma_title="Malicious Nishang PowerShell Commandlets" | eval sigma_description="Detects Commandlet names and arguments from the Nishang exploitation framework"
dispatch.earliest_time = -24h@h
alert.track = 0

[NTFS Alternate Data Stream - powershell]
description = Detects writing data into NTFS alternate data streams from powershell. Needs Script Block Logging.
search = index=wineventlog* (((ScriptBlockText="*set-content*" OR ScriptBlockText="*add-content*") ScriptBlockText="*-stream*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1564.004 attack.execution attack.t1059.001" | eval sigma_title="NTFS Alternate Data Stream" | eval sigma_description="Detects writing data into NTFS alternate data streams from powershell. Needs Script Block Logging."
dispatch.earliest_time = -24h@h
alert.track = 0

[Code Executed Via Office Add-in XLL File - powershell]
description = Adversaries may abuse Microsoft Office add-ins to obtain persistence on a compromised system.
Office add-ins can be used to add functionality to Office programs

search = index=wineventlog* ((ScriptBlockText="*new-object *" ScriptBlockText="*-ComObject *" ScriptBlockText="*.application*" ScriptBlockText="*.RegisterXLL*")) | eval sigma_attack_tags="attack.persistence attack.t1137.006" | eval sigma_title="Code Executed Via Office Add-in XLL File" | eval sigma_description="Adversaries may abuse Microsoft Office add-ins to obtain persistence on a compromised system.
Office add-ins can be used to add functionality to Office programs
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential Invoke-Mimikatz PowerShell Script - powershell]
description = Detects Invoke-Mimikatz PowerShell script and alike. Mimikatz is a credential dumper capable of obtaining plaintext Windows account logins and passwords.
search = index=wineventlog* (((ScriptBlockText="*DumpCreds*" ScriptBlockText="*DumpCerts*")) OR ScriptBlockText="*sekurlsa::logonpasswords*" OR ((ScriptBlockText="*crypto::certificates*" ScriptBlockText="*CERT_SYSTEM_STORE_LOCAL_MACHINE*"))) | eval sigma_attack_tags="attack.credential_access attack.t1003" | eval sigma_title="Potential Invoke-Mimikatz PowerShell Script" | eval sigma_description="Detects Invoke-Mimikatz PowerShell script and alike. Mimikatz is a credential dumper capable of obtaining plaintext Windows account logins and passwords."
dispatch.earliest_time = -24h@h
alert.track = 0

[Malicious PowerView PowerShell Commandlets - powershell]
description = Detects Commandlet names from PowerView of PowerSploit exploitation framework.
search = index=wineventlog* (ScriptBlockText="*Add-DomainGroupMember*" OR ScriptBlockText="*Add-DomainObjectAcl*" OR ScriptBlockText="*Add-ObjectAcl*" OR ScriptBlockText="*Add-RemoteConnection*" OR ScriptBlockText="*Convert-ADName*" OR ScriptBlockText="*ConvertFrom-UACValue*" OR ScriptBlockText="*Convert-NameToSid*" OR ScriptBlockText="*ConvertTo-SID*" OR ScriptBlockText="*Export-PowerViewCSV*" OR ScriptBlockText="*Find-DomainLocalGroupMember*" OR ScriptBlockText="*Find-DomainObjectPropertyOutlier*" OR ScriptBlockText="*Find-DomainProcess*" OR ScriptBlockText="*Find-DomainShare*" OR ScriptBlockText="*Find-DomainUserEvent*" OR ScriptBlockText="*Find-DomainUserLocation*" OR ScriptBlockText="*Find-ForeignGroup*" OR ScriptBlockText="*Find-ForeignUser*" OR ScriptBlockText="*Find-GPOComputerAdmin*" OR ScriptBlockText="*Find-GPOLocation*" OR ScriptBlockText="*Find-InterestingDomain*" OR ScriptBlockText="*Find-InterestingFile*" OR ScriptBlockText="*Find-LocalAdminAccess*" OR ScriptBlockText="*Find-ManagedSecurityGroups*" OR ScriptBlockText="*Get-ADObject*" OR ScriptBlockText="*Get-CachedRDPConnection*" OR ScriptBlockText="*Get-DFSshare*" OR ScriptBlockText="*Get-DNSRecord*" OR ScriptBlockText="*Get-DNSZone*" OR ScriptBlockText="*Get-Domain*" OR ScriptBlockText="*Get-Forest*" OR ScriptBlockText="*Get-IPAddress*" OR ScriptBlockText="*Get-LastLoggedOn*" OR ScriptBlockText="*Get-LoggedOnLocal*" OR ScriptBlockText="*Get-NetComputer*" OR ScriptBlockText="*Get-NetDomain*" OR ScriptBlockText="*Get-NetFileServer*" OR ScriptBlockText="*Get-NetForest*" OR ScriptBlockText="*Get-NetGPO*" OR ScriptBlockText="*Get-NetGroup*" OR ScriptBlockText="*Get-NetLocalGroup*" OR ScriptBlockText="*Get-NetLoggedon*" OR ScriptBlockText="*Get-NetOU*" OR ScriptBlockText="*Get-NetProcess*" OR ScriptBlockText="*Get-NetRDPSession*" OR ScriptBlockText="*Get-NetSession*" OR ScriptBlockText="*Get-NetShare*" OR ScriptBlockText="*Get-NetSite*" OR ScriptBlockText="*Get-NetSubnet*" OR ScriptBlockText="*Get-NetUser*" OR ScriptBlockText="*Get-ObjectAcl*" OR ScriptBlockText="*Get-PathAcl*" OR ScriptBlockText="*Get-Proxy*" OR ScriptBlockText="*Get-RegistryMountedDrive*" OR ScriptBlockText="*Get-RegLoggedOn*" OR ScriptBlockText="*Get-SiteName*" OR ScriptBlockText="*Get-UserEvent*" OR ScriptBlockText="*Get-WMIProcess*" OR ScriptBlockText="*Get-WMIReg*" OR ScriptBlockText="*Invoke-ACLScanner*" OR ScriptBlockText="*Invoke-CheckLocalAdminAccess*" OR ScriptBlockText="*Invoke-EnumerateLocalAdmin*" OR ScriptBlockText="*Invoke-EventHunter*" OR ScriptBlockText="*Invoke-FileFinder*" OR ScriptBlockText="*Invoke-Kerberoast*" OR ScriptBlockText="*Invoke-MapDomainTrust*" OR ScriptBlockText="*Invoke-ProcessHunter*" OR ScriptBlockText="*Invoke-RevertToSelf*" OR ScriptBlockText="*Invoke-ShareFinder*" OR ScriptBlockText="*Invoke-UserHunter*" OR ScriptBlockText="*Invoke-UserImpersonation*" OR ScriptBlockText="*New-DomainGroup*" OR ScriptBlockText="*New-DomainUser*" OR ScriptBlockText="*Remove-RemoteConnection*" OR ScriptBlockText="*Request-SPNTicket*" OR ScriptBlockText="*Resolve-IPAddress*" OR ScriptBlockText="*Set-ADObject*" OR ScriptBlockText="*Set-DomainObject*" OR ScriptBlockText="*Set-DomainUserPassword*" OR ScriptBlockText="*Test-AdminAccess*") | eval sigma_attack_tags="attack.execution attack.t1059.001" | eval sigma_title="Malicious PowerView PowerShell Commandlets" | eval sigma_description="Detects Commandlet names from PowerView of PowerSploit exploitation framework."
dispatch.earliest_time = -24h@h
alert.track = 0

[PowerShell Credential Prompt - powershell]
description = Detects PowerShell calling a credential prompt
search = index=wineventlog* ScriptBlockText="*PromptForCredential*" | eval sigma_attack_tags="attack.credential_access attack.execution attack.t1059.001" | eval sigma_title="PowerShell Credential Prompt" | eval sigma_description="Detects PowerShell calling a credential prompt"
dispatch.earliest_time = -24h@h
alert.track = 0

[PSAsyncShell - Asynchronous TCP Reverse Shell - powershell]
description = Detects the use of PSAsyncShell an Asynchronous TCP Reverse Shell written in powershell
search = index=wineventlog* ScriptBlockText="*PSAsyncShell*" | eval sigma_attack_tags="attack.execution attack.t1059.001" | eval sigma_title="PSAsyncShell - Asynchronous TCP Reverse Shell" | eval sigma_description="Detects the use of PSAsyncShell an Asynchronous TCP Reverse Shell written in powershell"
dispatch.earliest_time = -24h@h
alert.track = 0

[PowerShell PSAttack - powershell]
description = Detects the use of PSAttack PowerShell hack tool
search = index=wineventlog* ScriptBlockText="*PS ATTACK!!!*" | eval sigma_attack_tags="attack.execution attack.t1059.001" | eval sigma_title="PowerShell PSAttack" | eval sigma_description="Detects the use of PSAttack PowerShell hack tool"
dispatch.earliest_time = -24h@h
alert.track = 0

[Use Remove-Item to Delete File - powershell]
description = Powershell Remove-Item  with -Path to delete a file or a folder with '-Recurse'
search = index=wineventlog* ((((ScriptBlockText="*Remove-Item*" ScriptBlockText="*-Path *")) NOT (((ScriptBlockText="*HKCU:\\*" OR ScriptBlockText="*HKLM:\\*"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1070.004" | eval sigma_title="Use Remove-Item to Delete File" | eval sigma_description="Powershell Remove-Item  with -Path to delete a file or a folder with '-Recurse'"
dispatch.earliest_time = -24h@h
alert.track = 0

[Root Certificate Installed - PowerShell - powershell]
description = Adversaries may install a root certificate on a compromised system to avoid warnings when connecting to adversary controlled web servers.
search = index=wineventlog* (((ScriptBlockText="*Move-Item*" ScriptBlockText="*Cert:\\LocalMachine\\Root*")) OR ((ScriptBlockText="*Import-Certificate*" ScriptBlockText="*Cert:\\LocalMachine\\Root*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1553.004" | eval sigma_title="Root Certificate Installed - PowerShell" | eval sigma_description="Adversaries may install a root certificate on a compromised system to avoid warnings when connecting to adversary controlled web servers."
dispatch.earliest_time = -24h@h
alert.track = 0

[Security Software Discovery by Powershell - powershell]
description = Adversaries may attempt to get a listing of security software, configurations, defensive tools, and sensors that are installed on a system or in a cloud environment.
This may include things such as firewall rules and anti-viru

search = index=wineventlog* ((ScriptBlockText="*get-process*" ScriptBlockText="*.Description*" ScriptBlockText="*-like*" (ScriptBlockText="*\"*virus*\"*" OR ScriptBlockText="*\"*carbonblack*\"*" OR ScriptBlockText="*\"*defender*\"*" OR ScriptBlockText="*\"*cylance*\"*"))) | eval sigma_attack_tags="attack.discovery attack.t1518.001" | eval sigma_title="Security Software Discovery by Powershell" | eval sigma_description="Adversaries may attempt to get a listing of security software, configurations, defensive tools, and sensors that are installed on a system or in a cloud environment.
This may include things such as firewall rules and anti-viru
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Powershell Sensitive File Discovery - powershell]
description = Detect adversaries enumerate sensitive files
search = index=wineventlog* (((ScriptBlockText="*ls*" OR ScriptBlockText="*get-childitem*" OR ScriptBlockText="*gci*") ScriptBlockText="*-recurse*" (ScriptBlockText="*.pass*" OR ScriptBlockText="*.kdbx*" OR ScriptBlockText="*.kdb*"))) | eval sigma_attack_tags="attack.discovery attack.t1083" | eval sigma_title="Powershell Sensitive File Discovery" | eval sigma_description="Detect adversaries enumerate sensitive files"
dispatch.earliest_time = -24h@h
alert.track = 0

[Change PowerShell Policies to an Insecure Level - PowerShell - powershell]
description = Detects use of Set-ExecutionPolicy to set insecure policies
search = index=wineventlog* ((((ScriptBlockText="*Set-ExecutionPolicy*" (ScriptBlockText="*Unrestricted*" OR ScriptBlockText="*bypass*" OR ScriptBlockText="*RemoteSigned*"))) NOT (((ScriptBlockText="*(New-Object System.Net.WebClient).DownloadString('https://community.chocolatey.org/install.ps1')*" OR ScriptBlockText="*(New-Object System.Net.WebClient).DownloadString('https://chocolatey.org/install.ps1')*" OR ScriptBlockText="*\\AppData\\Roaming\\Code\\*"))))) | eval sigma_attack_tags="attack.execution attack.t1059.001" | eval sigma_title="Change PowerShell Policies to an Insecure Level - PowerShell" | eval sigma_description="Detects use of Set-ExecutionPolicy to set insecure policies"
dispatch.earliest_time = -24h@h
alert.track = 0

[PowerShell ShellCode - powershell]
description = Detects Base64 encoded Shellcode
search = index=wineventlog* ((ScriptBlockText="*AAAAYInlM*" (ScriptBlockText="*OiCAAAAYInlM*" OR ScriptBlockText="*OiJAAAAYInlM*"))) | eval sigma_attack_tags="attack.defense_evasion attack.privilege_escalation attack.t1055 attack.execution attack.t1059.001" | eval sigma_title="PowerShell ShellCode" | eval sigma_description="Detects Base64 encoded Shellcode"
dispatch.earliest_time = -24h@h
alert.track = 0

[Malicious ShellIntel PowerShell Commandlets - powershell]
description = Detects Commandlet names from ShellIntel exploitation scripts.
search = index=wineventlog* (ScriptBlockText="*Invoke-SMBAutoBrute*" OR ScriptBlockText="*Invoke-GPOLinks*" OR ScriptBlockText="*Invoke-Potato*") | eval sigma_attack_tags="attack.execution attack.t1059.001" | eval sigma_title="Malicious ShellIntel PowerShell Commandlets" | eval sigma_description="Detects Commandlet names from ShellIntel exploitation scripts."
dispatch.earliest_time = -24h@h
alert.track = 0

[Detected Windows Software Discovery - PowerShell - powershell]
description = Adversaries may attempt to enumerate software for a variety of reasons, such as figuring out what security measures are present or if the compromised system has a version of software that is vulnerable.
search = index=wineventlog* ((ScriptBlockText="*get-itemProperty*" ScriptBlockText="*\\software\\*" ScriptBlockText="*select-object*" ScriptBlockText="*format-table*")) | eval sigma_attack_tags="attack.discovery attack.t1518" | eval sigma_title="Detected Windows Software Discovery - PowerShell" | eval sigma_description="Adversaries may attempt to enumerate software for a variety of reasons, such as figuring out what security measures are present or if the compromised system has a version of software that is vulnerable."
dispatch.earliest_time = -24h@h
alert.track = 0

[Powershell Store File In Alternate Data Stream - powershell]
description = Storing files in Alternate Data Stream (ADS) similar to Astaroth malware.
search = index=wineventlog* ((ScriptBlockText="*Start-Process*" ScriptBlockText="*-FilePath \"$env:comspec\" *" ScriptBlockText="*-ArgumentList *" ScriptBlockText="*>*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1564.004" | eval sigma_title="Powershell Store File In Alternate Data Stream" | eval sigma_description="Storing files in Alternate Data Stream (ADS) similar to Astaroth malware."
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential Persistence Via Security Descriptors - ScriptBlock - powershell]
description = Detects usage of certain functions and keywords that are used to manipulate security descriptors in order to potentially set a backdoor. As seen used in the DAMP project.
search = index=wineventlog* ((ScriptBlockText="*win32_Trustee*" ScriptBlockText="*win32_Ace*" ScriptBlockText="*.AccessMask*" ScriptBlockText="*.AceType*" ScriptBlockText="*.SetSecurityDescriptor*" (ScriptBlockText="*\\Lsa\\JD*" OR ScriptBlockText="*\\Lsa\\Skew1*" OR ScriptBlockText="*\\Lsa\\Data*" OR ScriptBlockText="*\\Lsa\\GBG*"))) | eval sigma_attack_tags="attack.persistence attack.defense_evasion attack.privilege_escalation" | eval sigma_title="Potential Persistence Via Security Descriptors - ScriptBlock" | eval sigma_description="Detects usage of certain functions and keywords that are used to manipulate security descriptors in order to potentially set a backdoor. As seen used in the DAMP project."
dispatch.earliest_time = -24h@h
alert.track = 0

[AD Groups Or Users Enumeration Using PowerShell - ScriptBlock - powershell]
description = Adversaries may attempt to find domain-level groups and permission settings.
The knowledge of domain-level permission groups can help adversaries determine which groups exist and which users belong to a particular group.
Adversaries may use this information to determine which users have elevated permissions, such as domain administrators.

search = index=wineventlog* (ScriptBlockText="*get-ADPrincipalGroupMembership*" OR ((ScriptBlockText="*get-aduser*" ScriptBlockText="*-f *" ScriptBlockText="*-pr *" ScriptBlockText="*DoesNotRequirePreAuth*"))) | eval sigma_attack_tags="attack.discovery attack.t1069.001" | eval sigma_title="AD Groups Or Users Enumeration Using PowerShell - ScriptBlock" | eval sigma_description="Adversaries may attempt to find domain-level groups and permission settings.
The knowledge of domain-level permission groups can help adversaries determine which groups exist and which users belong to a particular group.
Adversaries may use this information to determine which users have elevated permissions, such as domain administrators.
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential PowerShell Obfuscation Using Character Join - powershell]
description = Detects specific techniques often seen used inside of PowerShell scripts to obfscuate Alias creation
search = index=wineventlog* ((ScriptBlockText="*-Alias*" ScriptBlockText="* -Value (-join(*")) | eval sigma_attack_tags="attack.defense_evasion attack.execution attack.t1027 attack.t1059.001" | eval sigma_title="Potential PowerShell Obfuscation Using Character Join" | eval sigma_description="Detects specific techniques often seen used inside of PowerShell scripts to obfscuate Alias creation"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Eventlog Clear - powershell]
description = Detects usage of known powershell cmdlets such as 'Clear-EventLog' to clear the windows event logs
search = index=wineventlog* (ScriptBlockText="*Clear-EventLog *" OR ScriptBlockText="*Remove-EventLog *" OR ScriptBlockText="*Limit-EventLog *" OR ScriptBlockText="*Clear-WinEvent *") | eval sigma_attack_tags="attack.defense_evasion attack.t1070.001" | eval sigma_title="Suspicious Eventlog Clear" | eval sigma_description="Detects usage of known powershell cmdlets such as 'Clear-EventLog' to clear the windows event logs"
dispatch.earliest_time = -24h@h
alert.track = 0

[Powershell Directory Enumeration - powershell]
description = Detects technique used by MAZE ransomware to enumerate directories using Powershell
search = index=wineventlog* ((ScriptBlockText="*foreach*" ScriptBlockText="*Get-ChildItem*" ScriptBlockText="*-Path *" ScriptBlockText="*-ErrorAction *" ScriptBlockText="*SilentlyContinue*" ScriptBlockText="*Out-File *" ScriptBlockText="*-append*")) | eval sigma_attack_tags="attack.discovery attack.t1083" | eval sigma_title="Powershell Directory Enumeration" | eval sigma_description="Detects technique used by MAZE ransomware to enumerate directories using Powershell"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious PowerShell Download - Powershell Script - powershell]
description = Detects suspicious PowerShell download command
search = index=wineventlog* ((ScriptBlockText="*System.Net.WebClient*" (ScriptBlockText="*.DownloadFile(*" OR ScriptBlockText="*.DownloadString(*"))) | eval sigma_attack_tags="attack.execution attack.t1059.001" | eval sigma_title="Suspicious PowerShell Download - Powershell Script" | eval sigma_description="Detects suspicious PowerShell download command"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Export-PfxCertificate - powershell]
description = Detects Commandlet that is used to export certificates from the local certificate store and sometimes used by threat actors to steal private keys from compromised machines
search = index=wineventlog* ((ScriptBlockText="*Export-PfxCertificate*" NOT (((ScriptBlockText="*CmdletsToExport = @(*"))))) | eval sigma_attack_tags="attack.credential_access attack.t1552.004" | eval sigma_title="Suspicious Export-PfxCertificate" | eval sigma_description="Detects Commandlet that is used to export certificates from the local certificate store and sometimes used by threat actors to steal private keys from compromised machines"
dispatch.earliest_time = -24h@h
alert.track = 0

[Extracting Information with PowerShell - powershell]
description = Adversaries may search local file systems and remote file shares for files containing insecurely stored credentials.
These can be files created by users to store their own credentials, shared credential stores for a group of individuals,
configuration files containing passwords for a system or service, or source code/binary files containing embedded passwords.

search = index=wineventlog* ((ScriptBlockText="*ls*" ScriptBlockText="* -R*" ScriptBlockText="*select-string *" ScriptBlockText="*-Pattern *")) | eval sigma_attack_tags="attack.credential_access attack.t1552.001" | eval sigma_title="Extracting Information with PowerShell" | eval sigma_description="Adversaries may search local file systems and remote file shares for files containing insecurely stored credentials.
These can be files created by users to store their own credentials, shared credential stores for a group of individuals,
configuration files containing passwords for a system or service, or source code/binary files containing embedded passwords.
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Troubleshooting Pack Cmdlet Execution - powershell]
description = Detects execution of 'TroubleshootingPack' cmdlets to leverage CVE-2022-30190 or action similar to 'msdt' lolbin (as described in LOLBAS)
search = index=wineventlog* ((ScriptBlockText="*Invoke-TroubleshootingPack*" ScriptBlockText="*C:\\Windows\\Diagnostics\\System\\PCW*" ScriptBlockText="*-AnswerFile*" ScriptBlockText="*-Unattended*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1202" | eval sigma_title="Troubleshooting Pack Cmdlet Execution" | eval sigma_description="Detects execution of 'TroubleshootingPack' cmdlets to leverage CVE-2022-30190 or action similar to 'msdt' lolbin (as described in LOLBAS)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious GPO Discovery With Get-GPO - powershell]
description = Detect use of Get-GPO to get one GPO or all the GPOs in a domain.
search = index=wineventlog* ScriptBlockText="*Get-GPO*" | eval sigma_attack_tags="attack.discovery attack.t1615" | eval sigma_title="Suspicious GPO Discovery With Get-GPO" | eval sigma_description="Detect use of Get-GPO to get one GPO or all the GPOs in a domain."
dispatch.earliest_time = -24h@h
alert.track = 0

[PowerShell Get-Process LSASS in ScriptBlock - powershell]
description = Detects a Get-Process command on lsass process, which is in almost all cases a sign of malicious activity
search = index=wineventlog* ScriptBlockText="*Get-Process lsass*" | eval sigma_attack_tags="attack.credential_access attack.t1003.001" | eval sigma_title="PowerShell Get-Process LSASS in ScriptBlock" | eval sigma_description="Detects a Get-Process command on lsass process, which is in almost all cases a sign of malicious activity"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Get-WmiObject - powershell]
description = The infrastructure for management data and operations that enables local and remote management of Windows personal computers and servers
search = index=wineventlog* (((ScriptBlockText="*Get-WmiObject*" OR ScriptBlockText="*gwmi*") NOT (((Path="*\\CL_Utility.ps1" (ScriptBlockText="*function Get-FreeSpace*" ScriptBlockText="*SELECT * FROM Win32_LogicalDisk WHERE MediaType=12*")))))) | eval sigma_attack_tags="attack.persistence attack.t1546" | eval sigma_title="Suspicious Get-WmiObject" | eval sigma_description="The infrastructure for management data and operations that enables local and remote management of Windows personal computers and servers"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious PowerShell Invocations - Generic - powershell]
description = Detects suspicious PowerShell invocation command parameters
search = index=wineventlog* (((ScriptBlockText="* -enc *" OR ScriptBlockText="* -EncodedCommand *" OR ScriptBlockText="* -ec *") (ScriptBlockText="* -w hidden *" OR ScriptBlockText="* -window hidden *" OR ScriptBlockText="* -windowstyle hidden *" OR ScriptBlockText="* -w 1 *") (ScriptBlockText="* -noni *" OR ScriptBlockText="* -noninteractive *"))) | eval sigma_attack_tags="attack.execution attack.t1059.001" | eval sigma_title="Suspicious PowerShell Invocations - Generic" | eval sigma_description="Detects suspicious PowerShell invocation command parameters"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious PowerShell Invocations - Specific - powershell]
description = Detects suspicious PowerShell invocation command parameters
search = index=wineventlog* (((((ScriptBlockText="*-nop*" ScriptBlockText="* -w *" ScriptBlockText="*hidden*" ScriptBlockText="* -c *" ScriptBlockText="*[Convert]::FromBase64String*")) OR ((ScriptBlockText="* -w *" ScriptBlockText="*hidden*" ScriptBlockText="*-noni*" ScriptBlockText="*-nop*" ScriptBlockText="* -c *" ScriptBlockText="*iex*" ScriptBlockText="*New-Object*")) OR ((ScriptBlockText="* -w *" ScriptBlockText="*hidden*" ScriptBlockText="*-ep*" ScriptBlockText="*bypass*" ScriptBlockText="*-Enc*")) OR ((ScriptBlockText="*powershell*" ScriptBlockText="*reg*" ScriptBlockText="*add*" ScriptBlockText="*HKCU\\software\\microsoft\\windows\\currentversion\\run*")) OR ((ScriptBlockText="*bypass*" ScriptBlockText="*-noprofile*" ScriptBlockText="*-windowstyle*" ScriptBlockText="*hidden*" ScriptBlockText="*new-object*" ScriptBlockText="*system.net.webclient*" ScriptBlockText="*.download*")) OR ((ScriptBlockText="*iex*" ScriptBlockText="*New-Object*" ScriptBlockText="*Net.WebClient*" ScriptBlockText="*.Download*"))) NOT ((((ScriptBlockText="*(New-Object System.Net.WebClient).DownloadString('https://community.chocolatey.org/install.ps1*" OR ScriptBlockText="*(New-Object System.Net.WebClient).DownloadString('https://chocolatey.org/install.ps1')*" OR ScriptBlockText="*Write-ChocolateyWarning*")))))) | eval sigma_attack_tags="attack.execution attack.t1059.001" | eval sigma_title="Suspicious PowerShell Invocations - Specific" | eval sigma_description="Detects suspicious PowerShell invocation command parameters"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious IO.FileStream - powershell]
description = Open a handle on the drive volume via the \\.\ DOS device path specifier and perform direct access read of the first few bytes of the volume.
search = index=wineventlog* ((ScriptBlockText="*New-Object*" ScriptBlockText="*IO.FileStream*" ScriptBlockText="*\\\\.\\\*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1070.003" | eval sigma_title="Suspicious IO.FileStream" | eval sigma_description="Open a handle on the drive volume via the \\.\ DOS device path specifier and perform direct access read of the first few bytes of the volume."
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential Keylogger Activity - powershell]
description = Detects PowerShell scripts that contains reference to keystroke capturing functions
search = index=wineventlog* ScriptBlockText="*[Windows.Input.Keyboard]::IsKeyDown([System.Windows.Input.Key]::*" | eval sigma_attack_tags="attack.collection attack.credential_access attack.t1056.001" | eval sigma_title="Potential Keylogger Activity" | eval sigma_description="Detects PowerShell scripts that contains reference to keystroke capturing functions"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious PowerShell Keywords - powershell]
description = Detects keywords that could indicate the use of some PowerShell exploitation framework
search = index=wineventlog* (ScriptBlockText="*System.Reflection.Assembly.Load($*" OR ScriptBlockText="*[System.Reflection.Assembly]::Load($*" OR ScriptBlockText="*[Reflection.Assembly]::Load($*" OR ScriptBlockText="*System.Reflection.AssemblyName*" OR ScriptBlockText="*Reflection.Emit.AssemblyBuilderAccess*" OR ScriptBlockText="*Runtime.InteropServices.DllImportAttribute*" OR ScriptBlockText="*SuspendThread*" OR ScriptBlockText="*rundll32*") | eval sigma_attack_tags="attack.execution attack.t1059.001" | eval sigma_title="Suspicious PowerShell Keywords" | eval sigma_description="Detects keywords that could indicate the use of some PowerShell exploitation framework"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Get Local Groups Information - PowerShell - powershell]
description = Adversaries may attempt to find local system groups and permission settings.
The knowledge of local system permission groups can help adversaries determine which groups exist and which users belong to a particular group.
Adversaries may use this information to determine which users have elevated permissions, such as the users found within the local administrators group.

search = index=wineventlog* ((ScriptBlockText="*get-localgroup*" OR ScriptBlockText="*Get-LocalGroupMember*") OR ((ScriptBlockText="*Get-WMIObject*" ScriptBlockText="*Win32_Group*"))) | eval sigma_attack_tags="attack.discovery attack.t1069.001" | eval sigma_title="Suspicious Get Local Groups Information - PowerShell" | eval sigma_description="Adversaries may attempt to find local system groups and permission settings.
The knowledge of local system permission groups can help adversaries determine which groups exist and which users belong to a particular group.
Adversaries may use this information to determine which users have elevated permissions, such as the users found within the local administrators group.
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Powershell Local Email Collection - powershell]
description = Adversaries may target user email on local systems to collect sensitive information.
Files containing email data can be acquired from a users local system, such as Outlook storage or cache files.

search = index=wineventlog* (ScriptBlockText="*Get-Inbox.ps1*" OR ScriptBlockText="*Microsoft.Office.Interop.Outlook*" OR ScriptBlockText="*Microsoft.Office.Interop.Outlook.olDefaultFolders*" OR ScriptBlockText="*-comobject outlook.application*") | eval sigma_attack_tags="attack.collection attack.t1114.001" | eval sigma_title="Powershell Local Email Collection" | eval sigma_description="Adversaries may target user email on local systems to collect sensitive information.
Files containing email data can be acquired from a users local system, such as Outlook storage or cache files.
"
dispatch.earliest_time = -24h@h
alert.track = 0

[PowerShell Deleted Mounted Share - powershell]
description = Detects when when a mounted share is removed. Adversaries may remove share connections that are no longer useful in order to clean up traces of their operation
search = index=wineventlog* (ScriptBlockText="*Remove-SmbShare*" OR ScriptBlockText="*Remove-FileShare*") | eval sigma_attack_tags="attack.defense_evasion attack.t1070.005" | eval sigma_title="PowerShell Deleted Mounted Share" | eval sigma_description="Detects when when a mounted share is removed. Adversaries may remove share connections that are no longer useful in order to clean up traces of their operation"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious TCP Tunnel Via PowerShell Script - powershell]
description = Detects powershell scripts that creates sockets/listeners which could be indicative of tunneling activity
search = index=wineventlog* ((ScriptBlockText="*[System.Net.HttpWebRequest]*" ScriptBlockText="*System.Net.Sockets.TcpListener*" ScriptBlockText="*AcceptTcpClient*")) | eval sigma_attack_tags="attack.command_and_control attack.t1090" | eval sigma_title="Suspicious TCP Tunnel Via PowerShell Script" | eval sigma_description="Detects powershell scripts that creates sockets/listeners which could be indicative of tunneling activity"
dispatch.earliest_time = -24h@h
alert.track = 0

[Recon Information for Export with PowerShell - powershell]
description = Once established within a system or network, an adversary may use automated techniques for collecting internal data
search = index=wineventlog* (((ScriptBlockText="*Get-Service *" OR ScriptBlockText="*Get-ChildItem *" OR ScriptBlockText="*Get-Process *") ScriptBlockText="*> $env:TEMP\\*")) | eval sigma_attack_tags="attack.collection attack.t1119" | eval sigma_title="Recon Information for Export with PowerShell" | eval sigma_description="Once established within a system or network, an adversary may use automated techniques for collecting internal data"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Service DACL Modification Via Set-Service Cmdlet - PS - powershell]
description = Detects usage of the 'Set-Service' powershell cmdlet to configure a new SecurityDescriptor that allows a service to be hidden from other utilities such as 'sc.exe', 'Get-Service'...etc. (Works only in powershell 7)
search = index=wineventlog* (((ScriptBlockText="*-SecurityDescriptorSddl *" OR ScriptBlockText="*-sd *") ScriptBlockText="*Set-Service *" ScriptBlockText="*D;;*" (ScriptBlockText="*;;;IU*" OR ScriptBlockText="*;;;SU*" OR ScriptBlockText="*;;;BA*" OR ScriptBlockText="*;;;SY*" OR ScriptBlockText="*;;;WD*"))) | eval sigma_attack_tags="attack.persistence attack.defense_evasion attack.privilege_escalation attack.t1574.011" | eval sigma_title="Suspicious Service DACL Modification Via Set-Service Cmdlet - PS" | eval sigma_description="Detects usage of the 'Set-Service' powershell cmdlet to configure a new SecurityDescriptor that allows a service to be hidden from other utilities such as 'sc.exe', 'Get-Service'...etc. (Works only in powershell 7)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential PowerShell Obfuscation Using Alias Cmdlets - powershell]
description = Detects Set-Alias or New-Alias cmdlet usage. Which can be use as a mean to obfuscate PowerShell scripts
search = index=wineventlog* (ScriptBlockText="*Set-Alias *" OR ScriptBlockText="*New-Alias *") | eval sigma_attack_tags="attack.defense_evasion attack.execution attack.t1027 attack.t1059.001" | eval sigma_title="Potential PowerShell Obfuscation Using Alias Cmdlets" | eval sigma_description="Detects Set-Alias or New-Alias cmdlet usage. Which can be use as a mean to obfuscate PowerShell scripts"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Get Information for SMB Share - powershell]
description = Adversaries may look for folders and drives shared on remote systems as a means of identifying sources of information to gather as
a precursor for Collection and to identify potential systems of interest for Lateral Movement.
Networks often contain shared network drives and folders that enable users to access file directories on various systems across a network.

search = index=wineventlog* ScriptBlockText="*get-smbshare*" | eval sigma_attack_tags="attack.discovery attack.t1069.001" | eval sigma_title="Suspicious Get Information for SMB Share" | eval sigma_description="Adversaries may look for folders and drives shared on remote systems as a means of identifying sources of information to gather as
a precursor for Collection and to identify potential systems of interest for Lateral Movement.
Networks often contain shared network drives and folders that enable users to access file directories on various systems across a network.
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Start-Process PassThru - powershell]
description = Powershell use PassThru option to start in background
search = index=wineventlog* ((ScriptBlockText="*Start-Process*" ScriptBlockText="*-PassThru *" ScriptBlockText="*-FilePath *")) | eval sigma_attack_tags="attack.defense_evasion attack.t1036.003" | eval sigma_title="Suspicious Start-Process PassThru" | eval sigma_description="Powershell use PassThru option to start in background"
dispatch.earliest_time = -24h@h
alert.track = 0

[Replace Desktop Wallpaper by Powershell - powershell]
description = An adversary may deface systems internal to an organization in an attempt to intimidate or mislead users.
This may take the form of modifications to internal websites, or directly to user systems with the replacement of the desktop wallpaper

search = index=wineventlog* (((ScriptBlockText="*Get-ItemProperty*" ScriptBlockText="*Registry::*" ScriptBlockText="*HKEY_CURRENT_USER\\Control Panel\\Desktop\\*" ScriptBlockText="*WallPaper*")) OR ScriptBlockText="*SystemParametersInfo(20,0,*,3)*") | eval sigma_attack_tags="attack.impact attack.t1491.001" | eval sigma_title="Replace Desktop Wallpaper by Powershell" | eval sigma_description="An adversary may deface systems internal to an organization in an attempt to intimidate or mislead users.
This may take the form of modifications to internal websites, or directly to user systems with the replacement of the desktop wallpaper
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Powershell Suspicious Win32_PnPEntity - powershell]
description = Adversaries may attempt to gather information about attached peripheral devices and components connected to a computer system.
search = index=wineventlog* ScriptBlockText="*Win32_PnPEntity*" | eval sigma_attack_tags="attack.discovery attack.t1120" | eval sigma_title="Powershell Suspicious Win32_PnPEntity" | eval sigma_description="Adversaries may attempt to gather information about attached peripheral devices and components connected to a computer system."
dispatch.earliest_time = -24h@h
alert.track = 0

[Deletion of Volume Shadow Copies via WMI with PowerShell - PS Script - powershell]
description = Detects deletion of Windows Volume Shadow Copies with PowerShell code and Get-WMIObject. This technique is used by numerous ransomware families such as Sodinokibi/REvil
search = index=wineventlog* (((ScriptBlockText="*Get-WmiObject*" OR ScriptBlockText="*gwmi*" OR ScriptBlockText="*Get-CimInstance*" OR ScriptBlockText="*gcim*") ScriptBlockText="*Win32_Shadowcopy*" (ScriptBlockText="*.Delete()*" OR ScriptBlockText="*Remove-WmiObject*" OR ScriptBlockText="*rwmi*" OR ScriptBlockText="*Remove-CimInstance*" OR ScriptBlockText="*rcim*"))) | eval sigma_attack_tags="attack.impact attack.t1490" | eval sigma_title="Deletion of Volume Shadow Copies via WMI with PowerShell - PS Script" | eval sigma_description="Detects deletion of Windows Volume Shadow Copies with PowerShell code and Get-WMIObject. This technique is used by numerous ransomware families such as Sodinokibi/REvil"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious PowerShell WindowStyle Option - powershell]
description = Adversaries may use hidden windows to conceal malicious activity from the plain sight of users.
In some cases, windows that would typically be displayed when an application carries out an operation can be hidden

search = index=wineventlog* ((((ScriptBlockText="*powershell*" ScriptBlockText="*WindowStyle*" ScriptBlockText="*Hidden*")) NOT (((ScriptBlockText="*:\\Program Files\\Amazon\\WorkSpacesConfig\\Scripts\\*" ScriptBlockText="*$PSScriptRoot\\Module\\WorkspaceScriptModule\\WorkspaceScriptModule*"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1564.003" | eval sigma_title="Suspicious PowerShell WindowStyle Option" | eval sigma_description="Adversaries may use hidden windows to conceal malicious activity from the plain sight of users.
In some cases, windows that would typically be displayed when an application carries out an operation can be hidden
"
dispatch.earliest_time = -24h@h
alert.track = 0

[PowerShell Write-EventLog Usage - powershell]
description = Detects usage of the 'Write-EventLog' cmdlet with 'RawData' flag. The cmdlet can be levreage to write malicious payloads to the EventLog and then retrieve them later for later use
search = index=wineventlog* ((ScriptBlockText="*Write-EventLog*" ScriptBlockText="*-RawData *")) | eval sigma_attack_tags="attack.defense_evasion" | eval sigma_title="PowerShell Write-EventLog Usage" | eval sigma_description="Detects usage of the 'Write-EventLog' cmdlet with 'RawData' flag. The cmdlet can be levreage to write malicious payloads to the EventLog and then retrieve them later for later use"
dispatch.earliest_time = -24h@h
alert.track = 0

[Zip A Folder With PowerShell For Staging In Temp - PowerShell Script - powershell]
description = Use living off the land tools to zip a file and stage it in the Windows temporary folder for later exfiltration
search = index=wineventlog* ((ScriptBlockText="*Compress-Archive *" ScriptBlockText="* -Path *" ScriptBlockText="* -DestinationPath *" ScriptBlockText="*$env:TEMP\\*")) | eval sigma_attack_tags="attack.collection attack.t1074.001" | eval sigma_title="Zip A Folder With PowerShell For Staging In Temp - PowerShell Script" | eval sigma_description="Use living off the land tools to zip a file and stage it in the Windows temporary folder for later exfiltration"
dispatch.earliest_time = -24h@h
alert.track = 0

[SyncAppvPublishingServer Execution to Bypass Powershell Restriction - powershell]
description = Detects SyncAppvPublishingServer process execution which usually utilized by adversaries to bypass PowerShell execution restrictions.
search = index=wineventlog* ScriptBlockText="*SyncAppvPublishingServer.exe*" | eval sigma_attack_tags="attack.defense_evasion attack.t1218" | eval sigma_title="SyncAppvPublishingServer Execution to Bypass Powershell Restriction" | eval sigma_description="Detects SyncAppvPublishingServer process execution which usually utilized by adversaries to bypass PowerShell execution restrictions."
dispatch.earliest_time = -24h@h
alert.track = 0

[Tamper Windows Defender Remove-MpPreference - ScriptBlockLogging - powershell]
description = Detects attempts to remove windows defender configuration using the 'MpPreference' cmdlet
search = index=wineventlog* ((ScriptBlockText="*Remove-MpPreference*" (ScriptBlockText="*-ControlledFolderAccessProtectedFolders *" OR ScriptBlockText="*-AttackSurfaceReductionRules_Ids *" OR ScriptBlockText="*-AttackSurfaceReductionRules_Actions *" OR ScriptBlockText="*-CheckForSignaturesBeforeRunningScan *"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.001" | eval sigma_title="Tamper Windows Defender Remove-MpPreference - ScriptBlockLogging" | eval sigma_description="Detects attempts to remove windows defender configuration using the 'MpPreference' cmdlet"
dispatch.earliest_time = -24h@h
alert.track = 0

[Tamper Windows Defender - ScriptBlockLogging - powershell]
description = Detects powershell scripts attempting to disable scheduled scanning and other parts of windows defender atp or set default actions to allow.
search = index=wineventlog* (((ScriptBlockText="*Set-MpPreference*" (ScriptBlockText="*DisableRealtimeMonitoring 1*" OR ScriptBlockText="*DisableBehaviorMonitoring 1*" OR ScriptBlockText="*DisableScriptScanning 1*" OR ScriptBlockText="*DisableArchiveScanning 1*" OR ScriptBlockText="*DisableBlockAtFirstSeen 1*" OR ScriptBlockText="*DisableIOAVProtection 1*" OR ScriptBlockText="*DisableIntrusionPreventionSystem 1*" OR ScriptBlockText="*DisableRemovableDriveScanning 1*" OR ScriptBlockText="*DisableScanningMappedNetworkDrivesForFullScan 1*" OR ScriptBlockText="*DisableScanningNetworkFiles 1*" OR ScriptBlockText="*DisableRealtimeMonitoring $true*" OR ScriptBlockText="*DisableBehaviorMonitoring $true*" OR ScriptBlockText="*DisableScriptScanning $true*" OR ScriptBlockText="*DisableArchiveScanning $true*" OR ScriptBlockText="*DisableBlockAtFirstSeen $true*" OR ScriptBlockText="*DisableIOAVProtection $true*" OR ScriptBlockText="*DisableIntrusionPreventionSystem $true*" OR ScriptBlockText="*DisableRemovableDriveScanning $true*" OR ScriptBlockText="*DisableScanningMappedNetworkDrivesForFullScan $true*" OR ScriptBlockText="*DisableScanningNetworkFiles $true*"))) OR (((ScriptBlockText="*Set-MpPreference*" ScriptBlockText="*Allow*" (ScriptBlockText="*LowThreatDefaultAction*" OR ScriptBlockText="*ModerateThreatDefaultAction*" OR ScriptBlockText="*HighThreatDefaultAction*"))) OR (ScriptBlockText="*ltdefac *" OR ScriptBlockText="*mtdefac *" OR ScriptBlockText="*htdefac *" OR ScriptBlockText="*stdefac *"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.001" | eval sigma_title="Tamper Windows Defender - ScriptBlockLogging" | eval sigma_description="Detects powershell scripts attempting to disable scheduled scanning and other parts of windows defender atp or set default actions to allow."
dispatch.earliest_time = -24h@h
alert.track = 0

[Powershell Timestomp - powershell]
description = Adversaries may modify file time attributes to hide new or changes to existing files.
Timestomping is a technique that modifies the timestamps of a file (the modify, access, create, and change times), often to mimic files that are in the same folder.

search = index=wineventlog* (ScriptBlockText="*.CreationTime =*" OR ScriptBlockText="*.LastWriteTime =*" OR ScriptBlockText="*.LastAccessTime =*" OR ScriptBlockText="*[IO.File]::SetCreationTime*" OR ScriptBlockText="*[IO.File]::SetLastAccessTime*" OR ScriptBlockText="*[IO.File]::SetLastWriteTime*") | eval sigma_attack_tags="attack.defense_evasion attack.t1070.006" | eval sigma_title="Powershell Timestomp" | eval sigma_description="Adversaries may modify file time attributes to hide new or changes to existing files.
Timestomping is a technique that modifies the timestamps of a file (the modify, access, create, and change times), often to mimic files that are in the same folder.
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Powershell Trigger Profiles by Add_Content - powershell]
description = Adversaries may gain persistence and elevate privileges by executing malicious content triggered by PowerShell profiles.
search = index=wineventlog* ((ScriptBlockText="*Add-Content*" ScriptBlockText="*$profile*" ScriptBlockText="*-Value*" (ScriptBlockText="*Start-Process*" OR ScriptBlockText="*\"\"*"))) | eval sigma_attack_tags="attack.privilege_escalation attack.t1546.013" | eval sigma_title="Powershell Trigger Profiles by Add_Content" | eval sigma_description="Adversaries may gain persistence and elevate privileges by executing malicious content triggered by PowerShell profiles."
dispatch.earliest_time = -24h@h
alert.track = 0

[Windows PowerShell Upload Web Request - powershell]
description = Detects the use of various web request POST or PUT methods (including aliases) via Windows PowerShell command
search = index=wineventlog* (((ScriptBlockText="*Invoke-WebRequest*" OR ScriptBlockText="*iwr *") ScriptBlockText="*-Method *" (ScriptBlockText="* Put *" OR ScriptBlockText="* Post *"))) | eval sigma_attack_tags="attack.exfiltration attack.t1020" | eval sigma_title="Windows PowerShell Upload Web Request" | eval sigma_description="Detects the use of various web request POST or PUT methods (including aliases) via Windows PowerShell command"
dispatch.earliest_time = -24h@h
alert.track = 0

[User Discovery And Export Via Get-ADUser Cmdlet - PowerShell - powershell]
description = Detects usage of the Get-ADUser cmdlet to collect user information and output it to a file
search = index=wineventlog* ((ScriptBlockText="*Get-ADUser *" ScriptBlockText="* -Filter \*" (ScriptBlockText="* > *" OR ScriptBlockText="* | Select *" OR ScriptBlockText="*Out-File*" OR ScriptBlockText="*Set-Content*" OR ScriptBlockText="*Add-Content*"))) | eval sigma_attack_tags="attack.discovery attack.t1033" | eval sigma_title="User Discovery And Export Via Get-ADUser Cmdlet - PowerShell" | eval sigma_description="Detects usage of the Get-ADUser cmdlet to collect user information and output it to a file"
dispatch.earliest_time = -24h@h
alert.track = 0

[Abuse of Service Permissions to Hide Services Via Set-Service - PS - powershell]
description = Detects usage of the 'Set-Service' powershell cmdlet to configure a new SecurityDescriptor that allows a service to be hidden from other utilities such as 'sc.exe', 'Get-Service'...etc. (Works only in powershell 7)
search = index=wineventlog* ((ScriptBlockText="*Set-Service *" ScriptBlockText="*DCLCWPDTSD*" (ScriptBlockText="*-SecurityDescriptorSddl *" OR ScriptBlockText="*-sd *"))) | eval sigma_attack_tags="attack.persistence attack.defense_evasion attack.privilege_escalation attack.t1574.011" | eval sigma_title="Abuse of Service Permissions to Hide Services Via Set-Service - PS" | eval sigma_description="Detects usage of the 'Set-Service' powershell cmdlet to configure a new SecurityDescriptor that allows a service to be hidden from other utilities such as 'sc.exe', 'Get-Service'...etc. (Works only in powershell 7)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Usage Of Web Request Commands And Cmdlets - ScriptBlock - powershell]
description = Detects the use of various web request commands with commandline tools and Windows PowerShell cmdlets (including aliases) via PowerShell scriptblock logs
search = index=wineventlog* (((ScriptBlockText="*Invoke-WebRequest*" OR ScriptBlockText="*iwr *" OR ScriptBlockText="*wget *" OR ScriptBlockText="*curl *" OR ScriptBlockText="*Net.WebClient*" OR ScriptBlockText="*Start-BitsTransfer*" OR ScriptBlockText="*Resume-BitsTransfer*" OR ScriptBlockText="*[System.Net.WebRequest]::create*" OR ScriptBlockText="*Invoke-RestMethod*" OR ScriptBlockText="*WinHttp.WinHttpRequest*") NOT ((Path="C:\\Packages\\Plugins\\Microsoft.GuestConfiguration.ConfigurationforWindows\\*")))) | eval sigma_attack_tags="attack.execution attack.t1059.001" | eval sigma_title="Usage Of Web Request Commands And Cmdlets - ScriptBlock" | eval sigma_description="Detects the use of various web request commands with commandline tools and Windows PowerShell cmdlets (including aliases) via PowerShell scriptblock logs"
dispatch.earliest_time = -24h@h
alert.track = 0

[Windows Defender Exclusions Added - PowerShell - powershell]
description = Detects modifications to the Windows Defender configuration settings using PowerShell to add exclusions
search = index=wineventlog* (((ScriptBlockText="* -ExclusionPath *" OR ScriptBlockText="* -ExclusionExtension *" OR ScriptBlockText="* -ExclusionProcess *" OR ScriptBlockText="* -ExclusionIpAddress *") (ScriptBlockText="*Add-MpPreference *" OR ScriptBlockText="*Set-MpPreference *"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1562 attack.execution attack.t1059" | eval sigma_title="Windows Defender Exclusions Added - PowerShell" | eval sigma_description="Detects modifications to the Windows Defender configuration settings using PowerShell to add exclusions"
dispatch.earliest_time = -24h@h
alert.track = 0

[PowerShell WMI Win32_Product Install MSI - powershell]
description = Detects the execution of an MSI file using PowerShell and the WMI Win32_Product class
search = index=wineventlog* ((ScriptBlockText="*Invoke-CimMethod *" ScriptBlockText="*-ClassName *" ScriptBlockText="*Win32_Product *" ScriptBlockText="*-MethodName *" ScriptBlockText="*.msi*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1218.007" | eval sigma_title="PowerShell WMI Win32_Product Install MSI" | eval sigma_description="Detects the execution of an MSI file using PowerShell and the WMI Win32_Product class"
dispatch.earliest_time = -24h@h
alert.track = 0

[Windows Firewall Profile Disabled - powershell]
description = Detects when a user disables the Windows Firewall via a Profile to help evade defense.
search = index=wineventlog* ((ScriptBlockText="*Set-NetFirewallProfile *" ScriptBlockText="* -Enabled *" ScriptBlockText="* False*" (ScriptBlockText="* -All *" OR ScriptBlockText="*Public*" OR ScriptBlockText="*Domain*" OR ScriptBlockText="*Private*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.004" | eval sigma_title="Windows Firewall Profile Disabled" | eval sigma_description="Detects when a user disables the Windows Firewall via a Profile to help evade defense."
dispatch.earliest_time = -24h@h
alert.track = 0

[Winlogon Helper DLL - powershell]
description = Winlogon.exe is a Windows component responsible for actions at logon/logoff as well as the secure attention sequence (SAS) triggered by Ctrl-Alt-Delete.
Registry entries in HKLM\Software[Wow6432Node]Microsoft\Windows NT\CurrentVersion\Winlogon\ and HKCU\Software\Microsoft\Windows NT\CurrentVersion\Winlogon\ are
used to manage additional helper programs and functionalities that support Winlogon. Malicious modifications to these Registry keys may cause Winlogon to
load and execute malicious DLLs and/or executables.

search = index=wineventlog* ((ScriptBlockText="*CurrentVersion\\Winlogon*" (ScriptBlockText="*Set-ItemProperty*" OR ScriptBlockText="*New-Item*"))) | eval sigma_attack_tags="attack.persistence attack.t1547.004" | eval sigma_title="Winlogon Helper DLL" | eval sigma_description="Winlogon.exe is a Windows component responsible for actions at logon/logoff as well as the secure attention sequence (SAS) triggered by Ctrl-Alt-Delete.
Registry entries in HKLM\Software[Wow6432Node]Microsoft\Windows NT\CurrentVersion\Winlogon\ and HKCU\Software\Microsoft\Windows NT\CurrentVersion\Winlogon\ are
used to manage additional helper programs and functionalities that support Winlogon. Malicious modifications to these Registry keys may cause Winlogon to
load and execute malicious DLLs and/or executables.
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Powershell WMI Persistence - powershell]
description = Adversaries may establish persistence and elevate privileges by executing malicious content triggered by a Windows Management Instrumentation (WMI) event subscription.
search = index=wineventlog* (((ScriptBlockText="*New-CimInstance *" ScriptBlockText="*-Namespace root/subscription *" ScriptBlockText="*-ClassName __EventFilter *" ScriptBlockText="*-Property *")) OR ((ScriptBlockText="*New-CimInstance *" ScriptBlockText="*-Namespace root/subscription *" ScriptBlockText="*-ClassName CommandLineEventConsumer *" ScriptBlockText="*-Property *"))) | eval sigma_attack_tags="attack.privilege_escalation attack.t1546.003" | eval sigma_title="Powershell WMI Persistence" | eval sigma_description="Adversaries may establish persistence and elevate privileges by executing malicious content triggered by a Windows Management Instrumentation (WMI) event subscription."
dispatch.earliest_time = -24h@h
alert.track = 0

[WMIC Unquoted Services Path Lookup - PowerShell - powershell]
description = Detects known WMI recon method to look for unquoted service paths, often used by pentest inside of powershell scripts attackers enum scripts
search = index=wineventlog* (((ScriptBlockText="*Get-WmiObject *" OR ScriptBlockText="*gwmi *") ScriptBlockText="* Win32_Service *" ScriptBlockText="*Name*" ScriptBlockText="*DisplayName*" ScriptBlockText="*PathName*" ScriptBlockText="*StartMode*")) | eval sigma_attack_tags="attack.execution attack.t1047" | eval sigma_title="WMIC Unquoted Services Path Lookup - PowerShell" | eval sigma_description="Detects known WMI recon method to look for unquoted service paths, often used by pentest inside of powershell scripts attackers enum scripts"
dispatch.earliest_time = -24h@h
alert.track = 0

[WMImplant Hack Tool - powershell]
description = Detects parameters used by WMImplant
search = index=wineventlog* (ScriptBlockText="*WMImplant*" OR ScriptBlockText="* change_user *" OR ScriptBlockText="* gen_cli *" OR ScriptBlockText="* command_exec *" OR ScriptBlockText="* disable_wdigest *" OR ScriptBlockText="* disable_winrm *" OR ScriptBlockText="* enable_wdigest *" OR ScriptBlockText="* enable_winrm *" OR ScriptBlockText="* registry_mod *" OR ScriptBlockText="* remote_posh *" OR ScriptBlockText="* sched_job *" OR ScriptBlockText="* service_mod *" OR ScriptBlockText="* process_kill *" OR ScriptBlockText="* active_users *" OR ScriptBlockText="* basic_info *" OR ScriptBlockText="* power_off *" OR ScriptBlockText="* vacant_system *" OR ScriptBlockText="* logon_events *") | eval sigma_attack_tags="attack.execution attack.t1047 attack.t1059.001" | eval sigma_title="WMImplant Hack Tool" | eval sigma_description="Detects parameters used by WMImplant"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious X509Enrollment - Ps Script - powershell]
description = Detect use of X509Enrollment
search = index=wineventlog* (ScriptBlockText="*X509Enrollment.CBinaryConverter*" OR ScriptBlockText="*884e2002-217d-11da-b2a4-000e7bbb2b09*") | eval sigma_attack_tags="" | eval sigma_title="Suspicious X509Enrollment - Ps Script" | eval sigma_description="Detect use of X509Enrollment"
dispatch.earliest_time = -24h@h
alert.track = 0

[Sysmon Configuration Error - sysmon]
description = Detects when an adversary is trying to hide it's action from Sysmon logging based on error messages
search = index=sysmon* ((((EventCode="255" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Description="*Failed to open service configuration with error*" OR Description="*Failed to connect to the driver to update configuration*") NOT ((((Description="*Failed to open service configuration with error*" Description="*Last error: The media is write protected.*"))) OR (((Description="*Failed to open service configuration with error 19*" OR Description="*Failed to open service configuration with error 93*")))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1564" | eval sigma_title="Sysmon Configuration Error" | eval sigma_description="Detects when an adversary is trying to hide it's action from Sysmon logging based on error messages"
dispatch.earliest_time = -24h@h
alert.track = 0

[Sysmon Configuration Modification - sysmon]
description = Detects when an attacker tries to hide from Sysmon by disabling or stopping it
search = index=sysmon* (((((EventCode="4" OR EventCode="16") (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (State="Stopped" OR "Sysmon config state changed") NOT ((State="Started")))) | eval sigma_attack_tags="attack.defense_evasion attack.t1564" | eval sigma_title="Sysmon Configuration Modification" | eval sigma_description="Detects when an attacker tries to hide from Sysmon by disabling or stopping it"
dispatch.earliest_time = -24h@h
alert.track = 0

[Sysmon Configuration Change - sysmon]
description = Detects a Sysmon configuration change, which could be the result of a legitimate reconfiguration or someone trying manipulate the configuration
search = index=sysmon* (((source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") EventCode="16")) | eval sigma_attack_tags="attack.defense_evasion" | eval sigma_title="Sysmon Configuration Change" | eval sigma_description="Detects a Sysmon configuration change, which could be the result of a legitimate reconfiguration or someone trying manipulate the configuration"
dispatch.earliest_time = -24h@h
alert.track = 0

[Sysmon Blocked Executable - sysmon]
description = Triggers on any Sysmon file block executable event. Which should indicates a violation of the block policy set
search = index=sysmon* ((EventCode="27" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) | eval sigma_attack_tags="attack.defense_evasion" | eval sigma_title="Sysmon Blocked Executable" | eval sigma_description="Triggers on any Sysmon file block executable event. Which should indicates a violation of the block policy set"
dispatch.earliest_time = -24h@h
alert.track = 0

[Sysmon Process Hollowing Detection - sysmon]
description = Detects when a memory process image does not match the disk image, indicative of process hollowing.
search = index=sysmon* ((((EventCode="25" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) Type="Image is replaced" NOT (((Image="*:\\Program Files\\*" OR Image="*:\\Program Files (x86)*") (Image="*\\chrome.exe" OR Image="*\\opera.exe" OR Image="*\\firefox.exe" OR Image="*\\MicrosoftEdge.exe" OR Image="*\\WMIADAP.exe"))))) | eval sigma_attack_tags="attack.defense_evasion attack.privilege_escalation attack.t1055.012" | eval sigma_title="Sysmon Process Hollowing Detection" | eval sigma_description="Detects when a memory process image does not match the disk image, indicative of process hollowing."
dispatch.earliest_time = -24h@h
alert.track = 0

[Credential Dumping Tools Service Execution - sysmon]
description = Detects well-known credential dumping tools execution via service execution events
search = index=sysmon* ((EventCode="6" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (ImageLoaded="*fgexec*" OR ImageLoaded="*dumpsvc*" OR ImageLoaded="*cachedump*" OR ImageLoaded="*mimidrv*" OR ImageLoaded="*gsecdump*" OR ImageLoaded="*servpw*" OR ImageLoaded="*pwdump*"))) | eval sigma_attack_tags="attack.credential_access attack.execution attack.t1003.001 attack.t1003.002 attack.t1003.004 attack.t1003.005 attack.t1003.006 attack.t1569.002 attack.s0005" | eval sigma_title="Credential Dumping Tools Service Execution" | eval sigma_description="Detects well-known credential dumping tools execution via service execution events"
dispatch.earliest_time = -24h@h
alert.track = 0

[Usage Of Malicious POORTRY Signed Driver - sysmon]
description = Detects the load of the signed poortry driver used by UNC3944 as reported by Mandiant and Sentinel One.
search = index=sysmon* ((((EventCode="6" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((ImageLoaded="*\\prokiller64.sys*" OR ImageLoaded="*\\gftkyj64.sys*" OR ImageLoaded="*\\KApcHelper_x64.sys*" OR ImageLoaded="*\\NodeDriver.sys*" OR ImageLoaded="*\\LcTkA.sys*") OR (Hashes="*SHA256=0440ef40c46fdd2b5d86e7feef8577a8591de862cfd7928cdbcc8f47b8fa3ffc*" OR Hashes="*SHA256=9b1b15a3aacb0e786a608726c3abfc94968915cedcbd239ddf903c4a54bfcf0c*" OR Hashes="*SHA256=8e035beb02a411f8a9e92d4cf184ad34f52bbd0a81a50c222cdd4706e4e45104*" OR Hashes="*SHA256=d7c81b0f3c14844f6424e8bdd31a128e773cb96cccef6d05cbff473f0ccb9f9c*" OR Hashes="*SHA256=05b146a48a69dd62a02759487e769bd30d39f16374bc76c86453b4ae59e7ffa4*" OR Hashes="*SHA256=c8f9e1ad7b8cce62fba349a00bc168c849d42cfb2ca5b2c6cc4b51d054e0c497*" OR Hashes="*SHA1=31cc8718894d6e6ce8c132f68b8caaba39b5ba7a*" OR Hashes="*SHA1=a804ebec7e341b4d98d9e94f6e4860a55ea1638d*" OR Hashes="*SHA1=6debce728bcff73d9d1d334df0c6b1c3735e295c*" OR Hashes="*SHA1=cc65bf60600b64feece5575f21ab89e03a728332*" OR Hashes="*SHA1=3ef30c95e40a854cc4ded94fc503d0c3dc3e620e*" OR Hashes="*SHA1=b2f955b3e6107f831ebe67997f8586d4fe9f3e98*" OR Hashes="*MD5=10f3679384a03cb487bda9621ceb5f90*" OR Hashes="*MD5=04a88f5974caa621cee18f34300fc08a*" OR Hashes="*MD5=6fcf56f6ca3210ec397e55f727353c4a*" OR Hashes="*MD5=0f16a43f7989034641fd2de3eb268bf1*" OR Hashes="*MD5=ee6b1a79cb6641aa44c762ee90786fe0*" OR Hashes="*MD5=909f3fc221acbe999483c87d9ead024a*") OR (sha256="0440ef40c46fdd2b5d86e7feef8577a8591de862cfd7928cdbcc8f47b8fa3ffc" OR sha256="9b1b15a3aacb0e786a608726c3abfc94968915cedcbd239ddf903c4a54bfcf0c" OR sha256="8e035beb02a411f8a9e92d4cf184ad34f52bbd0a81a50c222cdd4706e4e45104" OR sha256="d7c81b0f3c14844f6424e8bdd31a128e773cb96cccef6d05cbff473f0ccb9f9c" OR sha256="05b146a48a69dd62a02759487e769bd30d39f16374bc76c86453b4ae59e7ffa4" OR sha256="c8f9e1ad7b8cce62fba349a00bc168c849d42cfb2ca5b2c6cc4b51d054e0c497") OR (sha1="31cc8718894d6e6ce8c132f68b8caaba39b5ba7a" OR sha1="a804ebec7e341b4d98d9e94f6e4860a55ea1638d" OR sha1="6debce728bcff73d9d1d334df0c6b1c3735e295c" OR sha1="cc65bf60600b64feece5575f21ab89e03a728332" OR sha1="3ef30c95e40a854cc4ded94fc503d0c3dc3e620e" OR sha1="b2f955b3e6107f831ebe67997f8586d4fe9f3e98") OR (md5="10f3679384a03cb487bda9621ceb5f90" OR md5="04a88f5974caa621cee18f34300fc08a" OR md5="6fcf56f6ca3210ec397e55f727353c4a" OR md5="0f16a43f7989034641fd2de3eb268bf1" OR md5="ee6b1a79cb6641aa44c762ee90786fe0" OR md5="909f3fc221acbe999483c87d9ead024a")))) | eval sigma_attack_tags="attack.privilege_escalation attack.t1543 attack.t1068" | eval sigma_title="Usage Of Malicious POORTRY Signed Driver" | eval sigma_description="Detects the load of the signed poortry driver used by UNC3944 as reported by Mandiant and Sentinel One."
dispatch.earliest_time = -24h@h
alert.track = 0

[PowerShell Scripts Run by a Services - sysmon]
description = Detects powershell script installed as a Service
search = index=sysmon* ((EventCode="6" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (ImageLoaded="*powershell*" OR ImageLoaded="*pwsh*"))) | eval sigma_attack_tags="attack.execution attack.t1569.002" | eval sigma_title="PowerShell Scripts Run by a Services" | eval sigma_description="Detects powershell script installed as a Service"
dispatch.earliest_time = -24h@h
alert.track = 0

[Process Hacker and System Informer Driver Load - sysmon]
description = Detects the load of drivers used by Process Hacker and System Informer
search = index=sysmon* ((((EventCode="6" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((ImageLoaded="*\\kprocesshacker.sys" OR ImageLoaded="*\\SystemInformer.sys") OR (Hashes="*IMPHASH=821D74031D3F625BCBD0DF08B70F1E77*" OR Hashes="*IMPHASH=F86759BB4DE4320918615DC06E998A39*" OR Hashes="*IMPHASH=0A64EEB85419257D0CE32BD5D55C3A18*" OR Hashes="*IMPHASH=6E7B34DFC017700B1517B230DF6FF0D0*") OR (Imphash="821D74031D3F625BCBD0DF08B70F1E77" OR Imphash="F86759BB4DE4320918615DC06E998A39" OR Imphash="0A64EEB85419257D0CE32BD5D55C3A18" OR Imphash="6E7B34DFC017700B1517B230DF6FF0D0") OR (Hashes="*SHA256=8B9AD98944AC9886EA4CB07700E71B78BE4A2740934BB7E46CA3B56A7C59AD24*" OR Hashes="*SHA256=A41348BEC147CA4D9EA2869817527EB5CEA2E20202AF599D2B30625433BCF454*" OR Hashes="*SHA256=38EE0A88AF8535A11EFE8D8DA9C6812AA07067B75A64D99705A742589BDD846D*" OR Hashes="*SHA256=A773891ACF203A7EB0C0D30942FB1347648F1CD918AE2BFD9A4857B4DCF5081B*" OR Hashes="*SHA256=4C3B81AC88A987BBDF7D41FA0AECC2CEDF5B9BD2F45E7A21F376D05345FC211D*" OR Hashes="*SHA256=3241BC14BEC51CE6A691B9A3562E5C1D52E9D057D27A3D67FD0B245C350B6D34*" OR Hashes="*SHA256=047C42E9BBA28366868847C7DAFC1E043FB038C796422D37220493517D68EE89*" OR Hashes="*SHA256=18931DC81E95D0020466FA091E16869DBE824E543A4C2C8FE644FA71A0F44FEB*" OR Hashes="*SHA256=B4C2EF76C204273132FDE38F0DED641C2C5EE767652E64E4C4071A4A973B6C1B*" OR Hashes="*SHA256=640954AFC268565F7DAA6E6F81A8EE05311E33E34332B501A3C3FE5B22ADEA97*" OR Hashes="*SHA256=251BE949F662C838718F8AA0A5F8211FB90346D02BD63FF91E6B224E0E01B656*" OR Hashes="*SHA256=E2606F272F7BA054DF16BE464FDA57211EF0D14A0D959F9C8DCB0575DF1186E4*" OR Hashes="*SHA256=3A9E1D17BEEB514F1B9B3BACAEE7420285DE5CBDCE89C5319A992C6CBD1DE138*") OR (sha256="8b9ad98944ac9886ea4cb07700e71b78be4a2740934bb7e46ca3b56a7c59ad24" OR sha256="a41348bec147ca4d9ea2869817527eb5cea2e20202af599d2b30625433bcf454" OR sha256="38ee0a88af8535a11efe8d8da9c6812aa07067b75a64d99705a742589bdd846d" OR sha256="a773891acf203a7eb0c0d30942fb1347648f1cd918ae2bfd9a4857b4dcf5081b" OR sha256="4c3b81ac88a987bbdf7d41fa0aecc2cedf5b9bd2f45e7a21f376d05345fc211d" OR sha256="3241bc14bec51ce6a691b9a3562e5c1d52e9d057d27a3d67fd0b245c350b6d34" OR sha256="047c42e9bba28366868847c7dafc1e043fb038c796422d37220493517d68ee89" OR sha256="18931dc81e95d0020466fa091e16869dbe824e543a4c2c8fe644fa71a0f44feb" OR sha256="b4c2ef76c204273132fde38f0ded641c2c5ee767652e64e4c4071a4a973b6c1b" OR sha256="640954afc268565f7daa6e6f81a8ee05311e33e34332b501a3c3fe5b22adea97" OR sha256="251be949f662c838718f8aa0a5f8211fb90346d02bd63ff91e6b224e0e01b656" OR sha256="e2606f272f7ba054df16be464fda57211ef0d14a0d959f9c8dcb0575df1186e4" OR sha256="3a9e1d17beeb514f1b9b3bacaee7420285de5cbdce89c5319a992c6cbd1de138")))) | eval sigma_attack_tags="attack.privilege_escalation cve.2021.21551 attack.t1543" | eval sigma_title="Process Hacker and System Informer Driver Load" | eval sigma_description="Detects the load of drivers used by Process Hacker and System Informer"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Driver Load from Temp - sysmon]
description = Detects a driver load from a temporary directory
search = index=sysmon* ((EventCode="6" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") ImageLoaded="*\\Temp\\*")) | eval sigma_attack_tags="attack.persistence attack.privilege_escalation attack.t1543.003" | eval sigma_title="Suspicious Driver Load from Temp" | eval sigma_description="Detects a driver load from a temporary directory"
dispatch.earliest_time = -24h@h
alert.track = 0

[Vulnerable AVAST Anti Rootkit Driver Load - sysmon]
description = Detects the load of a signed and vulnerable AVAST Anti Rootkit driver often used by threat actors or malware for stopping and disabling AV and EDR products
search = index=sysmon* ((((EventCode="6" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((Hashes="*MD5=a179c4093d05a3e1ee73f6ff07f994aa*" OR Hashes="*SHA1=5d6b9e80e12bfc595d4d26f6afb099b3cb471dd4*" OR Hashes="*SHA256=4b5229b3250c8c08b98cb710d6c056144271de099a57ae09f5d2097fc41bd4f1*") OR md5="a179c4093d05a3e1ee73f6ff07f994aa" OR sha1="5d6b9e80e12bfc595d4d26f6afb099b3cb471dd4" OR sha256="4b5229b3250c8c08b98cb710d6c056144271de099a57ae09f5d2097fc41bd4f1") OR ((ImageLoaded="*\\aswArPot.sys" (Signed="false" OR SignatureStatus="Expired")))))) | eval sigma_attack_tags="attack.privilege_escalation attack.t1543.003" | eval sigma_title="Vulnerable AVAST Anti Rootkit Driver Load" | eval sigma_description="Detects the load of a signed and vulnerable AVAST Anti Rootkit driver often used by threat actors or malware for stopping and disabling AV and EDR products"
dispatch.earliest_time = -24h@h
alert.track = 0

[Vulnerable Dell BIOS Update Driver Load - sysmon]
description = Detects the load of the vulnerable Dell BIOS update driver as reported in CVE-2021-21551
search = index=sysmon* ((((EventCode="6" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (ImageLoaded="*\\DBUtil_2_3.Sys*" OR (Hashes="*SHA256=0296E2CE999E67C76352613A718E11516FE1B0EFC3FFDB8918FC999DD76A73A5*" OR Hashes="*SHA256=DDBF5ECCA5C8086AFDE1FB4F551E9E6400E94F4428FE7FB5559DA5CFFA654CC1*" OR Hashes="*SHA1=C948AE14761095E4D76B55D9DE86412258BE7AFD*" OR Hashes="*SHA1=10B30BDEE43B3A2EC4AA63375577ADE650269D25*" OR Hashes="*MD5=C996D7971C49252C582171D9380360F2*" OR Hashes="*MD5=D2FD132AB7BBC6BBB87A84F026FA0244*") OR (sha256="0296e2ce999e67c76352613a718e11516fe1b0efc3ffdb8918fc999dd76a73a5" OR sha256="ddbf5ecca5c8086afde1fb4f551e9e6400e94f4428fe7fb5559da5cffa654cc1") OR (sha1="c948ae14761095e4d76b55d9de86412258be7afd" OR sha1="10b30bdee43b3a2ec4aa63375577ade650269d25") OR (md5="c996d7971c49252c582171d9380360f2" OR md5="d2fd132ab7bbc6bbb87a84f026fa0244")))) | eval sigma_attack_tags="attack.privilege_escalation cve.2021.21551 attack.t1543 attack.t1068" | eval sigma_title="Vulnerable Dell BIOS Update Driver Load" | eval sigma_description="Detects the load of the vulnerable Dell BIOS update driver as reported in CVE-2021-21551"
dispatch.earliest_time = -24h@h
alert.track = 0

[Vulnerable Driver Load By Name - sysmon]
description = Detects the load of known vulnerable drivers via their names only.
search = index=sysmon* ((EventCode="6" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (ImageLoaded="*\\ADV64DRV.sys" OR ImageLoaded="*\\Agent64.sys" OR ImageLoaded="*\\ALSysIO64.sys" OR ImageLoaded="*\\amifldrv64.sys" OR ImageLoaded="*\\AsIO.sys" OR ImageLoaded="*\\AsIO64.sys" OR ImageLoaded="*\\asmmap64.sys" OR ImageLoaded="*\\AsrAutoChkUpdDrv.sys" OR ImageLoaded="*\\AsrDrv10.sys" OR ImageLoaded="*\\AsrDrv101.sys" OR ImageLoaded="*\\AsrIbDrv.sys" OR ImageLoaded="*\\AsrOmgDrv.sys" OR ImageLoaded="*\\AsrRapidStartDrv.sys" OR ImageLoaded="*\\AsrSmartConnectDrv.sys" OR ImageLoaded="*\\AsUpIO.sys" OR ImageLoaded="*\\atillk64.sys" OR ImageLoaded="*\\BS_Def64.sys" OR ImageLoaded="*\\CITMDRV_AMD64.sys" OR ImageLoaded="*\\CITMDRV_IA64.sys" OR ImageLoaded="*\\cpuz_x64.sys" OR ImageLoaded="*\\cpuz141.sys" OR ImageLoaded="*\\dbutil_2_3.sys" OR ImageLoaded="*\\Dh_Kernel_10.sys" OR ImageLoaded="*\\Dh_Kernel.sys" OR ImageLoaded="*\\gdrv.sys" OR ImageLoaded="*\\GLCKIO2.sys" OR ImageLoaded="*\\HOSTNT.sys" OR ImageLoaded="*\\HwRwDrv.sys" OR ImageLoaded="*\\inpoutx64.sys" OR ImageLoaded="*\\iomem64.sys" OR ImageLoaded="*\\Mhyprot2.sys" OR ImageLoaded="*\\MsIo64.sys" OR ImageLoaded="*\\msrhook.sys" OR ImageLoaded="*\\NTIOLib.sys" OR ImageLoaded="*\\OpenLibSys.sys" OR ImageLoaded="*\\Se64a.sys" OR ImageLoaded="*\\smep_capcom.sys" OR ImageLoaded="*\\smep_namco.sys" OR ImageLoaded="*\\SysInfo.sys" OR ImageLoaded="*\\VProEventMonitor.sys" OR ImageLoaded="*\\WCPU.sys" OR ImageLoaded="*\\WINIODrv.sys" OR ImageLoaded="*\\WinRing0.sys" OR ImageLoaded="*\\physmem.sys" OR ImageLoaded="*\\procexp152.sys" OR ImageLoaded="*\\viraglt64.sys" OR ImageLoaded="*\\vboxdrv.sys" OR ImageLoaded="*\\rwdrv.sys" OR ImageLoaded="*\\speedfan.sys" OR ImageLoaded="*\\kprocesshacker.sys" OR ImageLoaded="*\\sandra.sys" OR ImageLoaded="*\\elbycdio.sys" OR ImageLoaded="*\\goad.sys" OR ImageLoaded="*\\aswsnx.sys" OR ImageLoaded="*\\sandbox.sys" OR ImageLoaded="*\\nicm.sys" OR ImageLoaded="*\\nscm.sys" OR ImageLoaded="*\\ncpl.sys" OR ImageLoaded="*\\elrawdsk.sys" OR ImageLoaded="*\\DBUtilDrv2.sys" OR ImageLoaded="*\\BS_RCIO64.sys" OR ImageLoaded="*\\mhyprot.sys" OR ImageLoaded="*\\EneTechIo64.sys" OR ImageLoaded="*\\amp.sys" OR ImageLoaded="*\\EneIo64.sys" OR ImageLoaded="*\\ATSZIO.sys" OR ImageLoaded="*\\NalDrv.sys" OR ImageLoaded="*\\DirectIo32.sys" OR ImageLoaded="*\\DirectIo64.sys" OR ImageLoaded="*\\AsUpIO64.sys" OR ImageLoaded="*\\AsrDrv102.sys" OR ImageLoaded="*\\AsrDrv103.sys" OR ImageLoaded="*\\BSMEMx64.sys" OR ImageLoaded="*\\BSMIXP64.sys" OR ImageLoaded="*\\BSMIx64.sys" OR ImageLoaded="*\\BS_Flash64.sys" OR ImageLoaded="*\\BS_HWMIO64_W10.sys" OR ImageLoaded="*\\BS_HWMIo64.sys" OR ImageLoaded="*\\BS_I2c64.sys" OR ImageLoaded="*\\GVCIDrv64.sys" OR ImageLoaded="*\\HwOs2Ec10x64.sys" OR ImageLoaded="*\\HwOs2Ec7x64.sys" OR ImageLoaded="*\\NBIOLib_X64.sys" OR ImageLoaded="*\\NCHGBIOS2x64.SYS" OR ImageLoaded="*\\NTIOLib_X64.sys" OR ImageLoaded="*\\PhlashNT.sys" OR ImageLoaded="*\\Phymemx64.sys" OR ImageLoaded="*\\UCOREW64.SYS" OR ImageLoaded="*\\WinFlash64.sys" OR ImageLoaded="*\\WinRing0x64.sys" OR ImageLoaded="*\\dbk64.sys" OR ImageLoaded="*\\mtcBSv64.sys" OR ImageLoaded="*\\nvflash.sys" OR ImageLoaded="*\\nvflsh64.sys" OR ImageLoaded="*\\phymem64.sys" OR ImageLoaded="*\\rtkio64.sys" OR ImageLoaded="*\\rtkiow10x64.sys" OR ImageLoaded="*\\rtkiow8x64.sys" OR ImageLoaded="*\\segwindrvx64.sys" OR ImageLoaded="*\\superbmc.sys" OR ImageLoaded="*\\semav6msr.sys" OR ImageLoaded="*\\piddrv64.sys" OR ImageLoaded="*\\BS_I2cIo.sys" OR ImageLoaded="*\\rtkio.sys" OR ImageLoaded="*\\AMDRyzenMasterDriver.sys" OR ImageLoaded="*\\LHA.sys" OR ImageLoaded="*\\kEvP64.sys" OR ImageLoaded="*\\BSMI.sys" OR ImageLoaded="*\\TmComm.sys" OR ImageLoaded="*\\cpuz.sys" OR ImageLoaded="*\\iQVW64.SYS" OR ImageLoaded="*\\iQVW32.SYS" OR ImageLoaded="*\\vmdrv.sys" OR ImageLoaded="*\\HpPortIox64.sys" OR ImageLoaded="*\\AMDPowerProfiler.sys" OR ImageLoaded="*\\CorsairLLAccess64.sys" OR ImageLoaded="*\\RTCore64.sys" OR ImageLoaded="*\\libnicm.sys" OR ImageLoaded="*\\procexp.Sys" OR ImageLoaded="*\\viragt.sys" OR ImageLoaded="*\\viragt64.sys" OR ImageLoaded="*\\AsrDrv106.sys" OR ImageLoaded="*\\zamguard64.sys" OR ImageLoaded="*\\zam64.sys" OR ImageLoaded="*\\fidpcidrv64.sys" OR ImageLoaded="*\\MsIo32.sys" OR ImageLoaded="*\\winio64.sys" OR ImageLoaded="*\\capcom.sys" OR ImageLoaded="*\\IOMap64.sys" OR ImageLoaded="*\\ATSZIO64.sys" OR ImageLoaded="*\\aswVmm.sys" OR ImageLoaded="*\\FairplayKD.sys" OR ImageLoaded="*\\pgldqpoc.sys" OR ImageLoaded="*\\iqvw64e.sys" OR ImageLoaded="*\\Monitor_win10_x64.sys" OR ImageLoaded="*\\srvnetbus.sys" OR ImageLoaded="*\\Mslo64.sys" OR ImageLoaded="*\\pcdsrvc_x64.pkms" OR ImageLoaded="*\\krpocesshacker.sys" OR ImageLoaded="*\\HWiNFO64A.sys" OR ImageLoaded="*\\rzpnk.sys" OR ImageLoaded="*\\magdrvamd64.sys" OR ImageLoaded="*\\driver7-x64.sys" OR ImageLoaded="*\\driver7-x86-withoutdbg.sys" OR ImageLoaded="*\\driver7-x86.sys" OR ImageLoaded="*\\gmer.sys" OR ImageLoaded="*\\PCADRVX64.sys" OR ImageLoaded="*\\clfs.sys" OR ImageLoaded="*\\ActiveHealth.sys" OR ImageLoaded="*\\CAM_V3.sys" OR ImageLoaded="*\\GameFire.sys" OR ImageLoaded="*\\OpenHardwareMonitor.sys" OR ImageLoaded="*\\OpenHardwareMonitorLib.sys" OR ImageLoaded="*\\OpenHardwareMonitorReport.sys" OR ImageLoaded="*\\SmartDashboard.sys" OR ImageLoaded="*\\SystemGauge.sys" OR ImageLoaded="*\\SystemGaugeX7.sys" OR ImageLoaded="*\\VideoNovaServerControllerService.sys" OR ImageLoaded="*\\ellp_service.sys" OR ImageLoaded="*\\hardwareproviders.sys" OR ImageLoaded="*\\ohm.sys" OR ImageLoaded="*\\sensorsview32_64.sys" OR ImageLoaded="*\\touchpointanalyticsclient.sys" OR ImageLoaded="*\\CQg5Jf.sys" OR ImageLoaded="*\\HCdRDh.sys" OR ImageLoaded="*\\NcDgDn.sys" OR ImageLoaded="*\\vLTZ19.sys"))) | eval sigma_attack_tags="attack.privilege_escalation attack.t1543.003 attack.t1068" | eval sigma_title="Vulnerable Driver Load By Name" | eval sigma_description="Detects the load of known vulnerable drivers via their names only."
dispatch.earliest_time = -24h@h
alert.track = 0

[Vulnerable Driver Load - sysmon]
description = Detects the load of known vulnerable drivers by hash value
search = index=sysmon* ((((EventCode="6" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Hashes="*SHA1=2261198385d62d2117f50f631652eded0ecc71db*" OR Hashes="*SHA1=8db869c0674221a2d3280143cbb0807fac08e0cc*" OR Hashes="*SHA1=27d3ebea7655a72e6e8b95053753a25db944ec0f*" OR Hashes="*SHA1=33cdab3bbc8b3adce4067a1b042778607dce2acd*" OR Hashes="*SHA1=21e6c104fe9731c874fab5c9560c929b2857b918*" OR Hashes="*SHA1=d979353d04bf65cc92ad3412605bc81edbb75ec2*" OR Hashes="*SHA1=2f991435a6f58e25c103a657d24ed892b99690b8*" OR Hashes="*SHA1=f02af84393e9627ba808d4159841854a6601cf80*" OR Hashes="*SHA1=bb962c9a8dda93e94fef504c4159de881e4706fe*" OR Hashes="*SHA1=b97a8d506be2e7eaa4385f70c009b22adbd071ba*" OR Hashes="*SHA1=92f251358b3fe86fd5e7aa9b17330afa0d64a705*" OR Hashes="*SHA1=8b6aa5b2bff44766ef7afbe095966a71bc4183fa*" OR Hashes="*SHA1=af6e1f2cfb230907476e8b2d676129b6d6657124*" OR Hashes="*SHA1=fcde5275ee1913509927ce5f0f85e6681064c9d2*" OR Hashes="*SHA1=00a442a4305c62cefa8105c0b4c4a9a5f4d1e93b*" OR Hashes="*SHA1=6523b3fd87de39eb5db1332e4523ce99556077dc*" OR Hashes="*SHA1=72966ca845759d239d09da0de7eebe3abe86fee3*" OR Hashes="*SHA1=57511ef5ff8162a9d793071b5bf7ebe8371759de*" OR Hashes="*SHA1=2d503a2457a787014a1fdd48a2ece2e6cbe98ea7*" OR Hashes="*SHA1=400f833dcc2ef0a122dd0e0b1ec4ec929340d90e*" OR Hashes="*SHA1=89cd760e8cb19d29ee08c430fb17a5fd4455c741*" OR Hashes="*SHA1=1d0df45ee3fa758f0470e055915004e6eae54c95*" OR Hashes="*SHA1=d5fd9fe10405c4f90235e583526164cd0902ed86*" OR Hashes="*SHA1=c52cef5b9e1d4a78431b7af56a6fdb6aa1bcad65*" OR Hashes="*SHA1=609fa1efcf61e26d64a5ceb13b044175ab2b3a13*" OR Hashes="*SHA1=7d7c03e22049a725ace2a9812c72b53a66c2548b*" OR Hashes="*SHA1=f9519d033d75e1ab6b82b2e156eafe9607edbcfb*" OR Hashes="*SHA1=468e2e5505a3d924b14fedee4ddf240d09393776*" OR Hashes="*SHA1=2e3de9bff43d7712707ef8a0b10f7e4ad8427fd8*" OR Hashes="*SHA1=c9cbfdd0be7b35751a017ec59ff7237ffdc4df1f*" OR Hashes="*SHA1=078ae07dec258db4376d5a2a05b9b508d68c0123*" OR Hashes="*SHA1=623cd2abef6c92255f79cbbd3309cb59176771da*" OR Hashes="*SHA1=1f3a9265963b660392c4053329eb9436deeed339*" OR Hashes="*SHA1=4a235f0b84ff615e2879fa9e0ec0d745fcfdaa5c*" OR Hashes="*SHA1=ace6b9e34e3e2e73fe584f3bbdb4e4ec106e0a7d*" OR Hashes="*SHA1=4268f30b79ce125a81d0d588bef0d4e2ad409bbb*" OR Hashes="*SHA1=c834c4931b074665d56ccab437dfcc326649d612*" OR Hashes="*SHA1=8f5cd4a56e6e15935491aa40adb1ecad61eafe7c*" OR Hashes="*SHA1=51b60eaa228458dee605430aae1bc26f3fc62325*" OR Hashes="*SHA1=3270720a066492b046d7180ca6e60602c764cac7*" OR Hashes="*SHA1=2a6e6bd51c7062ad24c02a4d2c1b5e948908d131*" OR Hashes="*SHA1=19bd488fe54b011f387e8c5d202a70019a204adf*" OR Hashes="*SHA1=a6fe4f30ca7cb94d74bc6d42cdd09a136056952e*" OR Hashes="*SHA1=ea877092d57373cb466b44e7dbcad4ce9a547344*" OR Hashes="*SHA1=205c69f078a563f54f4c0da2d02a25e284370251*" OR Hashes="*SHA1=f9feb60b23ca69072ce42264cd821fe588a186a6*" OR Hashes="*SHA1=b25170e09c9fb7c0599bfba3cf617187f6a733ac*" OR Hashes="*SHA1=160c96b5e5db8c96b821895582b501e3c2d5d6e7*" OR Hashes="*SHA1=a2e0b3162cfa336cd4ab40a2acc95abe7dc53843*" OR Hashes="*SHA1=4e826430a1389032f3fe06e2cc292f643fb0c417*" OR Hashes="*SHA1=7ab4565ba24268f0adadb03a5506d4eb1dc7c181*" OR Hashes="*SHA1=dc7b022f8bd149efbcb2204a48dce75c72633526*" OR Hashes="*SHA1=0307d76750dd98d707c699aee3b626643afb6936*" OR Hashes="*SHA1=5711c88e9e64e45b8fc4b90ab6f2dd6437dc5a8a*" OR Hashes="*SHA1=6714380bc0b8ab09b9a0d2fa66d1b025b646b946*" OR Hashes="*SHA1=8626ab1da6bfbdf61bd327eb944b39fd9df33d1d*" OR Hashes="*SHA1=30a224b22592d952fbe2e6ad97eda4a8f2c734e0*" OR Hashes="*SHA1=c95db1e82619fb16f8eec9a8209b7b0e853a4ebe*" OR Hashes="*SHA1=fe1d909ab38de1389a2a48352fd1c8415fd2eab0*" OR Hashes="*SHA1=b4d1554ec19504215d27de0758e13c35ddd6db3e*" OR Hashes="*SHA1=5dd2c31c4357a8b76db095364952b3d0e3935e1d*" OR Hashes="*SHA1=ecb4d096a9c58643b02f328d2c7742a38e017cf0*" OR Hashes="*SHA1=4a705af959af61bad48ef7579f839cb5ebd654d2*" OR Hashes="*SHA1=d2e6fc9259420f0c9b6b1769be3b1f63eb36dc57*" OR Hashes="*SHA1=c948ae14761095e4d76b55d9de86412258be7afd*" OR Hashes="*SHA1=ddbe809b731a0962e404a045ab9e65a0b64917ad*" OR Hashes="*SHA1=745bad097052134548fe159f158c04be5616afc2*" OR Hashes="*SHA1=8d59fd14a445c8f3f0f7991fa6cd717d466b3754*" OR Hashes="*SHA1=2dfcb799b3c42ecb0472e27c19b24ac7532775ce*" OR Hashes="*SHA1=cc51be79ae56bc97211f6b73cc905c3492da8f9d*" OR Hashes="*SHA1=ac13941f436139b909d105ad55637e1308f49d9a*" OR Hashes="*SHA1=2b0bb408ff0e66bcdf6574f1ca52cbf4015b257b*" OR Hashes="*SHA1=cc0e0440adc058615e31e8a52372abadf658e6b1*" OR Hashes="*SHA1=5520ac25d81550a255dc16a0bb89d4b275f6f809*" OR Hashes="*SHA1=6afc6b04cf73dd461e4a4956365f25c1f1162387*" OR Hashes="*SHA1=4b009e91bae8d27b160dc195f10c095f8a2441e1*" OR Hashes="*SHA1=6003184788cd3d2fc624ca801df291ccc4e225ee*" OR Hashes="*SHA1=0466e90bf0e83b776ca8716e01d35a8a2e5f96d3*" OR Hashes="*SHA1=e6305dddd06490d7f87e3b06d09e9d4c1c643af0*" OR Hashes="*SHA1=89909fa481ff67d7449ee90d24c167b17b0612f1*" OR Hashes="*SHA1=d7e8aef8c8feb87ce722c0b9abf34a7e6bab6eb4*" OR Hashes="*SHA1=5e6ddd2b39a3de0016385cbd7aa50e49451e376d*" OR Hashes="*SHA1=976777d39d73034df6b113dfce1aa6e1d00ffcfd*" OR Hashes="*SHA1=9c6749fc6c1127f8788bff70e0ce9062959637c9*" OR Hashes="*SHA1=53acd4d9e7ba0b1056cf52af0d191f226eddf312*" OR Hashes="*SHA1=3abb9d0a9d600200ae19c706e570465ef0a15643*" OR Hashes="*SHA1=27eab595ec403580236e04101172247c4f5d5426*" OR Hashes="*SHA1=78b9481607ca6f3a80b4515c432ddfe6550b18a8*" OR Hashes="*SHA1=414cd15d6c991d19fb5be02e3b9fb0e6c5ce731c*" OR Hashes="*SHA1=d9c09dd725bc7bc3c19b4db37866015817a516ef*" OR Hashes="*SHA1=9c256edd10823ca76c0443a330e523027b70522d*" OR Hashes="*SHA1=35829e096a15e559fcbabf3441d99e580ca3b26e*" OR Hashes="*SHA1=b8de3a1aeeda9deea43e3f768071125851c85bd0*" OR Hashes="*SHA1=054a50293c7b4eea064c91ef59cf120d8100f237*" OR Hashes="*SHA1=d94f2fb3198e14bfe69b44fb9f00f2551f7248b2*" OR Hashes="*SHA1=01a578a3a39697c4de8e3dab04dba55a4c35163e*" OR Hashes="*SHA1=14bf0eaa90e012169745b3e30c281a327751e316*" OR Hashes="*SHA1=f50c6b84dfb8f2d53ba3bce000a55f0a486c0e79*" OR Hashes="*SHA1=6100eb82a25d64a7a7702e94c2b21333bc15bd08*" OR Hashes="*SHA1=bf87e32a651bdfd9b9244a8cf24fca0e459eb614*" OR Hashes="*SHA1=28b1c0b91eb6afd2d26b239c9f93beb053867a1a*" OR Hashes="*SHA1=879fcc6795cebe67718388228e715c470de87dca*" OR Hashes="*SHA1=1f7501e01d84a2297c85cb39880ec4e40ac3fe8a*" OR Hashes="*SHA1=152b6bb9ffd2ffec00cc46f5c6e29362d0e66e67*" OR Hashes="*SHA1=5f8356ffa8201f338dd2ea979eb47881a6db9f03*" OR Hashes="*SHA1=a7bd05de737f8ea57857f1e0845a25677df01872*" OR Hashes="*SHA1=cce9b82f01ec68f450f5fe4312f40d929c6a506e*" OR Hashes="*SHA1=e35a2b009d54e1a0b231d8a276251f64231b66a3*" OR Hashes="*SHA1=37364cb5f5cefd68e5eca56f95c0ab4aff43afcc*" OR Hashes="*SHA1=d62fa51e520022483bdc5847141658de689c0c29*" OR Hashes="*SHA1=93aa3bb934b74160446df3a47fa085fd7f3a6be9*" OR Hashes="*SHA1=ec4cc6de4c779bb1ca1dd32ee3a03f7e8d633a9b*" OR Hashes="*SHA1=35f1ba60ba0da8512a0b1b15ee8e30fe240d77cd*" OR Hashes="*SHA1=3805e4e08ad342d224973ecdade8b00c40ed31be*" OR Hashes="*SHA1=65d8a7c2e867b22d1c14592b020c548dd0665646*" OR Hashes="*SHA1=c8d87f3cd34c572870e63a696cf771580e6ea81b*" OR Hashes="*SHA1=c4d7fb9db3c3459f7e8c0e3d48c95c7c9c4cff60*" OR Hashes="*SHA1=d34a7c497c603f3f7fcad546dc4097c2da17c430*" OR Hashes="*SHA1=1fd7f881ea4a1dbb5c9aeb9e7ad659a85421745b*" OR Hashes="*SHA1=0b8b83f245d94107cb802a285e6529161d9a834d*" OR Hashes="*SHA1=c969f1f73922fd95db1992a5b552fbc488366a40*" OR Hashes="*SHA1=ac600a2bc06b312d92e649b7b55e3e91e9d63451*" OR Hashes="*SHA1=da9cea92f996f938f699902482ac5313d5e8b28e*" OR Hashes="*SHA1=33285b2e97a0aeb317166cce91f6733cf9c1ad53*" OR Hashes="*SHA1=21edff2937eb5cd6f6b0acb7ee5247681f624260*" OR Hashes="*SHA1=f052dc35b74a1a6246842fbb35eb481577537826*" OR Hashes="*SHA1=f0c463d29a5914b01e4607889094f1b7d95e7aaf*" OR Hashes="*SHA1=0c26ab1299adcd9a385b541ef1653728270aa23e*" OR Hashes="*SHA1=f36a47edfacd85e0c6d4d22133dd386aee4eec15*" OR Hashes="*SHA1=460008b1ffd31792a6deadfa6280fb2a30c8a5d2*" OR Hashes="*SHA1=738b7918d85e5cb4395df9e3f6fc94ddad90e939*" OR Hashes="*SHA1=43419df1f9a07430a18c5f3b3cc74de621be0f8e*" OR Hashes="*SHA1=558aad879b6a47d94a968f39d0a4e3a3aaef1ef1*" OR Hashes="*SHA1=7fb52290883a6b69a96d480f2867643396727e83*" OR Hashes="*SHA1=f5696fb352a3fbd14fb1a89ad21a71776027f9ab*" OR Hashes="*SHA1=693a2645c28fc3b248fda95179c36c3ac64f6fc2*" OR Hashes="*SHA1=05c0c49e8bcf11b883d41441ce87a2ee7a3aba1d*" OR Hashes="*SHA1=d25340ae8e92a6d29f599fef426a2bc1b5217299*" OR Hashes="*SHA1=7c1b25518dee1e30b5a6eaa1ea8e4a3780c24d0c*" OR Hashes="*SHA1=fe10018af723986db50701c8532df5ed98b17c39*" OR Hashes="*SHA1=bfe55cacc7c56c9f7bd75bdb4b352c0b745d071b*" OR Hashes="*SHA1=a21c84c6bf2e21d69fa06daaf19b4cc34b589347*" OR Hashes="*SHA1=82ba5513c33e056c3f54152c8555abf555f3e745*" OR Hashes="*SHA1=d098600152e5ee6a8238d414d2a77a34da8afaaa*" OR Hashes="*SHA1=64e4ac8b9ea2f050933b7ec76a55dd04e97773b4*" OR Hashes="*SHA1=bbc1e5fd826961d93b76abd161314cb3592c4436*" OR Hashes="*SHA1=90a76945fd2fa45fab2b7bcfdaf6563595f94891*" OR Hashes="*SHA1=b03b1996a40bfea72e4584b82f6b845c503a9748*" OR Hashes="*SHA1=c771ea59f075170e952c393cfd6fc784b265027c*" OR Hashes="*SHA1=cb44c6f0ee51cb4c5836499bc61dd6c1fbdf8aa1*" OR Hashes="*SHA1=0918277fcdc64a9dc51c04324377b3468fa1269b*" OR Hashes="*SHA1=b09bcc042d60d2f4c0d08284818ed198cededa04*" OR Hashes="*SHA1=8dc2097a90eb7e9d6ee31a7c7a95e7a0b2093b89*" OR Hashes="*SHA1=15df139494d2c40a645fb010908551185c27f3c5*" OR Hashes="*SHA1=012db3a80faf1f7f727b538cbe5d94064e7159de*" OR Hashes="*SHA1=d04e5db5b6c848a29732bfd52029001f23c3da75*" OR Hashes="*SHA1=490109fa6739f114651f4199196c5121d1c6bdf2*" OR Hashes="*SHA1=b4d014b5edd6e19ce0e8395a64faedf49688ecb5*" OR Hashes="*SHA1=a87d6eac2d70a3fbc04e59412326b28001c179de*" OR Hashes="*SHA1=3f223581409492172a1e875f130f3485b90fbe5f*" OR Hashes="*SHA1=5db61d00a001fd493591dc919f69b14713889fc5*" OR Hashes="*SHA1=9923c8f1e565a05b3c738d283cf5c0ed61a0b90f*" OR Hashes="*SHA1=15d1a6a904c8409fb47a82aefa42f8c3c7d8c370*" OR Hashes="*SHA1=9d07df024ec457168bf0be7e0009619f6ac4f13c*" OR Hashes="*SHA1=9a35ae9a1f95ce4be64adc604c80079173e4a676*" OR Hashes="*SHA1=c6bd965300f07012d1b651a9b8776028c45b149a*" OR Hashes="*SHA1=e83458c4a6383223759cd8024e60c17be4e7c85f*" OR Hashes="*SHA1=cb3de54667548a5c9abf5d8fa47db4097fcee9f1*" OR Hashes="*SHA1=9c24dd75e4074041dbe03bf21f050c77d748b8e9*" OR Hashes="*SHA1=dc55217b6043d819eadebd423ff07704ee103231*" OR Hashes="*SHA1=e92817a8744ebc4e4fa5383cdce2b2977f01ecd4*" OR Hashes="*SHA1=dc0e97adb756c0f30b41840a59b85218cbdd198f*" OR Hashes="*SHA1=26c4a7b392d7e7bd7f0a2a758534e45c0d9a56ab*" OR Hashes="*SHA1=d0d39e1061f30946141b6ecfa0957f8cc3ddeb63*" OR Hashes="*SHA1=c6d349823bbb1f5b44bae91357895dba653c5861*" OR Hashes="*SHA1=f42f28d164205d9f6dab9317c9fecad54c38d5d2*" OR Hashes="*SHA1=bbc0b9fd67c8f4cefa3d76fcb29ff3cef996b825*" OR Hashes="*SHA1=8183a341ba6c3ce1948bf9be49ab5320e0ee324d*" OR Hashes="*SHA1=eb1ecad3d37bb980f908bf1a912415cff32e79e6*" OR Hashes="*SHA1=eb0d45aa6f537f5b2f90f3ad99013606eafcd162*" OR Hashes="*SHA1=6053d258096bccb07cb0057d700fe05233ab1fbb*" OR Hashes="*SHA1=29a190727140f40cea9514a6420f5a195e36386b*" OR Hashes="*SHA1=a4b2c56c12799855162ca3b004b4b2078c6ecf77*" OR Hashes="*SHA1=7667b72471689151e176baeba4e1cd9cd006a09a*" OR Hashes="*SHA1=d7f7594ff084201c0d9fa2f4ef1626635b67bce5*" OR Hashes="*SHA1=99201c9555e5faf6e8d82da793b148311f8aa4b8*" OR Hashes="*SHA1=947db58d6f36a8df9fa2a1057f3a7f653ccbc42e*" OR Hashes="*SHA1=6a3d3b9ab3d201cd6b0316a7f9c3fb4d34d0f403*" OR Hashes="*SHA1=d702d88b12233be9413446c445f22fda4a92a1d9*" OR Hashes="*SHA1=910cb12aa49e9f35ecc4907e8304adf0dcca8cf1*" OR Hashes="*SHA1=643383938d5e0d4fd30d302af3e9293a4798e392*" OR Hashes="*SHA1=c4ed28fdfba7b8a8dfe39e591006f25d39990f07*" OR Hashes="*SHA1=b0032b8d8e6f4bd19a31619ce38d8e010f29a816*" OR Hashes="*SHA1=db6245578ec57bd767b27ecf8085095e1c8e5a6e*" OR Hashes="*SHA1=166759fd511613414d3213942fe2575b926a6226*" OR Hashes="*SHA1=02a8b74899591da7b7f49c0450328d39b939d7e4*" OR Hashes="*SHA1=98ceed786f79288becc08c3b82c57e8d4bfa1bca*" OR Hashes="*SHA1=f6b3577ea4b1a5641ae3421151a26268434c3db8*" OR Hashes="*SHA1=4de33d03fee52f396a1c788000ca868d56ac30de*" OR Hashes="*SHA1=c6920171fa6dff2c17eb83befb5fd28e8dddf5f0*" OR Hashes="*SHA1=fbc6d2448739ddec35bb5d6c94b46df4148f648d*" OR Hashes="*SHA1=6b54f8f137778c1391285fee6150dfa58a8120b1*" OR Hashes="*SHA1=943593e880b4d340f2548548e6e673ef6f61eed3*" OR Hashes="*SHA1=5ac4d0e2381fc4a8aebe94a0fb6fe5e7558e4dcd*" OR Hashes="*SHA1=e44297a2b750ec1958bef265e2f1ae6fa4323b28*" OR Hashes="*SHA1=aa2ea973bb248b18973e57339307cfb8d309f687*" OR Hashes="*SHA1=3a5d176c50f97b71d139767ed795d178623f491d*" OR Hashes="*SHA1=25d812a5ece19ea375178ef9d60415841087726e*" OR Hashes="*SHA1=3795e32592ab6d8074b6f7ad33759c6a39b0df07*" OR Hashes="*SHA1=fc121ed6fb37e97a004b6faf217435b772dfc4c0*" OR Hashes="*SHA1=ab2b8602e4baef828b58b995d0889a8e5b8dbd02*" OR Hashes="*SHA1=cf040040628b58f4a811f98c2690913c1e8e4e3c*" OR Hashes="*SHA1=3296844d22c87dd5eba3aa378a8242b41d59db7a*" OR Hashes="*SHA1=bc47e15537fa7c32dfefd23168d7e1741f8477ed*" OR Hashes="*SHA1=cb22723faa5ae2809476e5c5e9b9a597b26cab9b*" OR Hashes="*SHA1=f3c5e723ae009b336cd2719137b8cd194c9ee51d*" OR Hashes="*SHA1=41f2d0f9863bce8920c207b1ef5d3d32b603edef*" OR Hashes="*SHA1=eb93d2f564fea9b3dc350f386b45de2cd9a3e001*" OR Hashes="*SHA1=3cd037fbba8aae82c1b111c9f8755349c98bcb3c*" OR Hashes="*SHA1=9401389fba314d1810f83edce33c37e84a78e112*" OR Hashes="*SHA1=7eb34cc1fcffb4fdb5cb7e97184dd64a65cb9371*" OR Hashes="*SHA1=16d7ecf09fc98798a6170e4cef2745e0bee3f5c7*" OR Hashes="*SHA1=fcd615df88645d1f57ff5702bd6758b77efea6d0*" OR Hashes="*SHA1=f3db629cfe37a73144d5258e64d9dd8b38084cf4*" OR Hashes="*SHA1=a00e444120449e35641d58e62ed64bb9c9f518d2*" OR Hashes="*SHA1=38571f14fc014487194d1eecfa80561ee8644e09*" OR Hashes="*SHA1=4d41248078181c7f61e6e4906aa96bbdea320dc2*" OR Hashes="*SHA1=3599ea2ac1fa78f423423a4cf90106ea0938dde8*" OR Hashes="*SHA1=3d6d53b0f1cc908b898610227b9f1b9352137aba*" OR Hashes="*SHA1=4c18754dca481f107f0923fb8ef5e149d128525d*" OR Hashes="*SHA1=8c377ab4eebc5f4d8dd7bb3f90c0187dfdd3349f*" OR Hashes="*SHA1=cde32654a041fedc7b0fa1083f6005b950760062*" OR Hashes="*SHA1=5fb9421be8a8b08ec395d05e00fd45eb753b593a*" OR Hashes="*SHA1=b480c54391a2a2f917a44f91a5e9e4590648b332*" OR Hashes="*SHA1=4f7a8e26a97980544be634b26899afbefb0a833c*" OR Hashes="*SHA1=c1d5cf8c43e7679b782630e93f5e6420ca1749a7*" OR Hashes="*SHA1=a7e9a4686aa7291331e2c8708882c8d81d05264f*" OR Hashes="*SHA1=7ba19a701c8af76988006d616a5f77484c13cb0a*" OR Hashes="*SHA1=4243dbbf6e5719d723f24d0f862afd0fcb40bc35*" OR Hashes="*SHA1=00b4e8b7644d1bf93f5ddb5740b444b445e81b02*" OR Hashes="*SHA1=fd833f3fe2fa396878033b9e6054725248bf9881*" OR Hashes="*SHA1=db446af0e34259e95f4db112a9f06177e1eef4e0*" OR Hashes="*SHA1=39d7b121bc654a0de891225e0f8b7b5537c24931*" OR Hashes="*SHA1=d0a228ed8af190dec0c1a812e212f5e68ee3b43e*" OR Hashes="*SHA1=7d2fc1a6729521e5c76f659e4c398e2061f7ed5e*" OR Hashes="*SHA1=f999709e5b00a68a0f4fa912619fe6548ad0c42d*" OR Hashes="*SHA1=06232f7ea7ea24102d452427aedbbc8b8e188a0c*" OR Hashes="*SHA1=a380aeb3ffaecc53ca48bb1d4d622c46f1de7962*" OR Hashes="*SHA1=4927d843577bada119a17b249ff4e7f5e9983a92*" OR Hashes="*SHA1=e5114fd50904c7fb75d8c86367b9a2dd4f79dfb1*" OR Hashes="*SHA1=3ccf1f3ac636a5e21b39ede48ff49fa23e05413f*" OR Hashes="*SHA1=755349d56cdd668ca22eebc4fc89f0cccef47327*" OR Hashes="*SHA1=56af49e030eb85528e82849d7d1b6147f3c4973e*" OR Hashes="*SHA1=45a9f95a7a018925148152b888d09d478d56bbf5*" OR Hashes="*SHA1=540b9f9a232b9d597138b8e0f33d83f5f6e247af*" OR Hashes="*SHA1=bdfb25cc4ed569dc0d5849545eb4abe08539029f*" OR Hashes="*SHA1=28da2ac7c82b999c53f99d55331cfa3624a0bc6f*" OR Hashes="*SHA1=5d5f92fba0f39826b527f335a7cca7d363758410*" OR Hashes="*SHA1=1858ab7ad1947f5c24b9c913cd975e6dbb536865*" OR Hashes="*SHA1=0f2aa3bfdfd699e258382ea1b3c1db1ad7211023*" OR Hashes="*SHA1=886a9c16b871da42cdb54c6738a8e088be8b989f*" OR Hashes="*SHA1=c24883645c0589f6171e8ee10080750ac66d75e6*" OR Hashes="*SHA1=36d3b09e19477d807a6a5efff89aa6cc8b71bdeb*" OR Hashes="*SHA1=e58dd758e28218e1edb33cd88bb97504972ee221*" OR Hashes="*SHA1=d782ef79266179d2247807857877fabb2e402be5*" OR Hashes="*SHA256=05F052C64D192CF69A462A5EC16DDA0D43CA5D0245900C9FCB9201685A2E7748*" OR Hashes="*SHA256=4045AE77859B1DBF13972451972EAAF6F3C97BEA423E9E78F1C2F14330CD47CA*" OR Hashes="*SHA256=6948480954137987A0BE626C24CF594390960242CD75F094CD6AAA5C2E7A54FA*" OR Hashes="*SHA256=8CB62C5D41148DE416014F80BD1FD033FD4D2BD504CB05B90EEB6992A382D58F*" OR Hashes="*SHA256=B1D96233235A62DBB21B8DBE2D1AE333199669F67664B107BFF1AD49B41D9414*" OR Hashes="*SHA256=7196187FB1EF8D108B380D37B2AF8EFDEB3CA1F6EEFD37B5DC114C609147216D*" OR Hashes="*SHA256=7F375639A0DF7FE51E5518CF87C3F513C55BC117DB47D28DA8C615642EB18BFA*" OR Hashes="*SHA256=42579A759F3F95F20A2C51D5AC2047A2662A2675B3FB9F46C1ED7F23393A0F00*" OR Hashes="*SHA256=2DA330A2088409EFC351118445A824F11EDBE51CF3D653B298053785097FE40E*" OR Hashes="*SHA256=436CCAB6F62FA2D29827916E054ADE7ACAE485B3DE1D3E5C6C62D3DEBF1480E7*" OR Hashes="*SHA256=B4D47EA790920A4531E3DF5A4B4B0721B7FEA6B49A35679F0652F1E590422602*" OR Hashes="*SHA256=DDE6F28B3F7F2ABBEE59D4864435108791631E9CB4CDFB1F178E5AA9859956D8*" OR Hashes="*SHA256=B48A309EE0960DA3CAAAAF1E794E8C409993AEB3A2B64809F36B97AAC8A1E62A*" OR Hashes="*SHA256=025E7BE9FCEFD6A83F4471BBA0C11F1C11BD5047047D26626DA24EE9A419CDC4*" OR Hashes="*SHA256=2AA1B08F47FBB1E2BD2E4A492F5D616968E703E1359A921F62B38B8E4662F0C4*" OR Hashes="*SHA256=ECE0A900EA089E730741499614C0917432246CEB5E11599EE3A1BB679E24FD2C*" OR Hashes="*SHA256=F40435488389B4FB3B945CA21A8325A51E1B5F80F045AB019748D0EC66056A8B*" OR Hashes="*SHA256=2A652DE6B680D5AD92376AD323021850DAB2C653ABF06EDF26120F7714B8E08A*" OR Hashes="*SHA256=950A4C0C772021CEE26011A92194F0E58D61588F77F2873AA0599DFF52A160C9*" OR Hashes="*SHA256=0AAFA9F47ACF69D46C9542985994FF5321F00842A28DF2396D4A3076776A83CB*" OR Hashes="*SHA256=47F08F7D30D824A8F4BB8A98916401A37C0FD8502DB308ABA91FE3112B892DCC*" OR Hashes="*SHA256=B9A4E40A5D80FEDD1037EAED958F9F9EFED41EB01ADA73D51B5DCD86E27E0CBF*" OR Hashes="*SHA256=5C04C274A708C9A7D993E33BE3EA9E6119DC29527A767410DBAF93996F87369A*" OR Hashes="*SHA256=0040153302B88BEE27EB4F1ECA6855039E1A057370F5E8C615724FA5215BADA3*" OR Hashes="*SHA256=3326E2D32BBABD69FEB6024809AFC56C7E39241EBE70A53728C77E80995422A5*" OR Hashes="*SHA256=36B9E31240AB0341873C7092B63E2E0F2CAB2962EBF9B25271C3A1216B7669EB*" OR Hashes="*SHA256=29E0062A017A93B2F2F5207A608A96DF4D554C5DE976BD0276C2590A03BD3E94*" OR Hashes="*SHA256=45ABDBCD4C0916B7D9FAAF1CD08543A3A5178871074628E0126A6EDA890D26E0*" OR Hashes="*SHA256=50DB5480D0392A7DD6AB5DF98389DC24D1ED1E9C98C9C35964B19DABCD6DC67F*" OR Hashes="*SHA256=607DC4C75AC7AEF82AE0616A453866B3B358C6CF5C8F9D29E4D37F844306B97C*" OR Hashes="*SHA256=61D6E40601FA368800980801A662A5B3B36E3C23296E8AE1C85726A56EF18CC8*" OR Hashes="*SHA256=74A846C61ADC53692D3040AFF4C1916F32987AD72B07FE226E9E7DBEFF1036C4*" OR Hashes="*SHA256=76FB4DEAEE57EF30E56C382C92ABFFE2CF616D08DBECB3368C8EE6B02E59F303*" OR Hashes="*SHA256=81939E5C12BD627FF268E9887D6FB57E95E6049F28921F3437898757E7F21469*" OR Hashes="*SHA256=9790A7B9D624B2B18768BB655DDA4A05A9929633CEF0B1521E79E40D7DE0A05B*" OR Hashes="*SHA256=9A1D66036B0868BBB1B2823209FEDEA61A301D5DD245F8E7D390BD31E52D663E*" OR Hashes="*SHA256=AA9AB1195DC866270E984F1BED5E1358D6EF24C515DFDB6C2A92D1E1B94BF608*" OR Hashes="*SHA256=AF095DE15A16255CA1B2C27DAD365DFF9AC32D2A75E8E288F5A1307680781685*" OR Hashes="*SHA256=D5586DC1E61796A9AE5E5D1CED397874753056C3DF2EB963A8916287E1929A71*" OR Hashes="*SHA256=D8459F7D707C635E2C04D6D6D47B63F73BA3F6629702C7A6E0DF0462F6478AE2*" OR Hashes="*SHA256=E81230217988F3E7EC6F89A06D231EC66039BDBA340FD8EBB2BBB586506E3293*" OR Hashes="*SHA256=F88EBB633406A086D9CCA6BC8B66A4EA940C5476529F9033A9E0463512A23A57*" OR Hashes="*SHA256=1C8DFA14888BB58848B4792FB1D8A921976A9463BE8334CFF45CC96F1276049A*" OR Hashes="*SHA256=22418016E980E0A4A2D01CA210A17059916A4208352C1018B0079CCB19AAF86A*" OR Hashes="*SHA256=405472A8F9400A54BB29D03B436CCD58CFD6442FE686F6D2ED4F63F002854659*" OR Hashes="*SHA256=49F75746EEBE14E5DB11706B3E58ACCC62D4034D2F1C05C681ECEF5D1AD933BA*" OR Hashes="*SHA256=4A3D4DB86F580B1680D6454BAEE1C1A139E2DDE7D55E972BA7C92EC3F555DCE2*" OR Hashes="*SHA256=4AB41816ABBF14D59E75B7FAD49E2CB1C1FEB27A3CB27402297A2A4793FF9DA7*" OR Hashes="*SHA256=54841D9F89E195196E65AA881834804FE3678F1CF6B328CAB8703EDD15E3EC57*" OR Hashes="*SHA256=5EE292B605CD3751A24E5949AAE615D472A3C72688632C3040DC311055B75A92*" OR Hashes="*SHA256=76B86543CE05540048F954FED37BDDA66360C4A3DDB8328213D5AEF7A960C184*" OR Hashes="*SHA256=7F190F6E5AB0EDAFD63391506C2360230AF4C2D56C45FC8996A168A1FC12D457*" OR Hashes="*SHA256=845F1E228DE249FC1DDF8DC28C39D03E8AD328A6277B6502D3932E83B879A65A*" OR Hashes="*SHA256=84BF1D0BCDF175CFE8AEA2973E0373015793D43907410AE97E2071B2C4B8E2D4*" OR Hashes="*SHA256=8EF0AD86500094E8FA3D9E7D53163AA6FEEF67C09575C169873C494ED66F057F*" OR Hashes="*SHA256=A56C2A2425EB3A4260CC7FC5C8D7BED7A3B4CD2AF256185F24471C668853AEE8*" OR Hashes="*SHA256=AC3F613D457FC4D44FA27B2E0B1BAA62C09415705EFB5A40A4756DA39B3AC165*" OR Hashes="*SHA256=B1334A71CC73B3D0C54F62D8011BEC330DFC355A239BF94A121F6E4C86A30A2E*" OR Hashes="*SHA256=B47BE212352D407D0EF7458A7161C66B47C2AEC8391DD101DF11E65728337A6A*" OR Hashes="*SHA256=B9B3878DDC5DFB237D38F8D25067267870AFD67D12A330397A8853209C4D889C*" OR Hashes="*SHA256=DB90E554AD249C2BD888282ECF7D8DA4D1538DD364129A3327B54F8242DD5653*" OR Hashes="*SHA256=E61A54F6D3869B43C4ECEAC3016DF73DF67CCE03878C5A6167166601C5D3F028*" OR Hashes="*SHA256=3871E16758A1778907667F78589359734F7F62F9DC953EC558946DCDBE6951E3*" OR Hashes="*SHA256=DED2927F9A4E64EEFD09D0CABA78E94F309E3A6292841AE81D5528CAB109F95D*" OR Hashes="*SHA256=0296E2CE999E67C76352613A718E11516FE1B0EFC3FFDB8918FC999DD76A73A5*" OR Hashes="*SHA256=80CBBA9F404DF3E642F22C476664D63D7C229D45D34F5CD0E19C65EB41BECEC3*" OR Hashes="*SHA256=BB50818A07B0EB1BD317467139B7EB4BAD6CD89053FECDABFEAE111689825955*" OR Hashes="*SHA256=FF6729518A380BF57F1BC6F1EC0AA7F3012E1618B8D9B0F31A61D299EE2B4339*" OR Hashes="*SHA256=3A5EC83FE670E5E23AEF3AFA0A7241053F5B6BE5E6CA01766D6B5F9177183C25*" OR Hashes="*SHA256=61A1BDDDD3C512E681818DEBB5BEE94DB701768FC25E674FCAD46592A3259BD0*" OR Hashes="*SHA256=07B6D69BAFCFD767F1B63A490A8843C3BB1F8E1BBEA56176109B5743C8F7D357*" OR Hashes="*SHA256=21CCDD306B5183C00ECFD0475B3152E7D94B921E858E59B68A03E925D1715F21*" OR Hashes="*SHA256=2D83CCB1AD9839C9F5B3F10B1F856177DF1594C66CBBC7661677D4B462EBF44D*" OR Hashes="*SHA256=F581DECC2888EF27EE1EA85EA23BBB5FB2FE6A554266FF5A1476ACD1D29D53AF*" OR Hashes="*SHA256=F8965FDCE668692C3785AFA3559159F9A18287BC0D53ABB21902895A8ECF221B*" OR Hashes="*SHA256=3D23BDBAF9905259D858DF5BF991EB23D2DC9F4ECDA7F9F77839691ACEF1B8C4*" OR Hashes="*SHA256=DD4A1253D47DE14EF83F1BC8B40816A86CCF90D1E624C5ADF9203AE9D51D4097*" OR Hashes="*SHA256=509628B6D16D2428031311D7BD2ADD8D5F5160E9ECC0CD909F1E82BBBB3234D6*" OR Hashes="*SHA256=525D9B51A80CA0CD4C5889A96F857E73F3A80DA1FFBAE59851E0F51BDFB0B6CD*" OR Hashes="*SHA256=6DE84CAA2CA18673E01B91AF58220C60AECD5CCCF269725EC3C7F226B2167492*" OR Hashes="*SHA256=09BEDBF7A41E0F8DABE4F41D331DB58373CE15B2E9204540873A1884F38BDDE1*" OR Hashes="*SHA256=101402D4F5D1AE413DED499C78A5FCBBC7E3BAE9B000D64C1DD64E3C48C37558*" OR Hashes="*SHA256=131D5490CEB9A5B2324D8E927FEA5BECFC633015661DE2F4C2F2375A3A3B64C6*" OR Hashes="*SHA256=1DDFE4756F5DB9FB319D6C6DA9C41C588A729D9E7817190B027B38E9C076D219*" OR Hashes="*SHA256=1E8B0C1966E566A523D652E00F7727D8B0663F1DFDCE3B9A09B9ADFAEF48D8EE*" OR Hashes="*SHA256=2BBE65CBEC3BB069E92233924F7EE1F95FFA16173FCEB932C34F68D862781250*" OR Hashes="*SHA256=30706F110725199E338E9CC1C940D9A644D19A14F0EB8847712CBA4CACDA67AB*" OR Hashes="*SHA256=3124B0411B8077605DB2A9B7909D8240E0D554496600E2706E531C93C931E1B5*" OR Hashes="*SHA256=38FA0C663C8689048726666F1C5E019FEAA9DA8278F1DF6FF62DA33961891D2A*" OR Hashes="*SHA256=39CFDE7D401EFCE4F550E0A9461F5FC4D71FA07235E1336E4F0B4882BD76550E*" OR Hashes="*SHA256=3D9E83B189FCF5C3541C62D1F54A0DA0A4E5B62C3243D2989AFC46644056C8E3*" OR Hashes="*SHA256=3F2FDA9A7A9C57B7138687BBCE49A2E156D6095DDDABB3454EA09737E02C3FA5*" OR Hashes="*SHA256=47F0CDAA2359A63AD1389EF4A635F1F6EEE1F63BDF6EF177F114BDCDADC2E005*" OR Hashes="*SHA256=50D5EAA168C077CE5B7F15B3F2C43BD2B86B07B1E926C1B332F8CB13BD2E0793*" OR Hashes="*SHA256=56A3C9AC137D862A85B4004F043D46542A1B61C6ACB438098A9640469E2D80E7*" OR Hashes="*SHA256=591BD5E92DFA0117B3DAA29750E73E2DB25BAA717C31217539D30FFB1F7F3A52*" OR Hashes="*SHA256=5D530E111400785D183057113D70623E17AF32931668AB7C7FC826F0FD4F91A3*" OR Hashes="*SHA256=6F1FF29E2E710F6D064DC74E8E011331D807C32CC2A622CBE507FD4B4D43F8F4*" OR Hashes="*SHA256=79E2D37632C417138970B4FEBA91B7E10C2EA251C5EFE3D1FC6FA0190F176B57*" OR Hashes="*SHA256=85866E8C25D82C1EC91D7A8076C7D073CCCF421CF57D9C83D80D63943A4EDD94*" OR Hashes="*SHA256=89B0017BC30CC026E32B758C66A1AF88BD54C6A78E11EC2908FF854E00AC46BE*" OR Hashes="*SHA256=9254F012009D55F555418FF85F7D93B184AB7CB0E37AECDFDAB62CFE94DEA96B*" OR Hashes="*SHA256=984A77E5424C6D099051441005F2938AE92B31B5AD8F6521C6B001932862ADD7*" OR Hashes="*SHA256=98B734DDA78C16EBCAA4AFEB31007926542B63B2F163B2F733FA0D00DBB344D8*" OR Hashes="*SHA256=99F4994A0E5BD1BF6E3F637D3225C69FF4CD620557E23637533E7F18D7D6CBA1*" OR Hashes="*SHA256=9C10E2EC4F9EF591415F9A784B93DC9C9CDAFA7C69602C0DC860C5B62222E449*" OR Hashes="*SHA256=A961F5939088238D76757669A9A81905E33F247C9C635B908DAAC146AE063499*" OR Hashes="*SHA256=A9706E320179993DADE519A83061477ACE195DAA1B788662825484813001F526*" OR Hashes="*SHA256=B7A20B5F15E1871B392782C46EBCC897929443D82073EE4DCB3874B6A5976B5D*" OR Hashes="*SHA256=CC586254E9E89E88334ADEE44E332166119307E79C2F18F6C2AB90CE8BA7FC9B*" OR Hashes="*SHA256=CD4A249C3EF65AF285D0F8F30A8A96E83688486AAB515836318A2559757A89BB*" OR Hashes="*SHA256=CF4B5FA853CE809F1924DF3A3AE3C4E191878C4EA5248D8785DC7E51807A512B*" OR Hashes="*SHA256=D0BD1AE72AEB5F3EABF1531A635F990E5EAAE7FDD560342F915F723766C80889*" OR Hashes="*SHA256=D8B58F6A89A7618558E37AFC360CD772B6731E3BA367F8D58734ECEE2244A530*" OR Hashes="*SHA256=D92EAB70BCECE4432258C9C9A914483A2267F6AB5CE2630048D3A99E8CB1B482*" OR Hashes="*SHA256=E005E8D183E853A27AD3BB56F25489F369C11B0D47E3D4095AAD9291B3343BF1*" OR Hashes="*SHA256=E68D453D333854787F8470C8BAEF3E0D082F26DF5AA19C0493898BCF3401E39A*" OR Hashes="*SHA256=E83908EBA2501A00EF9E74E7D1C8B4FF1279F1CD6051707FD51824F87E4378FA*" OR Hashes="*SHA256=EF86C4E5EE1DBC4F81CD864E8CD2F4A2A85EE4475B9A9AB698A4AE1CC71FBEB0*" OR Hashes="*SHA256=F088B2BA27DACD5C28F8EE428F1350DCA4BC7C6606309C287C801B2E1DA1A53D*" OR Hashes="*SHA256=FD8669794C67B396C12FC5F08E9C004FDF851A82FAF302846878173E4FBECB03*" OR Hashes="*SHA256=91314768DA140999E682D2A290D48B78BB25A35525EA12C1B1F9634D14602B2C*" OR Hashes="*SHA256=F0605DDA1DEF240DC7E14EFA73927D6C6D89988C01EA8647B671667B2B167008*" OR Hashes="*SHA256=6CB51AE871FBD5D07C5AAD6FF8EEA43D34063089528603CA9CEB8B4F52F68DDC*" OR Hashes="*SHA256=DB2A9247177E8CDD50FE9433D066B86FFD2A84301AA6B2EB60F361CFFF077004*" OR Hashes="*SHA256=7EC93F34EB323823EB199FBF8D06219086D517D0E8F4B9E348D7AFD41EC9FD5D*" OR Hashes="*SHA256=7049F3C939EFE76A5556C2A2C04386DB51DAF61D56B679F4868BB0983C996EBB*" OR Hashes="*SHA256=7877C1B0E7429453B750218CA491C2825DAE684AD9616642EFF7B41715C70ACA*" OR Hashes="*SHA256=159E7C5A12157AF92E0D14A0D3EA116F91C09E21A9831486E6DC592C93C10980*" OR Hashes="*SHA256=3243AAB18E273A9B9C4280A57AECEF278E10BFFF19ABB260D7A7820E41739099*" OR Hashes="*SHA256=7CFA5E10DFF8A99A5D544B011F676BC383991274C693E21E3AF40CF6982ADB8C*" OR Hashes="*SHA256=C9B49B52B493B53CD49C12C3FA9553E57C5394555B64E32D1208F5B96A5B8C6E*" OR Hashes="*SHA256=3EC5AD51E6879464DFBCCB9F4ED76C6325056A42548D5994BA869DA9C4C039A8*" OR Hashes="*SHA256=47EAEBC920CCF99E09FC9924FEB6B19B8A28589F52783327067C9B09754B5E84*" OR Hashes="*SHA256=1aaf4c1e3cb6774857e2eef27c17e68dc1ae577112e4769665f516c2e8c4e27b*" OR Hashes="*SHA256=e6056443537d4d2314dabca1b9168f1eaaf17a14eb41f6f5741b6b82b3119790*" OR Hashes="*SHA256=76660e91f1ff3cb89630df5af4fe09de6098d09baa66b1a130c89c3c5edd5b22*" OR Hashes="*SHA256=6c7120e40fc850e4715058b233f5ad4527d1084a909114fd6a36b7b7573c4a44*" OR Hashes="*SHA256=2e6b339597a89e875f175023ed952aaac64e9d20d457bbc07acf1586e7fe2df8*" OR Hashes="*SHA256=71fe5af0f1564dc187eea8d59c0fbc897712afa07d18316d2080330ba17cf009*" OR Hashes="*SHA256=39937d239220c1b779d7d55613de2c0a48bd6e12e0214da4c65992b96cf591df*" OR Hashes="*SHA256=7ed26a593524a2a92ffcfb075a42bb4fa4775ffbf83af98525244a4710886ead*" OR Hashes="*SHA256=aa717e9ab4d614497df19f602d289a6eddcdba8027c71bcc807780a219347d16*" OR Hashes="*SHA256=ff5f6048a3d6f6738b60e911e3876fcbdc9a02ec9862f909345c8a50fd4cc0a7*" OR Hashes="*SHA256=11bd2c9f9e2397c9a16e0990e4ed2cf0679498fe0fd418a3dfdac60b5c160ee5*" OR Hashes="*SHA256=58a74dceb2022cd8a358b92acd1b48a5e01c524c3b0195d7033e4bd55eff4495*" OR Hashes="*SHA256=01aa278b07b58dc46c84bd0b1b5c8e9ee4e62ea0bf7a695862444af32e87f1fd*" OR Hashes="*SHA256=22be050955347661685a4343c51f11c7811674e030386d2264cd12ecbf544b7c*" OR Hashes="*SHA256=31f4cfb4c71da44120752721103a16512444c13c2ac2d857a7e6f13cb679b427*" OR Hashes="*SHA256=952199C28332BC90CFD74530A77EE237967ED32B3C71322559C59F7A42187DC4*" OR Hashes="*SHA256=9529EFB1837B1005E5E8F477773752078E0A46500C748BC30C9B5084D04082E6*" OR Hashes="*SHA256=A7B000ABBCC344444A9B00CFADE7AA22AB92CE0CADEC196C30EB1851AE4FA062*" OR Hashes="*SHA256=4429f32db1cc70567919d7d47b844a91cf1329a6cd116f582305f3b7b60cd60b*" OR Hashes="*SHA256=01e024cb14b34b6d525c642a710bfa14497ea20fd287c39ba404b10a8b143ece*" OR Hashes="*SHA256=9fc29480407e5179aa8ea41682409b4ea33f1a42026277613d6484e5419de374*" OR Hashes="*SHA256=06bda5a1594f7121acd2efe38ccb617fbc078bb9a70b665a5f5efd70e3013f50*" OR Hashes="*SHA256=cbb8239a765bf5b2c1b6a5c8832d2cab8fef5deacadfb65d8ed43ef56d291ab6*" OR Hashes="*SHA256=d205286bffdf09bc033c09e95c519c1c267b40c2ee8bab703c6a2d86741ccd3e*" OR Hashes="*SHA256=a7c2e7910942dd5e43e2f4eb159bcd2b4e71366e34a68109548b9fb12ac0f7cc*" OR Hashes="*SHA256=2003b478b9fd1b3d76ec5bf4172c2e8915babbbee7ad1783794acbf8d4c2519d*" OR Hashes="*SHA256=f929bead59e9424ab90427b379dcdd63fbfe0c4fb5e1792e3a1685541cd5ec65*" OR Hashes="*SHA256=59626cac380d8fe0b80a6d4c4406d62ba0683a2f0f68d50ad506ca1b1cf25347*" OR Hashes="*SHA256=552f70374715e70c4ade591d65177be2539ec60f751223680dfaccb9e0be0ed9*" OR Hashes="*SHA256=86a8e0aa29a5b52c84921188cc1f0eca9a7904dcfe09544602933d8377720219*" OR Hashes="*SHA256=1d0397c263d51e9fc95bcc8baf98d1a853e1c0401cd0e27c7bf5da3fba1c93a8*" OR Hashes="*SHA256=60c6f4f34c7319cb3f9ca682e59d92711a05a2688badbae4891b1303cd384813*" OR Hashes="*SHA256=55fee54c0d0d873724864dc0b2a10b38b7f40300ee9cae4d9baaf8a202c4049a*" OR Hashes="*SHA256=42f0b036687cbd7717c9efed6991c00d4e3e7b032dc965a2556c02177dfdad0f*" OR Hashes="*SHA256=bb1135b51acca8348d285dc5461d10e8f57260e7d0c8cc4a092734d53fc40cbc*" OR Hashes="*SHA256=b179e1ab6dc0b1aee783adbcad4ad6bb75a8a64cb798f30c0dd2ee8aaf43e6de*" OR Hashes="*SHA256=314384b40626800b1cde6fbc51ebc7d13e91398be2688c2a58354aa08d00b073*" OR Hashes="*SHA256=65db1b259e305a52042e07e111f4fa4af16542c8bacd33655f753ef642228890*" OR Hashes="*SHA256=19a212e6fc324f4cb9ee5eba60f5c1fc0191799a4432265cbeaa3307c76a7fc0*" OR Hashes="*SHA256=a7c8f4faf3cbb088cac7753d81f8ec4c38ccb97cd9da817741f49272e8d01200*" OR Hashes="*SHA256=677c0b1add3990fad51f492553d3533115c50a242a919437ccb145943011d2bf*" OR Hashes="*SHA256=fc22977ff721b3d718b71c42440ee2d8a144f3fbc7755e4331ddd5bcc65158d2*" OR Hashes="*SHA256=ad40e6d0f77c0e579fb87c5106bf6de3d1a9f30ee2fbf8c9c011f377fa05f173*" OR Hashes="*SHA256=18e1707b319c279c7e0204074088cc39286007a1cf6cb6e269d5067d8d0628c6*" OR Hashes="*SHA256=c9cf1d627078f63a36bbde364cd0d5f2be1714124d186c06db5bcdf549a109f8*" OR Hashes="*SHA256=afdd66562dea51001c3a9de300f91fc3eb965d6848dfce92ccb9b75853e02508*" OR Hashes="*SHA256=a899b659b08fbae30b182443be8ffb6a6471c1d0497b52293061754886a937a3*" OR Hashes="*SHA256=1963d5a0e512b72353953aadbe694f73a9a576f0241a988378fa40bf574eda52*" OR Hashes="*SHA256=7133a461aeb03b4d69d43f3d26cd1a9e3ee01694e97a0645a3d8aa1a44c39129*" OR Hashes="*SHA256=32e1a8513eee746d17eb5402fb9d8ff9507fb6e1238e7ff06f7a5c50ff3df993*" OR Hashes="*SHA256=082c39fe2e3217004206535e271ebd45c11eb072efde4cc9885b25ba5c39f91d*" OR Hashes="*SHA256=65329dad28e92f4bcc64de15c552b6ef424494028b18875b7dba840053bc0cdd*" OR Hashes="*SHA256=f8430bdc6fd01f42217d66d87a3ef6f66cb2700ebb39c4f25c8b851858cc4b35*" OR Hashes="*SHA256=9f1229cd8dd9092c27a01f5d56e3c0d59c2bb9f0139abf042e56f343637fda33*" OR Hashes="*SHA256=b03f26009de2e8eabfcf6152f49b02a55c5e5d0f73e01d48f5a745f93ce93a29*" OR Hashes="*SHA256=3943a796cc7c5352aa57ccf544295bfd6fb69aae147bc8235a00202dc6ed6838*" OR Hashes="*SHA256=3c5bf92c26398695f9ced7ce647a7e9f6ddcc89eea66b45aa3607196a187431b*" OR Hashes="*SHA256=478917514be37b32d5ccf76e4009f6f952f39f5553953544f1b0688befd95e82*" OR Hashes="*SHA256=4ed2d2c1b00e87b926fb58b4ea43d2db35e5912975f4400aa7bd9f8c239d08b7*" OR Hashes="*SHA256=b205835b818d8a50903cf76936fcf8160060762725bd74a523320cfbd091c038*" OR Hashes="*SHA256=ab8f2217e59319b88080e052782e559a706fa4fb7b8b708f709ff3617124da89*" OR Hashes="*SHA256=73327429c505d8c5fd690a8ec019ed4fd5a726b607cabe71509111c7bfe9fc7e*" OR Hashes="*SHA256=87e38e7aeaaaa96efe1a74f59fca8371de93544b7af22862eb0e574cec49c7c3*" OR Hashes="*SHA256=2270a8144dabaf159c2888519b11b61e5e13acdaa997820c09798137bded3dd6*" OR Hashes="*SHA256=43ba8d96d5e8e54cab59d82d495eeca730eeb16e4743ed134cdd495c51a4fc89*" OR Hashes="*SHA256=e1980c6592e6d2d92c1a65acad8f1071b6a404097bb6fcce494f3c8ac31385cf*" OR Hashes="*SHA256=1dadd707c55413a16320dc70d2ca7784b94c6658331a753b3424ae696c5d93ea*" OR Hashes="*SHA256=d84e3e250a86227c64a96f6d5ac2b447674ba93d399160850acb2339da43eae5*" OR Hashes="*SHA256=5ae23f1fcf3fb735fcf1fa27f27e610d9945d668a149c7b7b0c84ffd6409d99a*" OR Hashes="*SHA256=0f726d8ce21c0c9e01ebe6b55913c519ad6086bcaec1a89f8308f3effacd435f*" OR Hashes="*SHA256=95d50c69cdbf10c9c9d61e64fe864ac91e6f6caa637d128eb20e1d3510e776d3*" OR Hashes="*SHA256=0e14a4401011a9f4e444028ac5b1595da34bbbf9af04a00670f15ff839734003*" OR Hashes="*SHA256=26c86227d3f387897c1efd77dc711eef748eb90be84149cb306e3d4c45cc71c7*" OR Hashes="*SHA256=42d926cfb3794f9b1e3cb397498696cb687f505e15feb9df11b419c49c9af498*" OR Hashes="*SHA256=1684e24dae20ab83ab5462aa1ff6473110ec53f52a32cfb8c1fe95a2642c6d22*" OR Hashes="*SHA256=9b6a84f7c40ea51c38cc4d2e93efb3375e9d98d4894a85941190d94fbe73a4e4*" OR Hashes="*SHA256=440883cd9d6a76db5e53517d0ec7fe13d5a50d2f6a7f91ecfc863bc3490e4f5c*" OR Hashes="*SHA256=e05eeb2b8c18ad2cb2d1038c043d770a0d51b96b748bc34be3e7fc6f3790ce53*" OR Hashes="*SHA256=3a364a7a3f6c0f2f925a060e84fb18b16c118125165b5ea6c94363221dc1b6de*" OR Hashes="*SHA256=fda506e2aa85dc41a4cbc23d3ecc71ab34e06f1def736e58862dc449acbc2330*" OR Hashes="*SHA256=3ac5e01689a3d745e60925bc7faca8d4306ae693e803b5e19c94906dc30add46*" OR Hashes="*SHA256=175eed7a4c6de9c3156c7ae16ae85c554959ec350f1c8aaa6dfe8c7e99de3347*" OR Hashes="*SHA256=8596ea3952d84eeef8f5dc5b0b83014feb101ec295b2d80910f21508a95aa026*" OR Hashes="*SHA256=52a90fd1546c068b92add52c29fbb8a87d472a57e609146bbcb34862f9dcec15*" OR Hashes="*SHA256=543991ca8d1c65113dff039b85ae3f9a87f503daec30f46929fd454bc57e5a91*" OR Hashes="*SHA256=e75714f8e0ff45605f6fc7689a1a89c7dcd34aab66c6131c63fefaca584539cf*" OR Hashes="*SHA256=1aaa9aef39cb3c0a854ecb4ca7d3b213458f302025e0ec5bfbdef973cca9111c*" OR Hashes="*SHA256=cc687fe3741bbde1dd142eac0ef59fd1d4457daee43cdde23bb162ef28d04e64*" OR Hashes="*SHA256=3ed15a390d8dfbd8a8fb99e8367e19bfd1cced0e629dfe43ccdb46c863394b59*" OR Hashes="*SHA256=8c95d28270a4a314299cf50f05dcbe63033b2a555195d2ad2f678e09e00393e6*" OR Hashes="*SHA256=eea53103e7a5a55dc1df79797395a2a3e96123ebd71cdd2db4b1be80e7b3f02b*" OR Hashes="*SHA256=37c637a74bf20d7630281581a8fae124200920df11ad7cd68c14c26cc12c5ec9*" OR Hashes="*SHA256=32cccc4f249499061c0afa18f534c825d01034a1f6815f5506bf4c4ff55d1351*" OR Hashes="*SHA256=c5050a2017490fff7aa53c73755982b339ddb0fd7cef2cde32c81bc9834331c5*" OR Hashes="*SHA256=ff803017d1acafde6149fe7d463aee23b1c4f6f3b97c698c05f3ca6f07e4df6c*" OR Hashes="*SHA256=000547560fea0dd4b477eb28bf781ea67bf83c748945ce8923f90fdd14eb7a4b*" OR Hashes="*SHA256=0af5ccb3d33a9ba92071c9637be6254030d61998733a5eb3583e865e17844e05*" OR Hashes="*SHA256=a13054f349b7baa8c8a3fcbd31789807a493cc52224bbff5e412eb2bd52a6433*" OR Hashes="*SHA256=da6ca1fb539f825ca0f012ed6976baf57ef9c70143b7a1e88b4650bf7a925e24*" OR Hashes="*SHA256=9c2977d63faa340b03e1bbfb8a6db19c0adfa60ff6579b888ece10022c94c3ec*" OR Hashes="*SHA256=771a8d05f1af6214e0ef0886662be500ee910ab99f0154227067fddcfe08a3dd*" OR Hashes="*SHA256=927c2a580d51a598177fa54c65e9d2610f5f212f1b6cb2fbf2740b64368f010a*" OR Hashes="*SHA256=42851a01469ba97cdc38939b10cf9ea13237aa1f6c37b1ac84904c5a12a81fa0*" OR Hashes="*SHA256=e6db8a1c9d82d18b948c7135439fdeaa9bc02ea97509e3534de65e5481489220*" OR Hashes="*SHA256=1062211314088012edb9fe65780e35e7b3144ac45021269fc993ef2931c8584b*" OR Hashes="*SHA256=029dbf6d8dc920a32b3c7a2057513d3741b20b7f6e7aa23b113859a8049214df*" OR Hashes="*SHA256=1d053020079124ac526d84affb17bf4a1563ecd872c83b4b6299c9aa6a732557*" OR Hashes="*SHA256=c059f1b2b73ecab48d62f469d48dbde74a80c4ada07f0bd3b417ec4e044fb522*" OR Hashes="*SHA256=a66d2fb7ef7350ea74d4290c57fb62bc59c6ea93f759d4ca93c3febca7aeb512*" OR Hashes="*SHA256=5d712d3fad791bdc67502ed7c6586ca39d12ae26c7b245c36effec92e3cda08e*" OR Hashes="*SHA256=e61004335dfe7349f2b2252baa1e111fb47c0f2d6c78a060502b6fcc92f801e4*" OR Hashes="*SHA256=7c0f77d103015fc29379ba75d133dc3450d557b0ba1f7495c6b43447abdae230*" OR Hashes="*SHA256=97363f377aaf3c01641ac04a15714acbec978afb1219ac8f22c7e5df7f2b2d56*" OR Hashes="*SHA256=8e6363a6393eb4234667c6f614b2072e33512866b3204f8395bbe01530d63f2f*" OR Hashes="*SHA256=09b0e07af8b17db1d896b78da4dd3f55db76738ee1f4ced083a97d737334a184*" OR Hashes="*SHA256=2a4f4400402cdc475d39389645ca825bb0e775c3ecb7c527e30c5be44e24af7d*" OR Hashes="*SHA256=5f69d6b167a1eeca3f6ac64785c3c01976ee7303171faf998d65852056988683*" OR Hashes="*SHA256=f877296e8506e6a1acbdacdc5085b18c6842320a2775a329d286bac796f08d54*" OR Hashes="*SHA256=2d2c7ee9547738a8a676ab785c151e8b48ed40fe7cf6174650814c7f5f58513b*" OR Hashes="*SHA256=1ae328c88cf49072c125f41b16c2a2063203b21164245e2850ca491bdd4a522e*" OR Hashes="*SHA256=84b4e202c6ce1b08cda1b5e7cd3c3b073155120d80141b2055a1a98a4a18dc42*" OR Hashes="*SHA256=0ea78cb430fbf8ef4c9f3d1eadf2b057939081b1367bc6610e918fa3c6d8920c*" OR Hashes="*SHA256=a2571531c6b384003bad06003be01e75fcd489b7b2d04c3d072b10f08f50b33b*" OR Hashes="*SHA256=4d07f9ecd2540218194874427155a4dc82613574672b55257a321f80e7c9f219*" OR Hashes="*SHA256=6d14ae56e140c02f5d1e6df5351b87ac0f4b7e9dc5a3d778a1e399cb7878802a*" OR Hashes="*SHA256=c4310708ee81058286be30db1b1d93deab62a37eaa7974750a7ffbe798eed747*" OR Hashes="*SHA256=d3d88be19bbb889af859c6189b0750a4e527891f95b0dd2e33cb987ec9784f34*" OR Hashes="*SHA256=3313e8d7f276a48fbc9cbdb5bcd013fd79a674da6638327c6342a5c5a3bfa893*") OR (sha1="2261198385d62d2117f50f631652eded0ecc71db" OR sha1="8db869c0674221a2d3280143cbb0807fac08e0cc" OR sha1="27d3ebea7655a72e6e8b95053753a25db944ec0f" OR sha1="33cdab3bbc8b3adce4067a1b042778607dce2acd" OR sha1="21e6c104fe9731c874fab5c9560c929b2857b918" OR sha1="d979353d04bf65cc92ad3412605bc81edbb75ec2" OR sha1="2f991435a6f58e25c103a657d24ed892b99690b8" OR sha1="f02af84393e9627ba808d4159841854a6601cf80" OR sha1="bb962c9a8dda93e94fef504c4159de881e4706fe" OR sha1="b97a8d506be2e7eaa4385f70c009b22adbd071ba" OR sha1="92f251358b3fe86fd5e7aa9b17330afa0d64a705" OR sha1="8b6aa5b2bff44766ef7afbe095966a71bc4183fa" OR sha1="af6e1f2cfb230907476e8b2d676129b6d6657124" OR sha1="fcde5275ee1913509927ce5f0f85e6681064c9d2" OR sha1="00a442a4305c62cefa8105c0b4c4a9a5f4d1e93b" OR sha1="6523b3fd87de39eb5db1332e4523ce99556077dc" OR sha1="72966ca845759d239d09da0de7eebe3abe86fee3" OR sha1="57511ef5ff8162a9d793071b5bf7ebe8371759de" OR sha1="2d503a2457a787014a1fdd48a2ece2e6cbe98ea7" OR sha1="400f833dcc2ef0a122dd0e0b1ec4ec929340d90e" OR sha1="89cd760e8cb19d29ee08c430fb17a5fd4455c741" OR sha1="1d0df45ee3fa758f0470e055915004e6eae54c95" OR sha1="d5fd9fe10405c4f90235e583526164cd0902ed86" OR sha1="c52cef5b9e1d4a78431b7af56a6fdb6aa1bcad65" OR sha1="609fa1efcf61e26d64a5ceb13b044175ab2b3a13" OR sha1="7d7c03e22049a725ace2a9812c72b53a66c2548b" OR sha1="f9519d033d75e1ab6b82b2e156eafe9607edbcfb" OR sha1="468e2e5505a3d924b14fedee4ddf240d09393776" OR sha1="2e3de9bff43d7712707ef8a0b10f7e4ad8427fd8" OR sha1="c9cbfdd0be7b35751a017ec59ff7237ffdc4df1f" OR sha1="078ae07dec258db4376d5a2a05b9b508d68c0123" OR sha1="623cd2abef6c92255f79cbbd3309cb59176771da" OR sha1="1f3a9265963b660392c4053329eb9436deeed339" OR sha1="4a235f0b84ff615e2879fa9e0ec0d745fcfdaa5c" OR sha1="ace6b9e34e3e2e73fe584f3bbdb4e4ec106e0a7d" OR sha1="4268f30b79ce125a81d0d588bef0d4e2ad409bbb" OR sha1="c834c4931b074665d56ccab437dfcc326649d612" OR sha1="8f5cd4a56e6e15935491aa40adb1ecad61eafe7c" OR sha1="51b60eaa228458dee605430aae1bc26f3fc62325" OR sha1="3270720a066492b046d7180ca6e60602c764cac7" OR sha1="2a6e6bd51c7062ad24c02a4d2c1b5e948908d131" OR sha1="19bd488fe54b011f387e8c5d202a70019a204adf" OR sha1="a6fe4f30ca7cb94d74bc6d42cdd09a136056952e" OR sha1="ea877092d57373cb466b44e7dbcad4ce9a547344" OR sha1="205c69f078a563f54f4c0da2d02a25e284370251" OR sha1="f9feb60b23ca69072ce42264cd821fe588a186a6" OR sha1="b25170e09c9fb7c0599bfba3cf617187f6a733ac" OR sha1="160c96b5e5db8c96b821895582b501e3c2d5d6e7" OR sha1="a2e0b3162cfa336cd4ab40a2acc95abe7dc53843" OR sha1="4e826430a1389032f3fe06e2cc292f643fb0c417" OR sha1="7ab4565ba24268f0adadb03a5506d4eb1dc7c181" OR sha1="dc7b022f8bd149efbcb2204a48dce75c72633526" OR sha1="0307d76750dd98d707c699aee3b626643afb6936" OR sha1="5711c88e9e64e45b8fc4b90ab6f2dd6437dc5a8a" OR sha1="6714380bc0b8ab09b9a0d2fa66d1b025b646b946" OR sha1="8626ab1da6bfbdf61bd327eb944b39fd9df33d1d" OR sha1="30a224b22592d952fbe2e6ad97eda4a8f2c734e0" OR sha1="c95db1e82619fb16f8eec9a8209b7b0e853a4ebe" OR sha1="fe1d909ab38de1389a2a48352fd1c8415fd2eab0" OR sha1="b4d1554ec19504215d27de0758e13c35ddd6db3e" OR sha1="5dd2c31c4357a8b76db095364952b3d0e3935e1d" OR sha1="ecb4d096a9c58643b02f328d2c7742a38e017cf0" OR sha1="4a705af959af61bad48ef7579f839cb5ebd654d2" OR sha1="d2e6fc9259420f0c9b6b1769be3b1f63eb36dc57" OR sha1="c948ae14761095e4d76b55d9de86412258be7afd" OR sha1="ddbe809b731a0962e404a045ab9e65a0b64917ad" OR sha1="745bad097052134548fe159f158c04be5616afc2" OR sha1="8d59fd14a445c8f3f0f7991fa6cd717d466b3754" OR sha1="2dfcb799b3c42ecb0472e27c19b24ac7532775ce" OR sha1="cc51be79ae56bc97211f6b73cc905c3492da8f9d" OR sha1="ac13941f436139b909d105ad55637e1308f49d9a" OR sha1="2b0bb408ff0e66bcdf6574f1ca52cbf4015b257b" OR sha1="cc0e0440adc058615e31e8a52372abadf658e6b1" OR sha1="5520ac25d81550a255dc16a0bb89d4b275f6f809" OR sha1="6afc6b04cf73dd461e4a4956365f25c1f1162387" OR sha1="4b009e91bae8d27b160dc195f10c095f8a2441e1" OR sha1="6003184788cd3d2fc624ca801df291ccc4e225ee" OR sha1="0466e90bf0e83b776ca8716e01d35a8a2e5f96d3" OR sha1="e6305dddd06490d7f87e3b06d09e9d4c1c643af0" OR sha1="89909fa481ff67d7449ee90d24c167b17b0612f1" OR sha1="d7e8aef8c8feb87ce722c0b9abf34a7e6bab6eb4" OR sha1="5e6ddd2b39a3de0016385cbd7aa50e49451e376d" OR sha1="976777d39d73034df6b113dfce1aa6e1d00ffcfd" OR sha1="9c6749fc6c1127f8788bff70e0ce9062959637c9" OR sha1="53acd4d9e7ba0b1056cf52af0d191f226eddf312" OR sha1="3abb9d0a9d600200ae19c706e570465ef0a15643" OR sha1="27eab595ec403580236e04101172247c4f5d5426" OR sha1="78b9481607ca6f3a80b4515c432ddfe6550b18a8" OR sha1="414cd15d6c991d19fb5be02e3b9fb0e6c5ce731c" OR sha1="d9c09dd725bc7bc3c19b4db37866015817a516ef" OR sha1="9c256edd10823ca76c0443a330e523027b70522d" OR sha1="35829e096a15e559fcbabf3441d99e580ca3b26e" OR sha1="b8de3a1aeeda9deea43e3f768071125851c85bd0" OR sha1="054a50293c7b4eea064c91ef59cf120d8100f237" OR sha1="d94f2fb3198e14bfe69b44fb9f00f2551f7248b2" OR sha1="01a578a3a39697c4de8e3dab04dba55a4c35163e" OR sha1="14bf0eaa90e012169745b3e30c281a327751e316" OR sha1="f50c6b84dfb8f2d53ba3bce000a55f0a486c0e79" OR sha1="6100eb82a25d64a7a7702e94c2b21333bc15bd08" OR sha1="bf87e32a651bdfd9b9244a8cf24fca0e459eb614" OR sha1="28b1c0b91eb6afd2d26b239c9f93beb053867a1a" OR sha1="879fcc6795cebe67718388228e715c470de87dca" OR sha1="1f7501e01d84a2297c85cb39880ec4e40ac3fe8a" OR sha1="152b6bb9ffd2ffec00cc46f5c6e29362d0e66e67" OR sha1="5f8356ffa8201f338dd2ea979eb47881a6db9f03" OR sha1="a7bd05de737f8ea57857f1e0845a25677df01872" OR sha1="cce9b82f01ec68f450f5fe4312f40d929c6a506e" OR sha1="e35a2b009d54e1a0b231d8a276251f64231b66a3" OR sha1="37364cb5f5cefd68e5eca56f95c0ab4aff43afcc" OR sha1="d62fa51e520022483bdc5847141658de689c0c29" OR sha1="93aa3bb934b74160446df3a47fa085fd7f3a6be9" OR sha1="ec4cc6de4c779bb1ca1dd32ee3a03f7e8d633a9b" OR sha1="35f1ba60ba0da8512a0b1b15ee8e30fe240d77cd" OR sha1="3805e4e08ad342d224973ecdade8b00c40ed31be" OR sha1="65d8a7c2e867b22d1c14592b020c548dd0665646" OR sha1="c8d87f3cd34c572870e63a696cf771580e6ea81b" OR sha1="c4d7fb9db3c3459f7e8c0e3d48c95c7c9c4cff60" OR sha1="d34a7c497c603f3f7fcad546dc4097c2da17c430" OR sha1="1fd7f881ea4a1dbb5c9aeb9e7ad659a85421745b" OR sha1="0b8b83f245d94107cb802a285e6529161d9a834d" OR sha1="c969f1f73922fd95db1992a5b552fbc488366a40" OR sha1="ac600a2bc06b312d92e649b7b55e3e91e9d63451" OR sha1="da9cea92f996f938f699902482ac5313d5e8b28e" OR sha1="33285b2e97a0aeb317166cce91f6733cf9c1ad53" OR sha1="21edff2937eb5cd6f6b0acb7ee5247681f624260" OR sha1="f052dc35b74a1a6246842fbb35eb481577537826" OR sha1="f0c463d29a5914b01e4607889094f1b7d95e7aaf" OR sha1="0c26ab1299adcd9a385b541ef1653728270aa23e" OR sha1="f36a47edfacd85e0c6d4d22133dd386aee4eec15" OR sha1="460008b1ffd31792a6deadfa6280fb2a30c8a5d2" OR sha1="738b7918d85e5cb4395df9e3f6fc94ddad90e939" OR sha1="43419df1f9a07430a18c5f3b3cc74de621be0f8e" OR sha1="558aad879b6a47d94a968f39d0a4e3a3aaef1ef1" OR sha1="7fb52290883a6b69a96d480f2867643396727e83" OR sha1="f5696fb352a3fbd14fb1a89ad21a71776027f9ab" OR sha1="693a2645c28fc3b248fda95179c36c3ac64f6fc2" OR sha1="05c0c49e8bcf11b883d41441ce87a2ee7a3aba1d" OR sha1="d25340ae8e92a6d29f599fef426a2bc1b5217299" OR sha1="7c1b25518dee1e30b5a6eaa1ea8e4a3780c24d0c" OR sha1="fe10018af723986db50701c8532df5ed98b17c39" OR sha1="bfe55cacc7c56c9f7bd75bdb4b352c0b745d071b" OR sha1="a21c84c6bf2e21d69fa06daaf19b4cc34b589347" OR sha1="82ba5513c33e056c3f54152c8555abf555f3e745" OR sha1="d098600152e5ee6a8238d414d2a77a34da8afaaa" OR sha1="64e4ac8b9ea2f050933b7ec76a55dd04e97773b4" OR sha1="bbc1e5fd826961d93b76abd161314cb3592c4436" OR sha1="90a76945fd2fa45fab2b7bcfdaf6563595f94891" OR sha1="b03b1996a40bfea72e4584b82f6b845c503a9748" OR sha1="c771ea59f075170e952c393cfd6fc784b265027c" OR sha1="cb44c6f0ee51cb4c5836499bc61dd6c1fbdf8aa1" OR sha1="0918277fcdc64a9dc51c04324377b3468fa1269b" OR sha1="b09bcc042d60d2f4c0d08284818ed198cededa04" OR sha1="8dc2097a90eb7e9d6ee31a7c7a95e7a0b2093b89" OR sha1="15df139494d2c40a645fb010908551185c27f3c5" OR sha1="012db3a80faf1f7f727b538cbe5d94064e7159de" OR sha1="d04e5db5b6c848a29732bfd52029001f23c3da75" OR sha1="490109fa6739f114651f4199196c5121d1c6bdf2" OR sha1="b4d014b5edd6e19ce0e8395a64faedf49688ecb5" OR sha1="a87d6eac2d70a3fbc04e59412326b28001c179de" OR sha1="3f223581409492172a1e875f130f3485b90fbe5f" OR sha1="5db61d00a001fd493591dc919f69b14713889fc5" OR sha1="9923c8f1e565a05b3c738d283cf5c0ed61a0b90f" OR sha1="15d1a6a904c8409fb47a82aefa42f8c3c7d8c370" OR sha1="9d07df024ec457168bf0be7e0009619f6ac4f13c" OR sha1="9a35ae9a1f95ce4be64adc604c80079173e4a676" OR sha1="c6bd965300f07012d1b651a9b8776028c45b149a" OR sha1="e83458c4a6383223759cd8024e60c17be4e7c85f" OR sha1="cb3de54667548a5c9abf5d8fa47db4097fcee9f1" OR sha1="9c24dd75e4074041dbe03bf21f050c77d748b8e9" OR sha1="dc55217b6043d819eadebd423ff07704ee103231" OR sha1="e92817a8744ebc4e4fa5383cdce2b2977f01ecd4" OR sha1="dc0e97adb756c0f30b41840a59b85218cbdd198f" OR sha1="26c4a7b392d7e7bd7f0a2a758534e45c0d9a56ab" OR sha1="d0d39e1061f30946141b6ecfa0957f8cc3ddeb63" OR sha1="c6d349823bbb1f5b44bae91357895dba653c5861" OR sha1="f42f28d164205d9f6dab9317c9fecad54c38d5d2" OR sha1="bbc0b9fd67c8f4cefa3d76fcb29ff3cef996b825" OR sha1="8183a341ba6c3ce1948bf9be49ab5320e0ee324d" OR sha1="eb1ecad3d37bb980f908bf1a912415cff32e79e6" OR sha1="eb0d45aa6f537f5b2f90f3ad99013606eafcd162" OR sha1="6053d258096bccb07cb0057d700fe05233ab1fbb" OR sha1="29a190727140f40cea9514a6420f5a195e36386b" OR sha1="a4b2c56c12799855162ca3b004b4b2078c6ecf77" OR sha1="7667b72471689151e176baeba4e1cd9cd006a09a" OR sha1="d7f7594ff084201c0d9fa2f4ef1626635b67bce5" OR sha1="99201c9555e5faf6e8d82da793b148311f8aa4b8" OR sha1="947db58d6f36a8df9fa2a1057f3a7f653ccbc42e" OR sha1="6a3d3b9ab3d201cd6b0316a7f9c3fb4d34d0f403" OR sha1="d702d88b12233be9413446c445f22fda4a92a1d9" OR sha1="910cb12aa49e9f35ecc4907e8304adf0dcca8cf1" OR sha1="643383938d5e0d4fd30d302af3e9293a4798e392" OR sha1="c4ed28fdfba7b8a8dfe39e591006f25d39990f07" OR sha1="b0032b8d8e6f4bd19a31619ce38d8e010f29a816" OR sha1="db6245578ec57bd767b27ecf8085095e1c8e5a6e" OR sha1="166759fd511613414d3213942fe2575b926a6226" OR sha1="02a8b74899591da7b7f49c0450328d39b939d7e4" OR sha1="98ceed786f79288becc08c3b82c57e8d4bfa1bca" OR sha1="f6b3577ea4b1a5641ae3421151a26268434c3db8" OR sha1="4de33d03fee52f396a1c788000ca868d56ac30de" OR sha1="c6920171fa6dff2c17eb83befb5fd28e8dddf5f0" OR sha1="fbc6d2448739ddec35bb5d6c94b46df4148f648d" OR sha1="6b54f8f137778c1391285fee6150dfa58a8120b1" OR sha1="943593e880b4d340f2548548e6e673ef6f61eed3" OR sha1="5ac4d0e2381fc4a8aebe94a0fb6fe5e7558e4dcd" OR sha1="e44297a2b750ec1958bef265e2f1ae6fa4323b28" OR sha1="aa2ea973bb248b18973e57339307cfb8d309f687" OR sha1="3a5d176c50f97b71d139767ed795d178623f491d" OR sha1="25d812a5ece19ea375178ef9d60415841087726e" OR sha1="3795e32592ab6d8074b6f7ad33759c6a39b0df07" OR sha1="fc121ed6fb37e97a004b6faf217435b772dfc4c0" OR sha1="ab2b8602e4baef828b58b995d0889a8e5b8dbd02" OR sha1="cf040040628b58f4a811f98c2690913c1e8e4e3c" OR sha1="3296844d22c87dd5eba3aa378a8242b41d59db7a" OR sha1="bc47e15537fa7c32dfefd23168d7e1741f8477ed" OR sha1="cb22723faa5ae2809476e5c5e9b9a597b26cab9b" OR sha1="f3c5e723ae009b336cd2719137b8cd194c9ee51d" OR sha1="41f2d0f9863bce8920c207b1ef5d3d32b603edef" OR sha1="eb93d2f564fea9b3dc350f386b45de2cd9a3e001" OR sha1="3cd037fbba8aae82c1b111c9f8755349c98bcb3c" OR sha1="9401389fba314d1810f83edce33c37e84a78e112" OR sha1="7eb34cc1fcffb4fdb5cb7e97184dd64a65cb9371" OR sha1="16d7ecf09fc98798a6170e4cef2745e0bee3f5c7" OR sha1="fcd615df88645d1f57ff5702bd6758b77efea6d0" OR sha1="f3db629cfe37a73144d5258e64d9dd8b38084cf4" OR sha1="a00e444120449e35641d58e62ed64bb9c9f518d2" OR sha1="38571f14fc014487194d1eecfa80561ee8644e09" OR sha1="4d41248078181c7f61e6e4906aa96bbdea320dc2" OR sha1="3599ea2ac1fa78f423423a4cf90106ea0938dde8" OR sha1="3d6d53b0f1cc908b898610227b9f1b9352137aba" OR sha1="4c18754dca481f107f0923fb8ef5e149d128525d" OR sha1="8c377ab4eebc5f4d8dd7bb3f90c0187dfdd3349f" OR sha1="cde32654a041fedc7b0fa1083f6005b950760062" OR sha1="5fb9421be8a8b08ec395d05e00fd45eb753b593a" OR sha1="b480c54391a2a2f917a44f91a5e9e4590648b332" OR sha1="4f7a8e26a97980544be634b26899afbefb0a833c" OR sha1="c1d5cf8c43e7679b782630e93f5e6420ca1749a7" OR sha1="a7e9a4686aa7291331e2c8708882c8d81d05264f" OR sha1="7ba19a701c8af76988006d616a5f77484c13cb0a" OR sha1="4243dbbf6e5719d723f24d0f862afd0fcb40bc35" OR sha1="00b4e8b7644d1bf93f5ddb5740b444b445e81b02" OR sha1="fd833f3fe2fa396878033b9e6054725248bf9881" OR sha1="db446af0e34259e95f4db112a9f06177e1eef4e0" OR sha1="39d7b121bc654a0de891225e0f8b7b5537c24931" OR sha1="d0a228ed8af190dec0c1a812e212f5e68ee3b43e" OR sha1="7d2fc1a6729521e5c76f659e4c398e2061f7ed5e" OR sha1="f999709e5b00a68a0f4fa912619fe6548ad0c42d" OR sha1="06232f7ea7ea24102d452427aedbbc8b8e188a0c" OR sha1="a380aeb3ffaecc53ca48bb1d4d622c46f1de7962" OR sha1="4927d843577bada119a17b249ff4e7f5e9983a92" OR sha1="e5114fd50904c7fb75d8c86367b9a2dd4f79dfb1" OR sha1="3ccf1f3ac636a5e21b39ede48ff49fa23e05413f" OR sha1="755349d56cdd668ca22eebc4fc89f0cccef47327" OR sha1="56af49e030eb85528e82849d7d1b6147f3c4973e" OR sha1="45a9f95a7a018925148152b888d09d478d56bbf5" OR sha1="540b9f9a232b9d597138b8e0f33d83f5f6e247af" OR sha1="bdfb25cc4ed569dc0d5849545eb4abe08539029f" OR sha1="28da2ac7c82b999c53f99d55331cfa3624a0bc6f" OR sha1="5d5f92fba0f39826b527f335a7cca7d363758410" OR sha1="1858ab7ad1947f5c24b9c913cd975e6dbb536865" OR sha1="0f2aa3bfdfd699e258382ea1b3c1db1ad7211023" OR sha1="886a9c16b871da42cdb54c6738a8e088be8b989f" OR sha1="c24883645c0589f6171e8ee10080750ac66d75e6" OR sha1="36d3b09e19477d807a6a5efff89aa6cc8b71bdeb" OR sha1="e58dd758e28218e1edb33cd88bb97504972ee221" OR sha1="d782ef79266179d2247807857877fabb2e402be5") OR (sha256="04A85E359525D662338CAE86C1E59B1D7AA9BD12B920E8067503723DC1E03162" OR sha256="05F052C64D192CF69A462A5EC16DDA0D43CA5D0245900C9FCB9201685A2E7748" OR sha256="4045AE77859B1DBF13972451972EAAF6F3C97BEA423E9E78F1C2F14330CD47CA" OR sha256="6948480954137987A0BE626C24CF594390960242CD75F094CD6AAA5C2E7A54FA" OR sha256="8CB62C5D41148DE416014F80BD1FD033FD4D2BD504CB05B90EEB6992A382D58F" OR sha256="B1D96233235A62DBB21B8DBE2D1AE333199669F67664B107BFF1AD49B41D9414" OR sha256="7196187FB1EF8D108B380D37B2AF8EFDEB3CA1F6EEFD37B5DC114C609147216D" OR sha256="7F375639A0DF7FE51E5518CF87C3F513C55BC117DB47D28DA8C615642EB18BFA" OR sha256="42579A759F3F95F20A2C51D5AC2047A2662A2675B3FB9F46C1ED7F23393A0F00" OR sha256="2DA330A2088409EFC351118445A824F11EDBE51CF3D653B298053785097FE40E" OR sha256="436CCAB6F62FA2D29827916E054ADE7ACAE485B3DE1D3E5C6C62D3DEBF1480E7" OR sha256="B4D47EA790920A4531E3DF5A4B4B0721B7FEA6B49A35679F0652F1E590422602" OR sha256="DDE6F28B3F7F2ABBEE59D4864435108791631E9CB4CDFB1F178E5AA9859956D8" OR sha256="B48A309EE0960DA3CAAAAF1E794E8C409993AEB3A2B64809F36B97AAC8A1E62A" OR sha256="025E7BE9FCEFD6A83F4471BBA0C11F1C11BD5047047D26626DA24EE9A419CDC4" OR sha256="2AA1B08F47FBB1E2BD2E4A492F5D616968E703E1359A921F62B38B8E4662F0C4" OR sha256="ECE0A900EA089E730741499614C0917432246CEB5E11599EE3A1BB679E24FD2C" OR sha256="F40435488389B4FB3B945CA21A8325A51E1B5F80F045AB019748D0EC66056A8B" OR sha256="2A652DE6B680D5AD92376AD323021850DAB2C653ABF06EDF26120F7714B8E08A" OR sha256="950A4C0C772021CEE26011A92194F0E58D61588F77F2873AA0599DFF52A160C9" OR sha256="0AAFA9F47ACF69D46C9542985994FF5321F00842A28DF2396D4A3076776A83CB" OR sha256="47F08F7D30D824A8F4BB8A98916401A37C0FD8502DB308ABA91FE3112B892DCC" OR sha256="B9A4E40A5D80FEDD1037EAED958F9F9EFED41EB01ADA73D51B5DCD86E27E0CBF" OR sha256="5C04C274A708C9A7D993E33BE3EA9E6119DC29527A767410DBAF93996F87369A" OR sha256="0040153302B88BEE27EB4F1ECA6855039E1A057370F5E8C615724FA5215BADA3" OR sha256="3326E2D32BBABD69FEB6024809AFC56C7E39241EBE70A53728C77E80995422A5" OR sha256="36B9E31240AB0341873C7092B63E2E0F2CAB2962EBF9B25271C3A1216B7669EB" OR sha256="29E0062A017A93B2F2F5207A608A96DF4D554C5DE976BD0276C2590A03BD3E94" OR sha256="45ABDBCD4C0916B7D9FAAF1CD08543A3A5178871074628E0126A6EDA890D26E0" OR sha256="50DB5480D0392A7DD6AB5DF98389DC24D1ED1E9C98C9C35964B19DABCD6DC67F" OR sha256="607DC4C75AC7AEF82AE0616A453866B3B358C6CF5C8F9D29E4D37F844306B97C" OR sha256="61D6E40601FA368800980801A662A5B3B36E3C23296E8AE1C85726A56EF18CC8" OR sha256="74A846C61ADC53692D3040AFF4C1916F32987AD72B07FE226E9E7DBEFF1036C4" OR sha256="76FB4DEAEE57EF30E56C382C92ABFFE2CF616D08DBECB3368C8EE6B02E59F303" OR sha256="81939E5C12BD627FF268E9887D6FB57E95E6049F28921F3437898757E7F21469" OR sha256="9790A7B9D624B2B18768BB655DDA4A05A9929633CEF0B1521E79E40D7DE0A05B" OR sha256="9A1D66036B0868BBB1B2823209FEDEA61A301D5DD245F8E7D390BD31E52D663E" OR sha256="AA9AB1195DC866270E984F1BED5E1358D6EF24C515DFDB6C2A92D1E1B94BF608" OR sha256="AF095DE15A16255CA1B2C27DAD365DFF9AC32D2A75E8E288F5A1307680781685" OR sha256="D5586DC1E61796A9AE5E5D1CED397874753056C3DF2EB963A8916287E1929A71" OR sha256="D8459F7D707C635E2C04D6D6D47B63F73BA3F6629702C7A6E0DF0462F6478AE2" OR sha256="E81230217988F3E7EC6F89A06D231EC66039BDBA340FD8EBB2BBB586506E3293" OR sha256="F88EBB633406A086D9CCA6BC8B66A4EA940C5476529F9033A9E0463512A23A57" OR sha256="1C8DFA14888BB58848B4792FB1D8A921976A9463BE8334CFF45CC96F1276049A" OR sha256="22418016E980E0A4A2D01CA210A17059916A4208352C1018B0079CCB19AAF86A" OR sha256="405472A8F9400A54BB29D03B436CCD58CFD6442FE686F6D2ED4F63F002854659" OR sha256="49F75746EEBE14E5DB11706B3E58ACCC62D4034D2F1C05C681ECEF5D1AD933BA" OR sha256="4A3D4DB86F580B1680D6454BAEE1C1A139E2DDE7D55E972BA7C92EC3F555DCE2" OR sha256="4AB41816ABBF14D59E75B7FAD49E2CB1C1FEB27A3CB27402297A2A4793FF9DA7" OR sha256="54841D9F89E195196E65AA881834804FE3678F1CF6B328CAB8703EDD15E3EC57" OR sha256="5EE292B605CD3751A24E5949AAE615D472A3C72688632C3040DC311055B75A92" OR sha256="76B86543CE05540048F954FED37BDDA66360C4A3DDB8328213D5AEF7A960C184" OR sha256="7F190F6E5AB0EDAFD63391506C2360230AF4C2D56C45FC8996A168A1FC12D457" OR sha256="845F1E228DE249FC1DDF8DC28C39D03E8AD328A6277B6502D3932E83B879A65A" OR sha256="84BF1D0BCDF175CFE8AEA2973E0373015793D43907410AE97E2071B2C4B8E2D4" OR sha256="8EF0AD86500094E8FA3D9E7D53163AA6FEEF67C09575C169873C494ED66F057F" OR sha256="A56C2A2425EB3A4260CC7FC5C8D7BED7A3B4CD2AF256185F24471C668853AEE8" OR sha256="AC3F613D457FC4D44FA27B2E0B1BAA62C09415705EFB5A40A4756DA39B3AC165" OR sha256="B1334A71CC73B3D0C54F62D8011BEC330DFC355A239BF94A121F6E4C86A30A2E" OR sha256="B47BE212352D407D0EF7458A7161C66B47C2AEC8391DD101DF11E65728337A6A" OR sha256="B9B3878DDC5DFB237D38F8D25067267870AFD67D12A330397A8853209C4D889C" OR sha256="DB90E554AD249C2BD888282ECF7D8DA4D1538DD364129A3327B54F8242DD5653" OR sha256="E61A54F6D3869B43C4ECEAC3016DF73DF67CCE03878C5A6167166601C5D3F028" OR sha256="3871E16758A1778907667F78589359734F7F62F9DC953EC558946DCDBE6951E3" OR sha256="80CBBA9F404DF3E642F22C476664D63D7C229D45D34F5CD0E19C65EB41BECEC3" OR sha256="BB50818A07B0EB1BD317467139B7EB4BAD6CD89053FECDABFEAE111689825955" OR sha256="FF6729518A380BF57F1BC6F1EC0AA7F3012E1618B8D9B0F31A61D299EE2B4339" OR sha256="3A5EC83FE670E5E23AEF3AFA0A7241053F5B6BE5E6CA01766D6B5F9177183C25" OR sha256="61A1BDDDD3C512E681818DEBB5BEE94DB701768FC25E674FCAD46592A3259BD0" OR sha256="07B6D69BAFCFD767F1B63A490A8843C3BB1F8E1BBEA56176109B5743C8F7D357" OR sha256="21CCDD306B5183C00ECFD0475B3152E7D94B921E858E59B68A03E925D1715F21" OR sha256="2D83CCB1AD9839C9F5B3F10B1F856177DF1594C66CBBC7661677D4B462EBF44D" OR sha256="F581DECC2888EF27EE1EA85EA23BBB5FB2FE6A554266FF5A1476ACD1D29D53AF" OR sha256="F8965FDCE668692C3785AFA3559159F9A18287BC0D53ABB21902895A8ECF221B" OR sha256="3D23BDBAF9905259D858DF5BF991EB23D2DC9F4ECDA7F9F77839691ACEF1B8C4" OR sha256="DD4A1253D47DE14EF83F1BC8B40816A86CCF90D1E624C5ADF9203AE9D51D4097" OR sha256="509628B6D16D2428031311D7BD2ADD8D5F5160E9ECC0CD909F1E82BBBB3234D6" OR sha256="525D9B51A80CA0CD4C5889A96F857E73F3A80DA1FFBAE59851E0F51BDFB0B6CD" OR sha256="6DE84CAA2CA18673E01B91AF58220C60AECD5CCCF269725EC3C7F226B2167492" OR sha256="09BEDBF7A41E0F8DABE4F41D331DB58373CE15B2E9204540873A1884F38BDDE1" OR sha256="101402D4F5D1AE413DED499C78A5FCBBC7E3BAE9B000D64C1DD64E3C48C37558" OR sha256="131D5490CEB9A5B2324D8E927FEA5BECFC633015661DE2F4C2F2375A3A3B64C6" OR sha256="1DDFE4756F5DB9FB319D6C6DA9C41C588A729D9E7817190B027B38E9C076D219" OR sha256="1E8B0C1966E566A523D652E00F7727D8B0663F1DFDCE3B9A09B9ADFAEF48D8EE" OR sha256="2BBE65CBEC3BB069E92233924F7EE1F95FFA16173FCEB932C34F68D862781250" OR sha256="30706F110725199E338E9CC1C940D9A644D19A14F0EB8847712CBA4CACDA67AB" OR sha256="3124B0411B8077605DB2A9B7909D8240E0D554496600E2706E531C93C931E1B5" OR sha256="38FA0C663C8689048726666F1C5E019FEAA9DA8278F1DF6FF62DA33961891D2A" OR sha256="39CFDE7D401EFCE4F550E0A9461F5FC4D71FA07235E1336E4F0B4882BD76550E" OR sha256="3D9E83B189FCF5C3541C62D1F54A0DA0A4E5B62C3243D2989AFC46644056C8E3" OR sha256="3F2FDA9A7A9C57B7138687BBCE49A2E156D6095DDDABB3454EA09737E02C3FA5" OR sha256="47F0CDAA2359A63AD1389EF4A635F1F6EEE1F63BDF6EF177F114BDCDADC2E005" OR sha256="50D5EAA168C077CE5B7F15B3F2C43BD2B86B07B1E926C1B332F8CB13BD2E0793" OR sha256="56A3C9AC137D862A85B4004F043D46542A1B61C6ACB438098A9640469E2D80E7" OR sha256="591BD5E92DFA0117B3DAA29750E73E2DB25BAA717C31217539D30FFB1F7F3A52" OR sha256="5D530E111400785D183057113D70623E17AF32931668AB7C7FC826F0FD4F91A3" OR sha256="6F1FF29E2E710F6D064DC74E8E011331D807C32CC2A622CBE507FD4B4D43F8F4" OR sha256="79E2D37632C417138970B4FEBA91B7E10C2EA251C5EFE3D1FC6FA0190F176B57" OR sha256="85866E8C25D82C1EC91D7A8076C7D073CCCF421CF57D9C83D80D63943A4EDD94" OR sha256="89B0017BC30CC026E32B758C66A1AF88BD54C6A78E11EC2908FF854E00AC46BE" OR sha256="9254F012009D55F555418FF85F7D93B184AB7CB0E37AECDFDAB62CFE94DEA96B" OR sha256="984A77E5424C6D099051441005F2938AE92B31B5AD8F6521C6B001932862ADD7" OR sha256="98B734DDA78C16EBCAA4AFEB31007926542B63B2F163B2F733FA0D00DBB344D8" OR sha256="99F4994A0E5BD1BF6E3F637D3225C69FF4CD620557E23637533E7F18D7D6CBA1" OR sha256="9C10E2EC4F9EF591415F9A784B93DC9C9CDAFA7C69602C0DC860C5B62222E449" OR sha256="A961F5939088238D76757669A9A81905E33F247C9C635B908DAAC146AE063499" OR sha256="A9706E320179993DADE519A83061477ACE195DAA1B788662825484813001F526" OR sha256="B7A20B5F15E1871B392782C46EBCC897929443D82073EE4DCB3874B6A5976B5D" OR sha256="CC586254E9E89E88334ADEE44E332166119307E79C2F18F6C2AB90CE8BA7FC9B" OR sha256="CD4A249C3EF65AF285D0F8F30A8A96E83688486AAB515836318A2559757A89BB" OR sha256="CF4B5FA853CE809F1924DF3A3AE3C4E191878C4EA5248D8785DC7E51807A512B" OR sha256="D0BD1AE72AEB5F3EABF1531A635F990E5EAAE7FDD560342F915F723766C80889" OR sha256="D8B58F6A89A7618558E37AFC360CD772B6731E3BA367F8D58734ECEE2244A530" OR sha256="D92EAB70BCECE4432258C9C9A914483A2267F6AB5CE2630048D3A99E8CB1B482" OR sha256="E005E8D183E853A27AD3BB56F25489F369C11B0D47E3D4095AAD9291B3343BF1" OR sha256="E68D453D333854787F8470C8BAEF3E0D082F26DF5AA19C0493898BCF3401E39A" OR sha256="E83908EBA2501A00EF9E74E7D1C8B4FF1279F1CD6051707FD51824F87E4378FA" OR sha256="EF86C4E5EE1DBC4F81CD864E8CD2F4A2A85EE4475B9A9AB698A4AE1CC71FBEB0" OR sha256="F088B2BA27DACD5C28F8EE428F1350DCA4BC7C6606309C287C801B2E1DA1A53D" OR sha256="FD8669794C67B396C12FC5F08E9C004FDF851A82FAF302846878173E4FBECB03" OR sha256="91314768DA140999E682D2A290D48B78BB25A35525EA12C1B1F9634D14602B2C" OR sha256="F0605DDA1DEF240DC7E14EFA73927D6C6D89988C01EA8647B671667B2B167008" OR sha256="6CB51AE871FBD5D07C5AAD6FF8EEA43D34063089528603CA9CEB8B4F52F68DDC" OR sha256="DB2A9247177E8CDD50FE9433D066B86FFD2A84301AA6B2EB60F361CFFF077004" OR sha256="7EC93F34EB323823EB199FBF8D06219086D517D0E8F4B9E348D7AFD41EC9FD5D" OR sha256="7049F3C939EFE76A5556C2A2C04386DB51DAF61D56B679F4868BB0983C996EBB" OR sha256="7877C1B0E7429453B750218CA491C2825DAE684AD9616642EFF7B41715C70ACA" OR sha256="159E7C5A12157AF92E0D14A0D3EA116F91C09E21A9831486E6DC592C93C10980" OR sha256="3243AAB18E273A9B9C4280A57AECEF278E10BFFF19ABB260D7A7820E41739099" OR sha256="7CFA5E10DFF8A99A5D544B011F676BC383991274C693E21E3AF40CF6982ADB8C" OR sha256="C9B49B52B493B53CD49C12C3FA9553E57C5394555B64E32D1208F5B96A5B8C6E" OR sha256="3EC5AD51E6879464DFBCCB9F4ED76C6325056A42548D5994BA869DA9C4C039A8" OR sha256="47EAEBC920CCF99E09FC9924FEB6B19B8A28589F52783327067C9B09754B5E84" OR sha256="80599708ce61ec5d6dcfc5977208a2a0be2252820a88d9ba260d8cdf5dc7fbe4" OR sha256="9091e044273ff624585235ac885eb2b05dfb12f3022dcf535b178ff1b2e012d1" OR sha256="01aa278b07b58dc46c84bd0b1b5c8e9ee4e62ea0bf7a695862444af32e87f1fd" OR sha256="ddbf5ecca5c8086afde1fb4f551e9e6400e94f4428fe7fb5559da5cffa654cc1" OR sha256="0296e2ce999e67c76352613a718e11516fe1b0efc3ffdb8918fc999dd76a73a5" OR sha256="ded2927f9a4e64eefd09d0caba78e94f309e3a6292841ae81d5528cab109f95d" OR sha256="41cceace9751dce2b6ecaedc9a2d374fbb6458cf93b00a1dcd634ad0bc54ef89" OR sha256="58a74dceb2022cd8a358b92acd1b48a5e01c524c3b0195d7033e4bd55eff4495" OR sha256="11bd2c9f9e2397c9a16e0990e4ed2cf0679498fe0fd418a3dfdac60b5c160ee5" OR sha256="cf3a7d4285d65bf8688215407bce1b51d7c6b22497f09021f0fce31cbeb78986" OR sha256="31f4cfb4c71da44120752721103a16512444c13c2ac2d857a7e6f13cb679b427" OR sha256="22be050955347661685a4343c51f11c7811674e030386d2264cd12ecbf544b7c" OR sha256="70211a3f90376bbc61f49c22a63075d1d4ddd53f0aefa976216c46e6ba39a9f4" OR sha256="1aaf4c1e3cb6774857e2eef27c17e68dc1ae577112e4769665f516c2e8c4e27b" OR sha256="e6056443537d4d2314dabca1b9168f1eaaf17a14eb41f6f5741b6b82b3119790" OR sha256="76660e91f1ff3cb89630df5af4fe09de6098d09baa66b1a130c89c3c5edd5b22" OR sha256="6c7120e40fc850e4715058b233f5ad4527d1084a909114fd6a36b7b7573c4a44" OR sha256="2e6b339597a89e875f175023ed952aaac64e9d20d457bbc07acf1586e7fe2df8" OR sha256="71fe5af0f1564dc187eea8d59c0fbc897712afa07d18316d2080330ba17cf009" OR sha256="39937d239220c1b779d7d55613de2c0a48bd6e12e0214da4c65992b96cf591df" OR sha256="7ed26a593524a2a92ffcfb075a42bb4fa4775ffbf83af98525244a4710886ead" OR sha256="aa717e9ab4d614497df19f602d289a6eddcdba8027c71bcc807780a219347d16" OR sha256="ff5f6048a3d6f6738b60e911e3876fcbdc9a02ec9862f909345c8a50fd4cc0a7" OR sha256="952199C28332BC90CFD74530A77EE237967ED32B3C71322559C59F7A42187DC4" OR sha256="9529EFB1837B1005E5E8F477773752078E0A46500C748BC30C9B5084D04082E6" OR sha256="A7B000ABBCC344444A9B00CFADE7AA22AB92CE0CADEC196C30EB1851AE4FA062" OR sha256="4429f32db1cc70567919d7d47b844a91cf1329a6cd116f582305f3b7b60cd60b" OR sha256="01e024cb14b34b6d525c642a710bfa14497ea20fd287c39ba404b10a8b143ece" OR sha256="9fc29480407e5179aa8ea41682409b4ea33f1a42026277613d6484e5419de374" OR sha256="06bda5a1594f7121acd2efe38ccb617fbc078bb9a70b665a5f5efd70e3013f50" OR sha256="cbb8239a765bf5b2c1b6a5c8832d2cab8fef5deacadfb65d8ed43ef56d291ab6" OR sha256="d205286bffdf09bc033c09e95c519c1c267b40c2ee8bab703c6a2d86741ccd3e" OR sha256="a7c2e7910942dd5e43e2f4eb159bcd2b4e71366e34a68109548b9fb12ac0f7cc" OR sha256="2003b478b9fd1b3d76ec5bf4172c2e8915babbbee7ad1783794acbf8d4c2519d" OR sha256="f929bead59e9424ab90427b379dcdd63fbfe0c4fb5e1792e3a1685541cd5ec65" OR sha256="59626cac380d8fe0b80a6d4c4406d62ba0683a2f0f68d50ad506ca1b1cf25347" OR sha256="552f70374715e70c4ade591d65177be2539ec60f751223680dfaccb9e0be0ed9" OR sha256="86a8e0aa29a5b52c84921188cc1f0eca9a7904dcfe09544602933d8377720219" OR sha256="1d0397c263d51e9fc95bcc8baf98d1a853e1c0401cd0e27c7bf5da3fba1c93a8" OR sha256="60c6f4f34c7319cb3f9ca682e59d92711a05a2688badbae4891b1303cd384813" OR sha256="55fee54c0d0d873724864dc0b2a10b38b7f40300ee9cae4d9baaf8a202c4049a" OR sha256="42f0b036687cbd7717c9efed6991c00d4e3e7b032dc965a2556c02177dfdad0f" OR sha256="bb1135b51acca8348d285dc5461d10e8f57260e7d0c8cc4a092734d53fc40cbc" OR sha256="b179e1ab6dc0b1aee783adbcad4ad6bb75a8a64cb798f30c0dd2ee8aaf43e6de" OR sha256="314384b40626800b1cde6fbc51ebc7d13e91398be2688c2a58354aa08d00b073" OR sha256="65db1b259e305a52042e07e111f4fa4af16542c8bacd33655f753ef642228890" OR sha256="19a212e6fc324f4cb9ee5eba60f5c1fc0191799a4432265cbeaa3307c76a7fc0" OR sha256="a7c8f4faf3cbb088cac7753d81f8ec4c38ccb97cd9da817741f49272e8d01200" OR sha256="677c0b1add3990fad51f492553d3533115c50a242a919437ccb145943011d2bf" OR sha256="fc22977ff721b3d718b71c42440ee2d8a144f3fbc7755e4331ddd5bcc65158d2" OR sha256="ad40e6d0f77c0e579fb87c5106bf6de3d1a9f30ee2fbf8c9c011f377fa05f173" OR sha256="18e1707b319c279c7e0204074088cc39286007a1cf6cb6e269d5067d8d0628c6" OR sha256="c9cf1d627078f63a36bbde364cd0d5f2be1714124d186c06db5bcdf549a109f8" OR sha256="afdd66562dea51001c3a9de300f91fc3eb965d6848dfce92ccb9b75853e02508" OR sha256="a899b659b08fbae30b182443be8ffb6a6471c1d0497b52293061754886a937a3" OR sha256="1963d5a0e512b72353953aadbe694f73a9a576f0241a988378fa40bf574eda52" OR sha256="7133a461aeb03b4d69d43f3d26cd1a9e3ee01694e97a0645a3d8aa1a44c39129" OR sha256="32e1a8513eee746d17eb5402fb9d8ff9507fb6e1238e7ff06f7a5c50ff3df993" OR sha256="082c39fe2e3217004206535e271ebd45c11eb072efde4cc9885b25ba5c39f91d" OR sha256="65329dad28e92f4bcc64de15c552b6ef424494028b18875b7dba840053bc0cdd" OR sha256="f8430bdc6fd01f42217d66d87a3ef6f66cb2700ebb39c4f25c8b851858cc4b35" OR sha256="9f1229cd8dd9092c27a01f5d56e3c0d59c2bb9f0139abf042e56f343637fda33" OR sha256="b03f26009de2e8eabfcf6152f49b02a55c5e5d0f73e01d48f5a745f93ce93a29" OR sha256="3943a796cc7c5352aa57ccf544295bfd6fb69aae147bc8235a00202dc6ed6838" OR sha256="3c5bf92c26398695f9ced7ce647a7e9f6ddcc89eea66b45aa3607196a187431b" OR sha256="478917514be37b32d5ccf76e4009f6f952f39f5553953544f1b0688befd95e82" OR sha256="4ed2d2c1b00e87b926fb58b4ea43d2db35e5912975f4400aa7bd9f8c239d08b7" OR sha256="b205835b818d8a50903cf76936fcf8160060762725bd74a523320cfbd091c038" OR sha256="ab8f2217e59319b88080e052782e559a706fa4fb7b8b708f709ff3617124da89" OR sha256="73327429c505d8c5fd690a8ec019ed4fd5a726b607cabe71509111c7bfe9fc7e" OR sha256="87e38e7aeaaaa96efe1a74f59fca8371de93544b7af22862eb0e574cec49c7c3" OR sha256="2270a8144dabaf159c2888519b11b61e5e13acdaa997820c09798137bded3dd6" OR sha256="43ba8d96d5e8e54cab59d82d495eeca730eeb16e4743ed134cdd495c51a4fc89" OR sha256="e1980c6592e6d2d92c1a65acad8f1071b6a404097bb6fcce494f3c8ac31385cf" OR sha256="1dadd707c55413a16320dc70d2ca7784b94c6658331a753b3424ae696c5d93ea" OR sha256="d84e3e250a86227c64a96f6d5ac2b447674ba93d399160850acb2339da43eae5" OR sha256="5ae23f1fcf3fb735fcf1fa27f27e610d9945d668a149c7b7b0c84ffd6409d99a" OR sha256="0f726d8ce21c0c9e01ebe6b55913c519ad6086bcaec1a89f8308f3effacd435f" OR sha256="95d50c69cdbf10c9c9d61e64fe864ac91e6f6caa637d128eb20e1d3510e776d3" OR sha256="0e14a4401011a9f4e444028ac5b1595da34bbbf9af04a00670f15ff839734003" OR sha256="26c86227d3f387897c1efd77dc711eef748eb90be84149cb306e3d4c45cc71c7" OR sha256="42d926cfb3794f9b1e3cb397498696cb687f505e15feb9df11b419c49c9af498" OR sha256="1684e24dae20ab83ab5462aa1ff6473110ec53f52a32cfb8c1fe95a2642c6d22" OR sha256="9b6a84f7c40ea51c38cc4d2e93efb3375e9d98d4894a85941190d94fbe73a4e4" OR sha256="440883cd9d6a76db5e53517d0ec7fe13d5a50d2f6a7f91ecfc863bc3490e4f5c" OR sha256="e05eeb2b8c18ad2cb2d1038c043d770a0d51b96b748bc34be3e7fc6f3790ce53" OR sha256="3a364a7a3f6c0f2f925a060e84fb18b16c118125165b5ea6c94363221dc1b6de" OR sha256="fda506e2aa85dc41a4cbc23d3ecc71ab34e06f1def736e58862dc449acbc2330" OR sha256="3ac5e01689a3d745e60925bc7faca8d4306ae693e803b5e19c94906dc30add46" OR sha256="175eed7a4c6de9c3156c7ae16ae85c554959ec350f1c8aaa6dfe8c7e99de3347" OR sha256="8596ea3952d84eeef8f5dc5b0b83014feb101ec295b2d80910f21508a95aa026" OR sha256="52a90fd1546c068b92add52c29fbb8a87d472a57e609146bbcb34862f9dcec15" OR sha256="543991ca8d1c65113dff039b85ae3f9a87f503daec30f46929fd454bc57e5a91" OR sha256="e75714f8e0ff45605f6fc7689a1a89c7dcd34aab66c6131c63fefaca584539cf" OR sha256="1aaa9aef39cb3c0a854ecb4ca7d3b213458f302025e0ec5bfbdef973cca9111c" OR sha256="cc687fe3741bbde1dd142eac0ef59fd1d4457daee43cdde23bb162ef28d04e64" OR sha256="3ed15a390d8dfbd8a8fb99e8367e19bfd1cced0e629dfe43ccdb46c863394b59" OR sha256="8c95d28270a4a314299cf50f05dcbe63033b2a555195d2ad2f678e09e00393e6" OR sha256="eea53103e7a5a55dc1df79797395a2a3e96123ebd71cdd2db4b1be80e7b3f02b" OR sha256="37c637a74bf20d7630281581a8fae124200920df11ad7cd68c14c26cc12c5ec9" OR sha256="32cccc4f249499061c0afa18f534c825d01034a1f6815f5506bf4c4ff55d1351" OR sha256="c5050a2017490fff7aa53c73755982b339ddb0fd7cef2cde32c81bc9834331c5" OR sha256="ff803017d1acafde6149fe7d463aee23b1c4f6f3b97c698c05f3ca6f07e4df6c" OR sha256="000547560fea0dd4b477eb28bf781ea67bf83c748945ce8923f90fdd14eb7a4b" OR sha256="0af5ccb3d33a9ba92071c9637be6254030d61998733a5eb3583e865e17844e05" OR sha256="a13054f349b7baa8c8a3fcbd31789807a493cc52224bbff5e412eb2bd52a6433" OR sha256="da6ca1fb539f825ca0f012ed6976baf57ef9c70143b7a1e88b4650bf7a925e24" OR sha256="9c2977d63faa340b03e1bbfb8a6db19c0adfa60ff6579b888ece10022c94c3ec" OR sha256="771a8d05f1af6214e0ef0886662be500ee910ab99f0154227067fddcfe08a3dd" OR sha256="927c2a580d51a598177fa54c65e9d2610f5f212f1b6cb2fbf2740b64368f010a" OR sha256="42851a01469ba97cdc38939b10cf9ea13237aa1f6c37b1ac84904c5a12a81fa0" OR sha256="e6db8a1c9d82d18b948c7135439fdeaa9bc02ea97509e3534de65e5481489220" OR sha256="1062211314088012edb9fe65780e35e7b3144ac45021269fc993ef2931c8584b" OR sha256="029dbf6d8dc920a32b3c7a2057513d3741b20b7f6e7aa23b113859a8049214df" OR sha256="1d053020079124ac526d84affb17bf4a1563ecd872c83b4b6299c9aa6a732557" OR sha256="c059f1b2b73ecab48d62f469d48dbde74a80c4ada07f0bd3b417ec4e044fb522" OR sha256="a66d2fb7ef7350ea74d4290c57fb62bc59c6ea93f759d4ca93c3febca7aeb512" OR sha256="5d712d3fad791bdc67502ed7c6586ca39d12ae26c7b245c36effec92e3cda08e" OR sha256="e61004335dfe7349f2b2252baa1e111fb47c0f2d6c78a060502b6fcc92f801e4" OR sha256="7c0f77d103015fc29379ba75d133dc3450d557b0ba1f7495c6b43447abdae230" OR sha256="97363f377aaf3c01641ac04a15714acbec978afb1219ac8f22c7e5df7f2b2d56" OR sha256="8e6363a6393eb4234667c6f614b2072e33512866b3204f8395bbe01530d63f2f" OR sha256="09b0e07af8b17db1d896b78da4dd3f55db76738ee1f4ced083a97d737334a184" OR sha256="2a4f4400402cdc475d39389645ca825bb0e775c3ecb7c527e30c5be44e24af7d" OR sha256="5f69d6b167a1eeca3f6ac64785c3c01976ee7303171faf998d65852056988683" OR sha256="f877296e8506e6a1acbdacdc5085b18c6842320a2775a329d286bac796f08d54" OR sha256="2d2c7ee9547738a8a676ab785c151e8b48ed40fe7cf6174650814c7f5f58513b" OR sha256="1ae328c88cf49072c125f41b16c2a2063203b21164245e2850ca491bdd4a522e" OR sha256="84b4e202c6ce1b08cda1b5e7cd3c3b073155120d80141b2055a1a98a4a18dc42" OR sha256="0ea78cb430fbf8ef4c9f3d1eadf2b057939081b1367bc6610e918fa3c6d8920c" OR sha256="a2571531c6b384003bad06003be01e75fcd489b7b2d04c3d072b10f08f50b33b" OR sha256="4d07f9ecd2540218194874427155a4dc82613574672b55257a321f80e7c9f219" OR sha256="6d14ae56e140c02f5d1e6df5351b87ac0f4b7e9dc5a3d778a1e399cb7878802a" OR sha256="c4310708ee81058286be30db1b1d93deab62a37eaa7974750a7ffbe798eed747" OR sha256="d3d88be19bbb889af859c6189b0750a4e527891f95b0dd2e33cb987ec9784f34" OR sha256="3313e8d7f276a48fbc9cbdb5bcd013fd79a674da6638327c6342a5c5a3bfa893")))) | eval sigma_attack_tags="attack.privilege_escalation attack.t1543.003 attack.t1068" | eval sigma_title="Vulnerable Driver Load" | eval sigma_description="Detects the load of known vulnerable drivers by hash value"
dispatch.earliest_time = -24h@h
alert.track = 0

[Vulnerable GIGABYTE Driver Load - sysmon]
description = Detects the load of a signed and vulnerable GIGABYTE driver often used by threat actors or malware for privilege escalation
search = index=sysmon* ((((EventCode="6" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Hashes="*MD5=9AB9F3B75A2EB87FAFB1B7361BE9DFB3*" OR Hashes="*MD5=C832A4313FF082258240B61B88EFA025*" OR Hashes="*SHA1=FE10018AF723986DB50701C8532DF5ED98B17C39*" OR Hashes="*SHA1=1F1CE28C10453ACBC9D3844B4604C59C0AB0AD46*" OR Hashes="*SHA256=31F4CFB4C71DA44120752721103A16512444C13C2AC2D857A7E6F13CB679B427*" OR Hashes="*SHA256=CFC5C585DD4E592DD1A08887DED28B92D9A5820587B6F4F8FA4F56D60289259B*") OR (md5="9ab9f3b75a2eb87fafb1b7361be9dfb3" OR md5="c832a4313ff082258240b61b88efa025") OR (sha1="fe10018af723986db50701c8532df5ed98b17c39" OR sha1="1f1ce28c10453acbc9d3844b4604c59c0ab0ad46") OR (sha256="31f4cfb4c71da44120752721103a16512444c13c2ac2d857a7e6f13cb679b427" OR sha256="cfc5c585dd4e592dd1a08887ded28b92d9a5820587b6f4f8fa4f56d60289259b")))) | eval sigma_attack_tags="attack.privilege_escalation attack.t1543.003" | eval sigma_title="Vulnerable GIGABYTE Driver Load" | eval sigma_description="Detects the load of a signed and vulnerable GIGABYTE driver often used by threat actors or malware for privilege escalation"
dispatch.earliest_time = -24h@h
alert.track = 0

[Vulnerable HackSys Extreme Vulnerable Driver Load - sysmon]
description = Detects the load of HackSys Extreme Vulnerable Driver which is an intentionally vulnerable Windows driver developed for security enthusiasts to learn and polish their exploitation skills at Kernel level and often abused by threat actors
search = index=sysmon* ((((EventCode="6" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (ImageLoaded="*\\HEVD.sys" OR (Hashes="*IMPHASH=f26d0b110873a1c7d8c4f08fbeab89c5*" OR Hashes="*IMPHASH=c46ea2e651fd5f7f716c8867c6d13594*") OR (Imphash="f26d0b110873a1c7d8c4f08fbeab89c5" OR Imphash="c46ea2e651fd5f7f716c8867c6d13594")))) | eval sigma_attack_tags="attack.privilege_escalation attack.t1543.003" | eval sigma_title="Vulnerable HackSys Extreme Vulnerable Driver Load" | eval sigma_description="Detects the load of HackSys Extreme Vulnerable Driver which is an intentionally vulnerable Windows driver developed for security enthusiasts to learn and polish their exploitation skills at Kernel level and often abused by threat actors"
dispatch.earliest_time = -24h@h
alert.track = 0

[Vulnerable HW Driver Load - sysmon]
description = Detects the load of a legitimate signed driver named HW.sys by often used by threat actors or malware for privilege escalation
search = index=sysmon* ((((EventCode="6" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (ImageLoaded="*\\HW.sys" OR (Hashes="*SHA256=4880F40F2E557CFF38100620B9AA1A3A753CB693AF16CD3D95841583EDCB57A8*" OR Hashes="*SHA256=55963284BBD5A3297F39F12F0D8A01ED99FE59D008561E3537BCD4DB4B4268FA*" OR Hashes="*SHA256=6A4875AE86131A594019DEC4ABD46AC6BA47E57A88287B814D07D929858FE3E5*" OR Hashes="*SHA1=74E4E3006B644392F5FCEA4A9BAE1D9D84714B57*" OR Hashes="*SHA1=18F34A0005E82A9A1556BA40B997B0EAE554D5FD*" OR Hashes="*SHA1=4E56E0B1D12664C05615C69697A2F5C5D893058A*" OR Hashes="*MD5=3247014BA35D406475311A2EAB0C4657*" OR Hashes="*MD5=376B1E8957227A3639EC1482900D9B97*" OR Hashes="*MD5=45C2D133D41D2732F3653ED615A745C8*") OR (sha256="4880f40f2e557cff38100620b9aa1a3a753cb693af16cd3d95841583edcb57a8" OR sha256="55963284bbd5a3297f39f12f0d8a01ed99fe59d008561e3537bcd4db4b4268fa" OR sha256="6a4875ae86131a594019dec4abd46ac6ba47e57a88287b814d07d929858fe3e5") OR (sha1="74e4e3006b644392f5fcea4a9bae1d9d84714b57" OR sha1="18f34a0005e82a9a1556ba40b997b0eae554d5fd" OR sha1="4e56e0b1d12664c05615c69697a2f5c5d893058a") OR (md5="3247014ba35d406475311a2eab0c4657" OR md5="376b1e8957227a3639ec1482900d9b97" OR md5="45c2d133d41d2732f3653ed615a745c8")))) | eval sigma_attack_tags="attack.privilege_escalation attack.t1543.003" | eval sigma_title="Vulnerable HW Driver Load" | eval sigma_description="Detects the load of a legitimate signed driver named HW.sys by often used by threat actors or malware for privilege escalation"
dispatch.earliest_time = -24h@h
alert.track = 0

[Vulnerable Lenovo Driver Load - sysmon]
description = Detects the load of the vulnerable Lenovo driver as reported in CVE-2022-3699 which can be used to escalate privileges
search = index=sysmon* ((((EventCode="6" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Hashes="*SHA256=F05B1EE9E2F6AB704B8919D5071BECBCE6F9D0F9D0BA32A460C41D5272134ABE*" OR Hashes="*SHA1=B89A8EEF5AEAE806AF5BA212A8068845CAFDAB6F*" OR Hashes="*MD5=B941C8364308990EE4CC6EADF7214E0F*") OR sha256="f05b1ee9e2f6ab704b8919d5071becbce6f9d0f9d0ba32a460c41d5272134abe" OR sha1="b89a8eef5aeae806af5ba212a8068845cafdab6f" OR md5="b941c8364308990ee4cc6eadf7214e0f"))) | eval sigma_attack_tags="attack.privilege_escalation cve.2021.21551 attack.t1543" | eval sigma_title="Vulnerable Lenovo Driver Load" | eval sigma_description="Detects the load of the vulnerable Lenovo driver as reported in CVE-2022-3699 which can be used to escalate privileges"
dispatch.earliest_time = -24h@h
alert.track = 0

[Vulnerable WinRing0 Driver Load - sysmon]
description = Detects the load of a signed WinRing0 driver often used by threat actors, crypto miners (XMRIG) or malware for privilege escalation
search = index=sysmon* ((((EventCode="6" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((ImageLoaded="*\\WinRing0x64.sys" OR ImageLoaded="*\\WinRing0.sys" OR ImageLoaded="*\\WinRing0.dll" OR ImageLoaded="*\\WinRing0x64.dll" OR ImageLoaded="*\\winring00x64.sys") OR Hashes="*IMPHASH=D41FA95D4642DC981F10DE36F4DC8CD7*" OR Imphash="d41fa95d4642dc981f10de36f4dc8cd7"))) | eval sigma_attack_tags="attack.privilege_escalation attack.t1543.003" | eval sigma_title="Vulnerable WinRing0 Driver Load" | eval sigma_description="Detects the load of a signed WinRing0 driver often used by threat actors, crypto miners (XMRIG) or malware for privilege escalation"
dispatch.earliest_time = -24h@h
alert.track = 0

[WinDivert Driver Load - sysmon]
description = Detects the load of the Windiver driver, a powerful user-mode capture/sniffing/modification/blocking/re-injection package for Windows
search = index=sysmon* ((((EventCode="6" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((ImageLoaded="*\\WinDivert.sys*" OR ImageLoaded="*\\WinDivert64.sys*" OR ImageLoaded="*\\NordDivert.sys*" OR ImageLoaded="*\\lingtiwfp.sys*" OR ImageLoaded="*\\eswfp.sys*") OR (Hashes="*IMPHASH=0604bb7cb4bb851e2168d5c7d9399087*" OR Hashes="*IMPHASH=2e5f0e649d97f32b03c09e4686d0574f*" OR Hashes="*IMPHASH=52f8aa269f69f0edad9e8fcdaedce276*" OR Hashes="*IMPHASH=c0e5d314da39dbf65a2dbff409cc2c76*" OR Hashes="*IMPHASH=58623490691babe8330adc81cd04a663*" OR Hashes="*IMPHASH=8ee39b48656e4d6b8459d7ba7da7438b*" OR Hashes="*IMPHASH=45ee545ae77e8d43fc70ede9efcd4c96*" OR Hashes="*IMPHASH=a1b2e245acd47e4a348e1a552a02859a*" OR Hashes="*IMPHASH=2a5f85fe4609461c6339637594fa9b0a*" OR Hashes="*IMPHASH=6b2c6f95233c2914d1d488ee27531acc*" OR Hashes="*IMPHASH=9f2fdd3f9ab922bbb0560a7df46f4342*" OR Hashes="*IMPHASH=d8a719865c448b1bd2ec241e46ac1c88*" OR Hashes="*IMPHASH=0ea54f8c9af4a2fe8367fa457f48ed38*" OR Hashes="*IMPHASH=9d519ae0a0864d6d6ae3f8b6c9c70af6*" OR Hashes="*IMPHASH=a74929edfc3289895e3f2885278947ae*" OR Hashes="*IMPHASH=a66b476c2d06c370f0a53b5537f2f11e*" OR Hashes="*IMPHASH=bdcd836a46bc2415773f6b5ea77a46e4*" OR Hashes="*IMPHASH=c28cd6ccd83179e79dac132a553693d9*") OR (Imphash="0604bb7cb4bb851e2168d5c7d9399087" OR Imphash="2e5f0e649d97f32b03c09e4686d0574f" OR Imphash="52f8aa269f69f0edad9e8fcdaedce276" OR Imphash="c0e5d314da39dbf65a2dbff409cc2c76" OR Imphash="58623490691babe8330adc81cd04a663" OR Imphash="8ee39b48656e4d6b8459d7ba7da7438b" OR Imphash="45ee545ae77e8d43fc70ede9efcd4c96" OR Imphash="a1b2e245acd47e4a348e1a552a02859a" OR Imphash="2a5f85fe4609461c6339637594fa9b0a" OR Imphash="6b2c6f95233c2914d1d488ee27531acc" OR Imphash="9f2fdd3f9ab922bbb0560a7df46f4342" OR Imphash="d8a719865c448b1bd2ec241e46ac1c88" OR Imphash="0ea54f8c9af4a2fe8367fa457f48ed38" OR Imphash="9d519ae0a0864d6d6ae3f8b6c9c70af6" OR Imphash="a74929edfc3289895e3f2885278947ae" OR Imphash="a66b476c2d06c370f0a53b5537f2f11e" OR Imphash="bdcd836a46bc2415773f6b5ea77a46e4" OR Imphash="c28cd6ccd83179e79dac132a553693d9")))) | eval sigma_attack_tags="attack.collection attack.defense_evasion attack.t1599.001 attack.t1557.001" | eval sigma_title="WinDivert Driver Load" | eval sigma_description="Detects the load of the Windiver driver, a powerful user-mode capture/sniffing/modification/blocking/re-injection package for Windows"
dispatch.earliest_time = -24h@h
alert.track = 0

[Abusing Azure Browser SSO - sysmon]
description = Detects abusing Azure Browser SSO by requesting OAuth 2.0 refresh tokens for an Azure-AD-authenticated Windows user (i.e. the machine is joined to Azure AD and a user logs in with their Azure AD account)
wanting to perform SSO authentication in the browser.
An attacker can use this to authenticate to Azure AD in a browser as that user.

search = index=sysmon* ((((EventCode="7" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ImageLoaded="*MicrosoftAccountTokenProvider.dll" NOT (((Image="*\\BackgroundTaskHost.exe" OR Image="*\\devenv.exe" OR Image="*\\iexplore.exe" OR Image="*\\MicrosoftEdge.exe" OR Image="*\\Microsoft\\Edge\\Application\\msedge.exe" OR Image="*\\AppData\\Local\\Microsoft\\OneDrive\\OneDrive.exe" OR Image="*\\msedgewebview2.exe" OR Image="*\\OneDrive.exe")) OR (Image="C:\\Program Files (x86)\\Microsoft\\EdgeWebView\\Application\\*") OR (NOT Image="*")))) | eval sigma_attack_tags="attack.defense_evasion attack.privilege_escalation attack.t1574.002" | eval sigma_title="Abusing Azure Browser SSO" | eval sigma_description="Detects abusing Azure Browser SSO by requesting OAuth 2.0 refresh tokens for an Azure-AD-authenticated Windows user (i.e. the machine is joined to Azure AD and a user logs in with their Azure AD account)
wanting to perform SSO authentication in the browser.
An attacker can use this to authenticate to Azure AD in a browser as that user.
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Alternate PowerShell Hosts - Image - sysmon]
description = Detects alternate PowerShell hosts potentially bypassing detections looking for powershell.exe
search = index=sysmon* ((((EventCode="7" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Description="System.Management.Automation" ImageLoaded="*System.Management.Automation*")) NOT ((((Image="*\\powershell.exe" OR Image="*\\mscorsvw.exe")) OR ((Image="C:\\Program Files (x86)\\Microsoft Visual Studio\\*" OR Image="C:\\Program Files\\Microsoft Visual Studio\\*" OR Image="C:\\Windows\\System32\\*" OR Image="C:\\Program Files\\Citrix\\ConfigSync\\*")) OR (Image="C:\\Program Files\\PowerShell\\7\\pwsh.exe")) OR ((NOT Image="*"))))) | eval sigma_attack_tags="attack.execution attack.t1059.001" | eval sigma_title="Alternate PowerShell Hosts - Image" | eval sigma_description="Detects alternate PowerShell hosts potentially bypassing detections looking for powershell.exe"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential DCOM InternetExplorer.Application DLL Hijack - Image Load - sysmon]
description = Detects potential DLL hijack of 'iertutil.dll' found in the DCOM InternetExplorer.Application Class
search = index=sysmon* ((EventCode="7" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\Internet Explorer\\iexplore.exe" ImageLoaded="*\\Internet Explorer\\iertutil.dll")) | eval sigma_attack_tags="attack.lateral_movement attack.t1021.002 attack.t1021.003" | eval sigma_title="Potential DCOM InternetExplorer.Application DLL Hijack - Image Load" | eval sigma_description="Detects potential DLL hijack of 'iertutil.dll' found in the DCOM InternetExplorer.Application Class"
dispatch.earliest_time = -24h@h
alert.track = 0

[Microsoft Defender Loading DLL from Nondefault Path - sysmon]
description = Detects loading of Microsoft Defender's DLLs by its processes (MpCmdRun and NisSrv) from the non-default directory which may be an attempt to sideload arbitrary DLL
search = index=sysmon* ((((EventCode="7" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((Image="*\\MpCmdRun.exe" OR Image="*\\NisSrv.exe") ImageLoaded="*\\mpclient.dll")) NOT (((ImageLoaded="C:\\Program Files\\Windows Defender\\*" OR ImageLoaded="C:\\Program Files (x86)\\Windows Defender\\*" OR ImageLoaded="C:\\ProgramData\\Microsoft\\Windows Defender\\Platform\\*"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1574.002" | eval sigma_title="Microsoft Defender Loading DLL from Nondefault Path" | eval sigma_description="Detects loading of Microsoft Defender's DLLs by its processes (MpCmdRun and NisSrv) from the non-default directory which may be an attempt to sideload arbitrary DLL"
dispatch.earliest_time = -24h@h
alert.track = 0

[FoggyWeb Backdoor DLL Loading - sysmon]
description = Detects DLL hijacking technique used by NOBELIUM in their FoggyWeb backdoor. Which loads a malicious version of the expected 'version.dll' dll
search = index=sysmon* ((EventCode="7" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") ImageLoaded="C:\\Windows\\ADFS\\version.dll")) | eval sigma_attack_tags="attack.resource_development attack.t1587" | eval sigma_title="FoggyWeb Backdoor DLL Loading" | eval sigma_description="Detects DLL hijacking technique used by NOBELIUM in their FoggyWeb backdoor. Which loads a malicious version of the expected 'version.dll' dll"
dispatch.earliest_time = -24h@h
alert.track = 0

[In-memory PowerShell - sysmon]
description = Detects loading of essential DLL used by PowerShell, but not by the process powershell.exe. Detects meterpreter's 'load powershell' extension.
search = index=sysmon* ((((EventCode="7" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (ImageLoaded="*\\System.Management.Automation.Dll" OR ImageLoaded="*\\System.Management.Automation.ni.Dll") NOT ((((Image="C:\\Windows\\System32\\dsac.exe" OR Image="C:\\Program Files\\PowerShell\\7\\pwsh.exe")) OR ((Image="*\\powershell.exe" OR Image="*\\powershell_ise.exe" OR Image="*\\WINDOWS\\System32\\sdiagnhost.exe" OR Image="*\\mscorsvw.exe" OR Image="*\\WINDOWS\\System32\\RemoteFXvGPUDisablement.exe" OR Image="*\\sqlps.exe" OR Image="*\\wsmprovhost.exe" OR Image="*\\winrshost.exe" OR Image="*\\syncappvpublishingserver.exe" OR Image="*\\runscripthelper.exe" OR Image="*\\ServerManager.exe" OR Image="*\\Microsoft SQL Server Management Studio *\\Common*\\IDE\\Ssms.exe" OR Image="*\\IDE\\devenv.exe" OR Image="*\\ServiceHub.VSDetouredHost.exe" OR Image="*\\ServiceHub.SettingsHost.exe" OR Image="*\\ServiceHub.Host.CLR.x86.exe" OR Image="*\\Citrix\\ConfigSync\\ConfigSyncRun.exe")) OR ((Image="C:\\Program Files (x86)\\Microsoft Visual Studio\\*" OR Image="C:\\Program Files\\Microsoft Visual Studio\\*"))) OR ((Image="C:\\Windows\\Temp\\asgard2-agent\\*" (Image="*\\thor64.exe" OR Image="*\\thor.exe"))) OR ((NOT Image="*"))))) | eval sigma_attack_tags="attack.t1059.001 attack.execution" | eval sigma_title="In-memory PowerShell" | eval sigma_description="Detects loading of essential DLL used by PowerShell, but not by the process powershell.exe. Detects meterpreter's 'load powershell' extension."
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential DLL Sideloading Using Coregen.exe - sysmon]
description = Detect usage of DLL 'coregen.exe' (Microsoft CoreCLR Native Image Generator) binary to sideload arbitrary DLLs.
search = index=sysmon* ((((EventCode="7" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) Image="*\\coregen.exe" NOT (((ImageLoaded="C:\\Windows\\System32\\*" OR ImageLoaded="C:\\Windows\\SysWOW64\\*" OR ImageLoaded="C:\\Program Files\\Microsoft Silverlight\\*" OR ImageLoaded="C:\\Program Files (x86)\\Microsoft Silverlight\\*"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218 attack.t1055" | eval sigma_title="Potential DLL Sideloading Using Coregen.exe" | eval sigma_description="Detect usage of DLL 'coregen.exe' (Microsoft CoreCLR Native Image Generator) binary to sideload arbitrary DLLs."
dispatch.earliest_time = -24h@h
alert.track = 0

[MSDT.exe Loading Diagnostic Library - sysmon]
description = Detects both of CVE-2022-30190 / Follina and DogWalk vulnerability exploiting msdt.exe binary to load sdiageng.dll binary
search = index=sysmon* ((EventCode="7" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\msdt.exe" ImageLoaded="*\\sdiageng.dll")) | eval sigma_attack_tags="attack.defense_evasion attack.t1202 cve.2022.30190" | eval sigma_title="MSDT.exe Loading Diagnostic Library" | eval sigma_description="Detects both of CVE-2022-30190 / Follina and DogWalk vulnerability exploiting msdt.exe binary to load sdiageng.dll binary"
dispatch.earliest_time = -24h@h
alert.track = 0

[PCRE.NET Package Image Load - sysmon]
description = Detects processes loading modules related to PCRE.NET package
search = index=sysmon* ((EventCode="7" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") ImageLoaded="*\\AppData\\Local\\Temp\\ba9ea7344a4a5f591d6e5dc32a13494b\\*")) | eval sigma_attack_tags="attack.execution attack.t1059" | eval sigma_title="PCRE.NET Package Image Load" | eval sigma_description="Detects processes loading modules related to PCRE.NET package"
dispatch.earliest_time = -24h@h
alert.track = 0

[Pingback Backdoor - Image - sysmon]
description = Detects the use of Pingback backdoor that creates ICMP tunnel for C2 as described in the trustwave report
search = index=sysmon* ((EventCode="7" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\msdtc.exe" ImageLoaded="C:\\Windows\\oci.dll")) | eval sigma_attack_tags="attack.persistence attack.t1574.001" | eval sigma_title="Pingback Backdoor - Image" | eval sigma_description="Detects the use of Pingback backdoor that creates ICMP tunnel for C2 as described in the trustwave report"
dispatch.earliest_time = -24h@h
alert.track = 0

[Rundll32 Loading Renamed Comsvcs DLL - sysmon]
description = Detects rundll32 loading a renamed comsvcs.dll to dump process memory
search = index=sysmon* ((((EventCode="7" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\rundll32.exe" (Hashes="*IMPHASH=eed93054cb555f3de70eaa9787f32ebb*" OR Hashes="*IMPHASH=5e0dbdec1fce52daae251a110b4f309d*" OR Hashes="*IMPHASH=eadbccbb324829acb5f2bbe87e5549a8*" OR Hashes="*IMPHASH=407ca0f7b523319d758a40d7c0193699*" OR Hashes="*IMPHASH=281d618f4e6271e527e6386ea6f748de*"))) NOT ((ImageLoaded="*\\comsvcs.dll")))) | eval sigma_attack_tags="attack.credential_access attack.defense_evasion attack.t1003.001" | eval sigma_title="Rundll32 Loading Renamed Comsvcs DLL" | eval sigma_description="Detects rundll32 loading a renamed comsvcs.dll to dump process memory"
dispatch.earliest_time = -24h@h
alert.track = 0

[WMI Script Host Process Image Loaded - sysmon]
description = Detects signs of the WMI script host process %SystemRoot%\system32\wbem\scrcons.exe functionality being used via images being loaded by a process.
search = index=sysmon* ((EventCode="7" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\scrcons.exe" (ImageLoaded="*\\vbscript.dll" OR ImageLoaded="*\\wbemdisp.dll" OR ImageLoaded="*\\wshom.ocx" OR ImageLoaded="*\\scrrun.dll"))) | eval sigma_attack_tags="attack.lateral_movement attack.privilege_escalation attack.persistence attack.t1546.003" | eval sigma_title="WMI Script Host Process Image Loaded" | eval sigma_description="Detects signs of the WMI script host process %SystemRoot%\system32\wbem\scrcons.exe functionality being used via images being loaded by a process."
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential Antivirus Software DLL Sideloading - sysmon]
description = Detects potential DLL sideloading of DLLs that are part of antivirus software suchas McAfee, Symantec...etc
search = index=sysmon* ((((EventCode="7" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((((((ImageLoaded="*\\log.dll" NOT ((((ImageLoaded="C:\\Program Files\\Bitdefender Antivirus Free\\*" OR ImageLoaded="C:\\Program Files (x86)\\Bitdefender Antivirus Free\\*"))) OR ((Image="C:\\Program Files\\Dell\\SARemediation\\audit\\TelemetryUtility.exe" (ImageLoaded="C:\\Program Files\\Dell\\SARemediation\\plugin\\log.dll" OR ImageLoaded="C:\\Program Files\\Dell\\SARemediation\\audit\\log.dll"))) OR ((ImageLoaded="C:\\Program Files\\Canon\\MyPrinter\\*"))))) OR ((ImageLoaded="*\\qrt.dll" NOT (((ImageLoaded="C:\\Program Files\\F-Secure\\Anti-Virus\\*" OR ImageLoaded="C:\\Program Files (x86)\\F-Secure\\Anti-Virus\\*")))))) OR (((ImageLoaded="*\\ashldres.dll" OR ImageLoaded="*\\lockdown.dll" OR ImageLoaded="*\\vsodscpl.dll") NOT (((ImageLoaded="C:\\Program Files\\McAfee\\*" OR ImageLoaded="C:\\Program Files (x86)\\McAfee\\*")))))) OR ((ImageLoaded="*\\vftrace.dll" NOT (((ImageLoaded="C:\\Program Files\\CyberArk\\Endpoint Privilege Manager\\Agent\\x32\\*" OR ImageLoaded="C:\\Program Files (x86)\\CyberArk\\Endpoint Privilege Manager\\Agent\\x32\\*")))))) OR ((ImageLoaded="*\\wsc.dll" NOT (((ImageLoaded="C:\\program Files\\AVAST Software\\Avast\\*" OR ImageLoaded="C:\\program Files (x86)\\AVAST Software\\Avast\\*")))))) OR ((ImageLoaded="*\\tmdbglog.dll" NOT (((ImageLoaded="C:\\program Files\\Trend Micro\\Titanium\\*" OR ImageLoaded="C:\\program Files (x86)\\Trend Micro\\Titanium\\*")))))))) | eval sigma_attack_tags="attack.defense_evasion attack.persistence attack.privilege_escalation attack.t1574.001 attack.t1574.002" | eval sigma_title="Potential Antivirus Software DLL Sideloading" | eval sigma_description="Detects potential DLL sideloading of DLLs that are part of antivirus software suchas McAfee, Symantec...etc"
dispatch.earliest_time = -24h@h
alert.track = 0

[Aruba Network Service Potential DLL Sideloading - sysmon]
description = Detects potential DLL sideloading activity via the Aruba Networks Virtual Intranet Access 'arubanetsvc.exe' process using DLL Search Order Hijacking
search = index=sysmon* ((((EventCode="7" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\arubanetsvc.exe" (ImageLoaded="*\\wtsapi32.dll" OR ImageLoaded="*\\msvcr100.dll" OR ImageLoaded="*\\msvcp100.dll" OR ImageLoaded="*\\dbghelp.dll" OR ImageLoaded="*\\dbgcore.dll" OR ImageLoaded="*\\wininet.dll" OR ImageLoaded="*\\iphlpapi.dll" OR ImageLoaded="*\\version.dll" OR ImageLoaded="*\\cryptsp.dll" OR ImageLoaded="*\\cryptbase.dll" OR ImageLoaded="*\\wldp.dll" OR ImageLoaded="*\\profapi.dll" OR ImageLoaded="*\\sspicli.dll" OR ImageLoaded="*\\winsta.dll" OR ImageLoaded="*\\dpapi.dll"))) NOT (((ImageLoaded="C:\\Windows\\System32\\*" OR ImageLoaded="C:\\Windows\\SysWOW64\\*" OR ImageLoaded="C:\\Windows\\WinSxS\\*"))))) | eval sigma_attack_tags="attack.privilege_escalation attack.persistence attack.t1574.001 attack.t1574.002" | eval sigma_title="Aruba Network Service Potential DLL Sideloading" | eval sigma_description="Detects potential DLL sideloading activity via the Aruba Networks Virtual Intranet Access 'arubanetsvc.exe' process using DLL Search Order Hijacking"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential DLL Sideloading Via ClassicExplorer32.dll - sysmon]
description = Detects potential DLL sideloading using ClassicExplorer32.dll from the Classic Shell software
search = index=sysmon* ((((EventCode="7" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ImageLoaded="*\\ClassicExplorer32.dll" NOT ((ImageLoaded="C:\\Program Files\\Classic Shell\\*")))) | eval sigma_attack_tags="attack.defense_evasion attack.persistence attack.privilege_escalation attack.t1574.001 attack.t1574.002" | eval sigma_title="Potential DLL Sideloading Via ClassicExplorer32.dll" | eval sigma_description="Detects potential DLL sideloading using ClassicExplorer32.dll from the Classic Shell software"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential DLL Sideloading Via comctl32.dll - sysmon]
description = Detects potential DLL sideloading using comctl32.dll to obtain system privileges
search = index=sysmon* ((EventCode="7" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (ImageLoaded="C:\\Windows\\System32\\logonUI.exe.local\\*" OR ImageLoaded="C:\\Windows\\System32\\werFault.exe.local\\*" OR ImageLoaded="C:\\Windows\\System32\\consent.exe.local\\*" OR ImageLoaded="C:\\Windows\\System32\\narrator.exe.local\\*" OR ImageLoaded="C:\\windows\\system32\\wermgr.exe.local\\*") ImageLoaded="*\\comctl32.dll")) | eval sigma_attack_tags="attack.defense_evasion attack.persistence attack.privilege_escalation attack.t1574.001 attack.t1574.002" | eval sigma_title="Potential DLL Sideloading Via comctl32.dll" | eval sigma_description="Detects potential DLL sideloading using comctl32.dll to obtain system privileges"
dispatch.earliest_time = -24h@h
alert.track = 0

[DLL Sideloading Of DBGCORE.DLL - sysmon]
description = Detects DLL sideloading of 'dbgcore.dll'
search = index=sysmon* ((((EventCode="7" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ImageLoaded="*\\dbgcore.dll" NOT ((((ImageLoaded="C:\\Windows\\System32\\*" OR ImageLoaded="C:\\Windows\\SysWOW64\\*" OR ImageLoaded="C:\\Windows\\WinSxS\\*" OR ImageLoaded="C:\\Windows\\SoftwareDistribution\\*" OR ImageLoaded="C:\\Windows\\SystemTemp\\*" OR ImageLoaded="C:\\Program Files (x86)\\*" OR ImageLoaded="C:\\Program Files\\*"))) OR ((ImageLoaded="*\\Steam\\bin\\cef\\cef.win7x64\\dbgcore.dll"))))) | eval sigma_attack_tags="attack.defense_evasion attack.persistence attack.privilege_escalation attack.t1574.001 attack.t1574.002" | eval sigma_title="DLL Sideloading Of DBGCORE.DLL" | eval sigma_description="Detects DLL sideloading of 'dbgcore.dll'"
dispatch.earliest_time = -24h@h
alert.track = 0

[DLL Sideloading Of DBGHELP.DLL - sysmon]
description = Detects DLL sideloading of 'dbghelp.dll'
search = index=sysmon* ((((EventCode="7" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ImageLoaded="*\\dbghelp.dll" NOT ((((ImageLoaded="C:\\Windows\\System32\\*" OR ImageLoaded="C:\\Windows\\SysWOW64\\*" OR ImageLoaded="C:\\Windows\\WinSxS\\*" OR ImageLoaded="C:\\Windows\\SoftwareDistribution\\*" OR ImageLoaded="C:\\Windows\\SystemTemp\\*" OR ImageLoaded="C:\\Program Files (x86)\\*" OR ImageLoaded="C:\\Program Files\\*")) OR ((ImageLoaded="*\\Epic Games\\Launcher\\Engine\\Binaries\\ThirdParty\\DbgHelp\\dbghelp.dll" OR ImageLoaded="*\\Epic Games\\MagicLegends\\x86\\dbghelp.dll" OR ImageLoaded="*\\Anaconda3\\Lib\\site-packages\\vtrace\\platforms\\windll\\amd64\\dbghelp.dll" OR ImageLoaded="*\\Anaconda3\\Lib\\site-packages\\vtrace\\platforms\\windll\\i386\\dbghelp.dll")))))) | eval sigma_attack_tags="attack.defense_evasion attack.persistence attack.privilege_escalation attack.t1574.001 attack.t1574.002" | eval sigma_title="DLL Sideloading Of DBGHELP.DLL" | eval sigma_description="Detects DLL sideloading of 'dbghelp.dll'"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential System DLL Sideloading From Non System Locations - sysmon]
description = Detects DLL sideloading of DLLs usually located in system locations (System32, SysWOW64...)
search = index=sysmon* ((((EventCode="7" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (ImageLoaded="*\\shfolder.dll" OR ImageLoaded="*\\activeds.dll" OR ImageLoaded="*\\adsldpc.dll" OR ImageLoaded="*\\aepic.dll" OR ImageLoaded="*\\apphelp.dll" OR ImageLoaded="*\\applicationframe.dll" OR ImageLoaded="*\\appxalluserstore.dll" OR ImageLoaded="*\\appxdeploymentclient.dll" OR ImageLoaded="*\\archiveint.dll" OR ImageLoaded="*\\atl.dll" OR ImageLoaded="*\\audioses.dll" OR ImageLoaded="*\\auditpolcore.dll" OR ImageLoaded="*\\authfwcfg.dll" OR ImageLoaded="*\\authz.dll" OR ImageLoaded="*\\avrt.dll" OR ImageLoaded="*\\bcd.dll" OR ImageLoaded="*\\bcp47langs.dll" OR ImageLoaded="*\\bcp47mrm.dll" OR ImageLoaded="*\\bcrypt.dll" OR ImageLoaded="*\\cabinet.dll" OR ImageLoaded="*\\cabview.dll" OR ImageLoaded="*\\certenroll.dll" OR ImageLoaded="*\\cldapi.dll" OR ImageLoaded="*\\clipc.dll" OR ImageLoaded="*\\clusapi.dll" OR ImageLoaded="*\\cmpbk32.dll" OR ImageLoaded="*\\coloradapterclient.dll" OR ImageLoaded="*\\colorui.dll" OR ImageLoaded="*\\comdlg32.dll" OR ImageLoaded="*\\connect.dll" OR ImageLoaded="*\\coremessaging.dll" OR ImageLoaded="*\\credui.dll" OR ImageLoaded="*\\cryptbase.dll" OR ImageLoaded="*\\cryptdll.dll" OR ImageLoaded="*\\cryptui.dll" OR ImageLoaded="*\\cryptxml.dll" OR ImageLoaded="*\\cscapi.dll" OR ImageLoaded="*\\cscobj.dll" OR ImageLoaded="*\\cscui.dll" OR ImageLoaded="*\\d2d1.dll" OR ImageLoaded="*\\d3d10.dll" OR ImageLoaded="*\\d3d10_1.dll" OR ImageLoaded="*\\d3d10_1core.dll" OR ImageLoaded="*\\d3d10core.dll" OR ImageLoaded="*\\d3d10warp.dll" OR ImageLoaded="*\\d3d11.dll" OR ImageLoaded="*\\d3d12.dll" OR ImageLoaded="*\\d3d9.dll" OR ImageLoaded="*\\dataexchange.dll" OR ImageLoaded="*\\davclnt.dll" OR ImageLoaded="*\\dcomp.dll" OR ImageLoaded="*\\defragproxy.dll" OR ImageLoaded="*\\desktopshellext.dll" OR ImageLoaded="*\\deviceassociation.dll" OR ImageLoaded="*\\devicecredential.dll" OR ImageLoaded="*\\devicepairing.dll" OR ImageLoaded="*\\devobj.dll" OR ImageLoaded="*\\devrtl.dll" OR ImageLoaded="*\\dhcpcmonitor.dll" OR ImageLoaded="*\\dhcpcsvc.dll" OR ImageLoaded="*\\dhcpcsvc6.dll" OR ImageLoaded="*\\directmanipulation.dll" OR ImageLoaded="*\\dismapi.dll" OR ImageLoaded="*\\dismcore.dll" OR ImageLoaded="*\\dmcfgutils.dll" OR ImageLoaded="*\\dmcmnutils.dll" OR ImageLoaded="*\\dmenrollengine.dll" OR ImageLoaded="*\\dmenterprisediagnostics.dll" OR ImageLoaded="*\\dmiso8601utils.dll" OR ImageLoaded="*\\dmoleaututils.dll" OR ImageLoaded="*\\dmprocessxmlfiltered.dll" OR ImageLoaded="*\\dmpushproxy.dll" OR ImageLoaded="*\\dmxmlhelputils.dll" OR ImageLoaded="*\\dnsapi.dll" OR ImageLoaded="*\\dot3api.dll" OR ImageLoaded="*\\dot3cfg.dll" OR ImageLoaded="*\\drprov.dll" OR ImageLoaded="*\\dsclient.dll" OR ImageLoaded="*\\dsparse.dll" OR ImageLoaded="*\\dsreg.dll" OR ImageLoaded="*\\dsrole.dll" OR ImageLoaded="*\\dui70.dll" OR ImageLoaded="*\\duser.dll" OR ImageLoaded="*\\dusmapi.dll" OR ImageLoaded="*\\dwmapi.dll" OR ImageLoaded="*\\dwrite.dll" OR ImageLoaded="*\\dxgi.dll" OR ImageLoaded="*\\dxva2.dll" OR ImageLoaded="*\\eappcfg.dll" OR ImageLoaded="*\\eappprxy.dll" OR ImageLoaded="*\\edputil.dll" OR ImageLoaded="*\\efsadu.dll" OR ImageLoaded="*\\efsutil.dll" OR ImageLoaded="*\\esent.dll" OR ImageLoaded="*\\execmodelproxy.dll" OR ImageLoaded="*\\explorerframe.dll" OR ImageLoaded="*\\fastprox.dll" OR ImageLoaded="*\\faultrep.dll" OR ImageLoaded="*\\fddevquery.dll" OR ImageLoaded="*\\feclient.dll" OR ImageLoaded="*\\fhcfg.dll" OR ImageLoaded="*\\firewallapi.dll" OR ImageLoaded="*\\flightsettings.dll" OR ImageLoaded="*\\fltlib.dll" OR ImageLoaded="*\\fveapi.dll" OR ImageLoaded="*\\fwbase.dll" OR ImageLoaded="*\\fwcfg.dll" OR ImageLoaded="*\\fwpolicyiomgr.dll" OR ImageLoaded="*\\fwpuclnt.dll" OR ImageLoaded="*\\getuname.dll" OR ImageLoaded="*\\hid.dll" OR ImageLoaded="*\\hnetmon.dll" OR ImageLoaded="*\\httpapi.dll" OR ImageLoaded="*\\idstore.dll" OR ImageLoaded="*\\ieadvpack.dll" OR ImageLoaded="*\\iedkcs32.dll" OR ImageLoaded="*\\iertutil.dll" OR ImageLoaded="*\\ifmon.dll" OR ImageLoaded="*\\iphlpapi.dll" OR ImageLoaded="*\\iri.dll" OR ImageLoaded="*\\iscsidsc.dll" OR ImageLoaded="*\\iscsium.dll" OR ImageLoaded="*\\isv.exe_rsaenh.dll" OR ImageLoaded="*\\joinutil.dll" OR ImageLoaded="*\\ksuser.dll" OR ImageLoaded="*\\ktmw32.dll" OR ImageLoaded="*\\licensemanagerapi.dll" OR ImageLoaded="*\\licensingdiagspp.dll" OR ImageLoaded="*\\linkinfo.dll" OR ImageLoaded="*\\loadperf.dll" OR ImageLoaded="*\\logoncli.dll" OR ImageLoaded="*\\logoncontroller.dll" OR ImageLoaded="*\\lpksetupproxyserv.dll" OR ImageLoaded="*\\magnification.dll" OR ImageLoaded="*\\mapistub.dll" OR ImageLoaded="*\\mfcore.dll" OR ImageLoaded="*\\mfplat.dll" OR ImageLoaded="*\\mi.dll" OR ImageLoaded="*\\midimap.dll" OR ImageLoaded="*\\miutils.dll" OR ImageLoaded="*\\mlang.dll" OR ImageLoaded="*\\mmdevapi.dll" OR ImageLoaded="*\\mobilenetworking.dll" OR ImageLoaded="*\\mpr.dll" OR ImageLoaded="*\\mprapi.dll" OR ImageLoaded="*\\mrmcorer.dll" OR ImageLoaded="*\\msacm32.dll" OR ImageLoaded="*\\mscms.dll" OR ImageLoaded="*\\mscoree.dll" OR ImageLoaded="*\\msctf.dll" OR ImageLoaded="*\\msctfmonitor.dll" OR ImageLoaded="*\\msdrm.dll" OR ImageLoaded="*\\msftedit.dll" OR ImageLoaded="*\\msi.dll" OR ImageLoaded="*\\msutb.dll" OR ImageLoaded="*\\mswb7.dll" OR ImageLoaded="*\\mswsock.dll" OR ImageLoaded="*\\msxml3.dll" OR ImageLoaded="*\\mtxclu.dll" OR ImageLoaded="*\\napinsp.dll" OR ImageLoaded="*\\ncrypt.dll" OR ImageLoaded="*\\ndfapi.dll" OR ImageLoaded="*\\netid.dll" OR ImageLoaded="*\\netiohlp.dll" OR ImageLoaded="*\\netplwiz.dll" OR ImageLoaded="*\\netprofm.dll" OR ImageLoaded="*\\netsetupapi.dll" OR ImageLoaded="*\\netshell.dll" OR ImageLoaded="*\\netutils.dll" OR ImageLoaded="*\\networkexplorer.dll" OR ImageLoaded="*\\newdev.dll" OR ImageLoaded="*\\ninput.dll" OR ImageLoaded="*\\nlaapi.dll" OR ImageLoaded="*\\nlansp_c.dll" OR ImageLoaded="*\\npmproxy.dll" OR ImageLoaded="*\\nshhttp.dll" OR ImageLoaded="*\\nshipsec.dll" OR ImageLoaded="*\\nshwfp.dll" OR ImageLoaded="*\\ntdsapi.dll" OR ImageLoaded="*\\ntlanman.dll" OR ImageLoaded="*\\ntlmshared.dll" OR ImageLoaded="*\\ntmarta.dll" OR ImageLoaded="*\\ntshrui.dll" OR ImageLoaded="*\\oleacc.dll" OR ImageLoaded="*\\omadmapi.dll" OR ImageLoaded="*\\onex.dll" OR ImageLoaded="*\\osbaseln.dll" OR ImageLoaded="*\\osuninst.dll" OR ImageLoaded="*\\p2p.dll" OR ImageLoaded="*\\p2pnetsh.dll" OR ImageLoaded="*\\p9np.dll" OR ImageLoaded="*\\pcaui.dll" OR ImageLoaded="*\\pdh.dll" OR ImageLoaded="*\\peerdistsh.dll" OR ImageLoaded="*\\pla.dll" OR ImageLoaded="*\\pnrpnsp.dll" OR ImageLoaded="*\\policymanager.dll" OR ImageLoaded="*\\polstore.dll" OR ImageLoaded="*\\printui.dll" OR ImageLoaded="*\\propsys.dll" OR ImageLoaded="*\\prvdmofcomp.dll" OR ImageLoaded="*\\puiapi.dll" OR ImageLoaded="*\\radcui.dll" OR ImageLoaded="*\\rasapi32.dll" OR ImageLoaded="*\\rasgcw.dll" OR ImageLoaded="*\\rasman.dll" OR ImageLoaded="*\\rasmontr.dll" OR ImageLoaded="*\\reagent.dll" OR ImageLoaded="*\\regapi.dll" OR ImageLoaded="*\\resutils.dll" OR ImageLoaded="*\\rmclient.dll" OR ImageLoaded="*\\rpcnsh.dll" OR ImageLoaded="*\\rsaenh.dll" OR ImageLoaded="*\\rtutils.dll" OR ImageLoaded="*\\rtworkq.dll" OR ImageLoaded="*\\samcli.dll" OR ImageLoaded="*\\samlib.dll" OR ImageLoaded="*\\sapi_onecore.dll" OR ImageLoaded="*\\sas.dll" OR ImageLoaded="*\\scansetting.dll" OR ImageLoaded="*\\scecli.dll" OR ImageLoaded="*\\schedcli.dll" OR ImageLoaded="*\\secur32.dll" OR ImageLoaded="*\\shell32.dll" OR ImageLoaded="*\\slc.dll" OR ImageLoaded="*\\snmpapi.dll" OR ImageLoaded="*\\spp.dll" OR ImageLoaded="*\\sppc.dll" OR ImageLoaded="*\\srclient.dll" OR ImageLoaded="*\\srpapi.dll" OR ImageLoaded="*\\srvcli.dll" OR ImageLoaded="*\\ssp.exe_rsaenh.dll" OR ImageLoaded="*\\ssp_isv.exe_rsaenh.dll" OR ImageLoaded="*\\sspicli.dll" OR ImageLoaded="*\\ssshim.dll" OR ImageLoaded="*\\staterepository.core.dll" OR ImageLoaded="*\\structuredquery.dll" OR ImageLoaded="*\\sxshared.dll" OR ImageLoaded="*\\tapi32.dll" OR ImageLoaded="*\\tbs.dll" OR ImageLoaded="*\\tdh.dll" OR ImageLoaded="*\\tquery.dll" OR ImageLoaded="*\\tsworkspace.dll" OR ImageLoaded="*\\ttdrecord.dll" OR ImageLoaded="*\\twext.dll" OR ImageLoaded="*\\twinapi.dll" OR ImageLoaded="*\\twinui.appcore.dll" OR ImageLoaded="*\\uianimation.dll" OR ImageLoaded="*\\uiautomationcore.dll" OR ImageLoaded="*\\uireng.dll" OR ImageLoaded="*\\uiribbon.dll" OR ImageLoaded="*\\updatepolicy.dll" OR ImageLoaded="*\\userenv.dll" OR ImageLoaded="*\\utildll.dll" OR ImageLoaded="*\\uxinit.dll" OR ImageLoaded="*\\uxtheme.dll" OR ImageLoaded="*\\vaultcli.dll" OR ImageLoaded="*\\virtdisk.dll" OR ImageLoaded="*\\vssapi.dll" OR ImageLoaded="*\\vsstrace.dll" OR ImageLoaded="*\\wbemprox.dll" OR ImageLoaded="*\\wbemsvc.dll" OR ImageLoaded="*\\wcmapi.dll" OR ImageLoaded="*\\wcnnetsh.dll" OR ImageLoaded="*\\wdi.dll" OR ImageLoaded="*\\wdscore.dll" OR ImageLoaded="*\\webservices.dll" OR ImageLoaded="*\\wecapi.dll" OR ImageLoaded="*\\wer.dll" OR ImageLoaded="*\\wevtapi.dll" OR ImageLoaded="*\\whhelper.dll" OR ImageLoaded="*\\wimgapi.dll" OR ImageLoaded="*\\winbrand.dll" OR ImageLoaded="*\\windows.storage.dll" OR ImageLoaded="*\\windows.storage.search.dll" OR ImageLoaded="*\\windowscodecs.dll" OR ImageLoaded="*\\windowscodecsext.dll" OR ImageLoaded="*\\windowsudk.shellcommon.dll" OR ImageLoaded="*\\winhttp.dll" OR ImageLoaded="*\\wininet.dll" OR ImageLoaded="*\\winipsec.dll" OR ImageLoaded="*\\winmde.dll" OR ImageLoaded="*\\winmm.dll" OR ImageLoaded="*\\winnsi.dll" OR ImageLoaded="*\\winrnr.dll" OR ImageLoaded="*\\winsqlite3.dll" OR ImageLoaded="*\\winsta.dll" OR ImageLoaded="*\\wkscli.dll" OR ImageLoaded="*\\wlanapi.dll" OR ImageLoaded="*\\wlancfg.dll" OR ImageLoaded="*\\wldp.dll" OR ImageLoaded="*\\wlidprov.dll" OR ImageLoaded="*\\wmiclnt.dll" OR ImageLoaded="*\\wmidcom.dll" OR ImageLoaded="*\\wmiutils.dll" OR ImageLoaded="*\\wmsgapi.dll" OR ImageLoaded="*\\wofutil.dll" OR ImageLoaded="*\\wpdshext.dll" OR ImageLoaded="*\\wshbth.dll" OR ImageLoaded="*\\wshelper.dll" OR ImageLoaded="*\\wtsapi32.dll" OR ImageLoaded="*\\wwapi.dll" OR ImageLoaded="*\\xmllite.dll" OR ImageLoaded="*\\xolehlp.dll" OR ImageLoaded="*\\xwizards.dll" OR ImageLoaded="*\\xwtpw32.dll" OR ImageLoaded="*\\aclui.dll" OR ImageLoaded="*\\bderepair.dll" OR ImageLoaded="*\\bootmenuux.dll" OR ImageLoaded="*\\dcntel.dll" OR ImageLoaded="*\\dwmcore.dll" OR ImageLoaded="*\\dynamoapi.dll" OR ImageLoaded="*\\fhsvcctl.dll" OR ImageLoaded="*\\fxsst.dll" OR ImageLoaded="*\\inproclogger.dll" OR ImageLoaded="*\\iumbase.dll" OR ImageLoaded="*\\kdstub.dll" OR ImageLoaded="*\\maintenanceui.dll" OR ImageLoaded="*\\mdmdiagnostics.dll" OR ImageLoaded="*\\mintdh.dll" OR ImageLoaded="*\\msdtctm.dll" OR ImageLoaded="*\\nettrace.dll" OR ImageLoaded="*\\osksupport.dll" OR ImageLoaded="*\\reseteng.dll" OR ImageLoaded="*\\resetengine.dll" OR ImageLoaded="*\\spectrumsyncclient.dll" OR ImageLoaded="*\\srcore.dll" OR ImageLoaded="*\\systemsettingsthresholdadminflowui.dll" OR ImageLoaded="*\\timesync.dll" OR ImageLoaded="*\\upshared.dll" OR ImageLoaded="*\\wmpdui.dll" OR ImageLoaded="*\\wwancfg.dll" OR ImageLoaded="*\\dpx.dll" OR ImageLoaded="*\\fxsapi.dll" OR ImageLoaded="*\\fxstiff.dll" OR ImageLoaded="*\\xpsservices.dll" OR ImageLoaded="*\\appvpolicy.dll" OR ImageLoaded="*\\batmeter.dll" OR ImageLoaded="*\\bootux.dll" OR ImageLoaded="*\\cmutil.dll" OR ImageLoaded="*\\configmanager2.dll" OR ImageLoaded="*\\coredplus.dll" OR ImageLoaded="*\\coreuicomponents.dll" OR ImageLoaded="*\\cryptsp.dll" OR ImageLoaded="*\\dmcommandlineutils.dll" OR ImageLoaded="*\\drvstore.dll" OR ImageLoaded="*\\dsprop.dll" OR ImageLoaded="*\\dxcore.dll" OR ImageLoaded="*\\edgeiso.dll" OR ImageLoaded="*\\framedynos.dll" OR ImageLoaded="*\\fveskybackup.dll" OR ImageLoaded="*\\fvewiz.dll" OR ImageLoaded="*\\gpapi.dll" OR ImageLoaded="*\\icmp.dll" OR ImageLoaded="*\\ifsutil.dll" OR ImageLoaded="*\\iumsdk.dll" OR ImageLoaded="*\\lockhostingframework.dll" OR ImageLoaded="*\\lrwizdll.dll" OR ImageLoaded="*\\mbaexmlparser.dll" OR ImageLoaded="*\\mfc42u.dll" OR ImageLoaded="*\\msiso.dll" OR ImageLoaded="*\\msvcp110_win.dll" OR ImageLoaded="*\\netapi32.dll" OR ImageLoaded="*\\netjoin.dll" OR ImageLoaded="*\\netprovfw.dll" OR ImageLoaded="*\\opcservices.dll" OR ImageLoaded="*\\pkeyhelper.dll" OR ImageLoaded="*\\playsndsrv.dll" OR ImageLoaded="*\\powrprof.dll" OR ImageLoaded="*\\prntvpt.dll" OR ImageLoaded="*\\profapi.dll" OR ImageLoaded="*\\proximitycommon.dll" OR ImageLoaded="*\\proximityservicepal.dll" OR ImageLoaded="*\\rasdlg.dll" OR ImageLoaded="*\\security.dll" OR ImageLoaded="*\\sppcext.dll" OR ImageLoaded="*\\srmtrace.dll" OR ImageLoaded="*\\tpmcoreprovisioning.dll" OR ImageLoaded="*\\umpdc.dll" OR ImageLoaded="*\\unattend.dll" OR ImageLoaded="*\\urlmon.dll" OR ImageLoaded="*\\vdsutil.dll" OR ImageLoaded="*\\version.dll" OR ImageLoaded="*\\winbio.dll" OR ImageLoaded="*\\windows.ui.immersive.dll" OR ImageLoaded="*\\winscard.dll" OR ImageLoaded="*\\winsync.dll" OR ImageLoaded="*\\wscapi.dll" OR ImageLoaded="*\\wsmsvc.dll" OR ImageLoaded="*\\FxsCompose.dll" OR ImageLoaded="*\\WfsR.dll" OR ImageLoaded="*\\rpchttp.dll" OR ImageLoaded="*\\storageusage.dll" OR ImageLoaded="*\\amsi.dll" OR ImageLoaded="*\\PrintIsolationProxy.dll" OR ImageLoaded="*\\msdtcVSp1res.dll" OR ImageLoaded="*\\rdpendp.dll" OR ImageLoaded="*\\dxilconv.dll" OR ImageLoaded="*\\utcutil.dll" OR ImageLoaded="*\\appraiser.dll" OR ImageLoaded="*\\dsound.dll" OR ImageLoaded="*\\DispBroker.dll" OR ImageLoaded="*\\FXSRESM.DLL" OR ImageLoaded="*\\cryptnet.dll" OR ImageLoaded="*\\COMRES.DLL" OR ImageLoaded="*\\igdumdim64.dll" OR ImageLoaded="*\\igd10iumd64.dll" OR ImageLoaded="*\\igd12umd64.dll" OR ImageLoaded="*\\igdusc64.dll" OR ImageLoaded="*\\WLBSCTRL.dll" OR ImageLoaded="*\\TSMSISrv.dll" OR ImageLoaded="*\\TSVIPSrv.dll" OR ImageLoaded="*\\wow64log.dll" OR ImageLoaded="*\\WptsExtensions.dll" OR ImageLoaded="*\\wbemcomn.dll") NOT ((((ImageLoaded="C:\\Windows\\System32\\*" OR ImageLoaded="C:\\Windows\\SysWOW64\\*" OR ImageLoaded="C:\\Windows\\WinSxS\\*" OR ImageLoaded="C:\\Windows\\SoftwareDistribution\\*" OR ImageLoaded="C:\\Windows\\SystemTemp\\*"))) OR ((ImageLoaded="C:\\Program Files\\Common Files\\microsoft shared\\ClickToRun\\AppVPolicy.dll" Image="C:\\Program Files\\Common Files\\microsoft shared\\ClickToRun\\OfficeClickToRun.exe")) OR ((ImageLoaded="C:\\Packages\\Plugins\\Microsoft.GuestConfiguration.ConfigurationforWindows\\*")) OR (((Image="C:\\Program Files\\WindowsApps\\DellInc.DellSupportAssistforPCs*" OR Image="C:\\Windows\\System32\\backgroundTaskHost.exe*") ImageLoaded="C:\\Program Files\\WindowsApps\\DellInc.DellSupportAssistforPCs*")) OR ((Image="C:\\Windows\\System32\\cleanmgr.exe" ImageLoaded="*\\ssshim.dll")) OR ((Image="C:\\$WINDOWS.~BT\\*"))))) | eval sigma_attack_tags="attack.defense_evasion attack.persistence attack.privilege_escalation attack.t1574.001 attack.t1574.002" | eval sigma_title="Potential System DLL Sideloading From Non System Locations" | eval sigma_description="Detects DLL sideloading of DLLs usually located in system locations (System32, SysWOW64...)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential DLL Sideloading Via JsSchHlp - sysmon]
description = Detects potential DLL sideloading using JUSTSYSTEMS Japanese word processor
search = index=sysmon* ((((EventCode="7" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ImageLoaded="*\\JSESPR.dll" NOT ((ImageLoaded="C:\\Program Files\\Common Files\\Justsystem\\JsSchHlp\\*")))) | eval sigma_attack_tags="attack.defense_evasion attack.persistence attack.privilege_escalation attack.t1574.001 attack.t1574.002" | eval sigma_title="Potential DLL Sideloading Via JsSchHlp" | eval sigma_description="Detects potential DLL sideloading using JUSTSYSTEMS Japanese word processor"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential DLL Sideloading Of Non-Existent DLLs From System Folders - sysmon]
description = Detects DLL sideloading of system dlls that are not present on the system by default. Usualy to achieve techniques such as UAC bypass and privilege escalation
search = index=sysmon* ((((EventCode="7" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (ImageLoaded="C:\\Windows\\System32\\WLBSCTRL.dll" OR ImageLoaded="C:\\Windows\\System32\\TSMSISrv.dll" OR ImageLoaded="C:\\Windows\\System32\\TSVIPSrv.dll" OR ImageLoaded="C:\\Windows\\System32\\wow64log.dll" OR ImageLoaded="C:\\Windows\\System32\\WptsExtensions.dll" OR ImageLoaded="C:\\Windows\\System32\\wbem\\wbemcomn.dll") NOT (((Signed="true" Signature="Microsoft Windows"))))) | eval sigma_attack_tags="attack.defense_evasion attack.persistence attack.privilege_escalation attack.t1574.001 attack.t1574.002" | eval sigma_title="Potential DLL Sideloading Of Non-Existent DLLs From System Folders" | eval sigma_description="Detects DLL sideloading of system dlls that are not present on the system by default. Usualy to achieve techniques such as UAC bypass and privilege escalation"
dispatch.earliest_time = -24h@h
alert.track = 0

[Microsoft Office DLL Sideload - sysmon]
description = Detects DLL sideloading of DLLs that are part of Microsoft Office from non standard location
search = index=sysmon* ((((EventCode="7" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ImageLoaded="*\\outllib.dll" NOT (((ImageLoaded="C:\\Program Files\\Microsoft Office\\OFFICE*" OR ImageLoaded="C:\\Program Files (x86)\\Microsoft Office\\OFFICE*" OR ImageLoaded="C:\\Program Files\\Microsoft Office\\Root\\OFFICE*" OR ImageLoaded="C:\\Program Files (x86)\\Microsoft Office\\Root\\OFFICE*"))))) | eval sigma_attack_tags="attack.defense_evasion attack.persistence attack.privilege_escalation attack.t1574.001 attack.t1574.002" | eval sigma_title="Microsoft Office DLL Sideload" | eval sigma_description="Detects DLL sideloading of DLLs that are part of Microsoft Office from non standard location"
dispatch.earliest_time = -24h@h
alert.track = 0

[SCM DLL Sideload - sysmon]
description = Detects DLL sideloading of DLLs that are loaded by the SCM for some services (IKE, IKEEXT, SessionEnv) which do not exists on a typical modern system
search = index=sysmon* ((EventCode="7" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (ImageLoaded="C:\\Windows\\System32\\WLBSCTRL.dll" OR ImageLoaded="C:\\Windows\\System32\\TSMSISrv.dll" OR ImageLoaded="C:\\Windows\\System32\\TSVIPSrv.dll") Image="C:\\Windows\\System32\\svchost.exe")) | eval sigma_attack_tags="attack.defense_evasion attack.persistence attack.privilege_escalation attack.t1574.001 attack.t1574.002" | eval sigma_title="SCM DLL Sideload" | eval sigma_description="Detects DLL sideloading of DLLs that are loaded by the SCM for some services (IKE, IKEEXT, SessionEnv) which do not exists on a typical modern system"
dispatch.earliest_time = -24h@h
alert.track = 0

[Third Party Software DLL Sideloading - sysmon]
description = Detects DLL sideloading of DLLs that are part of third party software (zoom, discord....etc)
search = index=sysmon* ((((EventCode="7" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((ImageLoaded="*\\commfunc.dll" NOT ((ImageLoaded="*\\AppData\\local\\Google\\Chrome\\Application\\*") OR ((ImageLoaded="C:\\Program Files\\Lenovo\\Communications Utility\\*" OR ImageLoaded="C:\\Program Files (x86)\\Lenovo\\Communications Utility\\*"))))) OR ((ImageLoaded="*\\tosbtkbd.dll" NOT (((ImageLoaded="C:\\Program Files\\Toshiba\\Bluetooth Toshiba Stack\\*" OR ImageLoaded="C:\\Program Files (x86)\\Toshiba\\Bluetooth Toshiba Stack\\*")))))))) | eval sigma_attack_tags="attack.defense_evasion attack.persistence attack.privilege_escalation attack.t1574.001 attack.t1574.002" | eval sigma_title="Third Party Software DLL Sideloading" | eval sigma_description="Detects DLL sideloading of DLLs that are part of third party software (zoom, discord....etc)"
dispatch.earliest_time = -24h@h
alert.track = 0

[VMGuestLib DLL Sideload - sysmon]
description = Detects DLL sideloading of VMGuestLib.dll by the WmiApSrv service.
search = index=sysmon* ((((EventCode="7" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((ImageLoaded="*\\VMware\\VMware Tools\\vmStatsProvider\\win32*" ImageLoaded="*\\vmGuestLib.dll*" Image="*\\Windows\\System32\\wbem\\WmiApSrv.exe")) NOT ((Signed="true")))) | eval sigma_attack_tags="attack.defense_evasion attack.persistence attack.privilege_escalation attack.t1574.001 attack.t1574.002" | eval sigma_title="VMGuestLib DLL Sideload" | eval sigma_description="Detects DLL sideloading of VMGuestLib.dll by the WmiApSrv service."
dispatch.earliest_time = -24h@h
alert.track = 0

[Web Browsers DLL Sideloading - sysmon]
description = Detects DLL sideloading of DLLs that are part of web browsers
search = index=sysmon* ((((EventCode="7" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ImageLoaded="*\\chrome_frame_helper.dll" NOT ((ImageLoaded="*\\AppData\\local\\Google\\Chrome\\Application\\*") OR ((ImageLoaded="C:\\Program Files\\Google\\Chrome\\Application\\*" OR ImageLoaded="C:\\Program Files (x86)\\Google\\Chrome\\Application\\*"))))) | eval sigma_attack_tags="attack.defense_evasion attack.persistence attack.privilege_escalation attack.t1574.001 attack.t1574.002" | eval sigma_title="Web Browsers DLL Sideloading" | eval sigma_description="Detects DLL sideloading of DLLs that are part of web browsers"
dispatch.earliest_time = -24h@h
alert.track = 0

[SILENTTRINITY Stager Execution - DLL - sysmon]
description = Detects SILENTTRINITY stager use
search = index=sysmon* ((EventCode="7" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Description="*st2stager*")) | eval sigma_attack_tags="attack.command_and_control attack.t1071" | eval sigma_title="SILENTTRINITY Stager Execution - DLL" | eval sigma_description="Detects SILENTTRINITY stager use"
dispatch.earliest_time = -24h@h
alert.track = 0

[Windows Spooler Service Suspicious Binary Load - sysmon]
description = Detect DLL Load from Spooler Service backup folder
search = index=sysmon* ((EventCode="7" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\spoolsv.exe" (ImageLoaded="*\\Windows\\System32\\spool\\drivers\\x64\\3\\*" OR ImageLoaded="*\\Windows\\System32\\spool\\drivers\\x64\\4\\*") ImageLoaded="*.dll")) | eval sigma_attack_tags="attack.persistence attack.defense_evasion attack.privilege_escalation attack.t1574 cve.2021.1675 cve.2021.34527" | eval sigma_title="Windows Spooler Service Suspicious Binary Load" | eval sigma_description="Detect DLL Load from Spooler Service backup folder"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Load of Advapi31.dll - sysmon]
description = Detects the load of advapi31.dll by a process running in an uncommon folder
search = index=sysmon* ((((EventCode="7" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ImageLoaded="*\\advapi32.dll" NOT ((((Image="C:\\Windows\\*" OR Image="C:\\Program Files (x86)\\*" OR Image="C:\\Program Files\\*"))) OR ((Image="C:\\ProgramData\\Microsoft\\Windows Defender\\platform\\*" Image="*\\MpCmdRun.exe")) OR ((Image="C:\\Users\\*" Image="*\\AppData\\Local\\Microsoft\\OneDrive\\*" Image="*FileCoAuth.exe"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1070" | eval sigma_title="Suspicious Load of Advapi31.dll" | eval sigma_description="Detects the load of advapi31.dll by a process running in an uncommon folder"
dispatch.earliest_time = -24h@h
alert.track = 0

[Cmstp Suspicious DLL Load - sysmon]
description = Detects cmstp loading 'dll' or 'ocx' files from suspicious locations
search = index=sysmon* ((EventCode="7" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (ImageLoaded="*\\Users\\*" OR ImageLoaded="*\\AppData\\Local\\Temp\\*" OR ImageLoaded="*\\PerfLogs\\*" OR ImageLoaded="*\\Windows\\Temp\\*") (ImageLoaded="*.dll" OR ImageLoaded="*.ocx") Image="*\\cmstp.exe")) | eval sigma_attack_tags="attack.defense_evasion attack.t1218.003" | eval sigma_title="Cmstp Suspicious DLL Load" | eval sigma_description="Detects cmstp loading 'dll' or 'ocx' files from suspicious locations"
dispatch.earliest_time = -24h@h
alert.track = 0

[Load of dbghelp/dbgcore DLL from Suspicious Process - sysmon]
description = Detects the load of dbghelp/dbgcore DLL (used to make memory dumps) by suspicious processes.
Tools like ProcessHacker and some attacker tradecract use MiniDumpWriteDump API found in dbghelp.dll or dbgcore.dll.
As an example, SilentTrynity C2 Framework has a module that leverages this API to dump the contents of Lsass.exe and transfer it over the network back to the attacker's machine.

search = index=sysmon* ((((EventCode="7" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((((ImageLoaded="*\\dbghelp.dll" OR ImageLoaded="*\\dbgcore.dll") (Image="*\\msbuild.exe" OR Image="*\\cmd.exe" OR Image="*\\rundll32.exe" OR Image="*\\word.exe" OR Image="*\\excel.exe" OR Image="*\\powerpnt.exe" OR Image="*\\outlook.exe" OR Image="*\\monitoringhost.exe" OR Image="*\\wmic.exe" OR Image="*\\bash.exe" OR Image="*\\wscript.exe" OR Image="*\\cscript.exe" OR Image="*\\mshta.exe" OR Image="*\\dnx.exe" OR Image="*\\regsvcs.exe" OR Image="*\\sc.exe" OR Image="*\\scriptrunner.exe"))) OR (((ImageLoaded="*\\dbghelp.dll" OR ImageLoaded="*\\dbgcore.dll") Signed="false"))) NOT (((Image="*Visual Studio*") OR ((CommandLine="*-k LocalSystemNetworkRestricted*" OR CommandLine="*-k UnistackSvcGroup -s WpnUserService*"))) OR (((CommandLine="C:\\Windows\\system32\\svchost.exe -k netsvcs -p -s wuauserv" OR CommandLine="C:\\Windows\\System32\\svchost.exe -k WerSvcGroup"))) OR ((CommandLine="C:\\WINDOWS\\winsxs\\*" CommandLine="*\\TiWorker.exe -Embedding"))))) | table ComputerName,User,Image,ImageLoaded | eval sigma_attack_tags="attack.credential_access attack.t1003.001" | eval sigma_title="Load of dbghelp/dbgcore DLL from Suspicious Process" | eval sigma_description="Detects the load of dbghelp/dbgcore DLL (used to make memory dumps) by suspicious processes.
Tools like ProcessHacker and some attacker tradecract use MiniDumpWriteDump API found in dbghelp.dll or dbgcore.dll.
As an example, SilentTrynity C2 Framework has a module that leverages this API to dump the contents of Lsass.exe and transfer it over the network back to the attacker's machine.
"
dispatch.earliest_time = -24h@h
alert.track = 0

[DLL Load By System Process From Suspicious Locations - sysmon]
description = Detects when a system process (ie located in system32, syswow64...etc) loads a DLL from a suspicious location such as %temp%
search = index=sysmon* ((((EventCode="7" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="C:\\Windows\\*" (ImageLoaded="*\\Users\\Public\\*" OR ImageLoaded="*\\Downloads\\*" OR ImageLoaded="*\\AppData\\Local\\Temp\\*" OR ImageLoaded="*C:\\PerfLogs\\*"))) NOT (((Image="*\\msiexec.exe") OR ((ImageLoaded="C:\\Program Files\\*" OR ImageLoaded="C:\\Program Files (x86)\\*")) OR ((Image="C:\\Windows\\SysWOW64\\rundll32.exe" OR Image="C:\\Windows\\System32\\rundll32.exe")) OR ((CommandLine="*\\AppData\\Local\\Temp\\*" CommandLine="*\\setup.exe*"))) OR ((Image="C:\\Windows\\System32\\cleanmgr.exe" ImageLoaded="*\\ssshim.dll")) OR ((Image="C:\\Windows\\Microsoft.NET\\Framework\\v*" Image="*\\mscorsvw.exe" ImageLoaded="*\\AppData\\Local\\Temp\\*"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1070" | eval sigma_title="DLL Load By System Process From Suspicious Locations" | eval sigma_description="Detects when a system process (ie located in system32, syswow64...etc) loads a DLL from a suspicious location such as %temp%"
dispatch.earliest_time = -24h@h
alert.track = 0

[Fax Service DLL Search Order Hijack - sysmon]
description = The Fax service attempts to load ualapi.dll, which is non-existent. An attacker can then (side)load their own malicious DLL using this service.
search = index=sysmon* ((((EventCode="7" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\fxssvc.exe" ImageLoaded="*ualapi.dll")) NOT ((ImageLoaded="C:\\Windows\\WinSxS\\*")))) | eval sigma_attack_tags="attack.persistence attack.defense_evasion attack.t1574.001 attack.t1574.002" | eval sigma_title="Fax Service DLL Search Order Hijack" | eval sigma_description="The Fax service attempts to load ualapi.dll, which is non-existent. An attacker can then (side)load their own malicious DLL using this service."
dispatch.earliest_time = -24h@h
alert.track = 0

[dotNET DLL Loaded Via Office Applications - sysmon]
description = Detects any assembly DLL being loaded by an Office Product
search = index=sysmon* ((EventCode="7" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (Image="*\\winword.exe" OR Image="*\\powerpnt.exe" OR Image="*\\excel.exe" OR Image="*\\outlook.exe") ImageLoaded="C:\\Windows\\assembly\\*")) | eval sigma_attack_tags="attack.execution attack.t1204.002" | eval sigma_title="dotNET DLL Loaded Via Office Applications" | eval sigma_description="Detects any assembly DLL being loaded by an Office Product"
dispatch.earliest_time = -24h@h
alert.track = 0

[CLR DLL Loaded Via Office Applications - sysmon]
description = Detects CLR DLL being loaded by an Office Product
search = index=sysmon* ((EventCode="7" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (Image="*\\winword.exe" OR Image="*\\powerpnt.exe" OR Image="*\\excel.exe" OR Image="*\\outlook.exe") ImageLoaded="*\\clr.dll*")) | eval sigma_attack_tags="attack.execution attack.t1204.002" | eval sigma_title="CLR DLL Loaded Via Office Applications" | eval sigma_description="Detects CLR DLL being loaded by an Office Product"
dispatch.earliest_time = -24h@h
alert.track = 0

[GAC DLL Loaded Via Office Applications - sysmon]
description = Detects any GAC DLL being loaded by an Office Product
search = index=sysmon* ((EventCode="7" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (Image="*\\winword.exe" OR Image="*\\powerpnt.exe" OR Image="*\\excel.exe" OR Image="*\\outlook.exe") ImageLoaded="C:\\Windows\\Microsoft.NET\\assembly\\GAC_MSIL*")) | eval sigma_attack_tags="attack.execution attack.t1204.002" | eval sigma_title="GAC DLL Loaded Via Office Applications" | eval sigma_description="Detects any GAC DLL being loaded by an Office Product"
dispatch.earliest_time = -24h@h
alert.track = 0

[Active Directory Parsing DLL Loaded Via Office Applications - sysmon]
description = Detects DSParse DLL being loaded by an Office Product
search = index=sysmon* ((EventCode="7" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (Image="*\\winword.exe" OR Image="*\\powerpnt.exe" OR Image="*\\excel.exe" OR Image="*\\outlook.exe") ImageLoaded="*\\dsparse.dll*")) | eval sigma_attack_tags="attack.execution attack.t1204.002" | eval sigma_title="Active Directory Parsing DLL Loaded Via Office Applications" | eval sigma_description="Detects DSParse DLL being loaded by an Office Product"
dispatch.earliest_time = -24h@h
alert.track = 0

[Active Directory Kerberos DLL Loaded Via Office Applications - sysmon]
description = Detects Kerberos DLL being loaded by an Office Product
search = index=sysmon* ((EventCode="7" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (Image="*\\winword.exe" OR Image="*\\powerpnt.exe" OR Image="*\\excel.exe" OR Image="*\\outlook.exe") ImageLoaded="*\\kerberos.dll")) | eval sigma_attack_tags="attack.execution attack.t1204.002" | eval sigma_title="Active Directory Kerberos DLL Loaded Via Office Applications" | eval sigma_description="Detects Kerberos DLL being loaded by an Office Product"
dispatch.earliest_time = -24h@h
alert.track = 0

[Python Py2Exe Image Load - sysmon]
description = Detects the image load of Python Core indicative of a Python script bundled with Py2Exe.
search = index=sysmon* ((((EventCode="7" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) Description="Python Core" NOT (((Image="*Python*") OR ((Image="C:\\Program Files\\*" OR Image="C:\\Program Files (x86)\\*" OR Image="C:\\ProgramData\\Anaconda3\\*"))) OR ((NOT Image="*"))))) | table Description | eval sigma_attack_tags="attack.defense_evasion attack.t1027.002" | eval sigma_title="Python Py2Exe Image Load" | eval sigma_description="Detects the image load of Python Core indicative of a Python script bundled with Py2Exe."
dispatch.earliest_time = -24h@h
alert.track = 0

[CLR DLL Loaded Via Scripting Applications - sysmon]
description = Detects .NET CLR DLLs being loaded by scripting applications such as wscript or cscript
search = index=sysmon* ((EventCode="7" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (Image="*\\wscript.exe" OR Image="*\\cscript.exe" OR Image="*\\mshta.exe" OR Image="*\\cmstp.exe" OR Image="*\\msxsl.exe") (ImageLoaded="*\\clr.dll" OR ImageLoaded="*\\mscoree.dll" OR ImageLoaded="*\\mscorlib.dll"))) | eval sigma_attack_tags="attack.execution attack.privilege_escalation attack.t1055" | eval sigma_title="CLR DLL Loaded Via Scripting Applications" | eval sigma_description="Detects .NET CLR DLLs being loaded by scripting applications such as wscript or cscript"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious System.Drawing Load - sysmon]
description = A General detection for processes loading System.Drawing.ni.dll. This could be an indicator of potential Screen Capture.
search = index=sysmon* ((((EventCode="7" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ImageLoaded="*\\System.Drawing.ni.dll" NOT ((((Image="C:\\Program Files\\*" OR Image="C:\\Program Files (x86)\\*" OR Image="C:\\Windows\\System32\\*" OR Image="C:\\Windows\\Microsoft.NET\\*" OR Image="C:\\Windows\\ImmersiveControlPanel\\*"))) OR ((Image="C:\\Windows\\System32\\NhNotifSys.exe")) OR ((Image="C:\\Users\\*" (Image="*\\AppData\\Local\\NhNotifSys\\nahimic\\nahimicNotifSys.exe" OR Image="*\\GitHubDesktop\\Update.exe")))))) | eval sigma_attack_tags="attack.collection attack.t1113" | eval sigma_title="Suspicious System.Drawing Load" | eval sigma_description="A General detection for processes loading System.Drawing.ni.dll. This could be an indicator of potential Screen Capture."
dispatch.earliest_time = -24h@h
alert.track = 0

[Possible Process Hollowing Image Loading - sysmon]
description = Detects Loading of samlib.dll, WinSCard.dll from untypical process e.g. through process hollowing by Mimikatz
search = index=sysmon* ((EventCode="7" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\notepad.exe" (ImageLoaded="*\\samlib.dll" OR ImageLoaded="*\\WinSCard.dll"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1574.002" | eval sigma_title="Possible Process Hollowing Image Loading" | eval sigma_description="Detects Loading of samlib.dll, WinSCard.dll from untypical process e.g. through process hollowing by Mimikatz"
dispatch.earliest_time = -24h@h
alert.track = 0

[Image Load of VSS Dll by Uncommon Executable - sysmon]
description = Detects the image load of VSS DLL by uncommon executables
search = index=sysmon* ((((EventCode="7" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (ImageLoaded="*\\vsstrace.dll" OR ImageLoaded="*\\vssapi.dll") NOT ((((Image="C:\\Windows\\*" OR Image="C:\\Program Files\\*" OR Image="C:\\Program Files (x86)\\*" OR Image="C:\\ProgramData\\Package Cache\\*")))))) | eval sigma_attack_tags="attack.defense_evasion attack.impact attack.t1490" | eval sigma_title="Image Load of VSS Dll by Uncommon Executable" | eval sigma_description="Detects the image load of VSS DLL by uncommon executables"
dispatch.earliest_time = -24h@h
alert.track = 0

[Image Load of VSS_PS.dll by Uncommon Executable - sysmon]
description = Detects the image load of vss_ps.dll by uncommon executables
search = index=sysmon* ((((EventCode="7" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ImageLoaded="*\\vss_ps.dll" NOT ((((Image="*\\svchost.exe" OR Image="*\\msiexec.exe" OR Image="*\\vssvc.exe" OR Image="*\\srtasks.exe" OR Image="*\\tiworker.exe" OR Image="*\\dllhost.exe" OR Image="*\\searchindexer.exe" OR Image="*\\dismhost.exe" OR Image="*\\taskhostw.exe" OR Image="*\\clussvc.exe" OR Image="*\\thor64.exe" OR Image="*\\thor.exe" OR Image="*\\rundll32.exe" OR Image="*\\inetsrv\\iissetup.exe" OR Image="*\\inetsrv\\appcmd.exe" OR Image="*\\WmiPrvSE.exe") Image="C:\\Windows\\*")) OR (((Image="C:\\Program Files\\*" OR Image="C:\\Program Files (x86)\\*"))) OR ((CommandLine="C:\\$WinREAgent\\Scratch\\*" CommandLine="*\\dismhost.exe {*"))))) | eval sigma_attack_tags="attack.defense_evasion attack.impact attack.t1490" | eval sigma_title="Image Load of VSS_PS.dll by Uncommon Executable" | eval sigma_description="Detects the image load of vss_ps.dll by uncommon executables"
dispatch.earliest_time = -24h@h
alert.track = 0

[VBA DLL Loaded Via Office Application - sysmon]
description = Detects VB DLL's loaded by an office application. Which could indicate the presence of VBA Macros.
search = index=sysmon* ((EventCode="7" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (Image="*\\winword.exe" OR Image="*\\powerpnt.exe" OR Image="*\\excel.exe" OR Image="*\\outlook.exe") (ImageLoaded="*\\VBE7.DLL" OR ImageLoaded="*\\VBEUI.DLL" OR ImageLoaded="*\\VBE7INTL.DLL"))) | eval sigma_attack_tags="attack.execution attack.t1204.002" | eval sigma_title="VBA DLL Loaded Via Office Application" | eval sigma_description="Detects VB DLL's loaded by an office application. Which could indicate the presence of VBA Macros."
dispatch.earliest_time = -24h@h
alert.track = 0

[Svchost DLL Search Order Hijack - sysmon]
description = IKEEXT and SessionEnv service, as they call LoadLibrary on files that do not exist within C:\Windows\System32\ by default.
An attacker can place their malicious logic within the PROCESS_ATTACH block of their library and restart the aforementioned services 'svchost.exe -k netsvcs' to gain code execution on a remote machine.

search = index=sysmon* ((((EventCode="7" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\svchost.exe" (ImageLoaded="*\\tsmsisrv.dll" OR ImageLoaded="*\\tsvipsrv.dll" OR ImageLoaded="*\\wlbsctrl.dll"))) NOT ((ImageLoaded="C:\\Windows\\WinSxS\\*")))) | eval sigma_attack_tags="attack.persistence attack.defense_evasion attack.t1574.002 attack.t1574.001" | eval sigma_title="Svchost DLL Search Order Hijack" | eval sigma_description="IKEEXT and SessionEnv service, as they call LoadLibrary on files that do not exist within C:\Windows\System32\ by default.
An attacker can place their malicious logic within the PROCESS_ATTACH block of their library and restart the aforementioned services 'svchost.exe -k netsvcs' to gain code execution on a remote machine.
"
dispatch.earliest_time = -24h@h
alert.track = 0

[SharpEvtMute Imphash EvtMuteHook Load - sysmon]
description = Detects the load of EvtMuteHook.dll, a key component of SharpEvtHook, a tool to tamper with Windows event logs
search = index=sysmon* ((((EventCode="7" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Hashes="*IMPHASH=330768A4F172E10ACB6287B87289D83B*" OR Imphash="330768a4f172e10acb6287b87289d83b"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.002" | eval sigma_title="SharpEvtMute Imphash EvtMuteHook Load" | eval sigma_description="Detects the load of EvtMuteHook.dll, a key component of SharpEvtHook, a tool to tamper with Windows event logs"
dispatch.earliest_time = -24h@h
alert.track = 0

[Time Travel Debugging Utility Usage - Image - sysmon]
description = Detects usage of Time Travel Debugging Utility. Adversaries can execute malicious processes and dump processes, such as lsass.exe, via tttracer.exe.
search = index=sysmon* ((EventCode="7" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (ImageLoaded="*\\ttdrecord.dll" OR ImageLoaded="*\\ttdwriter.dll" OR ImageLoaded="*\\ttdloader.dll"))) | eval sigma_attack_tags="attack.defense_evasion attack.credential_access attack.t1218 attack.t1003.001" | eval sigma_title="Time Travel Debugging Utility Usage - Image" | eval sigma_description="Detects usage of Time Travel Debugging Utility. Adversaries can execute malicious processes and dump processes, such as lsass.exe, via tttracer.exe."
dispatch.earliest_time = -24h@h
alert.track = 0

[UAC Bypass Using Iscsicpl - ImageLoad - sysmon]
description = Detects the 'iscsicpl.exe' UAC bypass technique that leverages a DLL Search Order hijacking technique to load a custom DLL's from temp or a any user controlled location in the users %PATH%
search = index=sysmon* ((((EventCode="7" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="C:\\Windows\\SysWOW64\\iscsicpl.exe" ImageLoaded="*\\iscsiexe.dll")) NOT (((ImageLoaded="*C:\\Windows\\*" ImageLoaded="*iscsiexe.dll*"))))) | eval sigma_attack_tags="attack.defense_evasion attack.privilege_escalation attack.t1548.002" | eval sigma_title="UAC Bypass Using Iscsicpl - ImageLoad" | eval sigma_description="Detects the 'iscsicpl.exe' UAC bypass technique that leverages a DLL Search Order hijacking technique to load a custom DLL's from temp or a any user controlled location in the users %PATH%"
dispatch.earliest_time = -24h@h
alert.track = 0

[UAC Bypass With Fake DLL - sysmon]
description = Attempts to load dismcore.dll after dropping it
search = index=sysmon* ((((EventCode="7" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\dism.exe" ImageLoaded="*\\dismcore.dll")) NOT ((ImageLoaded="C:\\Windows\\System32\\Dism\\dismcore.dll")))) | eval sigma_attack_tags="attack.persistence attack.defense_evasion attack.privilege_escalation attack.t1548.002 attack.t1574.002" | eval sigma_title="UAC Bypass With Fake DLL" | eval sigma_description="Attempts to load dismcore.dll after dropping it"
dispatch.earliest_time = -24h@h
alert.track = 0

[Unsigned Image Loaded Into LSASS Process - sysmon]
description = Loading unsigned image (DLL, EXE) into LSASS process
search = index=sysmon* ((EventCode="7" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\lsass.exe" Signed="false")) | eval sigma_attack_tags="attack.credential_access attack.t1003.001" | eval sigma_title="Unsigned Image Loaded Into LSASS Process" | eval sigma_description="Loading unsigned image (DLL, EXE) into LSASS process"
dispatch.earliest_time = -24h@h
alert.track = 0

[APT PRIVATELOG Image Load Pattern - sysmon]
description = Detects an image load pattern as seen when a tool named PRIVATELOG is used and rarely observed under legitimate circumstances
search = index=sysmon* ((EventCode="7" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\svchost.exe" ImageLoaded="*\\clfsw32.dll")) | eval sigma_attack_tags="attack.defense_evasion attack.privilege_escalation attack.t1055" | eval sigma_title="APT PRIVATELOG Image Load Pattern" | eval sigma_description="Detects an image load pattern as seen when a tool named PRIVATELOG is used and rarely observed under legitimate circumstances"
dispatch.earliest_time = -24h@h
alert.track = 0

[VMware Xfer Loading DLL from Nondefault Path - sysmon]
description = Detects loading of a DLL by the VMware Xfer utility from the non-default directory which may be an attempt to sideload arbitrary DLL
search = index=sysmon* ((((EventCode="7" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\VMwareXferlogs.exe" ImageLoaded="*\\glib-2.0.dll")) NOT ((ImageLoaded="C:\\Program Files\\VMware\\*")))) | eval sigma_attack_tags="attack.defense_evasion attack.t1574.002" | eval sigma_title="VMware Xfer Loading DLL from Nondefault Path" | eval sigma_description="Detects loading of a DLL by the VMware Xfer utility from the non-default directory which may be an attempt to sideload arbitrary DLL"
dispatch.earliest_time = -24h@h
alert.track = 0

[WMI Modules Loaded - sysmon]
description = Detects non wmiprvse loading WMI modules
search = index=sysmon* ((((EventCode="7" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((ImageLoaded="*\\wmiclnt.dll" OR ImageLoaded="*\\WmiApRpl.dll" OR ImageLoaded="*\\wmiprov.dll" OR ImageLoaded="*\\wmiutils.dll" OR ImageLoaded="*\\wbemcomn.dll" OR ImageLoaded="*\\wbemprox.dll" OR ImageLoaded="*\\WMINet_Utils.dll" OR ImageLoaded="*\\wbemsvc.dll" OR ImageLoaded="*\\fastprox.dll") NOT (((Image="*\\WmiPrvSE.exe" OR Image="*\\WmiApSrv.exe" OR Image="*\\svchost.exe" OR Image="*\\DeviceCensus.exe" OR Image="*\\CompatTelRunner.exe" OR Image="*\\sdiagnhost.exe" OR Image="*\\SIHClient.exe" OR Image="*\\ngentask.exe" OR Image="*\\windows\\system32\\taskhostw.exe" OR Image="*\\windows\\system32\\MoUsoCoreWorker.exe" OR Image="*\\windows\\system32\\wbem\\WMIADAP.exe" OR Image="*C:\\Windows\\Sysmon64.exe" OR Image="*C:\\Windows\\Sysmon.exe" OR Image="*C:\\Windows\\System32\\wbem\\unsecapp.exe" OR Image="*\\logman.exe" OR Image="*\\systeminfo.exe" OR Image="*\\nvcontainer.exe" OR Image="*C:\\Windows\\System32\\wbem\\WMIC.exe" OR Image="*\\explorer.exe" OR Image="*\\opera_autoupdate.exe" OR Image="*\\MsMpEng.exe" OR Image="*\\thor64.exe" OR Image="*\\thor.exe"))))) NOT (((Image="C:\\Program Files\\*" OR Image="C:\\Program Files (x86)\\*"))))) | table ComputerName,User,Image,ImageLoaded | eval sigma_attack_tags="attack.execution attack.t1047" | eval sigma_title="WMI Modules Loaded" | eval sigma_description="Detects non wmiprvse loading WMI modules"
dispatch.earliest_time = -24h@h
alert.track = 0

[WMI Persistence - Command Line Event Consumer - sysmon]
description = Detects WMI command line event consumers
search = index=sysmon* ((EventCode="7" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="C:\\Windows\\System32\\wbem\\WmiPrvSE.exe" ImageLoaded="*\\wbemcons.dll")) | eval sigma_attack_tags="attack.t1546.003 attack.persistence" | eval sigma_title="WMI Persistence - Command Line Event Consumer" | eval sigma_description="Detects WMI command line event consumers"
dispatch.earliest_time = -24h@h
alert.track = 0

[WMIC Loading Scripting Libraries - sysmon]
description = Detects threat actors proxy executing code and bypassing application controls by leveraging wmic and the `/FORMAT` argument switch to download and execute an XSL file (i.e js, vbs, etc).
search = index=sysmon* ((EventCode="7" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\wmic.exe" (ImageLoaded="*\\jscript.dll" OR ImageLoaded="*\\vbscript.dll"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1220" | eval sigma_title="WMIC Loading Scripting Libraries" | eval sigma_description="Detects threat actors proxy executing code and bypassing application controls by leveraging wmic and the `/FORMAT` argument switch to download and execute an XSL file (i.e js, vbs, etc)."
dispatch.earliest_time = -24h@h
alert.track = 0

[Wmiprvse Wbemcomn DLL Hijack - sysmon]
description = Detects a threat actor creating a file named `wbemcomn.dll` in the `C:\Windows\System32\wbem\` directory over the network and loading it for a WMI DLL Hijack scenario.
search = index=sysmon* ((EventCode="7" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\wmiprvse.exe" ImageLoaded="*\\wbem\\wbemcomn.dll")) | eval sigma_attack_tags="attack.execution attack.t1047 attack.lateral_movement attack.t1021.002" | eval sigma_title="Wmiprvse Wbemcomn DLL Hijack" | eval sigma_description="Detects a threat actor creating a file named `wbemcomn.dll` in the `C:\Windows\System32\wbem\` directory over the network and loading it for a WMI DLL Hijack scenario."
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious WSMAN Provider Image Loads - sysmon]
description = Detects signs of potential use of the WSMAN provider from uncommon processes locally and remote execution.
search = index=sysmon* ((((EventCode="7" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((((ImageLoaded="*\\WsmSvc.dll" OR ImageLoaded="*\\WsmAuto.dll" OR ImageLoaded="*\\Microsoft.WSMan.Management.ni.dll") OR (OriginalFileName="WsmSvc.dll" OR OriginalFileName="WSMANAUTOMATION.DLL" OR OriginalFileName="Microsoft.WSMan.Management.dll")) OR ((Image="*\\svchost.exe" OriginalFileName="WsmWmiPl.dll"))) NOT ((((Image="*\\powershell.exe" OR Image="*C:\\Windows\\System32\\sdiagnhost.exe" OR Image="*C:\\Windows\\System32\\services.exe"))) OR (((CommandLine="*svchost.exe -k netsvcs -p -s BITS*" OR CommandLine="*svchost.exe -k GraphicsPerfSvcGroup -s GraphicsPerfSvc*" OR CommandLine="*svchost.exe -k NetworkService -p -s Wecsvc*" OR CommandLine="*svchost.exe -k netsvcs*"))) OR (((Image="C:\\Windows\\Microsoft.NET\\Framework64\\v*" OR Image="C:\\Windows\\Microsoft.NET\\Framework\\v*") Image="*\\mscorsvw.exe")) OR (((Image="C:\\Windows\\System32\\Configure-SMRemoting.exe" OR Image="C:\\Windows\\System32\\ServerManager.exe"))) OR ((Image="C:\\Windows\\Temp\\asgard2-agent\\*")) OR ((Image="C:\\Program Files\\Citrix\\*")) OR ((Image="*\\powershell_ise.exe")) OR ((Image="C:\\$WINDOWS.~BT\\Sources\\*"))))) NOT (((Image="*\\svchost.exe" NOT CommandLine="*"))))) | eval sigma_attack_tags="attack.execution attack.t1059.001 attack.lateral_movement attack.t1021.003" | eval sigma_title="Suspicious WSMAN Provider Image Loads" | eval sigma_description="Detects signs of potential use of the WSMAN provider from uncommon processes locally and remote execution."
dispatch.earliest_time = -24h@h
alert.track = 0

[Microsoft Binary Github Communication - sysmon]
description = Detects an executable in the Windows folder accessing github.com
search = index=sysmon* ((EventCode="3" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Initiated="true" (DestinationHostname="*.github.com" OR DestinationHostname="*.githubusercontent.com") Image="C:\\Windows\\*")) | eval sigma_attack_tags="attack.lateral_movement attack.t1105 attack.exfiltration attack.t1567.001" | eval sigma_title="Microsoft Binary Github Communication" | eval sigma_description="Detects an executable in the Windows folder accessing github.com"
dispatch.earliest_time = -24h@h
alert.track = 0

[Microsoft Binary Suspicious Communication Endpoint - sysmon]
description = Detects an executable in the Windows folder accessing suspicious domains
search = index=sysmon* ((EventCode="3" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Initiated="true" (DestinationHostname="*dl.dropboxusercontent.com" OR DestinationHostname="*.pastebin.com" OR DestinationHostname="*.githubusercontent.com" OR DestinationHostname="*cdn.discordapp.com/attachments/" OR DestinationHostname="*mediafire.com" OR DestinationHostname="*mega.nz" OR DestinationHostname="*ddns.net" OR DestinationHostname="*.paste.ee" OR DestinationHostname="*.hastebin.com/raw/" OR DestinationHostname="*.ghostbin.co/" OR DestinationHostname="*ufile.io" OR DestinationHostname="*anonfiles.com" OR DestinationHostname="*send.exploit.in" OR DestinationHostname="*transfer.sh" OR DestinationHostname="*privatlab.net" OR DestinationHostname="*privatlab.com" OR DestinationHostname="*sendspace.com" OR DestinationHostname="*pastetext.net" OR DestinationHostname="*pastebin.pl" OR DestinationHostname="*paste.ee") (Image="C:\\Windows\\*" OR Image="C:\\Users\\Public\\*"))) | eval sigma_attack_tags="attack.lateral_movement attack.t1105" | eval sigma_title="Microsoft Binary Suspicious Communication Endpoint" | eval sigma_description="Detects an executable in the Windows folder accessing suspicious domains"
dispatch.earliest_time = -24h@h
alert.track = 0

[Certutil Initiated Connection - sysmon]
description = Detects a network connection intitiated by the certutil.exe tool. Attackers can abuse `certutil.exe` to download malware or offensive security tools.
search = index=sysmon* ((EventCode="3" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\certutil.exe" Initiated="true" (DestinationPort="80" OR DestinationPort="443" OR DestinationPort="135" OR DestinationPort="445"))) | eval sigma_attack_tags="attack.command_and_control attack.t1105" | eval sigma_title="Certutil Initiated Connection" | eval sigma_description="Detects a network connection intitiated by the certutil.exe tool. Attackers can abuse `certutil.exe` to download malware or offensive security tools."
dispatch.earliest_time = -24h@h
alert.track = 0

[Windows Crypto Mining Pool Connections - sysmon]
description = Detects process connections to a Monero crypto mining pool
search = index=sysmon* ((EventCode="3" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (DestinationHostname="pool.minexmr.com" OR DestinationHostname="fr.minexmr.com" OR DestinationHostname="de.minexmr.com" OR DestinationHostname="sg.minexmr.com" OR DestinationHostname="ca.minexmr.com" OR DestinationHostname="us-west.minexmr.com" OR DestinationHostname="pool.supportxmr.com" OR DestinationHostname="mine.c3pool.com" OR DestinationHostname="xmr-eu1.nanopool.org" OR DestinationHostname="xmr-eu2.nanopool.org" OR DestinationHostname="xmr-us-east1.nanopool.org" OR DestinationHostname="xmr-us-west1.nanopool.org" OR DestinationHostname="xmr-asia1.nanopool.org" OR DestinationHostname="xmr-jp1.nanopool.org" OR DestinationHostname="xmr-au1.nanopool.org" OR DestinationHostname="xmr.2miners.com" OR DestinationHostname="xmr.hashcity.org" OR DestinationHostname="xmr.f2pool.com" OR DestinationHostname="xmrpool.eu" OR DestinationHostname="pool.hashvault.pro" OR DestinationHostname="moneroocean.stream" OR DestinationHostname="monerocean.stream"))) | eval sigma_attack_tags="attack.impact attack.t1496" | eval sigma_title="Windows Crypto Mining Pool Connections" | eval sigma_description="Detects process connections to a Monero crypto mining pool"
dispatch.earliest_time = -24h@h
alert.track = 0

[Dead Drop Resolvers - sysmon]
description = Detects an executable, which is not an internet browser, making DNS request to legit popular websites, which were seen to be used as dead drop resolvers in previous attacks.
search = index=sysmon* ((((EventCode="3" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Initiated="true" (DestinationHostname="*cdn.discordapp.com" OR DestinationHostname="*pastebin.com" OR DestinationHostname="*youtube.com" OR DestinationHostname="*technet.microsoft.com" OR DestinationHostname="*facebook.com" OR DestinationHostname="*.cloudflare.com" OR DestinationHostname="*docs.google.com" OR DestinationHostname="*steamcommunity.com" OR DestinationHostname="*reddit.com" OR DestinationHostname="*fotolog.com" OR DestinationHostname="*twitter.com" OR DestinationHostname="*imgur.com" OR DestinationHostname="*feeds.rapidfeeds.com" OR DestinationHostname="*livejournal.com" OR DestinationHostname="*.githubusercontent.com" OR DestinationHostname="*pastetext.net" OR DestinationHostname="*pastebin.pl" OR DestinationHostname="*paste.ee"))) NOT ((((Image="*\\iexplore.exe" OR Image="*\\msedge.exe" OR Image="*\\edge.exe" OR Image="*\\opera.exe" OR Image="*\\brave.exe" OR Image="*\\vivaldi.exe" OR Image="*\\whale.exe" OR Image="*\\chrome.exe" OR Image="*\\firefox.exe"))) OR (((Image="*\\MsMpEng.exe" OR Image="*\\MsSense.exe" OR Image="*\\PRTG Probe.exe" OR Image="*\\Engine.exe" OR Image="*\\msedgewebview2.exe")))))) | eval sigma_attack_tags="attack.command_and_control attack.t1102 attack.t1102.001" | eval sigma_title="Dead Drop Resolvers" | eval sigma_description="Detects an executable, which is not an internet browser, making DNS request to legit popular websites, which were seen to be used as dead drop resolvers in previous attacks."
dispatch.earliest_time = -24h@h
alert.track = 0

[Dllhost Internet Connection - sysmon]
description = Detects Dllhost that communicates with public IP addresses
search = index=sysmon* ((((EventCode="3" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\dllhost.exe" Initiated="true")) NOT ((((DestinationIp="10.*" OR DestinationIp="192.168.*" OR DestinationIp="172.16.*" OR DestinationIp="172.17.*" OR DestinationIp="172.18.*" OR DestinationIp="172.19.*" OR DestinationIp="172.20.*" OR DestinationIp="172.21.*" OR DestinationIp="172.22.*" OR DestinationIp="172.23.*" OR DestinationIp="172.24.*" OR DestinationIp="172.25.*" OR DestinationIp="172.26.*" OR DestinationIp="172.27.*" OR DestinationIp="172.28.*" OR DestinationIp="172.29.*" OR DestinationIp="172.30.*" OR DestinationIp="172.31.*" OR DestinationIp="169.254.*" OR DestinationIp="127.*"))) OR (((DestinationIp="::1*" OR DestinationIp="0:0:0:0:0:0:0:1*" OR DestinationIp="fe80:*" OR DestinationIp="fc*" OR DestinationIp="fd*"))) OR (((DestinationIp="20.184.*" OR DestinationIp="20.185.*" OR DestinationIp="20.186.*" OR DestinationIp="20.187.*" OR DestinationIp="20.188.*" OR DestinationIp="20.189.*" OR DestinationIp="20.190.*" OR DestinationIp="20.191.*" OR DestinationIp="23.79.*" OR DestinationIp="51.10.*" OR DestinationIp="51.103.*" OR DestinationIp="51.104.*" OR DestinationIp="51.105.*" OR DestinationIp="52.239.*")))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218 attack.execution attack.t1559.001" | eval sigma_title="Dllhost Internet Connection" | eval sigma_description="Detects Dllhost that communicates with public IP addresses"
dispatch.earliest_time = -24h@h
alert.track = 0

[Equation Editor Network Connection - sysmon]
description = Detects network connections from Equation Editor
search = index=sysmon* ((EventCode="3" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\eqnedt32.exe")) | eval sigma_attack_tags="attack.execution attack.t1203" | eval sigma_title="Equation Editor Network Connection" | eval sigma_description="Detects network connections from Equation Editor"
dispatch.earliest_time = -24h@h
alert.track = 0

[Excel Network Connections - sysmon]
description = Detects an Excel process that opens suspicious network connections to non-private IP addresses, and attempts to cover CVE-2021-42292.
You will likely have to tune this rule for your organization, but it is certainly something you should look for and could have applications for malicious activity beyond CVE-2021-42292.

search = index=sysmon* ((((EventCode="3" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\excel.exe" Initiated="true" DestinationIsIpv6="false")) NOT (((DestinationIp="10.*" OR DestinationIp="192.168.*" OR DestinationIp="172.16.*" OR DestinationIp="172.17.*" OR DestinationIp="172.18.*" OR DestinationIp="172.19.*" OR DestinationIp="172.20.*" OR DestinationIp="172.21.*" OR DestinationIp="172.22.*" OR DestinationIp="172.23.*" OR DestinationIp="172.24.*" OR DestinationIp="172.25.*" OR DestinationIp="172.26.*" OR DestinationIp="172.27.*" OR DestinationIp="172.28.*" OR DestinationIp="172.29.*" OR DestinationIp="172.30.*" OR DestinationIp="172.31.*" OR DestinationIp="127.0.0.1*"))))) | eval sigma_attack_tags="attack.execution attack.t1203" | eval sigma_title="Excel Network Connections" | eval sigma_description="Detects an Excel process that opens suspicious network connections to non-private IP addresses, and attempts to cover CVE-2021-42292.
You will likely have to tune this rule for your organization, but it is certainly something you should look for and could have applications for malicious activity beyond CVE-2021-42292.
"
dispatch.earliest_time = -24h@h
alert.track = 0

[HH.EXE Network Connections - sysmon]
description = Detects network connections made by the 'hh.exe' process, which could indicate the execution/download of remotely hosted .chm files
search = index=sysmon* ((EventCode="3" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\hh.exe" Initiated="true" (DestinationPort="80" OR DestinationPort="443" OR DestinationPort="135" OR DestinationPort="445"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218.001" | eval sigma_title="HH.EXE Network Connections" | eval sigma_description="Detects network connections made by the 'hh.exe' process, which could indicate the execution/download of remotely hosted .chm files"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Typical Malware Back Connect Ports - sysmon]
description = Detects programs that connect to typical malware back connect ports based on statistical analysis from two different sandbox system databases
search = index=sysmon* ((((EventCode="3" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Initiated="true" (DestinationPort="4443" OR DestinationPort="2448" OR DestinationPort="8143" OR DestinationPort="1777" OR DestinationPort="1443" OR DestinationPort="243" OR DestinationPort="65535" OR DestinationPort="13506" OR DestinationPort="3360" OR DestinationPort="200" OR DestinationPort="198" OR DestinationPort="49180" OR DestinationPort="13507" OR DestinationPort="6625" OR DestinationPort="4444" OR DestinationPort="4438" OR DestinationPort="1904" OR DestinationPort="13505" OR DestinationPort="13504" OR DestinationPort="12102" OR DestinationPort="9631" OR DestinationPort="5445" OR DestinationPort="2443" OR DestinationPort="777" OR DestinationPort="13394" OR DestinationPort="13145" OR DestinationPort="12103" OR DestinationPort="5552" OR DestinationPort="3939" OR DestinationPort="3675" OR DestinationPort="666" OR DestinationPort="473" OR DestinationPort="5649" OR DestinationPort="4455" OR DestinationPort="4433" OR DestinationPort="1817" OR DestinationPort="100" OR DestinationPort="65520" OR DestinationPort="1960" OR DestinationPort="1515" OR DestinationPort="743" OR DestinationPort="700" OR DestinationPort="14154" OR DestinationPort="14103" OR DestinationPort="14102" OR DestinationPort="12322" OR DestinationPort="10101" OR DestinationPort="7210" OR DestinationPort="4040" OR DestinationPort="9943"))) NOT (((Image="*\\Program Files*")) OR (((DestinationIp="10.*" OR DestinationIp="192.168.*" OR DestinationIp="172.16.*" OR DestinationIp="172.17.*" OR DestinationIp="172.18.*" OR DestinationIp="172.19.*" OR DestinationIp="172.20.*" OR DestinationIp="172.21.*" OR DestinationIp="172.22.*" OR DestinationIp="172.23.*" OR DestinationIp="172.24.*" OR DestinationIp="172.25.*" OR DestinationIp="172.26.*" OR DestinationIp="172.27.*" OR DestinationIp="172.28.*" OR DestinationIp="172.29.*" OR DestinationIp="172.30.*" OR DestinationIp="172.31.*" OR DestinationIp="127.*")))))) | eval sigma_attack_tags="attack.command_and_control attack.t1571" | eval sigma_title="Suspicious Typical Malware Back Connect Ports" | eval sigma_description="Detects programs that connect to typical malware back connect ports based on statistical analysis from two different sandbox system databases"
dispatch.earliest_time = -24h@h
alert.track = 0

[Communication To Mega.nz - sysmon]
description = Detects an executable accessing mega.co.nz, which could be a sign of forbidden file sharing use of data exfiltration by malicious actors
search = index=sysmon* ((EventCode="3" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Initiated="true" DestinationHostname="*api.mega.co.nz")) | eval sigma_attack_tags="attack.exfiltration attack.t1567.001" | eval sigma_title="Communication To Mega.nz" | eval sigma_description="Detects an executable accessing mega.co.nz, which could be a sign of forbidden file sharing use of data exfiltration by malicious actors"
dispatch.earliest_time = -24h@h
alert.track = 0

[Msiexec Initiated Connection - sysmon]
description = Adversaries may abuse msiexec.exe to proxy execution of malicious payloads.
Msiexec.exe is the command-line utility for the Windows Installer and is thus commonly associated with executing installation packages (.msi)

search = index=sysmon* ((EventCode="3" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Initiated="true" Image="*\\msiexec.exe")) | eval sigma_attack_tags="attack.defense_evasion attack.t1218.007" | eval sigma_title="Msiexec Initiated Connection" | eval sigma_description="Adversaries may abuse msiexec.exe to proxy execution of malicious payloads.
Msiexec.exe is the command-line utility for the Windows Installer and is thus commonly associated with executing installation packages (.msi)
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Communication To Ngrok.Io - sysmon]
description = Detects an executable accessing ngrok.io, which could be a sign of forbidden exfiltration of data exfiltration by malicious actors
search = index=sysmon* ((EventCode="3" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Initiated="true" DestinationHostname="*.ngrok.io")) | eval sigma_attack_tags="attack.exfiltration attack.t1567.001" | eval sigma_title="Communication To Ngrok.Io" | eval sigma_description="Detects an executable accessing ngrok.io, which could be a sign of forbidden exfiltration of data exfiltration by malicious actors"
dispatch.earliest_time = -24h@h
alert.track = 0

[Communication To Ngrok Tunneling Service - sysmon]
description = Detects an executable accessing an ngrok tunneling endpoint, which could be a sign of forbidden exfiltration of data exfiltration by malicious actors
search = index=sysmon* ((EventCode="3" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (DestinationHostname="*tunnel.us.ngrok.com*" OR DestinationHostname="*tunnel.eu.ngrok.com*" OR DestinationHostname="*tunnel.ap.ngrok.com*" OR DestinationHostname="*tunnel.au.ngrok.com*" OR DestinationHostname="*tunnel.sa.ngrok.com*" OR DestinationHostname="*tunnel.jp.ngrok.com*" OR DestinationHostname="*tunnel.in.ngrok.com*"))) | eval sigma_attack_tags="attack.exfiltration attack.command_and_control attack.t1567 attack.t1568.002 attack.t1572 attack.t1090 attack.t1102 attack.s0508" | eval sigma_title="Communication To Ngrok Tunneling Service" | eval sigma_description="Detects an executable accessing an ngrok tunneling endpoint, which could be a sign of forbidden exfiltration of data exfiltration by malicious actors"
dispatch.earliest_time = -24h@h
alert.track = 0

[Notepad Making Network Connection - sysmon]
description = Detects suspicious network connection by Notepad
search = index=sysmon* ((((EventCode="3" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) Image="*\\notepad.exe" NOT ((DestinationPort="9100")))) | eval sigma_attack_tags="attack.command_and_control attack.execution attack.defense_evasion attack.t1055" | eval sigma_title="Notepad Making Network Connection" | eval sigma_description="Detects suspicious network connection by Notepad"
dispatch.earliest_time = -24h@h
alert.track = 0

[PowerShell Network Connections - sysmon]
description = Detects a Powershell process that opens network connections - check for suspicious target ports and target systems - adjust to your environment (e.g. extend filters with company's ip range')
search = index=sysmon* ((((EventCode="3" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((Image="*\\powershell.exe" OR Image="*\\pwsh.exe") Initiated="true" DestinationIsIpv6="false")) NOT ((((DestinationIp="10.*" OR DestinationIp="192.168.*" OR DestinationIp="172.16.*" OR DestinationIp="172.17.*" OR DestinationIp="172.18.*" OR DestinationIp="172.19.*" OR DestinationIp="172.20.*" OR DestinationIp="172.21.*" OR DestinationIp="172.22.*" OR DestinationIp="172.23.*" OR DestinationIp="172.24.*" OR DestinationIp="172.25.*" OR DestinationIp="172.26.*" OR DestinationIp="172.27.*" OR DestinationIp="172.28.*" OR DestinationIp="172.29.*" OR DestinationIp="172.30.*" OR DestinationIp="172.31.*" OR DestinationIp="127.0.0.1*") (User="*AUTHORI*" OR User="*AUTORI*"))) OR (((DestinationIp="::1*" OR DestinationIp="0:0:0:0:0:0:0:1*" OR DestinationIp="fe80:*" OR DestinationIp="fc*" OR DestinationIp="fd*"))) OR (((DestinationIp="20.184.*" OR DestinationIp="20.185.*" OR DestinationIp="20.186.*" OR DestinationIp="20.187.*" OR DestinationIp="20.188.*" OR DestinationIp="20.189.*" OR DestinationIp="20.190.*" OR DestinationIp="20.191.*" OR DestinationIp="23.79.*" OR DestinationIp="51.10.*" OR DestinationIp="51.103.*" OR DestinationIp="51.104.*" OR DestinationIp="51.105.*" OR DestinationIp="52.239.*")))))) | eval sigma_attack_tags="attack.execution attack.t1059.001" | eval sigma_title="PowerShell Network Connections" | eval sigma_description="Detects a Powershell process that opens network connections - check for suspicious target ports and target systems - adjust to your environment (e.g. extend filters with company's ip range')"
dispatch.earliest_time = -24h@h
alert.track = 0

[RDP Over Reverse SSH Tunnel - sysmon]
description = Detects svchost hosting RDP termsvcs communicating with the loopback address and on TCP port 3389
search = index=sysmon* ((((EventCode="3" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\svchost.exe" Initiated="true" SourcePort="3389")) (DestinationIp="127.*" OR DestinationIp="::1"))) | eval sigma_attack_tags="attack.command_and_control attack.t1572 attack.lateral_movement attack.t1021.001 car.2013-07-002" | eval sigma_title="RDP Over Reverse SSH Tunnel" | eval sigma_description="Detects svchost hosting RDP termsvcs communicating with the loopback address and on TCP port 3389"
dispatch.earliest_time = -24h@h
alert.track = 0

[RDP to HTTP or HTTPS Target Ports - sysmon]
description = Detects svchost hosting RDP termsvcs communicating to target systems on TCP port 80 or 443
search = index=sysmon* ((EventCode="3" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\svchost.exe" Initiated="true" SourcePort="3389" (DestinationPort="80" OR DestinationPort="443"))) | eval sigma_attack_tags="attack.command_and_control attack.t1572 attack.lateral_movement attack.t1021.001 car.2013-07-002" | eval sigma_title="RDP to HTTP or HTTPS Target Ports" | eval sigma_description="Detects svchost hosting RDP termsvcs communicating to target systems on TCP port 80 or 443"
dispatch.earliest_time = -24h@h
alert.track = 0

[Regsvr32 Network Activity - sysmon]
description = Detects network connections and DNS queries initiated by Regsvr32.exe
search = index=sysmon* ((EventCode="3" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\regsvr32.exe")) | table ComputerName,User,Image,DestinationIp,DestinationPort | eval sigma_attack_tags="attack.execution attack.t1559.001 attack.defense_evasion attack.t1218.010" | eval sigma_title="Regsvr32 Network Activity" | eval sigma_description="Detects network connections and DNS queries initiated by Regsvr32.exe"
dispatch.earliest_time = -24h@h
alert.track = 0

[Remote PowerShell Session (Network) - sysmon]
description = Detects remote PowerShell connections by monitoring network outbound connections to ports 5985 or 5986 from a non-network service account.
search = index=sysmon* ((((EventCode="3" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((DestinationPort="5985" OR DestinationPort="5986") Initiated="true")) NOT ((((User="*NETWORK SERVICE*" OR User="*NETZWERKDIENST*" OR User="*SERVIZIO DI RETE*" OR User="*SERVICIO DE RED*")) OR ((User="*SERVICE R*" User="*SEAU*")) OR (SourceIp="0:0:*") OR ((Image="C:\\Program Files\\Avast Software\\Avast\\AvastSvc.exe" OR Image="C:\\Program Files (x86)\\Avast Software\\Avast\\AvastSvc.exe"))) OR (((SourceIp="::1" OR SourceIp="127.0.0.1") (DestinationIp="::1" OR DestinationIp="127.0.0.1")))))) | eval sigma_attack_tags="attack.execution attack.t1059.001 attack.lateral_movement attack.t1021.006" | eval sigma_title="Remote PowerShell Session (Network)" | eval sigma_description="Detects remote PowerShell connections by monitoring network outbound connections to ports 5985 or 5986 from a non-network service account."
dispatch.earliest_time = -24h@h
alert.track = 0

[Rundll32 Internet Connection - sysmon]
description = Detects a rundll32 that communicates with public IP addresses
search = index=sysmon* ((((EventCode="3" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\rundll32.exe" Initiated="true")) NOT ((((DestinationIp="10.*" OR DestinationIp="192.168.*" OR DestinationIp="172.16.*" OR DestinationIp="172.17.*" OR DestinationIp="172.18.*" OR DestinationIp="172.19.*" OR DestinationIp="172.20.*" OR DestinationIp="172.21.*" OR DestinationIp="172.22.*" OR DestinationIp="172.23.*" OR DestinationIp="172.24.*" OR DestinationIp="172.25.*" OR DestinationIp="172.26.*" OR DestinationIp="172.27.*" OR DestinationIp="172.28.*" OR DestinationIp="172.29.*" OR DestinationIp="172.30.*" OR DestinationIp="172.31.*" OR DestinationIp="127.*" OR DestinationIp="20.*" OR DestinationIp="51.103.*" OR DestinationIp="51.104.*" OR DestinationIp="51.105.*")) OR (CommandLine="*PcaSvc.dll,PcaPatchSdbTask*")) OR ((ParentImage="C:\\Windows\\System32\\svchost.exe" DestinationPort="443"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218.011 attack.execution" | eval sigma_title="Rundll32 Internet Connection" | eval sigma_description="Detects a rundll32 that communicates with public IP addresses"
dispatch.earliest_time = -24h@h
alert.track = 0

[Script Initiated Connection to Non-Local Network - sysmon]
description = Detects a script interpreter wscript/cscript opening a network connection to a non-local network. Adversaries may use script to download malicious payloads.
search = index=sysmon* ((((EventCode="3" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Initiated="true" (Image="*\\wscript.exe" OR Image="*\\cscript.exe"))) NOT ((((DestinationIp="127.*" OR DestinationIp="10.*" OR DestinationIp="172.*" OR DestinationIp="192.*" OR DestinationIp="169.254.*" OR DestinationIp="20.*"))) OR (((DestinationIp="::1*" OR DestinationIp="0:0:0:0:0:0:0:1*" OR DestinationIp="fe80:*" OR DestinationIp="fc*" OR DestinationIp="fd*")))))) | eval sigma_attack_tags="attack.command_and_control attack.t1105" | eval sigma_title="Script Initiated Connection to Non-Local Network" | eval sigma_description="Detects a script interpreter wscript/cscript opening a network connection to a non-local network. Adversaries may use script to download malicious payloads."
dispatch.earliest_time = -24h@h
alert.track = 0

[Script Initiated Connection - sysmon]
description = Detects a script interpreter wscript/cscript opening a network connection. Adversaries may use script to download malicious payloads.
search = index=sysmon* ((EventCode="3" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Initiated="true" (Image="*\\wscript.exe" OR Image="*\\cscript.exe"))) | eval sigma_attack_tags="attack.command_and_control attack.t1105" | eval sigma_title="Script Initiated Connection" | eval sigma_description="Detects a script interpreter wscript/cscript opening a network connection. Adversaries may use script to download malicious payloads."
dispatch.earliest_time = -24h@h
alert.track = 0

[Silenttrinity Stager Msbuild Activity - sysmon]
description = Detects a possible remote connections to Silenttrinity c2
search = index=sysmon* ((EventCode="3" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\msbuild.exe" (DestinationPort="80" OR DestinationPort="443") Initiated="true")) | eval sigma_attack_tags="attack.execution attack.t1127.001" | eval sigma_title="Silenttrinity Stager Msbuild Activity" | eval sigma_description="Detects a possible remote connections to Silenttrinity c2"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Network Connection Binary No CommandLine - sysmon]
description = Detects suspicious network connections made by a well-known Windows binary run with no command line parameters
search = index=sysmon* ((((EventCode="3" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Initiated="true" (Image="*\\regsvr32.exe" OR Image="*\\rundll32.exe" OR Image="*\\dllhost.exe") (CommandLine="*\\regsvr32.exe" OR CommandLine="*\\rundll32.exe" OR CommandLine="*\\dllhost.exe"))) NOT (((CommandLine="")) OR ((NOT CommandLine="*"))))) | eval sigma_attack_tags="attack.defense_evasion" | eval sigma_title="Suspicious Network Connection Binary No CommandLine" | eval sigma_description="Detects suspicious network connections made by a well-known Windows binary run with no command line parameters"
dispatch.earliest_time = -24h@h
alert.track = 0

[Cmstp Making Network Connection - sysmon]
description = Detects suspicious network connection by Cmstp
search = index=sysmon* ((EventCode="3" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\cmstp.exe" Initiated="true")) | eval sigma_attack_tags="attack.defense_evasion attack.t1218.003" | eval sigma_title="Cmstp Making Network Connection" | eval sigma_description="Detects suspicious network connection by Cmstp"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Dropbox API Usage - sysmon]
description = Detects an executable that isn't dropbox but communicates with the Dropbox API
search = index=sysmon* ((((EventCode="3" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Initiated="true" (DestinationHostname="*api.dropboxapi.com" OR DestinationHostname="*content.dropboxapi.com"))) NOT ((Image="*\\Dropbox*")))) | eval sigma_attack_tags="" | eval sigma_title="Suspicious Dropbox API Usage" | eval sigma_description="Detects an executable that isn't dropbox but communicates with the Dropbox API"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Epmap Connection - sysmon]
description = Detects suspicious 'epmap' connection to a remote computer via remote procedure call (RPC)
search = index=sysmon* ((((EventCode="3" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Protocol="tcp" Initiated="true" DestinationPort="135")) NOT (((Image="C:\\Windows\\*" OR Image="C:\\ProgramData\\Amazon\\SSM\\Update\\amazon-ssm-agent-updater*"))))) | eval sigma_attack_tags="attack.lateral_movement" | eval sigma_title="Suspicious Epmap Connection" | eval sigma_description="Detects suspicious 'epmap' connection to a remote computer via remote procedure call (RPC)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Outbound Kerberos Connection - sysmon]
description = Detects suspicious outbound network activity via kerberos default port indicating possible lateral movement or first stage PrivEsc via delegation.
search = index=sysmon* ((((EventCode="3" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((DestinationPort="88" Initiated="true")) NOT ((((Image="C:\\Windows\\System32\\lsass.exe" OR Image="C:\\Program Files\\Google\\Chrome\\Application\\chrome.exe" OR Image="C:\\Program Files\\Mozilla Firefox\\firefox.exe")))))) | eval sigma_attack_tags="attack.credential_access attack.t1558 attack.lateral_movement attack.t1550.003" | eval sigma_title="Suspicious Outbound Kerberos Connection" | eval sigma_description="Detects suspicious outbound network activity via kerberos default port indicating possible lateral movement or first stage PrivEsc via delegation."
dispatch.earliest_time = -24h@h
alert.track = 0

[Microsoft Sync Center Suspicious Network Connections - sysmon]
description = Detects suspicious connections from Microsoft Sync Center to non-private IPs.
search = index=sysmon* ((((EventCode="3" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) Image="*\\mobsync.exe" NOT (((DestinationIp="10.*" OR DestinationIp="192.168.*" OR DestinationIp="172.16.*" OR DestinationIp="172.17.*" OR DestinationIp="172.18.*" OR DestinationIp="172.19.*" OR DestinationIp="172.20.*" OR DestinationIp="172.21.*" OR DestinationIp="172.22.*" OR DestinationIp="172.23.*" OR DestinationIp="172.24.*" OR DestinationIp="172.25.*" OR DestinationIp="172.26.*" OR DestinationIp="172.27.*" OR DestinationIp="172.28.*" OR DestinationIp="172.29.*" OR DestinationIp="172.30.*" OR DestinationIp="172.31.*") DestinationIsIpv6="false")))) | eval sigma_attack_tags="attack.t1055 attack.t1218 attack.execution attack.defense_evasion" | eval sigma_title="Microsoft Sync Center Suspicious Network Connections" | eval sigma_description="Detects suspicious connections from Microsoft Sync Center to non-private IPs."
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Program Location with Network Connections - sysmon]
description = Detects programs with network connections running in suspicious files system locations
search = index=sysmon* ((((EventCode="3" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\Users\\All Users\\*" OR Image="*\\Users\\Default\\*" OR Image="*\\Users\\Public\\*" OR Image="*\\Users\\Contacts\\*" OR Image="*\\Users\\Searches\\*" OR Image="*\\config\\systemprofile\\*" OR Image="*\\Windows\\Fonts\\*" OR Image="*\\Windows\\IME\\*" OR Image="*\\Windows\\addins\\*") OR Image="*\\$Recycle.bin" OR Image="C:\\Perflogs\\*") NOT (((Image="C:\\Users\\Public\\IBM\\ClientSolutions\\Start_Programs\\*"))))) | eval sigma_attack_tags="attack.command_and_control attack.t1105" | eval sigma_title="Suspicious Program Location with Network Connections" | eval sigma_description="Detects programs with network connections running in suspicious files system locations"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Outbound RDP Connections - sysmon]
description = Detects Non-Standard Tools Connecting to TCP port 3389 indicating possible lateral movement
search = index=sysmon* ((((EventCode="3" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((DestinationPort="3389" Initiated="true")) NOT (((Image="*\\mstsc.exe" OR Image="*\\RTSApp.exe" OR Image="*\\RTS2App.exe" OR Image="*\\RDCMan.exe" OR Image="*\\ws_TunnelService.exe" OR Image="*\\RSSensor.exe" OR Image="*\\RemoteDesktopManagerFree.exe" OR Image="*\\RemoteDesktopManager.exe" OR Image="*\\RemoteDesktopManager64.exe" OR Image="*\\mRemoteNG.exe" OR Image="*\\mRemote.exe" OR Image="*\\Terminals.exe" OR Image="*\\spiceworks-finder.exe" OR Image="*\\FSDiscovery.exe" OR Image="*\\FSAssessment.exe" OR Image="*\\MobaRTE.exe" OR Image="*\\chrome.exe" OR Image="*\\System32\\dns.exe" OR Image="*\\thor.exe" OR Image="*\\thor64.exe" OR Image="*\\Passwordstate.exe" OR Image="*\\Avast Software\\Avast\\AvastSvc.exe" OR Image="*\\Ranger\\SentinelRanger.exe" OR Image="*\\Avast\\AvastSvc.exe")) OR (Image="C:\\Program Files\\SplunkUniversalForwarder\\bin\\*") OR (Image="C:\\Program Files\\Mozilla Firefox\\firefox.exe")))) | eval sigma_attack_tags="attack.lateral_movement attack.t1021.001 car.2013-07-002" | eval sigma_title="Suspicious Outbound RDP Connections" | eval sigma_description="Detects Non-Standard Tools Connecting to TCP port 3389 indicating possible lateral movement"
dispatch.earliest_time = -24h@h
alert.track = 0

[Wuauclt Network Connection - sysmon]
description = Detects the use of the Windows Update Client binary (wuauclt.exe) to proxy execute code and making a network connections.
One could easily make the DLL spawn a new process and inject to it to proxy the network connection and bypass this rule.

search = index=sysmon* ((((EventCode="3" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) Image="*wuauclt*" NOT ((((DestinationIp="20.184.*" OR DestinationIp="20.185.*" OR DestinationIp="20.186.*" OR DestinationIp="20.187.*" OR DestinationIp="20.188.*" OR DestinationIp="20.189.*" OR DestinationIp="20.190.*" OR DestinationIp="20.191.*" OR DestinationIp="23.79.*" OR DestinationIp="51.10.*" OR DestinationIp="51.103.*" OR DestinationIp="51.104.*" OR DestinationIp="51.105.*" OR DestinationIp="52.239.*"))) OR ((CommandLine="*\\UpdateDeploy.dll /ClassId *"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218" | eval sigma_title="Wuauclt Network Connection" | eval sigma_description="Detects the use of the Windows Update Client binary (wuauclt.exe) to proxy execute code and making a network connections.
One could easily make the DLL spawn a new process and inject to it to proxy the network connection and bypass this rule.
"
dispatch.earliest_time = -24h@h
alert.track = 0

[CMSTP Execution Process Access - sysmon]
description = Detects various indicators of Microsoft Connection Manager Profile Installer execution
search = index=sysmon* ((EventCode="10" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CallTrace="*cmlua.dll*")) | table CommandLine,ParentCommandLine,Details | eval sigma_attack_tags="attack.defense_evasion attack.t1218.003 attack.execution attack.t1559.001 attack.g0069 attack.g0080 car.2019-04-001" | eval sigma_title="CMSTP Execution Process Access" | eval sigma_description="Detects various indicators of Microsoft Connection Manager Profile Installer execution"
dispatch.earliest_time = -24h@h
alert.track = 0

[Credential Dumping Tools Accessing LSASS Memory - sysmon]
description = Detects processes requesting access to LSASS memory via suspicious access masks. This is typical for credentials dumping tools
search = index=sysmon* ((((EventCode="10" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((TargetImage="*\\lsass.exe" (GrantedAccess="0x40*" OR GrantedAccess="0x100000*" OR GrantedAccess="0x1410*" OR GrantedAccess="0x1438*" OR GrantedAccess="0x143a*" OR GrantedAccess="0x1418*" OR GrantedAccess="0x1f0fff*" OR GrantedAccess="0x1f1fff*" OR GrantedAccess="0x1f2fff*" OR GrantedAccess="0x1f3fff*"))) NOT ((((SourceImage="C:\\WINDOWS\\system32\\taskmgr.exe" OR SourceImage="C:\\Windows\\System32\\perfmon.exe"))) OR (((SourceImage="C:\\Program Files\\*" OR SourceImage="C:\\Program Files (x86)\\*") (GrantedAccess="0x1410" OR GrantedAccess="0x410"))) OR (((SourceImage="C:\\ProgramData\\Microsoft\\Windows Defender\\*" OR SourceImage="C:\\Program Files\\Windows Defender\\*") SourceImage="*\\MsMpEng.exe")) OR ((SourceImage="C:\\Windows\\System32\\svchost.exe" (CallTrace="*|C:\\ProgramData\\Microsoft\\Windows Defender\\Definition Updates\\{*" CallTrace="*}\\mpengine.dll+*") GrantedAccess="0x1418")) OR (((CallTrace="*|c:\\program files\\windows defender\\mprtp.dll*" OR CallTrace="*|c:\\program files\\windows defender\\MpClient.dll*"))) OR ((SourceImage="C:\\Program Files\\WindowsApps\\*" SourceImage="*\\GamingServices.exe" (GrantedAccess="0x1410" OR GrantedAccess="0x410"))) OR (((SourceImage="*\\PROCEXP64.EXE" OR SourceImage="*\\PROCEXP.EXE" OR SourceImage="*C:\\WINDOWS\\system32\\taskhostw.exe" OR SourceImage="*\\MBAMInstallerService.exe") (GrantedAccess="0x1410" OR GrantedAccess="0x410" OR GrantedAccess="0x40"))) OR (((SourceImage="C:\\WINDOWS\\system32\\wbem\\wmiprvse.exe" OR SourceImage="C:\\Windows\\syswow64\\MsiExec.exe" OR SourceImage="C:\\Windows\\System32\\msiexec.exe") (GrantedAccess="0x1410" OR GrantedAccess="0x410" OR GrantedAccess="0x1f1fff" OR GrantedAccess="0x1f3fff"))) OR (((SourceImage="C:\\Windows\\system32\\wininit.exe" OR SourceImage="C:\\Windows\\System32\\lsass.exe") GrantedAccess="0x1000000")) OR ((SourceImage="C:\\ProgramData\\VMware\\VMware Tools\\*" SourceImage="*\\vmtoolsd.exe")) OR ((SourceImage="C:\\WINDOWS\\system32\\svchost.exe" (GrantedAccess="0x100000" OR GrantedAccess="0x1410"))) OR (((SourceImage="*\\thor.exe" OR SourceImage="*\\thor64.exe" OR SourceImage="*\\aurora-agent.exe" OR SourceImage="*\\aurora-agent-64.exe") (GrantedAccess="0x40" OR GrantedAccess="0x1010"))) OR ((SourceImage="*\\explorer.exe" GrantedAccess="0x401")) OR ((SourceImage="C:\\Windows\\system32\\MRT.exe" (GrantedAccess="0x1410" OR GrantedAccess="0x1418"))) OR ((GrantedAccess="0x40" (SourceImage="*\\handle.exe" OR SourceImage="*\\handle64.exe"))) OR ((SourceImage="C:\\Program Files (x86)\\Microsoft\\Edge\\Application\\*" SourceImage="*\\Installer\\setup.exe")) OR ((SourceImage="*\\AppData\\Local\\WebEx\\WebexHost.exe" GrantedAccess="0x401")) OR ((SourceImage="C:\\PROGRAMDATA\\MALWAREBYTES\\MBAMSERVICE\\ctlrupdate\\mbupdatr.exe" GrantedAccess="0x1410")) OR (((SourceImage="*:\\Windows\\Temp\\*" OR SourceImage="*\\AppData\\Local\\Temp\\*") SourceImage="*.tmp\\DropboxUpdate.exe" (GrantedAccess="0x410" OR GrantedAccess="0x1410"))) OR ((SourceImage="C:\\Program Files\\Microsoft Visual Studio\\*" SourceImage="*\\MSBuild\\Current\\Bin\\MSBuild.exe" GrantedAccess="0x1F3FFF")) OR ((SourceImage="*\\SteamLibrary\\steamapps\\*"))))) | table ComputerName,User,SourceImage | eval sigma_attack_tags="attack.credential_access attack.t1003.001 attack.s0002 car.2019-04-004" | eval sigma_title="Credential Dumping Tools Accessing LSASS Memory" | eval sigma_description="Detects processes requesting access to LSASS memory via suspicious access masks. This is typical for credentials dumping tools"
dispatch.earliest_time = -24h@h
alert.track = 0

[Direct Syscall of NtOpenProcess - sysmon]
description = Detects the usage of the direct syscall of NtOpenProcess which might be done from a CobaltStrike BOF.
search = index=sysmon* ((((EventCode="10" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) CallTrace="UNKNOWN*" NOT (((TargetImage="C:\\Program Files\\Cylance\\Desktop\\CylanceUI.exe" SourceImage="C:\\Windows\\Explorer.EXE")) OR ((TargetImage="C:\\Program Files (x86)\\Microsoft\\EdgeUpdate\\MicrosoftEdgeUpdate.exe" SourceImage="C:\\Program Files (x86)\\Microsoft\\Temp\\*" SourceImage="*\\MicrosoftEdgeUpdate.exe")) OR ((TargetImage="*vcredist_x64.exe" SourceImage="*vcredist_x64.exe")) OR ((TargetImage="C:\\Windows\\system32\\systeminfo.exe" SourceImage="*setup64.exe")) OR ((TargetImage="*AmazonSSMAgentSetup.exe" SourceImage="*AmazonSSMAgentSetup.exe")) OR ((TargetImage="*C:\\Program Files\\Mozilla Firefox\\firefox.exe" SourceImage="*C:\\Program Files\\Mozilla Firefox\\firefox.exe")) OR ((TargetImage="*\\AppData\\Local\\Programs\\Microsoft VS Code\\Code.exe" SourceImage="*\\AppData\\Local\\Programs\\Microsoft VS Code\\Code.exe")) OR ((TargetImage="*C:\\Program Files\\Google\\Chrome\\Application\\chrome.exe" SourceImage="*C:\\Program Files\\Google\\Chrome\\Application\\chrome.exe")) OR ((TargetImage="*C:\\Program Files (x86)\\Google\\Update\\GoogleUpdate.exe" SourceImage="*C:\\Program Files (x86)\\Google\\Update\\GoogleUpdate.exe")) OR ((TargetImage="*\\AppData\\Local\\Microsoft\\Teams\\current\\Teams.exe" SourceImage="*\\AppData\\Local\\Microsoft\\Teams\\current\\Teams.exe")) OR ((TargetImage="C:\\Windows\\System32\\backgroundTaskHost.exe" SourceImage="C:\\Windows\\System32\\backgroundTaskHost.exe")) OR ((TargetImage="C:\\Program Files (x86)\\CCleaner Browser\\Application\\CCleanerBrowser.exe" SourceImage="C:\\Program Files (x86)\\CCleaner Browser\\Application\\CCleanerBrowser.exe")) OR ((TargetImage="C:\\Users\\*" TargetImage="*\\AppData\\Local\\Discord\\*" TargetImage="*\\Discord.exe")) OR ((TargetImage="C:\\WINDOWS\\system32\\AUDIODG.EXE")) OR ((Provider_Name="Microsoft-Windows-Kernel-Audit-API-Calls")) OR ((TargetImage="*\\Evernote\\Evernote.exe"))))) | eval sigma_attack_tags="attack.execution attack.t1106" | eval sigma_title="Direct Syscall of NtOpenProcess" | eval sigma_description="Detects the usage of the direct syscall of NtOpenProcess which might be done from a CobaltStrike BOF."
dispatch.earliest_time = -24h@h
alert.track = 0

[SysmonEnte Usage - sysmon]
description = Detects the use of SysmonEnte, a tool to attack the integrity of Sysmon
search = index=sysmon* ((((EventCode="10" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((((TargetImage="C:\\Windows\\Sysmon64.exe" GrantedAccess="0x1400")) NOT ((((SourceImage="C:\\Program Files*" OR SourceImage="C:\\Windows\\System32\\*"))) OR ((SourceImage="C:\\ProgramData\\Microsoft\\Windows Defender\\Platform\\*" SourceImage="*\\MsMpEng.exe"))))) OR CallTrace="Ente"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.002" | eval sigma_title="SysmonEnte Usage" | eval sigma_description="Detects the use of SysmonEnte, a tool to attack the integrity of Sysmon"
dispatch.earliest_time = -24h@h
alert.track = 0

[HandleKatz Duplicating LSASS Handle - sysmon]
description = Detects HandleKatz opening LSASS to duplicate its handle to later dump the memory without opening any new handles
search = index=sysmon* ((EventCode="10" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") TargetImage="*\\lsass.exe" GrantedAccess="0x1440" CallTrace="C:\\Windows\\System32\\ntdll.dll+*" CallTrace="*|UNKNOWN(*" CallTrace="*)")) | eval sigma_attack_tags="attack.execution attack.t1106 attack.defense_evasion attack.t1003.001" | eval sigma_title="HandleKatz Duplicating LSASS Handle" | eval sigma_description="Detects HandleKatz opening LSASS to duplicate its handle to later dump the memory without opening any new handles"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential NT API Stub Patching - sysmon]
description = Detects potential NT API stub patching as seen used by the project PatchingAPI
search = index=sysmon* ((((EventCode="10" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((GrantedAccess="0x1FFFFF" CallTrace="C:\\Windows\\SYSTEM32\\ntdll.dll+*" CallTrace="*|UNKNOWN(*" CallTrace="*)")) NOT ((((SourceImage="C:\\Program Files\\*" OR SourceImage="C:\\Program Files (x86)\\*" OR SourceImage="C:\\Windows\\System32\\*" OR SourceImage="C:\\Windows\\SysWOW64\\*")) OR ((TargetImage="C:\\Program Files\\*" OR TargetImage="C:\\Program Files (x86)\\*" OR TargetImage="C:\\Windows\\System32\\*" OR TargetImage="C:\\Windows\\SysWOW64\\*"))) OR ((SourceImage="C:\\Windows\\Temp\\asgard2-agent\\*" SourceImage="*\\thor64.exe")) OR ((SourceImage="C:\\Users\\*" SourceImage="*\\AppData\\Local\\GitHubDesktop\\app-*" (SourceImage="*\\GitHubDesktop.exe" OR SourceImage="*\\resources\\app\\git\\usr\\bin\\sh.exe") TargetImage="C:\\Users\\*" TargetImage="*\\AppData\\Local\\GitHubDesktop\\app-*")) OR (((SourceImage="C:\\Windows\\Microsoft.NET\\Framework\\v*" OR SourceImage="C:\\Windows\\Microsoft.NET\\Framework64\\v*") SourceImage="*\\NGenTask.exe" (TargetImage="C:\\Windows\\Microsoft.NET\\Framework\\v*" OR TargetImage="C:\\Windows\\Microsoft.NET\\Framework64\\v*"))) OR (((SourceImage="C:\\WINDOWS\\system32\\taskhostw.exe" OR SourceImage="C:\\Windows\\system32\\taskhost.exe") (TargetImage="C:\\Windows\\Microsoft.NET\\Framework\\v*" OR TargetImage="C:\\Windows\\Microsoft.NET\\Framework64\\v*") TargetImage="*\\NGenTask.exe")) OR ((SourceImage="C:\\Users\\*" SourceImage="*\\AppData\\Local\\Microsoft\\Teams\\stage\\Teams.exe" TargetImage="C:\\Users\\*" TargetImage="*\\AppData\\Local\\Microsoft\\Teams\\Update.exe")) OR ((SourceImage="C:\\Users\\*" SourceImage="*\\AppData\\Local\\Microsoft\\Teams\\Update.exe" TargetImage="C:\\WINDOWS\\SysWOW64\\regsvr32.exe")) OR ((SourceImage="C:\\Users\\*" SourceImage="*\\AppData\\Local\\Microsoft\\Teams\\Update.exe" TargetImage="*\\AppData\\Local\\Microsoft\\Teams\\stage\\Teams.exe"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.002" | eval sigma_title="Potential NT API Stub Patching" | eval sigma_description="Detects potential NT API stub patching as seen used by the project PatchingAPI"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential Svchost Memory Access - sysmon]
description = Detects potential access to svchost process memory such as that used by Invoke-Phantom to kill the winRM windows event logging service.
search = index=sysmon* ((((EventCode="10" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((TargetImage="*\\WINDOWS\\System32\\svchost.exe" GrantedAccess="0x1F3FFF" CallTrace="*UNKNOWN*")) NOT (((SourceImage="C:\\Program Files\\Microsoft Visual Studio\\*" SourceImage="*\\MSBuild\\Current\\Bin\\MSBuild.exe" (CallTrace="*Microsoft.Build.ni.dll*" OR CallTrace="*System.ni.dll*")))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.002" | eval sigma_title="Potential Svchost Memory Access" | eval sigma_description="Detects potential access to svchost process memory such as that used by Invoke-Phantom to kill the winRM windows event logging service."
dispatch.earliest_time = -24h@h
alert.track = 0

[Credential Dumping by LaZagne - sysmon]
description = Detects LSASS process access by LaZagne for credential dumping.
search = index=sysmon* ((EventCode="10" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") TargetImage="*\\lsass.exe" CallTrace="*C:\\Windows\\SYSTEM32\\ntdll.dll+*" CallTrace="*|C:\\Windows\\System32\\KERNELBASE.dll+*" CallTrace="*_ctypes.pyd+*" CallTrace="*python27.dll+*" GrantedAccess="0x1FFFFF")) | eval sigma_attack_tags="attack.credential_access attack.t1003.001 attack.s0349" | eval sigma_title="Credential Dumping by LaZagne" | eval sigma_description="Detects LSASS process access by LaZagne for credential dumping."
dispatch.earliest_time = -24h@h
alert.track = 0

[LittleCorporal Generated Maldoc Injection - sysmon]
description = Detects the process injection of a LittleCorporal generated Maldoc.
search = index=sysmon* ((EventCode="10" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") SourceImage="*\\winword.exe" CallTrace="*:\\Windows\\Microsoft.NET\\Framework64\\v2.*" CallTrace="*UNKNOWN*")) | eval sigma_attack_tags="attack.execution attack.t1204.002 attack.t1055.003" | eval sigma_title="LittleCorporal Generated Maldoc Injection" | eval sigma_description="Detects the process injection of a LittleCorporal generated Maldoc."
dispatch.earliest_time = -24h@h
alert.track = 0

[Load Undocumented Autoelevated COM Interface - sysmon]
description = COM interface (EditionUpgradeManager) that is not used by standard executables.
search = index=sysmon* ((EventCode="10" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CallTrace="*editionupgrademanagerobj.dll*")) | table ComputerName,User,SourceImage,TargetImage,CallTrace | eval sigma_attack_tags="attack.defense_evasion attack.privilege_escalation attack.t1548.002" | eval sigma_title="Load Undocumented Autoelevated COM Interface" | eval sigma_description="COM interface (EditionUpgradeManager) that is not used by standard executables."
dispatch.earliest_time = -24h@h
alert.track = 0

[Lsass Memory Dump via Comsvcs DLL - sysmon]
description = Detects adversaries leveraging the MiniDump export function from comsvcs.dll via rundll32 to perform a memory dump from lsass.
search = index=sysmon* ((EventCode="10" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") TargetImage="*\\lsass.exe" SourceImage="C:\\Windows\\System32\\rundll32.exe" CallTrace="*comsvcs.dll*")) | eval sigma_attack_tags="attack.credential_access attack.t1003.001" | eval sigma_title="Lsass Memory Dump via Comsvcs DLL" | eval sigma_description="Detects adversaries leveraging the MiniDump export function from comsvcs.dll via rundll32 to perform a memory dump from lsass."
dispatch.earliest_time = -24h@h
alert.track = 0

[LSASS Access from White-Listed Processes - sysmon]
description = Detects a possible process memory dump that uses the white-listed filename like TrolleyExpress.exe as a way to dump the lsass process memory without Microsoft Defender interference
search = index=sysmon* ((EventCode="10" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") TargetImage="*\\lsass.exe" (SourceImage="*\\TrolleyExpress.exe" OR SourceImage="*\\ProcessDump.exe" OR SourceImage="*\\dump64.exe") (GrantedAccess="*10" OR GrantedAccess="*30" OR GrantedAccess="*50" OR GrantedAccess="*70" OR GrantedAccess="*90" OR GrantedAccess="*B0" OR GrantedAccess="*D0" OR GrantedAccess="*F0" OR GrantedAccess="*18" OR GrantedAccess="*38" OR GrantedAccess="*58" OR GrantedAccess="*78" OR GrantedAccess="*98" OR GrantedAccess="*B8" OR GrantedAccess="*D8" OR GrantedAccess="*F8" OR GrantedAccess="*1A" OR GrantedAccess="*3A" OR GrantedAccess="*5A" OR GrantedAccess="*7A" OR GrantedAccess="*9A" OR GrantedAccess="*BA" OR GrantedAccess="*DA" OR GrantedAccess="*FA" OR GrantedAccess="*0x14C2" OR GrantedAccess="*FF"))) | eval sigma_attack_tags="attack.credential_access attack.t1003.001 attack.s0002" | eval sigma_title="LSASS Access from White-Listed Processes" | eval sigma_description="Detects a possible process memory dump that uses the white-listed filename like TrolleyExpress.exe as a way to dump the lsass process memory without Microsoft Defender interference"
dispatch.earliest_time = -24h@h
alert.track = 0

[LSASS Memory Access by Tool Named Dump - sysmon]
description = Detects a possible process memory dump based on a keyword in the file name of the accessing process
search = index=sysmon* ((EventCode="10" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") TargetImage="*\\lsass.exe" SourceImage="*dump*" (GrantedAccess="*10" OR GrantedAccess="*30" OR GrantedAccess="*50" OR GrantedAccess="*70" OR GrantedAccess="*90" OR GrantedAccess="*B0" OR GrantedAccess="*D0" OR GrantedAccess="*F0" OR GrantedAccess="*18" OR GrantedAccess="*38" OR GrantedAccess="*58" OR GrantedAccess="*78" OR GrantedAccess="*98" OR GrantedAccess="*B8" OR GrantedAccess="*D8" OR GrantedAccess="*F8" OR GrantedAccess="*1A" OR GrantedAccess="*3A" OR GrantedAccess="*5A" OR GrantedAccess="*7A" OR GrantedAccess="*9A" OR GrantedAccess="*BA" OR GrantedAccess="*DA" OR GrantedAccess="*FA" OR GrantedAccess="*0x14C2" OR GrantedAccess="*FF"))) | eval sigma_attack_tags="attack.credential_access attack.t1003.001 attack.s0002" | eval sigma_title="LSASS Memory Access by Tool Named Dump" | eval sigma_description="Detects a possible process memory dump based on a keyword in the file name of the accessing process"
dispatch.earliest_time = -24h@h
alert.track = 0

[LSASS Memory Dump - sysmon]
description = Detects process LSASS memory dump using Mimikatz, NanoDump, Invoke-Mimikatz, Procdump or Taskmgr based on the CallTrace pointing to ntdll.dll, dbghelp.dll or dbgcore.dll for win10, server2016 and up.
search = index=sysmon* ((((EventCode="10" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((TargetImage="*\\lsass.exe" (GrantedAccess="*0x1038*" OR GrantedAccess="*0x1438*" OR GrantedAccess="*0x143a*") (CallTrace="*dbghelp.dll*" OR CallTrace="*dbgcore.dll*" OR CallTrace="*ntdll.dll*"))) NOT ((((CallTrace="*|C:\\Windows\\Temp\\asgard2-agent\\*" CallTrace="*\\thor\\thor64.exe+*" CallTrace="*|UNKNOWN(*") GrantedAccess="0x103800")) OR ((SourceImage="C:\\Windows\\Sysmon64.exe"))))) | eval sigma_attack_tags="attack.credential_access attack.t1003.001 attack.s0002" | eval sigma_title="LSASS Memory Dump" | eval sigma_description="Detects process LSASS memory dump using Mimikatz, NanoDump, Invoke-Mimikatz, Procdump or Taskmgr based on the CallTrace pointing to ntdll.dll, dbghelp.dll or dbgcore.dll for win10, server2016 and up."
dispatch.earliest_time = -24h@h
alert.track = 0

[WerFault Accassing LSASS - sysmon]
description = Detects process LSASS memory dump using Mimikatz, NanoDump, Invoke-Mimikatz, Procdump or Taskmgr based on the CallTrace pointing to ntdll.dll, dbghelp.dll or dbgcore.dll for win10, server2016 and up.
search = index=sysmon* ((EventCode="10" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") SourceImage="*\\WerFault.exe" TargetImage="*\\lsass.exe" GrantedAccess="0x1FFFFF")) | eval sigma_attack_tags="attack.credential_access attack.t1003.001 attack.s0002" | eval sigma_title="WerFault Accassing LSASS" | eval sigma_description="Detects process LSASS memory dump using Mimikatz, NanoDump, Invoke-Mimikatz, Procdump or Taskmgr based on the CallTrace pointing to ntdll.dll, dbghelp.dll or dbgcore.dll for win10, server2016 and up."
dispatch.earliest_time = -24h@h
alert.track = 0

[Malware Shellcode in Verclsid Target Process - sysmon]
description = Detects a process access to verclsid.exe that injects shellcode from a Microsoft Office application / VBA macro
search = index=sysmon* ((((EventCode="10" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((TargetImage="*\\verclsid.exe" GrantedAccess="0x1FFFFF")) (((CallTrace="*|UNKNOWN(*" CallTrace="*VBE7.DLL*")) OR ((SourceImage="*\\Microsoft Office\\*" CallTrace="*|UNKNOWN*"))))) | eval sigma_attack_tags="attack.defense_evasion attack.privilege_escalation attack.t1055" | eval sigma_title="Malware Shellcode in Verclsid Target Process" | eval sigma_description="Detects a process access to verclsid.exe that injects shellcode from a Microsoft Office application / VBA macro"
dispatch.earliest_time = -24h@h
alert.track = 0

[Mimikatz through Windows Remote Management - sysmon]
description = Detects usage of mimikatz through WinRM protocol by monitoring access to lsass process by wsmprovhost.exe.
search = index=sysmon* ((((EventCode="10" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((TargetImage="*\\lsass.exe" SourceImage="C:\\Windows\\system32\\wsmprovhost.exe")) NOT ((GrantedAccess="0x80000000")))) | eval sigma_attack_tags="attack.credential_access attack.execution attack.t1003.001 attack.t1059.001 attack.lateral_movement attack.t1021.006 attack.s0002" | eval sigma_title="Mimikatz through Windows Remote Management" | eval sigma_description="Detects usage of mimikatz through WinRM protocol by monitoring access to lsass process by wsmprovhost.exe."
dispatch.earliest_time = -24h@h
alert.track = 0

[Credential Dumping by Pypykatz - sysmon]
description = Detects LSASS process access by pypykatz for credential dumping.
search = index=sysmon* ((EventCode="10" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") TargetImage="*\\lsass.exe" CallTrace="*C:\\Windows\\SYSTEM32\\ntdll.dll+*" CallTrace="*C:\\Windows\\System32\\KERNELBASE.dll+*" CallTrace="*libffi-7.dll*" CallTrace="*_ctypes.pyd+*" CallTrace="*python3*.dll+*" GrantedAccess="0x1FFFFF")) | eval sigma_attack_tags="attack.credential_access attack.t1003.001" | eval sigma_title="Credential Dumping by Pypykatz" | eval sigma_description="Detects LSASS process access by pypykatz for credential dumping."
dispatch.earliest_time = -24h@h
alert.track = 0

[Rare GrantedAccess Flags on LSASS Access - sysmon]
description = Detects process access to LSASS memory with suspicious access flags 0x410 and 0x01410 (spin-off of similar rule)
search = index=sysmon* ((((EventCode="10" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((TargetImage="*\\lsass.exe" GrantedAccess="*10")) NOT ((((SourceImage="C:\\WINDOWS\\system32\\taskmgr.exe" OR SourceImage="C:\\Program Files\\Malwarebytes\\Anti-Malware\\MBAMService.exe" OR SourceImage="C:\\PROGRAMDATA\\MALWAREBYTES\\MBAMSERVICE\\ctlrupdate\\mbupdatr.exe" OR SourceImage="C:\\WINDOWS\\system32\\taskhostw.exe" OR SourceImage="C:\\Program Files\\Windows Defender\\MsMpEng.exe" OR SourceImage="C:\\Windows\\SysWOW64\\msiexec.exe" OR SourceImage="C:\\Windows\\System32\\msiexec.exe" OR SourceImage="C:\\Windows\\System32\\lsass.exe" OR SourceImage="C:\\WINDOWS\\System32\\perfmon.exe" OR SourceImage="C:\\WINDOWS\\system32\\wbem\\wmiprvse.exe" OR SourceImage="C:\\Windows\\sysWOW64\\wbem\\wmiprvse.exe" OR SourceImage="C:\\Program Files\\Common Files\\McAfee\\MMSSHost\\MMSSHOST.exe"))) OR ((SourceImage="C:\\ProgramData\\Microsoft\\Windows Defender\\*" SourceImage="*\\MsMpEng.exe")) OR ((SourceImage="C:\\Program Files\\WindowsApps\\*" SourceImage="*\\GamingServices.exe")) OR (((SourceImage="*\\PROCEXP64.EXE" OR SourceImage="*\\PROCEXP.EXE"))) OR ((SourceImage="C:\\ProgramData\\VMware\\VMware Tools\\*" SourceImage="*\\vmtoolsd.exe")) OR (((SourceImage="C:\\Program Files\\*" OR SourceImage="C:\\Program Files (x86)\\*") SourceImage="*Antivirus*")) OR (((SourceImage="*\\thor64.exe" OR SourceImage="*\\thor.exe" OR SourceImage="*\\aurora-agent-64.exe" OR SourceImage="*\\aurora-agent.exe"))) OR (((SourceImage="*\\AppData\\Local\\Temp\\*" SourceImage="*\\vs_bootstrapper_*") GrantedAccess="0x1410")) OR (((SourceImage="C:\\Program Files\\*" OR SourceImage="C:\\Program Files (x86)\\*" OR SourceImage="C:\\WINDOWS\\system32\\*"))) OR ((SourceCommandLine="C:\\WINDOWS\\system32\\wermgr.exe -upload")) OR (((SourceImage="*C:\\Users\\*" SourceImage="*\\AppData\\Local\\*") (SourceImage="*\\Microsoft VS Code\\Code.exe" OR SourceImage="*\\software_reporter_tool.exe" OR SourceImage="*\\DropboxUpdate.exe" OR SourceImage="*\\MBAMInstallerService.exe" OR SourceImage="*\\WebEx\\WebexHost.exe" OR SourceImage="*\\Programs\\Microsoft VS Code\\Code.exe" OR SourceImage="*\\JetBrains\\Toolbox\\bin\\jetbrains-toolbox.exe"))) OR ((SourceImage="*\\xampp-control.exe" GrantedAccess="0x410")) OR ((SourceImage="*\\SteamLibrary\\steamapps\\*" (GrantedAccess="0x410" OR GrantedAccess="0x10")))))) | table User,SourceImage,GrantedAccess | eval sigma_attack_tags="attack.credential_access attack.t1003.001 attack.s0002" | eval sigma_title="Rare GrantedAccess Flags on LSASS Access" | eval sigma_description="Detects process access to LSASS memory with suspicious access flags 0x410 and 0x01410 (spin-off of similar rule)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential Shellcode Injection - sysmon]
description = Detects potential shellcode injection used by tools such as Metasploit's migrate and Empire's psinject
search = index=sysmon* ((((EventCode="10" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((GrantedAccess="0x147a" OR GrantedAccess="0x1f3fff") CallTrace="*UNKNOWN*")) NOT ((((SourceImage="C:\\Program Files\\Dell\\*" OR SourceImage="C:\\Program Files (x86)\\Dell\\*") (TargetImage="C:\\Program Files\\Dell\\*" OR TargetImage="C:\\Program Files (x86)\\Dell\\*") GrantedAccess="0x1F3FFF" CallTrace="C:\\Windows\\System32\\ntdll.dll*")) OR ((SourceImage="C:\\Program Files (x86)\\Dell\\UpdateService\\ServiceShell.exe" TargetImage="C:\\Windows\\Explorer.EXE" GrantedAccess="0x1F3FFF" CallTrace="C:\\Windows\\System32\\ntdll.dll*")) OR (((SourceImage="C:\\Program Files\\Microsoft Visual Studio\\2022\\Community\\Common7\\IDE\\PerfWatson2.exe" OR SourceImage="C:\\Program Files (x86)\\Microsoft Visual Studio\\2019\\Community\\Common7\\IDE\\PerfWatson2.exe") (TargetImage="C:\\Program Files\\Microsoft Visual Studio\\2022\\Community\\Common7\\IDE\\devenv.exe" OR TargetImage="C:\\Program Files (x86)\\Microsoft Visual Studio\\2019\\Community\\Common7\\IDE\\devenv.exe") CallTrace="C:\\Windows\\System32\\ntdll.dll*")) OR ((SourceImage="C:\\Program Files\\Microsoft Visual Studio\\*" SourceImage="*\\MSBuild\\Current\\Bin\\MSBuild.exe" TargetImage="C:\\Program Files\\Dell\\DellDataVault\\DDVDataCollector.exe")) OR ((SourceImage="C:\\Windows\\System32\\Wbem\\Wmiprvse.exe" TargetImage="C:\\Windows\\system32\\lsass.exe" CallTrace="C:\\Windows\\SYSTEM32\\ntdll.dll*" CallTrace="*\\System.ni.dll+*"))))) | eval sigma_attack_tags="attack.defense_evasion attack.privilege_escalation attack.t1055" | eval sigma_title="Potential Shellcode Injection" | eval sigma_description="Detects potential shellcode injection used by tools such as Metasploit's migrate and Empire's psinject"
dispatch.earliest_time = -24h@h
alert.track = 0

[LSASS Access from Program in Suspicious Folder - sysmon]
description = Detects process access to LSASS memory with suspicious access flags and from a suspicious folder
search = index=sysmon* ((((EventCode="10" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((TargetImage="*\\lsass.exe" (GrantedAccess="*10" OR GrantedAccess="*30" OR GrantedAccess="*50" OR GrantedAccess="*70" OR GrantedAccess="*90" OR GrantedAccess="*B0" OR GrantedAccess="*D0" OR GrantedAccess="*F0" OR GrantedAccess="*18" OR GrantedAccess="*38" OR GrantedAccess="*58" OR GrantedAccess="*78" OR GrantedAccess="*98" OR GrantedAccess="*B8" OR GrantedAccess="*D8" OR GrantedAccess="*F8" OR GrantedAccess="*1A" OR GrantedAccess="*3A" OR GrantedAccess="*5A" OR GrantedAccess="*7A" OR GrantedAccess="*9A" OR GrantedAccess="*BA" OR GrantedAccess="*DA" OR GrantedAccess="*FA" OR GrantedAccess="*0x14C2" OR GrantedAccess="*FF") (SourceImage="*\\Temp\\*" OR SourceImage="*\\Users\\Public\\*" OR SourceImage="*\\PerfLogs\\*" OR SourceImage="*\\AppData\\*" OR SourceImage="*\\Temporary*"))) NOT (((SourceImage="C:\\Users\\*" SourceImage="*\\AppData\\Local\\*" (SourceImage="*\\Microsoft VS Code\\Code.exe" OR SourceImage="*\\software_reporter_tool.exe" OR SourceImage="*\\DropboxUpdate.exe" OR SourceImage="*\\MBAMInstallerService.exe" OR SourceImage="*\\WebexMTA.exe" OR SourceImage="*\\WebEx\\WebexHost.exe" OR SourceImage="*\\JetBrains\\Toolbox\\bin\\jetbrains-toolbox.exe") GrantedAccess="0x410")) OR ((SourceImage="C:\\Windows\\Temp\\*" SourceImage="*.tmp\\DropboxUpdate.exe" (GrantedAccess="0x410" OR GrantedAccess="0x1410"))) OR ((SourceImage="C:\\Users\\*" SourceImage="*\\AppData\\Local\\Temp\\*" SourceImage="*.tmp\\DropboxUpdate.exe" GrantedAccess="0x1410")) OR (((SourceImage="C:\\Windows\\Temp\\asgard2-agent\\*" OR SourceImage="C:\\Windows\\Temp\\asgard2-agent-sc\\*") (SourceImage="*\\thor64.exe" OR SourceImage="*\\thor.exe" OR SourceImage="*\\aurora-agent-64.exe" OR SourceImage="*\\aurora-agent.exe") (GrantedAccess="0x1fffff" OR GrantedAccess="0x1010" OR GrantedAccess="0x101010"))) OR ((SourceImage="C:\\Users\\*" (SourceImage="*\\AppData\\Local\\Temp\\*" SourceImage="*\\vs_bootstrapper_*") GrantedAccess="0x1410")) OR ((SourceImage="C:\\Program Files (x86)\\Google\\Temp\\*" SourceImage="*.tmp\\GoogleUpdate.exe" GrantedAccess="0x410")) OR (((SourceImage="C:\\Program Files (x86)\\*" OR SourceImage="C:\\Program Files\\*"))) OR ((SourceImage="C:\\Users\\*" SourceImage="*\\AppData\\Local\\Keybase\\keybase.exe" GrantedAccess="0x1fffff"))))) | table User,SourceImage,GrantedAccess | eval sigma_attack_tags="attack.credential_access attack.t1003.001 attack.s0002" | eval sigma_title="LSASS Access from Program in Suspicious Folder" | eval sigma_description="Detects process access to LSASS memory with suspicious access flags and from a suspicious folder"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious GrantedAccess Flags on LSASS Access - sysmon]
description = Detects process access to LSASS memory with suspicious access flags
search = index=sysmon* ((((EventCode="10" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((TargetImage="*\\lsass.exe" (GrantedAccess="*30" OR GrantedAccess="*50" OR GrantedAccess="*70" OR GrantedAccess="*90" OR GrantedAccess="*B0" OR GrantedAccess="*D0" OR GrantedAccess="*F0" OR GrantedAccess="*18" OR GrantedAccess="*38" OR GrantedAccess="*58" OR GrantedAccess="*78" OR GrantedAccess="*98" OR GrantedAccess="*B8" OR GrantedAccess="*D8" OR GrantedAccess="*F8" OR GrantedAccess="*1A" OR GrantedAccess="*3A" OR GrantedAccess="*5A" OR GrantedAccess="*7A" OR GrantedAccess="*9A" OR GrantedAccess="*BA" OR GrantedAccess="*DA" OR GrantedAccess="*FA" OR GrantedAccess="*0x14C2"))) NOT ((((SourceImage="C:\\WINDOWS\\system32\\taskmgr.exe" OR SourceImage="C:\\Program Files\\Malwarebytes\\Anti-Malware\\MBAMService.exe" OR SourceImage="C:\\PROGRAMDATA\\MALWAREBYTES\\MBAMSERVICE\\ctlrupdate\\mbupdatr.exe" OR SourceImage="C:\\WINDOWS\\system32\\taskhostw.exe" OR SourceImage="C:\\Users\\*\\AppData\\Local\\Programs\\Microsoft VS Code\\Code.exe" OR SourceImage="C:\\Program Files\\Windows Defender\\MsMpEng.exe" OR SourceImage="C:\\Windows\\SysWOW64\\msiexec.exe" OR SourceImage="C:\\Windows\\System32\\msiexec.exe" OR SourceImage="C:\\Windows\\System32\\lsass.exe" OR SourceImage="C:\\WINDOWS\\System32\\perfmon.exe" OR SourceImage="C:\\Windows\\System32\\MRT.exe" OR SourceImage="C:\\Program Files\\Cisco\\Cisco AnyConnect Secure Mobility Client\\vpnagent.exe" OR SourceImage="C:\\Program Files (x86)\\Cisco\\Cisco AnyConnect Secure Mobility Client\\vpnagent.exe"))) OR ((SourceImage="C:\\ProgramData\\Microsoft\\Windows Defender\\*" SourceImage="*\\MsMpEng.exe")) OR ((SourceImage="C:\\ProgramData\\VMware\\VMware Tools\\*" SourceImage="*\\vmtoolsd.exe")) OR (((SourceImage="C:\\Program Files\\*" OR SourceImage="C:\\Program Files (x86)\\*") SourceImage="*Antivirus*")) OR ((SourceImage="C:\\WINDOWS\\system32\\MRT.exe" GrantedAccess="0x1418")) OR ((SourceImage="C:\\Program Files\\Common Files\\McAfee\\MMSSHost\\MMSSHOST.exe")) OR ((SourceImage="C:\\Windows\\Temp\\asgard2-agent\\*" (SourceImage="*\\thor64.exe" OR SourceImage="*\\thor.exe") GrantedAccess="0x1fffff")) OR (((CallTrace="*|C:\\ProgramData\\Microsoft\\Windows Defender\\Definition Updates\\{*" CallTrace="*}\\mpengine.dll+*") GrantedAccess="0x1418"))))) | table User,SourceImage,GrantedAccess | eval sigma_attack_tags="attack.credential_access attack.t1003.001 attack.s0002" | eval sigma_title="Suspicious GrantedAccess Flags on LSASS Access" | eval sigma_description="Detects process access to LSASS memory with suspicious access flags"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious LSASS Access Via MalSecLogon - sysmon]
description = Detects suspicious access to Lsass handle via a call trace to 'seclogon.dll'
search = index=sysmon* ((EventCode="10" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") TargetImage="*\\lsass.exe" SourceImage="*\\svchost.exe" GrantedAccess="0x14c0" CallTrace="*seclogon.dll*")) | eval sigma_attack_tags="attack.credential_access attack.t1003.001" | eval sigma_title="Suspicious LSASS Access Via MalSecLogon" | eval sigma_description="Detects suspicious access to Lsass handle via a call trace to 'seclogon.dll'"
dispatch.earliest_time = -24h@h
alert.track = 0

[SVCHOST Credential Dump - sysmon]
description = Detects when a process, such as mimikatz, accesses the memory of svchost to dump credentials
search = index=sysmon* ((((EventCode="10" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((TargetImage="*\\svchost.exe" GrantedAccess="0x143a")) NOT (((SourceImage="*\\services.exe" OR SourceImage="*\\msiexec.exe"))))) | eval sigma_attack_tags="attack.t1548" | eval sigma_title="SVCHOST Credential Dump" | eval sigma_description="Detects when a process, such as mimikatz, accesses the memory of svchost to dump credentials"
dispatch.earliest_time = -24h@h
alert.track = 0

[UAC Bypass Using WOW64 Logger DLL Hijack - sysmon]
description = Detects the pattern of UAC Bypass using a WoW64 logger DLL hijack (UACMe 30)
search = index=sysmon* ((EventCode="10" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") SourceImage="*:\\Windows\\SysWOW64\\*" GrantedAccess="0x1fffff" CallTrace="UNKNOWN(0000000000000000)|UNKNOWN(0000000000000000)|*")) | eval sigma_attack_tags="attack.defense_evasion attack.privilege_escalation attack.t1548.002" | eval sigma_title="UAC Bypass Using WOW64 Logger DLL Hijack" | eval sigma_description="Detects the pattern of UAC Bypass using a WoW64 logger DLL hijack (UACMe 30)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential Credential Dumping Attempt Via PowerShell - sysmon]
description = Detects PowerShell processes requesting access to 'lsass.exe'
search = index=sysmon* ((EventCode="10" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (SourceImage="*\\powershell.exe" OR SourceImage="*\\pwsh.exe") TargetImage="*\\lsass.exe")) | eval sigma_attack_tags="attack.credential_access attack.t1003.001" | eval sigma_title="Potential Credential Dumping Attempt Via PowerShell" | eval sigma_description="Detects PowerShell processes requesting access to 'lsass.exe'"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious 7zip Subprocess - winevent]
description = 7-Zip through 21.07 on Windows allows privilege escalation (CVE-2022-29072) and command execution when a file with the .7z extension is dragged to the Help>Contents area. This is caused by misconfiguration of 7z.dll and a heap overflow. The command runs in a child process under the 7zFM.exe process.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((New_Process_Name="*\\cmd.exe" OR OriginalFileName="Cmd.Exe") Creator_Process_Name="*\\7zFM.exe")) NOT ((((Process_Command_Line="* /c *" OR Process_Command_Line="* /k *" OR Process_Command_Line="* /r *"))) OR ((NOT Process_Command_Line="*"))))) | eval sigma_attack_tags="cve.2022.29072" | eval sigma_title="Suspicious 7zip Subprocess" | eval sigma_description="7-Zip through 21.07 on Windows allows privilege escalation (CVE-2022-29072) and command execution when a file with the .7z extension is dragged to the Help>Contents area. This is caused by misconfiguration of 7z.dll and a heap overflow. The command runs in a child process under the 7zFM.exe process."
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious 7zip Subprocess - sysmon]
description = 7-Zip through 21.07 on Windows allows privilege escalation (CVE-2022-29072) and command execution when a file with the .7z extension is dragged to the Help>Contents area. This is caused by misconfiguration of 7z.dll and a heap overflow. The command runs in a child process under the 7zFM.exe process.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((Image="*\\cmd.exe" OR OriginalFileName="Cmd.Exe") ParentImage="*\\7zFM.exe")) NOT ((((CommandLine="* /c *" OR CommandLine="* /k *" OR CommandLine="* /r *"))) OR ((NOT CommandLine="*"))))) | eval sigma_attack_tags="cve.2022.29072" | eval sigma_title="Suspicious 7zip Subprocess" | eval sigma_description="7-Zip through 21.07 on Windows allows privilege escalation (CVE-2022-29072) and command execution when a file with the .7z extension is dragged to the Help>Contents area. This is caused by misconfiguration of 7z.dll and a heap overflow. The command runs in a child process under the 7zFM.exe process."
dispatch.earliest_time = -24h@h
alert.track = 0

[AADInternals PowerShell Cmdlets Execution - ProccessCreation - winevent]
description = Detects ADDInternals Cmdlet execution. A tool for administering Azure AD and Office 365. Which can be abused by threat actors to attack Azure AD or Office 365.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\powershell.exe" OR New_Process_Name="*\\pwsh.exe") OR (OriginalFileName="PowerShell.Exe" OR OriginalFileName="pwsh.dll")) (Process_Command_Line="*Add-AADInt*" OR Process_Command_Line="*ConvertTo-AADInt*" OR Process_Command_Line="*Disable-AADInt*" OR Process_Command_Line="*Enable-AADInt*" OR Process_Command_Line="*Export-AADInt*" OR Process_Command_Line="*Get-AADInt*" OR Process_Command_Line="*Grant-AADInt*" OR Process_Command_Line="*Install-AADInt*" OR Process_Command_Line="*Invoke-AADInt*" OR Process_Command_Line="*Join-AADInt*" OR Process_Command_Line="*New-AADInt*" OR Process_Command_Line="*Open-AADInt*" OR Process_Command_Line="*Read-AADInt*" OR Process_Command_Line="*Register-AADInt*" OR Process_Command_Line="*Remove-AADInt*" OR Process_Command_Line="*Restore-AADInt*" OR Process_Command_Line="*Search-AADInt*" OR Process_Command_Line="*Send-AADInt*" OR Process_Command_Line="*Set-AADInt*" OR Process_Command_Line="*Start-AADInt*" OR Process_Command_Line="*Update-AADInt*"))) | eval sigma_attack_tags="attack.execution attack.reconnaissance attack.discovery attack.credential_access attack.impact" | eval sigma_title="AADInternals PowerShell Cmdlets Execution - ProccessCreation" | eval sigma_description="Detects ADDInternals Cmdlet execution. A tool for administering Azure AD and Office 365. Which can be abused by threat actors to attack Azure AD or Office 365."
dispatch.earliest_time = -24h@h
alert.track = 0

[AADInternals PowerShell Cmdlets Execution - ProccessCreation - sysmon]
description = Detects ADDInternals Cmdlet execution. A tool for administering Azure AD and Office 365. Which can be abused by threat actors to attack Azure AD or Office 365.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\powershell.exe" OR Image="*\\pwsh.exe") OR (OriginalFileName="PowerShell.Exe" OR OriginalFileName="pwsh.dll")) (CommandLine="*Add-AADInt*" OR CommandLine="*ConvertTo-AADInt*" OR CommandLine="*Disable-AADInt*" OR CommandLine="*Enable-AADInt*" OR CommandLine="*Export-AADInt*" OR CommandLine="*Get-AADInt*" OR CommandLine="*Grant-AADInt*" OR CommandLine="*Install-AADInt*" OR CommandLine="*Invoke-AADInt*" OR CommandLine="*Join-AADInt*" OR CommandLine="*New-AADInt*" OR CommandLine="*Open-AADInt*" OR CommandLine="*Read-AADInt*" OR CommandLine="*Register-AADInt*" OR CommandLine="*Remove-AADInt*" OR CommandLine="*Restore-AADInt*" OR CommandLine="*Search-AADInt*" OR CommandLine="*Send-AADInt*" OR CommandLine="*Set-AADInt*" OR CommandLine="*Start-AADInt*" OR CommandLine="*Update-AADInt*"))) | eval sigma_attack_tags="attack.execution attack.reconnaissance attack.discovery attack.credential_access attack.impact" | eval sigma_title="AADInternals PowerShell Cmdlets Execution - ProccessCreation" | eval sigma_description="Detects ADDInternals Cmdlet execution. A tool for administering Azure AD and Office 365. Which can be abused by threat actors to attack Azure AD or Office 365."
dispatch.earliest_time = -24h@h
alert.track = 0

[Abused Debug Privilege by Arbitrary Parent Processes - winevent]
description = Detection of unusual child processes by different system processes
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((((Creator_Process_Name="*\\winlogon.exe" OR Creator_Process_Name="*\\services.exe" OR Creator_Process_Name="*\\lsass.exe" OR Creator_Process_Name="*\\csrss.exe" OR Creator_Process_Name="*\\smss.exe" OR Creator_Process_Name="*\\wininit.exe" OR Creator_Process_Name="*\\spoolsv.exe" OR Creator_Process_Name="*\\searchindexer.exe") (Account_Name="*AUTHORI*" OR Account_Name="*AUTORI*"))) ((New_Process_Name="*\\powershell.exe" OR New_Process_Name="*\\pwsh.exe" OR New_Process_Name="*\\cmd.exe") OR (OriginalFileName="PowerShell.EXE" OR OriginalFileName="pwsh.dll" OR OriginalFileName="Cmd.Exe")))) NOT (((Process_Command_Line="* route *" Process_Command_Line="* ADD *"))))) | table Creator_Process_Name,New_Process_Name,Account_Name,Process_Command_Line | eval sigma_attack_tags="attack.privilege_escalation attack.t1548" | eval sigma_title="Abused Debug Privilege by Arbitrary Parent Processes" | eval sigma_description="Detection of unusual child processes by different system processes"
dispatch.earliest_time = -24h@h
alert.track = 0

[Abused Debug Privilege by Arbitrary Parent Processes - sysmon]
description = Detection of unusual child processes by different system processes
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((((ParentImage="*\\winlogon.exe" OR ParentImage="*\\services.exe" OR ParentImage="*\\lsass.exe" OR ParentImage="*\\csrss.exe" OR ParentImage="*\\smss.exe" OR ParentImage="*\\wininit.exe" OR ParentImage="*\\spoolsv.exe" OR ParentImage="*\\searchindexer.exe") (User="*AUTHORI*" OR User="*AUTORI*"))) ((Image="*\\powershell.exe" OR Image="*\\pwsh.exe" OR Image="*\\cmd.exe") OR (OriginalFileName="PowerShell.EXE" OR OriginalFileName="pwsh.dll" OR OriginalFileName="Cmd.Exe")))) NOT (((CommandLine="* route *" CommandLine="* ADD *"))))) | table ParentImage,Image,User,CommandLine | eval sigma_attack_tags="attack.privilege_escalation attack.t1548" | eval sigma_title="Abused Debug Privilege by Arbitrary Parent Processes" | eval sigma_description="Detection of unusual child processes by different system processes"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential Persistence Execution Via Microsoft Compatibility Appraiser - winevent]
description = Detects manual execution of the 'Microsoft Compatibility Appraiser' task via schtasks. In order to trigger persistence stored in the '\AppCompatFlags\TelemetryController' registry key.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\schtasks.exe" OR OriginalFileName="schtasks.exe") ((Process_Command_Line="*run *" Process_Command_Line="*\\Application Experience\\Microsoft Compatibility Appraiser*")))) | eval sigma_attack_tags="attack.persistence attack.t1053.005" | eval sigma_title="Potential Persistence Execution Via Microsoft Compatibility Appraiser" | eval sigma_description="Detects manual execution of the 'Microsoft Compatibility Appraiser' task via schtasks. In order to trigger persistence stored in the '\AppCompatFlags\TelemetryController' registry key."
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential Persistence Execution Via Microsoft Compatibility Appraiser - sysmon]
description = Detects manual execution of the 'Microsoft Compatibility Appraiser' task via schtasks. In order to trigger persistence stored in the '\AppCompatFlags\TelemetryController' registry key.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\schtasks.exe" OR OriginalFileName="schtasks.exe") ((CommandLine="*run *" CommandLine="*\\Application Experience\\Microsoft Compatibility Appraiser*")))) | eval sigma_attack_tags="attack.persistence attack.t1053.005" | eval sigma_title="Potential Persistence Execution Via Microsoft Compatibility Appraiser" | eval sigma_description="Detects manual execution of the 'Microsoft Compatibility Appraiser' task via schtasks. In order to trigger persistence stored in the '\AppCompatFlags\TelemetryController' registry key."
dispatch.earliest_time = -24h@h
alert.track = 0

[Accesschk Usage To Check Privileges - winevent]
description = Accesschk is an access and privilege audit tool developed by SysInternal and often being used by attacker to verify privileges
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (Product="*AccessChk" OR Description="*Reports effective permissions*" OR (New_Process_Name="*\\accesschk.exe" OR New_Process_Name="*\\accesschk64.exe") OR OriginalFileName="accesschk.exe") (Process_Command_Line="*uwcqv *" OR Process_Command_Line="*kwsu *" OR Process_Command_Line="*qwsu *" OR Process_Command_Line="*uwdqs *"))) | table IntegrityLevel,Product,Description,Process_Command_Line | eval sigma_attack_tags="attack.discovery attack.t1069.001" | eval sigma_title="Accesschk Usage To Check Privileges" | eval sigma_description="Accesschk is an access and privilege audit tool developed by SysInternal and often being used by attacker to verify privileges"
dispatch.earliest_time = -24h@h
alert.track = 0

[Accesschk Usage To Check Privileges - sysmon]
description = Accesschk is an access and privilege audit tool developed by SysInternal and often being used by attacker to verify privileges
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Product="*AccessChk" OR Description="*Reports effective permissions*" OR (Image="*\\accesschk.exe" OR Image="*\\accesschk64.exe") OR OriginalFileName="accesschk.exe") (CommandLine="*uwcqv *" OR CommandLine="*kwsu *" OR CommandLine="*qwsu *" OR CommandLine="*uwdqs *"))) | table IntegrityLevel,Product,Description,CommandLine | eval sigma_attack_tags="attack.discovery attack.t1069.001" | eval sigma_title="Accesschk Usage To Check Privileges" | eval sigma_description="Accesschk is an access and privilege audit tool developed by SysInternal and often being used by attacker to verify privileges"
dispatch.earliest_time = -24h@h
alert.track = 0

[Advanced IP Scanner - winevent]
description = Detects the use of Advanced IP Scanner. Seems to be a popular tool for ransomware groups.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\advanced_ip_scanner*" OR OriginalFileName="*advanced_ip_scanner*" OR Description="*Advanced IP Scanner*") OR ((Process_Command_Line="*/portable*" Process_Command_Line="*/lng*"))))) | eval sigma_attack_tags="attack.discovery attack.t1046 attack.t1135" | eval sigma_title="Advanced IP Scanner" | eval sigma_description="Detects the use of Advanced IP Scanner. Seems to be a popular tool for ransomware groups."
dispatch.earliest_time = -24h@h
alert.track = 0

[Advanced IP Scanner - sysmon]
description = Detects the use of Advanced IP Scanner. Seems to be a popular tool for ransomware groups.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\advanced_ip_scanner*" OR OriginalFileName="*advanced_ip_scanner*" OR Description="*Advanced IP Scanner*") OR ((CommandLine="*/portable*" CommandLine="*/lng*"))))) | eval sigma_attack_tags="attack.discovery attack.t1046 attack.t1135" | eval sigma_title="Advanced IP Scanner" | eval sigma_description="Detects the use of Advanced IP Scanner. Seems to be a popular tool for ransomware groups."
dispatch.earliest_time = -24h@h
alert.track = 0

[Advanced Port Scanner - winevent]
description = Detects the use of Advanced Port Scanner.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\advanced_port_scanner*" OR OriginalFileName="*advanced_port_scanner*" OR Description="*Advanced Port Scanner*") OR ((Process_Command_Line="*/portable*" Process_Command_Line="*/lng*"))))) | eval sigma_attack_tags="attack.discovery attack.t1046 attack.t1135" | eval sigma_title="Advanced Port Scanner" | eval sigma_description="Detects the use of Advanced Port Scanner."
dispatch.earliest_time = -24h@h
alert.track = 0

[Advanced Port Scanner - sysmon]
description = Detects the use of Advanced Port Scanner.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\advanced_port_scanner*" OR OriginalFileName="*advanced_port_scanner*" OR Description="*Advanced Port Scanner*") OR ((CommandLine="*/portable*" CommandLine="*/lng*"))))) | eval sigma_attack_tags="attack.discovery attack.t1046 attack.t1135" | eval sigma_title="Advanced Port Scanner" | eval sigma_description="Detects the use of Advanced Port Scanner."
dispatch.earliest_time = -24h@h
alert.track = 0

[Execute From Alternate Data Streams - winevent]
description = Detects execution from an Alternate Data Stream (ADS). Adversaries may use NTFS file attributes to hide their malicious data in order to evade detection
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) Process_Command_Line="*txt:*" (((Process_Command_Line="*type *" Process_Command_Line="* > *")) OR ((Process_Command_Line="*makecab *" Process_Command_Line="*.cab*")) OR ((Process_Command_Line="*reg *" Process_Command_Line="* export *")) OR ((Process_Command_Line="*regedit *" Process_Command_Line="* /E *")) OR ((Process_Command_Line="*esentutl *" Process_Command_Line="* /y *" Process_Command_Line="* /d *" Process_Command_Line="* /o *"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1564.004" | eval sigma_title="Execute From Alternate Data Streams" | eval sigma_description="Detects execution from an Alternate Data Stream (ADS). Adversaries may use NTFS file attributes to hide their malicious data in order to evade detection"
dispatch.earliest_time = -24h@h
alert.track = 0

[Execute From Alternate Data Streams - sysmon]
description = Detects execution from an Alternate Data Stream (ADS). Adversaries may use NTFS file attributes to hide their malicious data in order to evade detection
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) CommandLine="*txt:*" (((CommandLine="*type *" CommandLine="* > *")) OR ((CommandLine="*makecab *" CommandLine="*.cab*")) OR ((CommandLine="*reg *" CommandLine="* export *")) OR ((CommandLine="*regedit *" CommandLine="* /E *")) OR ((CommandLine="*esentutl *" CommandLine="* /y *" CommandLine="* /d *" CommandLine="* /o *"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1564.004" | eval sigma_title="Execute From Alternate Data Streams" | eval sigma_description="Detects execution from an Alternate Data Stream (ADS). Adversaries may use NTFS file attributes to hide their malicious data in order to evade detection"
dispatch.earliest_time = -24h@h
alert.track = 0

[Always Install Elevated MSI Spawned Cmd And Powershell - winevent]
description = Detects Windows Installer service (msiexec.exe) spawning 'cmd' or 'powershell'
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\cmd.exe" OR New_Process_Name="*\\powershell.exe" OR New_Process_Name="*\\pwsh.exe") OR (OriginalFileName="Cmd.Exe" OR OriginalFileName="PowerShell.EXE" OR OriginalFileName="pwsh.dll")) ((Creator_Process_Name="*\\Windows\\Installer\\*" Creator_Process_Name="*msi*" Creator_Process_Name="*tmp")))) | table New_Process_Name,Creator_Process_Name | eval sigma_attack_tags="attack.privilege_escalation attack.t1548.002" | eval sigma_title="Always Install Elevated MSI Spawned Cmd And Powershell" | eval sigma_description="Detects Windows Installer service (msiexec.exe) spawning 'cmd' or 'powershell'"
dispatch.earliest_time = -24h@h
alert.track = 0

[Always Install Elevated MSI Spawned Cmd And Powershell - sysmon]
description = Detects Windows Installer service (msiexec.exe) spawning 'cmd' or 'powershell'
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\cmd.exe" OR Image="*\\powershell.exe" OR Image="*\\pwsh.exe") OR (OriginalFileName="Cmd.Exe" OR OriginalFileName="PowerShell.EXE" OR OriginalFileName="pwsh.dll")) ((ParentImage="*\\Windows\\Installer\\*" ParentImage="*msi*" ParentImage="*tmp")))) | table Image,ParentImage | eval sigma_attack_tags="attack.privilege_escalation attack.t1548.002" | eval sigma_title="Always Install Elevated MSI Spawned Cmd And Powershell" | eval sigma_description="Detects Windows Installer service (msiexec.exe) spawning 'cmd' or 'powershell'"
dispatch.earliest_time = -24h@h
alert.track = 0

[Always Install Elevated Windows Installer - winevent]
description = Detects Windows Installer service (msiexec.exe) trying to install MSI packages with SYSTEM privilege
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((((New_Process_Name="*\\Windows\\Installer\\*" New_Process_Name="*msi*" New_Process_Name="*tmp")) OR ((New_Process_Name="*\\msiexec.exe" IntegrityLevel="System"))) (Account_Name="*AUTHORI*" OR Account_Name="*AUTORI*"))) NOT (((Creator_Process_Name="C:\\Windows\\System32\\services.exe")) OR ((Process_Command_Line="*\\system32\\msiexec.exe /V") OR (ParentCommandLine="*\\system32\\msiexec.exe /V")) OR (((Creator_Process_Name="C:\\ProgramData\\Sophos\\*" OR Creator_Process_Name="C:\\ProgramData\\Avira\\*" OR Creator_Process_Name="C:\\Program Files\\Avast Software\\*" OR Creator_Process_Name="C:\\Program Files (x86)\\Avast Software\\*" OR Creator_Process_Name="C:\\Program Files\\Google\\Update\\*" OR Creator_Process_Name="C:\\Program Files (x86)\\Google\\Update\\*")))))) | table IntegrityLevel,Account_Name,New_Process_Name | eval sigma_attack_tags="attack.privilege_escalation attack.t1548.002" | eval sigma_title="Always Install Elevated Windows Installer" | eval sigma_description="Detects Windows Installer service (msiexec.exe) trying to install MSI packages with SYSTEM privilege"
dispatch.earliest_time = -24h@h
alert.track = 0

[Always Install Elevated Windows Installer - sysmon]
description = Detects Windows Installer service (msiexec.exe) trying to install MSI packages with SYSTEM privilege
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((((Image="*\\Windows\\Installer\\*" Image="*msi*" Image="*tmp")) OR ((Image="*\\msiexec.exe" IntegrityLevel="System"))) (User="*AUTHORI*" OR User="*AUTORI*"))) NOT (((ParentImage="C:\\Windows\\System32\\services.exe")) OR ((CommandLine="*\\system32\\msiexec.exe /V") OR (ParentCommandLine="*\\system32\\msiexec.exe /V")) OR (((ParentImage="C:\\ProgramData\\Sophos\\*" OR ParentImage="C:\\ProgramData\\Avira\\*" OR ParentImage="C:\\Program Files\\Avast Software\\*" OR ParentImage="C:\\Program Files (x86)\\Avast Software\\*" OR ParentImage="C:\\Program Files\\Google\\Update\\*" OR ParentImage="C:\\Program Files (x86)\\Google\\Update\\*")))))) | table IntegrityLevel,User,Image | eval sigma_attack_tags="attack.privilege_escalation attack.t1548.002" | eval sigma_title="Always Install Elevated Windows Installer" | eval sigma_description="Detects Windows Installer service (msiexec.exe) trying to install MSI packages with SYSTEM privilege"
dispatch.earliest_time = -24h@h
alert.track = 0

[Anydesk Execution From Suspicious Folder - winevent]
description = An adversary may use legitimate desktop support and remote access software, such as Team Viewer, Go2Assist, LogMein, AmmyyAdmin, etc, to establish an interactive command and control channel to target systems within networks.
These services are commonly used as legitimate technical support software, and may be allowed by application control within a target environment.
Remote access tools like VNC, Ammyy, and Teamviewer are used frequently when compared with other legitimate software commonly used by adversaries. (Citation: Symantec Living off the Land)

search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\AnyDesk.exe" OR Description="AnyDesk" OR Product="AnyDesk" OR Company="AnyDesk Software GmbH") NOT (((New_Process_Name="*\\AppData\\*" OR New_Process_Name="*Program Files (x86)\\AnyDesk*" OR New_Process_Name="*Program Files\\AnyDesk*"))))) | eval sigma_attack_tags="attack.command_and_control attack.t1219" | eval sigma_title="Anydesk Execution From Suspicious Folder" | eval sigma_description="An adversary may use legitimate desktop support and remote access software, such as Team Viewer, Go2Assist, LogMein, AmmyyAdmin, etc, to establish an interactive command and control channel to target systems within networks.
These services are commonly used as legitimate technical support software, and may be allowed by application control within a target environment.
Remote access tools like VNC, Ammyy, and Teamviewer are used frequently when compared with other legitimate software commonly used by adversaries. (Citation: Symantec Living off the Land)
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Anydesk Execution From Suspicious Folder - sysmon]
description = An adversary may use legitimate desktop support and remote access software, such as Team Viewer, Go2Assist, LogMein, AmmyyAdmin, etc, to establish an interactive command and control channel to target systems within networks.
These services are commonly used as legitimate technical support software, and may be allowed by application control within a target environment.
Remote access tools like VNC, Ammyy, and Teamviewer are used frequently when compared with other legitimate software commonly used by adversaries. (Citation: Symantec Living off the Land)

search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\AnyDesk.exe" OR Description="AnyDesk" OR Product="AnyDesk" OR Company="AnyDesk Software GmbH") NOT (((Image="*\\AppData\\*" OR Image="*Program Files (x86)\\AnyDesk*" OR Image="*Program Files\\AnyDesk*"))))) | eval sigma_attack_tags="attack.command_and_control attack.t1219" | eval sigma_title="Anydesk Execution From Suspicious Folder" | eval sigma_description="An adversary may use legitimate desktop support and remote access software, such as Team Viewer, Go2Assist, LogMein, AmmyyAdmin, etc, to establish an interactive command and control channel to target systems within networks.
These services are commonly used as legitimate technical support software, and may be allowed by application control within a target environment.
Remote access tools like VNC, Ammyy, and Teamviewer are used frequently when compared with other legitimate software commonly used by adversaries. (Citation: Symantec Living off the Land)
"
dispatch.earliest_time = -24h@h
alert.track = 0

[AnyDesk Execution - winevent]
description = An adversary may use legitimate desktop support and remote access software, such as Team Viewer, Go2Assist, LogMein, AmmyyAdmin, etc, to establish an interactive command and control channel to target systems within networks.
These services are commonly used as legitimate technical support software, and may be allowed by application control within a target environment.
Remote access tools like VNC, Ammyy, and Teamviewer are used frequently when compared with other legitimate software commonly used by adversaries. (Citation: Symantec Living off the Land)

search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\AnyDesk.exe" OR Description="AnyDesk" OR Product="AnyDesk" OR Company="AnyDesk Software GmbH"))) | eval sigma_attack_tags="attack.command_and_control attack.t1219" | eval sigma_title="AnyDesk Execution" | eval sigma_description="An adversary may use legitimate desktop support and remote access software, such as Team Viewer, Go2Assist, LogMein, AmmyyAdmin, etc, to establish an interactive command and control channel to target systems within networks.
These services are commonly used as legitimate technical support software, and may be allowed by application control within a target environment.
Remote access tools like VNC, Ammyy, and Teamviewer are used frequently when compared with other legitimate software commonly used by adversaries. (Citation: Symantec Living off the Land)
"
dispatch.earliest_time = -24h@h
alert.track = 0

[AnyDesk Execution - sysmon]
description = An adversary may use legitimate desktop support and remote access software, such as Team Viewer, Go2Assist, LogMein, AmmyyAdmin, etc, to establish an interactive command and control channel to target systems within networks.
These services are commonly used as legitimate technical support software, and may be allowed by application control within a target environment.
Remote access tools like VNC, Ammyy, and Teamviewer are used frequently when compared with other legitimate software commonly used by adversaries. (Citation: Symantec Living off the Land)

search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\AnyDesk.exe" OR Description="AnyDesk" OR Product="AnyDesk" OR Company="AnyDesk Software GmbH"))) | eval sigma_attack_tags="attack.command_and_control attack.t1219" | eval sigma_title="AnyDesk Execution" | eval sigma_description="An adversary may use legitimate desktop support and remote access software, such as Team Viewer, Go2Assist, LogMein, AmmyyAdmin, etc, to establish an interactive command and control channel to target systems within networks.
These services are commonly used as legitimate technical support software, and may be allowed by application control within a target environment.
Remote access tools like VNC, Ammyy, and Teamviewer are used frequently when compared with other legitimate software commonly used by adversaries. (Citation: Symantec Living off the Land)
"
dispatch.earliest_time = -24h@h
alert.track = 0

[AnyDesk Piped Password Via CLI - winevent]
description = Detects piping the password to an anydesk instance via CMD and the '--set-password' flag.
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*/c *" Process_Command_Line="*echo *" Process_Command_Line="*.exe --set-password*")) | eval sigma_attack_tags="attack.command_and_control attack.t1219" | eval sigma_title="AnyDesk Piped Password Via CLI" | eval sigma_description="Detects piping the password to an anydesk instance via CMD and the '--set-password' flag."
dispatch.earliest_time = -24h@h
alert.track = 0

[AnyDesk Piped Password Via CLI - sysmon]
description = Detects piping the password to an anydesk instance via CMD and the '--set-password' flag.
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*/c *" CommandLine="*echo *" CommandLine="*.exe --set-password*")) | eval sigma_attack_tags="attack.command_and_control attack.t1219" | eval sigma_title="AnyDesk Piped Password Via CLI" | eval sigma_description="Detects piping the password to an anydesk instance via CMD and the '--set-password' flag."
dispatch.earliest_time = -24h@h
alert.track = 0

[AnyDesk Silent Installation - winevent]
description = Detects AnyDesk Remote Desktop silent installation. Which can be used by attackers to gain remote access.
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*--install*" Process_Command_Line="*--start-with-win*" Process_Command_Line="*--silent*")) | table Process_Command_Line,ParentCommandLine,CurrentDirectory | eval sigma_attack_tags="attack.command_and_control attack.t1219" | eval sigma_title="AnyDesk Silent Installation" | eval sigma_description="Detects AnyDesk Remote Desktop silent installation. Which can be used by attackers to gain remote access."
dispatch.earliest_time = -24h@h
alert.track = 0

[AnyDesk Silent Installation - sysmon]
description = Detects AnyDesk Remote Desktop silent installation. Which can be used by attackers to gain remote access.
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*--install*" CommandLine="*--start-with-win*" CommandLine="*--silent*")) | table CommandLine,ParentCommandLine,CurrentDirectory | eval sigma_attack_tags="attack.command_and_control attack.t1219" | eval sigma_title="AnyDesk Silent Installation" | eval sigma_description="Detects AnyDesk Remote Desktop silent installation. Which can be used by attackers to gain remote access."
dispatch.earliest_time = -24h@h
alert.track = 0

[Scheduled Task WScript VBScript - winevent]
description = Detects specific process parameters as used by ACTINIUM scheduled task persistence creation.
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*schtasks*" Process_Command_Line="*create*" Process_Command_Line="*wscript*" Process_Command_Line="*e:vbscript*")) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.persistence attack.t1053 attack.t1053.005" | eval sigma_title="Scheduled Task WScript VBScript" | eval sigma_description="Detects specific process parameters as used by ACTINIUM scheduled task persistence creation."
dispatch.earliest_time = -24h@h
alert.track = 0

[Scheduled Task WScript VBScript - sysmon]
description = Detects specific process parameters as used by ACTINIUM scheduled task persistence creation.
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*schtasks*" CommandLine="*create*" CommandLine="*wscript*" CommandLine="*e:vbscript*")) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.persistence attack.t1053 attack.t1053.005" | eval sigma_title="Scheduled Task WScript VBScript" | eval sigma_description="Detects specific process parameters as used by ACTINIUM scheduled task persistence creation."
dispatch.earliest_time = -24h@h
alert.track = 0

[APT29 - winevent]
description = This method detects a suspicious PowerShell command line combination as used by APT29 in a campaign against U.S. think tanks.
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*-noni*" Process_Command_Line="*-ep*" Process_Command_Line="*bypass*" Process_Command_Line="*$*")) | eval sigma_attack_tags="attack.execution attack.g0016 attack.t1059.001" | eval sigma_title="APT29" | eval sigma_description="This method detects a suspicious PowerShell command line combination as used by APT29 in a campaign against U.S. think tanks."
dispatch.earliest_time = -24h@h
alert.track = 0

[APT29 - sysmon]
description = This method detects a suspicious PowerShell command line combination as used by APT29 in a campaign against U.S. think tanks.
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*-noni*" CommandLine="*-ep*" CommandLine="*bypass*" CommandLine="*$*")) | eval sigma_attack_tags="attack.execution attack.g0016 attack.t1059.001" | eval sigma_title="APT29" | eval sigma_description="This method detects a suspicious PowerShell command line combination as used by APT29 in a campaign against U.S. think tanks."
dispatch.earliest_time = -24h@h
alert.track = 0

[Baby Shark Activity - winevent]
description = Detects activity that could be related to Baby Shark malware
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (Process_Command_Line="*reg*query \"HKEY_CURRENT_USER\\Software\\Microsoft\\Terminal Server Client\\Default\"*" OR Process_Command_Line="*powershell.exe mshta.exe http*" OR Process_Command_Line="*cmd.exe /c taskkill /im cmd.exe*"))) | eval sigma_attack_tags="attack.execution attack.t1059.003 attack.t1059.001 attack.discovery attack.t1012 attack.defense_evasion attack.t1218.005" | eval sigma_title="Baby Shark Activity" | eval sigma_description="Detects activity that could be related to Baby Shark malware"
dispatch.earliest_time = -24h@h
alert.track = 0

[Baby Shark Activity - sysmon]
description = Detects activity that could be related to Baby Shark malware
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (CommandLine="*reg*query \"HKEY_CURRENT_USER\\Software\\Microsoft\\Terminal Server Client\\Default\"*" OR CommandLine="*powershell.exe mshta.exe http*" OR CommandLine="*cmd.exe /c taskkill /im cmd.exe*"))) | eval sigma_attack_tags="attack.execution attack.t1059.003 attack.t1059.001 attack.discovery attack.t1012 attack.defense_evasion attack.t1218.005" | eval sigma_title="Baby Shark Activity" | eval sigma_description="Detects activity that could be related to Baby Shark malware"
dispatch.earliest_time = -24h@h
alert.track = 0

[Judgement Panda Credential Access Activity - winevent]
description = Detects Russian group activity as described in Global Threat Report 2019 by Crowdstrike
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((((New_Process_Name="*\\xcopy.exe" OR OriginalFileName="XCOPY.EXE") ((Process_Command_Line="*/S*" Process_Command_Line="*/E*" Process_Command_Line="*/C*" Process_Command_Line="*/Q*" Process_Command_Line="*/H*" Process_Command_Line="*\\\\\*")))) OR (((New_Process_Name="*\\adexplorer.exe" OR OriginalFileName="AdExp") ((Process_Command_Line="*-snapshot*" Process_Command_Line="*\"\"*" Process_Command_Line="*c:\\users\\*"))))))) | eval sigma_attack_tags="attack.credential_access attack.t1552.001 attack.t1003.003" | eval sigma_title="Judgement Panda Credential Access Activity" | eval sigma_description="Detects Russian group activity as described in Global Threat Report 2019 by Crowdstrike"
dispatch.earliest_time = -24h@h
alert.track = 0

[Judgement Panda Credential Access Activity - sysmon]
description = Detects Russian group activity as described in Global Threat Report 2019 by Crowdstrike
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((((Image="*\\xcopy.exe" OR OriginalFileName="XCOPY.EXE") ((CommandLine="*/S*" CommandLine="*/E*" CommandLine="*/C*" CommandLine="*/Q*" CommandLine="*/H*" CommandLine="*\\\\\*")))) OR (((Image="*\\adexplorer.exe" OR OriginalFileName="AdExp") ((CommandLine="*-snapshot*" CommandLine="*\"\"*" CommandLine="*c:\\users\\*"))))))) | eval sigma_attack_tags="attack.credential_access attack.t1552.001 attack.t1003.003" | eval sigma_title="Judgement Panda Credential Access Activity" | eval sigma_description="Detects Russian group activity as described in Global Threat Report 2019 by Crowdstrike"
dispatch.earliest_time = -24h@h
alert.track = 0

[BlueMashroom DLL Load - winevent]
description = Detects a suspicious DLL loading from AppData Local path as described in BlueMashroom report
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((Process_Command_Line="*\\regsvr32*" Process_Command_Line="*\\AppData\\Local\\*")) OR ((Process_Command_Line="*\\AppData\\Local\\*" Process_Command_Line="*,DllEntry*"))) NOT (((Process_Command_Line="*AppData\\Local\\Microsoft\\TeamsMeetingAddin\\*") OR ((Process_Command_Line="*\\x86\\Microsoft.Teams.AddinLoader.dll" OR Process_Command_Line="*\\x86\\Microsoft.Teams.AddinLoader.dll\"" OR Process_Command_Line="*\\x64\\Microsoft.Teams.AddinLoader.dll" OR Process_Command_Line="*\\x64\\Microsoft.Teams.AddinLoader.dll\""))) OR ((Process_Command_Line="*\\AppData\\Local\\WebEx\\WebEx64\\Meetings\\atucfobj.dll"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218.010" | eval sigma_title="BlueMashroom DLL Load" | eval sigma_description="Detects a suspicious DLL loading from AppData Local path as described in BlueMashroom report"
dispatch.earliest_time = -24h@h
alert.track = 0

[BlueMashroom DLL Load - sysmon]
description = Detects a suspicious DLL loading from AppData Local path as described in BlueMashroom report
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((CommandLine="*\\regsvr32*" CommandLine="*\\AppData\\Local\\*")) OR ((CommandLine="*\\AppData\\Local\\*" CommandLine="*,DllEntry*"))) NOT (((CommandLine="*AppData\\Local\\Microsoft\\TeamsMeetingAddin\\*") OR ((CommandLine="*\\x86\\Microsoft.Teams.AddinLoader.dll" OR CommandLine="*\\x86\\Microsoft.Teams.AddinLoader.dll\"" OR CommandLine="*\\x64\\Microsoft.Teams.AddinLoader.dll" OR CommandLine="*\\x64\\Microsoft.Teams.AddinLoader.dll\""))) OR ((CommandLine="*\\AppData\\Local\\WebEx\\WebEx64\\Meetings\\atucfobj.dll"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218.010" | eval sigma_title="BlueMashroom DLL Load" | eval sigma_description="Detects a suspicious DLL loading from AppData Local path as described in BlueMashroom report"
dispatch.earliest_time = -24h@h
alert.track = 0

[Chafer Activity - winevent]
description = Detects Chafer activity attributed to OilRig as reported in Nyotron report in March 2018
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((Process_Command_Line="*\\Service.exe*" (Process_Command_Line="*i" OR Process_Command_Line="*u"))) OR (Process_Command_Line="*\\microsoft\\Taskbar\\autoit3.exe" OR Process_Command_Line="C:\\wsc.exe*") OR ((New_Process_Name="*\\Windows\\Temp\\DB\\*" New_Process_Name="*.exe")) OR ((Process_Command_Line="*\\nslookup.exe*" Process_Command_Line="*-q=TXT*" Creator_Process_Name="*\\Autoit*"))))) | eval sigma_attack_tags="attack.persistence attack.g0049 attack.t1053.005 attack.s0111 attack.t1543.003 attack.defense_evasion attack.t1112 attack.command_and_control attack.t1071.004" | eval sigma_title="Chafer Activity" | eval sigma_description="Detects Chafer activity attributed to OilRig as reported in Nyotron report in March 2018"
dispatch.earliest_time = -24h@h
alert.track = 0

[Chafer Activity - sysmon]
description = Detects Chafer activity attributed to OilRig as reported in Nyotron report in March 2018
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((CommandLine="*\\Service.exe*" (CommandLine="*i" OR CommandLine="*u"))) OR (CommandLine="*\\microsoft\\Taskbar\\autoit3.exe" OR CommandLine="C:\\wsc.exe*") OR ((Image="*\\Windows\\Temp\\DB\\*" Image="*.exe")) OR ((CommandLine="*\\nslookup.exe*" CommandLine="*-q=TXT*" ParentImage="*\\Autoit*"))))) | eval sigma_attack_tags="attack.persistence attack.g0049 attack.t1053.005 attack.s0111 attack.t1543.003 attack.defense_evasion attack.t1112 attack.command_and_control attack.t1071.004" | eval sigma_title="Chafer Activity" | eval sigma_description="Detects Chafer activity attributed to OilRig as reported in Nyotron report in March 2018"
dispatch.earliest_time = -24h@h
alert.track = 0

[WMIExec VBS Script - winevent]
description = Detects wmiexec vbs version execution by wscript or cscript
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\cscript.exe" OR New_Process_Name="*\\wscript.exe") OR (OriginalFileName="cscript.exe" OR OriginalFileName="wscript.exe")) ((Process_Command_Line="*.vbs*" Process_Command_Line="*/shell*")))) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.execution attack.g0045 attack.t1059.005" | eval sigma_title="WMIExec VBS Script" | eval sigma_description="Detects wmiexec vbs version execution by wscript or cscript"
dispatch.earliest_time = -24h@h
alert.track = 0

[WMIExec VBS Script - sysmon]
description = Detects wmiexec vbs version execution by wscript or cscript
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\cscript.exe" OR Image="*\\wscript.exe") OR (OriginalFileName="cscript.exe" OR OriginalFileName="wscript.exe")) ((CommandLine="*.vbs*" CommandLine="*/shell*")))) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.execution attack.g0045 attack.t1059.005" | eval sigma_title="WMIExec VBS Script" | eval sigma_description="Detects wmiexec vbs version execution by wscript or cscript"
dispatch.earliest_time = -24h@h
alert.track = 0

[CrackMapExecWin - winevent]
description = Detects CrackMapExecWin Activity as Described by NCSC
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\crackmapexec.exe")) | eval sigma_attack_tags="attack.g0035 attack.credential_access attack.discovery attack.t1110 attack.t1087" | eval sigma_title="CrackMapExecWin" | eval sigma_description="Detects CrackMapExecWin Activity as Described by NCSC"
dispatch.earliest_time = -24h@h
alert.track = 0

[CrackMapExecWin - sysmon]
description = Detects CrackMapExecWin Activity as Described by NCSC
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\crackmapexec.exe")) | eval sigma_attack_tags="attack.g0035 attack.credential_access attack.discovery attack.t1110 attack.t1087" | eval sigma_title="CrackMapExecWin" | eval sigma_description="Detects CrackMapExecWin Activity as Described by NCSC"
dispatch.earliest_time = -24h@h
alert.track = 0

[Elise Backdoor - winevent]
description = Detects Elise backdoor acitivty as used by APT32
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((New_Process_Name="C:\\Windows\\SysWOW64\\cmd.exe" Process_Command_Line="*\\Windows\\Caches\\NavShExt.dll *")) OR Process_Command_Line="*\\AppData\\Roaming\\MICROS~1\\Windows\\Caches\\NavShExt.dll,Setting"))) | eval sigma_attack_tags="attack.g0030 attack.g0050 attack.s0081 attack.execution attack.t1059.003" | eval sigma_title="Elise Backdoor" | eval sigma_description="Detects Elise backdoor acitivty as used by APT32"
dispatch.earliest_time = -24h@h
alert.track = 0

[Elise Backdoor - sysmon]
description = Detects Elise backdoor acitivty as used by APT32
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((Image="C:\\Windows\\SysWOW64\\cmd.exe" CommandLine="*\\Windows\\Caches\\NavShExt.dll *")) OR CommandLine="*\\AppData\\Roaming\\MICROS~1\\Windows\\Caches\\NavShExt.dll,Setting"))) | eval sigma_attack_tags="attack.g0030 attack.g0050 attack.s0081 attack.execution attack.t1059.003" | eval sigma_title="Elise Backdoor" | eval sigma_description="Detects Elise backdoor acitivty as used by APT32"
dispatch.earliest_time = -24h@h
alert.track = 0

[Emissary Panda Malware SLLauncher - winevent]
description = Detects the execution of DLL side-loading malware used by threat group Emissary Panda aka APT27
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Creator_Process_Name="*\\sllauncher.exe" New_Process_Name="*\\svchost.exe")) | eval sigma_attack_tags="attack.defense_evasion attack.t1574.002" | eval sigma_title="Emissary Panda Malware SLLauncher" | eval sigma_description="Detects the execution of DLL side-loading malware used by threat group Emissary Panda aka APT27"
dispatch.earliest_time = -24h@h
alert.track = 0

[Emissary Panda Malware SLLauncher - sysmon]
description = Detects the execution of DLL side-loading malware used by threat group Emissary Panda aka APT27
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") ParentImage="*\\sllauncher.exe" Image="*\\svchost.exe")) | eval sigma_attack_tags="attack.defense_evasion attack.t1574.002" | eval sigma_title="Emissary Panda Malware SLLauncher" | eval sigma_description="Detects the execution of DLL side-loading malware used by threat group Emissary Panda aka APT27"
dispatch.earliest_time = -24h@h
alert.track = 0

[Empire Monkey - winevent]
description = Detects EmpireMonkey APT reported Activity
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((Process_Command_Line="*/i:%APPDATA%\\logs.txt scrobj.dll" New_Process_Name="*\\cutil.exe")) OR ((Process_Command_Line="*/i:%APPDATA%\\logs.txt scrobj.dll" Description="Microsoft(C) Registerserver"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218.010" | eval sigma_title="Empire Monkey" | eval sigma_description="Detects EmpireMonkey APT reported Activity"
dispatch.earliest_time = -24h@h
alert.track = 0

[Empire Monkey - sysmon]
description = Detects EmpireMonkey APT reported Activity
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((CommandLine="*/i:%APPDATA%\\logs.txt scrobj.dll" Image="*\\cutil.exe")) OR ((CommandLine="*/i:%APPDATA%\\logs.txt scrobj.dll" Description="Microsoft(C) Registerserver"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218.010" | eval sigma_title="Empire Monkey" | eval sigma_description="Detects EmpireMonkey APT reported Activity"
dispatch.earliest_time = -24h@h
alert.track = 0

[Equation Group DLL_U Load - winevent]
description = Detects a specific tool and export used by EquationGroup
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((New_Process_Name="*\\rundll32.exe" Process_Command_Line="*,dll_u")) OR Process_Command_Line="* -export dll_u *"))) | eval sigma_attack_tags="attack.g0020 attack.defense_evasion attack.t1218.011" | eval sigma_title="Equation Group DLL_U Load" | eval sigma_description="Detects a specific tool and export used by EquationGroup"
dispatch.earliest_time = -24h@h
alert.track = 0

[Equation Group DLL_U Load - sysmon]
description = Detects a specific tool and export used by EquationGroup
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((Image="*\\rundll32.exe" CommandLine="*,dll_u")) OR CommandLine="* -export dll_u *"))) | eval sigma_attack_tags="attack.g0020 attack.defense_evasion attack.t1218.011" | eval sigma_title="Equation Group DLL_U Load" | eval sigma_description="Detects a specific tool and export used by EquationGroup"
dispatch.earliest_time = -24h@h
alert.track = 0

[EvilNum Golden Chickens Deployment via OCX Files - winevent]
description = Detects Golden Chickens deployment method as used by Evilnum in report published in July 2020
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*regsvr32*" Process_Command_Line="*/s*" Process_Command_Line="*/i*" Process_Command_Line="*\\AppData\\Roaming\\*" Process_Command_Line="*.ocx*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1218.011" | eval sigma_title="EvilNum Golden Chickens Deployment via OCX Files" | eval sigma_description="Detects Golden Chickens deployment method as used by Evilnum in report published in July 2020"
dispatch.earliest_time = -24h@h
alert.track = 0

[EvilNum Golden Chickens Deployment via OCX Files - sysmon]
description = Detects Golden Chickens deployment method as used by Evilnum in report published in July 2020
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*regsvr32*" CommandLine="*/s*" CommandLine="*/i*" CommandLine="*\\AppData\\Roaming\\*" CommandLine="*.ocx*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1218.011" | eval sigma_title="EvilNum Golden Chickens Deployment via OCX Files" | eval sigma_description="Detects Golden Chickens deployment method as used by Evilnum in report published in July 2020"
dispatch.earliest_time = -24h@h
alert.track = 0

[GALLIUM Sha1 Artefacts - winevent]
description = Detects artefacts associated with activity group GALLIUM - Microsoft Threat Intelligence Center indicators released in December 2019.
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (sha1="53a44c2396d15c3a03723fa5e5db54cafd527635" OR sha1="9c5e496921e3bc882dc40694f1dcc3746a75db19" OR sha1="aeb573accfd95758550cf30bf04f389a92922844" OR sha1="79ef78a797403a4ed1a616c68e07fff868a8650a" OR sha1="4f6f38b4cec35e895d91c052b1f5a83d665c2196" OR sha1="1e8c2cac2e4ce7cbd33c3858eb2e24531cb8a84d" OR sha1="e841a63e47361a572db9a7334af459ddca11347a" OR sha1="c28f606df28a9bc8df75a4d5e5837fc5522dd34d" OR sha1="2e94b305d6812a9f96e6781c888e48c7fb157b6b" OR sha1="dd44133716b8a241957b912fa6a02efde3ce3025" OR sha1="8793bf166cb89eb55f0593404e4e933ab605e803" OR sha1="a39b57032dbb2335499a51e13470a7cd5d86b138" OR sha1="41cc2b15c662bc001c0eb92f6cc222934f0beeea" OR sha1="d209430d6af54792371174e70e27dd11d3def7a7" OR sha1="1c6452026c56efd2c94cea7e0f671eb55515edb0" OR sha1="c6b41d3afdcdcaf9f442bbe772f5da871801fd5a" OR sha1="4923d460e22fbbf165bbbaba168e5a46b8157d9f" OR sha1="f201504bd96e81d0d350c3a8332593ee1c9e09de" OR sha1="ddd2db1127632a2a52943a2fe516a2e7d05d70d2"))) | eval sigma_attack_tags="attack.credential_access attack.t1212 attack.command_and_control attack.t1071" | eval sigma_title="GALLIUM Sha1 Artefacts" | eval sigma_description="Detects artefacts associated with activity group GALLIUM - Microsoft Threat Intelligence Center indicators released in December 2019."
dispatch.earliest_time = -24h@h
alert.track = 0

[GALLIUM Sha1 Artefacts - sysmon]
description = Detects artefacts associated with activity group GALLIUM - Microsoft Threat Intelligence Center indicators released in December 2019.
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (sha1="53a44c2396d15c3a03723fa5e5db54cafd527635" OR sha1="9c5e496921e3bc882dc40694f1dcc3746a75db19" OR sha1="aeb573accfd95758550cf30bf04f389a92922844" OR sha1="79ef78a797403a4ed1a616c68e07fff868a8650a" OR sha1="4f6f38b4cec35e895d91c052b1f5a83d665c2196" OR sha1="1e8c2cac2e4ce7cbd33c3858eb2e24531cb8a84d" OR sha1="e841a63e47361a572db9a7334af459ddca11347a" OR sha1="c28f606df28a9bc8df75a4d5e5837fc5522dd34d" OR sha1="2e94b305d6812a9f96e6781c888e48c7fb157b6b" OR sha1="dd44133716b8a241957b912fa6a02efde3ce3025" OR sha1="8793bf166cb89eb55f0593404e4e933ab605e803" OR sha1="a39b57032dbb2335499a51e13470a7cd5d86b138" OR sha1="41cc2b15c662bc001c0eb92f6cc222934f0beeea" OR sha1="d209430d6af54792371174e70e27dd11d3def7a7" OR sha1="1c6452026c56efd2c94cea7e0f671eb55515edb0" OR sha1="c6b41d3afdcdcaf9f442bbe772f5da871801fd5a" OR sha1="4923d460e22fbbf165bbbaba168e5a46b8157d9f" OR sha1="f201504bd96e81d0d350c3a8332593ee1c9e09de" OR sha1="ddd2db1127632a2a52943a2fe516a2e7d05d70d2"))) | eval sigma_attack_tags="attack.credential_access attack.t1212 attack.command_and_control attack.t1071" | eval sigma_title="GALLIUM Sha1 Artefacts" | eval sigma_description="Detects artefacts associated with activity group GALLIUM - Microsoft Threat Intelligence Center indicators released in December 2019."
dispatch.earliest_time = -24h@h
alert.track = 0

[GALLIUM Artefacts - winevent]
description = Detects artefacts associated with activity group GALLIUM - Microsoft Threat Intelligence Center indicators released in December 2019.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) sha1="e570585edc69f9074cb5e8a790708336bd45ca0f" NOT (((New_Process_Name="*:\\Program Files(x86)\\*" OR New_Process_Name="*:\\Program Files\\*"))))) | eval sigma_attack_tags="attack.credential_access attack.t1212 attack.command_and_control attack.t1071" | eval sigma_title="GALLIUM Artefacts" | eval sigma_description="Detects artefacts associated with activity group GALLIUM - Microsoft Threat Intelligence Center indicators released in December 2019."
dispatch.earliest_time = -24h@h
alert.track = 0

[GALLIUM Artefacts - sysmon]
description = Detects artefacts associated with activity group GALLIUM - Microsoft Threat Intelligence Center indicators released in December 2019.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) sha1="e570585edc69f9074cb5e8a790708336bd45ca0f" NOT (((Image="*:\\Program Files(x86)\\*" OR Image="*:\\Program Files\\*"))))) | eval sigma_attack_tags="attack.credential_access attack.t1212 attack.command_and_control attack.t1071" | eval sigma_title="GALLIUM Artefacts" | eval sigma_description="Detects artefacts associated with activity group GALLIUM - Microsoft Threat Intelligence Center indicators released in December 2019."
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious UltraVNC Execution - winevent]
description = Detects suspicious UltraVNC command line flag combination that indicate a auto reconnect upon execution, e.g. startup (as seen being used by Gamaredon threat group)
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*-autoreconnect *" Process_Command_Line="*-connect *" Process_Command_Line="*-id:*")) | eval sigma_attack_tags="attack.lateral_movement attack.g0047 attack.t1021.005" | eval sigma_title="Suspicious UltraVNC Execution" | eval sigma_description="Detects suspicious UltraVNC command line flag combination that indicate a auto reconnect upon execution, e.g. startup (as seen being used by Gamaredon threat group)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious UltraVNC Execution - sysmon]
description = Detects suspicious UltraVNC command line flag combination that indicate a auto reconnect upon execution, e.g. startup (as seen being used by Gamaredon threat group)
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*-autoreconnect *" CommandLine="*-connect *" CommandLine="*-id:*")) | eval sigma_attack_tags="attack.lateral_movement attack.g0047 attack.t1021.005" | eval sigma_title="Suspicious UltraVNC Execution" | eval sigma_description="Detects suspicious UltraVNC command line flag combination that indicate a auto reconnect upon execution, e.g. startup (as seen being used by Gamaredon threat group)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Greenbug Campaign Indicators - winevent]
description = Detects tools and process executions as observed in a Greenbug campaign in May 2020
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((Process_Command_Line="*bitsadmin*" Process_Command_Line="*/transfer*" Process_Command_Line="*CSIDL_APPDATA*")) OR Process_Command_Line="*CSIDL_SYSTEM_DRIVE*" OR (Process_Command_Line="*\\msf.ps1*" OR Process_Command_Line="*8989 -e cmd.exe*" OR Process_Command_Line="*system.Data.SqlClient.SqlDataAdapter($cmd); [void]$da.fill*" OR Process_Command_Line="*-nop -w hidden -c $k=new-object*" OR Process_Command_Line="*[Net.CredentialCache]::DefaultCredentials;IEX *" OR Process_Command_Line="* -nop -w hidden -c $m=new-object net.webclient;$m*" OR Process_Command_Line="*-noninteractive -executionpolicy bypass whoami*" OR Process_Command_Line="*-noninteractive -executionpolicy bypass netstat -a*" OR Process_Command_Line="*L3NlcnZlcj1*") OR (New_Process_Name="*\\adobe\\Adobe.exe" OR New_Process_Name="*\\oracle\\local.exe" OR New_Process_Name="*\\revshell.exe" OR New_Process_Name="*infopagesbackup\\ncat.exe" OR New_Process_Name="*CSIDL_SYSTEM\\cmd.exe" OR New_Process_Name="*\\programdata\\oracle\\java.exe" OR New_Process_Name="*CSIDL_COMMON_APPDATA\\comms\\comms.exe" OR New_Process_Name="*\\Programdata\\VMware\\Vmware.exe")))) | eval sigma_attack_tags="attack.g0049 attack.execution attack.t1059.001 attack.command_and_control attack.t1105 attack.defense_evasion attack.t1036.005" | eval sigma_title="Greenbug Campaign Indicators" | eval sigma_description="Detects tools and process executions as observed in a Greenbug campaign in May 2020"
dispatch.earliest_time = -24h@h
alert.track = 0

[Greenbug Campaign Indicators - sysmon]
description = Detects tools and process executions as observed in a Greenbug campaign in May 2020
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((CommandLine="*bitsadmin*" CommandLine="*/transfer*" CommandLine="*CSIDL_APPDATA*")) OR CommandLine="*CSIDL_SYSTEM_DRIVE*" OR (CommandLine="*\\msf.ps1*" OR CommandLine="*8989 -e cmd.exe*" OR CommandLine="*system.Data.SqlClient.SqlDataAdapter($cmd); [void]$da.fill*" OR CommandLine="*-nop -w hidden -c $k=new-object*" OR CommandLine="*[Net.CredentialCache]::DefaultCredentials;IEX *" OR CommandLine="* -nop -w hidden -c $m=new-object net.webclient;$m*" OR CommandLine="*-noninteractive -executionpolicy bypass whoami*" OR CommandLine="*-noninteractive -executionpolicy bypass netstat -a*" OR CommandLine="*L3NlcnZlcj1*") OR (Image="*\\adobe\\Adobe.exe" OR Image="*\\oracle\\local.exe" OR Image="*\\revshell.exe" OR Image="*infopagesbackup\\ncat.exe" OR Image="*CSIDL_SYSTEM\\cmd.exe" OR Image="*\\programdata\\oracle\\java.exe" OR Image="*CSIDL_COMMON_APPDATA\\comms\\comms.exe" OR Image="*\\Programdata\\VMware\\Vmware.exe")))) | eval sigma_attack_tags="attack.g0049 attack.execution attack.t1059.001 attack.command_and_control attack.t1105 attack.defense_evasion attack.t1036.005" | eval sigma_title="Greenbug Campaign Indicators" | eval sigma_description="Detects tools and process executions as observed in a Greenbug campaign in May 2020"
dispatch.earliest_time = -24h@h
alert.track = 0

[Exchange Exploitation Activity - winevent]
description = Detects activity observed by different researchers to be HAFNIUM group activity (or related) on Exchange servers
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((Process_Command_Line="*attrib*" Process_Command_Line="* +h *" Process_Command_Line="* +s *" Process_Command_Line="* +r *" Process_Command_Line="*.aspx*")) OR ((Process_Command_Line="*schtasks*" Process_Command_Line="*VSPerfMon*")) OR ((Process_Command_Line="*vssadmin list shadows*" Process_Command_Line="*Temp\\__output*")) OR Process_Command_Line="*%TEMP%\\execute.bat*" OR New_Process_Name="*Users\\Public\\opera\\Opera_browser.exe" OR ((New_Process_Name="*Opera_browser.exe" (Creator_Process_Name="*\\services.exe" OR Creator_Process_Name="*\\svchost.exe"))) OR New_Process_Name="*\\ProgramData\\VSPerfMon\\*" OR ((Process_Command_Line="* -t7z *" Process_Command_Line="*C:\\Programdata\\pst*" Process_Command_Line="*\\it.zip*")) OR ((New_Process_Name="*\\makecab.exe" (Process_Command_Line="*Microsoft\\Exchange Server\\*" OR Process_Command_Line="*inetpub\\wwwroot*"))) OR (Process_Command_Line="*\\Temp\\xx.bat*" OR Process_Command_Line="*Windows\\WwanSvcdcs*" OR Process_Command_Line="*Windows\\Temp\\cw.exe*") OR ((Process_Command_Line="*\\comsvcs.dll*" Process_Command_Line="*Minidump*" Process_Command_Line="*\\inetpub\\wwwroot*")) OR ((Process_Command_Line="*dsquery*" Process_Command_Line="* -uco *" Process_Command_Line="*\\inetpub\\wwwroot*"))))) | eval sigma_attack_tags="attack.persistence attack.t1546 attack.t1053" | eval sigma_title="Exchange Exploitation Activity" | eval sigma_description="Detects activity observed by different researchers to be HAFNIUM group activity (or related) on Exchange servers"
dispatch.earliest_time = -24h@h
alert.track = 0

[Exchange Exploitation Activity - sysmon]
description = Detects activity observed by different researchers to be HAFNIUM group activity (or related) on Exchange servers
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((CommandLine="*attrib*" CommandLine="* +h *" CommandLine="* +s *" CommandLine="* +r *" CommandLine="*.aspx*")) OR ((CommandLine="*schtasks*" CommandLine="*VSPerfMon*")) OR ((CommandLine="*vssadmin list shadows*" CommandLine="*Temp\\__output*")) OR CommandLine="*%TEMP%\\execute.bat*" OR Image="*Users\\Public\\opera\\Opera_browser.exe" OR ((Image="*Opera_browser.exe" (ParentImage="*\\services.exe" OR ParentImage="*\\svchost.exe"))) OR Image="*\\ProgramData\\VSPerfMon\\*" OR ((CommandLine="* -t7z *" CommandLine="*C:\\Programdata\\pst*" CommandLine="*\\it.zip*")) OR ((Image="*\\makecab.exe" (CommandLine="*Microsoft\\Exchange Server\\*" OR CommandLine="*inetpub\\wwwroot*"))) OR (CommandLine="*\\Temp\\xx.bat*" OR CommandLine="*Windows\\WwanSvcdcs*" OR CommandLine="*Windows\\Temp\\cw.exe*") OR ((CommandLine="*\\comsvcs.dll*" CommandLine="*Minidump*" CommandLine="*\\inetpub\\wwwroot*")) OR ((CommandLine="*dsquery*" CommandLine="* -uco *" CommandLine="*\\inetpub\\wwwroot*"))))) | eval sigma_attack_tags="attack.persistence attack.t1546 attack.t1053" | eval sigma_title="Exchange Exploitation Activity" | eval sigma_description="Detects activity observed by different researchers to be HAFNIUM group activity (or related) on Exchange servers"
dispatch.earliest_time = -24h@h
alert.track = 0

[Hurricane Panda Activity - winevent]
description = Detects Hurricane Panda Activity
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((Process_Command_Line="*localgroup*" Process_Command_Line="*admin*" Process_Command_Line="*/add*")) OR Process_Command_Line="*\\Win64.exe*"))) | eval sigma_attack_tags="attack.privilege_escalation attack.g0009 attack.t1068" | eval sigma_title="Hurricane Panda Activity" | eval sigma_description="Detects Hurricane Panda Activity"
dispatch.earliest_time = -24h@h
alert.track = 0

[Hurricane Panda Activity - sysmon]
description = Detects Hurricane Panda Activity
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((CommandLine="*localgroup*" CommandLine="*admin*" CommandLine="*/add*")) OR CommandLine="*\\Win64.exe*"))) | eval sigma_attack_tags="attack.privilege_escalation attack.g0009 attack.t1068" | eval sigma_title="Hurricane Panda Activity" | eval sigma_description="Detects Hurricane Panda Activity"
dispatch.earliest_time = -24h@h
alert.track = 0

[Judgement Panda Exfil Activity - winevent]
description = Detects Judgement Panda activity as described in Global Threat Report 2019 by Crowdstrike
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (Process_Command_Line="*eprod.ldf" OR (Process_Command_Line="*\\ldifde.exe -f -n *" OR Process_Command_Line="*\\7za.exe a 1.7z *" OR Process_Command_Line="*\\aaaa\\procdump64.exe*" OR Process_Command_Line="*\\aaaa\\netsess.exe*" OR Process_Command_Line="*\\aaaa\\7za.exe*" OR Process_Command_Line="*copy .\\1.7z \\*" OR Process_Command_Line="*copy \\client\\c$\\aaaa\\*") OR New_Process_Name="C:\\Users\\Public\\7za.exe"))) | eval sigma_attack_tags="attack.lateral_movement attack.g0010 attack.credential_access attack.t1003.001 attack.exfiltration attack.t1560.001" | eval sigma_title="Judgement Panda Exfil Activity" | eval sigma_description="Detects Judgement Panda activity as described in Global Threat Report 2019 by Crowdstrike"
dispatch.earliest_time = -24h@h
alert.track = 0

[Judgement Panda Exfil Activity - sysmon]
description = Detects Judgement Panda activity as described in Global Threat Report 2019 by Crowdstrike
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (CommandLine="*eprod.ldf" OR (CommandLine="*\\ldifde.exe -f -n *" OR CommandLine="*\\7za.exe a 1.7z *" OR CommandLine="*\\aaaa\\procdump64.exe*" OR CommandLine="*\\aaaa\\netsess.exe*" OR CommandLine="*\\aaaa\\7za.exe*" OR CommandLine="*copy .\\1.7z \\*" OR CommandLine="*copy \\client\\c$\\aaaa\\*") OR Image="C:\\Users\\Public\\7za.exe"))) | eval sigma_attack_tags="attack.lateral_movement attack.g0010 attack.credential_access attack.t1003.001 attack.exfiltration attack.t1560.001" | eval sigma_title="Judgement Panda Exfil Activity" | eval sigma_description="Detects Judgement Panda activity as described in Global Threat Report 2019 by Crowdstrike"
dispatch.earliest_time = -24h@h
alert.track = 0

[Ke3chang Registry Key Modifications - winevent]
description = Detects Registry modifications performed by Ke3chang malware in campaigns running in 2019 and 2020
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (Process_Command_Line="*-Property DWORD -name DisableFirstRunCustomize -value 2 -Force*" OR Process_Command_Line="*-Property String -name Check_Associations -value*" OR Process_Command_Line="*-Property DWORD -name IEHarden -value 0 -Force*"))) | eval sigma_attack_tags="attack.g0004 attack.defense_evasion attack.t1562.001" | eval sigma_title="Ke3chang Registry Key Modifications" | eval sigma_description="Detects Registry modifications performed by Ke3chang malware in campaigns running in 2019 and 2020"
dispatch.earliest_time = -24h@h
alert.track = 0

[Ke3chang Registry Key Modifications - sysmon]
description = Detects Registry modifications performed by Ke3chang malware in campaigns running in 2019 and 2020
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (CommandLine="*-Property DWORD -name DisableFirstRunCustomize -value 2 -Force*" OR CommandLine="*-Property String -name Check_Associations -value*" OR CommandLine="*-Property DWORD -name IEHarden -value 0 -Force*"))) | eval sigma_attack_tags="attack.g0004 attack.defense_evasion attack.t1562.001" | eval sigma_title="Ke3chang Registry Key Modifications" | eval sigma_description="Detects Registry modifications performed by Ke3chang malware in campaigns running in 2019 and 2020"
dispatch.earliest_time = -24h@h
alert.track = 0

[Lazarus Activity Apr21 - winevent]
description = Detects different process creation events as described in Malwarebytes's threat report on Lazarus group activity
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((Process_Command_Line="*mshta*" Process_Command_Line="*.zip*")) OR ((Creator_Process_Name="C:\\Windows\\System32\\wbem\\wmiprvse.exe" New_Process_Name="C:\\Windows\\System32\\mshta.exe")) OR ((Creator_Process_Name="*:\\Users\\Public\\*" New_Process_Name="C:\\Windows\\System32\\rundll32.exe"))))) | eval sigma_attack_tags="attack.g0032 attack.execution attack.t1106" | eval sigma_title="Lazarus Activity Apr21" | eval sigma_description="Detects different process creation events as described in Malwarebytes's threat report on Lazarus group activity"
dispatch.earliest_time = -24h@h
alert.track = 0

[Lazarus Activity Apr21 - sysmon]
description = Detects different process creation events as described in Malwarebytes's threat report on Lazarus group activity
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((CommandLine="*mshta*" CommandLine="*.zip*")) OR ((ParentImage="C:\\Windows\\System32\\wbem\\wmiprvse.exe" Image="C:\\Windows\\System32\\mshta.exe")) OR ((ParentImage="*:\\Users\\Public\\*" Image="C:\\Windows\\System32\\rundll32.exe"))))) | eval sigma_attack_tags="attack.g0032 attack.execution attack.t1106" | eval sigma_title="Lazarus Activity Apr21" | eval sigma_description="Detects different process creation events as described in Malwarebytes's threat report on Lazarus group activity"
dispatch.earliest_time = -24h@h
alert.track = 0

[Lazarus Activity Dec20 - winevent]
description = Detects different process creation events as described in various threat reports on Lazarus group activity
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((Process_Command_Line="*reg.exe save hklm\\sam %temp%\\~reg_sam.save*" OR Process_Command_Line="*1q2w3e4r@#$@#$@#$*" OR Process_Command_Line="* -hp1q2w3e4 *" OR Process_Command_Line="*.dat data03 10000 -p *") OR ((Process_Command_Line="*process call create*" Process_Command_Line="* > %temp%\\~*")) OR ((Process_Command_Line="*netstat -aon | find *" Process_Command_Line="* > %temp%\\~*")) OR Process_Command_Line="*.255 10 C:\\ProgramData\\*"))) | eval sigma_attack_tags="attack.g0032 attack.execution attack.t1059" | eval sigma_title="Lazarus Activity Dec20" | eval sigma_description="Detects different process creation events as described in various threat reports on Lazarus group activity"
dispatch.earliest_time = -24h@h
alert.track = 0

[Lazarus Activity Dec20 - sysmon]
description = Detects different process creation events as described in various threat reports on Lazarus group activity
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((CommandLine="*reg.exe save hklm\\sam %temp%\\~reg_sam.save*" OR CommandLine="*1q2w3e4r@#$@#$@#$*" OR CommandLine="* -hp1q2w3e4 *" OR CommandLine="*.dat data03 10000 -p *") OR ((CommandLine="*process call create*" CommandLine="* > %temp%\\~*")) OR ((CommandLine="*netstat -aon | find *" CommandLine="* > %temp%\\~*")) OR CommandLine="*.255 10 C:\\ProgramData\\*"))) | eval sigma_attack_tags="attack.g0032 attack.execution attack.t1059" | eval sigma_title="Lazarus Activity Dec20" | eval sigma_description="Detects different process creation events as described in various threat reports on Lazarus group activity"
dispatch.earliest_time = -24h@h
alert.track = 0

[Lazarus Loaders - winevent]
description = Detects different loaders as described in various threat reports on Lazarus group activity
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((Process_Command_Line="*cmd.exe /c *" Process_Command_Line="* -p 0x*" (Process_Command_Line="*C:\\ProgramData\\*" OR Process_Command_Line="*C:\\RECYCLER\\*"))) OR ((Process_Command_Line="*rundll32.exe *" Process_Command_Line="*C:\\ProgramData\\*" (Process_Command_Line="*.bin,*" OR Process_Command_Line="*.tmp,*" OR Process_Command_Line="*.dat,*" OR Process_Command_Line="*.io,*" OR Process_Command_Line="*.ini,*" OR Process_Command_Line="*.db,*")))))) | eval sigma_attack_tags="attack.g0032 attack.execution attack.t1059" | eval sigma_title="Lazarus Loaders" | eval sigma_description="Detects different loaders as described in various threat reports on Lazarus group activity"
dispatch.earliest_time = -24h@h
alert.track = 0

[Lazarus Loaders - sysmon]
description = Detects different loaders as described in various threat reports on Lazarus group activity
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((CommandLine="*cmd.exe /c *" CommandLine="* -p 0x*" (CommandLine="*C:\\ProgramData\\*" OR CommandLine="*C:\\RECYCLER\\*"))) OR ((CommandLine="*rundll32.exe *" CommandLine="*C:\\ProgramData\\*" (CommandLine="*.bin,*" OR CommandLine="*.tmp,*" OR CommandLine="*.dat,*" OR CommandLine="*.io,*" OR CommandLine="*.ini,*" OR CommandLine="*.db,*")))))) | eval sigma_attack_tags="attack.g0032 attack.execution attack.t1059" | eval sigma_title="Lazarus Loaders" | eval sigma_description="Detects different loaders as described in various threat reports on Lazarus group activity"
dispatch.earliest_time = -24h@h
alert.track = 0

[Lazarus Session Highjacker - winevent]
description = Detects executables launched outside their default directories as used by Lazarus Group (Bluenoroff)
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\msdtc.exe" OR New_Process_Name="*\\gpvc.exe") NOT (((New_Process_Name="C:\\Windows\\System32\\*" OR New_Process_Name="C:\\Windows\\SysWOW64\\*"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1036.005" | eval sigma_title="Lazarus Session Highjacker" | eval sigma_description="Detects executables launched outside their default directories as used by Lazarus Group (Bluenoroff)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Lazarus Session Highjacker - sysmon]
description = Detects executables launched outside their default directories as used by Lazarus Group (Bluenoroff)
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\msdtc.exe" OR Image="*\\gpvc.exe") NOT (((Image="C:\\Windows\\System32\\*" OR Image="C:\\Windows\\SysWOW64\\*"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1036.005" | eval sigma_title="Lazarus Session Highjacker" | eval sigma_description="Detects executables launched outside their default directories as used by Lazarus Group (Bluenoroff)"
dispatch.earliest_time = -24h@h
alert.track = 0

[MERCURY Command Line Patterns - winevent]
description = Detects suspicious command line patterns as seen being used by MERCURY threat actor
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*-exec bypass -w 1 -enc*" Process_Command_Line="*UwB0AGEAcgB0AC0ASgBvAGIAIAAtAFMAYwByAGkAcAB0AEIAbABvAGMAaw*")) | eval sigma_attack_tags="attack.execution attack.t1059.001 attack.g0069" | eval sigma_title="MERCURY Command Line Patterns" | eval sigma_description="Detects suspicious command line patterns as seen being used by MERCURY threat actor"
dispatch.earliest_time = -24h@h
alert.track = 0

[MERCURY Command Line Patterns - sysmon]
description = Detects suspicious command line patterns as seen being used by MERCURY threat actor
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*-exec bypass -w 1 -enc*" CommandLine="*UwB0AGEAcgB0AC0ASgBvAGIAIAAtAFMAYwByAGkAcAB0AEIAbABvAGMAaw*")) | eval sigma_attack_tags="attack.execution attack.t1059.001 attack.g0069" | eval sigma_title="MERCURY Command Line Patterns" | eval sigma_description="Detects suspicious command line patterns as seen being used by MERCURY threat actor"
dispatch.earliest_time = -24h@h
alert.track = 0

[DNS Tunnel Technique from MuddyWater - winevent]
description = Detecting DNS tunnel activity for Muddywater actor
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (New_Process_Name="*\\powershell.exe" OR New_Process_Name="*\\pwsh.exe") Creator_Process_Name="*\\excel.exe" Process_Command_Line="*DataExchange.dll*")) | eval sigma_attack_tags="attack.command_and_control attack.t1071.004" | eval sigma_title="DNS Tunnel Technique from MuddyWater" | eval sigma_description="Detecting DNS tunnel activity for Muddywater actor"
dispatch.earliest_time = -24h@h
alert.track = 0

[DNS Tunnel Technique from MuddyWater - sysmon]
description = Detecting DNS tunnel activity for Muddywater actor
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (Image="*\\powershell.exe" OR Image="*\\pwsh.exe") ParentImage="*\\excel.exe" CommandLine="*DataExchange.dll*")) | eval sigma_attack_tags="attack.command_and_control attack.t1071.004" | eval sigma_title="DNS Tunnel Technique from MuddyWater" | eval sigma_description="Detecting DNS tunnel activity for Muddywater actor"
dispatch.earliest_time = -24h@h
alert.track = 0

[Mustang Panda Dropper - winevent]
description = Detects specific process parameters as used by Mustang Panda droppers
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((Process_Command_Line="*Temp\\wtask.exe /create*" OR Process_Command_Line="*%windir:~-3,1%%PUBLIC:~-9,1%*" OR Process_Command_Line="*/tn \"Security Script *" OR Process_Command_Line="*%windir:~-1,1%*") OR ((Process_Command_Line="*/E:vbscript*" Process_Command_Line="*C:\\Users\\*" Process_Command_Line="*.txt*" Process_Command_Line="*/F*")) OR New_Process_Name="*Temp\\winwsh.exe"))) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.t1587.001 attack.resource_development" | eval sigma_title="Mustang Panda Dropper" | eval sigma_description="Detects specific process parameters as used by Mustang Panda droppers"
dispatch.earliest_time = -24h@h
alert.track = 0

[Mustang Panda Dropper - sysmon]
description = Detects specific process parameters as used by Mustang Panda droppers
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((CommandLine="*Temp\\wtask.exe /create*" OR CommandLine="*%windir:~-3,1%%PUBLIC:~-9,1%*" OR CommandLine="*/tn \"Security Script *" OR CommandLine="*%windir:~-1,1%*") OR ((CommandLine="*/E:vbscript*" CommandLine="*C:\\Users\\*" CommandLine="*.txt*" CommandLine="*/F*")) OR Image="*Temp\\winwsh.exe"))) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.t1587.001 attack.resource_development" | eval sigma_title="Mustang Panda Dropper" | eval sigma_description="Detects specific process parameters as used by Mustang Panda droppers"
dispatch.earliest_time = -24h@h
alert.track = 0

[REvil Kaseya Incident Malware Patterns - winevent]
description = Detects process command line patterns and locations used by REvil group in Kaseya incident (can also match on other malware)
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((Process_Command_Line="*C:\\Windows\\cert.exe*" OR Process_Command_Line="*del /q /f c:\\kworking\\agent.crt*" OR Process_Command_Line="*Kaseya VSA Agent Hot-fix*" OR Process_Command_Line="*\\AppData\\Local\\Temp\\MsMpEng.exe*" OR Process_Command_Line="*rmdir /s /q %SystemDrive%\\inetpub\\logs*" OR Process_Command_Line="*del /s /q /f %SystemDrive%\\*.log*" OR Process_Command_Line="*c:\\kworking1\\agent.exe*" OR Process_Command_Line="*c:\\kworking1\\agent.crt*") OR (New_Process_Name="C:\\Windows\\MsMpEng.exe" OR New_Process_Name="C:\\Windows\\cert.exe" OR New_Process_Name="C:\\kworking\\agent.exe" OR New_Process_Name="C:\\kworking1\\agent.exe") OR ((Process_Command_Line="*del /s /q /f*" Process_Command_Line="*WebPages\\Errors\\webErrorLog.txt*"))))) | eval sigma_attack_tags="attack.execution attack.t1059 attack.g0115" | eval sigma_title="REvil Kaseya Incident Malware Patterns" | eval sigma_description="Detects process command line patterns and locations used by REvil group in Kaseya incident (can also match on other malware)"
dispatch.earliest_time = -24h@h
alert.track = 0

[REvil Kaseya Incident Malware Patterns - sysmon]
description = Detects process command line patterns and locations used by REvil group in Kaseya incident (can also match on other malware)
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((CommandLine="*C:\\Windows\\cert.exe*" OR CommandLine="*del /q /f c:\\kworking\\agent.crt*" OR CommandLine="*Kaseya VSA Agent Hot-fix*" OR CommandLine="*\\AppData\\Local\\Temp\\MsMpEng.exe*" OR CommandLine="*rmdir /s /q %SystemDrive%\\inetpub\\logs*" OR CommandLine="*del /s /q /f %SystemDrive%\\*.log*" OR CommandLine="*c:\\kworking1\\agent.exe*" OR CommandLine="*c:\\kworking1\\agent.crt*") OR (Image="C:\\Windows\\MsMpEng.exe" OR Image="C:\\Windows\\cert.exe" OR Image="C:\\kworking\\agent.exe" OR Image="C:\\kworking1\\agent.exe") OR ((CommandLine="*del /s /q /f*" CommandLine="*WebPages\\Errors\\webErrorLog.txt*"))))) | eval sigma_attack_tags="attack.execution attack.t1059 attack.g0115" | eval sigma_title="REvil Kaseya Incident Malware Patterns" | eval sigma_description="Detects process command line patterns and locations used by REvil group in Kaseya incident (can also match on other malware)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Defrag Deactivation - winevent]
description = Detects the deactivation and disabling of the Scheduled defragmentation task as seen by Slingshot APT group
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\schtasks.exe" (Process_Command_Line="*/delete*" OR Process_Command_Line="*/change*") Process_Command_Line="*/TN*" Process_Command_Line="*\\Microsoft\\Windows\\Defrag\\ScheduledDefrag*")) | eval sigma_attack_tags="attack.persistence attack.t1053.005 attack.s0111" | eval sigma_title="Defrag Deactivation" | eval sigma_description="Detects the deactivation and disabling of the Scheduled defragmentation task as seen by Slingshot APT group"
dispatch.earliest_time = -24h@h
alert.track = 0

[Defrag Deactivation - sysmon]
description = Detects the deactivation and disabling of the Scheduled defragmentation task as seen by Slingshot APT group
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\schtasks.exe" (CommandLine="*/delete*" OR CommandLine="*/change*") CommandLine="*/TN*" CommandLine="*\\Microsoft\\Windows\\Defrag\\ScheduledDefrag*")) | eval sigma_attack_tags="attack.persistence attack.t1053.005 attack.s0111" | eval sigma_title="Defrag Deactivation" | eval sigma_description="Detects the deactivation and disabling of the Scheduled defragmentation task as seen by Slingshot APT group"
dispatch.earliest_time = -24h@h
alert.track = 0

[Sofacy Trojan Loader Activity - winevent]
description = Detects Trojan loader activity as used by APT28
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((Process_Command_Line="*rundll32.exe*" Process_Command_Line="*%APPDATA%\\*")) (Process_Command_Line="*.dat\",*" OR (Process_Command_Line="*.dll\",#1" OR Process_Command_Line="*.dll #1" OR Process_Command_Line="*.dll\" #1")))) | eval sigma_attack_tags="attack.g0007 attack.execution attack.t1059.003 attack.defense_evasion car.2013-10-002 attack.t1218.011" | eval sigma_title="Sofacy Trojan Loader Activity" | eval sigma_description="Detects Trojan loader activity as used by APT28"
dispatch.earliest_time = -24h@h
alert.track = 0

[Sofacy Trojan Loader Activity - sysmon]
description = Detects Trojan loader activity as used by APT28
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((CommandLine="*rundll32.exe*" CommandLine="*%APPDATA%\\*")) (CommandLine="*.dat\",*" OR (CommandLine="*.dll\",#1" OR CommandLine="*.dll #1" OR CommandLine="*.dll\" #1")))) | eval sigma_attack_tags="attack.g0007 attack.execution attack.t1059.003 attack.defense_evasion car.2013-10-002 attack.t1218.011" | eval sigma_title="Sofacy Trojan Loader Activity" | eval sigma_description="Detects Trojan loader activity as used by APT28"
dispatch.earliest_time = -24h@h
alert.track = 0

[SOURGUM Actor Behaviours - winevent]
description = Suspicious behaviours related to an actor tracked by Microsoft as SOURGUM
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*windows\\system32\\Physmem.sys*" OR New_Process_Name="*Windows\\system32\\ime\\SHARED\\WimBootConfigurations.ini*" OR New_Process_Name="*Windows\\system32\\ime\\IMEJP\\WimBootConfigurations.ini*" OR New_Process_Name="*Windows\\system32\\ime\\IMETC\\WimBootConfigurations.ini*") OR (((New_Process_Name="*windows\\system32\\filepath2*" OR New_Process_Name="*windows\\system32\\ime*") Process_Command_Line="*reg add*" (Process_Command_Line="*HKEY_LOCAL_MACHINE\\software\\classes\\clsid\\{7c857801-7381-11cf-884d-00aa004b2e24}\\inprocserver32*" OR Process_Command_Line="*HKEY_LOCAL_MACHINE\\software\\classes\\clsid\\{cf4cc405-e2c5-4ddd-b3ce-5e7582d8c9fa}\\inprocserver32*")))))) | eval sigma_attack_tags="attack.t1546 attack.t1546.015 attack.persistence attack.privilege_escalation" | eval sigma_title="SOURGUM Actor Behaviours" | eval sigma_description="Suspicious behaviours related to an actor tracked by Microsoft as SOURGUM"
dispatch.earliest_time = -24h@h
alert.track = 0

[SOURGUM Actor Behaviours - sysmon]
description = Suspicious behaviours related to an actor tracked by Microsoft as SOURGUM
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*windows\\system32\\Physmem.sys*" OR Image="*Windows\\system32\\ime\\SHARED\\WimBootConfigurations.ini*" OR Image="*Windows\\system32\\ime\\IMEJP\\WimBootConfigurations.ini*" OR Image="*Windows\\system32\\ime\\IMETC\\WimBootConfigurations.ini*") OR (((Image="*windows\\system32\\filepath2*" OR Image="*windows\\system32\\ime*") CommandLine="*reg add*" (CommandLine="*HKEY_LOCAL_MACHINE\\software\\classes\\clsid\\{7c857801-7381-11cf-884d-00aa004b2e24}\\inprocserver32*" OR CommandLine="*HKEY_LOCAL_MACHINE\\software\\classes\\clsid\\{cf4cc405-e2c5-4ddd-b3ce-5e7582d8c9fa}\\inprocserver32*")))))) | eval sigma_attack_tags="attack.t1546 attack.t1546.015 attack.persistence attack.privilege_escalation" | eval sigma_title="SOURGUM Actor Behaviours" | eval sigma_description="Suspicious behaviours related to an actor tracked by Microsoft as SOURGUM"
dispatch.earliest_time = -24h@h
alert.track = 0

[Ps.exe Renamed SysInternals Tool - winevent]
description = Detects renamed SysInternals tool execution with a binary named ps.exe as used by Dragonfly APT group and documented in TA17-293A report
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="ps.exe -accepteula")) | eval sigma_attack_tags="attack.defense_evasion attack.g0035 attack.t1036.003 car.2013-05-009" | eval sigma_title="Ps.exe Renamed SysInternals Tool" | eval sigma_description="Detects renamed SysInternals tool execution with a binary named ps.exe as used by Dragonfly APT group and documented in TA17-293A report"
dispatch.earliest_time = -24h@h
alert.track = 0

[Ps.exe Renamed SysInternals Tool - sysmon]
description = Detects renamed SysInternals tool execution with a binary named ps.exe as used by Dragonfly APT group and documented in TA17-293A report
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="ps.exe -accepteula")) | eval sigma_attack_tags="attack.defense_evasion attack.g0035 attack.t1036.003 car.2013-05-009" | eval sigma_title="Ps.exe Renamed SysInternals Tool" | eval sigma_description="Detects renamed SysInternals tool execution with a binary named ps.exe as used by Dragonfly APT group and documented in TA17-293A report"
dispatch.earliest_time = -24h@h
alert.track = 0

[TA505 Dropper Load Pattern - winevent]
description = Detects mshta loaded by wmiprvse as parent as used by TA505 malicious documents
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) Creator_Process_Name="*\\wmiprvse.exe" (New_Process_Name="*\\mshta.exe" OR OriginalFileName="mshta.exe"))) | eval sigma_attack_tags="attack.execution attack.g0092 attack.t1106" | eval sigma_title="TA505 Dropper Load Pattern" | eval sigma_description="Detects mshta loaded by wmiprvse as parent as used by TA505 malicious documents"
dispatch.earliest_time = -24h@h
alert.track = 0

[TA505 Dropper Load Pattern - sysmon]
description = Detects mshta loaded by wmiprvse as parent as used by TA505 malicious documents
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ParentImage="*\\wmiprvse.exe" (Image="*\\mshta.exe" OR OriginalFileName="mshta.exe"))) | eval sigma_attack_tags="attack.execution attack.g0092 attack.t1106" | eval sigma_title="TA505 Dropper Load Pattern" | eval sigma_description="Detects mshta loaded by wmiprvse as parent as used by TA505 malicious documents"
dispatch.earliest_time = -24h@h
alert.track = 0

[TAIDOOR RAT DLL Load - winevent]
description = Detects specific process characteristics of Chinese TAIDOOR RAT malware load
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((Process_Command_Line="*dll,MyStart*" OR Process_Command_Line="*dll MyStart*") OR ((Process_Command_Line="* MyStart" Process_Command_Line="*rundll32.exe*"))))) | eval sigma_attack_tags="attack.execution attack.t1055.001" | eval sigma_title="TAIDOOR RAT DLL Load" | eval sigma_description="Detects specific process characteristics of Chinese TAIDOOR RAT malware load"
dispatch.earliest_time = -24h@h
alert.track = 0

[TAIDOOR RAT DLL Load - sysmon]
description = Detects specific process characteristics of Chinese TAIDOOR RAT malware load
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((CommandLine="*dll,MyStart*" OR CommandLine="*dll MyStart*") OR ((CommandLine="* MyStart" CommandLine="*rundll32.exe*"))))) | eval sigma_attack_tags="attack.execution attack.t1055.001" | eval sigma_title="TAIDOOR RAT DLL Load" | eval sigma_description="Detects specific process characteristics of Chinese TAIDOOR RAT malware load"
dispatch.earliest_time = -24h@h
alert.track = 0

[TropicTrooper Campaign November 2018 - winevent]
description = Detects TropicTrooper activity, an actor who targeted high-profile organizations in the energy and food and beverage sectors in Asia
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*abCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCc*")) | eval sigma_attack_tags="attack.execution attack.t1059.001" | eval sigma_title="TropicTrooper Campaign November 2018" | eval sigma_description="Detects TropicTrooper activity, an actor who targeted high-profile organizations in the energy and food and beverage sectors in Asia"
dispatch.earliest_time = -24h@h
alert.track = 0

[TropicTrooper Campaign November 2018 - sysmon]
description = Detects TropicTrooper activity, an actor who targeted high-profile organizations in the energy and food and beverage sectors in Asia
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*abCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCc*")) | eval sigma_attack_tags="attack.execution attack.t1059.001" | eval sigma_title="TropicTrooper Campaign November 2018" | eval sigma_description="Detects TropicTrooper activity, an actor who targeted high-profile organizations in the energy and food and beverage sectors in Asia"
dispatch.earliest_time = -24h@h
alert.track = 0

[Turla Group Lateral Movement - winevent]
description = Detects automated lateral movement by Turla group
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (Process_Command_Line="net use \\\\%DomainController%\\C$ \"P@ssw0rd\" *" OR Process_Command_Line="dir c:\\*.doc* /s" OR Process_Command_Line="dir %TEMP%\\*.exe"))) | eval sigma_attack_tags="attack.g0010 attack.execution attack.t1059 attack.lateral_movement attack.t1021.002 attack.discovery attack.t1083 attack.t1135" | eval sigma_title="Turla Group Lateral Movement" | eval sigma_description="Detects automated lateral movement by Turla group"
dispatch.earliest_time = -24h@h
alert.track = 0

[Turla Group Lateral Movement - sysmon]
description = Detects automated lateral movement by Turla group
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (CommandLine="net use \\\\%DomainController%\\C$ \"P@ssw0rd\" *" OR CommandLine="dir c:\\*.doc* /s" OR CommandLine="dir %TEMP%\\*.exe"))) | eval sigma_attack_tags="attack.g0010 attack.execution attack.t1059 attack.lateral_movement attack.t1021.002 attack.discovery attack.t1083 attack.t1135" | eval sigma_title="Turla Group Lateral Movement" | eval sigma_description="Detects automated lateral movement by Turla group"
dispatch.earliest_time = -24h@h
alert.track = 0

[Turla Group Commands May 2020 - winevent]
description = Detects commands used by Turla group as reported by ESET in May 2020
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((Process_Command_Line="*tracert -h 10 yahoo.com*" OR Process_Command_Line="*.WSqmCons))|iex;*" OR Process_Command_Line="*Fr`omBa`se6`4Str`ing*") OR ((Process_Command_Line="*net use https://docs.live.net*" Process_Command_Line="*@aol.co.uk*"))))) | eval sigma_attack_tags="attack.g0010 attack.execution attack.t1059.001 attack.t1053.005 attack.t1027" | eval sigma_title="Turla Group Commands May 2020" | eval sigma_description="Detects commands used by Turla group as reported by ESET in May 2020"
dispatch.earliest_time = -24h@h
alert.track = 0

[Turla Group Commands May 2020 - sysmon]
description = Detects commands used by Turla group as reported by ESET in May 2020
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((CommandLine="*tracert -h 10 yahoo.com*" OR CommandLine="*.WSqmCons))|iex;*" OR CommandLine="*Fr`omBa`se6`4Str`ing*") OR ((CommandLine="*net use https://docs.live.net*" CommandLine="*@aol.co.uk*"))))) | eval sigma_attack_tags="attack.g0010 attack.execution attack.t1059.001 attack.t1053.005 attack.t1027" | eval sigma_title="Turla Group Commands May 2020" | eval sigma_description="Detects commands used by Turla group as reported by ESET in May 2020"
dispatch.earliest_time = -24h@h
alert.track = 0

[UNC2452 Process Creation Patterns - winevent]
description = Detects a specific process creation patterns as seen used by UNC2452 and provided by Microsoft as Microsoft Defender ATP queries
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((Process_Command_Line="*7z.exe a -v500m -mx9 -r0 -p*" OR ((ParentCommandLine="*wscript.exe*" ParentCommandLine="*.vbs*" Process_Command_Line="*rundll32.exe*" Process_Command_Line="*C:\\Windows*" Process_Command_Line="*.dll,Tk_*")) OR ((Creator_Process_Name="*\\rundll32.exe" ParentCommandLine="*C:\\Windows*" Process_Command_Line="*cmd.exe /C *")) OR ((Process_Command_Line="*rundll32 c:\\windows\\*" Process_Command_Line="*.dll *"))) OR ((((Creator_Process_Name="*\\rundll32.exe" New_Process_Name="*\\dllhost.exe")) NOT (((Process_Command_Line=" " OR Process_Command_Line="")))))))) | eval sigma_attack_tags="attack.execution attack.t1059.001" | eval sigma_title="UNC2452 Process Creation Patterns" | eval sigma_description="Detects a specific process creation patterns as seen used by UNC2452 and provided by Microsoft as Microsoft Defender ATP queries"
dispatch.earliest_time = -24h@h
alert.track = 0

[UNC2452 Process Creation Patterns - sysmon]
description = Detects a specific process creation patterns as seen used by UNC2452 and provided by Microsoft as Microsoft Defender ATP queries
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((CommandLine="*7z.exe a -v500m -mx9 -r0 -p*" OR ((ParentCommandLine="*wscript.exe*" ParentCommandLine="*.vbs*" CommandLine="*rundll32.exe*" CommandLine="*C:\\Windows*" CommandLine="*.dll,Tk_*")) OR ((ParentImage="*\\rundll32.exe" ParentCommandLine="*C:\\Windows*" CommandLine="*cmd.exe /C *")) OR ((CommandLine="*rundll32 c:\\windows\\*" CommandLine="*.dll *"))) OR ((((ParentImage="*\\rundll32.exe" Image="*\\dllhost.exe")) NOT (((CommandLine=" " OR CommandLine="")))))))) | eval sigma_attack_tags="attack.execution attack.t1059.001" | eval sigma_title="UNC2452 Process Creation Patterns" | eval sigma_description="Detects a specific process creation patterns as seen used by UNC2452 and provided by Microsoft as Microsoft Defender ATP queries"
dispatch.earliest_time = -24h@h
alert.track = 0

[Unidentified Attacker November 2018 - winevent]
description = A sigma rule detecting an unidetefied attacker who used phishing emails to target high profile orgs on November 2018. The Actor shares some TTPs with YYTRIUM/APT29 campaign in 2016.
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*cyzfc.dat,*" Process_Command_Line="*PointFunctionCall")) | eval sigma_attack_tags="attack.execution attack.t1218.011" | eval sigma_title="Unidentified Attacker November 2018" | eval sigma_description="A sigma rule detecting an unidetefied attacker who used phishing emails to target high profile orgs on November 2018. The Actor shares some TTPs with YYTRIUM/APT29 campaign in 2016."
dispatch.earliest_time = -24h@h
alert.track = 0

[Unidentified Attacker November 2018 - sysmon]
description = A sigma rule detecting an unidetefied attacker who used phishing emails to target high profile orgs on November 2018. The Actor shares some TTPs with YYTRIUM/APT29 campaign in 2016.
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*cyzfc.dat,*" CommandLine="*PointFunctionCall")) | eval sigma_attack_tags="attack.execution attack.t1218.011" | eval sigma_title="Unidentified Attacker November 2018" | eval sigma_description="A sigma rule detecting an unidetefied attacker who used phishing emails to target high profile orgs on November 2018. The Actor shares some TTPs with YYTRIUM/APT29 campaign in 2016."
dispatch.earliest_time = -24h@h
alert.track = 0

[Winnti Malware HK University Campaign - winevent]
description = Detects specific process characteristics of Winnti malware noticed in Dec/Jan 2020 in a campaign against Honk Kong universities
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((((Creator_Process_Name="*C:\\Windows\\Temp*" OR Creator_Process_Name="*\\hpqhvind.exe*") New_Process_Name="C:\\ProgramData\\DRM*")) OR ((Creator_Process_Name="C:\\ProgramData\\DRM*" New_Process_Name="*\\wmplayer.exe")) OR ((Creator_Process_Name="*\\Test.exe" New_Process_Name="*\\wmplayer.exe")) OR New_Process_Name="C:\\ProgramData\\DRM\\CLR\\CLR.exe" OR ((Creator_Process_Name="C:\\ProgramData\\DRM\\Windows*" New_Process_Name="*\\SearchFilterHost.exe"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1574.002 attack.g0044" | eval sigma_title="Winnti Malware HK University Campaign" | eval sigma_description="Detects specific process characteristics of Winnti malware noticed in Dec/Jan 2020 in a campaign against Honk Kong universities"
dispatch.earliest_time = -24h@h
alert.track = 0

[Winnti Malware HK University Campaign - sysmon]
description = Detects specific process characteristics of Winnti malware noticed in Dec/Jan 2020 in a campaign against Honk Kong universities
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((((ParentImage="*C:\\Windows\\Temp*" OR ParentImage="*\\hpqhvind.exe*") Image="C:\\ProgramData\\DRM*")) OR ((ParentImage="C:\\ProgramData\\DRM*" Image="*\\wmplayer.exe")) OR ((ParentImage="*\\Test.exe" Image="*\\wmplayer.exe")) OR Image="C:\\ProgramData\\DRM\\CLR\\CLR.exe" OR ((ParentImage="C:\\ProgramData\\DRM\\Windows*" Image="*\\SearchFilterHost.exe"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1574.002 attack.g0044" | eval sigma_title="Winnti Malware HK University Campaign" | eval sigma_description="Detects specific process characteristics of Winnti malware noticed in Dec/Jan 2020 in a campaign against Honk Kong universities"
dispatch.earliest_time = -24h@h
alert.track = 0

[Winnti Pipemon Characteristics - winevent]
description = Detects specific process characteristics of Winnti Pipemon malware reported by ESET
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (Process_Command_Line="*setup0.exe -p*" OR ((Process_Command_Line="*setup.exe*" (Process_Command_Line="*-x:0" OR Process_Command_Line="*-x:1" OR Process_Command_Line="*-x:2")))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1574.002 attack.g0044" | eval sigma_title="Winnti Pipemon Characteristics" | eval sigma_description="Detects specific process characteristics of Winnti Pipemon malware reported by ESET"
dispatch.earliest_time = -24h@h
alert.track = 0

[Winnti Pipemon Characteristics - sysmon]
description = Detects specific process characteristics of Winnti Pipemon malware reported by ESET
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (CommandLine="*setup0.exe -p*" OR ((CommandLine="*setup.exe*" (CommandLine="*-x:0" OR CommandLine="*-x:1" OR CommandLine="*-x:2")))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1574.002 attack.g0044" | eval sigma_title="Winnti Pipemon Characteristics" | eval sigma_description="Detects specific process characteristics of Winnti Pipemon malware reported by ESET"
dispatch.earliest_time = -24h@h
alert.track = 0

[Operation Wocao Activity - winevent]
description = Detects activity mentioned in Operation Wocao report
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (Process_Command_Line="*checkadmin.exe 127.0.0.1 -all*" OR Process_Command_Line="*netsh advfirewall firewall add rule name=powershell dir=in*" OR Process_Command_Line="*cmd /c powershell.exe -ep bypass -file c:\\s.ps1*" OR Process_Command_Line="*/tn win32times /f*" OR Process_Command_Line="*create win32times binPath=*" OR Process_Command_Line="*\\c$\\windows\\system32\\devmgr.dll*" OR Process_Command_Line="* -exec bypass -enc JgAg*" OR Process_Command_Line="*type *keepass\\KeePass.config.xml*" OR Process_Command_Line="*iie.exe iie.txt*" OR Process_Command_Line="*reg*query HKEY_CURRENT_USER\\Software\\*\\PuTTY\\Sessions\\*"))) | eval sigma_attack_tags="attack.discovery attack.t1012 attack.defense_evasion attack.t1036.004 attack.t1027 attack.execution attack.t1053.005 attack.t1059.001" | eval sigma_title="Operation Wocao Activity" | eval sigma_description="Detects activity mentioned in Operation Wocao report"
dispatch.earliest_time = -24h@h
alert.track = 0

[Operation Wocao Activity - sysmon]
description = Detects activity mentioned in Operation Wocao report
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (CommandLine="*checkadmin.exe 127.0.0.1 -all*" OR CommandLine="*netsh advfirewall firewall add rule name=powershell dir=in*" OR CommandLine="*cmd /c powershell.exe -ep bypass -file c:\\s.ps1*" OR CommandLine="*/tn win32times /f*" OR CommandLine="*create win32times binPath=*" OR CommandLine="*\\c$\\windows\\system32\\devmgr.dll*" OR CommandLine="* -exec bypass -enc JgAg*" OR CommandLine="*type *keepass\\KeePass.config.xml*" OR CommandLine="*iie.exe iie.txt*" OR CommandLine="*reg*query HKEY_CURRENT_USER\\Software\\*\\PuTTY\\Sessions\\*"))) | eval sigma_attack_tags="attack.discovery attack.t1012 attack.defense_evasion attack.t1036.004 attack.t1027 attack.execution attack.t1053.005 attack.t1059.001" | eval sigma_title="Operation Wocao Activity" | eval sigma_description="Detects activity mentioned in Operation Wocao report"
dispatch.earliest_time = -24h@h
alert.track = 0

[ZxShell Malware - winevent]
description = Detects a ZxShell start by the called and well-known function name
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\rundll32.exe" (Process_Command_Line="*zxFunction*" OR Process_Command_Line="*RemoteDiskXXXXX*"))) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.execution attack.t1059.003 attack.defense_evasion attack.t1218.011 attack.s0412 attack.g0001" | eval sigma_title="ZxShell Malware" | eval sigma_description="Detects a ZxShell start by the called and well-known function name"
dispatch.earliest_time = -24h@h
alert.track = 0

[ZxShell Malware - sysmon]
description = Detects a ZxShell start by the called and well-known function name
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\rundll32.exe" (CommandLine="*zxFunction*" OR CommandLine="*RemoteDiskXXXXX*"))) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.execution attack.t1059.003 attack.defense_evasion attack.t1218.011 attack.s0412 attack.g0001" | eval sigma_title="ZxShell Malware" | eval sigma_description="Detects a ZxShell start by the called and well-known function name"
dispatch.earliest_time = -24h@h
alert.track = 0

[Arbitrary Shell Command Execution Via Settingcontent-Ms - winevent]
description = The .SettingContent-ms file type was introduced in Windows 10 and allows a user to create 'shortcuts' to various Windows 10 setting pages. These files are simply XML and contain paths to various Windows 10 settings binaries.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) Process_Command_Line="*.SettingContent-ms*" NOT ((Process_Command_Line="*immersivecontrolpanel*")))) | table ParentProcess,Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.t1204 attack.t1566.001 attack.execution attack.initial_access" | eval sigma_title="Arbitrary Shell Command Execution Via Settingcontent-Ms" | eval sigma_description="The .SettingContent-ms file type was introduced in Windows 10 and allows a user to create 'shortcuts' to various Windows 10 setting pages. These files are simply XML and contain paths to various Windows 10 settings binaries."
dispatch.earliest_time = -24h@h
alert.track = 0

[Arbitrary Shell Command Execution Via Settingcontent-Ms - sysmon]
description = The .SettingContent-ms file type was introduced in Windows 10 and allows a user to create 'shortcuts' to various Windows 10 setting pages. These files are simply XML and contain paths to various Windows 10 settings binaries.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) CommandLine="*.SettingContent-ms*" NOT ((CommandLine="*immersivecontrolpanel*")))) | table ParentProcess,CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.t1204 attack.t1566.001 attack.execution attack.initial_access" | eval sigma_title="Arbitrary Shell Command Execution Via Settingcontent-Ms" | eval sigma_description="The .SettingContent-ms file type was introduced in Windows 10 and allows a user to create 'shortcuts' to various Windows 10 setting pages. These files are simply XML and contain paths to various Windows 10 settings binaries."
dispatch.earliest_time = -24h@h
alert.track = 0

[Phishing Pattern ISO in Archive - winevent]
description = Detects cases in which an ISO files is opend within an archiver like 7Zip or Winrar, which is a sign of phishing as threat actors put small ISO files in archives as email attachments to bypass certain filters and protective measures (mark of web)
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (Creator_Process_Name="*\\Winrar.exe" OR Creator_Process_Name="*\\7zFM.exe" OR Creator_Process_Name="*\\peazip.exe") (New_Process_Name="*\\isoburn.exe" OR New_Process_Name="*\\PowerISO.exe" OR New_Process_Name="*\\ImgBurn.exe"))) | eval sigma_attack_tags="attack.initial_access attack.t1566" | eval sigma_title="Phishing Pattern ISO in Archive" | eval sigma_description="Detects cases in which an ISO files is opend within an archiver like 7Zip or Winrar, which is a sign of phishing as threat actors put small ISO files in archives as email attachments to bypass certain filters and protective measures (mark of web)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Phishing Pattern ISO in Archive - sysmon]
description = Detects cases in which an ISO files is opend within an archiver like 7Zip or Winrar, which is a sign of phishing as threat actors put small ISO files in archives as email attachments to bypass certain filters and protective measures (mark of web)
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (ParentImage="*\\Winrar.exe" OR ParentImage="*\\7zFM.exe" OR ParentImage="*\\peazip.exe") (Image="*\\isoburn.exe" OR Image="*\\PowerISO.exe" OR Image="*\\ImgBurn.exe"))) | eval sigma_attack_tags="attack.initial_access attack.t1566" | eval sigma_title="Phishing Pattern ISO in Archive" | eval sigma_description="Detects cases in which an ISO files is opend within an archiver like 7Zip or Winrar, which is a sign of phishing as threat actors put small ISO files in archives as email attachments to bypass certain filters and protective measures (mark of web)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Atlassian Confluence CVE-2021-26084 - winevent]
description = Detects spawning of suspicious child processes by Atlassian Confluence server which may indicate successful exploitation of CVE-2021-26084
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Creator_Process_Name="*\\Atlassian\\Confluence\\jre\\bin\\java.exe" (Process_Command_Line="*cmd /c*" OR Process_Command_Line="*cmd /k*" OR Process_Command_Line="*powershell*" OR Process_Command_Line="*certutil*" OR Process_Command_Line="*curl*" OR Process_Command_Line="*whoami*" OR Process_Command_Line="*ipconfig*"))) | eval sigma_attack_tags="attack.initial_access attack.execution attack.t1190 attack.t1059" | eval sigma_title="Atlassian Confluence CVE-2021-26084" | eval sigma_description="Detects spawning of suspicious child processes by Atlassian Confluence server which may indicate successful exploitation of CVE-2021-26084"
dispatch.earliest_time = -24h@h
alert.track = 0

[Atlassian Confluence CVE-2021-26084 - sysmon]
description = Detects spawning of suspicious child processes by Atlassian Confluence server which may indicate successful exploitation of CVE-2021-26084
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") ParentImage="*\\Atlassian\\Confluence\\jre\\bin\\java.exe" (CommandLine="*cmd /c*" OR CommandLine="*cmd /k*" OR CommandLine="*powershell*" OR CommandLine="*certutil*" OR CommandLine="*curl*" OR CommandLine="*whoami*" OR CommandLine="*ipconfig*"))) | eval sigma_attack_tags="attack.initial_access attack.execution attack.t1190 attack.t1059" | eval sigma_title="Atlassian Confluence CVE-2021-26084" | eval sigma_description="Detects spawning of suspicious child processes by Atlassian Confluence server which may indicate successful exploitation of CVE-2021-26084"
dispatch.earliest_time = -24h@h
alert.track = 0

[Hiding Files with Attrib.exe - winevent]
description = Detects usage of attrib.exe to hide files from users.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((New_Process_Name="*\\attrib.exe" OR OriginalFileName="ATTRIB.EXE") Process_Command_Line="* +h *")) NOT (((Process_Command_Line="*\\desktop.ini *")) OR ((Creator_Process_Name="*\\cmd.exe" Process_Command_Line="+R +H +S +A \\\*.cui" ParentCommandLine="C:\\WINDOWS\\system32\\\*.bat"))))) | table Process_Command_Line,ParentCommandLine,Account_Name | eval sigma_attack_tags="attack.defense_evasion attack.t1564.001" | eval sigma_title="Hiding Files with Attrib.exe" | eval sigma_description="Detects usage of attrib.exe to hide files from users."
dispatch.earliest_time = -24h@h
alert.track = 0

[Hiding Files with Attrib.exe - sysmon]
description = Detects usage of attrib.exe to hide files from users.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((Image="*\\attrib.exe" OR OriginalFileName="ATTRIB.EXE") CommandLine="* +h *")) NOT (((CommandLine="*\\desktop.ini *")) OR ((ParentImage="*\\cmd.exe" CommandLine="+R +H +S +A \\\*.cui" ParentCommandLine="C:\\WINDOWS\\system32\\\*.bat"))))) | table CommandLine,ParentCommandLine,User | eval sigma_attack_tags="attack.defense_evasion attack.t1564.001" | eval sigma_title="Hiding Files with Attrib.exe" | eval sigma_description="Detects usage of attrib.exe to hide files from users."
dispatch.earliest_time = -24h@h
alert.track = 0

[Set Suspicious Files as System Files Using Attrib - winevent]
description = Detects usage of attrib with '+s' option to set suspicious script or executable as system files to hide them from users and make them unable to delete with simple rights. The rule limit the search to specific extensions and directories to avoid FP's
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((New_Process_Name="*\\attrib.exe" OR OriginalFileName="ATTRIB.EXE") Process_Command_Line="* +s*" (Process_Command_Line="* %*" OR Process_Command_Line="*\\Users\\Public\\*" OR Process_Command_Line="*\\AppData\\Local\\*" OR Process_Command_Line="*\\ProgramData\\*" OR Process_Command_Line="*\\Downloads\\*" OR Process_Command_Line="*\\Windows\\Temp\\*") (Process_Command_Line="*.bat*" OR Process_Command_Line="*.ps1*" OR Process_Command_Line="*.vbe*" OR Process_Command_Line="*.vbs*" OR Process_Command_Line="*.exe*"))) NOT (((Process_Command_Line="*\\Windows\\TEMP\\*" Process_Command_Line="*.exe*"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1564.001" | eval sigma_title="Set Suspicious Files as System Files Using Attrib" | eval sigma_description="Detects usage of attrib with '+s' option to set suspicious script or executable as system files to hide them from users and make them unable to delete with simple rights. The rule limit the search to specific extensions and directories to avoid FP's"
dispatch.earliest_time = -24h@h
alert.track = 0

[Set Suspicious Files as System Files Using Attrib - sysmon]
description = Detects usage of attrib with '+s' option to set suspicious script or executable as system files to hide them from users and make them unable to delete with simple rights. The rule limit the search to specific extensions and directories to avoid FP's
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((Image="*\\attrib.exe" OR OriginalFileName="ATTRIB.EXE") CommandLine="* +s*" (CommandLine="* %*" OR CommandLine="*\\Users\\Public\\*" OR CommandLine="*\\AppData\\Local\\*" OR CommandLine="*\\ProgramData\\*" OR CommandLine="*\\Downloads\\*" OR CommandLine="*\\Windows\\Temp\\*") (CommandLine="*.bat*" OR CommandLine="*.ps1*" OR CommandLine="*.vbe*" OR CommandLine="*.vbs*" OR CommandLine="*.exe*"))) NOT (((CommandLine="*\\Windows\\TEMP\\*" CommandLine="*.exe*"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1564.001" | eval sigma_title="Set Suspicious Files as System Files Using Attrib" | eval sigma_description="Detects usage of attrib with '+s' option to set suspicious script or executable as system files to hide them from users and make them unable to delete with simple rights. The rule limit the search to specific extensions and directories to avoid FP's"
dispatch.earliest_time = -24h@h
alert.track = 0

[Automated Collection Command Prompt - winevent]
description = Once established within a system or network, an adversary may use automated techniques for collecting internal data.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (Process_Command_Line="*.doc*" OR Process_Command_Line="*.docx*" OR Process_Command_Line="*.xls*" OR Process_Command_Line="*.xlsx*" OR Process_Command_Line="*.ppt*" OR Process_Command_Line="*.pptx*" OR Process_Command_Line="*.rtf*" OR Process_Command_Line="*.pdf*" OR Process_Command_Line="*.txt*") (((Process_Command_Line="*dir *" Process_Command_Line="* /b *" Process_Command_Line="* /s *")) OR ((OriginalFileName="FINDSTR.EXE" (Process_Command_Line="* /e *" OR Process_Command_Line="* /si *")))))) | eval sigma_attack_tags="attack.collection attack.t1119 attack.credential_access attack.t1552.001" | eval sigma_title="Automated Collection Command Prompt" | eval sigma_description="Once established within a system or network, an adversary may use automated techniques for collecting internal data."
dispatch.earliest_time = -24h@h
alert.track = 0

[Automated Collection Command Prompt - sysmon]
description = Once established within a system or network, an adversary may use automated techniques for collecting internal data.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (CommandLine="*.doc*" OR CommandLine="*.docx*" OR CommandLine="*.xls*" OR CommandLine="*.xlsx*" OR CommandLine="*.ppt*" OR CommandLine="*.pptx*" OR CommandLine="*.rtf*" OR CommandLine="*.pdf*" OR CommandLine="*.txt*") (((CommandLine="*dir *" CommandLine="* /b *" CommandLine="* /s *")) OR ((OriginalFileName="FINDSTR.EXE" (CommandLine="* /e *" OR CommandLine="* /si *")))))) | eval sigma_attack_tags="attack.collection attack.t1119 attack.credential_access attack.t1552.001" | eval sigma_title="Automated Collection Command Prompt" | eval sigma_description="Once established within a system or network, an adversary may use automated techniques for collecting internal data."
dispatch.earliest_time = -24h@h
alert.track = 0

[Bad Opsec Defaults Sacrificial Processes With Improper Arguments - winevent]
description = Detects attackers using tooling with bad opsec defaults.
E.g. spawning a sacrificial process to inject a capability into the process without taking into account how the process is normally run.
One trivial example of this is using rundll32.exe without arguments as a sacrificial process (default in CS, now highlighted by c2lint), running WerFault without arguments (Kraken - credit am0nsec), and other examples.

search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((New_Process_Name="*\\WerFault.exe" Process_Command_Line="*WerFault.exe")) OR ((New_Process_Name="*\\rundll32.exe" Process_Command_Line="*rundll32.exe")) OR ((New_Process_Name="*\\regsvcs.exe" Process_Command_Line="*regsvcs.exe")) OR ((New_Process_Name="*\\regasm.exe" Process_Command_Line="*regasm.exe")) OR ((New_Process_Name="*\\regsvr32.exe" Process_Command_Line="*regsvr32.exe"))) NOT (((Creator_Process_Name="C:\\Users\\*" Creator_Process_Name="*\\AppData\\Local\\Microsoft\\EdgeUpdate\\Install\\{*" Creator_Process_Name="*\\setup.exe" ParentCommandLine="*\\setup.exe\" --install-archive=\"C:\\Users\\*"))))) | table Creator_Process_Name,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.t1218.011" | eval sigma_title="Bad Opsec Defaults Sacrificial Processes With Improper Arguments" | eval sigma_description="Detects attackers using tooling with bad opsec defaults.
E.g. spawning a sacrificial process to inject a capability into the process without taking into account how the process is normally run.
One trivial example of this is using rundll32.exe without arguments as a sacrificial process (default in CS, now highlighted by c2lint), running WerFault without arguments (Kraken - credit am0nsec), and other examples.
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Bad Opsec Defaults Sacrificial Processes With Improper Arguments - sysmon]
description = Detects attackers using tooling with bad opsec defaults.
E.g. spawning a sacrificial process to inject a capability into the process without taking into account how the process is normally run.
One trivial example of this is using rundll32.exe without arguments as a sacrificial process (default in CS, now highlighted by c2lint), running WerFault without arguments (Kraken - credit am0nsec), and other examples.

search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((Image="*\\WerFault.exe" CommandLine="*WerFault.exe")) OR ((Image="*\\rundll32.exe" CommandLine="*rundll32.exe")) OR ((Image="*\\regsvcs.exe" CommandLine="*regsvcs.exe")) OR ((Image="*\\regasm.exe" CommandLine="*regasm.exe")) OR ((Image="*\\regsvr32.exe" CommandLine="*regsvr32.exe"))) NOT (((ParentImage="C:\\Users\\*" ParentImage="*\\AppData\\Local\\Microsoft\\EdgeUpdate\\Install\\{*" ParentImage="*\\setup.exe" ParentCommandLine="*\\setup.exe\" --install-archive=\"C:\\Users\\*"))))) | table ParentImage,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.t1218.011" | eval sigma_title="Bad Opsec Defaults Sacrificial Processes With Improper Arguments" | eval sigma_description="Detects attackers using tooling with bad opsec defaults.
E.g. spawning a sacrificial process to inject a capability into the process without taking into account how the process is normally run.
One trivial example of this is using rundll32.exe without arguments as a sacrificial process (default in CS, now highlighted by c2lint), running WerFault without arguments (Kraken - credit am0nsec), and other examples.
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential BearLPE Exploitation - winevent]
description = Detects potential exploitation of the BearLPE exploit using Task Scheduler '.job' import arbitrary DACL write\par
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\schtasks.exe" OR OriginalFileName="schtasks.exe") ((Process_Command_Line="*/change*" Process_Command_Line="*/TN*" Process_Command_Line="*/RU*" Process_Command_Line="*/RP*")))) | eval sigma_attack_tags="attack.privilege_escalation attack.t1053.005 car.2013-08-001" | eval sigma_title="Potential BearLPE Exploitation" | eval sigma_description="Detects potential exploitation of the BearLPE exploit using Task Scheduler '.job' import arbitrary DACL write\par"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential BearLPE Exploitation - sysmon]
description = Detects potential exploitation of the BearLPE exploit using Task Scheduler '.job' import arbitrary DACL write\par
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\schtasks.exe" OR OriginalFileName="schtasks.exe") ((CommandLine="*/change*" CommandLine="*/TN*" CommandLine="*/RU*" CommandLine="*/RP*")))) | eval sigma_attack_tags="attack.privilege_escalation attack.t1053.005 car.2013-08-001" | eval sigma_title="Potential BearLPE Exploitation" | eval sigma_description="Detects potential exploitation of the BearLPE exploit using Task Scheduler '.job' import arbitrary DACL write\par"
dispatch.earliest_time = -24h@h
alert.track = 0

[Bitsadmin Download from Suspicious Domain - winevent]
description = Detects usage of bitsadmin downloading a file from a suspicious domain
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\bitsadmin.exe" OR OriginalFileName="bitsadmin.exe") (Process_Command_Line="* /transfer *" OR Process_Command_Line="* /create *" OR Process_Command_Line="* /addfile *") (Process_Command_Line="*raw.githubusercontent.com*" OR Process_Command_Line="*gist.githubusercontent.com*" OR Process_Command_Line="*pastebin.com*" OR Process_Command_Line="*cdn.discordapp.com/attachments/*" OR Process_Command_Line="*mediafire.com*" OR Process_Command_Line="*mega.nz*" OR Process_Command_Line="*ddns.net*" OR Process_Command_Line="*.paste.ee*" OR Process_Command_Line="*.hastebin.com*" OR Process_Command_Line="*.ghostbin.co/*" OR Process_Command_Line="*ufile.io*" OR Process_Command_Line="*storage.googleapis.com*" OR Process_Command_Line="*anonfiles.com*" OR Process_Command_Line="*send.exploit.in*" OR Process_Command_Line="*transfer.sh*" OR Process_Command_Line="*privatlab.net*" OR Process_Command_Line="*privatlab.com*" OR Process_Command_Line="*sendspace.com*" OR Process_Command_Line="*pastetext.net*" OR Process_Command_Line="*pastebin.pl*" OR Process_Command_Line="*paste.ee*"))) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.persistence attack.t1197 attack.s0190 attack.t1036.003" | eval sigma_title="Bitsadmin Download from Suspicious Domain" | eval sigma_description="Detects usage of bitsadmin downloading a file from a suspicious domain"
dispatch.earliest_time = -24h@h
alert.track = 0

[Bitsadmin Download from Suspicious Domain - sysmon]
description = Detects usage of bitsadmin downloading a file from a suspicious domain
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\bitsadmin.exe" OR OriginalFileName="bitsadmin.exe") (CommandLine="* /transfer *" OR CommandLine="* /create *" OR CommandLine="* /addfile *") (CommandLine="*raw.githubusercontent.com*" OR CommandLine="*gist.githubusercontent.com*" OR CommandLine="*pastebin.com*" OR CommandLine="*cdn.discordapp.com/attachments/*" OR CommandLine="*mediafire.com*" OR CommandLine="*mega.nz*" OR CommandLine="*ddns.net*" OR CommandLine="*.paste.ee*" OR CommandLine="*.hastebin.com*" OR CommandLine="*.ghostbin.co/*" OR CommandLine="*ufile.io*" OR CommandLine="*storage.googleapis.com*" OR CommandLine="*anonfiles.com*" OR CommandLine="*send.exploit.in*" OR CommandLine="*transfer.sh*" OR CommandLine="*privatlab.net*" OR CommandLine="*privatlab.com*" OR CommandLine="*sendspace.com*" OR CommandLine="*pastetext.net*" OR CommandLine="*pastebin.pl*" OR CommandLine="*paste.ee*"))) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.persistence attack.t1197 attack.s0190 attack.t1036.003" | eval sigma_title="Bitsadmin Download from Suspicious Domain" | eval sigma_description="Detects usage of bitsadmin downloading a file from a suspicious domain"
dispatch.earliest_time = -24h@h
alert.track = 0

[Bitsadmin Download File with Suspicious Extension - winevent]
description = Detects usage of bitsadmin downloading a file with a suspicious extension
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\bitsadmin.exe" OR OriginalFileName="bitsadmin.exe") (Process_Command_Line="* /transfer *" OR Process_Command_Line="* /create *" OR Process_Command_Line="* /addfile *") (Process_Command_Line="*.asax*" OR Process_Command_Line="*.ashx*" OR Process_Command_Line="*.asmx*" OR Process_Command_Line="*.asp*" OR Process_Command_Line="*.aspx*" OR Process_Command_Line="*.bat*" OR Process_Command_Line="*.cfm*" OR Process_Command_Line="*.cgi*" OR Process_Command_Line="*.chm*" OR Process_Command_Line="*.cmd*" OR Process_Command_Line="*.gif*" OR Process_Command_Line="*.jpeg*" OR Process_Command_Line="*.jpg*" OR Process_Command_Line="*.jsp*" OR Process_Command_Line="*.jspx*" OR Process_Command_Line="*.png*" OR Process_Command_Line="*.ps1*" OR Process_Command_Line="*.psm1*" OR Process_Command_Line="*.scf*" OR Process_Command_Line="*.sct*" OR Process_Command_Line="*.txt*" OR Process_Command_Line="*.vbe*" OR Process_Command_Line="*.vbs*" OR Process_Command_Line="*.war*" OR Process_Command_Line="*.wsf*" OR Process_Command_Line="*.wsh*" OR Process_Command_Line="*.zip*" OR Process_Command_Line="*.rar*" OR Process_Command_Line="*.dll*"))) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.persistence attack.t1197 attack.s0190 attack.t1036.003" | eval sigma_title="Bitsadmin Download File with Suspicious Extension" | eval sigma_description="Detects usage of bitsadmin downloading a file with a suspicious extension"
dispatch.earliest_time = -24h@h
alert.track = 0

[Bitsadmin Download File with Suspicious Extension - sysmon]
description = Detects usage of bitsadmin downloading a file with a suspicious extension
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\bitsadmin.exe" OR OriginalFileName="bitsadmin.exe") (CommandLine="* /transfer *" OR CommandLine="* /create *" OR CommandLine="* /addfile *") (CommandLine="*.asax*" OR CommandLine="*.ashx*" OR CommandLine="*.asmx*" OR CommandLine="*.asp*" OR CommandLine="*.aspx*" OR CommandLine="*.bat*" OR CommandLine="*.cfm*" OR CommandLine="*.cgi*" OR CommandLine="*.chm*" OR CommandLine="*.cmd*" OR CommandLine="*.gif*" OR CommandLine="*.jpeg*" OR CommandLine="*.jpg*" OR CommandLine="*.jsp*" OR CommandLine="*.jspx*" OR CommandLine="*.png*" OR CommandLine="*.ps1*" OR CommandLine="*.psm1*" OR CommandLine="*.scf*" OR CommandLine="*.sct*" OR CommandLine="*.txt*" OR CommandLine="*.vbe*" OR CommandLine="*.vbs*" OR CommandLine="*.war*" OR CommandLine="*.wsf*" OR CommandLine="*.wsh*" OR CommandLine="*.zip*" OR CommandLine="*.rar*" OR CommandLine="*.dll*"))) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.persistence attack.t1197 attack.s0190 attack.t1036.003" | eval sigma_title="Bitsadmin Download File with Suspicious Extension" | eval sigma_description="Detects usage of bitsadmin downloading a file with a suspicious extension"
dispatch.earliest_time = -24h@h
alert.track = 0

[Bitsadmin Download File from IP - winevent]
description = Detects usage of bitsadmin downloading a file using an URL that contains an IP
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((New_Process_Name="*\\bitsadmin.exe" OR OriginalFileName="bitsadmin.exe") (Process_Command_Line="* /transfer *" OR Process_Command_Line="* /create *" OR Process_Command_Line="* /addfile *") (Process_Command_Line="*http://1*" OR Process_Command_Line="*http://2*" OR Process_Command_Line="*http://3*" OR Process_Command_Line="*http://4*" OR Process_Command_Line="*http://5*" OR Process_Command_Line="*http://6*" OR Process_Command_Line="*http://7*" OR Process_Command_Line="*http://8*" OR Process_Command_Line="*http://9*" OR Process_Command_Line="*https://1*" OR Process_Command_Line="*https://2*" OR Process_Command_Line="*https://3*" OR Process_Command_Line="*https://4*" OR Process_Command_Line="*https://5*" OR Process_Command_Line="*https://6*" OR Process_Command_Line="*https://7*" OR Process_Command_Line="*https://8*" OR Process_Command_Line="*https://9*"))) NOT (((Process_Command_Line="*https://7-*" OR Process_Command_Line="*http://7-*"))))) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.persistence attack.t1197 attack.s0190 attack.t1036.003" | eval sigma_title="Bitsadmin Download File from IP" | eval sigma_description="Detects usage of bitsadmin downloading a file using an URL that contains an IP"
dispatch.earliest_time = -24h@h
alert.track = 0

[Bitsadmin Download File from IP - sysmon]
description = Detects usage of bitsadmin downloading a file using an URL that contains an IP
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((Image="*\\bitsadmin.exe" OR OriginalFileName="bitsadmin.exe") (CommandLine="* /transfer *" OR CommandLine="* /create *" OR CommandLine="* /addfile *") (CommandLine="*http://1*" OR CommandLine="*http://2*" OR CommandLine="*http://3*" OR CommandLine="*http://4*" OR CommandLine="*http://5*" OR CommandLine="*http://6*" OR CommandLine="*http://7*" OR CommandLine="*http://8*" OR CommandLine="*http://9*" OR CommandLine="*https://1*" OR CommandLine="*https://2*" OR CommandLine="*https://3*" OR CommandLine="*https://4*" OR CommandLine="*https://5*" OR CommandLine="*https://6*" OR CommandLine="*https://7*" OR CommandLine="*https://8*" OR CommandLine="*https://9*"))) NOT (((CommandLine="*https://7-*" OR CommandLine="*http://7-*"))))) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.persistence attack.t1197 attack.s0190 attack.t1036.003" | eval sigma_title="Bitsadmin Download File from IP" | eval sigma_description="Detects usage of bitsadmin downloading a file using an URL that contains an IP"
dispatch.earliest_time = -24h@h
alert.track = 0

[Bitsadmin Download to Suspicious Target Folder - winevent]
description = Detects usage of bitsadmin downloading a file to a suspicious target folder
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\bitsadmin.exe" OR OriginalFileName="bitsadmin.exe") (Process_Command_Line="* /transfer *" OR Process_Command_Line="* /create *" OR Process_Command_Line="* /addfile *") (Process_Command_Line="*C:\\Users\\Public\\*" OR Process_Command_Line="*%public%*" OR Process_Command_Line="*\\Desktop\\*" OR Process_Command_Line="*C:\\Temp*" OR Process_Command_Line="*C:\\Perflogs*" OR Process_Command_Line="*C:\\Windows\\*"))) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.persistence attack.t1197 attack.s0190 attack.t1036.003" | eval sigma_title="Bitsadmin Download to Suspicious Target Folder" | eval sigma_description="Detects usage of bitsadmin downloading a file to a suspicious target folder"
dispatch.earliest_time = -24h@h
alert.track = 0

[Bitsadmin Download to Suspicious Target Folder - sysmon]
description = Detects usage of bitsadmin downloading a file to a suspicious target folder
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\bitsadmin.exe" OR OriginalFileName="bitsadmin.exe") (CommandLine="* /transfer *" OR CommandLine="* /create *" OR CommandLine="* /addfile *") (CommandLine="*C:\\Users\\Public\\*" OR CommandLine="*%public%*" OR CommandLine="*\\Desktop\\*" OR CommandLine="*C:\\Temp*" OR CommandLine="*C:\\Perflogs*" OR CommandLine="*C:\\Windows\\*"))) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.persistence attack.t1197 attack.s0190 attack.t1036.003" | eval sigma_title="Bitsadmin Download to Suspicious Target Folder" | eval sigma_description="Detects usage of bitsadmin downloading a file to a suspicious target folder"
dispatch.earliest_time = -24h@h
alert.track = 0

[Bitsadmin Download to Uncommon Target Folder - winevent]
description = Detects usage of bitsadmin downloading a file to uncommon target folder
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\bitsadmin.exe" OR OriginalFileName="bitsadmin.exe") (Process_Command_Line="* /transfer *" OR Process_Command_Line="* /create *" OR Process_Command_Line="* /addfile *") (Process_Command_Line="*C:\\Windows\\Temp\\*" OR Process_Command_Line="*%temp%*" OR Process_Command_Line="*%tmp%*" OR Process_Command_Line="*C:\\ProgramData\\*" OR Process_Command_Line="*%ProgramData%*" OR Process_Command_Line="*\\AppData\\Local\\*" OR Process_Command_Line="*%AppData%*"))) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.persistence attack.t1197 attack.s0190 attack.t1036.003" | eval sigma_title="Bitsadmin Download to Uncommon Target Folder" | eval sigma_description="Detects usage of bitsadmin downloading a file to uncommon target folder"
dispatch.earliest_time = -24h@h
alert.track = 0

[Bitsadmin Download to Uncommon Target Folder - sysmon]
description = Detects usage of bitsadmin downloading a file to uncommon target folder
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\bitsadmin.exe" OR OriginalFileName="bitsadmin.exe") (CommandLine="* /transfer *" OR CommandLine="* /create *" OR CommandLine="* /addfile *") (CommandLine="*C:\\Windows\\Temp\\*" OR CommandLine="*%temp%*" OR CommandLine="*%tmp%*" OR CommandLine="*C:\\ProgramData\\*" OR CommandLine="*%ProgramData%*" OR CommandLine="*\\AppData\\Local\\*" OR CommandLine="*%AppData%*"))) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.persistence attack.t1197 attack.s0190 attack.t1036.003" | eval sigma_title="Bitsadmin Download to Uncommon Target Folder" | eval sigma_description="Detects usage of bitsadmin downloading a file to uncommon target folder"
dispatch.earliest_time = -24h@h
alert.track = 0

[Bitsadmin Download - winevent]
description = Detects usage of bitsadmin downloading a file
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((((New_Process_Name="*\\bitsadmin.exe" OR OriginalFileName="bitsadmin.exe") (Process_Command_Line="* /create *" OR Process_Command_Line="* /addfile *") Process_Command_Line="*http*")) OR (((New_Process_Name="*\\bitsadmin.exe" OR OriginalFileName="bitsadmin.exe") Process_Command_Line="* /transfer *")) OR Process_Command_Line="*copy bitsadmin.exe*"))) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.persistence attack.t1197 attack.s0190 attack.t1036.003" | eval sigma_title="Bitsadmin Download" | eval sigma_description="Detects usage of bitsadmin downloading a file"
dispatch.earliest_time = -24h@h
alert.track = 0

[Bitsadmin Download - sysmon]
description = Detects usage of bitsadmin downloading a file
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((((Image="*\\bitsadmin.exe" OR OriginalFileName="bitsadmin.exe") (CommandLine="* /create *" OR CommandLine="* /addfile *") CommandLine="*http*")) OR (((Image="*\\bitsadmin.exe" OR OriginalFileName="bitsadmin.exe") CommandLine="* /transfer *")) OR CommandLine="*copy bitsadmin.exe*"))) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.persistence attack.t1197 attack.s0190 attack.t1036.003" | eval sigma_title="Bitsadmin Download" | eval sigma_description="Detects usage of bitsadmin downloading a file"
dispatch.earliest_time = -24h@h
alert.track = 0

[Modification of Boot Configuration - winevent]
description = Identifies use of the bcdedit command to delete boot configuration data. This tactic is sometimes used as by malware or an attacker as a destructive technique.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\bcdedit.exe" OR OriginalFileName="bcdedit.exe") Process_Command_Line="*set*" (((Process_Command_Line="*bootstatuspolicy*" Process_Command_Line="*ignoreallfailures*")) OR ((Process_Command_Line="*recoveryenabled*" Process_Command_Line="*no*"))))) | table ComputerName,Account_Name,Process_Command_Line | eval sigma_attack_tags="attack.impact attack.t1490" | eval sigma_title="Modification of Boot Configuration" | eval sigma_description="Identifies use of the bcdedit command to delete boot configuration data. This tactic is sometimes used as by malware or an attacker as a destructive technique."
dispatch.earliest_time = -24h@h
alert.track = 0

[Modification of Boot Configuration - sysmon]
description = Identifies use of the bcdedit command to delete boot configuration data. This tactic is sometimes used as by malware or an attacker as a destructive technique.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\bcdedit.exe" OR OriginalFileName="bcdedit.exe") CommandLine="*set*" (((CommandLine="*bootstatuspolicy*" CommandLine="*ignoreallfailures*")) OR ((CommandLine="*recoveryenabled*" CommandLine="*no*"))))) | table ComputerName,User,CommandLine | eval sigma_attack_tags="attack.impact attack.t1490" | eval sigma_title="Modification of Boot Configuration" | eval sigma_description="Identifies use of the bcdedit command to delete boot configuration data. This tactic is sometimes used as by malware or an attacker as a destructive technique."
dispatch.earliest_time = -24h@h
alert.track = 0

[Browser Started with Remote Debugging - winevent]
description = Detects browsers starting with the remote debugging flags. Which is a technique often used to perform browser injection attacks
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (Process_Command_Line="* --remote-debugging-*" OR ((New_Process_Name="*\\firefox.exe" Process_Command_Line="* -start-debugger-server*"))))) | eval sigma_attack_tags="attack.credential_access attack.t1185" | eval sigma_title="Browser Started with Remote Debugging" | eval sigma_description="Detects browsers starting with the remote debugging flags. Which is a technique often used to perform browser injection attacks"
dispatch.earliest_time = -24h@h
alert.track = 0

[Browser Started with Remote Debugging - sysmon]
description = Detects browsers starting with the remote debugging flags. Which is a technique often used to perform browser injection attacks
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (CommandLine="* --remote-debugging-*" OR ((Image="*\\firefox.exe" CommandLine="* -start-debugger-server*"))))) | eval sigma_attack_tags="attack.credential_access attack.t1185" | eval sigma_title="Browser Started with Remote Debugging" | eval sigma_description="Detects browsers starting with the remote debugging flags. Which is a technique often used to perform browser injection attacks"
dispatch.earliest_time = -24h@h
alert.track = 0

[SquiblyTwo Execution - winevent]
description = Detects WMI SquiblyTwo Attack with possible renamed WMI by looking for imphash
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((((New_Process_Name="*\\wmic.exe" OR OriginalFileName="wmic.exe") ((Process_Command_Line="*wmic*" Process_Command_Line="*format*" Process_Command_Line="*http*")))) OR ((((Imphash="1B1A3F43BF37B5BFE60751F2EE2F326E" OR Imphash="37777A96245A3C74EB217308F3546F4C" OR Imphash="9D87C9D67CE724033C0B40CC4CA1B206") OR (Hashes="*IMPHASH=1B1A3F43BF37B5BFE60751F2EE2F326E*" OR Hashes="*IMPHASH=37777A96245A3C74EB217308F3546F4C*" OR Hashes="*IMPHASH=9D87C9D67CE724033C0B40CC4CA1B206*")) ((Process_Command_Line="*format:*" Process_Command_Line="*http*"))))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1047 attack.t1220 attack.execution attack.t1059.005 attack.t1059.007" | eval sigma_title="SquiblyTwo Execution" | eval sigma_description="Detects WMI SquiblyTwo Attack with possible renamed WMI by looking for imphash"
dispatch.earliest_time = -24h@h
alert.track = 0

[SquiblyTwo Execution - sysmon]
description = Detects WMI SquiblyTwo Attack with possible renamed WMI by looking for imphash
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((((Image="*\\wmic.exe" OR OriginalFileName="wmic.exe") ((CommandLine="*wmic*" CommandLine="*format*" CommandLine="*http*")))) OR ((((Imphash="1B1A3F43BF37B5BFE60751F2EE2F326E" OR Imphash="37777A96245A3C74EB217308F3546F4C" OR Imphash="9D87C9D67CE724033C0B40CC4CA1B206") OR (Hashes="*IMPHASH=1B1A3F43BF37B5BFE60751F2EE2F326E*" OR Hashes="*IMPHASH=37777A96245A3C74EB217308F3546F4C*" OR Hashes="*IMPHASH=9D87C9D67CE724033C0B40CC4CA1B206*")) ((CommandLine="*format:*" CommandLine="*http*"))))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1047 attack.t1220 attack.execution attack.t1059.005 attack.t1059.007" | eval sigma_title="SquiblyTwo Execution" | eval sigma_description="Detects WMI SquiblyTwo Attack with possible renamed WMI by looking for imphash"
dispatch.earliest_time = -24h@h
alert.track = 0

[Sliver C2 Implant Activity Pattern - winevent]
description = Detects process activity patterns as seen being used by Sliver C2 framework implants
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*-NoExit -Command [Console]::OutputEncoding=[Text.UTF8Encoding]::UTF8*")) | eval sigma_attack_tags="attack.execution attack.t1059" | eval sigma_title="Sliver C2 Implant Activity Pattern" | eval sigma_description="Detects process activity patterns as seen being used by Sliver C2 framework implants"
dispatch.earliest_time = -24h@h
alert.track = 0

[Sliver C2 Implant Activity Pattern - sysmon]
description = Detects process activity patterns as seen being used by Sliver C2 framework implants
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*-NoExit -Command [Console]::OutputEncoding=[Text.UTF8Encoding]::UTF8*")) | eval sigma_attack_tags="attack.execution attack.t1059" | eval sigma_title="Sliver C2 Implant Activity Pattern" | eval sigma_description="Detects process activity patterns as seen being used by Sliver C2 framework implants"
dispatch.earliest_time = -24h@h
alert.track = 0

[F-Secure C3 Load by Rundll32 - winevent]
description = F-Secure C3 produces DLLs with a default exported StartNodeRelay function.
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*rundll32.exe*" Process_Command_Line="*.dll*" Process_Command_Line="*StartNodeRelay*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1218.011" | eval sigma_title="F-Secure C3 Load by Rundll32" | eval sigma_description="F-Secure C3 produces DLLs with a default exported StartNodeRelay function."
dispatch.earliest_time = -24h@h
alert.track = 0

[F-Secure C3 Load by Rundll32 - sysmon]
description = F-Secure C3 produces DLLs with a default exported StartNodeRelay function.
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*rundll32.exe*" CommandLine="*.dll*" CommandLine="*StartNodeRelay*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1218.011" | eval sigma_title="F-Secure C3 Load by Rundll32" | eval sigma_description="F-Secure C3 produces DLLs with a default exported StartNodeRelay function."
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Load DLL via CertOC.exe - winevent]
description = Detects when a user installs certificates by using CertOC.exe to loads the target DLL file.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\certoc.exe" OR OriginalFileName="CertOC.exe") (Process_Command_Line="* -LoadDLL *" OR Process_Command_Line="* /LoadDLL *"))) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.t1218" | eval sigma_title="Suspicious Load DLL via CertOC.exe" | eval sigma_description="Detects when a user installs certificates by using CertOC.exe to loads the target DLL file."
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Load DLL via CertOC.exe - sysmon]
description = Detects when a user installs certificates by using CertOC.exe to loads the target DLL file.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\certoc.exe" OR OriginalFileName="CertOC.exe") (CommandLine="* -LoadDLL *" OR CommandLine="* /LoadDLL *"))) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.t1218" | eval sigma_title="Suspicious Load DLL via CertOC.exe" | eval sigma_description="Detects when a user installs certificates by using CertOC.exe to loads the target DLL file."
dispatch.earliest_time = -24h@h
alert.track = 0

[NTLM Coercion Via Certutil.exe - winevent]
description = Detects possible NTLM coercion via certutil using the 'syncwithWU' flag
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\certutil.exe" OR OriginalFileName="CertUtil.exe") ((Process_Command_Line="* -syncwithWU *" Process_Command_Line="* \\\\\*")))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218" | eval sigma_title="NTLM Coercion Via Certutil.exe" | eval sigma_description="Detects possible NTLM coercion via certutil using the 'syncwithWU' flag"
dispatch.earliest_time = -24h@h
alert.track = 0

[NTLM Coercion Via Certutil.exe - sysmon]
description = Detects possible NTLM coercion via certutil using the 'syncwithWU' flag
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\certutil.exe" OR OriginalFileName="CertUtil.exe") ((CommandLine="* -syncwithWU *" CommandLine="* \\\\\*")))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218" | eval sigma_title="NTLM Coercion Via Certutil.exe" | eval sigma_description="Detects possible NTLM coercion via certutil using the 'syncwithWU' flag"
dispatch.earliest_time = -24h@h
alert.track = 0

[Change Default File Association To Executable - winevent]
description = Detects when a program changes the default file association of any extension to an executable
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((Process_Command_Line="*cmd*" Process_Command_Line="*assoc *" Process_Command_Line="*exefile*" (Process_Command_Line="* /c *" OR Process_Command_Line="* /r *" OR Process_Command_Line="* /k *"))) NOT ((Process_Command_Line="*.exe=exefile*")))) | eval sigma_attack_tags="attack.persistence attack.t1546.001" | eval sigma_title="Change Default File Association To Executable" | eval sigma_description="Detects when a program changes the default file association of any extension to an executable"
dispatch.earliest_time = -24h@h
alert.track = 0

[Change Default File Association To Executable - sysmon]
description = Detects when a program changes the default file association of any extension to an executable
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((CommandLine="*cmd*" CommandLine="*assoc *" CommandLine="*exefile*" (CommandLine="* /c *" OR CommandLine="* /r *" OR CommandLine="* /k *"))) NOT ((CommandLine="*.exe=exefile*")))) | eval sigma_attack_tags="attack.persistence attack.t1546.001" | eval sigma_title="Change Default File Association To Executable" | eval sigma_description="Detects when a program changes the default file association of any extension to an executable"
dispatch.earliest_time = -24h@h
alert.track = 0

[Change Default File Association - winevent]
description = When a file is opened, the default program used to open the file (also called the file association or handler) is checked. File association selections are stored in the Windows Registry and can be edited by users, administrators, or programs that have Registry access or by administrators using the built-in assoc utility. Applications can modify the file association for a given file extension to call an arbitrary program when a file with the given extension is opened.
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*cmd*" Process_Command_Line="*assoc*" (Process_Command_Line="* /c *" OR Process_Command_Line="* /k *" OR Process_Command_Line="* /r *"))) | table New_Process_Name,Process_Command_Line,Account_Name,LogonGuid,Hashes,ParentProcessGuid,ParentCommandLine | eval sigma_attack_tags="attack.persistence attack.t1546.001" | eval sigma_title="Change Default File Association" | eval sigma_description="When a file is opened, the default program used to open the file (also called the file association or handler) is checked. File association selections are stored in the Windows Registry and can be edited by users, administrators, or programs that have Registry access or by administrators using the built-in assoc utility. Applications can modify the file association for a given file extension to call an arbitrary program when a file with the given extension is opened."
dispatch.earliest_time = -24h@h
alert.track = 0

[Change Default File Association - sysmon]
description = When a file is opened, the default program used to open the file (also called the file association or handler) is checked. File association selections are stored in the Windows Registry and can be edited by users, administrators, or programs that have Registry access or by administrators using the built-in assoc utility. Applications can modify the file association for a given file extension to call an arbitrary program when a file with the given extension is opened.
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*cmd*" CommandLine="*assoc*" (CommandLine="* /c *" OR CommandLine="* /k *" OR CommandLine="* /r *"))) | table Image,CommandLine,User,LogonGuid,Hashes,ParentProcessGuid,ParentCommandLine | eval sigma_attack_tags="attack.persistence attack.t1546.001" | eval sigma_title="Change Default File Association" | eval sigma_description="When a file is opened, the default program used to open the file (also called the file association or handler) is checked. File association selections are stored in the Windows Registry and can be edited by users, administrators, or programs that have Registry access or by administrators using the built-in assoc utility. Applications can modify the file association for a given file extension to call an arbitrary program when a file with the given extension is opened."
dispatch.earliest_time = -24h@h
alert.track = 0

[Chisel Tunneling Tool Usage - winevent]
description = Detects usage of the Chisel tunneling tool via the commandline arguments
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\chisel.exe" OR (((Process_Command_Line="*exe client *" OR Process_Command_Line="*exe server *") (Process_Command_Line="*-socks5*" OR Process_Command_Line="*-reverse*" OR Process_Command_Line="* r:*" OR Process_Command_Line="*:127.0.0.1:*" OR Process_Command_Line="*-tls-skip-verify *" OR Process_Command_Line="*:socks*")))))) | eval sigma_attack_tags="attack.command_and_control attack.t1090.001" | eval sigma_title="Chisel Tunneling Tool Usage" | eval sigma_description="Detects usage of the Chisel tunneling tool via the commandline arguments"
dispatch.earliest_time = -24h@h
alert.track = 0

[Chisel Tunneling Tool Usage - sysmon]
description = Detects usage of the Chisel tunneling tool via the commandline arguments
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\chisel.exe" OR (((CommandLine="*exe client *" OR CommandLine="*exe server *") (CommandLine="*-socks5*" OR CommandLine="*-reverse*" OR CommandLine="* r:*" OR CommandLine="*:127.0.0.1:*" OR CommandLine="*-tls-skip-verify *" OR CommandLine="*:socks*")))))) | eval sigma_attack_tags="attack.command_and_control attack.t1090.001" | eval sigma_title="Chisel Tunneling Tool Usage" | eval sigma_description="Detects usage of the Chisel tunneling tool via the commandline arguments"
dispatch.earliest_time = -24h@h
alert.track = 0

[Powershell ChromeLoader Browser Hijacker - winevent]
description = Detects PowerShell process spawning a 'chrome.exe' process with the 'load-extension' flag to start a new chrome instance with custom extensions, as seen being used in 'ChromeLoader'
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\chrome.exe" (Creator_Process_Name="*\\powershell.exe" OR Creator_Process_Name="*\\pwsh.exe") Process_Command_Line="*--load-extension=*" Process_Command_Line="*\\AppData\\Local\\*")) | eval sigma_attack_tags="attack.persistence attack.t1176" | eval sigma_title="Powershell ChromeLoader Browser Hijacker" | eval sigma_description="Detects PowerShell process spawning a 'chrome.exe' process with the 'load-extension' flag to start a new chrome instance with custom extensions, as seen being used in 'ChromeLoader'"
dispatch.earliest_time = -24h@h
alert.track = 0

[Powershell ChromeLoader Browser Hijacker - sysmon]
description = Detects PowerShell process spawning a 'chrome.exe' process with the 'load-extension' flag to start a new chrome instance with custom extensions, as seen being used in 'ChromeLoader'
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\chrome.exe" (ParentImage="*\\powershell.exe" OR ParentImage="*\\pwsh.exe") CommandLine="*--load-extension=*" CommandLine="*\\AppData\\Local\\*")) | eval sigma_attack_tags="attack.persistence attack.t1176" | eval sigma_title="Powershell ChromeLoader Browser Hijacker" | eval sigma_description="Detects PowerShell process spawning a 'chrome.exe' process with the 'load-extension' flag to start a new chrome instance with custom extensions, as seen being used in 'ChromeLoader'"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential Data Stealing Via Chromium Headless Debugging - winevent]
description = Detects chromium based browsers starting in headless and debugging mode and pointing to a user profile. This could be a sign of data stealing or remote control
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*--remote-debugging-*" Process_Command_Line="*--user-data-dir*" Process_Command_Line="*--headless*")) | eval sigma_attack_tags="attack.credential_access attack.t1185" | eval sigma_title="Potential Data Stealing Via Chromium Headless Debugging" | eval sigma_description="Detects chromium based browsers starting in headless and debugging mode and pointing to a user profile. This could be a sign of data stealing or remote control"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential Data Stealing Via Chromium Headless Debugging - sysmon]
description = Detects chromium based browsers starting in headless and debugging mode and pointing to a user profile. This could be a sign of data stealing or remote control
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*--remote-debugging-*" CommandLine="*--user-data-dir*" CommandLine="*--headless*")) | eval sigma_attack_tags="attack.credential_access attack.t1185" | eval sigma_title="Potential Data Stealing Via Chromium Headless Debugging" | eval sigma_description="Detects chromium based browsers starting in headless and debugging mode and pointing to a user profile. This could be a sign of data stealing or remote control"
dispatch.earliest_time = -24h@h
alert.track = 0

[CleanWipe Usage - winevent]
description = Detects the use of CleanWipe a tool usually used to delete Symantec antivirus.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\SepRemovalToolNative_x64.exe" OR ((New_Process_Name="*\\CATClean.exe" Process_Command_Line="*--uninstall*")) OR ((New_Process_Name="*\\NetInstaller.exe" Process_Command_Line="*-r*")) OR ((New_Process_Name="*\\WFPUnins.exe" Process_Command_Line="*/uninstall*" Process_Command_Line="*/enterprise*"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.001" | eval sigma_title="CleanWipe Usage" | eval sigma_description="Detects the use of CleanWipe a tool usually used to delete Symantec antivirus."
dispatch.earliest_time = -24h@h
alert.track = 0

[CleanWipe Usage - sysmon]
description = Detects the use of CleanWipe a tool usually used to delete Symantec antivirus.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\SepRemovalToolNative_x64.exe" OR ((Image="*\\CATClean.exe" CommandLine="*--uninstall*")) OR ((Image="*\\NetInstaller.exe" CommandLine="*-r*")) OR ((Image="*\\WFPUnins.exe" CommandLine="*/uninstall*" CommandLine="*/enterprise*"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.001" | eval sigma_title="CleanWipe Usage" | eval sigma_description="Detects the use of CleanWipe a tool usually used to delete Symantec antivirus."
dispatch.earliest_time = -24h@h
alert.track = 0

[Use of CLIP - winevent]
description = Adversaries may collect data stored in the clipboard from users copying information within or between applications.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\clip.exe" OR OriginalFileName="clip.exe"))) | eval sigma_attack_tags="attack.collection attack.t1115" | eval sigma_title="Use of CLIP" | eval sigma_description="Adversaries may collect data stored in the clipboard from users copying information within or between applications."
dispatch.earliest_time = -24h@h
alert.track = 0

[Use of CLIP - sysmon]
description = Adversaries may collect data stored in the clipboard from users copying information within or between applications.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\clip.exe" OR OriginalFileName="clip.exe"))) | eval sigma_attack_tags="attack.collection attack.t1115" | eval sigma_title="Use of CLIP" | eval sigma_description="Adversaries may collect data stored in the clipboard from users copying information within or between applications."
dispatch.earliest_time = -24h@h
alert.track = 0

[Windows Cmd Delete File - winevent]
description = Adversaries may delete files left behind by the actions of their intrusion activity.
Malware, tools, or other non-native files dropped or created on a system by an adversary may leave traces to indicate to what was done within a network and how.
Removal of these files can occur during an intrusion, or as part of a post-intrusion process to minimize the adversary's footprint.

search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((Process_Command_Line="* del *" Process_Command_Line="*/f*")) OR ((Process_Command_Line="*rmdir*" Process_Command_Line="*/s*" Process_Command_Line="*/q*"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1070.004" | eval sigma_title="Windows Cmd Delete File" | eval sigma_description="Adversaries may delete files left behind by the actions of their intrusion activity.
Malware, tools, or other non-native files dropped or created on a system by an adversary may leave traces to indicate to what was done within a network and how.
Removal of these files can occur during an intrusion, or as part of a post-intrusion process to minimize the adversary's footprint.
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Windows Cmd Delete File - sysmon]
description = Adversaries may delete files left behind by the actions of their intrusion activity.
Malware, tools, or other non-native files dropped or created on a system by an adversary may leave traces to indicate to what was done within a network and how.
Removal of these files can occur during an intrusion, or as part of a post-intrusion process to minimize the adversary's footprint.

search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((CommandLine="* del *" CommandLine="*/f*")) OR ((CommandLine="*rmdir*" CommandLine="*/s*" CommandLine="*/q*"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1070.004" | eval sigma_title="Windows Cmd Delete File" | eval sigma_description="Adversaries may delete files left behind by the actions of their intrusion activity.
Malware, tools, or other non-native files dropped or created on a system by an adversary may leave traces to indicate to what was done within a network and how.
Removal of these files can occur during an intrusion, or as part of a post-intrusion process to minimize the adversary's footprint.
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Dosfuscation Character in Commandline - winevent]
description = Detects possible payload obfuscation via the commandline
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (Process_Command_Line="*^^*" OR Process_Command_Line="*,;,*" OR Process_Command_Line="*%COMSPEC:~*" OR Process_Command_Line="* s^et *" OR Process_Command_Line="* s^e^t *" OR Process_Command_Line="* se^t *"))) | eval sigma_attack_tags="attack.execution attack.t1059" | eval sigma_title="Suspicious Dosfuscation Character in Commandline" | eval sigma_description="Detects possible payload obfuscation via the commandline"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Dosfuscation Character in Commandline - sysmon]
description = Detects possible payload obfuscation via the commandline
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (CommandLine="*^^*" OR CommandLine="*,;,*" OR CommandLine="*%COMSPEC:~*" OR CommandLine="* s^et *" OR CommandLine="* s^e^t *" OR CommandLine="* se^t *"))) | eval sigma_attack_tags="attack.execution attack.t1059" | eval sigma_title="Suspicious Dosfuscation Character in Commandline" | eval sigma_description="Detects possible payload obfuscation via the commandline"
dispatch.earliest_time = -24h@h
alert.track = 0

[Read and Execute a File Via Cmd.exe - winevent]
description = Detect use of '/R <' to read and execute a file via cmd.exe
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (OriginalFileName="Cmd.Exe" OR New_Process_Name="*\\cmd.exe") (((ParentCommandLine="*cmd *" ParentCommandLine="*/r *" ParentCommandLine="*<*")) OR ((Process_Command_Line="*cmd *" Process_Command_Line="*/r *" Process_Command_Line="*<*"))))) | eval sigma_attack_tags="attack.execution attack.t1059.003" | eval sigma_title="Read and Execute a File Via Cmd.exe" | eval sigma_description="Detect use of '/R <' to read and execute a file via cmd.exe"
dispatch.earliest_time = -24h@h
alert.track = 0

[Read and Execute a File Via Cmd.exe - sysmon]
description = Detect use of '/R <' to read and execute a file via cmd.exe
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (OriginalFileName="Cmd.Exe" OR Image="*\\cmd.exe") (((ParentCommandLine="*cmd *" ParentCommandLine="*/r *" ParentCommandLine="*<*")) OR ((CommandLine="*cmd *" CommandLine="*/r *" CommandLine="*<*"))))) | eval sigma_attack_tags="attack.execution attack.t1059.003" | eval sigma_title="Read and Execute a File Via Cmd.exe" | eval sigma_description="Detect use of '/R <' to read and execute a file via cmd.exe"
dispatch.earliest_time = -24h@h
alert.track = 0

[Redirect Output in CommandLine - winevent]
description = Detects use of redirection character '>' to redicrect information in commandline
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((OriginalFileName="Cmd.Exe" OR New_Process_Name="*\\cmd.exe") Process_Command_Line="*>*")) NOT ((((Process_Command_Line="*C:\\Program Files (x86)\\Internet Download Manager\\IDMMsgHost.exe*" OR Process_Command_Line="*chrome-extension://*" OR Process_Command_Line="*\\.\\pipe\\chrome.nativeMessaging*")))))) | eval sigma_attack_tags="attack.discovery attack.t1082" | eval sigma_title="Redirect Output in CommandLine" | eval sigma_description="Detects use of redirection character '>' to redicrect information in commandline"
dispatch.earliest_time = -24h@h
alert.track = 0

[Redirect Output in CommandLine - sysmon]
description = Detects use of redirection character '>' to redicrect information in commandline
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((OriginalFileName="Cmd.Exe" OR Image="*\\cmd.exe") CommandLine="*>*")) NOT ((((CommandLine="*C:\\Program Files (x86)\\Internet Download Manager\\IDMMsgHost.exe*" OR CommandLine="*chrome-extension://*" OR CommandLine="*\\.\\pipe\\chrome.nativeMessaging*")))))) | eval sigma_attack_tags="attack.discovery attack.t1082" | eval sigma_title="Redirect Output in CommandLine" | eval sigma_description="Detects use of redirection character '>' to redicrect information in commandline"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious CMD Shell Redirect - winevent]
description = Detects inline windows shell commands redirecting output via the '>' symbol to a suspicious location
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\cmd.exe" OR OriginalFileName="Cmd.Exe") ((Process_Command_Line="*> %USERPROFILE%\\*" OR Process_Command_Line="*> %APPDATA%\\*" OR Process_Command_Line="*> \\Users\\Public\\*" OR Process_Command_Line="*> C:\\Users\\Public\\*" OR Process_Command_Line="*> %TEMP%\\*" OR Process_Command_Line="*> %TMP%\\*" OR Process_Command_Line="*> C:\\Windows\\Temp\\*" OR Process_Command_Line="*> C:\\Temp\\*") OR (((Process_Command_Line="* > *" OR Process_Command_Line="* >> *") Process_Command_Line="*C:\\Users\\*" Process_Command_Line="*\\AppData\\Local\\*"))))) | eval sigma_attack_tags="attack.execution attack.t1218" | eval sigma_title="Suspicious CMD Shell Redirect" | eval sigma_description="Detects inline windows shell commands redirecting output via the '>' symbol to a suspicious location"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious CMD Shell Redirect - sysmon]
description = Detects inline windows shell commands redirecting output via the '>' symbol to a suspicious location
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\cmd.exe" OR OriginalFileName="Cmd.Exe") ((CommandLine="*> %USERPROFILE%\\*" OR CommandLine="*> %APPDATA%\\*" OR CommandLine="*> \\Users\\Public\\*" OR CommandLine="*> C:\\Users\\Public\\*" OR CommandLine="*> %TEMP%\\*" OR CommandLine="*> %TMP%\\*" OR CommandLine="*> C:\\Windows\\Temp\\*" OR CommandLine="*> C:\\Temp\\*") OR (((CommandLine="* > *" OR CommandLine="* >> *") CommandLine="*C:\\Users\\*" CommandLine="*\\AppData\\Local\\*"))))) | eval sigma_attack_tags="attack.execution attack.t1218" | eval sigma_title="Suspicious CMD Shell Redirect" | eval sigma_description="Detects inline windows shell commands redirecting output via the '>' symbol to a suspicious location"
dispatch.earliest_time = -24h@h
alert.track = 0

[Cmdkey Cached Credentials Recon - winevent]
description = Detects usage of cmdkey to look for cached credentials
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\cmdkey.exe" OR OriginalFileName="cmdkey.exe") (Process_Command_Line="* /l*" OR Process_Command_Line="* -l*"))) | table Process_Command_Line,ParentCommandLine,Account_Name | eval sigma_attack_tags="attack.credential_access attack.t1003.005" | eval sigma_title="Cmdkey Cached Credentials Recon" | eval sigma_description="Detects usage of cmdkey to look for cached credentials"
dispatch.earliest_time = -24h@h
alert.track = 0

[Cmdkey Cached Credentials Recon - sysmon]
description = Detects usage of cmdkey to look for cached credentials
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\cmdkey.exe" OR OriginalFileName="cmdkey.exe") (CommandLine="* /l*" OR CommandLine="* -l*"))) | table CommandLine,ParentCommandLine,User | eval sigma_attack_tags="attack.credential_access attack.t1003.005" | eval sigma_title="Cmdkey Cached Credentials Recon" | eval sigma_description="Detects usage of cmdkey to look for cached credentials"
dispatch.earliest_time = -24h@h
alert.track = 0

[CMSTP UAC Bypass via COM Object Access - winevent]
description = Detects UAC Bypass Attempt Using Microsoft Connection Manager Profile Installer Autoelevate-capable COM Objects (e.g. UACMe ID of 41, 43, 58 or 65)
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Creator_Process_Name="*\\DllHost.exe" (IntegrityLevel="High" OR IntegrityLevel="System") (ParentCommandLine="* /Processid:{3E5FC7F9-9A51-4367-9063-A120244FBEC7}*" OR ParentCommandLine="* /Processid:{3E000D72-A845-4CD9-BD83-80C07C3B881F}*" OR ParentCommandLine="* /Processid:{BD54C901-076B-434E-B6C7-17C531F4AB41}*" OR ParentCommandLine="* /Processid:{D2E7041B-2927-42FB-8E9F-7CE93B6DC937}*" OR ParentCommandLine="* /Processid:{E9495B87-D950-4AB5-87A5-FF6D70BF3E90}*"))) | table Process_Command_Line,ParentCommandLine,Hashes | eval sigma_attack_tags="attack.execution attack.defense_evasion attack.privilege_escalation attack.t1548.002 attack.t1218.003 attack.g0069 car.2019-04-001" | eval sigma_title="CMSTP UAC Bypass via COM Object Access" | eval sigma_description="Detects UAC Bypass Attempt Using Microsoft Connection Manager Profile Installer Autoelevate-capable COM Objects (e.g. UACMe ID of 41, 43, 58 or 65)"
dispatch.earliest_time = -24h@h
alert.track = 0

[CMSTP UAC Bypass via COM Object Access - sysmon]
description = Detects UAC Bypass Attempt Using Microsoft Connection Manager Profile Installer Autoelevate-capable COM Objects (e.g. UACMe ID of 41, 43, 58 or 65)
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") ParentImage="*\\DllHost.exe" (IntegrityLevel="High" OR IntegrityLevel="System") (ParentCommandLine="* /Processid:{3E5FC7F9-9A51-4367-9063-A120244FBEC7}*" OR ParentCommandLine="* /Processid:{3E000D72-A845-4CD9-BD83-80C07C3B881F}*" OR ParentCommandLine="* /Processid:{BD54C901-076B-434E-B6C7-17C531F4AB41}*" OR ParentCommandLine="* /Processid:{D2E7041B-2927-42FB-8E9F-7CE93B6DC937}*" OR ParentCommandLine="* /Processid:{E9495B87-D950-4AB5-87A5-FF6D70BF3E90}*"))) | table CommandLine,ParentCommandLine,Hashes | eval sigma_attack_tags="attack.execution attack.defense_evasion attack.privilege_escalation attack.t1548.002 attack.t1218.003 attack.g0069 car.2019-04-001" | eval sigma_title="CMSTP UAC Bypass via COM Object Access" | eval sigma_description="Detects UAC Bypass Attempt Using Microsoft Connection Manager Profile Installer Autoelevate-capable COM Objects (e.g. UACMe ID of 41, 43, 58 or 65)"
dispatch.earliest_time = -24h@h
alert.track = 0

[CMSTP Execution Process Creation - winevent]
description = Detects various indicators of Microsoft Connection Manager Profile Installer execution
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Creator_Process_Name="*\\cmstp.exe")) | table Process_Command_Line,ParentCommandLine,NewValue | eval sigma_attack_tags="attack.defense_evasion attack.execution attack.t1218.003 attack.g0069 car.2019-04-001" | eval sigma_title="CMSTP Execution Process Creation" | eval sigma_description="Detects various indicators of Microsoft Connection Manager Profile Installer execution"
dispatch.earliest_time = -24h@h
alert.track = 0

[CMSTP Execution Process Creation - sysmon]
description = Detects various indicators of Microsoft Connection Manager Profile Installer execution
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") ParentImage="*\\cmstp.exe")) | table CommandLine,ParentCommandLine,Details | eval sigma_attack_tags="attack.defense_evasion attack.execution attack.t1218.003 attack.g0069 car.2019-04-001" | eval sigma_title="CMSTP Execution Process Creation" | eval sigma_description="Detects various indicators of Microsoft Connection Manager Profile Installer execution"
dispatch.earliest_time = -24h@h
alert.track = 0

[Operator Bloopers Cobalt Strike Commands - winevent]
description = Detects use of Cobalt Strike commands accidentally entered in the CMD shell
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (OriginalFileName="Cmd.Exe" OR New_Process_Name="*\\cmd.exe") (((Process_Command_Line="cmd *" OR Process_Command_Line="cmd.exe*" OR Process_Command_Line="c:\\windows\\system32\\cmd.exe*") (Process_Command_Line="*psinject*" OR Process_Command_Line="*spawnas*" OR Process_Command_Line="*make_token*" OR Process_Command_Line="*remote-exec*" OR Process_Command_Line="*rev2self*" OR Process_Command_Line="*dcsync*" OR Process_Command_Line="*logonpasswords*" OR Process_Command_Line="*execute-assembly*" OR Process_Command_Line="*getsystem*"))))) | eval sigma_attack_tags="attack.execution attack.t1059.003" | eval sigma_title="Operator Bloopers Cobalt Strike Commands" | eval sigma_description="Detects use of Cobalt Strike commands accidentally entered in the CMD shell"
dispatch.earliest_time = -24h@h
alert.track = 0

[Operator Bloopers Cobalt Strike Commands - sysmon]
description = Detects use of Cobalt Strike commands accidentally entered in the CMD shell
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (OriginalFileName="Cmd.Exe" OR Image="*\\cmd.exe") (((CommandLine="cmd *" OR CommandLine="cmd.exe*" OR CommandLine="c:\\windows\\system32\\cmd.exe*") (CommandLine="*psinject*" OR CommandLine="*spawnas*" OR CommandLine="*make_token*" OR CommandLine="*remote-exec*" OR CommandLine="*rev2self*" OR CommandLine="*dcsync*" OR CommandLine="*logonpasswords*" OR CommandLine="*execute-assembly*" OR CommandLine="*getsystem*"))))) | eval sigma_attack_tags="attack.execution attack.t1059.003" | eval sigma_title="Operator Bloopers Cobalt Strike Commands" | eval sigma_description="Detects use of Cobalt Strike commands accidentally entered in the CMD shell"
dispatch.earliest_time = -24h@h
alert.track = 0

[Operator Bloopers Cobalt Strike Modules - winevent]
description = Detects Cobalt Strike module/commands accidentally entered in CMD shell
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (OriginalFileName="Cmd.Exe" OR New_Process_Name="*\\cmd.exe") (Process_Command_Line="*Invoke-UserHunter*" OR Process_Command_Line="*Invoke-ShareFinder*" OR Process_Command_Line="*Invoke-Kerberoast*" OR Process_Command_Line="*Invoke-SMBAutoBrute*" OR Process_Command_Line="*Invoke-Nightmare*" OR Process_Command_Line="*zerologon*" OR Process_Command_Line="*av_query*"))) | eval sigma_attack_tags="attack.execution attack.t1059.003" | eval sigma_title="Operator Bloopers Cobalt Strike Modules" | eval sigma_description="Detects Cobalt Strike module/commands accidentally entered in CMD shell"
dispatch.earliest_time = -24h@h
alert.track = 0

[Operator Bloopers Cobalt Strike Modules - sysmon]
description = Detects Cobalt Strike module/commands accidentally entered in CMD shell
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (OriginalFileName="Cmd.Exe" OR Image="*\\cmd.exe") (CommandLine="*Invoke-UserHunter*" OR CommandLine="*Invoke-ShareFinder*" OR CommandLine="*Invoke-Kerberoast*" OR CommandLine="*Invoke-SMBAutoBrute*" OR CommandLine="*Invoke-Nightmare*" OR CommandLine="*zerologon*" OR CommandLine="*av_query*"))) | eval sigma_attack_tags="attack.execution attack.t1059.003" | eval sigma_title="Operator Bloopers Cobalt Strike Modules" | eval sigma_description="Detects Cobalt Strike module/commands accidentally entered in CMD shell"
dispatch.earliest_time = -24h@h
alert.track = 0

[CobaltStrike Load by Rundll32 - winevent]
description = Rundll32 can be use by Cobalt Strike with StartW function to load DLLs from the command line.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\rundll32.exe" OR OriginalFileName="RUNDLL32.EXE" OR (Process_Command_Line="*rundll32.exe*" OR Process_Command_Line="*rundll32 *")) ((Process_Command_Line="*.dll*" (Process_Command_Line="* StartW" OR Process_Command_Line="*,StartW"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218.011" | eval sigma_title="CobaltStrike Load by Rundll32" | eval sigma_description="Rundll32 can be use by Cobalt Strike with StartW function to load DLLs from the command line."
dispatch.earliest_time = -24h@h
alert.track = 0

[CobaltStrike Load by Rundll32 - sysmon]
description = Rundll32 can be use by Cobalt Strike with StartW function to load DLLs from the command line.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\rundll32.exe" OR OriginalFileName="RUNDLL32.EXE" OR (CommandLine="*rundll32.exe*" OR CommandLine="*rundll32 *")) ((CommandLine="*.dll*" (CommandLine="* StartW" OR CommandLine="*,StartW"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218.011" | eval sigma_title="CobaltStrike Load by Rundll32" | eval sigma_description="Rundll32 can be use by Cobalt Strike with StartW function to load DLLs from the command line."
dispatch.earliest_time = -24h@h
alert.track = 0

[CobaltStrike Process Patterns - winevent]
description = Detects process patterns found in Cobalt Strike beacon activity (see reference for more details) and also cases in which a China Chopper like webshell is used to run whoami
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((((Process_Command_Line="*\\cmd.exe /C whoami*" Creator_Process_Name="C:\\Temp*")) OR (((Process_Command_Line="*cmd.exe /c echo*" OR Process_Command_Line="*> \\\\.\\pipe*" OR Process_Command_Line="*\\whoami.exe*") Creator_Process_Name="*\\dllhost.exe")) OR ((New_Process_Name="*\\cmd.exe" Creator_Process_Name="*\\runonce.exe" ParentCommandLine="*\\runonce.exe"))) OR ((((Process_Command_Line="*conhost.exe 0xffffffff -ForceV1*" (ParentCommandLine="*/C whoami*" OR ParentCommandLine="*cmd.exe /C echo*" OR ParentCommandLine="* > \\\\.\\pipe*"))) NOT (((ParentCommandLine="*C:\\Program Files (x86)\\Internet Download Manager\\IDMMsgHost.exe*" OR ParentCommandLine="*chrome-extension://*")))))))) | eval sigma_attack_tags="attack.execution attack.t1059" | eval sigma_title="CobaltStrike Process Patterns" | eval sigma_description="Detects process patterns found in Cobalt Strike beacon activity (see reference for more details) and also cases in which a China Chopper like webshell is used to run whoami"
dispatch.earliest_time = -24h@h
alert.track = 0

[CobaltStrike Process Patterns - sysmon]
description = Detects process patterns found in Cobalt Strike beacon activity (see reference for more details) and also cases in which a China Chopper like webshell is used to run whoami
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((((CommandLine="*\\cmd.exe /C whoami*" ParentImage="C:\\Temp*")) OR (((CommandLine="*cmd.exe /c echo*" OR CommandLine="*> \\\\.\\pipe*" OR CommandLine="*\\whoami.exe*") ParentImage="*\\dllhost.exe")) OR ((Image="*\\cmd.exe" ParentImage="*\\runonce.exe" ParentCommandLine="*\\runonce.exe"))) OR ((((CommandLine="*conhost.exe 0xffffffff -ForceV1*" (ParentCommandLine="*/C whoami*" OR ParentCommandLine="*cmd.exe /C echo*" OR ParentCommandLine="* > \\\\.\\pipe*"))) NOT (((ParentCommandLine="*C:\\Program Files (x86)\\Internet Download Manager\\IDMMsgHost.exe*" OR ParentCommandLine="*chrome-extension://*")))))))) | eval sigma_attack_tags="attack.execution attack.t1059" | eval sigma_title="CobaltStrike Process Patterns" | eval sigma_description="Detects process patterns found in Cobalt Strike beacon activity (see reference for more details) and also cases in which a China Chopper like webshell is used to run whoami"
dispatch.earliest_time = -24h@h
alert.track = 0

[Command Line Path Traversal Evasion - winevent]
description = Detects the attempt to evade or obfuscate the executed command on the CommandLine using bogus path traversal
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((New_Process_Name="*\\Windows\\*" (Process_Command_Line="*\\..\\Windows\\*" OR Process_Command_Line="*\\..\\System32\\*" OR Process_Command_Line="*\\..\\..\\*"))) OR Process_Command_Line="*.exe\\..\\*") NOT (((Process_Command_Line="*\\Google\\Drive\\googledrivesync.exe\\..\\*" OR Process_Command_Line="*\\Citrix\\Virtual Smart Card\\Citrix.Authentication.VirtualSmartcard.Launcher.exe\\..\\*"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1036" | eval sigma_title="Command Line Path Traversal Evasion" | eval sigma_description="Detects the attempt to evade or obfuscate the executed command on the CommandLine using bogus path traversal"
dispatch.earliest_time = -24h@h
alert.track = 0

[Command Line Path Traversal Evasion - sysmon]
description = Detects the attempt to evade or obfuscate the executed command on the CommandLine using bogus path traversal
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((Image="*\\Windows\\*" (CommandLine="*\\..\\Windows\\*" OR CommandLine="*\\..\\System32\\*" OR CommandLine="*\\..\\..\\*"))) OR CommandLine="*.exe\\..\\*") NOT (((CommandLine="*\\Google\\Drive\\googledrivesync.exe\\..\\*" OR CommandLine="*\\Citrix\\Virtual Smart Card\\Citrix.Authentication.VirtualSmartcard.Launcher.exe\\..\\*"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1036" | eval sigma_title="Command Line Path Traversal Evasion" | eval sigma_description="Detects the attempt to evade or obfuscate the executed command on the CommandLine using bogus path traversal"
dispatch.earliest_time = -24h@h
alert.track = 0

[Cmd.exe CommandLine Path Traversal - winevent]
description = detects the usage of path traversal in cmd.exe indicating possible command/argument confusion/hijacking
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((ParentCommandLine="*cmd*" OR Creator_Process_Name="*\\cmd.exe") (((ParentCommandLine="*/c*" OR ParentCommandLine="*/k*" OR ParentCommandLine="*/r*") Process_Command_Line="*/../../*")))) NOT (((Process_Command_Line="*\\Tasktop\\keycloak\\bin\\/../../jre\\bin\\java*"))))) | eval sigma_attack_tags="attack.execution attack.t1059.003" | eval sigma_title="Cmd.exe CommandLine Path Traversal" | eval sigma_description="detects the usage of path traversal in cmd.exe indicating possible command/argument confusion/hijacking"
dispatch.earliest_time = -24h@h
alert.track = 0

[Cmd.exe CommandLine Path Traversal - sysmon]
description = detects the usage of path traversal in cmd.exe indicating possible command/argument confusion/hijacking
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((ParentCommandLine="*cmd*" OR ParentImage="*\\cmd.exe") (((ParentCommandLine="*/c*" OR ParentCommandLine="*/k*" OR ParentCommandLine="*/r*") CommandLine="*/../../*")))) NOT (((CommandLine="*\\Tasktop\\keycloak\\bin\\/../../jre\\bin\\java*"))))) | eval sigma_attack_tags="attack.execution attack.t1059.003" | eval sigma_title="Cmd.exe CommandLine Path Traversal" | eval sigma_description="detects the usage of path traversal in cmd.exe indicating possible command/argument confusion/hijacking"
dispatch.earliest_time = -24h@h
alert.track = 0

[Computer Discovery And Export Via Get-ADComputer Cmdlet - winevent]
description = Detects usage of the Get-ADComputer cmdlet to collect computer information and output it to a file
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\powershell.exe" OR New_Process_Name="*\\pwsh.exe") OR (OriginalFileName="PowerShell.EXE" OR OriginalFileName="pwsh.dll")) ((Process_Command_Line="*Get-ADComputer *" Process_Command_Line="* -Filter \*" (Process_Command_Line="* > *" OR Process_Command_Line="* | Select *" OR Process_Command_Line="*Out-File*" OR Process_Command_Line="*Set-Content*" OR Process_Command_Line="*Add-Content*"))))) | eval sigma_attack_tags="attack.discovery attack.t1033" | eval sigma_title="Computer Discovery And Export Via Get-ADComputer Cmdlet" | eval sigma_description="Detects usage of the Get-ADComputer cmdlet to collect computer information and output it to a file"
dispatch.earliest_time = -24h@h
alert.track = 0

[Computer Discovery And Export Via Get-ADComputer Cmdlet - sysmon]
description = Detects usage of the Get-ADComputer cmdlet to collect computer information and output it to a file
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\powershell.exe" OR Image="*\\pwsh.exe") OR (OriginalFileName="PowerShell.EXE" OR OriginalFileName="pwsh.dll")) ((CommandLine="*Get-ADComputer *" CommandLine="* -Filter \*" (CommandLine="* > *" OR CommandLine="* | Select *" OR CommandLine="*Out-File*" OR CommandLine="*Set-Content*" OR CommandLine="*Add-Content*"))))) | eval sigma_attack_tags="attack.discovery attack.t1033" | eval sigma_title="Computer Discovery And Export Via Get-ADComputer Cmdlet" | eval sigma_description="Detects usage of the Get-ADComputer cmdlet to collect computer information and output it to a file"
dispatch.earliest_time = -24h@h
alert.track = 0

[Conhost.exe CommandLine Path Traversal - winevent]
description = detects the usage of path traversal in conhost.exe indicating possible command/argument confusion/hijacking
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") ParentCommandLine="*conhost*" Process_Command_Line="*/../../*")) | eval sigma_attack_tags="attack.execution attack.t1059.003" | eval sigma_title="Conhost.exe CommandLine Path Traversal" | eval sigma_description="detects the usage of path traversal in conhost.exe indicating possible command/argument confusion/hijacking"
dispatch.earliest_time = -24h@h
alert.track = 0

[Conhost.exe CommandLine Path Traversal - sysmon]
description = detects the usage of path traversal in conhost.exe indicating possible command/argument confusion/hijacking
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") ParentCommandLine="*conhost*" CommandLine="*/../../*")) | eval sigma_attack_tags="attack.execution attack.t1059.003" | eval sigma_title="Conhost.exe CommandLine Path Traversal" | eval sigma_description="detects the usage of path traversal in conhost.exe indicating possible command/argument confusion/hijacking"
dispatch.earliest_time = -24h@h
alert.track = 0

[Conti Ransomware Execution - winevent]
description = Conti ransomware command line ioc
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*-m *" Process_Command_Line="*-net *" Process_Command_Line="*-size *" Process_Command_Line="*-nomutex *" Process_Command_Line="*-p \\\\\*" Process_Command_Line="*$*")) | eval sigma_attack_tags="attack.impact attack.s0575 attack.t1486" | eval sigma_title="Conti Ransomware Execution" | eval sigma_description="Conti ransomware command line ioc"
dispatch.earliest_time = -24h@h
alert.track = 0

[Conti Ransomware Execution - sysmon]
description = Conti ransomware command line ioc
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*-m *" CommandLine="*-net *" CommandLine="*-size *" CommandLine="*-nomutex *" CommandLine="*-p \\\\\*" CommandLine="*$*")) | eval sigma_attack_tags="attack.impact attack.s0575 attack.t1486" | eval sigma_title="Conti Ransomware Execution" | eval sigma_description="Conti ransomware command line ioc"
dispatch.earliest_time = -24h@h
alert.track = 0

[Conti Backup Database - winevent]
description = Detects a command used by conti to dump database
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (Process_Command_Line="*sqlcmd *" OR Process_Command_Line="*sqlcmd.exe*") Process_Command_Line="* -S localhost *" (Process_Command_Line="*sys.sysprocesses*" OR Process_Command_Line="*master.dbo.sysdatabases*" OR Process_Command_Line="*BACKUP DATABASE*"))) | eval sigma_attack_tags="attack.collection attack.t1005" | eval sigma_title="Conti Backup Database" | eval sigma_description="Detects a command used by conti to dump database"
dispatch.earliest_time = -24h@h
alert.track = 0

[Conti Backup Database - sysmon]
description = Detects a command used by conti to dump database
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (CommandLine="*sqlcmd *" OR CommandLine="*sqlcmd.exe*") CommandLine="* -S localhost *" (CommandLine="*sys.sysprocesses*" OR CommandLine="*master.dbo.sysdatabases*" OR CommandLine="*BACKUP DATABASE*"))) | eval sigma_attack_tags="attack.collection attack.t1005" | eval sigma_title="Conti Backup Database" | eval sigma_description="Detects a command used by conti to dump database"
dispatch.earliest_time = -24h@h
alert.track = 0

[Control Panel Items - winevent]
description = Detects the malicious use of a control panel item
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((((New_Process_Name="*\\reg.exe" OR OriginalFileName="reg.exe") ((Process_Command_Line="*add*" Process_Command_Line="*CurrentVersion\\Control Panel\\CPLs*")))) OR ((Process_Command_Line="*.cpl" NOT ((((Process_Command_Line="*\\System32\\*" OR Process_Command_Line="*%System%*"))) OR (((Process_Command_Line="*regsvr32 *" Process_Command_Line="* /s *" Process_Command_Line="*igfxCPL.cpl*"))))))))) | eval sigma_attack_tags="attack.execution attack.defense_evasion attack.t1218.002 attack.persistence attack.t1546" | eval sigma_title="Control Panel Items" | eval sigma_description="Detects the malicious use of a control panel item"
dispatch.earliest_time = -24h@h
alert.track = 0

[Control Panel Items - sysmon]
description = Detects the malicious use of a control panel item
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((((Image="*\\reg.exe" OR OriginalFileName="reg.exe") ((CommandLine="*add*" CommandLine="*CurrentVersion\\Control Panel\\CPLs*")))) OR ((CommandLine="*.cpl" NOT ((((CommandLine="*\\System32\\*" OR CommandLine="*%System%*"))) OR (((CommandLine="*regsvr32 *" CommandLine="* /s *" CommandLine="*igfxCPL.cpl*"))))))))) | eval sigma_attack_tags="attack.execution attack.defense_evasion attack.t1218.002 attack.persistence attack.t1546" | eval sigma_title="Control Panel Items" | eval sigma_description="Detects the malicious use of a control panel item"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential Browser Data Stealing - winevent]
description = Adversaries may acquire credentials from web browsers by reading files specific to the target browser.
Web browsers commonly save credentials such as website usernames and passwords so that they do not need to be entered manually in the future.
Web browsers typically store the credentials in an encrypted format within a credential store.

search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((Process_Command_Line="*copy-item*" OR Process_Command_Line="*copy *" OR Process_Command_Line="*cpi *" OR Process_Command_Line="* cp *" OR Process_Command_Line="*move *" OR Process_Command_Line="*move-item*" OR Process_Command_Line="* mi *" OR Process_Command_Line="* mv *") OR (New_Process_Name="*\\xcopy.exe" OR New_Process_Name="*\\robocopy.exe") OR (OriginalFileName="XCOPY.EXE" OR OriginalFileName="robocopy.exe")) (Process_Command_Line="*\\Opera Software\\Opera Stable\\*" OR Process_Command_Line="*\\Mozilla\\Firefox\\Profiles*" OR Process_Command_Line="*\\Microsoft\\Edge\\User Data\\*" OR Process_Command_Line="*\\Google\\Chrome\\User Data\\*"))) | eval sigma_attack_tags="attack.credential_access attack.t1555.003" | eval sigma_title="Potential Browser Data Stealing" | eval sigma_description="Adversaries may acquire credentials from web browsers by reading files specific to the target browser.
Web browsers commonly save credentials such as website usernames and passwords so that they do not need to be entered manually in the future.
Web browsers typically store the credentials in an encrypted format within a credential store.
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential Browser Data Stealing - sysmon]
description = Adversaries may acquire credentials from web browsers by reading files specific to the target browser.
Web browsers commonly save credentials such as website usernames and passwords so that they do not need to be entered manually in the future.
Web browsers typically store the credentials in an encrypted format within a credential store.

search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((CommandLine="*copy-item*" OR CommandLine="*copy *" OR CommandLine="*cpi *" OR CommandLine="* cp *" OR CommandLine="*move *" OR CommandLine="*move-item*" OR CommandLine="* mi *" OR CommandLine="* mv *") OR (Image="*\\xcopy.exe" OR Image="*\\robocopy.exe") OR (OriginalFileName="XCOPY.EXE" OR OriginalFileName="robocopy.exe")) (CommandLine="*\\Opera Software\\Opera Stable\\*" OR CommandLine="*\\Mozilla\\Firefox\\Profiles*" OR CommandLine="*\\Microsoft\\Edge\\User Data\\*" OR CommandLine="*\\Google\\Chrome\\User Data\\*"))) | eval sigma_attack_tags="attack.credential_access attack.t1555.003" | eval sigma_title="Potential Browser Data Stealing" | eval sigma_description="Adversaries may acquire credentials from web browsers by reading files specific to the target browser.
Web browsers commonly save credentials such as website usernames and passwords so that they do not need to be entered manually in the future.
Web browsers typically store the credentials in an encrypted format within a credential store.
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Copy DMP Files From Share - winevent]
description = Detects usage of the copy command to copy files with the .dmp extensions from a remote share
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*.dmp*" Process_Command_Line="*copy *" Process_Command_Line="* \\\\\*" (Process_Command_Line="* /c *" OR Process_Command_Line="* /r *" OR Process_Command_Line="* /k *"))) | eval sigma_attack_tags="attack.credential_access" | eval sigma_title="Copy DMP Files From Share" | eval sigma_description="Detects usage of the copy command to copy files with the .dmp extensions from a remote share"
dispatch.earliest_time = -24h@h
alert.track = 0

[Copy DMP Files From Share - sysmon]
description = Detects usage of the copy command to copy files with the .dmp extensions from a remote share
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*.dmp*" CommandLine="*copy *" CommandLine="* \\\\\*" (CommandLine="* /c *" OR CommandLine="* /r *" OR CommandLine="* /k *"))) | eval sigma_attack_tags="attack.credential_access" | eval sigma_title="Copy DMP Files From Share" | eval sigma_description="Detects usage of the copy command to copy files with the .dmp extensions from a remote share"
dispatch.earliest_time = -24h@h
alert.track = 0

[Copying Sensitive Files with Credential Data - winevent]
description = Files with well-known filenames (sensitive files with credential data) copying
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((((New_Process_Name="*\\esentutl.exe" OR OriginalFileName="\\esentutl.exe") (Process_Command_Line="*vss*" OR Process_Command_Line="* /m *" OR Process_Command_Line="* /y *"))) OR (Process_Command_Line="*\\windows\\ntds\\ntds.dit*" OR Process_Command_Line="*\\config\\sam*" OR Process_Command_Line="*\\config\\security*" OR Process_Command_Line="*\\config\\system *" OR Process_Command_Line="*\\repair\\sam*" OR Process_Command_Line="*\\repair\\system*" OR Process_Command_Line="*\\repair\\security*" OR Process_Command_Line="*\\config\\RegBack\\sam*" OR Process_Command_Line="*\\config\\RegBack\\system*" OR Process_Command_Line="*\\config\\RegBack\\security*")))) | eval sigma_attack_tags="attack.credential_access attack.t1003.002 attack.t1003.003 car.2013-07-001 attack.s0404" | eval sigma_title="Copying Sensitive Files with Credential Data" | eval sigma_description="Files with well-known filenames (sensitive files with credential data) copying"
dispatch.earliest_time = -24h@h
alert.track = 0

[Copying Sensitive Files with Credential Data - sysmon]
description = Files with well-known filenames (sensitive files with credential data) copying
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((((Image="*\\esentutl.exe" OR OriginalFileName="\\esentutl.exe") (CommandLine="*vss*" OR CommandLine="* /m *" OR CommandLine="* /y *"))) OR (CommandLine="*\\windows\\ntds\\ntds.dit*" OR CommandLine="*\\config\\sam*" OR CommandLine="*\\config\\security*" OR CommandLine="*\\config\\system *" OR CommandLine="*\\repair\\sam*" OR CommandLine="*\\repair\\system*" OR CommandLine="*\\repair\\security*" OR CommandLine="*\\config\\RegBack\\sam*" OR CommandLine="*\\config\\RegBack\\system*" OR CommandLine="*\\config\\RegBack\\security*")))) | eval sigma_attack_tags="attack.credential_access attack.t1003.002 attack.t1003.003 car.2013-07-001 attack.s0404" | eval sigma_title="Copying Sensitive Files with Credential Data" | eval sigma_description="Files with well-known filenames (sensitive files with credential data) copying"
dispatch.earliest_time = -24h@h
alert.track = 0

[CrackMapExec Process Patterns - winevent]
description = Detects suspicious process patterns found in logs when CrackMapExec is used
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((Process_Command_Line="*tasklist /fi *" Process_Command_Line="*Imagename eq lsass.exe*" (Process_Command_Line="*cmd.exe /c *" OR Process_Command_Line="*cmd.exe /r *" OR Process_Command_Line="*cmd.exe /k *" OR Process_Command_Line="*cmd /c *" OR Process_Command_Line="*cmd /r *" OR Process_Command_Line="*cmd /k *") (Account_Name="*AUTHORI*" OR Account_Name="*AUTORI*"))) OR ((Process_Command_Line="*do rundll32.exe C:\\windows\\System32\\comsvcs.dll, MiniDump*" Process_Command_Line="*\\Windows\\Temp\\*" Process_Command_Line="* full*" Process_Command_Line="*%%B*")) OR ((Process_Command_Line="*tasklist /v /fo csv*" Process_Command_Line="*findstr /i \"lsass\"*"))))) | eval sigma_attack_tags="attack.credential_access attack.t1003.001" | eval sigma_title="CrackMapExec Process Patterns" | eval sigma_description="Detects suspicious process patterns found in logs when CrackMapExec is used"
dispatch.earliest_time = -24h@h
alert.track = 0

[CrackMapExec Process Patterns - sysmon]
description = Detects suspicious process patterns found in logs when CrackMapExec is used
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((CommandLine="*tasklist /fi *" CommandLine="*Imagename eq lsass.exe*" (CommandLine="*cmd.exe /c *" OR CommandLine="*cmd.exe /r *" OR CommandLine="*cmd.exe /k *" OR CommandLine="*cmd /c *" OR CommandLine="*cmd /r *" OR CommandLine="*cmd /k *") (User="*AUTHORI*" OR User="*AUTORI*"))) OR ((CommandLine="*do rundll32.exe C:\\windows\\System32\\comsvcs.dll, MiniDump*" CommandLine="*\\Windows\\Temp\\*" CommandLine="* full*" CommandLine="*%%B*")) OR ((CommandLine="*tasklist /v /fo csv*" CommandLine="*findstr /i \"lsass\"*"))))) | eval sigma_attack_tags="attack.credential_access attack.t1003.001" | eval sigma_title="CrackMapExec Process Patterns" | eval sigma_description="Detects suspicious process patterns found in logs when CrackMapExec is used"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential Privilege Escalation Using Symlink Between Osk and Cmd - winevent]
description = Detects the creation of a symbolic link between 'cmd.exe' and the accessibility on-screen keyboard binary (osk.exe) using 'mklink'. This technique provides an elevated command prompt to the user from the login screen without the need to log in.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\cmd.exe" OR OriginalFileName="Cmd.Exe") ((Process_Command_Line="*mklink*" Process_Command_Line="*\\osk.exe*" Process_Command_Line="*\\cmd.exe*")))) | eval sigma_attack_tags="attack.credential_access attack.t1546.008" | eval sigma_title="Potential Privilege Escalation Using Symlink Between Osk and Cmd" | eval sigma_description="Detects the creation of a symbolic link between 'cmd.exe' and the accessibility on-screen keyboard binary (osk.exe) using 'mklink'. This technique provides an elevated command prompt to the user from the login screen without the need to log in."
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential Privilege Escalation Using Symlink Between Osk and Cmd - sysmon]
description = Detects the creation of a symbolic link between 'cmd.exe' and the accessibility on-screen keyboard binary (osk.exe) using 'mklink'. This technique provides an elevated command prompt to the user from the login screen without the need to log in.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\cmd.exe" OR OriginalFileName="Cmd.Exe") ((CommandLine="*mklink*" CommandLine="*\\osk.exe*" CommandLine="*\\cmd.exe*")))) | eval sigma_attack_tags="attack.credential_access attack.t1546.008" | eval sigma_title="Potential Privilege Escalation Using Symlink Between Osk and Cmd" | eval sigma_description="Detects the creation of a symbolic link between 'cmd.exe' and the accessibility on-screen keyboard binary (osk.exe) using 'mklink'. This technique provides an elevated command prompt to the user from the login screen without the need to log in."
dispatch.earliest_time = -24h@h
alert.track = 0

[Node Process Executions - winevent]
description = Detects the execution of other scripts using the Node executable packaged with Adobe Creative Cloud
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) New_Process_Name="*\\Adobe Creative Cloud Experience\\libs\\node.exe" NOT ((Process_Command_Line="*Adobe Creative Cloud Experience\\js*")))) | table New_Process_Name,Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.t1127 attack.t1059.007" | eval sigma_title="Node Process Executions" | eval sigma_description="Detects the execution of other scripts using the Node executable packaged with Adobe Creative Cloud"
dispatch.earliest_time = -24h@h
alert.track = 0

[Node Process Executions - sysmon]
description = Detects the execution of other scripts using the Node executable packaged with Adobe Creative Cloud
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) Image="*\\Adobe Creative Cloud Experience\\libs\\node.exe" NOT ((CommandLine="*Adobe Creative Cloud Experience\\js*")))) | table Image,CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.t1127 attack.t1059.007" | eval sigma_title="Node Process Executions" | eval sigma_description="Detects the execution of other scripts using the Node executable packaged with Adobe Creative Cloud"
dispatch.earliest_time = -24h@h
alert.track = 0

[Dropping Of Password Filter DLL - winevent]
description = Detects dropping of dll files in system32 that may be used to retrieve user credentials from LSASS
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*HKLM\\SYSTEM\\CurrentControlSet\\Control\\Lsa*" Process_Command_Line="*scecli\\0*" Process_Command_Line="*reg add*")) | eval sigma_attack_tags="attack.credential_access attack.t1556.002" | eval sigma_title="Dropping Of Password Filter DLL" | eval sigma_description="Detects dropping of dll files in system32 that may be used to retrieve user credentials from LSASS"
dispatch.earliest_time = -24h@h
alert.track = 0

[Dropping Of Password Filter DLL - sysmon]
description = Detects dropping of dll files in system32 that may be used to retrieve user credentials from LSASS
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*HKLM\\SYSTEM\\CurrentControlSet\\Control\\Lsa*" CommandLine="*scecli\\0*" CommandLine="*reg add*")) | eval sigma_attack_tags="attack.credential_access attack.t1556.002" | eval sigma_title="Dropping Of Password Filter DLL" | eval sigma_description="Detects dropping of dll files in system32 that may be used to retrieve user credentials from LSASS"
dispatch.earliest_time = -24h@h
alert.track = 0

[Credential Acquisition via Registry Hive Dumping - winevent]
description = Detects Credential Acquisition via Registry Hive Dumping
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\reg.exe" OR OriginalFileName="reg.exe") (Process_Command_Line="* save *" OR Process_Command_Line="* export *") (Process_Command_Line="*hklm\\sam*" OR Process_Command_Line="*hklm\\security*" OR Process_Command_Line="*HKEY_LOCAL_MACHINE\\SAM*" OR Process_Command_Line="*HKEY_LOCAL_MACHINE\\SECURITY*"))) | eval sigma_attack_tags="attack.credential_access attack.t1003" | eval sigma_title="Credential Acquisition via Registry Hive Dumping" | eval sigma_description="Detects Credential Acquisition via Registry Hive Dumping"
dispatch.earliest_time = -24h@h
alert.track = 0

[Credential Acquisition via Registry Hive Dumping - sysmon]
description = Detects Credential Acquisition via Registry Hive Dumping
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\reg.exe" OR OriginalFileName="reg.exe") (CommandLine="* save *" OR CommandLine="* export *") (CommandLine="*hklm\\sam*" OR CommandLine="*hklm\\security*" OR CommandLine="*HKEY_LOCAL_MACHINE\\SAM*" OR CommandLine="*HKEY_LOCAL_MACHINE\\SECURITY*"))) | eval sigma_attack_tags="attack.credential_access attack.t1003" | eval sigma_title="Credential Acquisition via Registry Hive Dumping" | eval sigma_description="Detects Credential Acquisition via Registry Hive Dumping"
dispatch.earliest_time = -24h@h
alert.track = 0

[Fireball Archer Install - winevent]
description = Detects Archer malware invocation via rundll32
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*rundll32.exe*" Process_Command_Line="*InstallArcherSvc*")) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.execution attack.defense_evasion attack.t1218.011" | eval sigma_title="Fireball Archer Install" | eval sigma_description="Detects Archer malware invocation via rundll32"
dispatch.earliest_time = -24h@h
alert.track = 0

[Fireball Archer Install - sysmon]
description = Detects Archer malware invocation via rundll32
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*rundll32.exe*" CommandLine="*InstallArcherSvc*")) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.execution attack.defense_evasion attack.t1218.011" | eval sigma_title="Fireball Archer Install" | eval sigma_description="Detects Archer malware invocation via rundll32"
dispatch.earliest_time = -24h@h
alert.track = 0

[Maze Ransomware - winevent]
description = Detects specific process characteristics of Maze ransomware word document droppers
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((Creator_Process_Name="*\\WINWORD.exe" New_Process_Name="*.tmp")) OR ((New_Process_Name="*\\wmic.exe" Creator_Process_Name="*\\Temp\\*" Process_Command_Line="*shadowcopy delete")) OR ((Process_Command_Line="*shadowcopy delete" Process_Command_Line="*\\..\\..\\system32*"))))) | table ComputerName,Account_Name,New_Process_Name | eval sigma_attack_tags="attack.execution attack.t1204.002 attack.t1047 attack.impact attack.t1490" | eval sigma_title="Maze Ransomware" | eval sigma_description="Detects specific process characteristics of Maze ransomware word document droppers"
dispatch.earliest_time = -24h@h
alert.track = 0

[Maze Ransomware - sysmon]
description = Detects specific process characteristics of Maze ransomware word document droppers
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((ParentImage="*\\WINWORD.exe" Image="*.tmp")) OR ((Image="*\\wmic.exe" ParentImage="*\\Temp\\*" CommandLine="*shadowcopy delete")) OR ((CommandLine="*shadowcopy delete" CommandLine="*\\..\\..\\system32*"))))) | table ComputerName,User,Image | eval sigma_attack_tags="attack.execution attack.t1204.002 attack.t1047 attack.impact attack.t1490" | eval sigma_title="Maze Ransomware" | eval sigma_description="Detects specific process characteristics of Maze ransomware word document droppers"
dispatch.earliest_time = -24h@h
alert.track = 0

[Snatch Ransomware - winevent]
description = Detects specific process characteristics of Snatch ransomware word document droppers
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (Process_Command_Line="*shutdown /r /f /t 00*" OR Process_Command_Line="*net stop SuperBackupMan*"))) | table ComputerName,Account_Name,New_Process_Name | eval sigma_attack_tags="attack.execution attack.t1204" | eval sigma_title="Snatch Ransomware" | eval sigma_description="Detects specific process characteristics of Snatch ransomware word document droppers"
dispatch.earliest_time = -24h@h
alert.track = 0

[Snatch Ransomware - sysmon]
description = Detects specific process characteristics of Snatch ransomware word document droppers
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (CommandLine="*shutdown /r /f /t 00*" OR CommandLine="*net stop SuperBackupMan*"))) | table ComputerName,User,Image | eval sigma_attack_tags="attack.execution attack.t1204" | eval sigma_title="Snatch Ransomware" | eval sigma_description="Detects specific process characteristics of Snatch ransomware word document droppers"
dispatch.earliest_time = -24h@h
alert.track = 0

[Windows Crypto Mining Indicators - winevent]
description = Detects command line parameters or strings often used by crypto miners
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (Process_Command_Line="* --cpu-priority=*" OR Process_Command_Line="*--donate-level=0*" OR Process_Command_Line="* -o pool.*" OR Process_Command_Line="* --nicehash*" OR Process_Command_Line="* --algo=rx/0 *" OR Process_Command_Line="*stratum+tcp://*" OR Process_Command_Line="*stratum+udp://*" OR Process_Command_Line="*LS1kb25hdGUtbGV2ZWw9*" OR Process_Command_Line="*0tZG9uYXRlLWxldmVsP*" OR Process_Command_Line="*tLWRvbmF0ZS1sZXZlbD*" OR Process_Command_Line="*c3RyYXR1bSt0Y3A6Ly*" OR Process_Command_Line="*N0cmF0dW0rdGNwOi8v*" OR Process_Command_Line="*zdHJhdHVtK3RjcDovL*" OR Process_Command_Line="*c3RyYXR1bSt1ZHA6Ly*" OR Process_Command_Line="*N0cmF0dW0rdWRwOi8v*" OR Process_Command_Line="*zdHJhdHVtK3VkcDovL*") NOT (((Process_Command_Line="* pool.c *" OR Process_Command_Line="* pool.o *" OR Process_Command_Line="*gcc -*"))))) | eval sigma_attack_tags="attack.impact attack.t1496" | eval sigma_title="Windows Crypto Mining Indicators" | eval sigma_description="Detects command line parameters or strings often used by crypto miners"
dispatch.earliest_time = -24h@h
alert.track = 0

[Windows Crypto Mining Indicators - sysmon]
description = Detects command line parameters or strings often used by crypto miners
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (CommandLine="* --cpu-priority=*" OR CommandLine="*--donate-level=0*" OR CommandLine="* -o pool.*" OR CommandLine="* --nicehash*" OR CommandLine="* --algo=rx/0 *" OR CommandLine="*stratum+tcp://*" OR CommandLine="*stratum+udp://*" OR CommandLine="*LS1kb25hdGUtbGV2ZWw9*" OR CommandLine="*0tZG9uYXRlLWxldmVsP*" OR CommandLine="*tLWRvbmF0ZS1sZXZlbD*" OR CommandLine="*c3RyYXR1bSt0Y3A6Ly*" OR CommandLine="*N0cmF0dW0rdGNwOi8v*" OR CommandLine="*zdHJhdHVtK3RjcDovL*" OR CommandLine="*c3RyYXR1bSt1ZHA6Ly*" OR CommandLine="*N0cmF0dW0rdWRwOi8v*" OR CommandLine="*zdHJhdHVtK3VkcDovL*") NOT (((CommandLine="* pool.c *" OR CommandLine="* pool.o *" OR CommandLine="*gcc -*"))))) | eval sigma_attack_tags="attack.impact attack.t1496" | eval sigma_title="Windows Crypto Mining Indicators" | eval sigma_description="Detects command line parameters or strings often used by crypto miners"
dispatch.earliest_time = -24h@h
alert.track = 0

[Curl Usage on Windows - winevent]
description = Detects a curl process start on Windows, which indicates a file download from a remote location or a simple web request to a remote server
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\curl.exe" OR Product="The curl executable"))) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.command_and_control attack.t1105" | eval sigma_title="Curl Usage on Windows" | eval sigma_description="Detects a curl process start on Windows, which indicates a file download from a remote location or a simple web request to a remote server"
dispatch.earliest_time = -24h@h
alert.track = 0

[Curl Usage on Windows - sysmon]
description = Detects a curl process start on Windows, which indicates a file download from a remote location or a simple web request to a remote server
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\curl.exe" OR Product="The curl executable"))) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.command_and_control attack.t1105" | eval sigma_title="Curl Usage on Windows" | eval sigma_description="Detects a curl process start on Windows, which indicates a file download from a remote location or a simple web request to a remote server"
dispatch.earliest_time = -24h@h
alert.track = 0

[CVE-2021-26857 Exchange Exploitation - winevent]
description = Detects possible successful exploitation for vulnerability described in CVE-2021-26857 by looking for | abnormal subprocesses spawning by Exchange Server's Unified Messaging service
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) Creator_Process_Name="*UMWorkerProcess.exe" NOT (((New_Process_Name="*wermgr.exe" OR New_Process_Name="*WerFault.exe"))))) | eval sigma_attack_tags="attack.t1203 attack.execution cve.2021.26857" | eval sigma_title="CVE-2021-26857 Exchange Exploitation" | eval sigma_description="Detects possible successful exploitation for vulnerability described in CVE-2021-26857 by looking for | abnormal subprocesses spawning by Exchange Server's Unified Messaging service"
dispatch.earliest_time = -24h@h
alert.track = 0

[CVE-2021-26857 Exchange Exploitation - sysmon]
description = Detects possible successful exploitation for vulnerability described in CVE-2021-26857 by looking for | abnormal subprocesses spawning by Exchange Server's Unified Messaging service
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ParentImage="*UMWorkerProcess.exe" NOT (((Image="*wermgr.exe" OR Image="*WerFault.exe"))))) | eval sigma_attack_tags="attack.t1203 attack.execution cve.2021.26857" | eval sigma_title="CVE-2021-26857 Exchange Exploitation" | eval sigma_description="Detects possible successful exploitation for vulnerability described in CVE-2021-26857 by looking for | abnormal subprocesses spawning by Exchange Server's Unified Messaging service"
dispatch.earliest_time = -24h@h
alert.track = 0

[Data Compressed - rar.exe - winevent]
description = An adversary may compress data (e.g., sensitive documents) that is collected prior to exfiltration in order to make it portable and minimize the amount of data sent over the network.
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\rar.exe" Process_Command_Line="* a *")) | table New_Process_Name,Process_Command_Line,Account_Name,LogonGuid,Hashes,ParentProcessGuid,ParentCommandLine | eval sigma_attack_tags="attack.collection attack.t1560.001" | eval sigma_title="Data Compressed - rar.exe" | eval sigma_description="An adversary may compress data (e.g., sensitive documents) that is collected prior to exfiltration in order to make it portable and minimize the amount of data sent over the network."
dispatch.earliest_time = -24h@h
alert.track = 0

[Data Compressed - rar.exe - sysmon]
description = An adversary may compress data (e.g., sensitive documents) that is collected prior to exfiltration in order to make it portable and minimize the amount of data sent over the network.
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\rar.exe" CommandLine="* a *")) | table Image,CommandLine,User,LogonGuid,Hashes,ParentProcessGuid,ParentCommandLine | eval sigma_attack_tags="attack.collection attack.t1560.001" | eval sigma_title="Data Compressed - rar.exe" | eval sigma_description="An adversary may compress data (e.g., sensitive documents) that is collected prior to exfiltration in order to make it portable and minimize the amount of data sent over the network."
dispatch.earliest_time = -24h@h
alert.track = 0

[Detecting Fake Instances Of Hxtsr.exe - winevent]
description = HxTsr.exe is a Microsoft compressed executable file called Microsoft Outlook Communications.
HxTsr.exe is part of Outlook apps, because it resides in a hidden 'WindowsApps' subfolder of 'C:\Program Files'.
Its path includes a version number, e.g., 'C:\Program Files\WindowsApps\microsoft.windowscommunicationsapps_17.7466.41167.0_x64__8wekyb3d8bbwe\HxTsr.exe'.
Any instances of hxtsr.exe not in this folder may be malware camouflaging itself as HxTsr.exe

search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) New_Process_Name="hxtsr.exe" NOT ((CurrentDirectory="C:\\program files\\windowsapps\\microsoft.windowscommunicationsapps_*" CurrentDirectory="*\\hxtsr.exe")))) | eval sigma_attack_tags="attack.defense_evasion attack.t1036" | eval sigma_title="Detecting Fake Instances Of Hxtsr.exe" | eval sigma_description="HxTsr.exe is a Microsoft compressed executable file called Microsoft Outlook Communications.
HxTsr.exe is part of Outlook apps, because it resides in a hidden 'WindowsApps' subfolder of 'C:\Program Files'.
Its path includes a version number, e.g., 'C:\Program Files\WindowsApps\microsoft.windowscommunicationsapps_17.7466.41167.0_x64__8wekyb3d8bbwe\HxTsr.exe'.
Any instances of hxtsr.exe not in this folder may be malware camouflaging itself as HxTsr.exe
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Detecting Fake Instances Of Hxtsr.exe - sysmon]
description = HxTsr.exe is a Microsoft compressed executable file called Microsoft Outlook Communications.
HxTsr.exe is part of Outlook apps, because it resides in a hidden 'WindowsApps' subfolder of 'C:\Program Files'.
Its path includes a version number, e.g., 'C:\Program Files\WindowsApps\microsoft.windowscommunicationsapps_17.7466.41167.0_x64__8wekyb3d8bbwe\HxTsr.exe'.
Any instances of hxtsr.exe not in this folder may be malware camouflaging itself as HxTsr.exe

search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) Image="hxtsr.exe" NOT ((CurrentDirectory="C:\\program files\\windowsapps\\microsoft.windowscommunicationsapps_*" CurrentDirectory="*\\hxtsr.exe")))) | eval sigma_attack_tags="attack.defense_evasion attack.t1036" | eval sigma_title="Detecting Fake Instances Of Hxtsr.exe" | eval sigma_description="HxTsr.exe is a Microsoft compressed executable file called Microsoft Outlook Communications.
HxTsr.exe is part of Outlook apps, because it resides in a hidden 'WindowsApps' subfolder of 'C:\Program Files'.
Its path includes a version number, e.g., 'C:\Program Files\WindowsApps\microsoft.windowscommunicationsapps_17.7466.41167.0_x64__8wekyb3d8bbwe\HxTsr.exe'.
Any instances of hxtsr.exe not in this folder may be malware camouflaging itself as HxTsr.exe
"
dispatch.earliest_time = -24h@h
alert.track = 0

[DLL Sideloading via DeviceEnroller.exe - winevent]
description = Detects the use of the PhoneDeepLink parameter to potentially sideload a DLL file that doesnt exist. This non-existent DLL file is named 'ShellChromeAPI.dll'. 
Adversaries can drop their own renamed DLL and execute it via DeviceEnroller.exe using this parameter

search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\deviceenroller.exe" Process_Command_Line="*/PhoneDeepLink*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1574.002" | eval sigma_title="DLL Sideloading via DeviceEnroller.exe" | eval sigma_description="Detects the use of the PhoneDeepLink parameter to potentially sideload a DLL file that doesnt exist. This non-existent DLL file is named 'ShellChromeAPI.dll'. 
Adversaries can drop their own renamed DLL and execute it via DeviceEnroller.exe using this parameter
"
dispatch.earliest_time = -24h@h
alert.track = 0

[DLL Sideloading via DeviceEnroller.exe - sysmon]
description = Detects the use of the PhoneDeepLink parameter to potentially sideload a DLL file that doesnt exist. This non-existent DLL file is named 'ShellChromeAPI.dll'. 
Adversaries can drop their own renamed DLL and execute it via DeviceEnroller.exe using this parameter

search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\deviceenroller.exe" CommandLine="*/PhoneDeepLink*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1574.002" | eval sigma_title="DLL Sideloading via DeviceEnroller.exe" | eval sigma_description="Detects the use of the PhoneDeepLink parameter to potentially sideload a DLL file that doesnt exist. This non-existent DLL file is named 'ShellChromeAPI.dll'. 
Adversaries can drop their own renamed DLL and execute it via DeviceEnroller.exe using this parameter
"
dispatch.earliest_time = -24h@h
alert.track = 0

[DInject PowerShell Cradle CommandLine Flags - winevent]
description = Detects the use of the Dinject PowerShell cradle based on the specific flags
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (Process_Command_Line="* /am51*" OR Process_Command_Line="* /password*") NOT (((Process_Command_Line="* /PASSWORDCHG*") OR ((Creator_Process_Name="C:\\Program Files\\CEETIS\\CEETIS_IDE.exe" OR Creator_Process_Name="C:\\Program Files (x86)\\CEETIS\\CEETIS_IDE.exe")))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1055" | eval sigma_title="DInject PowerShell Cradle CommandLine Flags" | eval sigma_description="Detects the use of the Dinject PowerShell cradle based on the specific flags"
dispatch.earliest_time = -24h@h
alert.track = 0

[DInject PowerShell Cradle CommandLine Flags - sysmon]
description = Detects the use of the Dinject PowerShell cradle based on the specific flags
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (CommandLine="* /am51*" OR CommandLine="* /password*") NOT (((CommandLine="* /PASSWORDCHG*") OR ((ParentImage="C:\\Program Files\\CEETIS\\CEETIS_IDE.exe" OR ParentImage="C:\\Program Files (x86)\\CEETIS\\CEETIS_IDE.exe")))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1055" | eval sigma_title="DInject PowerShell Cradle CommandLine Flags" | eval sigma_description="Detects the use of the Dinject PowerShell cradle based on the specific flags"
dispatch.earliest_time = -24h@h
alert.track = 0

[Launch DirLister Executable - winevent]
description = Detect use of DirLister.exe
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (OriginalFileName="DirLister.exe" OR New_Process_Name="*\\dirlister.exe"))) | eval sigma_attack_tags="attack.discovery attack.t1083" | eval sigma_title="Launch DirLister Executable" | eval sigma_description="Detect use of DirLister.exe"
dispatch.earliest_time = -24h@h
alert.track = 0

[Launch DirLister Executable - sysmon]
description = Detect use of DirLister.exe
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (OriginalFileName="DirLister.exe" OR Image="*\\dirlister.exe"))) | eval sigma_attack_tags="attack.discovery attack.t1083" | eval sigma_title="Launch DirLister Executable" | eval sigma_description="Detect use of DirLister.exe"
dispatch.earliest_time = -24h@h
alert.track = 0

[Disable Windows Defender AV Security Monitoring - winevent]
description = Detects attackers attempting to disable Windows Defender using Powershell
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((((New_Process_Name="*\\powershell.exe" OR New_Process_Name="*\\pwsh.exe") OR (OriginalFileName="PowerShell.EXE" OR OriginalFileName="pwsh.dll")) (Process_Command_Line="*-DisableBehaviorMonitoring $true*" OR Process_Command_Line="*-DisableRuntimeMonitoring $true*"))) OR (((New_Process_Name="*\\sc.exe" OR OriginalFileName="sc.exe") (((Process_Command_Line="*stop*" Process_Command_Line="*WinDefend*")) OR ((Process_Command_Line="*delete*" Process_Command_Line="*WinDefend*")) OR ((Process_Command_Line="*config*" Process_Command_Line="*WinDefend*" Process_Command_Line="*start=disabled*")))))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.001" | eval sigma_title="Disable Windows Defender AV Security Monitoring" | eval sigma_description="Detects attackers attempting to disable Windows Defender using Powershell"
dispatch.earliest_time = -24h@h
alert.track = 0

[Disable Windows Defender AV Security Monitoring - sysmon]
description = Detects attackers attempting to disable Windows Defender using Powershell
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((((Image="*\\powershell.exe" OR Image="*\\pwsh.exe") OR (OriginalFileName="PowerShell.EXE" OR OriginalFileName="pwsh.dll")) (CommandLine="*-DisableBehaviorMonitoring $true*" OR CommandLine="*-DisableRuntimeMonitoring $true*"))) OR (((Image="*\\sc.exe" OR OriginalFileName="sc.exe") (((CommandLine="*stop*" CommandLine="*WinDefend*")) OR ((CommandLine="*delete*" CommandLine="*WinDefend*")) OR ((CommandLine="*config*" CommandLine="*WinDefend*" CommandLine="*start=disabled*")))))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.001" | eval sigma_title="Disable Windows Defender AV Security Monitoring" | eval sigma_description="Detects attackers attempting to disable Windows Defender using Powershell"
dispatch.earliest_time = -24h@h
alert.track = 0

[Sc Or Set-Service Cmdlet Execution to Disable Services - winevent]
description = Detects when attackers use 'sc.exe' or the powershell 'Set-Service' cmdlet to change the startup type of a service to 'disabled'
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((((New_Process_Name="*\\sc.exe" OR OriginalFileName="sc.exe") ((Process_Command_Line="* config *" Process_Command_Line="*start*" (Process_Command_Line="*disabled*" OR Process_Command_Line="*demand*"))))) OR ((Process_Command_Line="*Set-Service*" Process_Command_Line="*-StartupType*" (Process_Command_Line="*Disabled*" OR Process_Command_Line="*Manual*")))))) | eval sigma_attack_tags="attack.execution attack.defense_evasion attack.t1562.001" | eval sigma_title="Sc Or Set-Service Cmdlet Execution to Disable Services" | eval sigma_description="Detects when attackers use 'sc.exe' or the powershell 'Set-Service' cmdlet to change the startup type of a service to 'disabled'"
dispatch.earliest_time = -24h@h
alert.track = 0

[Sc Or Set-Service Cmdlet Execution to Disable Services - sysmon]
description = Detects when attackers use 'sc.exe' or the powershell 'Set-Service' cmdlet to change the startup type of a service to 'disabled'
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((((Image="*\\sc.exe" OR OriginalFileName="sc.exe") ((CommandLine="* config *" CommandLine="*start*" (CommandLine="*disabled*" OR CommandLine="*demand*"))))) OR ((CommandLine="*Set-Service*" CommandLine="*-StartupType*" (CommandLine="*Disabled*" OR CommandLine="*Manual*")))))) | eval sigma_attack_tags="attack.execution attack.defense_evasion attack.t1562.001" | eval sigma_title="Sc Or Set-Service Cmdlet Execution to Disable Services" | eval sigma_description="Detects when attackers use 'sc.exe' or the powershell 'Set-Service' cmdlet to change the startup type of a service to 'disabled'"
dispatch.earliest_time = -24h@h
alert.track = 0

[Discover Private Keys - winevent]
description = Adversaries may search for private key certificate files on compromised systems for insecurely stored credential
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (Process_Command_Line="*dir *" OR Process_Command_Line="*findstr *") (Process_Command_Line="*.key*" OR Process_Command_Line="*.pgp*" OR Process_Command_Line="*.gpg*" OR Process_Command_Line="*.ppk*" OR Process_Command_Line="*.p12*" OR Process_Command_Line="*.pem*" OR Process_Command_Line="*.pfx*" OR Process_Command_Line="*.cer*" OR Process_Command_Line="*.p7b*" OR Process_Command_Line="*.asc*"))) | table ComputerName,Account_Name,Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.credential_access attack.t1552.004" | eval sigma_title="Discover Private Keys" | eval sigma_description="Adversaries may search for private key certificate files on compromised systems for insecurely stored credential"
dispatch.earliest_time = -24h@h
alert.track = 0

[Discover Private Keys - sysmon]
description = Adversaries may search for private key certificate files on compromised systems for insecurely stored credential
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (CommandLine="*dir *" OR CommandLine="*findstr *") (CommandLine="*.key*" OR CommandLine="*.pgp*" OR CommandLine="*.gpg*" OR CommandLine="*.ppk*" OR CommandLine="*.p12*" OR CommandLine="*.pem*" OR CommandLine="*.pfx*" OR CommandLine="*.cer*" OR CommandLine="*.p7b*" OR CommandLine="*.asc*"))) | table ComputerName,User,CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.credential_access attack.t1552.004" | eval sigma_title="Discover Private Keys" | eval sigma_description="Adversaries may search for private key certificate files on compromised systems for insecurely stored credential"
dispatch.earliest_time = -24h@h
alert.track = 0

[DLL Sideloading by Microsoft Defender - winevent]
description = Detects execution of Microsoft Defender's CLI process (MpCmdRun.exe) from the non-default directory which may be an attempt to sideload arbitrary DLL
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) New_Process_Name="*\\MpCmdRun.exe" NOT (((New_Process_Name="C:\\Program Files\\Windows Defender\\*" OR New_Process_Name="C:\\ProgramData\\Microsoft\\Windows Defender\\Platform\\*" OR New_Process_Name="C:\\Windows\\winsxs\\*" OR New_Process_Name="C:\\Program Files\\Microsoft Security Client\\MpCmdRun.exe*"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1574.002" | eval sigma_title="DLL Sideloading by Microsoft Defender" | eval sigma_description="Detects execution of Microsoft Defender's CLI process (MpCmdRun.exe) from the non-default directory which may be an attempt to sideload arbitrary DLL"
dispatch.earliest_time = -24h@h
alert.track = 0

[DLL Sideloading by Microsoft Defender - sysmon]
description = Detects execution of Microsoft Defender's CLI process (MpCmdRun.exe) from the non-default directory which may be an attempt to sideload arbitrary DLL
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) Image="*\\MpCmdRun.exe" NOT (((Image="C:\\Program Files\\Windows Defender\\*" OR Image="C:\\ProgramData\\Microsoft\\Windows Defender\\Platform\\*" OR Image="C:\\Windows\\winsxs\\*" OR Image="C:\\Program Files\\Microsoft Security Client\\MpCmdRun.exe*"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1574.002" | eval sigma_title="DLL Sideloading by Microsoft Defender" | eval sigma_description="Detects execution of Microsoft Defender's CLI process (MpCmdRun.exe) from the non-default directory which may be an attempt to sideload arbitrary DLL"
dispatch.earliest_time = -24h@h
alert.track = 0

[DLL Sideloading by VMware Xfer Utility - winevent]
description = Detects execution of VMware Xfer utility (VMwareXferlogs.exe) from the non-default directory which may be an attempt to sideload arbitrary DLL
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) New_Process_Name="*\\VMwareXferlogs.exe" NOT ((New_Process_Name="C:\\Program Files\\VMware\\*")))) | eval sigma_attack_tags="attack.defense_evasion attack.t1574.002" | eval sigma_title="DLL Sideloading by VMware Xfer Utility" | eval sigma_description="Detects execution of VMware Xfer utility (VMwareXferlogs.exe) from the non-default directory which may be an attempt to sideload arbitrary DLL"
dispatch.earliest_time = -24h@h
alert.track = 0

[DLL Sideloading by VMware Xfer Utility - sysmon]
description = Detects execution of VMware Xfer utility (VMwareXferlogs.exe) from the non-default directory which may be an attempt to sideload arbitrary DLL
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) Image="*\\VMwareXferlogs.exe" NOT ((Image="C:\\Program Files\\VMware\\*")))) | eval sigma_attack_tags="attack.defense_evasion attack.t1574.002" | eval sigma_title="DLL Sideloading by VMware Xfer Utility" | eval sigma_description="Detects execution of VMware Xfer utility (VMwareXferlogs.exe) from the non-default directory which may be an attempt to sideload arbitrary DLL"
dispatch.earliest_time = -24h@h
alert.track = 0

[DNS Exfiltration and Tunneling Tools Execution - winevent]
description = Well-known DNS Exfiltration tools execution
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\iodine.exe" OR New_Process_Name="*\\dnscat2*"))) | eval sigma_attack_tags="attack.exfiltration attack.t1048.001 attack.command_and_control attack.t1071.004 attack.t1132.001" | eval sigma_title="DNS Exfiltration and Tunneling Tools Execution" | eval sigma_description="Well-known DNS Exfiltration tools execution"
dispatch.earliest_time = -24h@h
alert.track = 0

[DNS Exfiltration and Tunneling Tools Execution - sysmon]
description = Well-known DNS Exfiltration tools execution
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\iodine.exe" OR Image="*\\dnscat2*"))) | eval sigma_attack_tags="attack.exfiltration attack.t1048.001 attack.command_and_control attack.t1071.004 attack.t1132.001" | eval sigma_title="DNS Exfiltration and Tunneling Tools Execution" | eval sigma_description="Well-known DNS Exfiltration tools execution"
dispatch.earliest_time = -24h@h
alert.track = 0

[DNS ServerLevelPluginDll Install - winevent]
description = Detects the installation of a plugin DLL via ServerLevelPluginDll parameter in Registry, which can be used to execute code in context of the DNS server (restart required)
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\dnscmd.exe" Process_Command_Line="*/config*" Process_Command_Line="*/serverlevelplugindll*")) | table EventCode,Process_Command_Line,ParentCommandLine,New_Process_Name,Account_Name,TargetObject | eval sigma_attack_tags="attack.defense_evasion attack.t1574.002 attack.t1112" | eval sigma_title="DNS ServerLevelPluginDll Install" | eval sigma_description="Detects the installation of a plugin DLL via ServerLevelPluginDll parameter in Registry, which can be used to execute code in context of the DNS server (restart required)"
dispatch.earliest_time = -24h@h
alert.track = 0

[DNS ServerLevelPluginDll Install - sysmon]
description = Detects the installation of a plugin DLL via ServerLevelPluginDll parameter in Registry, which can be used to execute code in context of the DNS server (restart required)
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\dnscmd.exe" CommandLine="*/config*" CommandLine="*/serverlevelplugindll*")) | table EventCode,CommandLine,ParentCommandLine,Image,User,TargetObject | eval sigma_attack_tags="attack.defense_evasion attack.t1574.002 attack.t1112" | eval sigma_title="DNS ServerLevelPluginDll Install" | eval sigma_description="Detects the installation of a plugin DLL via ServerLevelPluginDll parameter in Registry, which can be used to execute code in context of the DNS server (restart required)"
dispatch.earliest_time = -24h@h
alert.track = 0

[DNSCat2 Powershell Implementation Detection Via Process Creation - winevent]
description = The PowerShell implementation of DNSCat2 calls nslookup to craft queries. Counting nslookup processes spawned by PowerShell will show hundreds or thousands of instances if PS DNSCat2 is active locally.
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (Creator_Process_Name="*\\powershell.exe" OR Creator_Process_Name="*\\pwsh.exe") New_Process_Name="*\\nslookup.exe" Process_Command_Line="*\\nslookup.exe")) | eventstats dc(New_Process_Name) as val by Creator_Process_Name | search val > 100 | table New_Process_Name,Process_Command_Line,Creator_Process_Name | eval sigma_attack_tags="attack.command_and_control attack.t1071 attack.t1071.004 attack.t1001.003 attack.t1041" | eval sigma_title="DNSCat2 Powershell Implementation Detection Via Process Creation" | eval sigma_description="The PowerShell implementation of DNSCat2 calls nslookup to craft queries. Counting nslookup processes spawned by PowerShell will show hundreds or thousands of instances if PS DNSCat2 is active locally."
dispatch.earliest_time = -24h@h
alert.track = 0

[DNSCat2 Powershell Implementation Detection Via Process Creation - sysmon]
description = The PowerShell implementation of DNSCat2 calls nslookup to craft queries. Counting nslookup processes spawned by PowerShell will show hundreds or thousands of instances if PS DNSCat2 is active locally.
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (ParentImage="*\\powershell.exe" OR ParentImage="*\\pwsh.exe") Image="*\\nslookup.exe" CommandLine="*\\nslookup.exe")) | eventstats dc(Image) as val by ParentImage | search val > 100 | table Image,CommandLine,ParentImage | eval sigma_attack_tags="attack.command_and_control attack.t1071 attack.t1071.004 attack.t1001.003 attack.t1041" | eval sigma_title="DNSCat2 Powershell Implementation Detection Via Process Creation" | eval sigma_description="The PowerShell implementation of DNSCat2 calls nslookup to craft queries. Counting nslookup processes spawned by PowerShell will show hundreds or thousands of instances if PS DNSCat2 is active locally."
dispatch.earliest_time = -24h@h
alert.track = 0

[Discovery/Execution via dnscmd.exe - winevent]
description = Detects an attempt to add a potentially crafted DLL as a plug in of the DNS Service.
Detects an attempt to leverage dnscmd.exe to enumerate the DNS zones of a domain.
DNS zones used to host the DNS records for a particular domain

search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) New_Process_Name="*\\dnscmd.exe" ((Process_Command_Line="*/enumrecords*" OR Process_Command_Line="*/enumzones*" OR Process_Command_Line="*/ZonePrint*" OR Process_Command_Line="*/info*") OR ((Process_Command_Line="*/config*" Process_Command_Line="*/serverlevelplugindll*"))))) | eval sigma_attack_tags="attack.discovery attack.execution attack.t1543.003" | eval sigma_title="Discovery/Execution via dnscmd.exe" | eval sigma_description="Detects an attempt to add a potentially crafted DLL as a plug in of the DNS Service.
Detects an attempt to leverage dnscmd.exe to enumerate the DNS zones of a domain.
DNS zones used to host the DNS records for a particular domain
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Discovery/Execution via dnscmd.exe - sysmon]
description = Detects an attempt to add a potentially crafted DLL as a plug in of the DNS Service.
Detects an attempt to leverage dnscmd.exe to enumerate the DNS zones of a domain.
DNS zones used to host the DNS records for a particular domain

search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) Image="*\\dnscmd.exe" ((CommandLine="*/enumrecords*" OR CommandLine="*/enumzones*" OR CommandLine="*/ZonePrint*" OR CommandLine="*/info*") OR ((CommandLine="*/config*" CommandLine="*/serverlevelplugindll*"))))) | eval sigma_attack_tags="attack.discovery attack.execution attack.t1543.003" | eval sigma_title="Discovery/Execution via dnscmd.exe" | eval sigma_description="Detects an attempt to add a potentially crafted DLL as a plug in of the DNS Service.
Detects an attempt to leverage dnscmd.exe to enumerate the DNS zones of a domain.
DNS zones used to host the DNS records for a particular domain
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Dotnet.exe Exec Dll and Execute Unsigned Code LOLBIN - winevent]
description = dotnet.exe will execute any DLL and execute unsigned code
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (Process_Command_Line="*.dll" OR Process_Command_Line="*.csproj") New_Process_Name="*\\dotnet.exe")) | table ComputerName,Account_Name,Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.execution attack.t1218" | eval sigma_title="Dotnet.exe Exec Dll and Execute Unsigned Code LOLBIN" | eval sigma_description="dotnet.exe will execute any DLL and execute unsigned code"
dispatch.earliest_time = -24h@h
alert.track = 0

[Dotnet.exe Exec Dll and Execute Unsigned Code LOLBIN - sysmon]
description = dotnet.exe will execute any DLL and execute unsigned code
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (CommandLine="*.dll" OR CommandLine="*.csproj") Image="*\\dotnet.exe")) | table ComputerName,User,CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.execution attack.t1218" | eval sigma_title="Dotnet.exe Exec Dll and Execute Unsigned Code LOLBIN" | eval sigma_description="dotnet.exe will execute any DLL and execute unsigned code"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Double File Extention in ParentCommandLine - winevent]
description = Detect execution of suspicious double extension files in ParentCommandLine
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (ParentCommandLine="*.doc.lnk*" OR ParentCommandLine="*.docx.lnk*" OR ParentCommandLine="*.xls.lnk*" OR ParentCommandLine="*.xlsx.lnk*" OR ParentCommandLine="*.ppt.lnk*" OR ParentCommandLine="*.pptx.lnk*" OR ParentCommandLine="*.rtf.lnk*" OR ParentCommandLine="*.pdf.lnk*" OR ParentCommandLine="*.txt.lnk*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1036.007" | eval sigma_title="Suspicious Double File Extention in ParentCommandLine" | eval sigma_description="Detect execution of suspicious double extension files in ParentCommandLine"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Double File Extention in ParentCommandLine - sysmon]
description = Detect execution of suspicious double extension files in ParentCommandLine
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (ParentCommandLine="*.doc.lnk*" OR ParentCommandLine="*.docx.lnk*" OR ParentCommandLine="*.xls.lnk*" OR ParentCommandLine="*.xlsx.lnk*" OR ParentCommandLine="*.ppt.lnk*" OR ParentCommandLine="*.pptx.lnk*" OR ParentCommandLine="*.rtf.lnk*" OR ParentCommandLine="*.pdf.lnk*" OR ParentCommandLine="*.txt.lnk*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1036.007" | eval sigma_title="Suspicious Double File Extention in ParentCommandLine" | eval sigma_description="Detect execution of suspicious double extension files in ParentCommandLine"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential Recon Activity Using DriverQuery.EXE - winevent]
description = Detect usage of the 'driverquery' utility to perform reconnaissance on installed drivers
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*driverquery.exe" OR OriginalFileName="drvqry.exe") ((Creator_Process_Name="*\\cmd.exe" OR Creator_Process_Name="*\\powershell.exe" OR Creator_Process_Name="*\\pwsh.exe" OR Creator_Process_Name="*\\wscript.exe" OR Creator_Process_Name="*\\cscript.exe" OR Creator_Process_Name="*\\mshta.exe") OR (Creator_Process_Name="*\\AppData\\Local\\*" OR Creator_Process_Name="*\\Users\\Public\\*" OR Creator_Process_Name="*\\Windows\\Temp\\*")))) | eval sigma_attack_tags="attack.discovery" | eval sigma_title="Potential Recon Activity Using DriverQuery.EXE" | eval sigma_description="Detect usage of the 'driverquery' utility to perform reconnaissance on installed drivers"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential Recon Activity Using DriverQuery.EXE - sysmon]
description = Detect usage of the 'driverquery' utility to perform reconnaissance on installed drivers
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*driverquery.exe" OR OriginalFileName="drvqry.exe") ((ParentImage="*\\cmd.exe" OR ParentImage="*\\powershell.exe" OR ParentImage="*\\pwsh.exe" OR ParentImage="*\\wscript.exe" OR ParentImage="*\\cscript.exe" OR ParentImage="*\\mshta.exe") OR (ParentImage="*\\AppData\\Local\\*" OR ParentImage="*\\Users\\Public\\*" OR ParentImage="*\\Windows\\Temp\\*")))) | eval sigma_attack_tags="attack.discovery" | eval sigma_title="Potential Recon Activity Using DriverQuery.EXE" | eval sigma_description="Detect usage of the 'driverquery' utility to perform reconnaissance on installed drivers"
dispatch.earliest_time = -24h@h
alert.track = 0

[DriverQuery.EXE Usage - winevent]
description = Detect usage of the 'driverquery' utility. Which can be used to perform reconnaissance on installed drivers
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*driverquery.exe" OR OriginalFileName="drvqry.exe"))) | eval sigma_attack_tags="attack.discovery" | eval sigma_title="DriverQuery.EXE Usage" | eval sigma_description="Detect usage of the 'driverquery' utility. Which can be used to perform reconnaissance on installed drivers"
dispatch.earliest_time = -24h@h
alert.track = 0

[DriverQuery.EXE Usage - sysmon]
description = Detect usage of the 'driverquery' utility. Which can be used to perform reconnaissance on installed drivers
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*driverquery.exe" OR OriginalFileName="drvqry.exe"))) | eval sigma_attack_tags="attack.discovery" | eval sigma_title="DriverQuery.EXE Usage" | eval sigma_description="Detect usage of the 'driverquery' utility. Which can be used to perform reconnaissance on installed drivers"
dispatch.earliest_time = -24h@h
alert.track = 0

[Abusing Permissions Using Dsacls - winevent]
description = Detects usage of Dsacls to grant over permissive permissions
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\dsacls.exe" OR OriginalFileName="DSACLS.EXE") Process_Command_Line="* /G *" (Process_Command_Line="*GR*" OR Process_Command_Line="*GE*" OR Process_Command_Line="*GW*" OR Process_Command_Line="*GA*" OR Process_Command_Line="*WP*" OR Process_Command_Line="*WD*"))) | eval sigma_attack_tags="attack.execution attack.t1218" | eval sigma_title="Abusing Permissions Using Dsacls" | eval sigma_description="Detects usage of Dsacls to grant over permissive permissions"
dispatch.earliest_time = -24h@h
alert.track = 0

[Abusing Permissions Using Dsacls - sysmon]
description = Detects usage of Dsacls to grant over permissive permissions
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\dsacls.exe" OR OriginalFileName="DSACLS.EXE") CommandLine="* /G *" (CommandLine="*GR*" OR CommandLine="*GE*" OR CommandLine="*GW*" OR CommandLine="*GA*" OR CommandLine="*WP*" OR CommandLine="*WD*"))) | eval sigma_attack_tags="attack.execution attack.t1218" | eval sigma_title="Abusing Permissions Using Dsacls" | eval sigma_description="Detects usage of Dsacls to grant over permissive permissions"
dispatch.earliest_time = -24h@h
alert.track = 0

[Password Spraying Attempts Using Dsacls - winevent]
description = Detects possible password spraying attempts using Dsacls
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\dsacls.exe" OR OriginalFileName="DSACLS.EXE") ((Process_Command_Line="*/user:*" Process_Command_Line="*/passwd:*")))) | eval sigma_attack_tags="attack.execution attack.t1218" | eval sigma_title="Password Spraying Attempts Using Dsacls" | eval sigma_description="Detects possible password spraying attempts using Dsacls"
dispatch.earliest_time = -24h@h
alert.track = 0

[Password Spraying Attempts Using Dsacls - sysmon]
description = Detects possible password spraying attempts using Dsacls
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\dsacls.exe" OR OriginalFileName="DSACLS.EXE") ((CommandLine="*/user:*" CommandLine="*/passwd:*")))) | eval sigma_attack_tags="attack.execution attack.t1218" | eval sigma_title="Password Spraying Attempts Using Dsacls" | eval sigma_description="Detects possible password spraying attempts using Dsacls"
dispatch.earliest_time = -24h@h
alert.track = 0

[DumpStack.log Defender Evasion - winevent]
description = Detects the use of the filename DumpStack.log to evade Microsoft Defender
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\DumpStack.log" OR Process_Command_Line="* -o DumpStack.log*"))) | eval sigma_attack_tags="attack.defense_evasion" | eval sigma_title="DumpStack.log Defender Evasion" | eval sigma_description="Detects the use of the filename DumpStack.log to evade Microsoft Defender"
dispatch.earliest_time = -24h@h
alert.track = 0

[DumpStack.log Defender Evasion - sysmon]
description = Detects the use of the filename DumpStack.log to evade Microsoft Defender
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\DumpStack.log" OR CommandLine="* -o DumpStack.log*"))) | eval sigma_attack_tags="attack.defense_evasion" | eval sigma_title="DumpStack.log Defender Evasion" | eval sigma_description="Detects the use of the filename DumpStack.log to evade Microsoft Defender"
dispatch.earliest_time = -24h@h
alert.track = 0

[Email Exifiltration Via Powershell - winevent]
description = Detects email exfiltration via powershell cmdlets
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (New_Process_Name="*\\powershell.exe" OR New_Process_Name="*\\pwsh.exe") Process_Command_Line="*Add-PSSnapin*" Process_Command_Line="*Get-Recipient*" Process_Command_Line="*-ExpandProperty*" Process_Command_Line="*EmailAddresses*" Process_Command_Line="*SmtpAddress*" Process_Command_Line="*-hidetableheaders*")) | eval sigma_attack_tags="attack.exfiltration" | eval sigma_title="Email Exifiltration Via Powershell" | eval sigma_description="Detects email exfiltration via powershell cmdlets"
dispatch.earliest_time = -24h@h
alert.track = 0

[Email Exifiltration Via Powershell - sysmon]
description = Detects email exfiltration via powershell cmdlets
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (Image="*\\powershell.exe" OR Image="*\\pwsh.exe") CommandLine="*Add-PSSnapin*" CommandLine="*Get-Recipient*" CommandLine="*-ExpandProperty*" CommandLine="*EmailAddresses*" CommandLine="*SmtpAddress*" CommandLine="*-hidetableheaders*")) | eval sigma_attack_tags="attack.exfiltration" | eval sigma_title="Email Exifiltration Via Powershell" | eval sigma_description="Detects email exfiltration via powershell cmdlets"
dispatch.earliest_time = -24h@h
alert.track = 0

[Hidden Powershell in Link File Pattern - winevent]
description = Detects events that appear when a user click on a link file with a powershell command in it
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Creator_Process_Name="C:\\Windows\\explorer.exe" New_Process_Name="C:\\Windows\\System32\\cmd.exe" Process_Command_Line="*powershell*" Process_Command_Line="*.lnk*")) | eval sigma_attack_tags="attack.execution attack.t1059.001" | eval sigma_title="Hidden Powershell in Link File Pattern" | eval sigma_description="Detects events that appear when a user click on a link file with a powershell command in it"
dispatch.earliest_time = -24h@h
alert.track = 0

[Hidden Powershell in Link File Pattern - sysmon]
description = Detects events that appear when a user click on a link file with a powershell command in it
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") ParentImage="C:\\Windows\\explorer.exe" Image="C:\\Windows\\System32\\cmd.exe" CommandLine="*powershell*" CommandLine="*.lnk*")) | eval sigma_attack_tags="attack.execution attack.t1059.001" | eval sigma_title="Hidden Powershell in Link File Pattern" | eval sigma_description="Detects events that appear when a user click on a link file with a powershell command in it"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential Suspicious Windows Feature Enabled - ProcCreation - winevent]
description = Detects usage of the built-in PowerShell cmdlet 'Enable-WindowsOptionalFeature' used as a Deployment Image Servicing and Management tool.
Similar to DISM.exe, this cmdlet is used to enumerate, install, uninstall, configure, and update features and packages in Windows images

search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*Enable-WindowsOptionalFeature*" Process_Command_Line="*-Online*" Process_Command_Line="*-FeatureName*" (Process_Command_Line="*TelnetServer*" OR Process_Command_Line="*Internet-Explorer-Optional-amd64*" OR Process_Command_Line="*TFTP*" OR Process_Command_Line="*SMB1Protocol*" OR Process_Command_Line="*Client-ProjFS*" OR Process_Command_Line="*Microsoft-Windows-Subsystem-Linux*"))) | eval sigma_attack_tags="attack.defense_evasion" | eval sigma_title="Potential Suspicious Windows Feature Enabled - ProcCreation" | eval sigma_description="Detects usage of the built-in PowerShell cmdlet 'Enable-WindowsOptionalFeature' used as a Deployment Image Servicing and Management tool.
Similar to DISM.exe, this cmdlet is used to enumerate, install, uninstall, configure, and update features and packages in Windows images
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential Suspicious Windows Feature Enabled - ProcCreation - sysmon]
description = Detects usage of the built-in PowerShell cmdlet 'Enable-WindowsOptionalFeature' used as a Deployment Image Servicing and Management tool.
Similar to DISM.exe, this cmdlet is used to enumerate, install, uninstall, configure, and update features and packages in Windows images

search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*Enable-WindowsOptionalFeature*" CommandLine="*-Online*" CommandLine="*-FeatureName*" (CommandLine="*TelnetServer*" OR CommandLine="*Internet-Explorer-Optional-amd64*" OR CommandLine="*TFTP*" OR CommandLine="*SMB1Protocol*" OR CommandLine="*Client-ProjFS*" OR CommandLine="*Microsoft-Windows-Subsystem-Linux*"))) | eval sigma_attack_tags="attack.defense_evasion" | eval sigma_title="Potential Suspicious Windows Feature Enabled - ProcCreation" | eval sigma_description="Detects usage of the built-in PowerShell cmdlet 'Enable-WindowsOptionalFeature' used as a Deployment Image Servicing and Management tool.
Similar to DISM.exe, this cmdlet is used to enumerate, install, uninstall, configure, and update features and packages in Windows images
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Enumeration for 3rd Party Creds From CLI - winevent]
description = Detects processes that query known 3rd party registry keys that holds credentials via commandline
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (Process_Command_Line="*\\Software\\SimonTatham\\PuTTY\\Sessions*" OR Process_Command_Line="*\\Software\\SimonTatham\\PuTTY\\SshHostKeys\\*" OR Process_Command_Line="*\\Software\\Mobatek\\MobaXterm\\*" OR Process_Command_Line="*\\Software\\WOW6432Node\\Radmin\\v3.0\\Server\\Parameters\\Radmin*" OR Process_Command_Line="*\\Software\\Aerofox\\FoxmailPreview*" OR Process_Command_Line="*\\Software\\Aerofox\\Foxmail\\V3.1*" OR Process_Command_Line="*\\Software\\IncrediMail\\Identities*" OR Process_Command_Line="*\\Software\\Qualcomm\\Eudora\\CommandLine*" OR Process_Command_Line="*\\Software\\RimArts\\B2\\Settings*" OR Process_Command_Line="*\\Software\\OpenVPN-GUI\\configs*" OR Process_Command_Line="*\\Software\\Martin Prikryl\\WinSCP 2\\Sessions*" OR Process_Command_Line="*\\Software\\FTPWare\\COREFTP\\Sites*" OR Process_Command_Line="*\\Software\\DownloadManager\\Passwords*" OR Process_Command_Line="*\\Software\\OpenSSH\\Agent\\Keys*" OR Process_Command_Line="*\\Software\\TightVNC\\Server*" OR Process_Command_Line="*\\Software\\ORL\\WinVNC3\\Password*" OR Process_Command_Line="*\\Software\\RealVNC\\WinVNC4*"))) | eval sigma_attack_tags="attack.credential_access attack.t1552.002" | eval sigma_title="Enumeration for 3rd Party Creds From CLI" | eval sigma_description="Detects processes that query known 3rd party registry keys that holds credentials via commandline"
dispatch.earliest_time = -24h@h
alert.track = 0

[Enumeration for 3rd Party Creds From CLI - sysmon]
description = Detects processes that query known 3rd party registry keys that holds credentials via commandline
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (CommandLine="*\\Software\\SimonTatham\\PuTTY\\Sessions*" OR CommandLine="*\\Software\\SimonTatham\\PuTTY\\SshHostKeys\\*" OR CommandLine="*\\Software\\Mobatek\\MobaXterm\\*" OR CommandLine="*\\Software\\WOW6432Node\\Radmin\\v3.0\\Server\\Parameters\\Radmin*" OR CommandLine="*\\Software\\Aerofox\\FoxmailPreview*" OR CommandLine="*\\Software\\Aerofox\\Foxmail\\V3.1*" OR CommandLine="*\\Software\\IncrediMail\\Identities*" OR CommandLine="*\\Software\\Qualcomm\\Eudora\\CommandLine*" OR CommandLine="*\\Software\\RimArts\\B2\\Settings*" OR CommandLine="*\\Software\\OpenVPN-GUI\\configs*" OR CommandLine="*\\Software\\Martin Prikryl\\WinSCP 2\\Sessions*" OR CommandLine="*\\Software\\FTPWare\\COREFTP\\Sites*" OR CommandLine="*\\Software\\DownloadManager\\Passwords*" OR CommandLine="*\\Software\\OpenSSH\\Agent\\Keys*" OR CommandLine="*\\Software\\TightVNC\\Server*" OR CommandLine="*\\Software\\ORL\\WinVNC3\\Password*" OR CommandLine="*\\Software\\RealVNC\\WinVNC4*"))) | eval sigma_attack_tags="attack.credential_access attack.t1552.002" | eval sigma_title="Enumeration for 3rd Party Creds From CLI" | eval sigma_description="Detects processes that query known 3rd party registry keys that holds credentials via commandline"
dispatch.earliest_time = -24h@h
alert.track = 0

[Enumeration for Credentials in Registry - winevent]
description = Adversaries may search the Registry on compromised systems for insecurely stored credentials.
The Windows Registry stores configuration information that can be used by the system or other programs.
Adversaries may query the Registry looking for credentials and passwords that have been stored for use by other programs or services

search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\reg.exe" Process_Command_Line="* query *" Process_Command_Line="*/t *" Process_Command_Line="*REG_SZ*" Process_Command_Line="*/s*")) (((Process_Command_Line="*/f *" Process_Command_Line="*HKLM*")) OR ((Process_Command_Line="*/f *" Process_Command_Line="*HKCU*")) OR Process_Command_Line="*HKCU\\Software\\SimonTatham\\PuTTY\\Sessions*"))) | eval sigma_attack_tags="attack.credential_access attack.t1552.002" | eval sigma_title="Enumeration for Credentials in Registry" | eval sigma_description="Adversaries may search the Registry on compromised systems for insecurely stored credentials.
The Windows Registry stores configuration information that can be used by the system or other programs.
Adversaries may query the Registry looking for credentials and passwords that have been stored for use by other programs or services
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Enumeration for Credentials in Registry - sysmon]
description = Adversaries may search the Registry on compromised systems for insecurely stored credentials.
The Windows Registry stores configuration information that can be used by the system or other programs.
Adversaries may query the Registry looking for credentials and passwords that have been stored for use by other programs or services

search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\reg.exe" CommandLine="* query *" CommandLine="*/t *" CommandLine="*REG_SZ*" CommandLine="*/s*")) (((CommandLine="*/f *" CommandLine="*HKLM*")) OR ((CommandLine="*/f *" CommandLine="*HKCU*")) OR CommandLine="*HKCU\\Software\\SimonTatham\\PuTTY\\Sessions*"))) | eval sigma_attack_tags="attack.credential_access attack.t1552.002" | eval sigma_title="Enumeration for Credentials in Registry" | eval sigma_description="Adversaries may search the Registry on compromised systems for insecurely stored credentials.
The Windows Registry stores configuration information that can be used by the system or other programs.
Adversaries may query the Registry looking for credentials and passwords that have been stored for use by other programs or services
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Esentutl Steals Browser Information - winevent]
description = One way Qbot steals sensitive information is by extracting browser data from Internet Explorer and Microsoft Edge by using the built-in utility esentutl.exe
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\esentutl.exe" OR OriginalFileName="esentutl.exe") (Process_Command_Line="*/r*" OR Process_Command_Line="*-r*") Process_Command_Line="*\\Windows\\WebCache*")) | eval sigma_attack_tags="attack.collection attack.t1005" | eval sigma_title="Esentutl Steals Browser Information" | eval sigma_description="One way Qbot steals sensitive information is by extracting browser data from Internet Explorer and Microsoft Edge by using the built-in utility esentutl.exe"
dispatch.earliest_time = -24h@h
alert.track = 0

[Esentutl Steals Browser Information - sysmon]
description = One way Qbot steals sensitive information is by extracting browser data from Internet Explorer and Microsoft Edge by using the built-in utility esentutl.exe
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\esentutl.exe" OR OriginalFileName="esentutl.exe") (CommandLine="*/r*" OR CommandLine="*-r*") CommandLine="*\\Windows\\WebCache*")) | eval sigma_attack_tags="attack.collection attack.t1005" | eval sigma_title="Esentutl Steals Browser Information" | eval sigma_description="One way Qbot steals sensitive information is by extracting browser data from Internet Explorer and Microsoft Edge by using the built-in utility esentutl.exe"
dispatch.earliest_time = -24h@h
alert.track = 0

[ETW Logging Tamper In .NET Processes - winevent]
description = Detects changes to environment variables related to ETW logging. This could indicate potential adversaries stopping ETW providers recording loaded .NET assemblies.
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (Process_Command_Line="*COMPlus_ETWEnabled*" OR Process_Command_Line="*COMPlus_ETWFlags*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1562" | eval sigma_title="ETW Logging Tamper In .NET Processes" | eval sigma_description="Detects changes to environment variables related to ETW logging. This could indicate potential adversaries stopping ETW providers recording loaded .NET assemblies."
dispatch.earliest_time = -24h@h
alert.track = 0

[ETW Logging Tamper In .NET Processes - sysmon]
description = Detects changes to environment variables related to ETW logging. This could indicate potential adversaries stopping ETW providers recording loaded .NET assemblies.
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (CommandLine="*COMPlus_ETWEnabled*" OR CommandLine="*COMPlus_ETWFlags*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1562" | eval sigma_title="ETW Logging Tamper In .NET Processes" | eval sigma_description="Detects changes to environment variables related to ETW logging. This could indicate potential adversaries stopping ETW providers recording loaded .NET assemblies."
dispatch.earliest_time = -24h@h
alert.track = 0

[Disable of ETW Trace - winevent]
description = Detects a command that clears or disables any ETW trace log which could indicate a logging evasion.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((Process_Command_Line="*cl*" Process_Command_Line="*/Trace*")) OR ((Process_Command_Line="*clear-log*" Process_Command_Line="*/Trace*")) OR ((Process_Command_Line="*sl*" Process_Command_Line="*/e:false*")) OR ((Process_Command_Line="*set-log*" Process_Command_Line="*/e:false*")) OR ((Process_Command_Line="*logman*" Process_Command_Line="*update*" Process_Command_Line="*trace*" Process_Command_Line="*--p*" Process_Command_Line="*-ets*")) OR Process_Command_Line="*Remove-EtwTraceProvider*" OR ((Process_Command_Line="*Set-EtwTraceProvider*" Process_Command_Line="*0x11*"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1070 attack.t1562.006 car.2016-04-002" | eval sigma_title="Disable of ETW Trace" | eval sigma_description="Detects a command that clears or disables any ETW trace log which could indicate a logging evasion."
dispatch.earliest_time = -24h@h
alert.track = 0

[Disable of ETW Trace - sysmon]
description = Detects a command that clears or disables any ETW trace log which could indicate a logging evasion.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((CommandLine="*cl*" CommandLine="*/Trace*")) OR ((CommandLine="*clear-log*" CommandLine="*/Trace*")) OR ((CommandLine="*sl*" CommandLine="*/e:false*")) OR ((CommandLine="*set-log*" CommandLine="*/e:false*")) OR ((CommandLine="*logman*" CommandLine="*update*" CommandLine="*trace*" CommandLine="*--p*" CommandLine="*-ets*")) OR CommandLine="*Remove-EtwTraceProvider*" OR ((CommandLine="*Set-EtwTraceProvider*" CommandLine="*0x11*"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1070 attack.t1562.006 car.2016-04-002" | eval sigma_title="Disable of ETW Trace" | eval sigma_description="Detects a command that clears or disables any ETW trace log which could indicate a logging evasion."
dispatch.earliest_time = -24h@h
alert.track = 0

[Execution via MSSQL Xp_cmdshell Stored Procedure - winevent]
description = Detects execution via MSSQL xp_cmdshell stored procedure. Malicious users may attempt to elevate their privileges by using xp_cmdshell, which is disabled by default.
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\cmd.exe" Creator_Process_Name="*\\sqlservr.exe")) | eval sigma_attack_tags="attack.execution attack.t1059" | eval sigma_title="Execution via MSSQL Xp_cmdshell Stored Procedure" | eval sigma_description="Detects execution via MSSQL xp_cmdshell stored procedure. Malicious users may attempt to elevate their privileges by using xp_cmdshell, which is disabled by default."
dispatch.earliest_time = -24h@h
alert.track = 0

[Execution via MSSQL Xp_cmdshell Stored Procedure - sysmon]
description = Detects execution via MSSQL xp_cmdshell stored procedure. Malicious users may attempt to elevate their privileges by using xp_cmdshell, which is disabled by default.
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\cmd.exe" ParentImage="*\\sqlservr.exe")) | eval sigma_attack_tags="attack.execution attack.t1059" | eval sigma_title="Execution via MSSQL Xp_cmdshell Stored Procedure" | eval sigma_description="Detects execution via MSSQL xp_cmdshell stored procedure. Malicious users may attempt to elevate their privileges by using xp_cmdshell, which is disabled by default."
dispatch.earliest_time = -24h@h
alert.track = 0

[Possible Exfiltration Of Data Via CLI - winevent]
description = Detects the use of various cli utility related to web request exfiltrating data
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((((New_Process_Name="*\\powershell.exe" OR New_Process_Name="*\\pwsh.exe" OR New_Process_Name="*\\cmd.exe") (Process_Command_Line="*Invoke-WebRequest*" OR Process_Command_Line="*iwr *" OR Process_Command_Line="*wget *" OR Process_Command_Line="*curl *") Process_Command_Line="* -ur*" Process_Command_Line="* -me*" Process_Command_Line="* -b*" Process_Command_Line="* POST *")) OR ((New_Process_Name="*\\curl.exe" Process_Command_Line="*--ur*" (Process_Command_Line="* -d *" OR Process_Command_Line="* --data *")))) ((Process_Command_Line="*ToBase64String*" OR Process_Command_Line="*whoami*" OR Process_Command_Line="*nltest*" OR Process_Command_Line="*ifconfig*" OR Process_Command_Line="*hostname*" OR Process_Command_Line="*net view*" OR Process_Command_Line="*qprocess*" OR Process_Command_Line="*netstat*" OR Process_Command_Line="*systeminfo*" OR Process_Command_Line="*tasklist*" OR Process_Command_Line="*sc query*") OR ((Process_Command_Line="*type *" Process_Command_Line="* > *" Process_Command_Line="* C:\\*"))))) | eval sigma_attack_tags="attack.execution attack.t1059.001" | eval sigma_title="Possible Exfiltration Of Data Via CLI" | eval sigma_description="Detects the use of various cli utility related to web request exfiltrating data"
dispatch.earliest_time = -24h@h
alert.track = 0

[Possible Exfiltration Of Data Via CLI - sysmon]
description = Detects the use of various cli utility related to web request exfiltrating data
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((((Image="*\\powershell.exe" OR Image="*\\pwsh.exe" OR Image="*\\cmd.exe") (CommandLine="*Invoke-WebRequest*" OR CommandLine="*iwr *" OR CommandLine="*wget *" OR CommandLine="*curl *") CommandLine="* -ur*" CommandLine="* -me*" CommandLine="* -b*" CommandLine="* POST *")) OR ((Image="*\\curl.exe" CommandLine="*--ur*" (CommandLine="* -d *" OR CommandLine="* --data *")))) ((CommandLine="*ToBase64String*" OR CommandLine="*whoami*" OR CommandLine="*nltest*" OR CommandLine="*ifconfig*" OR CommandLine="*hostname*" OR CommandLine="*net view*" OR CommandLine="*qprocess*" OR CommandLine="*netstat*" OR CommandLine="*systeminfo*" OR CommandLine="*tasklist*" OR CommandLine="*sc query*") OR ((CommandLine="*type *" CommandLine="* > *" CommandLine="* C:\\*"))))) | eval sigma_attack_tags="attack.execution attack.t1059.001" | eval sigma_title="Possible Exfiltration Of Data Via CLI" | eval sigma_description="Detects the use of various cli utility related to web request exfiltrating data"
dispatch.earliest_time = -24h@h
alert.track = 0

[Exfiltration and Tunneling Tools Execution - winevent]
description = Execution of well known tools for data exfiltration and tunneling
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (New_Process_Name="*\\plink.exe" OR New_Process_Name="*\\socat.exe" OR New_Process_Name="*\\stunnel.exe" OR New_Process_Name="*\\httptunnel.exe"))) | eval sigma_attack_tags="attack.exfiltration attack.command_and_control attack.t1041 attack.t1572 attack.t1071.001" | eval sigma_title="Exfiltration and Tunneling Tools Execution" | eval sigma_description="Execution of well known tools for data exfiltration and tunneling"
dispatch.earliest_time = -24h@h
alert.track = 0

[Exfiltration and Tunneling Tools Execution - sysmon]
description = Execution of well known tools for data exfiltration and tunneling
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (Image="*\\plink.exe" OR Image="*\\socat.exe" OR Image="*\\stunnel.exe" OR Image="*\\httptunnel.exe"))) | eval sigma_attack_tags="attack.exfiltration attack.command_and_control attack.t1041 attack.t1572 attack.t1071.001" | eval sigma_title="Exfiltration and Tunneling Tools Execution" | eval sigma_description="Execution of well known tools for data exfiltration and tunneling"
dispatch.earliest_time = -24h@h
alert.track = 0

[Cabinet File Expansion - winevent]
description = Adversaries can use the inbuilt expand utility to decompress cab files as seen in recent Iranian MeteorExpress attack
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\expand.exe" (Process_Command_Line="*.cab*" OR Process_Command_Line="*/F:*" OR Process_Command_Line="*-F:*" OR Process_Command_Line="*C:\\ProgramData\\*" OR Process_Command_Line="*C:\\Public\\*" OR Process_Command_Line="*\\AppData\\Local\\Temp\\*" OR Process_Command_Line="*\\AppData\\Roaming\\Temp\\*"))) NOT (((Creator_Process_Name="C:\\Program Files (x86)\\Dell\\UpdateService\\ServiceShell.exe" Process_Command_Line="*C:\\ProgramData\\Dell\\UpdateService\\Temp\\*"))))) | table ComputerName,Account_Name,Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.execution attack.t1218" | eval sigma_title="Cabinet File Expansion" | eval sigma_description="Adversaries can use the inbuilt expand utility to decompress cab files as seen in recent Iranian MeteorExpress attack"
dispatch.earliest_time = -24h@h
alert.track = 0

[Cabinet File Expansion - sysmon]
description = Adversaries can use the inbuilt expand utility to decompress cab files as seen in recent Iranian MeteorExpress attack
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\expand.exe" (CommandLine="*.cab*" OR CommandLine="*/F:*" OR CommandLine="*-F:*" OR CommandLine="*C:\\ProgramData\\*" OR CommandLine="*C:\\Public\\*" OR CommandLine="*\\AppData\\Local\\Temp\\*" OR CommandLine="*\\AppData\\Roaming\\Temp\\*"))) NOT (((ParentImage="C:\\Program Files (x86)\\Dell\\UpdateService\\ServiceShell.exe" CommandLine="*C:\\ProgramData\\Dell\\UpdateService\\Temp\\*"))))) | table ComputerName,User,CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.execution attack.t1218" | eval sigma_title="Cabinet File Expansion" | eval sigma_description="Adversaries can use the inbuilt expand utility to decompress cab files as seen in recent Iranian MeteorExpress attack"
dispatch.earliest_time = -24h@h
alert.track = 0

[Exploit for CVE-2015-1641 - winevent]
description = Detects Winword starting uncommon sub process MicroScMgmt.exe as used in exploits for CVE-2015-1641
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Creator_Process_Name="*\\WINWORD.EXE" New_Process_Name="*\\MicroScMgmt.exe")) | eval sigma_attack_tags="attack.defense_evasion attack.t1036.005" | eval sigma_title="Exploit for CVE-2015-1641" | eval sigma_description="Detects Winword starting uncommon sub process MicroScMgmt.exe as used in exploits for CVE-2015-1641"
dispatch.earliest_time = -24h@h
alert.track = 0

[Exploit for CVE-2015-1641 - sysmon]
description = Detects Winword starting uncommon sub process MicroScMgmt.exe as used in exploits for CVE-2015-1641
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") ParentImage="*\\WINWORD.EXE" Image="*\\MicroScMgmt.exe")) | eval sigma_attack_tags="attack.defense_evasion attack.t1036.005" | eval sigma_title="Exploit for CVE-2015-1641" | eval sigma_description="Detects Winword starting uncommon sub process MicroScMgmt.exe as used in exploits for CVE-2015-1641"
dispatch.earliest_time = -24h@h
alert.track = 0

[Exploit for CVE-2017-0261 - winevent]
description = Detects Winword starting uncommon sub process FLTLDR.exe as used in exploits for CVE-2017-0261 and CVE-2017-0262
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Creator_Process_Name="*\\WINWORD.EXE" New_Process_Name="*\\FLTLDR.exe*")) | eval sigma_attack_tags="attack.execution attack.t1203 attack.t1204.002 attack.initial_access attack.t1566.001" | eval sigma_title="Exploit for CVE-2017-0261" | eval sigma_description="Detects Winword starting uncommon sub process FLTLDR.exe as used in exploits for CVE-2017-0261 and CVE-2017-0262"
dispatch.earliest_time = -24h@h
alert.track = 0

[Exploit for CVE-2017-0261 - sysmon]
description = Detects Winword starting uncommon sub process FLTLDR.exe as used in exploits for CVE-2017-0261 and CVE-2017-0262
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") ParentImage="*\\WINWORD.EXE" Image="*\\FLTLDR.exe*")) | eval sigma_attack_tags="attack.execution attack.t1203 attack.t1204.002 attack.initial_access attack.t1566.001" | eval sigma_title="Exploit for CVE-2017-0261" | eval sigma_description="Detects Winword starting uncommon sub process FLTLDR.exe as used in exploits for CVE-2017-0261 and CVE-2017-0262"
dispatch.earliest_time = -24h@h
alert.track = 0

[Droppers Exploiting CVE-2017-11882 - winevent]
description = Detects exploits that use CVE-2017-11882 to start EQNEDT32.EXE and other sub processes like mshta.exe
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Creator_Process_Name="*\\EQNEDT32.EXE")) | table Process_Command_Line | eval sigma_attack_tags="attack.execution attack.t1203 attack.t1204.002 attack.initial_access attack.t1566.001" | eval sigma_title="Droppers Exploiting CVE-2017-11882" | eval sigma_description="Detects exploits that use CVE-2017-11882 to start EQNEDT32.EXE and other sub processes like mshta.exe"
dispatch.earliest_time = -24h@h
alert.track = 0

[Droppers Exploiting CVE-2017-11882 - sysmon]
description = Detects exploits that use CVE-2017-11882 to start EQNEDT32.EXE and other sub processes like mshta.exe
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") ParentImage="*\\EQNEDT32.EXE")) | table CommandLine | eval sigma_attack_tags="attack.execution attack.t1203 attack.t1204.002 attack.initial_access attack.t1566.001" | eval sigma_title="Droppers Exploiting CVE-2017-11882" | eval sigma_description="Detects exploits that use CVE-2017-11882 to start EQNEDT32.EXE and other sub processes like mshta.exe"
dispatch.earliest_time = -24h@h
alert.track = 0

[Exploit for CVE-2017-8759 - winevent]
description = Detects Winword starting uncommon sub process csc.exe as used in exploits for CVE-2017-8759
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Creator_Process_Name="*\\WINWORD.EXE" New_Process_Name="*\\csc.exe")) | eval sigma_attack_tags="attack.execution attack.t1203 attack.t1204.002 attack.initial_access attack.t1566.001" | eval sigma_title="Exploit for CVE-2017-8759" | eval sigma_description="Detects Winword starting uncommon sub process csc.exe as used in exploits for CVE-2017-8759"
dispatch.earliest_time = -24h@h
alert.track = 0

[Exploit for CVE-2017-8759 - sysmon]
description = Detects Winword starting uncommon sub process csc.exe as used in exploits for CVE-2017-8759
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") ParentImage="*\\WINWORD.EXE" Image="*\\csc.exe")) | eval sigma_attack_tags="attack.execution attack.t1203 attack.t1204.002 attack.initial_access attack.t1566.001" | eval sigma_title="Exploit for CVE-2017-8759" | eval sigma_description="Detects Winword starting uncommon sub process csc.exe as used in exploits for CVE-2017-8759"
dispatch.earliest_time = -24h@h
alert.track = 0

[Exploiting SetupComplete.cmd CVE-2019-1378 - winevent]
description = Detects exploitation attempt of privilege escalation vulnerability via SetupComplete.cmd and PartnerSetupComplete.cmd described in CVE-2019-1378
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((ParentCommandLine="*\\cmd.exe*" ParentCommandLine="*/c*" ParentCommandLine="*C:\\Windows\\Setup\\Scripts\\*" (ParentCommandLine="*SetupComplete.cmd" OR ParentCommandLine="*PartnerSetupComplete.cmd"))) NOT (((New_Process_Name="C:\\Windows\\System32\\*" OR New_Process_Name="C:\\Windows\\SysWOW64\\*" OR New_Process_Name="C:\\Windows\\WinSxS\\*" OR New_Process_Name="C:\\Windows\\Setup\\*"))))) | eval sigma_attack_tags="attack.privilege_escalation attack.t1068 attack.execution attack.t1059.003 attack.t1574 cve.2019.1378" | eval sigma_title="Exploiting SetupComplete.cmd CVE-2019-1378" | eval sigma_description="Detects exploitation attempt of privilege escalation vulnerability via SetupComplete.cmd and PartnerSetupComplete.cmd described in CVE-2019-1378"
dispatch.earliest_time = -24h@h
alert.track = 0

[Exploiting SetupComplete.cmd CVE-2019-1378 - sysmon]
description = Detects exploitation attempt of privilege escalation vulnerability via SetupComplete.cmd and PartnerSetupComplete.cmd described in CVE-2019-1378
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((ParentCommandLine="*\\cmd.exe*" ParentCommandLine="*/c*" ParentCommandLine="*C:\\Windows\\Setup\\Scripts\\*" (ParentCommandLine="*SetupComplete.cmd" OR ParentCommandLine="*PartnerSetupComplete.cmd"))) NOT (((Image="C:\\Windows\\System32\\*" OR Image="C:\\Windows\\SysWOW64\\*" OR Image="C:\\Windows\\WinSxS\\*" OR Image="C:\\Windows\\Setup\\*"))))) | eval sigma_attack_tags="attack.privilege_escalation attack.t1068 attack.execution attack.t1059.003 attack.t1574 cve.2019.1378" | eval sigma_title="Exploiting SetupComplete.cmd CVE-2019-1378" | eval sigma_description="Detects exploitation attempt of privilege escalation vulnerability via SetupComplete.cmd and PartnerSetupComplete.cmd described in CVE-2019-1378"
dispatch.earliest_time = -24h@h
alert.track = 0

[Exploiting CVE-2019-1388 - winevent]
description = Detects an exploitation attempt in which the UAC consent dialogue is used to invoke an Internet Explorer process running as LOCAL_SYSTEM
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((Creator_Process_Name="*\\consent.exe" New_Process_Name="*\\iexplore.exe" Process_Command_Line="* http*")) (IntegrityLevel="System" OR (Account_Name="*AUTHORI*" OR Account_Name="*AUTORI*")))) | eval sigma_attack_tags="attack.privilege_escalation attack.t1068" | eval sigma_title="Exploiting CVE-2019-1388" | eval sigma_description="Detects an exploitation attempt in which the UAC consent dialogue is used to invoke an Internet Explorer process running as LOCAL_SYSTEM"
dispatch.earliest_time = -24h@h
alert.track = 0

[Exploiting CVE-2019-1388 - sysmon]
description = Detects an exploitation attempt in which the UAC consent dialogue is used to invoke an Internet Explorer process running as LOCAL_SYSTEM
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((ParentImage="*\\consent.exe" Image="*\\iexplore.exe" CommandLine="* http*")) (IntegrityLevel="System" OR (User="*AUTHORI*" OR User="*AUTORI*")))) | eval sigma_attack_tags="attack.privilege_escalation attack.t1068" | eval sigma_title="Exploiting CVE-2019-1388" | eval sigma_description="Detects an exploitation attempt in which the UAC consent dialogue is used to invoke an Internet Explorer process running as LOCAL_SYSTEM"
dispatch.earliest_time = -24h@h
alert.track = 0

[Exploited CVE-2020-10189 Zoho ManageEngine - winevent]
description = Detects the exploitation of Zoho ManageEngine Desktop Central Java Deserialization vulnerability reported as CVE-2020-10189
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Creator_Process_Name="*DesktopCentral_Server\\jre\\bin\\java.exe" (New_Process_Name="*\\cmd.exe" OR New_Process_Name="*\\powershell.exe" OR New_Process_Name="*\\pwsh.exe" OR New_Process_Name="*\\bitsadmin.exe" OR New_Process_Name="*\\systeminfo.exe" OR New_Process_Name="*\\net.exe" OR New_Process_Name="*\\net1.exe" OR New_Process_Name="*\\reg.exe" OR New_Process_Name="*\\query.exe"))) | eval sigma_attack_tags="attack.initial_access attack.t1190 attack.execution attack.t1059.001 attack.t1059.003 attack.s0190 cve.2020.10189" | eval sigma_title="Exploited CVE-2020-10189 Zoho ManageEngine" | eval sigma_description="Detects the exploitation of Zoho ManageEngine Desktop Central Java Deserialization vulnerability reported as CVE-2020-10189"
dispatch.earliest_time = -24h@h
alert.track = 0

[Exploited CVE-2020-10189 Zoho ManageEngine - sysmon]
description = Detects the exploitation of Zoho ManageEngine Desktop Central Java Deserialization vulnerability reported as CVE-2020-10189
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") ParentImage="*DesktopCentral_Server\\jre\\bin\\java.exe" (Image="*\\cmd.exe" OR Image="*\\powershell.exe" OR Image="*\\pwsh.exe" OR Image="*\\bitsadmin.exe" OR Image="*\\systeminfo.exe" OR Image="*\\net.exe" OR Image="*\\net1.exe" OR Image="*\\reg.exe" OR Image="*\\query.exe"))) | eval sigma_attack_tags="attack.initial_access attack.t1190 attack.execution attack.t1059.001 attack.t1059.003 attack.s0190 cve.2020.10189" | eval sigma_title="Exploited CVE-2020-10189 Zoho ManageEngine" | eval sigma_description="Detects the exploitation of Zoho ManageEngine Desktop Central Java Deserialization vulnerability reported as CVE-2020-10189"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious PrinterPorts Creation (CVE-2020-1048) - winevent]
description = Detects new commands that add new printer port which point to suspicious file
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((Process_Command_Line="*Add-PrinterPort -Name*" (Process_Command_Line="*.exe*" OR Process_Command_Line="*.dll*" OR Process_Command_Line="*.bat*"))) OR Process_Command_Line="*Generic / Text Only*"))) | eval sigma_attack_tags="attack.persistence attack.execution attack.t1059.001" | eval sigma_title="Suspicious PrinterPorts Creation (CVE-2020-1048)" | eval sigma_description="Detects new commands that add new printer port which point to suspicious file"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious PrinterPorts Creation (CVE-2020-1048) - sysmon]
description = Detects new commands that add new printer port which point to suspicious file
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((CommandLine="*Add-PrinterPort -Name*" (CommandLine="*.exe*" OR CommandLine="*.dll*" OR CommandLine="*.bat*"))) OR CommandLine="*Generic / Text Only*"))) | eval sigma_attack_tags="attack.persistence attack.execution attack.t1059.001" | eval sigma_title="Suspicious PrinterPorts Creation (CVE-2020-1048)" | eval sigma_description="Detects new commands that add new printer port which point to suspicious file"
dispatch.earliest_time = -24h@h
alert.track = 0

[DNS RCE CVE-2020-1350 - winevent]
description = Detects exploitation of DNS RCE bug reported in CVE-2020-1350 by the detection of suspicious sub process
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) Creator_Process_Name="*\\System32\\dns.exe" NOT (((New_Process_Name="*\\System32\\werfault.exe" OR New_Process_Name="*\\System32\\conhost.exe" OR New_Process_Name="*\\System32\\dnscmd.exe" OR New_Process_Name="*\\System32\\dns.exe"))))) | eval sigma_attack_tags="attack.initial_access attack.t1190 attack.execution attack.t1569.002" | eval sigma_title="DNS RCE CVE-2020-1350" | eval sigma_description="Detects exploitation of DNS RCE bug reported in CVE-2020-1350 by the detection of suspicious sub process"
dispatch.earliest_time = -24h@h
alert.track = 0

[DNS RCE CVE-2020-1350 - sysmon]
description = Detects exploitation of DNS RCE bug reported in CVE-2020-1350 by the detection of suspicious sub process
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ParentImage="*\\System32\\dns.exe" NOT (((Image="*\\System32\\werfault.exe" OR Image="*\\System32\\conhost.exe" OR Image="*\\System32\\dnscmd.exe" OR Image="*\\System32\\dns.exe"))))) | eval sigma_attack_tags="attack.initial_access attack.t1190 attack.execution attack.t1569.002" | eval sigma_title="DNS RCE CVE-2020-1350" | eval sigma_description="Detects exploitation of DNS RCE bug reported in CVE-2020-1350 by the detection of suspicious sub process"
dispatch.earliest_time = -24h@h
alert.track = 0

[Possible InstallerFileTakeOver LPE CVE-2021-41379 - winevent]
description = Detects signs of the exploitation of LPE CVE-2021-41379 to spawn a cmd.exe with LOCAL_SYSTEM rights
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\cmd.exe" Creator_Process_Name="*\\elevation_service.exe" IntegrityLevel="System")) | eval sigma_attack_tags="attack.privilege_escalation attack.t1068" | eval sigma_title="Possible InstallerFileTakeOver LPE CVE-2021-41379" | eval sigma_description="Detects signs of the exploitation of LPE CVE-2021-41379 to spawn a cmd.exe with LOCAL_SYSTEM rights"
dispatch.earliest_time = -24h@h
alert.track = 0

[Possible InstallerFileTakeOver LPE CVE-2021-41379 - sysmon]
description = Detects signs of the exploitation of LPE CVE-2021-41379 to spawn a cmd.exe with LOCAL_SYSTEM rights
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\cmd.exe" ParentImage="*\\elevation_service.exe" IntegrityLevel="System")) | eval sigma_attack_tags="attack.privilege_escalation attack.t1068" | eval sigma_title="Possible InstallerFileTakeOver LPE CVE-2021-41379" | eval sigma_description="Detects signs of the exploitation of LPE CVE-2021-41379 to spawn a cmd.exe with LOCAL_SYSTEM rights"
dispatch.earliest_time = -24h@h
alert.track = 0

[SystemNightmare Exploitation Script Execution - winevent]
description = Detects the exploitation of PrinterNightmare to get a shell as LOCAL_SYSTEM
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (Process_Command_Line="*printnightmare.gentilkiwi.com*" OR Process_Command_Line="* /user:gentilguest *" OR Process_Command_Line="*Kiwi Legit Printer*"))) | eval sigma_attack_tags="attack.privilege_escalation attack.t1068" | eval sigma_title="SystemNightmare Exploitation Script Execution" | eval sigma_description="Detects the exploitation of PrinterNightmare to get a shell as LOCAL_SYSTEM"
dispatch.earliest_time = -24h@h
alert.track = 0

[SystemNightmare Exploitation Script Execution - sysmon]
description = Detects the exploitation of PrinterNightmare to get a shell as LOCAL_SYSTEM
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (CommandLine="*printnightmare.gentilkiwi.com*" OR CommandLine="* /user:gentilguest *" OR CommandLine="*Kiwi Legit Printer*"))) | eval sigma_attack_tags="attack.privilege_escalation attack.t1068" | eval sigma_title="SystemNightmare Exploitation Script Execution" | eval sigma_description="Detects the exploitation of PrinterNightmare to get a shell as LOCAL_SYSTEM"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential Binary Impersonating Sysinternals Tools - winevent]
description = Detects binaries that use the same name as legitimate sysinternals tools to evade detection
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\accesschk.exe" OR New_Process_Name="*\\accesschk64.exe" OR New_Process_Name="*\\AccessEnum.exe" OR New_Process_Name="*\\ADExplorer.exe" OR New_Process_Name="*\\ADExplorer64.exe" OR New_Process_Name="*\\ADInsight.exe" OR New_Process_Name="*\\ADInsight64.exe" OR New_Process_Name="*\\adrestore.exe" OR New_Process_Name="*\\adrestore64.exe" OR New_Process_Name="*\\Autologon.exe" OR New_Process_Name="*\\Autologon64.exe" OR New_Process_Name="*\\Autoruns.exe" OR New_Process_Name="*\\Autoruns64.exe" OR New_Process_Name="*\\autorunsc.exe" OR New_Process_Name="*\\autorunsc64.exe" OR New_Process_Name="*\\Bginfo.exe" OR New_Process_Name="*\\Bginfo64.exe" OR New_Process_Name="*\\Cacheset.exe" OR New_Process_Name="*\\Cacheset64.exe" OR New_Process_Name="*\\Clockres.exe" OR New_Process_Name="*\\Clockres64.exe" OR New_Process_Name="*\\Contig.exe" OR New_Process_Name="*\\Contig64.exe" OR New_Process_Name="*\\Coreinfo.exe" OR New_Process_Name="*\\Coreinfo64.exe" OR New_Process_Name="*\\CPUSTRES.EXE" OR New_Process_Name="*\\CPUSTRES64.EXE" OR New_Process_Name="*\\ctrl2cap.exe" OR New_Process_Name="*\\Dbgview.exe" OR New_Process_Name="*\\dbgview64.exe" OR New_Process_Name="*\\Desktops.exe" OR New_Process_Name="*\\Desktops64.exe" OR New_Process_Name="*\\disk2vhd.exe" OR New_Process_Name="*\\disk2vhd64.exe" OR New_Process_Name="*\\diskext.exe" OR New_Process_Name="*\\diskext64.exe" OR New_Process_Name="*\\Diskmon.exe" OR New_Process_Name="*\\Diskmon64.exe" OR New_Process_Name="*\\DiskView.exe" OR New_Process_Name="*\\DiskView64.exe" OR New_Process_Name="*\\du.exe" OR New_Process_Name="*\\du64.exe" OR New_Process_Name="*\\efsdump.exe" OR New_Process_Name="*\\FindLinks.exe" OR New_Process_Name="*\\FindLinks64.exe" OR New_Process_Name="*\\handle.exe" OR New_Process_Name="*\\handle64.exe" OR New_Process_Name="*\\hex2dec.exe" OR New_Process_Name="*\\hex2dec64.exe" OR New_Process_Name="*\\junction.exe" OR New_Process_Name="*\\junction64.exe" OR New_Process_Name="*\\ldmdump.exe" OR New_Process_Name="*\\listdlls.exe" OR New_Process_Name="*\\listdlls64.exe" OR New_Process_Name="*\\livekd.exe" OR New_Process_Name="*\\livekd64.exe" OR New_Process_Name="*\\loadOrd.exe" OR New_Process_Name="*\\loadOrd64.exe" OR New_Process_Name="*\\loadOrdC.exe" OR New_Process_Name="*\\loadOrdC64.exe" OR New_Process_Name="*\\logonsessions.exe" OR New_Process_Name="*\\logonsessions64.exe" OR New_Process_Name="*\\movefile.exe" OR New_Process_Name="*\\movefile64.exe" OR New_Process_Name="*\\notmyfault.exe" OR New_Process_Name="*\\notmyfault64.exe" OR New_Process_Name="*\\notmyfaultc.exe" OR New_Process_Name="*\\notmyfaultc64.exe" OR New_Process_Name="*\\ntfsinfo.exe" OR New_Process_Name="*\\ntfsinfo64.exe" OR New_Process_Name="*\\pendmoves.exe" OR New_Process_Name="*\\pendmoves64.exe" OR New_Process_Name="*\\pipelist.exe" OR New_Process_Name="*\\pipelist64.exe" OR New_Process_Name="*\\portmon.exe" OR New_Process_Name="*\\procdump.exe" OR New_Process_Name="*\\procdump64.exe" OR New_Process_Name="*\\procexp.exe" OR New_Process_Name="*\\procexp64.exe" OR New_Process_Name="*\\Procmon.exe" OR New_Process_Name="*\\Procmon64.exe" OR New_Process_Name="*\\psExec.exe" OR New_Process_Name="*\\psExec64.exe" OR New_Process_Name="*\\psfile.exe" OR New_Process_Name="*\\psfile64.exe" OR New_Process_Name="*\\psGetsid.exe" OR New_Process_Name="*\\psGetsid64.exe" OR New_Process_Name="*\\psInfo.exe" OR New_Process_Name="*\\psInfo64.exe" OR New_Process_Name="*\\pskill.exe" OR New_Process_Name="*\\pskill64.exe" OR New_Process_Name="*\\pslist.exe" OR New_Process_Name="*\\pslist64.exe" OR New_Process_Name="*\\psLoggedon.exe" OR New_Process_Name="*\\psLoggedon64.exe" OR New_Process_Name="*\\psloglist.exe" OR New_Process_Name="*\\psloglist64.exe" OR New_Process_Name="*\\pspasswd.exe" OR New_Process_Name="*\\pspasswd64.exe" OR New_Process_Name="*\\psping.exe" OR New_Process_Name="*\\psping64.exe" OR New_Process_Name="*\\psService.exe" OR New_Process_Name="*\\psService64.exe" OR New_Process_Name="*\\psshutdown.exe" OR New_Process_Name="*\\psshutdown64.exe" OR New_Process_Name="*\\pssuspend.exe" OR New_Process_Name="*\\pssuspend64.exe" OR New_Process_Name="*\\RAMMap.exe" OR New_Process_Name="*\\RDCMan.exe" OR New_Process_Name="*\\RegDelNull.exe" OR New_Process_Name="*\\RegDelNull64.exe" OR New_Process_Name="*\\regjump.exe" OR New_Process_Name="*\\ru.exe" OR New_Process_Name="*\\ru64.exe" OR New_Process_Name="*\\sdelete.exe" OR New_Process_Name="*\\sdelete64.exe" OR New_Process_Name="*\\ShareEnum.exe" OR New_Process_Name="*\\ShareEnum64.exe" OR New_Process_Name="*\\shellRunas.exe" OR New_Process_Name="*\\sigcheck.exe" OR New_Process_Name="*\\sigcheck64.exe" OR New_Process_Name="*\\streams.exe" OR New_Process_Name="*\\streams64.exe" OR New_Process_Name="*\\strings.exe" OR New_Process_Name="*\\strings64.exe" OR New_Process_Name="*\\sync.exe" OR New_Process_Name="*\\sync64.exe" OR New_Process_Name="*\\Sysmon.exe" OR New_Process_Name="*\\Sysmon64.exe" OR New_Process_Name="*\\tcpvcon.exe" OR New_Process_Name="*\\tcpvcon64.exe" OR New_Process_Name="*\\tcpview.exe" OR New_Process_Name="*\\tcpview64.exe" OR New_Process_Name="*\\Testlimit.exe" OR New_Process_Name="*\\Testlimit64.exe" OR New_Process_Name="*\\vmmap.exe" OR New_Process_Name="*\\vmmap64.exe" OR New_Process_Name="*\\Volumeid.exe" OR New_Process_Name="*\\Volumeid64.exe" OR New_Process_Name="*\\whois.exe" OR New_Process_Name="*\\whois64.exe" OR New_Process_Name="*\\Winobj.exe" OR New_Process_Name="*\\Winobj64.exe" OR New_Process_Name="*\\ZoomIt.exe" OR New_Process_Name="*\\ZoomIt64.exe") NOT ((((Company="Sysinternals - www.sysinternals.com" OR Company="Sysinternals"))) OR ((NOT Company="*"))))) | eval sigma_attack_tags="attack.execution attack.defense_evasion attack.t1218 attack.t1202" | eval sigma_title="Potential Binary Impersonating Sysinternals Tools" | eval sigma_description="Detects binaries that use the same name as legitimate sysinternals tools to evade detection"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential Binary Impersonating Sysinternals Tools - sysmon]
description = Detects binaries that use the same name as legitimate sysinternals tools to evade detection
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\accesschk.exe" OR Image="*\\accesschk64.exe" OR Image="*\\AccessEnum.exe" OR Image="*\\ADExplorer.exe" OR Image="*\\ADExplorer64.exe" OR Image="*\\ADInsight.exe" OR Image="*\\ADInsight64.exe" OR Image="*\\adrestore.exe" OR Image="*\\adrestore64.exe" OR Image="*\\Autologon.exe" OR Image="*\\Autologon64.exe" OR Image="*\\Autoruns.exe" OR Image="*\\Autoruns64.exe" OR Image="*\\autorunsc.exe" OR Image="*\\autorunsc64.exe" OR Image="*\\Bginfo.exe" OR Image="*\\Bginfo64.exe" OR Image="*\\Cacheset.exe" OR Image="*\\Cacheset64.exe" OR Image="*\\Clockres.exe" OR Image="*\\Clockres64.exe" OR Image="*\\Contig.exe" OR Image="*\\Contig64.exe" OR Image="*\\Coreinfo.exe" OR Image="*\\Coreinfo64.exe" OR Image="*\\CPUSTRES.EXE" OR Image="*\\CPUSTRES64.EXE" OR Image="*\\ctrl2cap.exe" OR Image="*\\Dbgview.exe" OR Image="*\\dbgview64.exe" OR Image="*\\Desktops.exe" OR Image="*\\Desktops64.exe" OR Image="*\\disk2vhd.exe" OR Image="*\\disk2vhd64.exe" OR Image="*\\diskext.exe" OR Image="*\\diskext64.exe" OR Image="*\\Diskmon.exe" OR Image="*\\Diskmon64.exe" OR Image="*\\DiskView.exe" OR Image="*\\DiskView64.exe" OR Image="*\\du.exe" OR Image="*\\du64.exe" OR Image="*\\efsdump.exe" OR Image="*\\FindLinks.exe" OR Image="*\\FindLinks64.exe" OR Image="*\\handle.exe" OR Image="*\\handle64.exe" OR Image="*\\hex2dec.exe" OR Image="*\\hex2dec64.exe" OR Image="*\\junction.exe" OR Image="*\\junction64.exe" OR Image="*\\ldmdump.exe" OR Image="*\\listdlls.exe" OR Image="*\\listdlls64.exe" OR Image="*\\livekd.exe" OR Image="*\\livekd64.exe" OR Image="*\\loadOrd.exe" OR Image="*\\loadOrd64.exe" OR Image="*\\loadOrdC.exe" OR Image="*\\loadOrdC64.exe" OR Image="*\\logonsessions.exe" OR Image="*\\logonsessions64.exe" OR Image="*\\movefile.exe" OR Image="*\\movefile64.exe" OR Image="*\\notmyfault.exe" OR Image="*\\notmyfault64.exe" OR Image="*\\notmyfaultc.exe" OR Image="*\\notmyfaultc64.exe" OR Image="*\\ntfsinfo.exe" OR Image="*\\ntfsinfo64.exe" OR Image="*\\pendmoves.exe" OR Image="*\\pendmoves64.exe" OR Image="*\\pipelist.exe" OR Image="*\\pipelist64.exe" OR Image="*\\portmon.exe" OR Image="*\\procdump.exe" OR Image="*\\procdump64.exe" OR Image="*\\procexp.exe" OR Image="*\\procexp64.exe" OR Image="*\\Procmon.exe" OR Image="*\\Procmon64.exe" OR Image="*\\psExec.exe" OR Image="*\\psExec64.exe" OR Image="*\\psfile.exe" OR Image="*\\psfile64.exe" OR Image="*\\psGetsid.exe" OR Image="*\\psGetsid64.exe" OR Image="*\\psInfo.exe" OR Image="*\\psInfo64.exe" OR Image="*\\pskill.exe" OR Image="*\\pskill64.exe" OR Image="*\\pslist.exe" OR Image="*\\pslist64.exe" OR Image="*\\psLoggedon.exe" OR Image="*\\psLoggedon64.exe" OR Image="*\\psloglist.exe" OR Image="*\\psloglist64.exe" OR Image="*\\pspasswd.exe" OR Image="*\\pspasswd64.exe" OR Image="*\\psping.exe" OR Image="*\\psping64.exe" OR Image="*\\psService.exe" OR Image="*\\psService64.exe" OR Image="*\\psshutdown.exe" OR Image="*\\psshutdown64.exe" OR Image="*\\pssuspend.exe" OR Image="*\\pssuspend64.exe" OR Image="*\\RAMMap.exe" OR Image="*\\RDCMan.exe" OR Image="*\\RegDelNull.exe" OR Image="*\\RegDelNull64.exe" OR Image="*\\regjump.exe" OR Image="*\\ru.exe" OR Image="*\\ru64.exe" OR Image="*\\sdelete.exe" OR Image="*\\sdelete64.exe" OR Image="*\\ShareEnum.exe" OR Image="*\\ShareEnum64.exe" OR Image="*\\shellRunas.exe" OR Image="*\\sigcheck.exe" OR Image="*\\sigcheck64.exe" OR Image="*\\streams.exe" OR Image="*\\streams64.exe" OR Image="*\\strings.exe" OR Image="*\\strings64.exe" OR Image="*\\sync.exe" OR Image="*\\sync64.exe" OR Image="*\\Sysmon.exe" OR Image="*\\Sysmon64.exe" OR Image="*\\tcpvcon.exe" OR Image="*\\tcpvcon64.exe" OR Image="*\\tcpview.exe" OR Image="*\\tcpview64.exe" OR Image="*\\Testlimit.exe" OR Image="*\\Testlimit64.exe" OR Image="*\\vmmap.exe" OR Image="*\\vmmap64.exe" OR Image="*\\Volumeid.exe" OR Image="*\\Volumeid64.exe" OR Image="*\\whois.exe" OR Image="*\\whois64.exe" OR Image="*\\Winobj.exe" OR Image="*\\Winobj64.exe" OR Image="*\\ZoomIt.exe" OR Image="*\\ZoomIt64.exe") NOT ((((Company="Sysinternals - www.sysinternals.com" OR Company="Sysinternals"))) OR ((NOT Company="*"))))) | eval sigma_attack_tags="attack.execution attack.defense_evasion attack.t1218 attack.t1202" | eval sigma_title="Potential Binary Impersonating Sysinternals Tools" | eval sigma_description="Detects binaries that use the same name as legitimate sysinternals tools to evade detection"
dispatch.earliest_time = -24h@h
alert.track = 0

[File or Folder Permissions Modifications - winevent]
description = Detects a file or folder's permissions being modified or tampered with.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((((New_Process_Name="*\\cacls.exe" OR New_Process_Name="*\\icacls.exe" OR New_Process_Name="*\\net.exe" OR New_Process_Name="*\\net1.exe") (Process_Command_Line="*/grant*" OR Process_Command_Line="*/setowner*" OR Process_Command_Line="*/inheritance:r*"))) OR ((New_Process_Name="*\\attrib.exe" Process_Command_Line="*-r*")) OR New_Process_Name="*\\takeown.exe") NOT (((Process_Command_Line="*ICACLS C:\\ProgramData\\dynatrace\\gateway\\config\\connectivity.history /reset")) OR (((Process_Command_Line="*ICACLS C:\\ProgramData\\dynatrace\\gateway\\config\\config.properties /grant :r *" Process_Command_Line="*S-1-5-19:F*"))) OR ((Process_Command_Line="*\\AppData\\Local\\Programs\\Microsoft VS Code*") OR (Creator_Process_Name="*\\Microsoft VS Code\\Code.exe"))))) | table ComputerName,Account_Name,Process_Command_Line | eval sigma_attack_tags="attack.defense_evasion attack.t1222.001" | eval sigma_title="File or Folder Permissions Modifications" | eval sigma_description="Detects a file or folder's permissions being modified or tampered with."
dispatch.earliest_time = -24h@h
alert.track = 0

[File or Folder Permissions Modifications - sysmon]
description = Detects a file or folder's permissions being modified or tampered with.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((((Image="*\\cacls.exe" OR Image="*\\icacls.exe" OR Image="*\\net.exe" OR Image="*\\net1.exe") (CommandLine="*/grant*" OR CommandLine="*/setowner*" OR CommandLine="*/inheritance:r*"))) OR ((Image="*\\attrib.exe" CommandLine="*-r*")) OR Image="*\\takeown.exe") NOT (((CommandLine="*ICACLS C:\\ProgramData\\dynatrace\\gateway\\config\\connectivity.history /reset")) OR (((CommandLine="*ICACLS C:\\ProgramData\\dynatrace\\gateway\\config\\config.properties /grant :r *" CommandLine="*S-1-5-19:F*"))) OR ((CommandLine="*\\AppData\\Local\\Programs\\Microsoft VS Code*") OR (ParentImage="*\\Microsoft VS Code\\Code.exe"))))) | table ComputerName,User,CommandLine | eval sigma_attack_tags="attack.defense_evasion attack.t1222.001" | eval sigma_title="File or Folder Permissions Modifications" | eval sigma_description="Detects a file or folder's permissions being modified or tampered with."
dispatch.earliest_time = -24h@h
alert.track = 0

[Findstr LSASS - winevent]
description = Detects findstring commands that include the keyword lsass, which indicates recon actviity for the LSASS process PID
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((New_Process_Name="*\\findstr.exe" Process_Command_Line="*lsass*")) OR (Process_Command_Line="* /i lsass.exe*" OR Process_Command_Line="* /i \"lsass*" OR Process_Command_Line="*findstr lsass*" OR Process_Command_Line="*findstr.exe lsass*" OR Process_Command_Line="*findstr \"lsass*" OR Process_Command_Line="*findstr.exe \"lsass*")))) | eval sigma_attack_tags="attack.credential_access attack.t1552.006" | eval sigma_title="Findstr LSASS" | eval sigma_description="Detects findstring commands that include the keyword lsass, which indicates recon actviity for the LSASS process PID"
dispatch.earliest_time = -24h@h
alert.track = 0

[Findstr LSASS - sysmon]
description = Detects findstring commands that include the keyword lsass, which indicates recon actviity for the LSASS process PID
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((Image="*\\findstr.exe" CommandLine="*lsass*")) OR (CommandLine="* /i lsass.exe*" OR CommandLine="* /i \"lsass*" OR CommandLine="*findstr lsass*" OR CommandLine="*findstr.exe lsass*" OR CommandLine="*findstr \"lsass*" OR CommandLine="*findstr.exe \"lsass*")))) | eval sigma_attack_tags="attack.credential_access attack.t1552.006" | eval sigma_title="Findstr LSASS" | eval sigma_description="Detects findstring commands that include the keyword lsass, which indicates recon actviity for the LSASS process PID"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Recon Activity Using Findstr Keywords - winevent]
description = Detects usage of findstr with the 'EVERYONE' keyword. This is often used in combination with icacls to look for misconfigured files or folders permissions
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((New_Process_Name="*\\findstr.exe" OriginalFileName="FINDSTR.EXE" (Process_Command_Line="*\"Everyone\"*" OR Process_Command_Line="*'Everyone'*"))) OR ((Process_Command_Line="*icacls *" Process_Command_Line="*findstr *" Process_Command_Line="*Everyone*"))))) | eval sigma_attack_tags="attack.credential_access attack.t1552.006" | eval sigma_title="Suspicious Recon Activity Using Findstr Keywords" | eval sigma_description="Detects usage of findstr with the 'EVERYONE' keyword. This is often used in combination with icacls to look for misconfigured files or folders permissions"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Recon Activity Using Findstr Keywords - sysmon]
description = Detects usage of findstr with the 'EVERYONE' keyword. This is often used in combination with icacls to look for misconfigured files or folders permissions
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((Image="*\\findstr.exe" OriginalFileName="FINDSTR.EXE" (CommandLine="*\"Everyone\"*" OR CommandLine="*'Everyone'*"))) OR ((CommandLine="*icacls *" CommandLine="*findstr *" CommandLine="*Everyone*"))))) | eval sigma_attack_tags="attack.credential_access attack.t1552.006" | eval sigma_title="Suspicious Recon Activity Using Findstr Keywords" | eval sigma_description="Detects usage of findstr with the 'EVERYONE' keyword. This is often used in combination with icacls to look for misconfigured files or folders permissions"
dispatch.earliest_time = -24h@h
alert.track = 0

[Windows Firewall Disabled via PowerShell - winevent]
description = Detects attempts to disable the Windows Firewall using PowerShell
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\powershell.exe" OR New_Process_Name="*\\pwsh.exe" OR New_Process_Name="*\\powershell_ise.exe") OR OriginalFileName="PowerShell.EXE") ((Process_Command_Line="*Set-NetFirewallProfile *" Process_Command_Line="* -Enabled *" Process_Command_Line="* False*")) (Process_Command_Line="* -All *" OR Process_Command_Line="*Public*" OR Process_Command_Line="*Domain*" OR Process_Command_Line="*Private*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1562" | eval sigma_title="Windows Firewall Disabled via PowerShell" | eval sigma_description="Detects attempts to disable the Windows Firewall using PowerShell"
dispatch.earliest_time = -24h@h
alert.track = 0

[Windows Firewall Disabled via PowerShell - sysmon]
description = Detects attempts to disable the Windows Firewall using PowerShell
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\powershell.exe" OR Image="*\\pwsh.exe" OR Image="*\\powershell_ise.exe") OR OriginalFileName="PowerShell.EXE") ((CommandLine="*Set-NetFirewallProfile *" CommandLine="* -Enabled *" CommandLine="* False*")) (CommandLine="* -All *" OR CommandLine="*Public*" OR CommandLine="*Domain*" OR CommandLine="*Private*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1562" | eval sigma_title="Windows Firewall Disabled via PowerShell" | eval sigma_description="Detects attempts to disable the Windows Firewall using PowerShell"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious FromBase64String Usage On Gzip Archive - Process Creation - winevent]
description = Detects attempts of decoding a base64 Gzip archive via PowerShell. This technique is often used as a method to load malicious content into memory afterward.
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*FromBase64String*" Process_Command_Line="*MemoryStream*" Process_Command_Line="*H4sI*")) | eval sigma_attack_tags="" | eval sigma_title="Suspicious FromBase64String Usage On Gzip Archive - Process Creation" | eval sigma_description="Detects attempts of decoding a base64 Gzip archive via PowerShell. This technique is often used as a method to load malicious content into memory afterward."
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious FromBase64String Usage On Gzip Archive - Process Creation - sysmon]
description = Detects attempts of decoding a base64 Gzip archive via PowerShell. This technique is often used as a method to load malicious content into memory afterward.
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*FromBase64String*" CommandLine="*MemoryStream*" CommandLine="*H4sI*")) | eval sigma_attack_tags="" | eval sigma_title="Suspicious FromBase64String Usage On Gzip Archive - Process Creation" | eval sigma_description="Detects attempts of decoding a base64 Gzip archive via PowerShell. This technique is often used as a method to load malicious content into memory afterward."
dispatch.earliest_time = -24h@h
alert.track = 0

[Fast Reverse Proxy (FRP) - winevent]
description = Detects the use of Fast Reverse Proxy. frp is a fast reverse proxy to help you expose a local server behind a NAT or firewall to the Internet.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\frpc.exe" OR New_Process_Name="*\\frps.exe") OR Process_Command_Line="*\\frpc.ini*" OR (Hashes="*MD5=7D9C233B8C9E3F0EA290D2B84593C842*" OR Hashes="*SHA1=06DDC9280E1F1810677935A2477012960905942F*" OR Hashes="*SHA256=57B0936B8D336D8E981C169466A15A5FD21A7D5A2C7DAF62D5E142EE860E387C*") OR md5="7d9c233b8c9e3f0ea290d2b84593c842" OR sha1="06ddc9280e1f1810677935a2477012960905942f" OR sha256="57b0936b8d336d8e981c169466a15a5fd21a7d5a2c7daf62d5e142ee860e387c"))) | eval sigma_attack_tags="attack.command_and_control attack.t1090" | eval sigma_title="Fast Reverse Proxy (FRP)" | eval sigma_description="Detects the use of Fast Reverse Proxy. frp is a fast reverse proxy to help you expose a local server behind a NAT or firewall to the Internet."
dispatch.earliest_time = -24h@h
alert.track = 0

[Fast Reverse Proxy (FRP) - sysmon]
description = Detects the use of Fast Reverse Proxy. frp is a fast reverse proxy to help you expose a local server behind a NAT or firewall to the Internet.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\frpc.exe" OR Image="*\\frps.exe") OR CommandLine="*\\frpc.ini*" OR (Hashes="*MD5=7D9C233B8C9E3F0EA290D2B84593C842*" OR Hashes="*SHA1=06DDC9280E1F1810677935A2477012960905942F*" OR Hashes="*SHA256=57B0936B8D336D8E981C169466A15A5FD21A7D5A2C7DAF62D5E142EE860E387C*") OR md5="7d9c233b8c9e3f0ea290d2b84593c842" OR sha1="06ddc9280e1f1810677935a2477012960905942f" OR sha256="57b0936b8d336d8e981c169466a15a5fd21a7d5a2c7daf62d5e142ee860e387c"))) | eval sigma_attack_tags="attack.command_and_control attack.t1090" | eval sigma_title="Fast Reverse Proxy (FRP)" | eval sigma_description="Detects the use of Fast Reverse Proxy. frp is a fast reverse proxy to help you expose a local server behind a NAT or firewall to the Internet."
dispatch.earliest_time = -24h@h
alert.track = 0

[Fsutil Drive Enumeration - winevent]
description = Attackers may leverage fsutil to enumerated connected drives.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\fsutil.exe" OR OriginalFileName="fsutil.exe") Process_Command_Line="*drives*")) | eval sigma_attack_tags="attack.discovery attack.t1120" | eval sigma_title="Fsutil Drive Enumeration" | eval sigma_description="Attackers may leverage fsutil to enumerated connected drives."
dispatch.earliest_time = -24h@h
alert.track = 0

[Fsutil Drive Enumeration - sysmon]
description = Attackers may leverage fsutil to enumerated connected drives.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\fsutil.exe" OR OriginalFileName="fsutil.exe") CommandLine="*drives*")) | eval sigma_attack_tags="attack.discovery attack.t1120" | eval sigma_title="Fsutil Drive Enumeration" | eval sigma_description="Attackers may leverage fsutil to enumerated connected drives."
dispatch.earliest_time = -24h@h
alert.track = 0

[Fsutil Behavior Set SymlinkEvaluation - winevent]
description = A symbolic link is a type of file that contains a reference to another file.
This is probably done to make sure that the ransomware is able to follow shortcuts on the machine in order to find the original file to encrypt

search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\fsutil.exe" OR OriginalFileName="fsutil.exe") ((Process_Command_Line="*behavior *" Process_Command_Line="*set *" Process_Command_Line="*SymlinkEvaluation*")))) | eval sigma_attack_tags="attack.execution attack.t1059" | eval sigma_title="Fsutil Behavior Set SymlinkEvaluation" | eval sigma_description="A symbolic link is a type of file that contains a reference to another file.
This is probably done to make sure that the ransomware is able to follow shortcuts on the machine in order to find the original file to encrypt
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Fsutil Behavior Set SymlinkEvaluation - sysmon]
description = A symbolic link is a type of file that contains a reference to another file.
This is probably done to make sure that the ransomware is able to follow shortcuts on the machine in order to find the original file to encrypt

search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\fsutil.exe" OR OriginalFileName="fsutil.exe") ((CommandLine="*behavior *" CommandLine="*set *" CommandLine="*SymlinkEvaluation*")))) | eval sigma_attack_tags="attack.execution attack.t1059" | eval sigma_title="Fsutil Behavior Set SymlinkEvaluation" | eval sigma_description="A symbolic link is a type of file that contains a reference to another file.
This is probably done to make sure that the ransomware is able to follow shortcuts on the machine in order to find the original file to encrypt
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Reconnaissance Activity Using Get-LocalGroupMember Cmdlet - winevent]
description = Detects suspicious reconnaissance command line activity on Windows systems using the PowerShell Get-LocalGroupMember Cmdlet
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*Get-LocalGroupMember *" (Process_Command_Line="*domain admins*" OR Process_Command_Line="* administrator*" OR Process_Command_Line="* administrateur*" OR Process_Command_Line="*enterprise admins*" OR Process_Command_Line="*Exchange Trusted Subsystem*" OR Process_Command_Line="*Remote Desktop Users*" OR Process_Command_Line="*Utilisateurs du Bureau à distance*" OR Process_Command_Line="*Usuarios de escritorio remoto*"))) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.discovery attack.t1087.001" | eval sigma_title="Suspicious Reconnaissance Activity Using Get-LocalGroupMember Cmdlet" | eval sigma_description="Detects suspicious reconnaissance command line activity on Windows systems using the PowerShell Get-LocalGroupMember Cmdlet"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Reconnaissance Activity Using Get-LocalGroupMember Cmdlet - sysmon]
description = Detects suspicious reconnaissance command line activity on Windows systems using the PowerShell Get-LocalGroupMember Cmdlet
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*Get-LocalGroupMember *" (CommandLine="*domain admins*" OR CommandLine="* administrator*" OR CommandLine="* administrateur*" OR CommandLine="*enterprise admins*" OR CommandLine="*Exchange Trusted Subsystem*" OR CommandLine="*Remote Desktop Users*" OR CommandLine="*Utilisateurs du Bureau à distance*" OR CommandLine="*Usuarios de escritorio remoto*"))) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.discovery attack.t1087.001" | eval sigma_title="Suspicious Reconnaissance Activity Using Get-LocalGroupMember Cmdlet" | eval sigma_description="Detects suspicious reconnaissance command line activity on Windows systems using the PowerShell Get-LocalGroupMember Cmdlet"
dispatch.earliest_time = -24h@h
alert.track = 0

[GMER - Rootkit Detector and Remover Execution - winevent]
description = Detects the execution GMER tool based on image and hash fields.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\gmer.exe" OR (Hashes="*MD5=E9DC058440D321AA17D0600B3CA0AB04*" OR Hashes="*SHA1=539C228B6B332F5AA523E5CE358C16647D8BBE57*" OR Hashes="*SHA256=E8A3E804A96C716A3E9B69195DB6FFB0D33E2433AF871E4D4E1EAB3097237173*") OR md5="e9dc058440d321aa17d0600b3ca0ab04" OR sha1="539c228b6b332f5aa523e5ce358c16647d8bbe57" OR sha256="e8a3e804a96c716a3e9b69195db6ffb0d33e2433af871e4d4e1eab3097237173"))) | eval sigma_attack_tags="attack.defense_evasion" | eval sigma_title="GMER - Rootkit Detector and Remover Execution" | eval sigma_description="Detects the execution GMER tool based on image and hash fields."
dispatch.earliest_time = -24h@h
alert.track = 0

[GMER - Rootkit Detector and Remover Execution - sysmon]
description = Detects the execution GMER tool based on image and hash fields.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\gmer.exe" OR (Hashes="*MD5=E9DC058440D321AA17D0600B3CA0AB04*" OR Hashes="*SHA1=539C228B6B332F5AA523E5CE358C16647D8BBE57*" OR Hashes="*SHA256=E8A3E804A96C716A3E9B69195DB6FFB0D33E2433AF871E4D4E1EAB3097237173*") OR md5="e9dc058440d321aa17d0600b3ca0ab04" OR sha1="539c228b6b332f5aa523e5ce358c16647d8bbe57" OR sha256="e8a3e804a96c716a3e9b69195db6ffb0d33e2433af871e4d4e1eab3097237173"))) | eval sigma_attack_tags="attack.defense_evasion" | eval sigma_title="GMER - Rootkit Detector and Remover Execution" | eval sigma_description="Detects the execution GMER tool based on image and hash fields."
dispatch.earliest_time = -24h@h
alert.track = 0

[Gpg4Win Decrypt Files From Suspicious Locations - winevent]
description = Detects usage of the Gpg4win to decrypt files located in suspicious locations from CLI
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\gpg2.exe" OR Product="GNU Privacy Guard (GnuPG)" OR Company="g10 Code GmbH") Process_Command_Line="*-passphrase*" (Process_Command_Line="*\\AppData\\Roaming\\*" OR Process_Command_Line="*C:\\Perflogs\\*" OR Process_Command_Line="*C:\\Windows\\Temp\\*" OR Process_Command_Line="*C:\\temp*"))) | eval sigma_attack_tags="attack.command_and_control attack.t1219" | eval sigma_title="Gpg4Win Decrypt Files From Suspicious Locations" | eval sigma_description="Detects usage of the Gpg4win to decrypt files located in suspicious locations from CLI"
dispatch.earliest_time = -24h@h
alert.track = 0

[Gpg4Win Decrypt Files From Suspicious Locations - sysmon]
description = Detects usage of the Gpg4win to decrypt files located in suspicious locations from CLI
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\gpg2.exe" OR Product="GNU Privacy Guard (GnuPG)" OR Company="g10 Code GmbH") CommandLine="*-passphrase*" (CommandLine="*\\AppData\\Roaming\\*" OR CommandLine="*C:\\Perflogs\\*" OR CommandLine="*C:\\Windows\\Temp\\*" OR CommandLine="*C:\\temp*"))) | eval sigma_attack_tags="attack.command_and_control attack.t1219" | eval sigma_title="Gpg4Win Decrypt Files From Suspicious Locations" | eval sigma_description="Detects usage of the Gpg4win to decrypt files located in suspicious locations from CLI"
dispatch.earliest_time = -24h@h
alert.track = 0

[Grabbing Sensitive Hives via Reg Utility - winevent]
description = Dump sam, system or security hives using REG.exe utility
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\reg.exe" (Process_Command_Line="*save*" OR Process_Command_Line="*export*" OR Process_Command_Line="*ˢave*" OR Process_Command_Line="*eˣport*") (Process_Command_Line="*hklm*" OR Process_Command_Line="*hk˪m*" OR Process_Command_Line="*hkey_local_machine*" OR Process_Command_Line="*hkey_˪ocal_machine*" OR Process_Command_Line="*hkey_loca˪_machine*" OR Process_Command_Line="*hkey_˪oca˪_machine*") (Process_Command_Line="*\\system" OR Process_Command_Line="*\\sam" OR Process_Command_Line="*\\security" OR Process_Command_Line="*\\ˢystem" OR Process_Command_Line="*\\syˢtem" OR Process_Command_Line="*\\ˢyˢtem" OR Process_Command_Line="*\\ˢam" OR Process_Command_Line="*\\ˢecurity"))) | eval sigma_attack_tags="attack.credential_access attack.t1003.002 attack.t1003.004 attack.t1003.005 car.2013-07-001" | eval sigma_title="Grabbing Sensitive Hives via Reg Utility" | eval sigma_description="Dump sam, system or security hives using REG.exe utility"
dispatch.earliest_time = -24h@h
alert.track = 0

[Grabbing Sensitive Hives via Reg Utility - sysmon]
description = Dump sam, system or security hives using REG.exe utility
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\reg.exe" (CommandLine="*save*" OR CommandLine="*export*" OR CommandLine="*ˢave*" OR CommandLine="*eˣport*") (CommandLine="*hklm*" OR CommandLine="*hk˪m*" OR CommandLine="*hkey_local_machine*" OR CommandLine="*hkey_˪ocal_machine*" OR CommandLine="*hkey_loca˪_machine*" OR CommandLine="*hkey_˪oca˪_machine*") (CommandLine="*\\system" OR CommandLine="*\\sam" OR CommandLine="*\\security" OR CommandLine="*\\ˢystem" OR CommandLine="*\\syˢtem" OR CommandLine="*\\ˢyˢtem" OR CommandLine="*\\ˢam" OR CommandLine="*\\ˢecurity"))) | eval sigma_attack_tags="attack.credential_access attack.t1003.002 attack.t1003.004 attack.t1003.005 car.2013-07-001" | eval sigma_title="Grabbing Sensitive Hives via Reg Utility" | eval sigma_description="Dump sam, system or security hives using REG.exe utility"
dispatch.earliest_time = -24h@h
alert.track = 0

[ADCSPwn Hack Tool - winevent]
description = Detects command line parameters used by ADCSPwn, a tool to escalate privileges in an active directory network by coercing authenticate from machine accounts and relaying to the certificate service
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="* --adcs *" Process_Command_Line="* --port *")) | eval sigma_attack_tags="attack.credential_access attack.t1557.001" | eval sigma_title="ADCSPwn Hack Tool" | eval sigma_description="Detects command line parameters used by ADCSPwn, a tool to escalate privileges in an active directory network by coercing authenticate from machine accounts and relaying to the certificate service"
dispatch.earliest_time = -24h@h
alert.track = 0

[ADCSPwn Hack Tool - sysmon]
description = Detects command line parameters used by ADCSPwn, a tool to escalate privileges in an active directory network by coercing authenticate from machine accounts and relaying to the certificate service
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="* --adcs *" CommandLine="* --port *")) | eval sigma_attack_tags="attack.credential_access attack.t1557.001" | eval sigma_title="ADCSPwn Hack Tool" | eval sigma_description="Detects command line parameters used by ADCSPwn, a tool to escalate privileges in an active directory network by coercing authenticate from machine accounts and relaying to the certificate service"
dispatch.earliest_time = -24h@h
alert.track = 0

[Bloodhound and Sharphound Hack Tool - winevent]
description = Detects command line parameters used by Bloodhound and Sharphound hack tools
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\Bloodhound.exe*" OR New_Process_Name="*\\SharpHound.exe*") OR (Process_Command_Line="* -CollectionMethod All *" OR Process_Command_Line="* --CollectionMethods Session *" OR Process_Command_Line="* --Loop --Loopduration *" OR Process_Command_Line="* --PortScanTimeout *" OR Process_Command_Line="*.exe -c All -d *" OR Process_Command_Line="*Invoke-Bloodhound*" OR Process_Command_Line="*Get-BloodHoundData*") OR ((Process_Command_Line="* -JsonFolder *" Process_Command_Line="* -ZipFileName *")) OR ((Process_Command_Line="* DCOnly *" Process_Command_Line="* --NoSaveCache *")) OR (Product="*SharpHound*" OR Description="*SharpHound*" OR (Company="*SpecterOps*" OR Company="*evil corp*"))))) | eval sigma_attack_tags="attack.discovery attack.t1087.001 attack.t1087.002 attack.t1482 attack.t1069.001 attack.t1069.002 attack.execution attack.t1059.001" | eval sigma_title="Bloodhound and Sharphound Hack Tool" | eval sigma_description="Detects command line parameters used by Bloodhound and Sharphound hack tools"
dispatch.earliest_time = -24h@h
alert.track = 0

[Bloodhound and Sharphound Hack Tool - sysmon]
description = Detects command line parameters used by Bloodhound and Sharphound hack tools
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\Bloodhound.exe*" OR Image="*\\SharpHound.exe*") OR (CommandLine="* -CollectionMethod All *" OR CommandLine="* --CollectionMethods Session *" OR CommandLine="* --Loop --Loopduration *" OR CommandLine="* --PortScanTimeout *" OR CommandLine="*.exe -c All -d *" OR CommandLine="*Invoke-Bloodhound*" OR CommandLine="*Get-BloodHoundData*") OR ((CommandLine="* -JsonFolder *" CommandLine="* -ZipFileName *")) OR ((CommandLine="* DCOnly *" CommandLine="* --NoSaveCache *")) OR (Product="*SharpHound*" OR Description="*SharpHound*" OR (Company="*SpecterOps*" OR Company="*evil corp*"))))) | eval sigma_attack_tags="attack.discovery attack.t1087.001 attack.t1087.002 attack.t1482 attack.t1069.001 attack.t1069.002 attack.execution attack.t1059.001" | eval sigma_title="Bloodhound and Sharphound Hack Tool" | eval sigma_description="Detects command line parameters used by Bloodhound and Sharphound hack tools"
dispatch.earliest_time = -24h@h
alert.track = 0

[Hacktool by Cube0x0 - winevent]
description = Detects the use of tools created by a well-known hacktool producer named Cube0x0, which includes his handle in all binaries as company information in the PE headers (SharpPrintNightmare, KrbRelay, SharpMapExec etc.)
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Company="Cube0x0")) | eval sigma_attack_tags="" | eval sigma_title="Hacktool by Cube0x0" | eval sigma_description="Detects the use of tools created by a well-known hacktool producer named Cube0x0, which includes his handle in all binaries as company information in the PE headers (SharpPrintNightmare, KrbRelay, SharpMapExec etc.)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Hacktool by Cube0x0 - sysmon]
description = Detects the use of tools created by a well-known hacktool producer named Cube0x0, which includes his handle in all binaries as company information in the PE headers (SharpPrintNightmare, KrbRelay, SharpMapExec etc.)
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Company="Cube0x0")) | eval sigma_attack_tags="" | eval sigma_title="Hacktool by Cube0x0" | eval sigma_description="Detects the use of tools created by a well-known hacktool producer named Cube0x0, which includes his handle in all binaries as company information in the PE headers (SharpPrintNightmare, KrbRelay, SharpMapExec etc.)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Dumpert Process Dumper - winevent]
description = Detects the use of Dumpert process dumper, which dumps the lsass.exe process memory
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Hashes="*09D278F9DE118EF09163C6140255C690*")) | eval sigma_attack_tags="attack.credential_access attack.t1003.001" | eval sigma_title="Dumpert Process Dumper" | eval sigma_description="Detects the use of Dumpert process dumper, which dumps the lsass.exe process memory"
dispatch.earliest_time = -24h@h
alert.track = 0

[Dumpert Process Dumper - sysmon]
description = Detects the use of Dumpert process dumper, which dumps the lsass.exe process memory
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Hashes="*09D278F9DE118EF09163C6140255C690*")) | eval sigma_attack_tags="attack.credential_access attack.t1003.001" | eval sigma_title="Dumpert Process Dumper" | eval sigma_description="Detects the use of Dumpert process dumper, which dumps the lsass.exe process memory"
dispatch.earliest_time = -24h@h
alert.track = 0

[Htran or NATBypass Markers - winevent]
description = Detects exeuctable names or flags used by Htran or Htran-like tools (e.g. NATBypass)
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\htran.exe" OR New_Process_Name="*\\lcx.exe") OR (Process_Command_Line="*.exe -tran *" OR Process_Command_Line="*.exe -slave *")))) | eval sigma_attack_tags="attack.command_and_control attack.t1090 attack.s0040" | eval sigma_title="Htran or NATBypass Markers" | eval sigma_description="Detects exeuctable names or flags used by Htran or Htran-like tools (e.g. NATBypass)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Htran or NATBypass Markers - sysmon]
description = Detects exeuctable names or flags used by Htran or Htran-like tools (e.g. NATBypass)
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\htran.exe" OR Image="*\\lcx.exe") OR (CommandLine="*.exe -tran *" OR CommandLine="*.exe -slave *")))) | eval sigma_attack_tags="attack.command_and_control attack.t1090 attack.s0040" | eval sigma_title="Htran or NATBypass Markers" | eval sigma_description="Detects exeuctable names or flags used by Htran or Htran-like tools (e.g. NATBypass)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Hydra Password Guessing Hack Tool - winevent]
description = Detects command line parameters used by Hydra password guessing hack tool
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*-u *" Process_Command_Line="*-p *" (Process_Command_Line="*^USER^*" OR Process_Command_Line="*^PASS^*"))) | eval sigma_attack_tags="attack.credential_access attack.t1110 attack.t1110.001" | eval sigma_title="Hydra Password Guessing Hack Tool" | eval sigma_description="Detects command line parameters used by Hydra password guessing hack tool"
dispatch.earliest_time = -24h@h
alert.track = 0

[Hydra Password Guessing Hack Tool - sysmon]
description = Detects command line parameters used by Hydra password guessing hack tool
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*-u *" CommandLine="*-p *" (CommandLine="*^USER^*" OR CommandLine="*^PASS^*"))) | eval sigma_attack_tags="attack.credential_access attack.t1110 attack.t1110.001" | eval sigma_title="Hydra Password Guessing Hack Tool" | eval sigma_description="Detects command line parameters used by Hydra password guessing hack tool"
dispatch.earliest_time = -24h@h
alert.track = 0

[Inveigh Hack Tool - winevent]
description = Detects the use of Inveigh a cross-platform .NET IPv4/IPv6 machine-in-the-middle tool
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\Inveigh.exe" OR (OriginalFileName="\\Inveigh.exe" OR OriginalFileName="\\Inveigh.dll") OR Description="Inveigh" OR (Process_Command_Line="* -SpooferIP*" OR Process_Command_Line="* -ReplyToIPs *" OR Process_Command_Line="* -ReplyToDomains *" OR Process_Command_Line="* -ReplyToMACs *" OR Process_Command_Line="* -SnifferIP*")))) | eval sigma_attack_tags="attack.credential_access attack.t1003.001" | eval sigma_title="Inveigh Hack Tool" | eval sigma_description="Detects the use of Inveigh a cross-platform .NET IPv4/IPv6 machine-in-the-middle tool"
dispatch.earliest_time = -24h@h
alert.track = 0

[Inveigh Hack Tool - sysmon]
description = Detects the use of Inveigh a cross-platform .NET IPv4/IPv6 machine-in-the-middle tool
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\Inveigh.exe" OR (OriginalFileName="\\Inveigh.exe" OR OriginalFileName="\\Inveigh.dll") OR Description="Inveigh" OR (CommandLine="* -SpooferIP*" OR CommandLine="* -ReplyToIPs *" OR CommandLine="* -ReplyToDomains *" OR CommandLine="* -ReplyToMACs *" OR CommandLine="* -SnifferIP*")))) | eval sigma_attack_tags="attack.credential_access attack.t1003.001" | eval sigma_title="Inveigh Hack Tool" | eval sigma_description="Detects the use of Inveigh a cross-platform .NET IPv4/IPv6 machine-in-the-middle tool"
dispatch.earliest_time = -24h@h
alert.track = 0

[Koadic Execution - winevent]
description = Detects command line parameters used by Koadic hack tool
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\cmd.exe" Process_Command_Line="*/q*" Process_Command_Line="*/c*" Process_Command_Line="*chcp*")) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.execution attack.t1059.003 attack.t1059.005 attack.t1059.007" | eval sigma_title="Koadic Execution" | eval sigma_description="Detects command line parameters used by Koadic hack tool"
dispatch.earliest_time = -24h@h
alert.track = 0

[Koadic Execution - sysmon]
description = Detects command line parameters used by Koadic hack tool
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\cmd.exe" CommandLine="*/q*" CommandLine="*/c*" CommandLine="*chcp*")) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.execution attack.t1059.003 attack.t1059.005 attack.t1059.007" | eval sigma_title="Koadic Execution" | eval sigma_description="Detects command line parameters used by Koadic hack tool"
dispatch.earliest_time = -24h@h
alert.track = 0

[KrbRelay Hack Tool - winevent]
description = Detects the use of KrbRelay, a Kerberos relaying tool
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\KrbRelay.exe" OR OriginalFileName="KrbRelay.exe" OR ((Process_Command_Line="* -spn *" Process_Command_Line="* -clsid *" Process_Command_Line="* -rbcd *")) OR ((Process_Command_Line="*shadowcred*" Process_Command_Line="*clsid*" Process_Command_Line="*spn*")) OR ((Process_Command_Line="*spn *" Process_Command_Line="*session *" Process_Command_Line="*clsid *"))))) | eval sigma_attack_tags="attack.credential_access attack.t1558.003" | eval sigma_title="KrbRelay Hack Tool" | eval sigma_description="Detects the use of KrbRelay, a Kerberos relaying tool"
dispatch.earliest_time = -24h@h
alert.track = 0

[KrbRelay Hack Tool - sysmon]
description = Detects the use of KrbRelay, a Kerberos relaying tool
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\KrbRelay.exe" OR OriginalFileName="KrbRelay.exe" OR ((CommandLine="* -spn *" CommandLine="* -clsid *" CommandLine="* -rbcd *")) OR ((CommandLine="*shadowcred*" CommandLine="*clsid*" CommandLine="*spn*")) OR ((CommandLine="*spn *" CommandLine="*session *" CommandLine="*clsid *"))))) | eval sigma_attack_tags="attack.credential_access attack.t1558.003" | eval sigma_title="KrbRelay Hack Tool" | eval sigma_description="Detects the use of KrbRelay, a Kerberos relaying tool"
dispatch.earliest_time = -24h@h
alert.track = 0

[KrbRelayUp Hack Tool - winevent]
description = Detects KrbRelayUp used to perform a universal no-fix local privilege escalation in windows domain environments where LDAP signing is not enforced
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\KrbRelayUp.exe" OR OriginalFileName="KrbRelayUp.exe" OR ((Process_Command_Line="* relay *" Process_Command_Line="* -Domain *" Process_Command_Line="* -ComputerName *")) OR ((Process_Command_Line="* krbscm *" Process_Command_Line="* -sc *")) OR ((Process_Command_Line="* spawn *" Process_Command_Line="* -d *" Process_Command_Line="* -cn *" Process_Command_Line="* -cp *"))))) | eval sigma_attack_tags="attack.credential_access attack.t1558.003 attack.lateral_movement attack.t1550.003" | eval sigma_title="KrbRelayUp Hack Tool" | eval sigma_description="Detects KrbRelayUp used to perform a universal no-fix local privilege escalation in windows domain environments where LDAP signing is not enforced"
dispatch.earliest_time = -24h@h
alert.track = 0

[KrbRelayUp Hack Tool - sysmon]
description = Detects KrbRelayUp used to perform a universal no-fix local privilege escalation in windows domain environments where LDAP signing is not enforced
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\KrbRelayUp.exe" OR OriginalFileName="KrbRelayUp.exe" OR ((CommandLine="* relay *" CommandLine="* -Domain *" CommandLine="* -ComputerName *")) OR ((CommandLine="* krbscm *" CommandLine="* -sc *")) OR ((CommandLine="* spawn *" CommandLine="* -d *" CommandLine="* -cn *" CommandLine="* -cp *"))))) | eval sigma_attack_tags="attack.credential_access attack.t1558.003 attack.lateral_movement attack.t1550.003" | eval sigma_title="KrbRelayUp Hack Tool" | eval sigma_description="Detects KrbRelayUp used to perform a universal no-fix local privilege escalation in windows domain environments where LDAP signing is not enforced"
dispatch.earliest_time = -24h@h
alert.track = 0

[Rubeus Hack Tool - winevent]
description = Detects the execution of the hacktool Rubeus via PE information of command line parameters
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\Rubeus.exe" OR OriginalFileName="Rubeus.exe" OR Description="Rubeus" OR (Process_Command_Line="* asreproast *" OR Process_Command_Line="* dump /service:krbtgt *" OR Process_Command_Line="* dump /luid:0x*" OR Process_Command_Line="* kerberoast *" OR Process_Command_Line="* createnetonly /program:*" OR Process_Command_Line="* ptt /ticket:*" OR Process_Command_Line="* /impersonateuser:*" OR Process_Command_Line="* renew /ticket:*" OR Process_Command_Line="* asktgt /user:*" OR Process_Command_Line="* harvest /interval:*" OR Process_Command_Line="* s4u /user:*" OR Process_Command_Line="* s4u /ticket:*" OR Process_Command_Line="* hash /password:*" OR Process_Command_Line="* golden /aes256:*" OR Process_Command_Line="* silver /user:*")))) | eval sigma_attack_tags="attack.credential_access attack.t1003 attack.t1558.003 attack.lateral_movement attack.t1550.003" | eval sigma_title="Rubeus Hack Tool" | eval sigma_description="Detects the execution of the hacktool Rubeus via PE information of command line parameters"
dispatch.earliest_time = -24h@h
alert.track = 0

[Rubeus Hack Tool - sysmon]
description = Detects the execution of the hacktool Rubeus via PE information of command line parameters
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\Rubeus.exe" OR OriginalFileName="Rubeus.exe" OR Description="Rubeus" OR (CommandLine="* asreproast *" OR CommandLine="* dump /service:krbtgt *" OR CommandLine="* dump /luid:0x*" OR CommandLine="* kerberoast *" OR CommandLine="* createnetonly /program:*" OR CommandLine="* ptt /ticket:*" OR CommandLine="* /impersonateuser:*" OR CommandLine="* renew /ticket:*" OR CommandLine="* asktgt /user:*" OR CommandLine="* harvest /interval:*" OR CommandLine="* s4u /user:*" OR CommandLine="* s4u /ticket:*" OR CommandLine="* hash /password:*" OR CommandLine="* golden /aes256:*" OR CommandLine="* silver /user:*")))) | eval sigma_attack_tags="attack.credential_access attack.t1003 attack.t1558.003 attack.lateral_movement attack.t1550.003" | eval sigma_title="Rubeus Hack Tool" | eval sigma_description="Detects the execution of the hacktool Rubeus via PE information of command line parameters"
dispatch.earliest_time = -24h@h
alert.track = 0

[SafetyKatz Hack Tool - winevent]
description = Detects the execution of the hacktool SafetyKatz via PE information and default Image name
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\SafetyKatz.exe" OR OriginalFileName="SafetyKatz.exe" OR Description="SafetyKatz"))) | eval sigma_attack_tags="attack.credential_access attack.t1003.001" | eval sigma_title="SafetyKatz Hack Tool" | eval sigma_description="Detects the execution of the hacktool SafetyKatz via PE information and default Image name"
dispatch.earliest_time = -24h@h
alert.track = 0

[SafetyKatz Hack Tool - sysmon]
description = Detects the execution of the hacktool SafetyKatz via PE information and default Image name
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\SafetyKatz.exe" OR OriginalFileName="SafetyKatz.exe" OR Description="SafetyKatz"))) | eval sigma_attack_tags="attack.credential_access attack.t1003.001" | eval sigma_title="SafetyKatz Hack Tool" | eval sigma_description="Detects the execution of the hacktool SafetyKatz via PE information and default Image name"
dispatch.earliest_time = -24h@h
alert.track = 0

[SecurityXploded Tool - winevent]
description = Detects the execution of SecurityXploded Tools
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (Company="SecurityXploded" OR New_Process_Name="*PasswordDump.exe" OR OriginalFileName="*PasswordDump.exe"))) | eval sigma_attack_tags="attack.credential_access attack.t1555" | eval sigma_title="SecurityXploded Tool" | eval sigma_description="Detects the execution of SecurityXploded Tools"
dispatch.earliest_time = -24h@h
alert.track = 0

[SecurityXploded Tool - sysmon]
description = Detects the execution of SecurityXploded Tools
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Company="SecurityXploded" OR Image="*PasswordDump.exe" OR OriginalFileName="*PasswordDump.exe"))) | eval sigma_attack_tags="attack.credential_access attack.t1555" | eval sigma_title="SecurityXploded Tool" | eval sigma_description="Detects the execution of SecurityXploded Tools"
dispatch.earliest_time = -24h@h
alert.track = 0

[SharPersist Usage - winevent]
description = Detects the execution of the hacktool SharPersist - used to deploy various different kinds of persistence mechanisms
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\SharPersist.exe" OR Product="SharPersist" OR (Process_Command_Line="* -t schtask -c *" OR Process_Command_Line="* -t startupfolder -c *") OR ((Process_Command_Line="* -t reg -c *" Process_Command_Line="* -m add*")) OR ((Process_Command_Line="* -t service -c *" Process_Command_Line="* -m add*")) OR ((Process_Command_Line="* -t schtask -c *" Process_Command_Line="* -m add*"))))) | eval sigma_attack_tags="attack.persistence attack.t1053" | eval sigma_title="SharPersist Usage" | eval sigma_description="Detects the execution of the hacktool SharPersist - used to deploy various different kinds of persistence mechanisms"
dispatch.earliest_time = -24h@h
alert.track = 0

[SharPersist Usage - sysmon]
description = Detects the execution of the hacktool SharPersist - used to deploy various different kinds of persistence mechanisms
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\SharPersist.exe" OR Product="SharPersist" OR (CommandLine="* -t schtask -c *" OR CommandLine="* -t startupfolder -c *") OR ((CommandLine="* -t reg -c *" CommandLine="* -m add*")) OR ((CommandLine="* -t service -c *" CommandLine="* -m add*")) OR ((CommandLine="* -t schtask -c *" CommandLine="* -m add*"))))) | eval sigma_attack_tags="attack.persistence attack.t1053" | eval sigma_title="SharPersist Usage" | eval sigma_description="Detects the execution of the hacktool SharPersist - used to deploy various different kinds of persistence mechanisms"
dispatch.earliest_time = -24h@h
alert.track = 0

[SharpLdapWhoami - winevent]
description = Detects SharpLdapWhoami, a whoami alternative by asking the LDAP service on a domain controller
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\SharpLdapWhoami.exe" OR OriginalFileName="*SharpLdapWhoami*" OR Product="SharpLdapWhoami" OR (Process_Command_Line="* /method:ntlm" OR Process_Command_Line="* /method:kerb" OR Process_Command_Line="* /method:nego" OR Process_Command_Line="* /m:nego" OR Process_Command_Line="* /m:ntlm" OR Process_Command_Line="* /m:kerb")))) | eval sigma_attack_tags="attack.discovery attack.t1033 car.2016-03-001" | eval sigma_title="SharpLdapWhoami" | eval sigma_description="Detects SharpLdapWhoami, a whoami alternative by asking the LDAP service on a domain controller"
dispatch.earliest_time = -24h@h
alert.track = 0

[SharpLdapWhoami - sysmon]
description = Detects SharpLdapWhoami, a whoami alternative by asking the LDAP service on a domain controller
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\SharpLdapWhoami.exe" OR OriginalFileName="*SharpLdapWhoami*" OR Product="SharpLdapWhoami" OR (CommandLine="* /method:ntlm" OR CommandLine="* /method:kerb" OR CommandLine="* /method:nego" OR CommandLine="* /m:nego" OR CommandLine="* /m:ntlm" OR CommandLine="* /m:kerb")))) | eval sigma_attack_tags="attack.discovery attack.t1033 car.2016-03-001" | eval sigma_title="SharpLdapWhoami" | eval sigma_description="Detects SharpLdapWhoami, a whoami alternative by asking the LDAP service on a domain controller"
dispatch.earliest_time = -24h@h
alert.track = 0

[SysmonEOP Hack Tool - winevent]
description = Detects the execution of the PoC that can be used to exploit Sysmon CVE-2022-41120
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\SysmonEOP.exe" OR (Hashes="IMPHASH=22F4089EB8ABA31E1BB162C6D9BF72E5" OR Hashes="IMPHASH=5123FA4C4384D431CD0D893EEB49BBEC") OR (Imphash="22f4089eb8aba31e1bb162c6d9bf72e5" OR Imphash="5123fa4c4384d431cd0d893eeb49bbec")))) | eval sigma_attack_tags="cve.2022.41120 attack.t1068 attack.privilege_escalation" | eval sigma_title="SysmonEOP Hack Tool" | eval sigma_description="Detects the execution of the PoC that can be used to exploit Sysmon CVE-2022-41120"
dispatch.earliest_time = -24h@h
alert.track = 0

[SysmonEOP Hack Tool - sysmon]
description = Detects the execution of the PoC that can be used to exploit Sysmon CVE-2022-41120
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\SysmonEOP.exe" OR (Hashes="IMPHASH=22F4089EB8ABA31E1BB162C6D9BF72E5" OR Hashes="IMPHASH=5123FA4C4384D431CD0D893EEB49BBEC") OR (Imphash="22f4089eb8aba31e1bb162c6d9bf72e5" OR Imphash="5123fa4c4384d431cd0d893eeb49bbec")))) | eval sigma_attack_tags="cve.2022.41120 attack.t1068 attack.privilege_escalation" | eval sigma_title="SysmonEOP Hack Tool" | eval sigma_description="Detects the execution of the PoC that can be used to exploit Sysmon CVE-2022-41120"
dispatch.earliest_time = -24h@h
alert.track = 0

[Windows Credential Editor - winevent]
description = Detects the use of Windows Credential Editor (WCE)
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((Imphash="a53a02b997935fd8eedcb5f7abab9b9f" OR Imphash="e96a73c7bf33a464c510ede582318bf2") OR (Hashes="*IMPHASH=a53a02b997935fd8eedcb5f7abab9b9f*" OR Hashes="*IMPHASH=e96a73c7bf33a464c510ede582318bf2*")) OR ((Process_Command_Line="*.exe -S" Creator_Process_Name="*\\services.exe"))) NOT ((New_Process_Name="*\\clussvc.exe")))) | eval sigma_attack_tags="attack.credential_access attack.t1003.001 attack.s0005" | eval sigma_title="Windows Credential Editor" | eval sigma_description="Detects the use of Windows Credential Editor (WCE)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Windows Credential Editor - sysmon]
description = Detects the use of Windows Credential Editor (WCE)
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((Imphash="a53a02b997935fd8eedcb5f7abab9b9f" OR Imphash="e96a73c7bf33a464c510ede582318bf2") OR (Hashes="*IMPHASH=a53a02b997935fd8eedcb5f7abab9b9f*" OR Hashes="*IMPHASH=e96a73c7bf33a464c510ede582318bf2*")) OR ((CommandLine="*.exe -S" ParentImage="*\\services.exe"))) NOT ((Image="*\\clussvc.exe")))) | eval sigma_attack_tags="attack.credential_access attack.t1003.001 attack.s0005" | eval sigma_title="Windows Credential Editor" | eval sigma_description="Detects the use of Windows Credential Editor (WCE)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Windows Hacktool Imphash - winevent]
description = Detects the use of Windows hacktools based on their import hash (imphash) even if the files have been renamed
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((Imphash="bcca3c247b619dcd13c8cdff5f123932" OR Imphash="3a19059bd7688cb88e70005f18efc439" OR Imphash="bf6223a49e45d99094406777eb6004ba" OR Imphash="0c106686a31bfe2ba931ae1cf6e9dbc6" OR Imphash="0d1447d4b3259b3c2a1d4cfb7ece13c3" OR Imphash="1b0369a1e06271833f78ffa70ffb4eaf" OR Imphash="4c1b52a19748428e51b14c278d0f58e3" OR Imphash="4d927a711f77d62cebd4f322cb57ec6f" OR Imphash="66ee036df5fc1004d9ed5e9a94a1086a" OR Imphash="672b13f4a0b6f27d29065123fe882dfc" OR Imphash="6bbd59cea665c4afcc2814c1327ec91f" OR Imphash="725bb81dc24214f6ecacc0cfb36ad30d" OR Imphash="9528a0e91e28fbb88ad433feabca2456" OR Imphash="9da6d5d77be11712527dcab86df449a3" OR Imphash="a6e01bc1ab89f8d91d9eab72032aae88" OR Imphash="b24c5eddaea4fe50c6a96a2a133521e4" OR Imphash="d21bbc50dcc169d7b4d0f01962793154" OR Imphash="fcc251cceae90d22c392215cc9a2d5d6" OR Imphash="23867a89c2b8fc733be6cf5ef902f2d1" OR Imphash="a37ff327f8d48e8a4d2f757e1b6e70bc" OR Imphash="f9a28c458284584a93b14216308d31bd" OR Imphash="6118619783fc175bc7ebecff0769b46e" OR Imphash="959a83047e80ab68b368fdb3f4c6e4ea" OR Imphash="563233bfa169acc7892451f71ad5850a" OR Imphash="87575cb7a0e0700eb37f2e3668671a08" OR Imphash="13f08707f759af6003837a150a371ba1" OR Imphash="1781f06048a7e58b323f0b9259be798b" OR Imphash="233f85f2d4bc9d6521a6caae11a1e7f5" OR Imphash="24af2584cbf4d60bbe5c6d1b31b3be6d" OR Imphash="632969ddf6dbf4e0f53424b75e4b91f2" OR Imphash="713c29b396b907ed71a72482759ed757" OR Imphash="749a7bb1f0b4c4455949c0b2bf7f9e9f" OR Imphash="8628b2608957a6b0c6330ac3de28ce2e" OR Imphash="8b114550386e31895dfab371e741123d" OR Imphash="94cb940a1a6b65bed4d5a8f849ce9793" OR Imphash="9d68781980370e00e0bd939ee5e6c141" OR Imphash="b18a1401ff8f444056d29450fbc0a6ce" OR Imphash="cb567f9498452721d77a451374955f5f" OR Imphash="730073214094cd328547bf1f72289752" OR Imphash="17b461a082950fc6332228572138b80c" OR Imphash="dc25ee78e2ef4d36faa0badf1e7461c9" OR Imphash="819b19d53ca6736448f9325a85736792" OR Imphash="829da329ce140d873b4a8bde2cbfaa7e" OR Imphash="c547f2e66061a8dffb6f5a3ff63c0a74" OR Imphash="0588081ab0e63ba785938467e1b10cca" OR Imphash="0d9ec08bac6c07d9987dfd0f1506587c" OR Imphash="bc129092b71c89b4d4c8cdf8ea590b29" OR Imphash="4da924cf622d039d58bce71cdf05d242" OR Imphash="e7a3a5c377e2d29324093377d7db1c66" OR Imphash="9a9dbec5c62f0380b4fa5fd31deffedf" OR Imphash="af8a3976ad71e5d5fdfb67ddb8dadfce" OR Imphash="0c477898bbf137bbd6f2a54e3b805ff4" OR Imphash="0ca9f02b537bcea20d4ea5eb1a9fe338" OR Imphash="3ab3655e5a14d4eefc547f4781bf7f9e" OR Imphash="e6f9d5152da699934b30daab206471f6" OR Imphash="3ad59991ccf1d67339b319b15a41b35d" OR Imphash="ffdd59e0318b85a3e480874d9796d872" OR Imphash="0cf479628d7cc1ea25ec7998a92f5051" OR Imphash="07a2d4dcbd6cb2c6a45e6b101f0b6d51" OR Imphash="d6d0f80386e1380d05cb78e871bc72b1" OR Imphash="38d9e015591bbfd4929e0d0f47fa0055" OR Imphash="0e2216679ca6e1094d63322e3412d650" OR Imphash="ada161bf41b8e5e9132858cb54cab5fb" OR Imphash="2a1bc4913cd5ecb0434df07cb675b798" OR Imphash="11083e75553baae21dc89ce8f9a195e4" OR Imphash="a23d29c9e566f2fa8ffbb79267f5df80" OR Imphash="4a07f944a83e8a7c2525efa35dd30e2f" OR Imphash="767637c23bb42cd5d7397cf58b0be688" OR Imphash="14c4e4c72ba075e9069ee67f39188ad8" OR Imphash="3c782813d4afce07bbfc5a9772acdbdc" OR Imphash="7d010c6bb6a3726f327f7e239166d127" OR Imphash="89159ba4dd04e4ce5559f132a9964eb3" OR Imphash="6f33f4a5fc42b8cec7314947bd13f30f" OR Imphash="5834ed4291bdeb928270428ebbaf7604" OR Imphash="5a8a8a43f25485e7ee1b201edcbc7a38" OR Imphash="dc7d30b90b2d8abf664fbed2b1b59894" OR Imphash="41923ea1f824fe63ea5beb84db7a3e74" OR Imphash="3de09703c8e79ed2ca3f01074719906b" OR Imphash="a53a02b997935fd8eedcb5f7abab9b9f" OR Imphash="e96a73c7bf33a464c510ede582318bf2" OR Imphash="32089b8851bbf8bc2d014e9f37288c83" OR Imphash="09D278F9DE118EF09163C6140255C690" OR Imphash="03866661686829d806989e2fc5a72606" OR Imphash="e57401fbdadcd4571ff385ab82bd5d6d" OR Imphash="84B763C45C0E4A3E7CA5548C710DB4EE" OR Imphash="19584675d94829987952432e018d5056" OR Imphash="330768a4f172e10acb6287b87289d83b") OR (Hashes="*IMPHASH=BCCA3C247B619DCD13C8CDFF5F123932*" OR Hashes="*IMPHASH=3A19059BD7688CB88E70005F18EFC439*" OR Hashes="*IMPHASH=bf6223a49e45d99094406777eb6004ba*" OR Hashes="*IMPHASH=0C106686A31BFE2BA931AE1CF6E9DBC6*" OR Hashes="*IMPHASH=0D1447D4B3259B3C2A1D4CFB7ECE13C3*" OR Hashes="*IMPHASH=1B0369A1E06271833F78FFA70FFB4EAF*" OR Hashes="*IMPHASH=4C1B52A19748428E51B14C278D0F58E3*" OR Hashes="*IMPHASH=4D927A711F77D62CEBD4F322CB57EC6F*" OR Hashes="*IMPHASH=66EE036DF5FC1004D9ED5E9A94A1086A*" OR Hashes="*IMPHASH=672B13F4A0B6F27D29065123FE882DFC*" OR Hashes="*IMPHASH=6BBD59CEA665C4AFCC2814C1327EC91F*" OR Hashes="*IMPHASH=725BB81DC24214F6ECACC0CFB36AD30D*" OR Hashes="*IMPHASH=9528A0E91E28FBB88AD433FEABCA2456*" OR Hashes="*IMPHASH=9DA6D5D77BE11712527DCAB86DF449A3*" OR Hashes="*IMPHASH=A6E01BC1AB89F8D91D9EAB72032AAE88*" OR Hashes="*IMPHASH=B24C5EDDAEA4FE50C6A96A2A133521E4*" OR Hashes="*IMPHASH=D21BBC50DCC169D7B4D0F01962793154*" OR Hashes="*IMPHASH=FCC251CCEAE90D22C392215CC9A2D5D6*" OR Hashes="*IMPHASH=23867A89C2B8FC733BE6CF5EF902F2D1*" OR Hashes="*IMPHASH=A37FF327F8D48E8A4D2F757E1B6E70BC*" OR Hashes="*IMPHASH=F9A28C458284584A93B14216308D31BD*" OR Hashes="*IMPHASH=6118619783FC175BC7EBECFF0769B46E*" OR Hashes="*IMPHASH=959A83047E80AB68B368FDB3F4C6E4EA*" OR Hashes="*IMPHASH=563233BFA169ACC7892451F71AD5850A*" OR Hashes="*IMPHASH=87575CB7A0E0700EB37F2E3668671A08*" OR Hashes="*IMPHASH=13F08707F759AF6003837A150A371BA1*" OR Hashes="*IMPHASH=1781F06048A7E58B323F0B9259BE798B*" OR Hashes="*IMPHASH=233F85F2D4BC9D6521A6CAAE11A1E7F5*" OR Hashes="*IMPHASH=24AF2584CBF4D60BBE5C6D1B31B3BE6D*" OR Hashes="*IMPHASH=632969DDF6DBF4E0F53424B75E4B91F2*" OR Hashes="*IMPHASH=713C29B396B907ED71A72482759ED757*" OR Hashes="*IMPHASH=749A7BB1F0B4C4455949C0B2BF7F9E9F*" OR Hashes="*IMPHASH=8628B2608957A6B0C6330AC3DE28CE2E*" OR Hashes="*IMPHASH=8B114550386E31895DFAB371E741123D*" OR Hashes="*IMPHASH=94CB940A1A6B65BED4D5A8F849CE9793*" OR Hashes="*IMPHASH=9D68781980370E00E0BD939EE5E6C141*" OR Hashes="*IMPHASH=B18A1401FF8F444056D29450FBC0A6CE*" OR Hashes="*IMPHASH=CB567F9498452721D77A451374955F5F*" OR Hashes="*IMPHASH=730073214094CD328547BF1F72289752*" OR Hashes="*IMPHASH=17B461A082950FC6332228572138B80C*" OR Hashes="*IMPHASH=DC25EE78E2EF4D36FAA0BADF1E7461C9*" OR Hashes="*IMPHASH=819B19D53CA6736448F9325A85736792*" OR Hashes="*IMPHASH=829DA329CE140D873B4A8BDE2CBFAA7E*" OR Hashes="*IMPHASH=C547F2E66061A8DFFB6F5A3FF63C0A74*" OR Hashes="*IMPHASH=0588081AB0E63BA785938467E1B10CCA*" OR Hashes="*IMPHASH=0D9EC08BAC6C07D9987DFD0F1506587C*" OR Hashes="*IMPHASH=BC129092B71C89B4D4C8CDF8EA590B29*" OR Hashes="*IMPHASH=4DA924CF622D039D58BCE71CDF05D242*" OR Hashes="*IMPHASH=E7A3A5C377E2D29324093377D7DB1C66*" OR Hashes="*IMPHASH=9A9DBEC5C62F0380B4FA5FD31DEFFEDF*" OR Hashes="*IMPHASH=AF8A3976AD71E5D5FDFB67DDB8DADFCE*" OR Hashes="*IMPHASH=0C477898BBF137BBD6F2A54E3B805FF4*" OR Hashes="*IMPHASH=0CA9F02B537BCEA20D4EA5EB1A9FE338*" OR Hashes="*IMPHASH=3AB3655E5A14D4EEFC547F4781BF7F9E*" OR Hashes="*IMPHASH=E6F9D5152DA699934B30DAAB206471F6*" OR Hashes="*IMPHASH=3AD59991CCF1D67339B319B15A41B35D*" OR Hashes="*IMPHASH=FFDD59E0318B85A3E480874D9796D872*" OR Hashes="*IMPHASH=0CF479628D7CC1EA25EC7998A92F5051*" OR Hashes="*IMPHASH=07A2D4DCBD6CB2C6A45E6B101F0B6D51*" OR Hashes="*IMPHASH=D6D0F80386E1380D05CB78E871BC72B1*" OR Hashes="*IMPHASH=38D9E015591BBFD4929E0D0F47FA0055*" OR Hashes="*IMPHASH=0E2216679CA6E1094D63322E3412D650*" OR Hashes="*IMPHASH=ADA161BF41B8E5E9132858CB54CAB5FB*" OR Hashes="*IMPHASH=2A1BC4913CD5ECB0434DF07CB675B798*" OR Hashes="*IMPHASH=11083E75553BAAE21DC89CE8F9A195E4*" OR Hashes="*IMPHASH=A23D29C9E566F2FA8FFBB79267F5DF80*" OR Hashes="*IMPHASH=4A07F944A83E8A7C2525EFA35DD30E2F*" OR Hashes="*IMPHASH=767637C23BB42CD5D7397CF58B0BE688*" OR Hashes="*IMPHASH=14C4E4C72BA075E9069EE67F39188AD8*" OR Hashes="*IMPHASH=3C782813D4AFCE07BBFC5A9772ACDBDC*" OR Hashes="*IMPHASH=7D010C6BB6A3726F327F7E239166D127*" OR Hashes="*IMPHASH=89159BA4DD04E4CE5559F132A9964EB3*" OR Hashes="*IMPHASH=6F33F4A5FC42B8CEC7314947BD13F30F*" OR Hashes="*IMPHASH=5834ED4291BDEB928270428EBBAF7604*" OR Hashes="*IMPHASH=5A8A8A43F25485E7EE1B201EDCBC7A38*" OR Hashes="*IMPHASH=DC7D30B90B2D8ABF664FBED2B1B59894*" OR Hashes="*IMPHASH=41923EA1F824FE63EA5BEB84DB7A3E74*" OR Hashes="*IMPHASH=3DE09703C8E79ED2CA3F01074719906B*" OR Hashes="*IMPHASH=A53A02B997935FD8EEDCB5F7ABAB9B9F*" OR Hashes="*IMPHASH=E96A73C7BF33A464C510EDE582318BF2*" OR Hashes="*IMPHASH=32089B8851BBF8BC2D014E9F37288C83*" OR Hashes="*IMPHASH=09D278F9DE118EF09163C6140255C690*" OR Hashes="*IMPHASH=03866661686829d806989e2fc5a72606*" OR Hashes="*IMPHASH=e57401fbdadcd4571ff385ab82bd5d6d*" OR Hashes="*IMPHASH=84B763C45C0E4A3E7CA5548C710DB4EE*" OR Hashes="*IMPHASH=19584675D94829987952432E018D5056*" OR Hashes="*IMPHASH=330768A4F172E10ACB6287B87289D83B*")))) | eval sigma_attack_tags="" | eval sigma_title="Windows Hacktool Imphash" | eval sigma_description="Detects the use of Windows hacktools based on their import hash (imphash) even if the files have been renamed"
dispatch.earliest_time = -24h@h
alert.track = 0

[Windows Hacktool Imphash - sysmon]
description = Detects the use of Windows hacktools based on their import hash (imphash) even if the files have been renamed
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Imphash="bcca3c247b619dcd13c8cdff5f123932" OR Imphash="3a19059bd7688cb88e70005f18efc439" OR Imphash="bf6223a49e45d99094406777eb6004ba" OR Imphash="0c106686a31bfe2ba931ae1cf6e9dbc6" OR Imphash="0d1447d4b3259b3c2a1d4cfb7ece13c3" OR Imphash="1b0369a1e06271833f78ffa70ffb4eaf" OR Imphash="4c1b52a19748428e51b14c278d0f58e3" OR Imphash="4d927a711f77d62cebd4f322cb57ec6f" OR Imphash="66ee036df5fc1004d9ed5e9a94a1086a" OR Imphash="672b13f4a0b6f27d29065123fe882dfc" OR Imphash="6bbd59cea665c4afcc2814c1327ec91f" OR Imphash="725bb81dc24214f6ecacc0cfb36ad30d" OR Imphash="9528a0e91e28fbb88ad433feabca2456" OR Imphash="9da6d5d77be11712527dcab86df449a3" OR Imphash="a6e01bc1ab89f8d91d9eab72032aae88" OR Imphash="b24c5eddaea4fe50c6a96a2a133521e4" OR Imphash="d21bbc50dcc169d7b4d0f01962793154" OR Imphash="fcc251cceae90d22c392215cc9a2d5d6" OR Imphash="23867a89c2b8fc733be6cf5ef902f2d1" OR Imphash="a37ff327f8d48e8a4d2f757e1b6e70bc" OR Imphash="f9a28c458284584a93b14216308d31bd" OR Imphash="6118619783fc175bc7ebecff0769b46e" OR Imphash="959a83047e80ab68b368fdb3f4c6e4ea" OR Imphash="563233bfa169acc7892451f71ad5850a" OR Imphash="87575cb7a0e0700eb37f2e3668671a08" OR Imphash="13f08707f759af6003837a150a371ba1" OR Imphash="1781f06048a7e58b323f0b9259be798b" OR Imphash="233f85f2d4bc9d6521a6caae11a1e7f5" OR Imphash="24af2584cbf4d60bbe5c6d1b31b3be6d" OR Imphash="632969ddf6dbf4e0f53424b75e4b91f2" OR Imphash="713c29b396b907ed71a72482759ed757" OR Imphash="749a7bb1f0b4c4455949c0b2bf7f9e9f" OR Imphash="8628b2608957a6b0c6330ac3de28ce2e" OR Imphash="8b114550386e31895dfab371e741123d" OR Imphash="94cb940a1a6b65bed4d5a8f849ce9793" OR Imphash="9d68781980370e00e0bd939ee5e6c141" OR Imphash="b18a1401ff8f444056d29450fbc0a6ce" OR Imphash="cb567f9498452721d77a451374955f5f" OR Imphash="730073214094cd328547bf1f72289752" OR Imphash="17b461a082950fc6332228572138b80c" OR Imphash="dc25ee78e2ef4d36faa0badf1e7461c9" OR Imphash="819b19d53ca6736448f9325a85736792" OR Imphash="829da329ce140d873b4a8bde2cbfaa7e" OR Imphash="c547f2e66061a8dffb6f5a3ff63c0a74" OR Imphash="0588081ab0e63ba785938467e1b10cca" OR Imphash="0d9ec08bac6c07d9987dfd0f1506587c" OR Imphash="bc129092b71c89b4d4c8cdf8ea590b29" OR Imphash="4da924cf622d039d58bce71cdf05d242" OR Imphash="e7a3a5c377e2d29324093377d7db1c66" OR Imphash="9a9dbec5c62f0380b4fa5fd31deffedf" OR Imphash="af8a3976ad71e5d5fdfb67ddb8dadfce" OR Imphash="0c477898bbf137bbd6f2a54e3b805ff4" OR Imphash="0ca9f02b537bcea20d4ea5eb1a9fe338" OR Imphash="3ab3655e5a14d4eefc547f4781bf7f9e" OR Imphash="e6f9d5152da699934b30daab206471f6" OR Imphash="3ad59991ccf1d67339b319b15a41b35d" OR Imphash="ffdd59e0318b85a3e480874d9796d872" OR Imphash="0cf479628d7cc1ea25ec7998a92f5051" OR Imphash="07a2d4dcbd6cb2c6a45e6b101f0b6d51" OR Imphash="d6d0f80386e1380d05cb78e871bc72b1" OR Imphash="38d9e015591bbfd4929e0d0f47fa0055" OR Imphash="0e2216679ca6e1094d63322e3412d650" OR Imphash="ada161bf41b8e5e9132858cb54cab5fb" OR Imphash="2a1bc4913cd5ecb0434df07cb675b798" OR Imphash="11083e75553baae21dc89ce8f9a195e4" OR Imphash="a23d29c9e566f2fa8ffbb79267f5df80" OR Imphash="4a07f944a83e8a7c2525efa35dd30e2f" OR Imphash="767637c23bb42cd5d7397cf58b0be688" OR Imphash="14c4e4c72ba075e9069ee67f39188ad8" OR Imphash="3c782813d4afce07bbfc5a9772acdbdc" OR Imphash="7d010c6bb6a3726f327f7e239166d127" OR Imphash="89159ba4dd04e4ce5559f132a9964eb3" OR Imphash="6f33f4a5fc42b8cec7314947bd13f30f" OR Imphash="5834ed4291bdeb928270428ebbaf7604" OR Imphash="5a8a8a43f25485e7ee1b201edcbc7a38" OR Imphash="dc7d30b90b2d8abf664fbed2b1b59894" OR Imphash="41923ea1f824fe63ea5beb84db7a3e74" OR Imphash="3de09703c8e79ed2ca3f01074719906b" OR Imphash="a53a02b997935fd8eedcb5f7abab9b9f" OR Imphash="e96a73c7bf33a464c510ede582318bf2" OR Imphash="32089b8851bbf8bc2d014e9f37288c83" OR Imphash="09D278F9DE118EF09163C6140255C690" OR Imphash="03866661686829d806989e2fc5a72606" OR Imphash="e57401fbdadcd4571ff385ab82bd5d6d" OR Imphash="84B763C45C0E4A3E7CA5548C710DB4EE" OR Imphash="19584675d94829987952432e018d5056" OR Imphash="330768a4f172e10acb6287b87289d83b") OR (Hashes="*IMPHASH=BCCA3C247B619DCD13C8CDFF5F123932*" OR Hashes="*IMPHASH=3A19059BD7688CB88E70005F18EFC439*" OR Hashes="*IMPHASH=bf6223a49e45d99094406777eb6004ba*" OR Hashes="*IMPHASH=0C106686A31BFE2BA931AE1CF6E9DBC6*" OR Hashes="*IMPHASH=0D1447D4B3259B3C2A1D4CFB7ECE13C3*" OR Hashes="*IMPHASH=1B0369A1E06271833F78FFA70FFB4EAF*" OR Hashes="*IMPHASH=4C1B52A19748428E51B14C278D0F58E3*" OR Hashes="*IMPHASH=4D927A711F77D62CEBD4F322CB57EC6F*" OR Hashes="*IMPHASH=66EE036DF5FC1004D9ED5E9A94A1086A*" OR Hashes="*IMPHASH=672B13F4A0B6F27D29065123FE882DFC*" OR Hashes="*IMPHASH=6BBD59CEA665C4AFCC2814C1327EC91F*" OR Hashes="*IMPHASH=725BB81DC24214F6ECACC0CFB36AD30D*" OR Hashes="*IMPHASH=9528A0E91E28FBB88AD433FEABCA2456*" OR Hashes="*IMPHASH=9DA6D5D77BE11712527DCAB86DF449A3*" OR Hashes="*IMPHASH=A6E01BC1AB89F8D91D9EAB72032AAE88*" OR Hashes="*IMPHASH=B24C5EDDAEA4FE50C6A96A2A133521E4*" OR Hashes="*IMPHASH=D21BBC50DCC169D7B4D0F01962793154*" OR Hashes="*IMPHASH=FCC251CCEAE90D22C392215CC9A2D5D6*" OR Hashes="*IMPHASH=23867A89C2B8FC733BE6CF5EF902F2D1*" OR Hashes="*IMPHASH=A37FF327F8D48E8A4D2F757E1B6E70BC*" OR Hashes="*IMPHASH=F9A28C458284584A93B14216308D31BD*" OR Hashes="*IMPHASH=6118619783FC175BC7EBECFF0769B46E*" OR Hashes="*IMPHASH=959A83047E80AB68B368FDB3F4C6E4EA*" OR Hashes="*IMPHASH=563233BFA169ACC7892451F71AD5850A*" OR Hashes="*IMPHASH=87575CB7A0E0700EB37F2E3668671A08*" OR Hashes="*IMPHASH=13F08707F759AF6003837A150A371BA1*" OR Hashes="*IMPHASH=1781F06048A7E58B323F0B9259BE798B*" OR Hashes="*IMPHASH=233F85F2D4BC9D6521A6CAAE11A1E7F5*" OR Hashes="*IMPHASH=24AF2584CBF4D60BBE5C6D1B31B3BE6D*" OR Hashes="*IMPHASH=632969DDF6DBF4E0F53424B75E4B91F2*" OR Hashes="*IMPHASH=713C29B396B907ED71A72482759ED757*" OR Hashes="*IMPHASH=749A7BB1F0B4C4455949C0B2BF7F9E9F*" OR Hashes="*IMPHASH=8628B2608957A6B0C6330AC3DE28CE2E*" OR Hashes="*IMPHASH=8B114550386E31895DFAB371E741123D*" OR Hashes="*IMPHASH=94CB940A1A6B65BED4D5A8F849CE9793*" OR Hashes="*IMPHASH=9D68781980370E00E0BD939EE5E6C141*" OR Hashes="*IMPHASH=B18A1401FF8F444056D29450FBC0A6CE*" OR Hashes="*IMPHASH=CB567F9498452721D77A451374955F5F*" OR Hashes="*IMPHASH=730073214094CD328547BF1F72289752*" OR Hashes="*IMPHASH=17B461A082950FC6332228572138B80C*" OR Hashes="*IMPHASH=DC25EE78E2EF4D36FAA0BADF1E7461C9*" OR Hashes="*IMPHASH=819B19D53CA6736448F9325A85736792*" OR Hashes="*IMPHASH=829DA329CE140D873B4A8BDE2CBFAA7E*" OR Hashes="*IMPHASH=C547F2E66061A8DFFB6F5A3FF63C0A74*" OR Hashes="*IMPHASH=0588081AB0E63BA785938467E1B10CCA*" OR Hashes="*IMPHASH=0D9EC08BAC6C07D9987DFD0F1506587C*" OR Hashes="*IMPHASH=BC129092B71C89B4D4C8CDF8EA590B29*" OR Hashes="*IMPHASH=4DA924CF622D039D58BCE71CDF05D242*" OR Hashes="*IMPHASH=E7A3A5C377E2D29324093377D7DB1C66*" OR Hashes="*IMPHASH=9A9DBEC5C62F0380B4FA5FD31DEFFEDF*" OR Hashes="*IMPHASH=AF8A3976AD71E5D5FDFB67DDB8DADFCE*" OR Hashes="*IMPHASH=0C477898BBF137BBD6F2A54E3B805FF4*" OR Hashes="*IMPHASH=0CA9F02B537BCEA20D4EA5EB1A9FE338*" OR Hashes="*IMPHASH=3AB3655E5A14D4EEFC547F4781BF7F9E*" OR Hashes="*IMPHASH=E6F9D5152DA699934B30DAAB206471F6*" OR Hashes="*IMPHASH=3AD59991CCF1D67339B319B15A41B35D*" OR Hashes="*IMPHASH=FFDD59E0318B85A3E480874D9796D872*" OR Hashes="*IMPHASH=0CF479628D7CC1EA25EC7998A92F5051*" OR Hashes="*IMPHASH=07A2D4DCBD6CB2C6A45E6B101F0B6D51*" OR Hashes="*IMPHASH=D6D0F80386E1380D05CB78E871BC72B1*" OR Hashes="*IMPHASH=38D9E015591BBFD4929E0D0F47FA0055*" OR Hashes="*IMPHASH=0E2216679CA6E1094D63322E3412D650*" OR Hashes="*IMPHASH=ADA161BF41B8E5E9132858CB54CAB5FB*" OR Hashes="*IMPHASH=2A1BC4913CD5ECB0434DF07CB675B798*" OR Hashes="*IMPHASH=11083E75553BAAE21DC89CE8F9A195E4*" OR Hashes="*IMPHASH=A23D29C9E566F2FA8FFBB79267F5DF80*" OR Hashes="*IMPHASH=4A07F944A83E8A7C2525EFA35DD30E2F*" OR Hashes="*IMPHASH=767637C23BB42CD5D7397CF58B0BE688*" OR Hashes="*IMPHASH=14C4E4C72BA075E9069EE67F39188AD8*" OR Hashes="*IMPHASH=3C782813D4AFCE07BBFC5A9772ACDBDC*" OR Hashes="*IMPHASH=7D010C6BB6A3726F327F7E239166D127*" OR Hashes="*IMPHASH=89159BA4DD04E4CE5559F132A9964EB3*" OR Hashes="*IMPHASH=6F33F4A5FC42B8CEC7314947BD13F30F*" OR Hashes="*IMPHASH=5834ED4291BDEB928270428EBBAF7604*" OR Hashes="*IMPHASH=5A8A8A43F25485E7EE1B201EDCBC7A38*" OR Hashes="*IMPHASH=DC7D30B90B2D8ABF664FBED2B1B59894*" OR Hashes="*IMPHASH=41923EA1F824FE63EA5BEB84DB7A3E74*" OR Hashes="*IMPHASH=3DE09703C8E79ED2CA3F01074719906B*" OR Hashes="*IMPHASH=A53A02B997935FD8EEDCB5F7ABAB9B9F*" OR Hashes="*IMPHASH=E96A73C7BF33A464C510EDE582318BF2*" OR Hashes="*IMPHASH=32089B8851BBF8BC2D014E9F37288C83*" OR Hashes="*IMPHASH=09D278F9DE118EF09163C6140255C690*" OR Hashes="*IMPHASH=03866661686829d806989e2fc5a72606*" OR Hashes="*IMPHASH=e57401fbdadcd4571ff385ab82bd5d6d*" OR Hashes="*IMPHASH=84B763C45C0E4A3E7CA5548C710DB4EE*" OR Hashes="*IMPHASH=19584675D94829987952432E018D5056*" OR Hashes="*IMPHASH=330768A4F172E10ACB6287B87289D83B*")))) | eval sigma_attack_tags="" | eval sigma_title="Windows Hacktool Imphash" | eval sigma_description="Detects the use of Windows hacktools based on their import hash (imphash) even if the files have been renamed"
dispatch.earliest_time = -24h@h
alert.track = 0

[HandleKatz LSASS Dumper Usage - winevent]
description = Detects the use of HandleKatz, a tool that demonstrates the usage of cloned handles to Lsass in order to create an obfuscated memory dump of the same
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((New_Process_Name="*\\loader.exe" Process_Command_Line="*--pid:*")) OR ((Imphash="38d9e015591bbfd4929e0d0f47fa0055" OR Imphash="0e2216679ca6e1094d63322e3412d650") OR (Hashes="IMPHASH=38D9E015591BBFD4929E0D0F47FA0055" OR Hashes="IMPHASH=0E2216679CA6E1094D63322E3412D650")) OR ((Process_Command_Line="*--pid:*" Process_Command_Line="*--outfile:*" (Process_Command_Line="*.dmp*" OR Process_Command_Line="*lsass*" OR Process_Command_Line="*.obf*" OR Process_Command_Line="*dump*")))))) | eval sigma_attack_tags="attack.credential_access attack.t1003.001" | eval sigma_title="HandleKatz LSASS Dumper Usage" | eval sigma_description="Detects the use of HandleKatz, a tool that demonstrates the usage of cloned handles to Lsass in order to create an obfuscated memory dump of the same"
dispatch.earliest_time = -24h@h
alert.track = 0

[HandleKatz LSASS Dumper Usage - sysmon]
description = Detects the use of HandleKatz, a tool that demonstrates the usage of cloned handles to Lsass in order to create an obfuscated memory dump of the same
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((Image="*\\loader.exe" CommandLine="*--pid:*")) OR ((Imphash="38d9e015591bbfd4929e0d0f47fa0055" OR Imphash="0e2216679ca6e1094d63322e3412d650") OR (Hashes="IMPHASH=38D9E015591BBFD4929E0D0F47FA0055" OR Hashes="IMPHASH=0E2216679CA6E1094D63322E3412D650")) OR ((CommandLine="*--pid:*" CommandLine="*--outfile:*" (CommandLine="*.dmp*" OR CommandLine="*lsass*" OR CommandLine="*.obf*" OR CommandLine="*dump*")))))) | eval sigma_attack_tags="attack.credential_access attack.t1003.001" | eval sigma_title="HandleKatz LSASS Dumper Usage" | eval sigma_description="Detects the use of HandleKatz, a tool that demonstrates the usage of cloned handles to Lsass in order to create an obfuscated memory dump of the same"
dispatch.earliest_time = -24h@h
alert.track = 0

[File Download with Headless Browser - winevent]
description = This is an unusual method to download files. It starts a browser headless and downloads a file from a location. This can be used by threat actors to download files.
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (New_Process_Name="*\\msedge.exe" OR New_Process_Name="*\\chrome.exe") Process_Command_Line="*--headless*" Process_Command_Line="*dump-dom*" Process_Command_Line="*http*")) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.command_and_control attack.t1105" | eval sigma_title="File Download with Headless Browser" | eval sigma_description="This is an unusual method to download files. It starts a browser headless and downloads a file from a location. This can be used by threat actors to download files."
dispatch.earliest_time = -24h@h
alert.track = 0

[File Download with Headless Browser - sysmon]
description = This is an unusual method to download files. It starts a browser headless and downloads a file from a location. This can be used by threat actors to download files.
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (Image="*\\msedge.exe" OR Image="*\\chrome.exe") CommandLine="*--headless*" CommandLine="*dump-dom*" CommandLine="*http*")) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.command_and_control attack.t1105" | eval sigma_title="File Download with Headless Browser" | eval sigma_description="This is an unusual method to download files. It starts a browser headless and downloads a file from a location. This can be used by threat actors to download files."
dispatch.earliest_time = -24h@h
alert.track = 0

[HH.exe Remote CHM File Execution - winevent]
description = Detects usage of hh.exe to execute/download remotely hosted .chm files.
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\hh.exe" Process_Command_Line="* http*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1218.001" | eval sigma_title="HH.exe Remote CHM File Execution" | eval sigma_description="Detects usage of hh.exe to execute/download remotely hosted .chm files."
dispatch.earliest_time = -24h@h
alert.track = 0

[HH.exe Remote CHM File Execution - sysmon]
description = Detects usage of hh.exe to execute/download remotely hosted .chm files.
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\hh.exe" CommandLine="* http*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1218.001" | eval sigma_title="HH.exe Remote CHM File Execution" | eval sigma_description="Detects usage of hh.exe to execute/download remotely hosted .chm files."
dispatch.earliest_time = -24h@h
alert.track = 0

[HH.exe Execution - winevent]
description = Identifies usage of hh.exe executing recently modified .chm files.
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\hh.exe" Process_Command_Line="*.chm*")) | table ComputerName,Account_Name,Process_Command_Line | eval sigma_attack_tags="attack.defense_evasion attack.t1218.001" | eval sigma_title="HH.exe Execution" | eval sigma_description="Identifies usage of hh.exe executing recently modified .chm files."
dispatch.earliest_time = -24h@h
alert.track = 0

[HH.exe Execution - sysmon]
description = Identifies usage of hh.exe executing recently modified .chm files.
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\hh.exe" CommandLine="*.chm*")) | table ComputerName,User,CommandLine | eval sigma_attack_tags="attack.defense_evasion attack.t1218.001" | eval sigma_title="HH.exe Execution" | eval sigma_description="Identifies usage of hh.exe executing recently modified .chm files."
dispatch.earliest_time = -24h@h
alert.track = 0

[Writing Of Malicious Files To The Fonts Folder - winevent]
description = Monitors for the hiding possible malicious files in the C:\Windows\Fonts\ location. This folder doesn't require admin privillege to be written and executed from.
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (Process_Command_Line="*echo*" OR Process_Command_Line="*copy*" OR Process_Command_Line="*type*" OR Process_Command_Line="*file createnew*" OR Process_Command_Line="*cacls*") Process_Command_Line="*C:\\Windows\\Fonts\\*" (Process_Command_Line="*.sh*" OR Process_Command_Line="*.exe*" OR Process_Command_Line="*.dll*" OR Process_Command_Line="*.bin*" OR Process_Command_Line="*.bat*" OR Process_Command_Line="*.cmd*" OR Process_Command_Line="*.js*" OR Process_Command_Line="*.msh*" OR Process_Command_Line="*.reg*" OR Process_Command_Line="*.scr*" OR Process_Command_Line="*.ps*" OR Process_Command_Line="*.vb*" OR Process_Command_Line="*.jar*" OR Process_Command_Line="*.pl*" OR Process_Command_Line="*.inf*" OR Process_Command_Line="*.cpl*" OR Process_Command_Line="*.hta*" OR Process_Command_Line="*.msi*" OR Process_Command_Line="*.vbs*"))) | table Process_Command_Line,ParentProcess,Process_Command_Line | eval sigma_attack_tags="attack.t1211 attack.t1059 attack.defense_evasion attack.persistence" | eval sigma_title="Writing Of Malicious Files To The Fonts Folder" | eval sigma_description="Monitors for the hiding possible malicious files in the C:\Windows\Fonts\ location. This folder doesn't require admin privillege to be written and executed from."
dispatch.earliest_time = -24h@h
alert.track = 0

[Writing Of Malicious Files To The Fonts Folder - sysmon]
description = Monitors for the hiding possible malicious files in the C:\Windows\Fonts\ location. This folder doesn't require admin privillege to be written and executed from.
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (CommandLine="*echo*" OR CommandLine="*copy*" OR CommandLine="*type*" OR CommandLine="*file createnew*" OR CommandLine="*cacls*") CommandLine="*C:\\Windows\\Fonts\\*" (CommandLine="*.sh*" OR CommandLine="*.exe*" OR CommandLine="*.dll*" OR CommandLine="*.bin*" OR CommandLine="*.bat*" OR CommandLine="*.cmd*" OR CommandLine="*.js*" OR CommandLine="*.msh*" OR CommandLine="*.reg*" OR CommandLine="*.scr*" OR CommandLine="*.ps*" OR CommandLine="*.vb*" OR CommandLine="*.jar*" OR CommandLine="*.pl*" OR CommandLine="*.inf*" OR CommandLine="*.cpl*" OR CommandLine="*.hta*" OR CommandLine="*.msi*" OR CommandLine="*.vbs*"))) | table CommandLine,ParentProcess,CommandLine | eval sigma_attack_tags="attack.t1211 attack.t1059 attack.defense_evasion attack.persistence" | eval sigma_title="Writing Of Malicious Files To The Fonts Folder" | eval sigma_description="Monitors for the hiding possible malicious files in the C:\Windows\Fonts\ location. This folder doesn't require admin privillege to be written and executed from."
dispatch.earliest_time = -24h@h
alert.track = 0

[High Integrity Sdclt Process - winevent]
description = A General detection for sdclt being spawned as an elevated process. This could be an indicator of sdclt being used for bypass UAC techniques.
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*sdclt.exe" IntegrityLevel="High")) | eval sigma_attack_tags="attack.privilege_escalation attack.defense_evasion attack.t1548.002" | eval sigma_title="High Integrity Sdclt Process" | eval sigma_description="A General detection for sdclt being spawned as an elevated process. This could be an indicator of sdclt being used for bypass UAC techniques."
dispatch.earliest_time = -24h@h
alert.track = 0

[High Integrity Sdclt Process - sysmon]
description = A General detection for sdclt being spawned as an elevated process. This could be an indicator of sdclt being used for bypass UAC techniques.
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*sdclt.exe" IntegrityLevel="High")) | eval sigma_attack_tags="attack.privilege_escalation attack.defense_evasion attack.t1548.002" | eval sigma_title="High Integrity Sdclt Process" | eval sigma_description="A General detection for sdclt being spawned as an elevated process. This could be an indicator of sdclt being used for bypass UAC techniques."
dispatch.earliest_time = -24h@h
alert.track = 0

[CreateMiniDump Hacktool - winevent]
description = Detects the use of CreateMiniDump hack tool used to dump the LSASS process memory for credential extraction on the attacker's machine
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\CreateMiniDump.exe" OR Imphash="4a07f944a83e8a7c2525efa35dd30e2f" OR Hashes="*IMPHASH=4a07f944a83e8a7c2525efa35dd30e2f*"))) | eval sigma_attack_tags="attack.credential_access attack.t1003.001" | eval sigma_title="CreateMiniDump Hacktool" | eval sigma_description="Detects the use of CreateMiniDump hack tool used to dump the LSASS process memory for credential extraction on the attacker's machine"
dispatch.earliest_time = -24h@h
alert.track = 0

[CreateMiniDump Hacktool - sysmon]
description = Detects the use of CreateMiniDump hack tool used to dump the LSASS process memory for credential extraction on the attacker's machine
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\CreateMiniDump.exe" OR Imphash="4a07f944a83e8a7c2525efa35dd30e2f" OR Hashes="*IMPHASH=4a07f944a83e8a7c2525efa35dd30e2f*"))) | eval sigma_attack_tags="attack.credential_access attack.t1003.001" | eval sigma_title="CreateMiniDump Hacktool" | eval sigma_description="Detects the use of CreateMiniDump hack tool used to dump the LSASS process memory for credential extraction on the attacker's machine"
dispatch.earliest_time = -24h@h
alert.track = 0

[UAC Bypass Tool UACMe Akagi - winevent]
description = Detects execution of UACMe (a tool used for UAC bypass) via default PE metadata
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (Product="UACMe" OR (Company="REvol Corp" OR Company="APT 92" OR Company="UG North" OR Company="Hazardous Environments" OR Company="CD Project Rekt") OR (Description="UACMe main module" OR Description="Pentesting utility") OR (OriginalFileName="Akagi.exe" OR OriginalFileName="Akagi64.exe") OR (New_Process_Name="*\\Akagi64.exe" OR New_Process_Name="*\\Akagi.exe") OR (Hashes="*IMPHASH=767637C23BB42CD5D7397CF58B0BE688*" OR Hashes="*IMPHASH=14C4E4C72BA075E9069EE67F39188AD8*" OR Hashes="*IMPHASH=3C782813D4AFCE07BBFC5A9772ACDBDC*" OR Hashes="*IMPHASH=7D010C6BB6A3726F327F7E239166D127*" OR Hashes="*IMPHASH=89159BA4DD04E4CE5559F132A9964EB3*" OR Hashes="*IMPHASH=6F33F4A5FC42B8CEC7314947BD13F30F*" OR Hashes="*IMPHASH=5834ED4291BDEB928270428EBBAF7604*" OR Hashes="*IMPHASH=5A8A8A43F25485E7EE1B201EDCBC7A38*" OR Hashes="*IMPHASH=DC7D30B90B2D8ABF664FBED2B1B59894*" OR Hashes="*IMPHASH=41923EA1F824FE63EA5BEB84DB7A3E74*" OR Hashes="*IMPHASH=3DE09703C8E79ED2CA3F01074719906B*") OR (Imphash="767637c23bb42cd5d7397cf58b0be688" OR Imphash="14c4e4c72ba075e9069ee67f39188ad8" OR Imphash="3c782813d4afce07bbfc5a9772acdbdc" OR Imphash="7d010c6bb6a3726f327f7e239166d127" OR Imphash="89159ba4dd04e4ce5559f132a9964eb3" OR Imphash="6f33f4a5fc42b8cec7314947bd13f30f" OR Imphash="5834ed4291bdeb928270428ebbaf7604" OR Imphash="5a8a8a43f25485e7ee1b201edcbc7a38" OR Imphash="dc7d30b90b2d8abf664fbed2b1b59894" OR Imphash="41923ea1f824fe63ea5beb84db7a3e74" OR Imphash="3de09703c8e79ed2ca3f01074719906b")))) | eval sigma_attack_tags="attack.defense_evasion attack.privilege_escalation attack.t1548.002" | eval sigma_title="UAC Bypass Tool UACMe Akagi" | eval sigma_description="Detects execution of UACMe (a tool used for UAC bypass) via default PE metadata"
dispatch.earliest_time = -24h@h
alert.track = 0

[UAC Bypass Tool UACMe Akagi - sysmon]
description = Detects execution of UACMe (a tool used for UAC bypass) via default PE metadata
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Product="UACMe" OR (Company="REvol Corp" OR Company="APT 92" OR Company="UG North" OR Company="Hazardous Environments" OR Company="CD Project Rekt") OR (Description="UACMe main module" OR Description="Pentesting utility") OR (OriginalFileName="Akagi.exe" OR OriginalFileName="Akagi64.exe") OR (Image="*\\Akagi64.exe" OR Image="*\\Akagi.exe") OR (Hashes="*IMPHASH=767637C23BB42CD5D7397CF58B0BE688*" OR Hashes="*IMPHASH=14C4E4C72BA075E9069EE67F39188AD8*" OR Hashes="*IMPHASH=3C782813D4AFCE07BBFC5A9772ACDBDC*" OR Hashes="*IMPHASH=7D010C6BB6A3726F327F7E239166D127*" OR Hashes="*IMPHASH=89159BA4DD04E4CE5559F132A9964EB3*" OR Hashes="*IMPHASH=6F33F4A5FC42B8CEC7314947BD13F30F*" OR Hashes="*IMPHASH=5834ED4291BDEB928270428EBBAF7604*" OR Hashes="*IMPHASH=5A8A8A43F25485E7EE1B201EDCBC7A38*" OR Hashes="*IMPHASH=DC7D30B90B2D8ABF664FBED2B1B59894*" OR Hashes="*IMPHASH=41923EA1F824FE63EA5BEB84DB7A3E74*" OR Hashes="*IMPHASH=3DE09703C8E79ED2CA3F01074719906B*") OR (Imphash="767637c23bb42cd5d7397cf58b0be688" OR Imphash="14c4e4c72ba075e9069ee67f39188ad8" OR Imphash="3c782813d4afce07bbfc5a9772acdbdc" OR Imphash="7d010c6bb6a3726f327f7e239166d127" OR Imphash="89159ba4dd04e4ce5559f132a9964eb3" OR Imphash="6f33f4a5fc42b8cec7314947bd13f30f" OR Imphash="5834ed4291bdeb928270428ebbaf7604" OR Imphash="5a8a8a43f25485e7ee1b201edcbc7a38" OR Imphash="dc7d30b90b2d8abf664fbed2b1b59894" OR Imphash="41923ea1f824fe63ea5beb84db7a3e74" OR Imphash="3de09703c8e79ed2ca3f01074719906b")))) | eval sigma_attack_tags="attack.defense_evasion attack.privilege_escalation attack.t1548.002" | eval sigma_title="UAC Bypass Tool UACMe Akagi" | eval sigma_description="Detects execution of UACMe (a tool used for UAC bypass) via default PE metadata"
dispatch.earliest_time = -24h@h
alert.track = 0

[HTML Help Shell Spawn - winevent]
description = Detects a suspicious child process of a Microsoft HTML Help system when executing compiled HTML files (.chm)
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((((Creator_Process_Name="C:\\Windows\\hh.exe" OR Creator_Process_Name="C:\\Windows\\SysWOW64\\hh.exe") (New_Process_Name="*\\cmd.exe" OR New_Process_Name="*\\powershell.exe" OR New_Process_Name="*\\pwsh.exe" OR New_Process_Name="*\\wscript.exe" OR New_Process_Name="*\\cscript.exe" OR New_Process_Name="*\\regsvr32.exe" OR New_Process_Name="*\\wmic.exe" OR New_Process_Name="*\\rundll32.exe" OR New_Process_Name="*\\MSHTA.EXE" OR New_Process_Name="*\\CertUtil.exe" OR New_Process_Name="*\\CertReq.exe" OR New_Process_Name="*\\MSbuild.exe" OR New_Process_Name="*\\installutil.exe" OR New_Process_Name="*\\schtasks.exe" OR New_Process_Name="*\\msiexec.exe"))) OR (((New_Process_Name="*\\Windows\\hh.exe" OR New_Process_Name="*\\Windows\\SysWOW64\\hh.exe") (Process_Command_Line="*.application*" OR Process_Command_Line="*\\Downloads\\*" OR Process_Command_Line="*\\Content.Outlook\\*" OR Process_Command_Line="*\\AppData\\Local\\Temp\\*")))))) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.t1218.001 attack.t1218.010 attack.t1218.011 attack.execution attack.t1059.001 attack.t1059.003 attack.t1059.005 attack.t1059.007 attack.t1047 attack.t1566 attack.t1566.001 attack.initial_access attack.t1218" | eval sigma_title="HTML Help Shell Spawn" | eval sigma_description="Detects a suspicious child process of a Microsoft HTML Help system when executing compiled HTML files (.chm)"
dispatch.earliest_time = -24h@h
alert.track = 0

[HTML Help Shell Spawn - sysmon]
description = Detects a suspicious child process of a Microsoft HTML Help system when executing compiled HTML files (.chm)
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((((ParentImage="C:\\Windows\\hh.exe" OR ParentImage="C:\\Windows\\SysWOW64\\hh.exe") (Image="*\\cmd.exe" OR Image="*\\powershell.exe" OR Image="*\\pwsh.exe" OR Image="*\\wscript.exe" OR Image="*\\cscript.exe" OR Image="*\\regsvr32.exe" OR Image="*\\wmic.exe" OR Image="*\\rundll32.exe" OR Image="*\\MSHTA.EXE" OR Image="*\\CertUtil.exe" OR Image="*\\CertReq.exe" OR Image="*\\MSbuild.exe" OR Image="*\\installutil.exe" OR Image="*\\schtasks.exe" OR Image="*\\msiexec.exe"))) OR (((Image="*\\Windows\\hh.exe" OR Image="*\\Windows\\SysWOW64\\hh.exe") (CommandLine="*.application*" OR CommandLine="*\\Downloads\\*" OR CommandLine="*\\Content.Outlook\\*" OR CommandLine="*\\AppData\\Local\\Temp\\*")))))) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.t1218.001 attack.t1218.010 attack.t1218.011 attack.execution attack.t1059.001 attack.t1059.003 attack.t1059.005 attack.t1059.007 attack.t1047 attack.t1566 attack.t1566.001 attack.initial_access attack.t1218" | eval sigma_title="HTML Help Shell Spawn" | eval sigma_description="Detects a suspicious child process of a Microsoft HTML Help system when executing compiled HTML files (.chm)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious HWP Sub Processes - winevent]
description = Detects suspicious Hangul Word Processor (Hanword) sub processes that could indicate an exploitation
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Creator_Process_Name="*\\Hwp.exe" New_Process_Name="*\\gbb.exe")) | eval sigma_attack_tags="attack.initial_access attack.t1566.001 attack.execution attack.t1203 attack.t1059.003 attack.g0032" | eval sigma_title="Suspicious HWP Sub Processes" | eval sigma_description="Detects suspicious Hangul Word Processor (Hanword) sub processes that could indicate an exploitation"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious HWP Sub Processes - sysmon]
description = Detects suspicious Hangul Word Processor (Hanword) sub processes that could indicate an exploitation
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") ParentImage="*\\Hwp.exe" Image="*\\gbb.exe")) | eval sigma_attack_tags="attack.initial_access attack.t1566.001 attack.execution attack.t1203 attack.t1059.003 attack.g0032" | eval sigma_title="Suspicious HWP Sub Processes" | eval sigma_description="Detects suspicious Hangul Word Processor (Hanword) sub processes that could indicate an exploitation"
dispatch.earliest_time = -24h@h
alert.track = 0

[Use Icacls to Hide File to Everyone - winevent]
description = Detect use of icacls to deny access for everyone in Users folder sometimes used to hide malicious files
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (OriginalFileName="iCACLS.EXE" OR New_Process_Name="*\\icacls.exe") ((Process_Command_Line="*C:\\Users\\*" Process_Command_Line="*/deny*" Process_Command_Line="*S-1-1-0:*")))) | eval sigma_attack_tags="attack.defense_evasion attack.t1564.001" | eval sigma_title="Use Icacls to Hide File to Everyone" | eval sigma_description="Detect use of icacls to deny access for everyone in Users folder sometimes used to hide malicious files"
dispatch.earliest_time = -24h@h
alert.track = 0

[Use Icacls to Hide File to Everyone - sysmon]
description = Detect use of icacls to deny access for everyone in Users folder sometimes used to hide malicious files
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (OriginalFileName="iCACLS.EXE" OR Image="*\\icacls.exe") ((CommandLine="*C:\\Users\\*" CommandLine="*/deny*" CommandLine="*S-1-1-0:*")))) | eval sigma_attack_tags="attack.defense_evasion attack.t1564.001" | eval sigma_title="Use Icacls to Hide File to Everyone" | eval sigma_description="Detect use of icacls to deny access for everyone in Users folder sometimes used to hide malicious files"
dispatch.earliest_time = -24h@h
alert.track = 0

[Disable Windows IIS HTTP Logging - winevent]
description = Disables HTTP logging on a Windows IIS web server as seen by Threat Group 3390 (Bronze Union)
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\appcmd.exe" OR OriginalFileName="appcmd.exe") ((Process_Command_Line="*set*" Process_Command_Line="*config*" Process_Command_Line="*section:httplogging*" Process_Command_Line="*dontLog:true*")))) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.002" | eval sigma_title="Disable Windows IIS HTTP Logging" | eval sigma_description="Disables HTTP logging on a Windows IIS web server as seen by Threat Group 3390 (Bronze Union)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Disable Windows IIS HTTP Logging - sysmon]
description = Disables HTTP logging on a Windows IIS web server as seen by Threat Group 3390 (Bronze Union)
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\appcmd.exe" OR OriginalFileName="appcmd.exe") ((CommandLine="*set*" CommandLine="*config*" CommandLine="*section:httplogging*" CommandLine="*dontLog:true*")))) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.002" | eval sigma_title="Disable Windows IIS HTTP Logging" | eval sigma_description="Disables HTTP logging on a Windows IIS web server as seen by Threat Group 3390 (Bronze Union)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Microsoft IIS Service Account Password Dumped - winevent]
description = Detects the Internet Information Services (IIS) command-line tool, AppCmd, being used to list passwords
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((New_Process_Name="*\\appcmd.exe" OR OriginalFileName="appcmd.exe") Process_Command_Line="*list *")) ((Process_Command_Line="* /config*" OR Process_Command_Line="* /xml*" OR Process_Command_Line="* -config*" OR Process_Command_Line="* -xml*") OR (((Process_Command_Line="* /@t*" OR Process_Command_Line="* /text*" OR Process_Command_Line="* /show*" OR Process_Command_Line="* -@t*" OR Process_Command_Line="* -text*" OR Process_Command_Line="* -show*") (Process_Command_Line="*:\*" OR Process_Command_Line="*password*")))))) | eval sigma_attack_tags="attack.credential_access attack.t1003" | eval sigma_title="Microsoft IIS Service Account Password Dumped" | eval sigma_description="Detects the Internet Information Services (IIS) command-line tool, AppCmd, being used to list passwords"
dispatch.earliest_time = -24h@h
alert.track = 0

[Microsoft IIS Service Account Password Dumped - sysmon]
description = Detects the Internet Information Services (IIS) command-line tool, AppCmd, being used to list passwords
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((Image="*\\appcmd.exe" OR OriginalFileName="appcmd.exe") CommandLine="*list *")) ((CommandLine="* /config*" OR CommandLine="* /xml*" OR CommandLine="* -config*" OR CommandLine="* -xml*") OR (((CommandLine="* /@t*" OR CommandLine="* /text*" OR CommandLine="* /show*" OR CommandLine="* -@t*" OR CommandLine="* -text*" OR CommandLine="* -show*") (CommandLine="*:\*" OR CommandLine="*password*")))))) | eval sigma_attack_tags="attack.credential_access attack.t1003" | eval sigma_title="Microsoft IIS Service Account Password Dumped" | eval sigma_description="Detects the Internet Information Services (IIS) command-line tool, AppCmd, being used to list passwords"
dispatch.earliest_time = -24h@h
alert.track = 0

[IIS Native-Code Module Command Line Installation - winevent]
description = Detects suspicious IIS native-code module installations via command line
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((New_Process_Name="*\\appcmd.exe" OR OriginalFileName="appcmd.exe") ((Process_Command_Line="*install*" Process_Command_Line="*module*" (Process_Command_Line="*/name:*" OR Process_Command_Line="*-name:*"))))) NOT (((Creator_Process_Name="C:\\Windows\\System32\\inetsrv\\iissetup.exe"))))) | eval sigma_attack_tags="attack.persistence attack.t1505.003" | eval sigma_title="IIS Native-Code Module Command Line Installation" | eval sigma_description="Detects suspicious IIS native-code module installations via command line"
dispatch.earliest_time = -24h@h
alert.track = 0

[IIS Native-Code Module Command Line Installation - sysmon]
description = Detects suspicious IIS native-code module installations via command line
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((Image="*\\appcmd.exe" OR OriginalFileName="appcmd.exe") ((CommandLine="*install*" CommandLine="*module*" (CommandLine="*/name:*" OR CommandLine="*-name:*"))))) NOT (((ParentImage="C:\\Windows\\System32\\inetsrv\\iissetup.exe"))))) | eval sigma_attack_tags="attack.persistence attack.t1505.003" | eval sigma_title="IIS Native-Code Module Command Line Installation" | eval sigma_description="Detects suspicious IIS native-code module installations via command line"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious IIS URL GlobalRules Rewrite Via AppCmd - winevent]
description = Detects usage of 'appcmd' to create new global URL rewrite rules. This behaviour has been observed being used by threat actors to add new rules so they can access their webshells.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\appcmd.exe" OR OriginalFileName="appcmd.exe") ((Process_Command_Line="*set*" Process_Command_Line="*config*" Process_Command_Line="*section:system.webServer/rewrite/globalRules*" Process_Command_Line="*commit:*")))) | eval sigma_attack_tags="attack.defense_evasion" | eval sigma_title="Suspicious IIS URL GlobalRules Rewrite Via AppCmd" | eval sigma_description="Detects usage of 'appcmd' to create new global URL rewrite rules. This behaviour has been observed being used by threat actors to add new rules so they can access their webshells."
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious IIS URL GlobalRules Rewrite Via AppCmd - sysmon]
description = Detects usage of 'appcmd' to create new global URL rewrite rules. This behaviour has been observed being used by threat actors to add new rules so they can access their webshells.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\appcmd.exe" OR OriginalFileName="appcmd.exe") ((CommandLine="*set*" CommandLine="*config*" CommandLine="*section:system.webServer/rewrite/globalRules*" CommandLine="*commit:*")))) | eval sigma_attack_tags="attack.defense_evasion" | eval sigma_title="Suspicious IIS URL GlobalRules Rewrite Via AppCmd" | eval sigma_description="Detects usage of 'appcmd' to create new global URL rewrite rules. This behaviour has been observed being used by threat actors to add new rules so they can access their webshells."
dispatch.earliest_time = -24h@h
alert.track = 0

[Microsoft IIS Connection Strings Decryption - winevent]
description = Detects use of aspnet_regiis to decrypt Microsoft IIS connection strings. An attacker with Microsoft IIS web server access via a webshell or alike can decrypt and dump any hardcoded connection strings, such as the MSSQL service account password using aspnet_regiis command.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\aspnet_regiis.exe" OR OriginalFileName="aspnet_regiis.exe") ((Process_Command_Line="*connectionStrings*" Process_Command_Line="* -pdf*")))) | eval sigma_attack_tags="attack.credential_access attack.t1003" | eval sigma_title="Microsoft IIS Connection Strings Decryption" | eval sigma_description="Detects use of aspnet_regiis to decrypt Microsoft IIS connection strings. An attacker with Microsoft IIS web server access via a webshell or alike can decrypt and dump any hardcoded connection strings, such as the MSSQL service account password using aspnet_regiis command."
dispatch.earliest_time = -24h@h
alert.track = 0

[Microsoft IIS Connection Strings Decryption - sysmon]
description = Detects use of aspnet_regiis to decrypt Microsoft IIS connection strings. An attacker with Microsoft IIS web server access via a webshell or alike can decrypt and dump any hardcoded connection strings, such as the MSSQL service account password using aspnet_regiis command.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\aspnet_regiis.exe" OR OriginalFileName="aspnet_regiis.exe") ((CommandLine="*connectionStrings*" CommandLine="* -pdf*")))) | eval sigma_attack_tags="attack.credential_access attack.t1003" | eval sigma_title="Microsoft IIS Connection Strings Decryption" | eval sigma_description="Detects use of aspnet_regiis to decrypt Microsoft IIS connection strings. An attacker with Microsoft IIS web server access via a webshell or alike can decrypt and dump any hardcoded connection strings, such as the MSSQL service account password using aspnet_regiis command."
dispatch.earliest_time = -24h@h
alert.track = 0

[ImagingDevices Unusual Parent/Child Processes - winevent]
description = Detects unusual parent or children of the ImagingDevices.exe (Windows Contacts) and Wabmig.exe (Microsoft Address Book Import Tool) processes as seen being used with bumblebee activity
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((((Creator_Process_Name="*\\WmiPrvSE.exe" OR Creator_Process_Name="*\\svchost.exe" OR Creator_Process_Name="*\\dllhost.exe") New_Process_Name="*\\ImagingDevices.exe")) OR Creator_Process_Name="*\\ImagingDevices.exe"))) | eval sigma_attack_tags="attack.defense_evasion attack.execution" | eval sigma_title="ImagingDevices Unusual Parent/Child Processes" | eval sigma_description="Detects unusual parent or children of the ImagingDevices.exe (Windows Contacts) and Wabmig.exe (Microsoft Address Book Import Tool) processes as seen being used with bumblebee activity"
dispatch.earliest_time = -24h@h
alert.track = 0

[ImagingDevices Unusual Parent/Child Processes - sysmon]
description = Detects unusual parent or children of the ImagingDevices.exe (Windows Contacts) and Wabmig.exe (Microsoft Address Book Import Tool) processes as seen being used with bumblebee activity
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((((ParentImage="*\\WmiPrvSE.exe" OR ParentImage="*\\svchost.exe" OR ParentImage="*\\dllhost.exe") Image="*\\ImagingDevices.exe")) OR ParentImage="*\\ImagingDevices.exe"))) | eval sigma_attack_tags="attack.defense_evasion attack.execution" | eval sigma_title="ImagingDevices Unusual Parent/Child Processes" | eval sigma_description="Detects unusual parent or children of the ImagingDevices.exe (Windows Contacts) and Wabmig.exe (Microsoft Address Book Import Tool) processes as seen being used with bumblebee activity"
dispatch.earliest_time = -24h@h
alert.track = 0

[Impacket Tool Execution - winevent]
description = Detects the execution of different compiled Windows binaries of the impacket toolset (based on names or part of their names - could lead to false positives)
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\goldenPac*" OR New_Process_Name="*\\karmaSMB*" OR New_Process_Name="*\\kintercept*" OR New_Process_Name="*\\ntlmrelayx*" OR New_Process_Name="*\\rpcdump*" OR New_Process_Name="*\\samrdump*" OR New_Process_Name="*\\secretsdump*" OR New_Process_Name="*\\smbexec*" OR New_Process_Name="*\\smbrelayx*" OR New_Process_Name="*\\wmiexec*" OR New_Process_Name="*\\wmipersist*") OR (New_Process_Name="*\\atexec_windows.exe" OR New_Process_Name="*\\dcomexec_windows.exe" OR New_Process_Name="*\\dpapi_windows.exe" OR New_Process_Name="*\\findDelegation_windows.exe" OR New_Process_Name="*\\GetADUsers_windows.exe" OR New_Process_Name="*\\GetNPUsers_windows.exe" OR New_Process_Name="*\\getPac_windows.exe" OR New_Process_Name="*\\getST_windows.exe" OR New_Process_Name="*\\getTGT_windows.exe" OR New_Process_Name="*\\GetUserSPNs_windows.exe" OR New_Process_Name="*\\ifmap_windows.exe" OR New_Process_Name="*\\mimikatz_windows.exe" OR New_Process_Name="*\\netview_windows.exe" OR New_Process_Name="*\\nmapAnswerMachine_windows.exe" OR New_Process_Name="*\\opdump_windows.exe" OR New_Process_Name="*\\psexec_windows.exe" OR New_Process_Name="*\\rdp_check_windows.exe" OR New_Process_Name="*\\sambaPipe_windows.exe" OR New_Process_Name="*\\smbclient_windows.exe" OR New_Process_Name="*\\smbserver_windows.exe" OR New_Process_Name="*\\sniffer_windows.exe" OR New_Process_Name="*\\sniff_windows.exe" OR New_Process_Name="*\\split_windows.exe" OR New_Process_Name="*\\ticketer_windows.exe")))) | eval sigma_attack_tags="attack.execution attack.t1557.001" | eval sigma_title="Impacket Tool Execution" | eval sigma_description="Detects the execution of different compiled Windows binaries of the impacket toolset (based on names or part of their names - could lead to false positives)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Impacket Tool Execution - sysmon]
description = Detects the execution of different compiled Windows binaries of the impacket toolset (based on names or part of their names - could lead to false positives)
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\goldenPac*" OR Image="*\\karmaSMB*" OR Image="*\\kintercept*" OR Image="*\\ntlmrelayx*" OR Image="*\\rpcdump*" OR Image="*\\samrdump*" OR Image="*\\secretsdump*" OR Image="*\\smbexec*" OR Image="*\\smbrelayx*" OR Image="*\\wmiexec*" OR Image="*\\wmipersist*") OR (Image="*\\atexec_windows.exe" OR Image="*\\dcomexec_windows.exe" OR Image="*\\dpapi_windows.exe" OR Image="*\\findDelegation_windows.exe" OR Image="*\\GetADUsers_windows.exe" OR Image="*\\GetNPUsers_windows.exe" OR Image="*\\getPac_windows.exe" OR Image="*\\getST_windows.exe" OR Image="*\\getTGT_windows.exe" OR Image="*\\GetUserSPNs_windows.exe" OR Image="*\\ifmap_windows.exe" OR Image="*\\mimikatz_windows.exe" OR Image="*\\netview_windows.exe" OR Image="*\\nmapAnswerMachine_windows.exe" OR Image="*\\opdump_windows.exe" OR Image="*\\psexec_windows.exe" OR Image="*\\rdp_check_windows.exe" OR Image="*\\sambaPipe_windows.exe" OR Image="*\\smbclient_windows.exe" OR Image="*\\smbserver_windows.exe" OR Image="*\\sniffer_windows.exe" OR Image="*\\sniff_windows.exe" OR Image="*\\split_windows.exe" OR Image="*\\ticketer_windows.exe")))) | eval sigma_attack_tags="attack.execution attack.t1557.001" | eval sigma_title="Impacket Tool Execution" | eval sigma_description="Detects the execution of different compiled Windows binaries of the impacket toolset (based on names or part of their names - could lead to false positives)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential Impacket Lateral Movement Activity - winevent]
description = Detects wmiexec/dcomexec/atexec/smbexec from Impacket framework
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((((Creator_Process_Name="*\\wmiprvse.exe" OR Creator_Process_Name="*\\mmc.exe" OR Creator_Process_Name="*\\explorer.exe" OR Creator_Process_Name="*\\services.exe") Process_Command_Line="*cmd.exe*" Process_Command_Line="*/Q*" Process_Command_Line="*/c*" Process_Command_Line="*\\\\127.0.0.1\\\*" Process_Command_Line="*&1*")) OR (((ParentCommandLine="*svchost.exe -k netsvcs*" OR ParentCommandLine="*taskeng.exe*") Process_Command_Line="*cmd.exe*" Process_Command_Line="*/C*" Process_Command_Line="*Windows\\Temp\\*" Process_Command_Line="*&1*"))))) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.execution attack.t1047 attack.lateral_movement attack.t1021.003" | eval sigma_title="Potential Impacket Lateral Movement Activity" | eval sigma_description="Detects wmiexec/dcomexec/atexec/smbexec from Impacket framework"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential Impacket Lateral Movement Activity - sysmon]
description = Detects wmiexec/dcomexec/atexec/smbexec from Impacket framework
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((((ParentImage="*\\wmiprvse.exe" OR ParentImage="*\\mmc.exe" OR ParentImage="*\\explorer.exe" OR ParentImage="*\\services.exe") CommandLine="*cmd.exe*" CommandLine="*/Q*" CommandLine="*/c*" CommandLine="*\\\\127.0.0.1\\\*" CommandLine="*&1*")) OR (((ParentCommandLine="*svchost.exe -k netsvcs*" OR ParentCommandLine="*taskeng.exe*") CommandLine="*cmd.exe*" CommandLine="*/C*" CommandLine="*Windows\\Temp\\*" CommandLine="*&1*"))))) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.execution attack.t1047 attack.lateral_movement attack.t1021.003" | eval sigma_title="Potential Impacket Lateral Movement Activity" | eval sigma_description="Detects wmiexec/dcomexec/atexec/smbexec from Impacket framework"
dispatch.earliest_time = -24h@h
alert.track = 0

[Impersonate Execution - winevent]
description = Detects execution of the Impersonate tool. Which can be used to manipulate tokens on a Windows computers remotely (PsExec/WmiExec) or interactively
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((Process_Command_Line="*impersonate.exe*" (Process_Command_Line="* list *" OR Process_Command_Line="* exec *" OR Process_Command_Line="* adduser *"))) OR ((Hashes="*MD5=9520714AB576B0ED01D1513691377D01*" OR Hashes="*SHA256=E81CC96E2118DC4FBFE5BAD1604E0AC7681960143E2101E1A024D52264BB0A8A*" OR Hashes="*IMPHASH=0A358FFC1697B7A07D0E817AC740DF62*") OR md5="9520714AB576B0ED01D1513691377D01" OR sha256="E81CC96E2118DC4FBFE5BAD1604E0AC7681960143E2101E1A024D52264BB0A8A" OR Imphash="0A358FFC1697B7A07D0E817AC740DF62")))) | eval sigma_attack_tags="attack.privilege_escalation attack.defense_evasion attack.t1134.001 attack.t1134.003" | eval sigma_title="Impersonate Execution" | eval sigma_description="Detects execution of the Impersonate tool. Which can be used to manipulate tokens on a Windows computers remotely (PsExec/WmiExec) or interactively"
dispatch.earliest_time = -24h@h
alert.track = 0

[Impersonate Execution - sysmon]
description = Detects execution of the Impersonate tool. Which can be used to manipulate tokens on a Windows computers remotely (PsExec/WmiExec) or interactively
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((CommandLine="*impersonate.exe*" (CommandLine="* list *" OR CommandLine="* exec *" OR CommandLine="* adduser *"))) OR ((Hashes="*MD5=9520714AB576B0ED01D1513691377D01*" OR Hashes="*SHA256=E81CC96E2118DC4FBFE5BAD1604E0AC7681960143E2101E1A024D52264BB0A8A*" OR Hashes="*IMPHASH=0A358FFC1697B7A07D0E817AC740DF62*") OR md5="9520714AB576B0ED01D1513691377D01" OR sha256="E81CC96E2118DC4FBFE5BAD1604E0AC7681960143E2101E1A024D52264BB0A8A" OR Imphash="0A358FFC1697B7A07D0E817AC740DF62")))) | eval sigma_attack_tags="attack.privilege_escalation attack.defense_evasion attack.t1134.001 attack.t1134.003" | eval sigma_title="Impersonate Execution" | eval sigma_description="Detects execution of the Impersonate tool. Which can be used to manipulate tokens on a Windows computers remotely (PsExec/WmiExec) or interactively"
dispatch.earliest_time = -24h@h
alert.track = 0

[Root Certificate Installed From Susp Locations - winevent]
description = Adversaries may install a root certificate on a compromised system to avoid warnings when connecting to adversary controlled web servers.
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*Import-Certificate*" Process_Command_Line="* -FilePath *" Process_Command_Line="*Cert:\\LocalMachine\\Root*" (Process_Command_Line="*\\AppData\\Local\\Temp\\*" OR Process_Command_Line="*:\\Windows\\TEMP\\*" OR Process_Command_Line="*\\Desktop\\*" OR Process_Command_Line="*\\Downloads\\*" OR Process_Command_Line="*\\Perflogs\\*" OR Process_Command_Line="*:\\Users\\Public\\*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1553.004" | eval sigma_title="Root Certificate Installed From Susp Locations" | eval sigma_description="Adversaries may install a root certificate on a compromised system to avoid warnings when connecting to adversary controlled web servers."
dispatch.earliest_time = -24h@h
alert.track = 0

[Root Certificate Installed From Susp Locations - sysmon]
description = Adversaries may install a root certificate on a compromised system to avoid warnings when connecting to adversary controlled web servers.
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*Import-Certificate*" CommandLine="* -FilePath *" CommandLine="*Cert:\\LocalMachine\\Root*" (CommandLine="*\\AppData\\Local\\Temp\\*" OR CommandLine="*:\\Windows\\TEMP\\*" OR CommandLine="*\\Desktop\\*" OR CommandLine="*\\Downloads\\*" OR CommandLine="*\\Perflogs\\*" OR CommandLine="*:\\Users\\Public\\*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1553.004" | eval sigma_title="Root Certificate Installed From Susp Locations" | eval sigma_description="Adversaries may install a root certificate on a compromised system to avoid warnings when connecting to adversary controlled web servers."
dispatch.earliest_time = -24h@h
alert.track = 0

[Import PowerShell Modules From Suspicious Directories - ProcCreation - winevent]
description = Detects powershell scripts that import modules from suspicious directories
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (Process_Command_Line="*Import-Module \"$Env:Temp\\*" OR Process_Command_Line="*Import-Module '$Env:Temp\\*" OR Process_Command_Line="*Import-Module $Env:Temp\\*" OR Process_Command_Line="*Import-Module \"$Env:Appdata\\*" OR Process_Command_Line="*Import-Module '$Env:Appdata\\*" OR Process_Command_Line="*Import-Module $Env:Appdata\\*" OR Process_Command_Line="*Import-Module C:\\Users\\Public\\*" OR Process_Command_Line="*ipmo \"$Env:Temp\\*" OR Process_Command_Line="*ipmo '$Env:Temp\\*" OR Process_Command_Line="*ipmo $Env:Temp\\*" OR Process_Command_Line="*ipmo \"$Env:Appdata\\*" OR Process_Command_Line="*ipmo '$Env:Appdata\\*" OR Process_Command_Line="*ipmo $Env:Appdata\\*" OR Process_Command_Line="*ipmo C:\\Users\\Public\\*"))) | eval sigma_attack_tags="attack.execution attack.t1059.001" | eval sigma_title="Import PowerShell Modules From Suspicious Directories - ProcCreation" | eval sigma_description="Detects powershell scripts that import modules from suspicious directories"
dispatch.earliest_time = -24h@h
alert.track = 0

[Import PowerShell Modules From Suspicious Directories - ProcCreation - sysmon]
description = Detects powershell scripts that import modules from suspicious directories
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (CommandLine="*Import-Module \"$Env:Temp\\*" OR CommandLine="*Import-Module '$Env:Temp\\*" OR CommandLine="*Import-Module $Env:Temp\\*" OR CommandLine="*Import-Module \"$Env:Appdata\\*" OR CommandLine="*Import-Module '$Env:Appdata\\*" OR CommandLine="*Import-Module $Env:Appdata\\*" OR CommandLine="*Import-Module C:\\Users\\Public\\*" OR CommandLine="*ipmo \"$Env:Temp\\*" OR CommandLine="*ipmo '$Env:Temp\\*" OR CommandLine="*ipmo $Env:Temp\\*" OR CommandLine="*ipmo \"$Env:Appdata\\*" OR CommandLine="*ipmo '$Env:Appdata\\*" OR CommandLine="*ipmo $Env:Appdata\\*" OR CommandLine="*ipmo C:\\Users\\Public\\*"))) | eval sigma_attack_tags="attack.execution attack.t1059.001" | eval sigma_title="Import PowerShell Modules From Suspicious Directories - ProcCreation" | eval sigma_description="Detects powershell scripts that import modules from suspicious directories"
dispatch.earliest_time = -24h@h
alert.track = 0

[Base64 MZ Header In CommandLine - winevent]
description = Detects encoded base64 MZ header in the commandline
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (Process_Command_Line="*TVqQAAMAAAAEAAAA*" OR Process_Command_Line="*TVpQAAIAAAAEAA8A*" OR Process_Command_Line="*TVqAAAEAAAAEABAA*" OR Process_Command_Line="*TVoAAAAAAAAAAAAA*" OR Process_Command_Line="*TVpTAQEAAAAEAAAA*"))) | eval sigma_attack_tags="attack.execution" | eval sigma_title="Base64 MZ Header In CommandLine" | eval sigma_description="Detects encoded base64 MZ header in the commandline"
dispatch.earliest_time = -24h@h
alert.track = 0

[Base64 MZ Header In CommandLine - sysmon]
description = Detects encoded base64 MZ header in the commandline
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (CommandLine="*TVqQAAMAAAAEAAAA*" OR CommandLine="*TVpQAAIAAAAEAA8A*" OR CommandLine="*TVqAAAEAAAAEABAA*" OR CommandLine="*TVoAAAAAAAAAAAAA*" OR CommandLine="*TVpTAQEAAAAEAAAA*"))) | eval sigma_attack_tags="attack.execution" | eval sigma_title="Base64 MZ Header In CommandLine" | eval sigma_description="Detects encoded base64 MZ header in the commandline"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential WinAPI Calls Via CommandLine - winevent]
description = Detects the use of WinAPI Functions via the commandline. As seen used by threat actors via the tool winapiexec
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (Process_Command_Line="*AddSecurityPackage*" OR Process_Command_Line="*AdjustTokenPrivileges*" OR Process_Command_Line="*Advapi32*" OR Process_Command_Line="*CloseHandle*" OR Process_Command_Line="*CreateProcessWithToken*" OR Process_Command_Line="*CreatePseudoConsole*" OR Process_Command_Line="*CreateRemoteThread*" OR Process_Command_Line="*CreateThread*" OR Process_Command_Line="*CreateUserThread*" OR Process_Command_Line="*DangerousGetHandle*" OR Process_Command_Line="*DuplicateTokenEx*" OR Process_Command_Line="*EnumerateSecurityPackages*" OR Process_Command_Line="*FreeHGlobal*" OR Process_Command_Line="*FreeLibrary*" OR Process_Command_Line="*GetDelegateForFunctionPointer*" OR Process_Command_Line="*GetLogonSessionData*" OR Process_Command_Line="*GetModuleHandle*" OR Process_Command_Line="*GetProcAddress*" OR Process_Command_Line="*GetProcessHandle*" OR Process_Command_Line="*GetTokenInformation*" OR Process_Command_Line="*ImpersonateLoggedOnUser*" OR Process_Command_Line="*kernel32*" OR Process_Command_Line="*LoadLibrary*" OR Process_Command_Line="*memcpy*" OR Process_Command_Line="*MiniDumpWriteDump*" OR Process_Command_Line="*ntdll*" OR Process_Command_Line="*OpenDesktop*" OR Process_Command_Line="*OpenProcess*" OR Process_Command_Line="*OpenProcessToken*" OR Process_Command_Line="*OpenThreadToken*" OR Process_Command_Line="*OpenWindowStation*" OR Process_Command_Line="*PtrToString*" OR Process_Command_Line="*QueueUserApc*" OR Process_Command_Line="*ReadProcessMemory*" OR Process_Command_Line="*RevertToSelf*" OR Process_Command_Line="*RtlCreateUserThread*" OR Process_Command_Line="*secur32*" OR Process_Command_Line="*SetThreadToken*" OR Process_Command_Line="*VirtualAlloc*" OR Process_Command_Line="*VirtualFree*" OR Process_Command_Line="*VirtualProtect*" OR Process_Command_Line="*WaitForSingleObject*" OR Process_Command_Line="*WriteInt32*" OR Process_Command_Line="*WriteProcessMemory*" OR Process_Command_Line="*ZeroFreeGlobalAllocUnicode*") NOT (((New_Process_Name="*\\MpCmdRun.exe" Process_Command_Line="*GetLoadLibraryWAddress32*"))))) | eval sigma_attack_tags="attack.execution attack.t1106" | eval sigma_title="Potential WinAPI Calls Via CommandLine" | eval sigma_description="Detects the use of WinAPI Functions via the commandline. As seen used by threat actors via the tool winapiexec"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential WinAPI Calls Via CommandLine - sysmon]
description = Detects the use of WinAPI Functions via the commandline. As seen used by threat actors via the tool winapiexec
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (CommandLine="*AddSecurityPackage*" OR CommandLine="*AdjustTokenPrivileges*" OR CommandLine="*Advapi32*" OR CommandLine="*CloseHandle*" OR CommandLine="*CreateProcessWithToken*" OR CommandLine="*CreatePseudoConsole*" OR CommandLine="*CreateRemoteThread*" OR CommandLine="*CreateThread*" OR CommandLine="*CreateUserThread*" OR CommandLine="*DangerousGetHandle*" OR CommandLine="*DuplicateTokenEx*" OR CommandLine="*EnumerateSecurityPackages*" OR CommandLine="*FreeHGlobal*" OR CommandLine="*FreeLibrary*" OR CommandLine="*GetDelegateForFunctionPointer*" OR CommandLine="*GetLogonSessionData*" OR CommandLine="*GetModuleHandle*" OR CommandLine="*GetProcAddress*" OR CommandLine="*GetProcessHandle*" OR CommandLine="*GetTokenInformation*" OR CommandLine="*ImpersonateLoggedOnUser*" OR CommandLine="*kernel32*" OR CommandLine="*LoadLibrary*" OR CommandLine="*memcpy*" OR CommandLine="*MiniDumpWriteDump*" OR CommandLine="*ntdll*" OR CommandLine="*OpenDesktop*" OR CommandLine="*OpenProcess*" OR CommandLine="*OpenProcessToken*" OR CommandLine="*OpenThreadToken*" OR CommandLine="*OpenWindowStation*" OR CommandLine="*PtrToString*" OR CommandLine="*QueueUserApc*" OR CommandLine="*ReadProcessMemory*" OR CommandLine="*RevertToSelf*" OR CommandLine="*RtlCreateUserThread*" OR CommandLine="*secur32*" OR CommandLine="*SetThreadToken*" OR CommandLine="*VirtualAlloc*" OR CommandLine="*VirtualFree*" OR CommandLine="*VirtualProtect*" OR CommandLine="*WaitForSingleObject*" OR CommandLine="*WriteInt32*" OR CommandLine="*WriteProcessMemory*" OR CommandLine="*ZeroFreeGlobalAllocUnicode*") NOT (((Image="*\\MpCmdRun.exe" CommandLine="*GetLoadLibraryWAddress32*"))))) | eval sigma_attack_tags="attack.execution attack.t1106" | eval sigma_title="Potential WinAPI Calls Via CommandLine" | eval sigma_description="Detects the use of WinAPI Functions via the commandline. As seen used by threat actors via the tool winapiexec"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Debugger Registration Cmdline - winevent]
description = Detects the registration of a debugger for a program that is available in the logon screen (sticky key backdoor).
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*\\CurrentVersion\\Image File Execution Options\\*" (Process_Command_Line="*sethc.exe*" OR Process_Command_Line="*utilman.exe*" OR Process_Command_Line="*osk.exe*" OR Process_Command_Line="*magnify.exe*" OR Process_Command_Line="*narrator.exe*" OR Process_Command_Line="*displayswitch.exe*" OR Process_Command_Line="*atbroker.exe*" OR Process_Command_Line="*HelpPane.exe*"))) | eval sigma_attack_tags="attack.persistence attack.privilege_escalation attack.t1546.008" | eval sigma_title="Suspicious Debugger Registration Cmdline" | eval sigma_description="Detects the registration of a debugger for a program that is available in the logon screen (sticky key backdoor)."
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Debugger Registration Cmdline - sysmon]
description = Detects the registration of a debugger for a program that is available in the logon screen (sticky key backdoor).
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*\\CurrentVersion\\Image File Execution Options\\*" (CommandLine="*sethc.exe*" OR CommandLine="*utilman.exe*" OR CommandLine="*osk.exe*" OR CommandLine="*magnify.exe*" OR CommandLine="*narrator.exe*" OR CommandLine="*displayswitch.exe*" OR CommandLine="*atbroker.exe*" OR CommandLine="*HelpPane.exe*"))) | eval sigma_attack_tags="attack.persistence attack.privilege_escalation attack.t1546.008" | eval sigma_title="Suspicious Debugger Registration Cmdline" | eval sigma_description="Detects the registration of a debugger for a program that is available in the logon screen (sticky key backdoor)."
dispatch.earliest_time = -24h@h
alert.track = 0

[Unsigned AppX Installation Attempt Using Add-AppxPackage - winevent]
description = Detects usage of the 'Add-AppxPackage' or it's alias 'Add-AppPackage' to install unsigned AppX packages
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\powershell.exe" OR New_Process_Name="*\\pwsh.exe") OR (OriginalFileName="PowerShell.EXE" OR OriginalFileName="pwsh.dll")) (Process_Command_Line="*Add-AppPackage *" OR Process_Command_Line="*Add-AppxPackage *") Process_Command_Line="* -AllowUnsigned*")) | eval sigma_attack_tags="attack.persistence attack.defense_evasion" | eval sigma_title="Unsigned AppX Installation Attempt Using Add-AppxPackage" | eval sigma_description="Detects usage of the 'Add-AppxPackage' or it's alias 'Add-AppPackage' to install unsigned AppX packages"
dispatch.earliest_time = -24h@h
alert.track = 0

[Unsigned AppX Installation Attempt Using Add-AppxPackage - sysmon]
description = Detects usage of the 'Add-AppxPackage' or it's alias 'Add-AppPackage' to install unsigned AppX packages
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\powershell.exe" OR Image="*\\pwsh.exe") OR (OriginalFileName="PowerShell.EXE" OR OriginalFileName="pwsh.dll")) (CommandLine="*Add-AppPackage *" OR CommandLine="*Add-AppxPackage *") CommandLine="* -AllowUnsigned*")) | eval sigma_attack_tags="attack.persistence attack.defense_evasion" | eval sigma_title="Unsigned AppX Installation Attempt Using Add-AppxPackage" | eval sigma_description="Detects usage of the 'Add-AppxPackage' or it's alias 'Add-AppPackage' to install unsigned AppX packages"
dispatch.earliest_time = -24h@h
alert.track = 0

[Interactive AT Job - winevent]
description = Detect an interactive AT job, which may be used as a form of privilege escalation.
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\at.exe" Process_Command_Line="*interactive*")) | table ComputerName,Account_Name,Process_Command_Line | eval sigma_attack_tags="attack.privilege_escalation attack.t1053.002" | eval sigma_title="Interactive AT Job" | eval sigma_description="Detect an interactive AT job, which may be used as a form of privilege escalation."
dispatch.earliest_time = -24h@h
alert.track = 0

[Interactive AT Job - sysmon]
description = Detect an interactive AT job, which may be used as a form of privilege escalation.
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\at.exe" CommandLine="*interactive*")) | table ComputerName,User,CommandLine | eval sigma_attack_tags="attack.privilege_escalation attack.t1053.002" | eval sigma_title="Interactive AT Job" | eval sigma_description="Detect an interactive AT job, which may be used as a form of privilege escalation."
dispatch.earliest_time = -24h@h
alert.track = 0

[Invoke-Obfuscation CLIP+ Launcher - winevent]
description = Detects Obfuscated use of Clip.exe to execute PowerShell
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*cmd*" Process_Command_Line="*&&*" Process_Command_Line="*clipboard]::*" Process_Command_Line="*-f*" (Process_Command_Line="*/c*" OR Process_Command_Line="*/r*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1027 attack.execution attack.t1059.001" | eval sigma_title="Invoke-Obfuscation CLIP+ Launcher" | eval sigma_description="Detects Obfuscated use of Clip.exe to execute PowerShell"
dispatch.earliest_time = -24h@h
alert.track = 0

[Invoke-Obfuscation CLIP+ Launcher - sysmon]
description = Detects Obfuscated use of Clip.exe to execute PowerShell
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*cmd*" CommandLine="*&&*" CommandLine="*clipboard]::*" CommandLine="*-f*" (CommandLine="*/c*" OR CommandLine="*/r*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1027 attack.execution attack.t1059.001" | eval sigma_title="Invoke-Obfuscation CLIP+ Launcher" | eval sigma_description="Detects Obfuscated use of Clip.exe to execute PowerShell"
dispatch.earliest_time = -24h@h
alert.track = 0

[Invoke-Obfuscation STDIN+ Launcher - winevent]
description = Detects Obfuscated use of stdin to execute PowerShell
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((Process_Command_Line="*cmd*" Process_Command_Line="*powershell*" (Process_Command_Line="*/c*" OR Process_Command_Line="*/r*"))) (Process_Command_Line="*noexit*" OR ((Process_Command_Line="*input*" Process_Command_Line="*$*"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1027 attack.execution attack.t1059.001" | eval sigma_title="Invoke-Obfuscation STDIN+ Launcher" | eval sigma_description="Detects Obfuscated use of stdin to execute PowerShell"
dispatch.earliest_time = -24h@h
alert.track = 0

[Invoke-Obfuscation STDIN+ Launcher - sysmon]
description = Detects Obfuscated use of stdin to execute PowerShell
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((CommandLine="*cmd*" CommandLine="*powershell*" (CommandLine="*/c*" OR CommandLine="*/r*"))) (CommandLine="*noexit*" OR ((CommandLine="*input*" CommandLine="*$*"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1027 attack.execution attack.t1059.001" | eval sigma_title="Invoke-Obfuscation STDIN+ Launcher" | eval sigma_description="Detects Obfuscated use of stdin to execute PowerShell"
dispatch.earliest_time = -24h@h
alert.track = 0

[Invoke-Obfuscation VAR+ Launcher - winevent]
description = Detects Obfuscated use of Environment Variables to execute PowerShell
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*cmd*" Process_Command_Line="*\"set*" Process_Command_Line="*-f*" (Process_Command_Line="*/c*" OR Process_Command_Line="*/r*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1027 attack.execution attack.t1059.001" | eval sigma_title="Invoke-Obfuscation VAR+ Launcher" | eval sigma_description="Detects Obfuscated use of Environment Variables to execute PowerShell"
dispatch.earliest_time = -24h@h
alert.track = 0

[Invoke-Obfuscation VAR+ Launcher - sysmon]
description = Detects Obfuscated use of Environment Variables to execute PowerShell
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*cmd*" CommandLine="*\"set*" CommandLine="*-f*" (CommandLine="*/c*" OR CommandLine="*/r*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1027 attack.execution attack.t1059.001" | eval sigma_title="Invoke-Obfuscation VAR+ Launcher" | eval sigma_description="Detects Obfuscated use of Environment Variables to execute PowerShell"
dispatch.earliest_time = -24h@h
alert.track = 0

[Invoke-Obfuscation COMPRESS OBFUSCATION - winevent]
description = Detects Obfuscated Powershell via COMPRESS OBFUSCATION
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*new-object*" Process_Command_Line="*text.encoding]::ascii*" (Process_Command_Line="*system.io.compression.deflatestream*" OR Process_Command_Line="*system.io.streamreader*" OR Process_Command_Line="*readtoend(*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1027 attack.execution attack.t1059.001" | eval sigma_title="Invoke-Obfuscation COMPRESS OBFUSCATION" | eval sigma_description="Detects Obfuscated Powershell via COMPRESS OBFUSCATION"
dispatch.earliest_time = -24h@h
alert.track = 0

[Invoke-Obfuscation COMPRESS OBFUSCATION - sysmon]
description = Detects Obfuscated Powershell via COMPRESS OBFUSCATION
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*new-object*" CommandLine="*text.encoding]::ascii*" (CommandLine="*system.io.compression.deflatestream*" OR CommandLine="*system.io.streamreader*" OR CommandLine="*readtoend(*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1027 attack.execution attack.t1059.001" | eval sigma_title="Invoke-Obfuscation COMPRESS OBFUSCATION" | eval sigma_description="Detects Obfuscated Powershell via COMPRESS OBFUSCATION"
dispatch.earliest_time = -24h@h
alert.track = 0

[Invoke-Obfuscation RUNDLL LAUNCHER - winevent]
description = Detects Obfuscated Powershell via RUNDLL LAUNCHER
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*rundll32.exe*" Process_Command_Line="*shell32.dll*" Process_Command_Line="*shellexec_rundll*" Process_Command_Line="*powershell*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1027 attack.execution attack.t1059.001" | eval sigma_title="Invoke-Obfuscation RUNDLL LAUNCHER" | eval sigma_description="Detects Obfuscated Powershell via RUNDLL LAUNCHER"
dispatch.earliest_time = -24h@h
alert.track = 0

[Invoke-Obfuscation RUNDLL LAUNCHER - sysmon]
description = Detects Obfuscated Powershell via RUNDLL LAUNCHER
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*rundll32.exe*" CommandLine="*shell32.dll*" CommandLine="*shellexec_rundll*" CommandLine="*powershell*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1027 attack.execution attack.t1059.001" | eval sigma_title="Invoke-Obfuscation RUNDLL LAUNCHER" | eval sigma_description="Detects Obfuscated Powershell via RUNDLL LAUNCHER"
dispatch.earliest_time = -24h@h
alert.track = 0

[Invoke-Obfuscation Via Stdin - winevent]
description = Detects Obfuscated Powershell via Stdin in Scripts
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*set*" Process_Command_Line="*&&*" (Process_Command_Line="*environment*" OR Process_Command_Line="*invoke*" OR Process_Command_Line="*input*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1027 attack.execution attack.t1059.001" | eval sigma_title="Invoke-Obfuscation Via Stdin" | eval sigma_description="Detects Obfuscated Powershell via Stdin in Scripts"
dispatch.earliest_time = -24h@h
alert.track = 0

[Invoke-Obfuscation Via Stdin - sysmon]
description = Detects Obfuscated Powershell via Stdin in Scripts
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*set*" CommandLine="*&&*" (CommandLine="*environment*" OR CommandLine="*invoke*" OR CommandLine="*input*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1027 attack.execution attack.t1059.001" | eval sigma_title="Invoke-Obfuscation Via Stdin" | eval sigma_description="Detects Obfuscated Powershell via Stdin in Scripts"
dispatch.earliest_time = -24h@h
alert.track = 0

[Invoke-Obfuscation Via Use Clip - winevent]
description = Detects Obfuscated Powershell via use Clip.exe in Scripts
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*echo*" Process_Command_Line="*clip*" Process_Command_Line="*&&*" (Process_Command_Line="*clipboard*" OR Process_Command_Line="*invoke*" OR Process_Command_Line="*i`*" OR Process_Command_Line="*n`*" OR Process_Command_Line="*v`*" OR Process_Command_Line="*o`*" OR Process_Command_Line="*k`*" OR Process_Command_Line="*e`*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1027 attack.execution attack.t1059.001" | eval sigma_title="Invoke-Obfuscation Via Use Clip" | eval sigma_description="Detects Obfuscated Powershell via use Clip.exe in Scripts"
dispatch.earliest_time = -24h@h
alert.track = 0

[Invoke-Obfuscation Via Use Clip - sysmon]
description = Detects Obfuscated Powershell via use Clip.exe in Scripts
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*echo*" CommandLine="*clip*" CommandLine="*&&*" (CommandLine="*clipboard*" OR CommandLine="*invoke*" OR CommandLine="*i`*" OR CommandLine="*n`*" OR CommandLine="*v`*" OR CommandLine="*o`*" OR CommandLine="*k`*" OR CommandLine="*e`*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1027 attack.execution attack.t1059.001" | eval sigma_title="Invoke-Obfuscation Via Use Clip" | eval sigma_description="Detects Obfuscated Powershell via use Clip.exe in Scripts"
dispatch.earliest_time = -24h@h
alert.track = 0

[Invoke-Obfuscation Via Use MSHTA - winevent]
description = Detects Obfuscated Powershell via use MSHTA in Scripts
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*set*" Process_Command_Line="*&&*" Process_Command_Line="*mshta*" Process_Command_Line="*vbscript:createobject*" Process_Command_Line="*.run*" Process_Command_Line="*(window.close)*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1027 attack.execution attack.t1059.001" | eval sigma_title="Invoke-Obfuscation Via Use MSHTA" | eval sigma_description="Detects Obfuscated Powershell via use MSHTA in Scripts"
dispatch.earliest_time = -24h@h
alert.track = 0

[Invoke-Obfuscation Via Use MSHTA - sysmon]
description = Detects Obfuscated Powershell via use MSHTA in Scripts
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*set*" CommandLine="*&&*" CommandLine="*mshta*" CommandLine="*vbscript:createobject*" CommandLine="*.run*" CommandLine="*(window.close)*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1027 attack.execution attack.t1059.001" | eval sigma_title="Invoke-Obfuscation Via Use MSHTA" | eval sigma_description="Detects Obfuscated Powershell via use MSHTA in Scripts"
dispatch.earliest_time = -24h@h
alert.track = 0

[Invoke-Obfuscation VAR++ LAUNCHER OBFUSCATION - winevent]
description = Detects Obfuscated Powershell via VAR++ LAUNCHER
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*&&set*" Process_Command_Line="*cmd*" Process_Command_Line="*/c*" Process_Command_Line="*-f*" (Process_Command_Line="*{0}*" OR Process_Command_Line="*{1}*" OR Process_Command_Line="*{2}*" OR Process_Command_Line="*{3}*" OR Process_Command_Line="*{4}*" OR Process_Command_Line="*{5}*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1027 attack.execution attack.t1059.001" | eval sigma_title="Invoke-Obfuscation VAR++ LAUNCHER OBFUSCATION" | eval sigma_description="Detects Obfuscated Powershell via VAR++ LAUNCHER"
dispatch.earliest_time = -24h@h
alert.track = 0

[Invoke-Obfuscation VAR++ LAUNCHER OBFUSCATION - sysmon]
description = Detects Obfuscated Powershell via VAR++ LAUNCHER
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*&&set*" CommandLine="*cmd*" CommandLine="*/c*" CommandLine="*-f*" (CommandLine="*{0}*" OR CommandLine="*{1}*" OR CommandLine="*{2}*" OR CommandLine="*{3}*" OR CommandLine="*{4}*" OR CommandLine="*{5}*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1027 attack.execution attack.t1059.001" | eval sigma_title="Invoke-Obfuscation VAR++ LAUNCHER OBFUSCATION" | eval sigma_description="Detects Obfuscated Powershell via VAR++ LAUNCHER"
dispatch.earliest_time = -24h@h
alert.track = 0

[IOX Tunneling Tool - winevent]
description = Detects the use of IOX - a tool for port forwarding and intranet proxy purposes
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\iox.exe" OR (Process_Command_Line="*.exe fwd -l *" OR Process_Command_Line="*.exe fwd -r *" OR Process_Command_Line="*.exe proxy -l *" OR Process_Command_Line="*.exe proxy -r *") OR (Hashes="*MD5=9DB2D314DD3F704A02051EF5EA210993*" OR Hashes="*SHA1=039130337E28A6623ECF9A0A3DA7D92C5964D8DD*" OR Hashes="*SHA256=C6CF82919B809967D9D90EA73772A8AA1C1EB3BC59252D977500F64F1A0D6731*") OR md5="9db2d314dd3f704a02051ef5ea210993" OR sha1="039130337e28a6623ecf9a0a3da7d92c5964d8dd" OR sha256="c6cf82919b809967d9d90ea73772a8aa1c1eb3bc59252d977500f64f1a0d6731"))) | eval sigma_attack_tags="attack.command_and_control attack.t1090" | eval sigma_title="IOX Tunneling Tool" | eval sigma_description="Detects the use of IOX - a tool for port forwarding and intranet proxy purposes"
dispatch.earliest_time = -24h@h
alert.track = 0

[IOX Tunneling Tool - sysmon]
description = Detects the use of IOX - a tool for port forwarding and intranet proxy purposes
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\iox.exe" OR (CommandLine="*.exe fwd -l *" OR CommandLine="*.exe fwd -r *" OR CommandLine="*.exe proxy -l *" OR CommandLine="*.exe proxy -r *") OR (Hashes="*MD5=9DB2D314DD3F704A02051EF5EA210993*" OR Hashes="*SHA1=039130337E28A6623ECF9A0A3DA7D92C5964D8DD*" OR Hashes="*SHA256=C6CF82919B809967D9D90EA73772A8AA1C1EB3BC59252D977500F64F1A0D6731*") OR md5="9db2d314dd3f704a02051ef5ea210993" OR sha1="039130337e28a6623ecf9a0a3da7d92c5964d8dd" OR sha256="c6cf82919b809967d9d90ea73772a8aa1c1eb3bc59252d977500f64f1a0d6731"))) | eval sigma_attack_tags="attack.command_and_control attack.t1090" | eval sigma_title="IOX Tunneling Tool" | eval sigma_description="Detects the use of IOX - a tool for port forwarding and intranet proxy purposes"
dispatch.earliest_time = -24h@h
alert.track = 0

[Jlaive Usage For Assembly Execution In-Memory - winevent]
description = Detect the use of Jlaive to execute assemblies in a copied PowerShell
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((Creator_Process_Name="*\\cmd.exe" ParentCommandLine="*.bat")) (((New_Process_Name="*\\xcopy.exe" Process_Command_Line="*powershell.exe*" Process_Command_Line="*.bat.exe*")) OR ((New_Process_Name="*\\xcopy.exe" Process_Command_Line="*pwsh.exe*" Process_Command_Line="*.bat.exe*")) OR ((New_Process_Name="*\\attrib.exe" Process_Command_Line="*+s*" Process_Command_Line="*+h*" Process_Command_Line="*.bat.exe*"))))) | eval sigma_attack_tags="attack.execution attack.t1059.003" | eval sigma_title="Jlaive Usage For Assembly Execution In-Memory" | eval sigma_description="Detect the use of Jlaive to execute assemblies in a copied PowerShell"
dispatch.earliest_time = -24h@h
alert.track = 0

[Jlaive Usage For Assembly Execution In-Memory - sysmon]
description = Detect the use of Jlaive to execute assemblies in a copied PowerShell
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((ParentImage="*\\cmd.exe" ParentCommandLine="*.bat")) (((Image="*\\xcopy.exe" CommandLine="*powershell.exe*" CommandLine="*.bat.exe*")) OR ((Image="*\\xcopy.exe" CommandLine="*pwsh.exe*" CommandLine="*.bat.exe*")) OR ((Image="*\\attrib.exe" CommandLine="*+s*" CommandLine="*+h*" CommandLine="*.bat.exe*"))))) | eval sigma_attack_tags="attack.execution attack.t1059.003" | eval sigma_title="Jlaive Usage For Assembly Execution In-Memory" | eval sigma_description="Detect the use of Jlaive to execute assemblies in a copied PowerShell"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Ldifde Command Usage - winevent]
description = Detects the use of Ldifde.exe with specific command line arguments to potentially load an LDIF file containing HTTP-based arguments.
Ldifde.exe is present, by default, on domain controllers and only requires user-level authentication to execute.

search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\ldifde.exe" OR OriginalFileName="ldifde.exe.mui") ((Process_Command_Line="*-i*" Process_Command_Line="*-f*")))) | eval sigma_attack_tags="attack.command_and_control attack.t1105 attack.defense_evasion attack.t1218" | eval sigma_title="Suspicious Ldifde Command Usage" | eval sigma_description="Detects the use of Ldifde.exe with specific command line arguments to potentially load an LDIF file containing HTTP-based arguments.
Ldifde.exe is present, by default, on domain controllers and only requires user-level authentication to execute.
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Ldifde Command Usage - sysmon]
description = Detects the use of Ldifde.exe with specific command line arguments to potentially load an LDIF file containing HTTP-based arguments.
Ldifde.exe is present, by default, on domain controllers and only requires user-level authentication to execute.

search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\ldifde.exe" OR OriginalFileName="ldifde.exe.mui") ((CommandLine="*-i*" CommandLine="*-f*")))) | eval sigma_attack_tags="attack.command_and_control attack.t1105 attack.defense_evasion attack.t1218" | eval sigma_title="Suspicious Ldifde Command Usage" | eval sigma_description="Detects the use of Ldifde.exe with specific command line arguments to potentially load an LDIF file containing HTTP-based arguments.
Ldifde.exe is present, by default, on domain controllers and only requires user-level authentication to execute.
"
dispatch.earliest_time = -24h@h
alert.track = 0

[MSHTA Spwaned by SVCHOST - winevent]
description = Detects MSHTA.EXE spwaned by SVCHOST as seen in LethalHTA and described in report
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Creator_Process_Name="*\\svchost.exe" New_Process_Name="*\\mshta.exe")) | eval sigma_attack_tags="attack.defense_evasion attack.t1218.005" | eval sigma_title="MSHTA Spwaned by SVCHOST" | eval sigma_description="Detects MSHTA.EXE spwaned by SVCHOST as seen in LethalHTA and described in report"
dispatch.earliest_time = -24h@h
alert.track = 0

[MSHTA Spwaned by SVCHOST - sysmon]
description = Detects MSHTA.EXE spwaned by SVCHOST as seen in LethalHTA and described in report
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") ParentImage="*\\svchost.exe" Image="*\\mshta.exe")) | eval sigma_attack_tags="attack.defense_evasion attack.t1218.005" | eval sigma_title="MSHTA Spwaned by SVCHOST" | eval sigma_description="Detects MSHTA.EXE spwaned by SVCHOST as seen in LethalHTA and described in report"
dispatch.earliest_time = -24h@h
alert.track = 0

[Local Accounts Discovery - winevent]
description = Local accounts, System Owner/User discovery using operating systems utilities
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((((New_Process_Name="*\\cmd.exe" Process_Command_Line="* /c*" Process_Command_Line="*dir *" Process_Command_Line="*\\Users\\*")) NOT ((Process_Command_Line="* rmdir *")))) OR (((((New_Process_Name="*\\net.exe" OR New_Process_Name="*\\net1.exe") Process_Command_Line="*user*")) NOT (((Process_Command_Line="*/domain*" OR Process_Command_Line="*/add*" OR Process_Command_Line="*/delete*" OR Process_Command_Line="*/active*" OR Process_Command_Line="*/expires*" OR Process_Command_Line="*/passwordreq*" OR Process_Command_Line="*/scriptpath*" OR Process_Command_Line="*/times*" OR Process_Command_Line="*/workstations*"))))) OR (New_Process_Name="*\\whoami.exe" OR New_Process_Name="*\\quser.exe" OR New_Process_Name="*\\qwinsta.exe") OR ((New_Process_Name="*\\wmic.exe" Process_Command_Line="*useraccount*" Process_Command_Line="*get*")) OR ((New_Process_Name="*\\cmdkey.exe" Process_Command_Line="* /l*"))))) | eval sigma_attack_tags="attack.discovery attack.t1033 attack.t1087.001" | eval sigma_title="Local Accounts Discovery" | eval sigma_description="Local accounts, System Owner/User discovery using operating systems utilities"
dispatch.earliest_time = -24h@h
alert.track = 0

[Local Accounts Discovery - sysmon]
description = Local accounts, System Owner/User discovery using operating systems utilities
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((((Image="*\\cmd.exe" CommandLine="* /c*" CommandLine="*dir *" CommandLine="*\\Users\\*")) NOT ((CommandLine="* rmdir *")))) OR (((((Image="*\\net.exe" OR Image="*\\net1.exe") CommandLine="*user*")) NOT (((CommandLine="*/domain*" OR CommandLine="*/add*" OR CommandLine="*/delete*" OR CommandLine="*/active*" OR CommandLine="*/expires*" OR CommandLine="*/passwordreq*" OR CommandLine="*/scriptpath*" OR CommandLine="*/times*" OR CommandLine="*/workstations*"))))) OR (Image="*\\whoami.exe" OR Image="*\\quser.exe" OR Image="*\\qwinsta.exe") OR ((Image="*\\wmic.exe" CommandLine="*useraccount*" CommandLine="*get*")) OR ((Image="*\\cmdkey.exe" CommandLine="* /l*"))))) | eval sigma_attack_tags="attack.discovery attack.t1033 attack.t1087.001" | eval sigma_title="Local Accounts Discovery" | eval sigma_description="Local accounts, System Owner/User discovery using operating systems utilities"
dispatch.earliest_time = -24h@h
alert.track = 0

[Logon Scripts (UserInitMprLogonScript) - winevent]
description = Detects creation or execution of UserInitMprLogonScript persistence method
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((Creator_Process_Name="*\\userinit.exe" NOT ((((New_Process_Name="*\\explorer.exe" OR New_Process_Name="*\\proquota.exe"))) OR (((Process_Command_Line="*netlogon*.bat*" OR Process_Command_Line="*UsrLogon.cmd*" OR Process_Command_Line="*C:\\WINDOWS\\Explorer.EXE*"))) OR ((New_Process_Name="*\\Citrix\\System32\\icast.exe"))))) OR Process_Command_Line="*UserInitMprLogonScript*"))) | eval sigma_attack_tags="attack.t1037.001 attack.persistence" | eval sigma_title="Logon Scripts (UserInitMprLogonScript)" | eval sigma_description="Detects creation or execution of UserInitMprLogonScript persistence method"
dispatch.earliest_time = -24h@h
alert.track = 0

[Logon Scripts (UserInitMprLogonScript) - sysmon]
description = Detects creation or execution of UserInitMprLogonScript persistence method
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((ParentImage="*\\userinit.exe" NOT ((((Image="*\\explorer.exe" OR Image="*\\proquota.exe"))) OR (((CommandLine="*netlogon*.bat*" OR CommandLine="*UsrLogon.cmd*" OR CommandLine="*C:\\WINDOWS\\Explorer.EXE*"))) OR ((Image="*\\Citrix\\System32\\icast.exe"))))) OR CommandLine="*UserInitMprLogonScript*"))) | eval sigma_attack_tags="attack.t1037.001 attack.persistence" | eval sigma_title="Logon Scripts (UserInitMprLogonScript)" | eval sigma_description="Detects creation or execution of UserInitMprLogonScript persistence method"
dispatch.earliest_time = -24h@h
alert.track = 0

[Use of Adplus.exe - winevent]
description = The 'AdPlus.exe' binary that is part of the Windows SDK can be used as a lolbin to dump process memory and execute arbitrary commands
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\adplus.exe" OR OriginalFileName="Adplus.exe") (Process_Command_Line="* -hang *" OR Process_Command_Line="* -pn *" OR Process_Command_Line="* -pmn *" OR Process_Command_Line="* -p *" OR Process_Command_Line="* -po *" OR Process_Command_Line="* -c *" OR Process_Command_Line="* -sc *"))) | eval sigma_attack_tags="attack.defense_evasion attack.execution attack.t1003.001" | eval sigma_title="Use of Adplus.exe" | eval sigma_description="The 'AdPlus.exe' binary that is part of the Windows SDK can be used as a lolbin to dump process memory and execute arbitrary commands"
dispatch.earliest_time = -24h@h
alert.track = 0

[Use of Adplus.exe - sysmon]
description = The 'AdPlus.exe' binary that is part of the Windows SDK can be used as a lolbin to dump process memory and execute arbitrary commands
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\adplus.exe" OR OriginalFileName="Adplus.exe") (CommandLine="* -hang *" OR CommandLine="* -pn *" OR CommandLine="* -pmn *" OR CommandLine="* -p *" OR CommandLine="* -po *" OR CommandLine="* -c *" OR CommandLine="* -sc *"))) | eval sigma_attack_tags="attack.defense_evasion attack.execution attack.t1003.001" | eval sigma_title="Use of Adplus.exe" | eval sigma_description="The 'AdPlus.exe' binary that is part of the Windows SDK can be used as a lolbin to dump process memory and execute arbitrary commands"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious AgentExecutor PowerShell Execution - winevent]
description = Detects execution of the AgentExecutor.exe binary. Which can be abused as a LOLBIN to execute powershell scripts with the ExecutionPolicy 'Bypass' or any binary named 'powershell.exe' located in the path provided by 6th postiional argument
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((New_Process_Name="*\\AgentExecutor.exe" OR OriginalFileName="AgentExecutor.exe") (Process_Command_Line="* -powershell*" OR Process_Command_Line="* -remediationScript*"))) NOT (((Process_Command_Line="*C:\\Windows\\SysWOW64\\WindowsPowerShell\\v1.0\\*" OR Process_Command_Line="*C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\*"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218" | eval sigma_title="Suspicious AgentExecutor PowerShell Execution" | eval sigma_description="Detects execution of the AgentExecutor.exe binary. Which can be abused as a LOLBIN to execute powershell scripts with the ExecutionPolicy 'Bypass' or any binary named 'powershell.exe' located in the path provided by 6th postiional argument"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious AgentExecutor PowerShell Execution - sysmon]
description = Detects execution of the AgentExecutor.exe binary. Which can be abused as a LOLBIN to execute powershell scripts with the ExecutionPolicy 'Bypass' or any binary named 'powershell.exe' located in the path provided by 6th postiional argument
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((Image="*\\AgentExecutor.exe" OR OriginalFileName="AgentExecutor.exe") (CommandLine="* -powershell*" OR CommandLine="* -remediationScript*"))) NOT (((CommandLine="*C:\\Windows\\SysWOW64\\WindowsPowerShell\\v1.0\\*" OR CommandLine="*C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\*"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218" | eval sigma_title="Suspicious AgentExecutor PowerShell Execution" | eval sigma_description="Detects execution of the AgentExecutor.exe binary. Which can be abused as a LOLBIN to execute powershell scripts with the ExecutionPolicy 'Bypass' or any binary named 'powershell.exe' located in the path provided by 6th postiional argument"
dispatch.earliest_time = -24h@h
alert.track = 0

[AgentExecutor PowerShell Execution - winevent]
description = Detects execution of the AgentExecutor.exe binary. Which can be abused as a LOLBIN to execute powershell scripts with the ExecutionPolicy 'Bypass' or any binary named 'powershell.exe' located in the path provided by 6th postiional argument
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="\\AgentExecutor.exe" OR OriginalFileName="AgentExecutor.exe") (Process_Command_Line="* -powershell*" OR Process_Command_Line="* -remediationScript*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218" | eval sigma_title="AgentExecutor PowerShell Execution" | eval sigma_description="Detects execution of the AgentExecutor.exe binary. Which can be abused as a LOLBIN to execute powershell scripts with the ExecutionPolicy 'Bypass' or any binary named 'powershell.exe' located in the path provided by 6th postiional argument"
dispatch.earliest_time = -24h@h
alert.track = 0

[AgentExecutor PowerShell Execution - sysmon]
description = Detects execution of the AgentExecutor.exe binary. Which can be abused as a LOLBIN to execute powershell scripts with the ExecutionPolicy 'Bypass' or any binary named 'powershell.exe' located in the path provided by 6th postiional argument
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="\\AgentExecutor.exe" OR OriginalFileName="AgentExecutor.exe") (CommandLine="* -powershell*" OR CommandLine="* -remediationScript*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218" | eval sigma_title="AgentExecutor PowerShell Execution" | eval sigma_description="Detects execution of the AgentExecutor.exe binary. Which can be abused as a LOLBIN to execute powershell scripts with the ExecutionPolicy 'Bypass' or any binary named 'powershell.exe' located in the path provided by 6th postiional argument"
dispatch.earliest_time = -24h@h
alert.track = 0

[Using AppVLP To Circumvent ASR File Path Rule - winevent]
description = Application Virtualization Utility is included with Microsoft Office. We are able to abuse 'AppVLP' to execute shell commands.
Normally, this binary is used for Application Virtualization, but we can use it as an abuse binary to circumvent the ASR file path rule folder
or to mark a file as a system file.

search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) Creator_Process_Name="*\\appvlp.exe" NOT (((New_Process_Name="*\\msoasb.exe" OR New_Process_Name="*\\rundll32.exe"))))) | eval sigma_attack_tags="attack.t1218 attack.defense_evasion attack.execution" | eval sigma_title="Using AppVLP To Circumvent ASR File Path Rule" | eval sigma_description="Application Virtualization Utility is included with Microsoft Office. We are able to abuse 'AppVLP' to execute shell commands.
Normally, this binary is used for Application Virtualization, but we can use it as an abuse binary to circumvent the ASR file path rule folder
or to mark a file as a system file.
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Using AppVLP To Circumvent ASR File Path Rule - sysmon]
description = Application Virtualization Utility is included with Microsoft Office. We are able to abuse 'AppVLP' to execute shell commands.
Normally, this binary is used for Application Virtualization, but we can use it as an abuse binary to circumvent the ASR file path rule folder
or to mark a file as a system file.

search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ParentImage="*\\appvlp.exe" NOT (((Image="*\\msoasb.exe" OR Image="*\\rundll32.exe"))))) | eval sigma_attack_tags="attack.t1218 attack.defense_evasion attack.execution" | eval sigma_title="Using AppVLP To Circumvent ASR File Path Rule" | eval sigma_description="Application Virtualization Utility is included with Microsoft Office. We are able to abuse 'AppVLP' to execute shell commands.
Normally, this binary is used for Application Virtualization, but we can use it as an abuse binary to circumvent the ASR file path rule folder
or to mark a file as a system file.
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious aspnet_compiler.exe Execution - winevent]
description = Execute C# code with the Build Provider and proper folder structure in place.
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*C:\\Windows\\Microsoft.NET\\Framework*" New_Process_Name="*aspnet_compiler.exe*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1127" | eval sigma_title="Suspicious aspnet_compiler.exe Execution" | eval sigma_description="Execute C# code with the Build Provider and proper folder structure in place."
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious aspnet_compiler.exe Execution - sysmon]
description = Execute C# code with the Build Provider and proper folder structure in place.
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*C:\\Windows\\Microsoft.NET\\Framework*" Image="*aspnet_compiler.exe*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1127" | eval sigma_title="Suspicious aspnet_compiler.exe Execution" | eval sigma_description="Execute C# code with the Build Provider and proper folder structure in place."
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Subsystem for Linux Bash Execution - winevent]
description = Performs execution of specified file, can be used for defensive evasion.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((Process_Command_Line="*bash.exe*" Process_Command_Line="*-c *")) NOT ((((ParentCommandLine="*C:\\Program Files\\Git\\post-install.bat*" OR ParentCommandLine="*C:\\Program Files (x86)\\Git\\post-install.bat*" OR ParentCommandLine="*echo /etc/post-install/*.post*")) OR (Process_Command_Line="*echo /etc/post-install/*.post*"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1202" | eval sigma_title="Suspicious Subsystem for Linux Bash Execution" | eval sigma_description="Performs execution of specified file, can be used for defensive evasion."
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Subsystem for Linux Bash Execution - sysmon]
description = Performs execution of specified file, can be used for defensive evasion.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((CommandLine="*bash.exe*" CommandLine="*-c *")) NOT ((((ParentCommandLine="*C:\\Program Files\\Git\\post-install.bat*" OR ParentCommandLine="*C:\\Program Files (x86)\\Git\\post-install.bat*" OR ParentCommandLine="*echo /etc/post-install/*.post*")) OR (CommandLine="*echo /etc/post-install/*.post*"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1202" | eval sigma_title="Suspicious Subsystem for Linux Bash Execution" | eval sigma_description="Performs execution of specified file, can be used for defensive evasion."
dispatch.earliest_time = -24h@h
alert.track = 0

[WinDbg/CDB LOLBIN Usage - winevent]
description = Detects usage of 'cdb.exe' to launch 64-bit shellcode or arbitrary processes or commands from a debugger script file
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\cdb.exe" OR OriginalFileName="CDB.Exe") (Process_Command_Line="* -c *" OR Process_Command_Line="* -cf *"))) | eval sigma_attack_tags="attack.execution attack.t1106 attack.defense_evasion attack.t1218 attack.t1127" | eval sigma_title="WinDbg/CDB LOLBIN Usage" | eval sigma_description="Detects usage of 'cdb.exe' to launch 64-bit shellcode or arbitrary processes or commands from a debugger script file"
dispatch.earliest_time = -24h@h
alert.track = 0

[WinDbg/CDB LOLBIN Usage - sysmon]
description = Detects usage of 'cdb.exe' to launch 64-bit shellcode or arbitrary processes or commands from a debugger script file
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\cdb.exe" OR OriginalFileName="CDB.Exe") (CommandLine="* -c *" OR CommandLine="* -cf *"))) | eval sigma_attack_tags="attack.execution attack.t1106 attack.defense_evasion attack.t1218 attack.t1127" | eval sigma_title="WinDbg/CDB LOLBIN Usage" | eval sigma_description="Detects usage of 'cdb.exe' to launch 64-bit shellcode or arbitrary processes or commands from a debugger script file"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious File Download via CertOC.exe - winevent]
description = Detects when a user downloads file by using CertOC.exe
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\certoc.exe" OR OriginalFileName="CertOC.exe") Process_Command_Line="*-GetCACAPS*")) | eval sigma_attack_tags="attack.command_and_control attack.t1105" | eval sigma_title="Suspicious File Download via CertOC.exe" | eval sigma_description="Detects when a user downloads file by using CertOC.exe"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious File Download via CertOC.exe - sysmon]
description = Detects when a user downloads file by using CertOC.exe
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\certoc.exe" OR OriginalFileName="CertOC.exe") CommandLine="*-GetCACAPS*")) | eval sigma_attack_tags="attack.command_and_control attack.t1105" | eval sigma_title="Suspicious File Download via CertOC.exe" | eval sigma_description="Detects when a user downloads file by using CertOC.exe"
dispatch.earliest_time = -24h@h
alert.track = 0

[Execution via CL_Invocation.ps1 - winevent]
description = Detects Execution via SyncInvoke in CL_Invocation.ps1 module
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*CL_Invocation.ps1*" Process_Command_Line="*SyncInvoke*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1216" | eval sigma_title="Execution via CL_Invocation.ps1" | eval sigma_description="Detects Execution via SyncInvoke in CL_Invocation.ps1 module"
dispatch.earliest_time = -24h@h
alert.track = 0

[Execution via CL_Invocation.ps1 - sysmon]
description = Detects Execution via SyncInvoke in CL_Invocation.ps1 module
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*CL_Invocation.ps1*" CommandLine="*SyncInvoke*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1216" | eval sigma_title="Execution via CL_Invocation.ps1" | eval sigma_description="Detects Execution via SyncInvoke in CL_Invocation.ps1 module"
dispatch.earliest_time = -24h@h
alert.track = 0

[CL_LoadAssembly.ps1 Proxy Execution - winevent]
description = Detects the use of a Microsoft signed script to execute commands and bypassing AppLocker.
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (Process_Command_Line="*\\CL_LoadAssembly.ps1*" OR Process_Command_Line="*LoadAssemblyFromPath *"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1216" | eval sigma_title="CL_LoadAssembly.ps1 Proxy Execution" | eval sigma_description="Detects the use of a Microsoft signed script to execute commands and bypassing AppLocker."
dispatch.earliest_time = -24h@h
alert.track = 0

[CL_LoadAssembly.ps1 Proxy Execution - sysmon]
description = Detects the use of a Microsoft signed script to execute commands and bypassing AppLocker.
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (CommandLine="*\\CL_LoadAssembly.ps1*" OR CommandLine="*LoadAssemblyFromPath *"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1216" | eval sigma_title="CL_LoadAssembly.ps1 Proxy Execution" | eval sigma_description="Detects the use of a Microsoft signed script to execute commands and bypassing AppLocker."
dispatch.earliest_time = -24h@h
alert.track = 0

[CL_Mutexverifiers.ps1 Proxy Execution - winevent]
description = Detects the use of a Microsoft signed script to execute commands
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*\\CL_Mutexverifiers.ps1*" Process_Command_Line="*runAfterCancelProcess *")) | eval sigma_attack_tags="attack.defense_evasion attack.t1216" | eval sigma_title="CL_Mutexverifiers.ps1 Proxy Execution" | eval sigma_description="Detects the use of a Microsoft signed script to execute commands"
dispatch.earliest_time = -24h@h
alert.track = 0

[CL_Mutexverifiers.ps1 Proxy Execution - sysmon]
description = Detects the use of a Microsoft signed script to execute commands
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*\\CL_Mutexverifiers.ps1*" CommandLine="*runAfterCancelProcess *")) | eval sigma_attack_tags="attack.defense_evasion attack.t1216" | eval sigma_title="CL_Mutexverifiers.ps1 Proxy Execution" | eval sigma_description="Detects the use of a Microsoft signed script to execute commands"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Cmdl32 Execution - winevent]
description = lolbas Cmdl32 is use to download a payload to evade antivirus
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\cmdl32.exe" OR OriginalFileName="CMDL32.EXE") ((Process_Command_Line="*/vpn *" Process_Command_Line="*/lan *")))) | eval sigma_attack_tags="attack.execution attack.defense_evasion attack.t1218 attack.t1202" | eval sigma_title="Suspicious Cmdl32 Execution" | eval sigma_description="lolbas Cmdl32 is use to download a payload to evade antivirus"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Cmdl32 Execution - sysmon]
description = lolbas Cmdl32 is use to download a payload to evade antivirus
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\cmdl32.exe" OR OriginalFileName="CMDL32.EXE") ((CommandLine="*/vpn *" CommandLine="*/lan *")))) | eval sigma_attack_tags="attack.execution attack.defense_evasion attack.t1218 attack.t1202" | eval sigma_title="Suspicious Cmdl32 Execution" | eval sigma_description="lolbas Cmdl32 is use to download a payload to evade antivirus"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious ConfigSecurityPolicy Execution - winevent]
description = Upload file, credentials or data exfiltration with Binary part of Windows Defender
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (Process_Command_Line="*ConfigSecurityPolicy.exe*" OR New_Process_Name="*\\ConfigSecurityPolicy.exe" OR OriginalFileName="ConfigSecurityPolicy.exe") (Process_Command_Line="*https://*" OR Process_Command_Line="*http://*" OR Process_Command_Line="*ftp://*"))) | eval sigma_attack_tags="attack.exfiltration attack.t1567" | eval sigma_title="Suspicious ConfigSecurityPolicy Execution" | eval sigma_description="Upload file, credentials or data exfiltration with Binary part of Windows Defender"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious ConfigSecurityPolicy Execution - sysmon]
description = Upload file, credentials or data exfiltration with Binary part of Windows Defender
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (CommandLine="*ConfigSecurityPolicy.exe*" OR Image="*\\ConfigSecurityPolicy.exe" OR OriginalFileName="ConfigSecurityPolicy.exe") (CommandLine="*https://*" OR CommandLine="*http://*" OR CommandLine="*ftp://*"))) | eval sigma_attack_tags="attack.exfiltration attack.t1567" | eval sigma_title="Suspicious ConfigSecurityPolicy Execution" | eval sigma_description="Upload file, credentials or data exfiltration with Binary part of Windows Defender"
dispatch.earliest_time = -24h@h
alert.track = 0

[GatherNetworkInfo.vbs Script Usage - winevent]
description = Adversaries can abuse of C:\Windows\System32\gatherNetworkInfo.vbs script along with cscript.exe to gather information about the target
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*cscript.exe*" Process_Command_Line="*gatherNetworkInfo.vbs*")) | table Process_Command_Line,Creator_Process_Name | eval sigma_attack_tags="attack.discovery attack.execution attack.t1615 attack.t1059.005" | eval sigma_title="GatherNetworkInfo.vbs Script Usage" | eval sigma_description="Adversaries can abuse of C:\Windows\System32\gatherNetworkInfo.vbs script along with cscript.exe to gather information about the target"
dispatch.earliest_time = -24h@h
alert.track = 0

[GatherNetworkInfo.vbs Script Usage - sysmon]
description = Adversaries can abuse of C:\Windows\System32\gatherNetworkInfo.vbs script along with cscript.exe to gather information about the target
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*cscript.exe*" CommandLine="*gatherNetworkInfo.vbs*")) | table CommandLine,ParentImage | eval sigma_attack_tags="attack.discovery attack.execution attack.t1615 attack.t1059.005" | eval sigma_title="GatherNetworkInfo.vbs Script Usage" | eval sigma_description="Adversaries can abuse of C:\Windows\System32\gatherNetworkInfo.vbs script along with cscript.exe to gather information about the target"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious CustomShellHost Execution - winevent]
description = Detects the execution of CustomShellHost binary where the child isn't located in 'C:\Windows\explorer.exe'
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) Creator_Process_Name="*\\CustomShellHost.exe" NOT ((New_Process_Name="C:\\Windows\\explorer.exe")))) | eval sigma_attack_tags="attack.defense_evasion attack.t1216" | eval sigma_title="Suspicious CustomShellHost Execution" | eval sigma_description="Detects the execution of CustomShellHost binary where the child isn't located in 'C:\Windows\explorer.exe'"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious CustomShellHost Execution - sysmon]
description = Detects the execution of CustomShellHost binary where the child isn't located in 'C:\Windows\explorer.exe'
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ParentImage="*\\CustomShellHost.exe" NOT ((Image="C:\\Windows\\explorer.exe")))) | eval sigma_attack_tags="attack.defense_evasion attack.t1216" | eval sigma_title="Suspicious CustomShellHost Execution" | eval sigma_description="Detects the execution of CustomShellHost binary where the child isn't located in 'C:\Windows\explorer.exe'"
dispatch.earliest_time = -24h@h
alert.track = 0

[LOLBAS Data Exfiltration by DataSvcUtil.exe - winevent]
description = Detects when a user performs data exfiltration by using DataSvcUtil.exe
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (Process_Command_Line="*/in:*" OR Process_Command_Line="*/out:*" OR Process_Command_Line="*/uri:*") (New_Process_Name="*\\DataSvcUtil.exe" OR OriginalFileName="DataSvcUtil.exe"))) | table ComputerName,Account_Name,Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.exfiltration attack.t1567" | eval sigma_title="LOLBAS Data Exfiltration by DataSvcUtil.exe" | eval sigma_description="Detects when a user performs data exfiltration by using DataSvcUtil.exe"
dispatch.earliest_time = -24h@h
alert.track = 0

[LOLBAS Data Exfiltration by DataSvcUtil.exe - sysmon]
description = Detects when a user performs data exfiltration by using DataSvcUtil.exe
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (CommandLine="*/in:*" OR CommandLine="*/out:*" OR CommandLine="*/uri:*") (Image="*\\DataSvcUtil.exe" OR OriginalFileName="DataSvcUtil.exe"))) | table ComputerName,User,CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.exfiltration attack.t1567" | eval sigma_title="LOLBAS Data Exfiltration by DataSvcUtil.exe" | eval sigma_description="Detects when a user performs data exfiltration by using DataSvcUtil.exe"
dispatch.earliest_time = -24h@h
alert.track = 0

[Lolbin Defaultpack.exe Use As Proxy - winevent]
description = Detect usage of the 'defaultpack.exe' binary as a proxy to launch other programs
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Creator_Process_Name="*\\defaultpack.exe")) | eval sigma_attack_tags="attack.t1218 attack.defense_evasion attack.execution" | eval sigma_title="Lolbin Defaultpack.exe Use As Proxy" | eval sigma_description="Detect usage of the 'defaultpack.exe' binary as a proxy to launch other programs"
dispatch.earliest_time = -24h@h
alert.track = 0

[Lolbin Defaultpack.exe Use As Proxy - sysmon]
description = Detect usage of the 'defaultpack.exe' binary as a proxy to launch other programs
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") ParentImage="*\\defaultpack.exe")) | eval sigma_attack_tags="attack.t1218 attack.defense_evasion attack.execution" | eval sigma_title="Lolbin Defaultpack.exe Use As Proxy" | eval sigma_description="Detect usage of the 'defaultpack.exe' binary as a proxy to launch other programs"
dispatch.earliest_time = -24h@h
alert.track = 0

[DeviceCredentialDeployment Execution - winevent]
description = Detects the execution of DeviceCredentialDeployment to hide a process from view
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\DeviceCredentialDeployment.exe")) | eval sigma_attack_tags="attack.defense_evasion attack.t1218" | eval sigma_title="DeviceCredentialDeployment Execution" | eval sigma_description="Detects the execution of DeviceCredentialDeployment to hide a process from view"
dispatch.earliest_time = -24h@h
alert.track = 0

[DeviceCredentialDeployment Execution - sysmon]
description = Detects the execution of DeviceCredentialDeployment to hide a process from view
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\DeviceCredentialDeployment.exe")) | eval sigma_attack_tags="attack.defense_evasion attack.t1218" | eval sigma_title="DeviceCredentialDeployment Execution" | eval sigma_description="Detects the execution of DeviceCredentialDeployment to hide a process from view"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Diantz Download and Compress Into a CAB File - winevent]
description = Download and compress a remote file and store it in a cab file on local machine.
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*diantz.exe*" Process_Command_Line="* \\\\\*" Process_Command_Line="*.cab*")) | eval sigma_attack_tags="attack.command_and_control attack.t1105" | eval sigma_title="Suspicious Diantz Download and Compress Into a CAB File" | eval sigma_description="Download and compress a remote file and store it in a cab file on local machine."
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Diantz Download and Compress Into a CAB File - sysmon]
description = Download and compress a remote file and store it in a cab file on local machine.
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*diantz.exe*" CommandLine="* \\\\\*" CommandLine="*.cab*")) | eval sigma_attack_tags="attack.command_and_control attack.t1105" | eval sigma_title="Suspicious Diantz Download and Compress Into a CAB File" | eval sigma_description="Download and compress a remote file and store it in a cab file on local machine."
dispatch.earliest_time = -24h@h
alert.track = 0

[Xwizard DLL Sideloading - winevent]
description = Detects the execution of Xwizard tool from the non-default directory which can be used to sideload a custom xwizards.dll
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) New_Process_Name="*\\xwizard.exe" NOT ((New_Process_Name="C:\\Windows\\System32\\*")))) | eval sigma_attack_tags="attack.defense_evasion attack.t1574.002" | eval sigma_title="Xwizard DLL Sideloading" | eval sigma_description="Detects the execution of Xwizard tool from the non-default directory which can be used to sideload a custom xwizards.dll"
dispatch.earliest_time = -24h@h
alert.track = 0

[Xwizard DLL Sideloading - sysmon]
description = Detects the execution of Xwizard tool from the non-default directory which can be used to sideload a custom xwizards.dll
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) Image="*\\xwizard.exe" NOT ((Image="C:\\Windows\\System32\\*")))) | eval sigma_attack_tags="attack.defense_evasion attack.t1574.002" | eval sigma_title="Xwizard DLL Sideloading" | eval sigma_description="Detects the execution of Xwizard tool from the non-default directory which can be used to sideload a custom xwizards.dll"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Dump64.exe Execution - winevent]
description = Detects when a user bypasses Defender by renaming a tool to dump64.exe and placing it in a Visual Studio folder
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((New_Process_Name="*\\dump64.exe" NOT ((New_Process_Name="*\\Installer\\Feedback\\dump64.exe*")))) OR ((New_Process_Name="*\\dump64.exe" (Process_Command_Line="* -ma *" OR Process_Command_Line="*accpeteula*")))))) | eval sigma_attack_tags="attack.credential_access attack.t1003.001" | eval sigma_title="Suspicious Dump64.exe Execution" | eval sigma_description="Detects when a user bypasses Defender by renaming a tool to dump64.exe and placing it in a Visual Studio folder"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Dump64.exe Execution - sysmon]
description = Detects when a user bypasses Defender by renaming a tool to dump64.exe and placing it in a Visual Studio folder
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((Image="*\\dump64.exe" NOT ((Image="*\\Installer\\Feedback\\dump64.exe*")))) OR ((Image="*\\dump64.exe" (CommandLine="* -ma *" OR CommandLine="*accpeteula*")))))) | eval sigma_attack_tags="attack.credential_access attack.t1003.001" | eval sigma_title="Suspicious Dump64.exe Execution" | eval sigma_description="Detects when a user bypasses Defender by renaming a tool to dump64.exe and placing it in a Visual Studio folder"
dispatch.earliest_time = -24h@h
alert.track = 0

[Monitoring Winget For LOLbin Execution - winevent]
description = Detects usage of winget to install applications via manifest file. Adversaries can abuse winget to download payloads remotely and execute them without touching disk. The manifest option enables you to install an application by passing in a YAML file directly to the client. Winget can be used to download and install exe's, msi, msix files later.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\winget.exe" OR OriginalFileName="winget.exe") Process_Command_Line="*install*" (Process_Command_Line="*-m *" OR Process_Command_Line="*--manifest*"))) | eval sigma_attack_tags="attack.defense_evasion attack.execution attack.t1059" | eval sigma_title="Monitoring Winget For LOLbin Execution" | eval sigma_description="Detects usage of winget to install applications via manifest file. Adversaries can abuse winget to download payloads remotely and execute them without touching disk. The manifest option enables you to install an application by passing in a YAML file directly to the client. Winget can be used to download and install exe's, msi, msix files later."
dispatch.earliest_time = -24h@h
alert.track = 0

[Monitoring Winget For LOLbin Execution - sysmon]
description = Detects usage of winget to install applications via manifest file. Adversaries can abuse winget to download payloads remotely and execute them without touching disk. The manifest option enables you to install an application by passing in a YAML file directly to the client. Winget can be used to download and install exe's, msi, msix files later.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\winget.exe" OR OriginalFileName="winget.exe") CommandLine="*install*" (CommandLine="*-m *" OR CommandLine="*--manifest*"))) | eval sigma_attack_tags="attack.defense_evasion attack.execution attack.t1059" | eval sigma_title="Monitoring Winget For LOLbin Execution" | eval sigma_description="Detects usage of winget to install applications via manifest file. Adversaries can abuse winget to download payloads remotely and execute them without touching disk. The manifest option enables you to install an application by passing in a YAML file directly to the client. Winget can be used to download and install exe's, msi, msix files later."
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Extexport Execution - winevent]
description = Extexport.exe loads dll and is execute from other folder the original path
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (Process_Command_Line="*Extexport.exe*" OR New_Process_Name="*\\Extexport.exe" OR OriginalFileName="extexport.exe"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218" | eval sigma_title="Suspicious Extexport Execution" | eval sigma_description="Extexport.exe loads dll and is execute from other folder the original path"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Extexport Execution - sysmon]
description = Extexport.exe loads dll and is execute from other folder the original path
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (CommandLine="*Extexport.exe*" OR Image="*\\Extexport.exe" OR OriginalFileName="extexport.exe"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218" | eval sigma_title="Suspicious Extexport Execution" | eval sigma_description="Extexport.exe loads dll and is execute from other folder the original path"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Extrac32 Execution - winevent]
description = Download or Copy file with Extrac32
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (Process_Command_Line="*extrac32.exe*" OR New_Process_Name="*\\extrac32.exe" OR OriginalFileName="extrac32.exe") Process_Command_Line="*.cab*" (Process_Command_Line="*/C*" OR Process_Command_Line="*/Y*" OR Process_Command_Line="* \\\\\*"))) | eval sigma_attack_tags="attack.command_and_control attack.t1105" | eval sigma_title="Suspicious Extrac32 Execution" | eval sigma_description="Download or Copy file with Extrac32"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Extrac32 Execution - sysmon]
description = Download or Copy file with Extrac32
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (CommandLine="*extrac32.exe*" OR Image="*\\extrac32.exe" OR OriginalFileName="extrac32.exe") CommandLine="*.cab*" (CommandLine="*/C*" OR CommandLine="*/Y*" OR CommandLine="* \\\\\*"))) | eval sigma_attack_tags="attack.command_and_control attack.t1105" | eval sigma_title="Suspicious Extrac32 Execution" | eval sigma_description="Download or Copy file with Extrac32"
dispatch.earliest_time = -24h@h
alert.track = 0

[Abusing Findstr for Defense Evasion - winevent]
description = Attackers can use findstr to hide their artifacts or search specific strings and evade defense mechanism
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (Process_Command_Line="*findstr*" OR New_Process_Name="*findstr.exe" OR OriginalFileName="FINDSTR.EXE") ((((Process_Command_Line="* /v *" OR Process_Command_Line="* -v *") (Process_Command_Line="* /l *" OR Process_Command_Line="* -l *"))) OR (((Process_Command_Line="* /s *" OR Process_Command_Line="* -s *") (Process_Command_Line="* /i *" OR Process_Command_Line="* -i *")))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218 attack.t1564.004 attack.t1552.001 attack.t1105" | eval sigma_title="Abusing Findstr for Defense Evasion" | eval sigma_description="Attackers can use findstr to hide their artifacts or search specific strings and evade defense mechanism"
dispatch.earliest_time = -24h@h
alert.track = 0

[Abusing Findstr for Defense Evasion - sysmon]
description = Attackers can use findstr to hide their artifacts or search specific strings and evade defense mechanism
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (CommandLine="*findstr*" OR Image="*findstr.exe" OR OriginalFileName="FINDSTR.EXE") ((((CommandLine="* /v *" OR CommandLine="* -v *") (CommandLine="* /l *" OR CommandLine="* -l *"))) OR (((CommandLine="* /s *" OR CommandLine="* -s *") (CommandLine="* /i *" OR CommandLine="* -i *")))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218 attack.t1564.004 attack.t1552.001 attack.t1105" | eval sigma_title="Abusing Findstr for Defense Evasion" | eval sigma_description="Attackers can use findstr to hide their artifacts or search specific strings and evade defense mechanism"
dispatch.earliest_time = -24h@h
alert.track = 0

[Use of Forfiles For Execution - winevent]
description = Execute commands and binaries from the context of 'forfiles'. This is used as a LOLBIN for example to bypass application whitelisting.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\forfiles.exe" OR OriginalFileName="forfiles.exe") (Process_Command_Line="* /p *" OR Process_Command_Line="* -p *") (Process_Command_Line="* /m *" OR Process_Command_Line="* -m *") (Process_Command_Line="* /c *" OR Process_Command_Line="* -c *"))) | eval sigma_attack_tags="attack.execution attack.t1059" | eval sigma_title="Use of Forfiles For Execution" | eval sigma_description="Execute commands and binaries from the context of 'forfiles'. This is used as a LOLBIN for example to bypass application whitelisting."
dispatch.earliest_time = -24h@h
alert.track = 0

[Use of Forfiles For Execution - sysmon]
description = Execute commands and binaries from the context of 'forfiles'. This is used as a LOLBIN for example to bypass application whitelisting.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\forfiles.exe" OR OriginalFileName="forfiles.exe") (CommandLine="* /p *" OR CommandLine="* -p *") (CommandLine="* /m *" OR CommandLine="* -m *") (CommandLine="* /c *" OR CommandLine="* -c *"))) | eval sigma_attack_tags="attack.execution attack.t1059" | eval sigma_title="Use of Forfiles For Execution" | eval sigma_description="Execute commands and binaries from the context of 'forfiles'. This is used as a LOLBIN for example to bypass application whitelisting."
dispatch.earliest_time = -24h@h
alert.track = 0

[Use of FSharp Interpreters - winevent]
description = The FSharp Interpreters, FsiAnyCpu.exe and FSi.exe, can be used for AWL bypass and is listed in Microsoft recommended block rules.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\fsianycpu.exe" OR OriginalFileName="fsianycpu.exe" OR New_Process_Name="*\\fsi.exe" OR OriginalFileName="fsi.exe"))) | eval sigma_attack_tags="attack.execution attack.t1059" | eval sigma_title="Use of FSharp Interpreters" | eval sigma_description="The FSharp Interpreters, FsiAnyCpu.exe and FSi.exe, can be used for AWL bypass and is listed in Microsoft recommended block rules."
dispatch.earliest_time = -24h@h
alert.track = 0

[Use of FSharp Interpreters - sysmon]
description = The FSharp Interpreters, FsiAnyCpu.exe and FSi.exe, can be used for AWL bypass and is listed in Microsoft recommended block rules.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\fsianycpu.exe" OR OriginalFileName="fsianycpu.exe" OR Image="*\\fsi.exe" OR OriginalFileName="fsi.exe"))) | eval sigma_attack_tags="attack.execution attack.t1059" | eval sigma_title="Use of FSharp Interpreters" | eval sigma_description="The FSharp Interpreters, FsiAnyCpu.exe and FSi.exe, can be used for AWL bypass and is listed in Microsoft recommended block rules."
dispatch.earliest_time = -24h@h
alert.track = 0

[LOLBIN Execution Of The FTP.EXE Binary - winevent]
description = Detects execution of ftp.exe script execution with the '-s' flag and any child processes ran by ftp.exe
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (Creator_Process_Name="*\\ftp.exe" OR (((New_Process_Name="*\\ftp.exe" OR OriginalFileName="ftp.exe") Process_Command_Line="*-s:*"))))) | table Process_Command_Line,Creator_Process_Name | eval sigma_attack_tags="attack.execution attack.t1059 attack.defense_evasion attack.t1202" | eval sigma_title="LOLBIN Execution Of The FTP.EXE Binary" | eval sigma_description="Detects execution of ftp.exe script execution with the '-s' flag and any child processes ran by ftp.exe"
dispatch.earliest_time = -24h@h
alert.track = 0

[LOLBIN Execution Of The FTP.EXE Binary - sysmon]
description = Detects execution of ftp.exe script execution with the '-s' flag and any child processes ran by ftp.exe
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (ParentImage="*\\ftp.exe" OR (((Image="*\\ftp.exe" OR OriginalFileName="ftp.exe") CommandLine="*-s:*"))))) | table CommandLine,ParentImage | eval sigma_attack_tags="attack.execution attack.t1059 attack.defense_evasion attack.t1202" | eval sigma_title="LOLBIN Execution Of The FTP.EXE Binary" | eval sigma_description="Detects execution of ftp.exe script execution with the '-s' flag and any child processes ran by ftp.exe"
dispatch.earliest_time = -24h@h
alert.track = 0

[Gpscript Execution - winevent]
description = Detects the execution of the LOLBIN gpscript, which executes logon or startup scripts configured in Group Policy
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\gpscript.exe" OR OriginalFileName="GPSCRIPT.EXE") (Process_Command_Line="* /logon*" OR Process_Command_Line="* /startup*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218" | eval sigma_title="Gpscript Execution" | eval sigma_description="Detects the execution of the LOLBIN gpscript, which executes logon or startup scripts configured in Group Policy"
dispatch.earliest_time = -24h@h
alert.track = 0

[Gpscript Execution - sysmon]
description = Detects the execution of the LOLBIN gpscript, which executes logon or startup scripts configured in Group Policy
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\gpscript.exe" OR OriginalFileName="GPSCRIPT.EXE") (CommandLine="* /logon*" OR CommandLine="* /startup*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218" | eval sigma_title="Gpscript Execution" | eval sigma_description="Detects the execution of the LOLBIN gpscript, which executes logon or startup scripts configured in Group Policy"
dispatch.earliest_time = -24h@h
alert.track = 0

[Ie4uinit Lolbin Use From Invalid Path - winevent]
description = Detect use of ie4uinit.exe to execute commands from a specially prepared ie4uinit.inf file from a directory other than the usual directories
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\ie4uinit.exe" OR OriginalFileName="IE4UINIT.EXE") NOT ((((CurrentDirectory="c:\\windows\\system32\\" OR CurrentDirectory="c:\\windows\\sysWOW64\\"))) OR ((NOT CurrentDirectory="*"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218" | eval sigma_title="Ie4uinit Lolbin Use From Invalid Path" | eval sigma_description="Detect use of ie4uinit.exe to execute commands from a specially prepared ie4uinit.inf file from a directory other than the usual directories"
dispatch.earliest_time = -24h@h
alert.track = 0

[Ie4uinit Lolbin Use From Invalid Path - sysmon]
description = Detect use of ie4uinit.exe to execute commands from a specially prepared ie4uinit.inf file from a directory other than the usual directories
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\ie4uinit.exe" OR OriginalFileName="IE4UINIT.EXE") NOT ((((CurrentDirectory="c:\\windows\\system32\\" OR CurrentDirectory="c:\\windows\\sysWOW64\\"))) OR ((NOT CurrentDirectory="*"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218" | eval sigma_title="Ie4uinit Lolbin Use From Invalid Path" | eval sigma_description="Detect use of ie4uinit.exe to execute commands from a specially prepared ie4uinit.inf file from a directory other than the usual directories"
dispatch.earliest_time = -24h@h
alert.track = 0

[Abusing IEExec To Download Payloads - winevent]
description = Detects execution of the IEExec utility to download payloads
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\IEExec.exe" OR OriginalFileName="IEExec.exe") (Process_Command_Line="*https://*" OR Process_Command_Line="*http://*"))) | eval sigma_attack_tags="" | eval sigma_title="Abusing IEExec To Download Payloads" | eval sigma_description="Detects execution of the IEExec utility to download payloads"
dispatch.earliest_time = -24h@h
alert.track = 0

[Abusing IEExec To Download Payloads - sysmon]
description = Detects execution of the IEExec utility to download payloads
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\IEExec.exe" OR OriginalFileName="IEExec.exe") (CommandLine="*https://*" OR CommandLine="*http://*"))) | eval sigma_attack_tags="" | eval sigma_title="Abusing IEExec To Download Payloads" | eval sigma_description="Detects execution of the IEExec utility to download payloads"
dispatch.earliest_time = -24h@h
alert.track = 0

[Ilasm Lolbin Use Compile C-Sharp - winevent]
description = Detect use of Ilasm.exe to compile c# code into dll or exe.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\ilasm.exe" OR OriginalFileName="ilasm.exe"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1127" | eval sigma_title="Ilasm Lolbin Use Compile C-Sharp" | eval sigma_description="Detect use of Ilasm.exe to compile c# code into dll or exe."
dispatch.earliest_time = -24h@h
alert.track = 0

[Ilasm Lolbin Use Compile C-Sharp - sysmon]
description = Detect use of Ilasm.exe to compile c# code into dll or exe.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\ilasm.exe" OR OriginalFileName="ilasm.exe"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1127" | eval sigma_title="Ilasm Lolbin Use Compile C-Sharp" | eval sigma_description="Detect use of Ilasm.exe to compile c# code into dll or exe."
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Execution of InstallUtil To Download - winevent]
description = Detects the use the .NET InstallUtil.exe application in order to download arbitrary files. The files will be written to %LOCALAPPDATA%\Microsoft\Windows\INetCache\IE\
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\InstallUtil.exe" OR OriginalFileName="InstallUtil.exe") (Process_Command_Line="*http://*" OR Process_Command_Line="*https://*" OR Process_Command_Line="*ftp://*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218" | eval sigma_title="Suspicious Execution of InstallUtil To Download" | eval sigma_description="Detects the use the .NET InstallUtil.exe application in order to download arbitrary files. The files will be written to %LOCALAPPDATA%\Microsoft\Windows\INetCache\IE\"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Execution of InstallUtil To Download - sysmon]
description = Detects the use the .NET InstallUtil.exe application in order to download arbitrary files. The files will be written to %LOCALAPPDATA%\Microsoft\Windows\INetCache\IE\
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\InstallUtil.exe" OR OriginalFileName="InstallUtil.exe") (CommandLine="*http://*" OR CommandLine="*https://*" OR CommandLine="*ftp://*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218" | eval sigma_title="Suspicious Execution of InstallUtil To Download" | eval sigma_description="Detects the use the .NET InstallUtil.exe application in order to download arbitrary files. The files will be written to %LOCALAPPDATA%\Microsoft\Windows\INetCache\IE\"
dispatch.earliest_time = -24h@h
alert.track = 0

[JSC Convert Javascript To Executable - winevent]
description = Detects the execution of the LOLBIN jsc.exe used by .NET to compile javascript code to .exe or .dll format
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\jsc.exe" Process_Command_Line="*.js*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1127" | eval sigma_title="JSC Convert Javascript To Executable" | eval sigma_description="Detects the execution of the LOLBIN jsc.exe used by .NET to compile javascript code to .exe or .dll format"
dispatch.earliest_time = -24h@h
alert.track = 0

[JSC Convert Javascript To Executable - sysmon]
description = Detects the execution of the LOLBIN jsc.exe used by .NET to compile javascript code to .exe or .dll format
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\jsc.exe" CommandLine="*.js*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1127" | eval sigma_title="JSC Convert Javascript To Executable" | eval sigma_description="Detects the execution of the LOLBIN jsc.exe used by .NET to compile javascript code to .exe or .dll format"
dispatch.earliest_time = -24h@h
alert.track = 0

[Kavremover Dropped Binary LOLBIN Usage - winevent]
description = Detects the execution of a signed binary dropped by Kaspersky Lab Products Remover (kavremover) which can be abused as a LOLBIN to execute arbitrary commands and binaries.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) Process_Command_Line="* run run-cmd *" NOT (((Creator_Process_Name="*\\kavremover.exe" OR Creator_Process_Name="*\\cleanapi.exe"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1127" | eval sigma_title="Kavremover Dropped Binary LOLBIN Usage" | eval sigma_description="Detects the execution of a signed binary dropped by Kaspersky Lab Products Remover (kavremover) which can be abused as a LOLBIN to execute arbitrary commands and binaries."
dispatch.earliest_time = -24h@h
alert.track = 0

[Kavremover Dropped Binary LOLBIN Usage - sysmon]
description = Detects the execution of a signed binary dropped by Kaspersky Lab Products Remover (kavremover) which can be abused as a LOLBIN to execute arbitrary commands and binaries.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) CommandLine="* run run-cmd *" NOT (((ParentImage="*\\kavremover.exe" OR ParentImage="*\\cleanapi.exe"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1127" | eval sigma_title="Kavremover Dropped Binary LOLBIN Usage" | eval sigma_description="Detects the execution of a signed binary dropped by Kaspersky Lab Products Remover (kavremover) which can be abused as a LOLBIN to execute arbitrary commands and binaries."
dispatch.earliest_time = -24h@h
alert.track = 0

[Launch-VsDevShell.PS1 Proxy Execution - winevent]
description = Detects the use of the 'Launch-VsDevShell.ps1' Microsoft signed script to execute commands.
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*Launch-VsDevShell.ps1*" (Process_Command_Line="*VsWherePath *" OR Process_Command_Line="*VsInstallationPath *"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1216.001" | eval sigma_title="Launch-VsDevShell.PS1 Proxy Execution" | eval sigma_description="Detects the use of the 'Launch-VsDevShell.ps1' Microsoft signed script to execute commands."
dispatch.earliest_time = -24h@h
alert.track = 0

[Launch-VsDevShell.PS1 Proxy Execution - sysmon]
description = Detects the use of the 'Launch-VsDevShell.ps1' Microsoft signed script to execute commands.
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*Launch-VsDevShell.ps1*" (CommandLine="*VsWherePath *" OR CommandLine="*VsInstallationPath *"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1216.001" | eval sigma_title="Launch-VsDevShell.PS1 Proxy Execution" | eval sigma_description="Detects the use of the 'Launch-VsDevShell.ps1' Microsoft signed script to execute commands."
dispatch.earliest_time = -24h@h
alert.track = 0

[Mavinject Inject DLL Into Running Process - winevent]
description = Detects process injection using the signed Windows tool 'Mavinject' via the 'INJECTRUNNING' flag
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) Process_Command_Line="* /INJECTRUNNING *" NOT ((Creator_Process_Name="C:\\Windows\\System32\\AppVClient.exe")))) | eval sigma_attack_tags="attack.defense_evasion attack.privilege_escalation attack.t1055.001 attack.t1218.013" | eval sigma_title="Mavinject Inject DLL Into Running Process" | eval sigma_description="Detects process injection using the signed Windows tool 'Mavinject' via the 'INJECTRUNNING' flag"
dispatch.earliest_time = -24h@h
alert.track = 0

[Mavinject Inject DLL Into Running Process - sysmon]
description = Detects process injection using the signed Windows tool 'Mavinject' via the 'INJECTRUNNING' flag
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) CommandLine="* /INJECTRUNNING *" NOT ((ParentImage="C:\\Windows\\System32\\AppVClient.exe")))) | eval sigma_attack_tags="attack.defense_evasion attack.privilege_escalation attack.t1055.001 attack.t1218.013" | eval sigma_title="Mavinject Inject DLL Into Running Process" | eval sigma_description="Detects process injection using the signed Windows tool 'Mavinject' via the 'INJECTRUNNING' flag"
dispatch.earliest_time = -24h@h
alert.track = 0

[Use of Mftrace.exe - winevent]
description = The 'Trace log generation tool for Media Foundation Tools' (Mftrace.exe) can be used to execute arbitrary binaries
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((((New_Process_Name="*\\mftrace.exe" OR OriginalFileName="mftrace.exe") ((Process_Command_Line="*.exe *" Process_Command_Line="*.exe")))) OR Creator_Process_Name="*\\mftrace.exe"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1127" | eval sigma_title="Use of Mftrace.exe" | eval sigma_description="The 'Trace log generation tool for Media Foundation Tools' (Mftrace.exe) can be used to execute arbitrary binaries"
dispatch.earliest_time = -24h@h
alert.track = 0

[Use of Mftrace.exe - sysmon]
description = The 'Trace log generation tool for Media Foundation Tools' (Mftrace.exe) can be used to execute arbitrary binaries
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((((Image="*\\mftrace.exe" OR OriginalFileName="mftrace.exe") ((CommandLine="*.exe *" CommandLine="*.exe")))) OR ParentImage="*\\mftrace.exe"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1127" | eval sigma_title="Use of Mftrace.exe" | eval sigma_description="The 'Trace log generation tool for Media Foundation Tools' (Mftrace.exe) can be used to execute arbitrary binaries"
dispatch.earliest_time = -24h@h
alert.track = 0

[Execute MSDT Via Answer File - winevent]
description = Detects execution of 'msdt.exe' using an answer file which is simulating the legitimate way of calling msdt via 'pcwrun.exe' (For example from the compatibility tab)
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\msdt.exe" Process_Command_Line="*\\WINDOWS\\diagnostics\\index\\PCWDiagnostic.xml*" (Process_Command_Line="* -af *" OR Process_Command_Line="* /af *"))) NOT ((Creator_Process_Name="*\\pcwrun.exe")))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218 attack.execution" | eval sigma_title="Execute MSDT Via Answer File" | eval sigma_description="Detects execution of 'msdt.exe' using an answer file which is simulating the legitimate way of calling msdt via 'pcwrun.exe' (For example from the compatibility tab)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Execute MSDT Via Answer File - sysmon]
description = Detects execution of 'msdt.exe' using an answer file which is simulating the legitimate way of calling msdt via 'pcwrun.exe' (For example from the compatibility tab)
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\msdt.exe" CommandLine="*\\WINDOWS\\diagnostics\\index\\PCWDiagnostic.xml*" (CommandLine="* -af *" OR CommandLine="* /af *"))) NOT ((ParentImage="*\\pcwrun.exe")))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218 attack.execution" | eval sigma_title="Execute MSDT Via Answer File" | eval sigma_description="Detects execution of 'msdt.exe' using an answer file which is simulating the legitimate way of calling msdt via 'pcwrun.exe' (For example from the compatibility tab)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Download Arbitrary Files Via MSOHTMED.EXE - winevent]
description = Detects usage of 'MSOHTMED' to download arbitrary files
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\MSOHTMED.exe" OR OriginalFileName="MsoHtmEd.exe") (Process_Command_Line="*http://*" OR Process_Command_Line="*https://*" OR Process_Command_Line="*ftp://*"))) | eval sigma_attack_tags="attack.defense_evasion attack.execution attack.t1218" | eval sigma_title="Download Arbitrary Files Via MSOHTMED.EXE" | eval sigma_description="Detects usage of 'MSOHTMED' to download arbitrary files"
dispatch.earliest_time = -24h@h
alert.track = 0

[Download Arbitrary Files Via MSOHTMED.EXE - sysmon]
description = Detects usage of 'MSOHTMED' to download arbitrary files
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\MSOHTMED.exe" OR OriginalFileName="MsoHtmEd.exe") (CommandLine="*http://*" OR CommandLine="*https://*" OR CommandLine="*ftp://*"))) | eval sigma_attack_tags="attack.defense_evasion attack.execution attack.t1218" | eval sigma_title="Download Arbitrary Files Via MSOHTMED.EXE" | eval sigma_description="Detects usage of 'MSOHTMED' to download arbitrary files"
dispatch.earliest_time = -24h@h
alert.track = 0

[Download Arbitrary Files Via MSPUB.EXE - winevent]
description = Detects usage of 'MSPUB' (Microsoft Publisher) to download arbitrary files
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\MSPUB.exe" OR OriginalFileName="MSPUB.exe") (Process_Command_Line="*http://*" OR Process_Command_Line="*https://*" OR Process_Command_Line="*ftp://*"))) | eval sigma_attack_tags="attack.defense_evasion attack.execution attack.t1218" | eval sigma_title="Download Arbitrary Files Via MSPUB.EXE" | eval sigma_description="Detects usage of 'MSPUB' (Microsoft Publisher) to download arbitrary files"
dispatch.earliest_time = -24h@h
alert.track = 0

[Download Arbitrary Files Via MSPUB.EXE - sysmon]
description = Detects usage of 'MSPUB' (Microsoft Publisher) to download arbitrary files
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\MSPUB.exe" OR OriginalFileName="MSPUB.exe") (CommandLine="*http://*" OR CommandLine="*https://*" OR CommandLine="*ftp://*"))) | eval sigma_attack_tags="attack.defense_evasion attack.execution attack.t1218" | eval sigma_title="Download Arbitrary Files Via MSPUB.EXE" | eval sigma_description="Detects usage of 'MSPUB' (Microsoft Publisher) to download arbitrary files"
dispatch.earliest_time = -24h@h
alert.track = 0

[LOLBIN From Abnormal Drive - winevent]
description = Detects LOLBINs executing from an abnormal drive such as a mounted ISO.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\rundll32.exe" OR New_Process_Name="*\\calc.exe" OR New_Process_Name="*\\mshta.exe" OR New_Process_Name="*\\cscript.exe" OR New_Process_Name="*\\wscript.exe" OR New_Process_Name="*\\regsvr32.exe" OR New_Process_Name="*\\installutil.exe" OR New_Process_Name="*\\cmstp.exe") NOT (((CurrentDirectory="*C:\\*") OR (CurrentDirectory="")) OR ((NOT CurrentDirectory="*"))))) | eval sigma_attack_tags="attack.t1218.001" | eval sigma_title="LOLBIN From Abnormal Drive" | eval sigma_description="Detects LOLBINs executing from an abnormal drive such as a mounted ISO."
dispatch.earliest_time = -24h@h
alert.track = 0

[LOLBIN From Abnormal Drive - sysmon]
description = Detects LOLBINs executing from an abnormal drive such as a mounted ISO.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\rundll32.exe" OR Image="*\\calc.exe" OR Image="*\\mshta.exe" OR Image="*\\cscript.exe" OR Image="*\\wscript.exe" OR Image="*\\regsvr32.exe" OR Image="*\\installutil.exe" OR Image="*\\cmstp.exe") NOT (((CurrentDirectory="*C:\\*") OR (CurrentDirectory="")) OR ((NOT CurrentDirectory="*"))))) | eval sigma_attack_tags="attack.t1218.001" | eval sigma_title="LOLBIN From Abnormal Drive" | eval sigma_description="Detects LOLBINs executing from an abnormal drive such as a mounted ISO."
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious OfflineScannerShell.exe Execution From Another Folder - winevent]
description = Use OfflineScannerShell.exe to execute mpclient.dll library in the current working directory
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) New_Process_Name="*\\OfflineScannerShell.exe" NOT (((CurrentDirectory="C:\\Program Files\\Windows Defender\\Offline\\")) OR ((NOT CurrentDirectory="*"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218" | eval sigma_title="Suspicious OfflineScannerShell.exe Execution From Another Folder" | eval sigma_description="Use OfflineScannerShell.exe to execute mpclient.dll library in the current working directory"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious OfflineScannerShell.exe Execution From Another Folder - sysmon]
description = Use OfflineScannerShell.exe to execute mpclient.dll library in the current working directory
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) Image="*\\OfflineScannerShell.exe" NOT (((CurrentDirectory="C:\\Program Files\\Windows Defender\\Offline\\")) OR ((NOT CurrentDirectory="*"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218" | eval sigma_title="Suspicious OfflineScannerShell.exe Execution From Another Folder" | eval sigma_description="Use OfflineScannerShell.exe to execute mpclient.dll library in the current working directory"
dispatch.earliest_time = -24h@h
alert.track = 0

[Use of OpenConsole - winevent]
description = Detects usage of OpenConsole binary as a LOLBIN to launch other binaries to bypass application Whitelisting
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (OriginalFileName="OpenConsole.exe" OR New_Process_Name="*\\OpenConsole.exe") NOT ((New_Process_Name="C:\\Program Files\\WindowsApps\\Microsoft.WindowsTerminal*")))) | eval sigma_attack_tags="attack.execution attack.t1059" | eval sigma_title="Use of OpenConsole" | eval sigma_description="Detects usage of OpenConsole binary as a LOLBIN to launch other binaries to bypass application Whitelisting"
dispatch.earliest_time = -24h@h
alert.track = 0

[Use of OpenConsole - sysmon]
description = Detects usage of OpenConsole binary as a LOLBIN to launch other binaries to bypass application Whitelisting
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (OriginalFileName="OpenConsole.exe" OR Image="*\\OpenConsole.exe") NOT ((Image="C:\\Program Files\\WindowsApps\\Microsoft.WindowsTerminal*")))) | eval sigma_attack_tags="attack.execution attack.t1059" | eval sigma_title="Use of OpenConsole" | eval sigma_description="Detects usage of OpenConsole binary as a LOLBIN to launch other binaries to bypass application Whitelisting"
dispatch.earliest_time = -24h@h
alert.track = 0

[Use of Pcalua For Execution - winevent]
description = Detects execition of commands and binaries from the context of The program compatibility assistant (Pcalua.exe). This can be used as a LOLBIN in order to bypass application whitelisting.
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\pcalua.exe" Process_Command_Line="* -a*")) | eval sigma_attack_tags="attack.execution attack.t1059" | eval sigma_title="Use of Pcalua For Execution" | eval sigma_description="Detects execition of commands and binaries from the context of The program compatibility assistant (Pcalua.exe). This can be used as a LOLBIN in order to bypass application whitelisting."
dispatch.earliest_time = -24h@h
alert.track = 0

[Use of Pcalua For Execution - sysmon]
description = Detects execition of commands and binaries from the context of The program compatibility assistant (Pcalua.exe). This can be used as a LOLBIN in order to bypass application whitelisting.
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\pcalua.exe" CommandLine="* -a*")) | eval sigma_attack_tags="attack.execution attack.t1059" | eval sigma_title="Use of Pcalua For Execution" | eval sigma_description="Detects execition of commands and binaries from the context of The program compatibility assistant (Pcalua.exe). This can be used as a LOLBIN in order to bypass application whitelisting."
dispatch.earliest_time = -24h@h
alert.track = 0

[Execute Pcwrun.EXE To Leverage Follina - winevent]
description = Detects indirect command execution via Program Compatibility Assistant 'pcwrun.exe' leveraging the follina (CVE-2022-30190) vulnerability
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\pcwrun.exe" Process_Command_Line="*../*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1218 attack.execution" | eval sigma_title="Execute Pcwrun.EXE To Leverage Follina" | eval sigma_description="Detects indirect command execution via Program Compatibility Assistant 'pcwrun.exe' leveraging the follina (CVE-2022-30190) vulnerability"
dispatch.earliest_time = -24h@h
alert.track = 0

[Execute Pcwrun.EXE To Leverage Follina - sysmon]
description = Detects indirect command execution via Program Compatibility Assistant 'pcwrun.exe' leveraging the follina (CVE-2022-30190) vulnerability
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\pcwrun.exe" CommandLine="*../*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1218 attack.execution" | eval sigma_title="Execute Pcwrun.EXE To Leverage Follina" | eval sigma_description="Detects indirect command execution via Program Compatibility Assistant 'pcwrun.exe' leveraging the follina (CVE-2022-30190) vulnerability"
dispatch.earliest_time = -24h@h
alert.track = 0

[Indirect Command Execution By Program Compatibility Wizard - winevent]
description = Detect indirect command execution via Program Compatibility Assistant pcwrun.exe
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Creator_Process_Name="*\\pcwrun.exe")) | table ComputerName,Account_Name,ParentCommandLine,Process_Command_Line | eval sigma_attack_tags="attack.defense_evasion attack.t1218 attack.execution" | eval sigma_title="Indirect Command Execution By Program Compatibility Wizard" | eval sigma_description="Detect indirect command execution via Program Compatibility Assistant pcwrun.exe"
dispatch.earliest_time = -24h@h
alert.track = 0

[Indirect Command Execution By Program Compatibility Wizard - sysmon]
description = Detect indirect command execution via Program Compatibility Assistant pcwrun.exe
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") ParentImage="*\\pcwrun.exe")) | table ComputerName,User,ParentCommandLine,CommandLine | eval sigma_attack_tags="attack.defense_evasion attack.t1218 attack.execution" | eval sigma_title="Indirect Command Execution By Program Compatibility Wizard" | eval sigma_description="Detect indirect command execution via Program Compatibility Assistant pcwrun.exe"
dispatch.earliest_time = -24h@h
alert.track = 0

[Use of PktMon.exe - winevent]
description = Tools to Capture Network Packets on the windows 10 with October 2018 Update or later.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\pktmon.exe" OR OriginalFileName="PktMon.exe"))) | eval sigma_attack_tags="attack.credential_access attack.t1040" | eval sigma_title="Use of PktMon.exe" | eval sigma_description="Tools to Capture Network Packets on the windows 10 with October 2018 Update or later."
dispatch.earliest_time = -24h@h
alert.track = 0

[Use of PktMon.exe - sysmon]
description = Tools to Capture Network Packets on the windows 10 with October 2018 Update or later.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\pktmon.exe" OR OriginalFileName="PktMon.exe"))) | eval sigma_attack_tags="attack.credential_access attack.t1040" | eval sigma_title="Use of PktMon.exe" | eval sigma_description="Tools to Capture Network Packets on the windows 10 with October 2018 Update or later."
dispatch.earliest_time = -24h@h
alert.track = 0

[Download Arbitrary Files Via PresentationHost.exe - winevent]
description = Detects usage of 'PresentationHost' which is a utility that runs '.xbap' (Browser Applications) files to download arbitrary files
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\presentationhost.exe" OR OriginalFileName="PresentationHost.exe") (Process_Command_Line="*http://*" OR Process_Command_Line="*https://*" OR Process_Command_Line="*ftp://*"))) | eval sigma_attack_tags="attack.defense_evasion attack.execution attack.t1218" | eval sigma_title="Download Arbitrary Files Via PresentationHost.exe" | eval sigma_description="Detects usage of 'PresentationHost' which is a utility that runs '.xbap' (Browser Applications) files to download arbitrary files"
dispatch.earliest_time = -24h@h
alert.track = 0

[Download Arbitrary Files Via PresentationHost.exe - sysmon]
description = Detects usage of 'PresentationHost' which is a utility that runs '.xbap' (Browser Applications) files to download arbitrary files
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\presentationhost.exe" OR OriginalFileName="PresentationHost.exe") (CommandLine="*http://*" OR CommandLine="*https://*" OR CommandLine="*ftp://*"))) | eval sigma_attack_tags="attack.defense_evasion attack.execution attack.t1218" | eval sigma_title="Download Arbitrary Files Via PresentationHost.exe" | eval sigma_description="Detects usage of 'PresentationHost' which is a utility that runs '.xbap' (Browser Applications) files to download arbitrary files"
dispatch.earliest_time = -24h@h
alert.track = 0

[Application Whitelisting Bypass via PresentationHost.exe - winevent]
description = Detects usage of 'PresentationHost' which is a utility that runs '.xbap' (Browser Applications) files. It can be abused to run malicious '.xbap' files any bypass AWL
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((New_Process_Name="*\\presentationhost.exe" OR OriginalFileName="PresentationHost.exe") Process_Command_Line="*.xbap*")) NOT (((Process_Command_Line="*C:\\Windows\\*" OR Process_Command_Line="*C:\\Program Files*"))))) | eval sigma_attack_tags="attack.defense_evasion attack.execution attack.t1218" | eval sigma_title="Application Whitelisting Bypass via PresentationHost.exe" | eval sigma_description="Detects usage of 'PresentationHost' which is a utility that runs '.xbap' (Browser Applications) files. It can be abused to run malicious '.xbap' files any bypass AWL"
dispatch.earliest_time = -24h@h
alert.track = 0

[Application Whitelisting Bypass via PresentationHost.exe - sysmon]
description = Detects usage of 'PresentationHost' which is a utility that runs '.xbap' (Browser Applications) files. It can be abused to run malicious '.xbap' files any bypass AWL
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((Image="*\\presentationhost.exe" OR OriginalFileName="PresentationHost.exe") CommandLine="*.xbap*")) NOT (((CommandLine="*C:\\Windows\\*" OR CommandLine="*C:\\Program Files*"))))) | eval sigma_attack_tags="attack.defense_evasion attack.execution attack.t1218" | eval sigma_title="Application Whitelisting Bypass via PresentationHost.exe" | eval sigma_description="Detects usage of 'PresentationHost' which is a utility that runs '.xbap' (Browser Applications) files. It can be abused to run malicious '.xbap' files any bypass AWL"
dispatch.earliest_time = -24h@h
alert.track = 0

[PrintBrm ZIP Creation of Extraction - winevent]
description = Detects the execution of the LOLBIN PrintBrm.exe, which can be used to create or extract ZIP files. PrintBrm.exe should not be run on a normal workstation.
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\PrintBrm.exe" Process_Command_Line="* -f*" Process_Command_Line="*.zip*")) | eval sigma_attack_tags="attack.command_and_control attack.t1105 attack.defense_evasion attack.t1564.004" | eval sigma_title="PrintBrm ZIP Creation of Extraction" | eval sigma_description="Detects the execution of the LOLBIN PrintBrm.exe, which can be used to create or extract ZIP files. PrintBrm.exe should not be run on a normal workstation."
dispatch.earliest_time = -24h@h
alert.track = 0

[PrintBrm ZIP Creation of Extraction - sysmon]
description = Detects the execution of the LOLBIN PrintBrm.exe, which can be used to create or extract ZIP files. PrintBrm.exe should not be run on a normal workstation.
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\PrintBrm.exe" CommandLine="* -f*" CommandLine="*.zip*")) | eval sigma_attack_tags="attack.command_and_control attack.t1105 attack.defense_evasion attack.t1564.004" | eval sigma_title="PrintBrm ZIP Creation of Extraction" | eval sigma_description="Detects the execution of the LOLBIN PrintBrm.exe, which can be used to create or extract ZIP files. PrintBrm.exe should not be run on a normal workstation."
dispatch.earliest_time = -24h@h
alert.track = 0

[File Download Using ProtocolHandler.exe - winevent]
description = Detects usage of 'ProtocolHandler' to download files. Downloaded files will be located in the cache folder (for example - %LOCALAPPDATA%\Microsoft\Windows\INetCache\IE)
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\protocolhandler.exe" OR OriginalFileName="ProtocolHandler.exe") (((Process_Command_Line="*\"ms-word*" Process_Command_Line="*.docx\"*")) OR Process_Command_Line="* http*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218" | eval sigma_title="File Download Using ProtocolHandler.exe" | eval sigma_description="Detects usage of 'ProtocolHandler' to download files. Downloaded files will be located in the cache folder (for example - %LOCALAPPDATA%\Microsoft\Windows\INetCache\IE)"
dispatch.earliest_time = -24h@h
alert.track = 0

[File Download Using ProtocolHandler.exe - sysmon]
description = Detects usage of 'ProtocolHandler' to download files. Downloaded files will be located in the cache folder (for example - %LOCALAPPDATA%\Microsoft\Windows\INetCache\IE)
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\protocolhandler.exe" OR OriginalFileName="ProtocolHandler.exe") (((CommandLine="*\"ms-word*" CommandLine="*.docx\"*")) OR CommandLine="* http*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218" | eval sigma_title="File Download Using ProtocolHandler.exe" | eval sigma_description="Detects usage of 'ProtocolHandler' to download files. Downloaded files will be located in the cache folder (for example - %LOCALAPPDATA%\Microsoft\Windows\INetCache\IE)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Pubprn.vbs Proxy Execution - winevent]
description = Detects the use of the 'Pubprn.vbs' Microsoft signed script to execute commands.
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*\\pubprn.vbs*" Process_Command_Line="*script:*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1216.001" | eval sigma_title="Pubprn.vbs Proxy Execution" | eval sigma_description="Detects the use of the 'Pubprn.vbs' Microsoft signed script to execute commands."
dispatch.earliest_time = -24h@h
alert.track = 0

[Pubprn.vbs Proxy Execution - sysmon]
description = Detects the use of the 'Pubprn.vbs' Microsoft signed script to execute commands.
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*\\pubprn.vbs*" CommandLine="*script:*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1216.001" | eval sigma_title="Pubprn.vbs Proxy Execution" | eval sigma_description="Detects the use of the 'Pubprn.vbs' Microsoft signed script to execute commands."
dispatch.earliest_time = -24h@h
alert.track = 0

[DLL Execution via Rasautou.exe - winevent]
description = Detects using Rasautou.exe for loading arbitrary .DLL specified in -d option and executes the export specified in -p.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\rasautou.exe" OR OriginalFileName="rasdlui.exe") ((Process_Command_Line="* -d *" Process_Command_Line="* -p *")))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218" | eval sigma_title="DLL Execution via Rasautou.exe" | eval sigma_description="Detects using Rasautou.exe for loading arbitrary .DLL specified in -d option and executes the export specified in -p."
dispatch.earliest_time = -24h@h
alert.track = 0

[DLL Execution via Rasautou.exe - sysmon]
description = Detects using Rasautou.exe for loading arbitrary .DLL specified in -d option and executes the export specified in -p.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\rasautou.exe" OR OriginalFileName="rasdlui.exe") ((CommandLine="* -d *" CommandLine="* -p *")))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218" | eval sigma_title="DLL Execution via Rasautou.exe" | eval sigma_description="Detects using Rasautou.exe for loading arbitrary .DLL specified in -d option and executes the export specified in -p."
dispatch.earliest_time = -24h@h
alert.track = 0

[Regasm/Regsvcs Suspicious Execution - winevent]
description = Detects suspicious execution of Regasm/Regsvcs utilities
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((((New_Process_Name="*\\Regsvcs.exe" OR New_Process_Name="*\\Regasm.exe") OR (OriginalFileName="RegSvcs.exe" OR OriginalFileName="RegAsm.exe")) (Process_Command_Line="*\\Users\\Public\\*" OR Process_Command_Line="*\\AppData\\Local\\Temp\\*" OR Process_Command_Line="*\\Desktop\\*" OR Process_Command_Line="*\\Downloads\\*" OR Process_Command_Line="*\\PerfLogs\\*" OR Process_Command_Line="*\\Windows\\Temp\\*" OR Process_Command_Line="*\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\*"))) OR ((((New_Process_Name="*\\Regsvcs.exe" OR New_Process_Name="*\\Regasm.exe") OR (OriginalFileName="RegSvcs.exe" OR OriginalFileName="RegAsm.exe")) NOT ((Process_Command_Line="*.dll*"))))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218.009" | eval sigma_title="Regasm/Regsvcs Suspicious Execution" | eval sigma_description="Detects suspicious execution of Regasm/Regsvcs utilities"
dispatch.earliest_time = -24h@h
alert.track = 0

[Regasm/Regsvcs Suspicious Execution - sysmon]
description = Detects suspicious execution of Regasm/Regsvcs utilities
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((((Image="*\\Regsvcs.exe" OR Image="*\\Regasm.exe") OR (OriginalFileName="RegSvcs.exe" OR OriginalFileName="RegAsm.exe")) (CommandLine="*\\Users\\Public\\*" OR CommandLine="*\\AppData\\Local\\Temp\\*" OR CommandLine="*\\Desktop\\*" OR CommandLine="*\\Downloads\\*" OR CommandLine="*\\PerfLogs\\*" OR CommandLine="*\\Windows\\Temp\\*" OR CommandLine="*\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\*"))) OR ((((Image="*\\Regsvcs.exe" OR Image="*\\Regasm.exe") OR (OriginalFileName="RegSvcs.exe" OR OriginalFileName="RegAsm.exe")) NOT ((CommandLine="*.dll*"))))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218.009" | eval sigma_title="Regasm/Regsvcs Suspicious Execution" | eval sigma_description="Detects suspicious execution of Regasm/Regsvcs utilities"
dispatch.earliest_time = -24h@h
alert.track = 0

[REGISTER_APP.VBS Proxy Execution - winevent]
description = Detects the use of a Microsoft signed script 'REGISTER_APP.VBS' to register a VSS/VDS Provider as a COM+ application.
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*\\register_app.vbs*" Process_Command_Line="*-register*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1218" | eval sigma_title="REGISTER_APP.VBS Proxy Execution" | eval sigma_description="Detects the use of a Microsoft signed script 'REGISTER_APP.VBS' to register a VSS/VDS Provider as a COM+ application."
dispatch.earliest_time = -24h@h
alert.track = 0

[REGISTER_APP.VBS Proxy Execution - sysmon]
description = Detects the use of a Microsoft signed script 'REGISTER_APP.VBS' to register a VSS/VDS Provider as a COM+ application.
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*\\register_app.vbs*" CommandLine="*-register*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1218" | eval sigma_title="REGISTER_APP.VBS Proxy Execution" | eval sigma_description="Detects the use of a Microsoft signed script 'REGISTER_APP.VBS' to register a VSS/VDS Provider as a COM+ application."
dispatch.earliest_time = -24h@h
alert.track = 0

[Use of Remote.exe - winevent]
description = Remote.exe is part of WinDbg in the Windows SDK and can be used for AWL bypass and running remote files.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\remote.exe" OR OriginalFileName="remote.exe"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1127" | eval sigma_title="Use of Remote.exe" | eval sigma_description="Remote.exe is part of WinDbg in the Windows SDK and can be used for AWL bypass and running remote files."
dispatch.earliest_time = -24h@h
alert.track = 0

[Use of Remote.exe - sysmon]
description = Remote.exe is part of WinDbg in the Windows SDK and can be used for AWL bypass and running remote files.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\remote.exe" OR OriginalFileName="remote.exe"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1127" | eval sigma_title="Use of Remote.exe" | eval sigma_description="Remote.exe is part of WinDbg in the Windows SDK and can be used for AWL bypass and running remote files."
dispatch.earliest_time = -24h@h
alert.track = 0

[Replace.exe Usage - winevent]
description = Detects the use of Replace.exe which can be used to replace file with another file
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\replace.exe" (Process_Command_Line="*/a*" OR Process_Command_Line="*-a*"))) | eval sigma_attack_tags="attack.command_and_control attack.t1105" | eval sigma_title="Replace.exe Usage" | eval sigma_description="Detects the use of Replace.exe which can be used to replace file with another file"
dispatch.earliest_time = -24h@h
alert.track = 0

[Replace.exe Usage - sysmon]
description = Detects the use of Replace.exe which can be used to replace file with another file
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\replace.exe" (CommandLine="*/a*" OR CommandLine="*-a*"))) | eval sigma_attack_tags="attack.command_and_control attack.t1105" | eval sigma_title="Replace.exe Usage" | eval sigma_description="Detects the use of Replace.exe which can be used to replace file with another file"
dispatch.earliest_time = -24h@h
alert.track = 0

[Rundll32 InstallScreenSaver Execution - winevent]
description = An attacker may execute an application as a SCR File using rundll32.exe desk.cpl,InstallScreenSaver
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\rundll32.exe" Process_Command_Line="*InstallScreenSaver*")) | eval sigma_attack_tags="attack.t1218.011 attack.defense_evasion" | eval sigma_title="Rundll32 InstallScreenSaver Execution" | eval sigma_description="An attacker may execute an application as a SCR File using rundll32.exe desk.cpl,InstallScreenSaver"
dispatch.earliest_time = -24h@h
alert.track = 0

[Rundll32 InstallScreenSaver Execution - sysmon]
description = An attacker may execute an application as a SCR File using rundll32.exe desk.cpl,InstallScreenSaver
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\rundll32.exe" CommandLine="*InstallScreenSaver*")) | eval sigma_attack_tags="attack.t1218.011 attack.defense_evasion" | eval sigma_title="Rundll32 InstallScreenSaver Execution" | eval sigma_description="An attacker may execute an application as a SCR File using rundll32.exe desk.cpl,InstallScreenSaver"
dispatch.earliest_time = -24h@h
alert.track = 0

[Lolbin Runexehelper Use As Proxy - winevent]
description = Detect usage of the 'runexehelper.exe' binary as a proxy to launch other programs
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Creator_Process_Name="*\\runexehelper.exe")) | eval sigma_attack_tags="attack.defense_evasion attack.t1218" | eval sigma_title="Lolbin Runexehelper Use As Proxy" | eval sigma_description="Detect usage of the 'runexehelper.exe' binary as a proxy to launch other programs"
dispatch.earliest_time = -24h@h
alert.track = 0

[Lolbin Runexehelper Use As Proxy - sysmon]
description = Detect usage of the 'runexehelper.exe' binary as a proxy to launch other programs
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") ParentImage="*\\runexehelper.exe")) | eval sigma_attack_tags="attack.defense_evasion attack.t1218" | eval sigma_title="Lolbin Runexehelper Use As Proxy" | eval sigma_description="Detect usage of the 'runexehelper.exe' binary as a proxy to launch other programs"
dispatch.earliest_time = -24h@h
alert.track = 0

[Use of Scriptrunner.exe - winevent]
description = The 'ScriptRunner.exe' binary can be abused to proxy execution through it and bypass possible whitelisting
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\ScriptRunner.exe" OR OriginalFileName="ScriptRunner.exe") Process_Command_Line="* -appvscript *")) | eval sigma_attack_tags="attack.defense_evasion attack.execution attack.t1218" | eval sigma_title="Use of Scriptrunner.exe" | eval sigma_description="The 'ScriptRunner.exe' binary can be abused to proxy execution through it and bypass possible whitelisting"
dispatch.earliest_time = -24h@h
alert.track = 0

[Use of Scriptrunner.exe - sysmon]
description = The 'ScriptRunner.exe' binary can be abused to proxy execution through it and bypass possible whitelisting
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\ScriptRunner.exe" OR OriginalFileName="ScriptRunner.exe") CommandLine="* -appvscript *")) | eval sigma_attack_tags="attack.defense_evasion attack.execution attack.t1218" | eval sigma_title="Use of Scriptrunner.exe" | eval sigma_description="The 'ScriptRunner.exe' binary can be abused to proxy execution through it and bypass possible whitelisting"
dispatch.earliest_time = -24h@h
alert.track = 0

[Use of Setres.exe - winevent]
description = Detects the use of Setres.exe to set the screen resolution and then potentially launch a file named 'choice' (with any executable extension such as '.cmd' or '.exe') from the current execution path
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Creator_Process_Name="*\\setres.exe" New_Process_Name="*\\choice")) | eval sigma_attack_tags="attack.defense_evasion attack.t1218 attack.t1202" | eval sigma_title="Use of Setres.exe" | eval sigma_description="Detects the use of Setres.exe to set the screen resolution and then potentially launch a file named 'choice' (with any executable extension such as '.cmd' or '.exe') from the current execution path"
dispatch.earliest_time = -24h@h
alert.track = 0

[Use of Setres.exe - sysmon]
description = Detects the use of Setres.exe to set the screen resolution and then potentially launch a file named 'choice' (with any executable extension such as '.cmd' or '.exe') from the current execution path
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") ParentImage="*\\setres.exe" Image="*\\choice")) | eval sigma_attack_tags="attack.defense_evasion attack.t1218 attack.t1202" | eval sigma_title="Use of Setres.exe" | eval sigma_description="Detects the use of Setres.exe to set the screen resolution and then potentially launch a file named 'choice' (with any executable extension such as '.cmd' or '.exe') from the current execution path"
dispatch.earliest_time = -24h@h
alert.track = 0

[Using SettingSyncHost.exe as LOLBin - winevent]
description = Detects using SettingSyncHost.exe to run hijacked binary
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) NOT (((New_Process_Name="C:\\Windows\\System32\\*" OR New_Process_Name="C:\\Windows\\SysWOW64\\*"))) ((ParentCommandLine="*cmd.exe /c*" ParentCommandLine="*RoamDiag.cmd*" ParentCommandLine="*-outputpath*")))) | table TargetFilename,New_Process_Name | eval sigma_attack_tags="attack.execution attack.defense_evasion attack.t1574.008" | eval sigma_title="Using SettingSyncHost.exe as LOLBin" | eval sigma_description="Detects using SettingSyncHost.exe to run hijacked binary"
dispatch.earliest_time = -24h@h
alert.track = 0

[Using SettingSyncHost.exe as LOLBin - sysmon]
description = Detects using SettingSyncHost.exe to run hijacked binary
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) NOT (((Image="C:\\Windows\\System32\\*" OR Image="C:\\Windows\\SysWOW64\\*"))) ((ParentCommandLine="*cmd.exe /c*" ParentCommandLine="*RoamDiag.cmd*" ParentCommandLine="*-outputpath*")))) | table TargetFilename,Image | eval sigma_attack_tags="attack.execution attack.defense_evasion attack.t1574.008" | eval sigma_title="Using SettingSyncHost.exe as LOLBin" | eval sigma_description="Detects using SettingSyncHost.exe to run hijacked binary"
dispatch.earliest_time = -24h@h
alert.track = 0

[Use Of The SFTP.EXE Binary As A LOLBIN - winevent]
description = Detects the usage of the 'sftp.exe' binary as a LOLBIN by abusing the '-D' flag
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\sftp.exe" (Process_Command_Line="* -D ..*" OR Process_Command_Line="* -D C:\\*"))) | eval sigma_attack_tags="attack.defense_evasion attack.execution attack.t1218" | eval sigma_title="Use Of The SFTP.EXE Binary As A LOLBIN" | eval sigma_description="Detects the usage of the 'sftp.exe' binary as a LOLBIN by abusing the '-D' flag"
dispatch.earliest_time = -24h@h
alert.track = 0

[Use Of The SFTP.EXE Binary As A LOLBIN - sysmon]
description = Detects the usage of the 'sftp.exe' binary as a LOLBIN by abusing the '-D' flag
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\sftp.exe" (CommandLine="* -D ..*" OR CommandLine="* -D C:\\*"))) | eval sigma_attack_tags="attack.defense_evasion attack.execution attack.t1218" | eval sigma_title="Use Of The SFTP.EXE Binary As A LOLBIN" | eval sigma_description="Detects the usage of the 'sftp.exe' binary as a LOLBIN by abusing the '-D' flag"
dispatch.earliest_time = -24h@h
alert.track = 0

[Sideloading Link.EXE - winevent]
description = Detects the execution utitilies often found in Visual Studio tools that hardcode the call to the binary 'link.exe'. They can be abused to sideload any binary with the same name
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\link.exe" Process_Command_Line="*LINK /*")) NOT ((((Creator_Process_Name="C:\\Program Files\\Microsoft Visual Studio\\*" OR Creator_Process_Name="C:\\Program Files (x86)\\Microsoft Visual Studio\\*") Creator_Process_Name="*\\VC\\Tools\\MSVC\\*"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218" | eval sigma_title="Sideloading Link.EXE" | eval sigma_description="Detects the execution utitilies often found in Visual Studio tools that hardcode the call to the binary 'link.exe'. They can be abused to sideload any binary with the same name"
dispatch.earliest_time = -24h@h
alert.track = 0

[Sideloading Link.EXE - sysmon]
description = Detects the execution utitilies often found in Visual Studio tools that hardcode the call to the binary 'link.exe'. They can be abused to sideload any binary with the same name
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\link.exe" CommandLine="*LINK /*")) NOT ((((ParentImage="C:\\Program Files\\Microsoft Visual Studio\\*" OR ParentImage="C:\\Program Files (x86)\\Microsoft Visual Studio\\*") ParentImage="*\\VC\\Tools\\MSVC\\*"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218" | eval sigma_title="Sideloading Link.EXE" | eval sigma_description="Detects the execution utitilies often found in Visual Studio tools that hardcode the call to the binary 'link.exe'. They can be abused to sideload any binary with the same name"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Sigverif Execution - winevent]
description = Detects the execution of sigverif binary as a parent process which could indicate it being used as a LOLBIN to proxy execution
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Creator_Process_Name="*\\sigverif.exe")) | eval sigma_attack_tags="attack.defense_evasion attack.t1216" | eval sigma_title="Suspicious Sigverif Execution" | eval sigma_description="Detects the execution of sigverif binary as a parent process which could indicate it being used as a LOLBIN to proxy execution"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Sigverif Execution - sysmon]
description = Detects the execution of sigverif binary as a parent process which could indicate it being used as a LOLBIN to proxy execution
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") ParentImage="*\\sigverif.exe")) | eval sigma_attack_tags="attack.defense_evasion attack.t1216" | eval sigma_title="Suspicious Sigverif Execution" | eval sigma_description="Detects the execution of sigverif binary as a parent process which could indicate it being used as a LOLBIN to proxy execution"
dispatch.earliest_time = -24h@h
alert.track = 0

[Use of Squirrel.exe - winevent]
description = The 'Squirrel.exe' binary that is part of multiple software (Slack, Teams, Discord...etc) can be used as a LOLBIN
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\squirrel.exe" (Process_Command_Line="* --download *" OR Process_Command_Line="* --update *" OR Process_Command_Line="* --updateRollback=*") Process_Command_Line="*http*")) | eval sigma_attack_tags="attack.defense_evasion attack.execution" | eval sigma_title="Use of Squirrel.exe" | eval sigma_description="The 'Squirrel.exe' binary that is part of multiple software (Slack, Teams, Discord...etc) can be used as a LOLBIN"
dispatch.earliest_time = -24h@h
alert.track = 0

[Use of Squirrel.exe - sysmon]
description = The 'Squirrel.exe' binary that is part of multiple software (Slack, Teams, Discord...etc) can be used as a LOLBIN
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\squirrel.exe" (CommandLine="* --download *" OR CommandLine="* --update *" OR CommandLine="* --updateRollback=*") CommandLine="*http*")) | eval sigma_attack_tags="attack.defense_evasion attack.execution" | eval sigma_title="Use of Squirrel.exe" | eval sigma_description="The 'Squirrel.exe' binary that is part of multiple software (Slack, Teams, Discord...etc) can be used as a LOLBIN"
dispatch.earliest_time = -24h@h
alert.track = 0

[Lolbin Ssh.exe Use As Proxy - winevent]
description = Detect usage of the 'ssh.exe' binary as a proxy to launch other programs
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (Creator_Process_Name="C:\\Windows\\System32\\OpenSSH\\sshd.exe" OR ((New_Process_Name="*\\ssh.exe" (Process_Command_Line="*ProxyCommand=*" OR ((Process_Command_Line="*PermitLocalCommand*" Process_Command_Line="*LocalCommand*")))))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1202" | eval sigma_title="Lolbin Ssh.exe Use As Proxy" | eval sigma_description="Detect usage of the 'ssh.exe' binary as a proxy to launch other programs"
dispatch.earliest_time = -24h@h
alert.track = 0

[Lolbin Ssh.exe Use As Proxy - sysmon]
description = Detect usage of the 'ssh.exe' binary as a proxy to launch other programs
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (ParentImage="C:\\Windows\\System32\\OpenSSH\\sshd.exe" OR ((Image="*\\ssh.exe" (CommandLine="*ProxyCommand=*" OR ((CommandLine="*PermitLocalCommand*" CommandLine="*LocalCommand*")))))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1202" | eval sigma_title="Lolbin Ssh.exe Use As Proxy" | eval sigma_description="Detect usage of the 'ssh.exe' binary as a proxy to launch other programs"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious LOLBIN AccCheckConsole - winevent]
description = Detects suspicious LOLBIN AccCheckConsole execution with parameters as used to load an arbitrary DLL
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\AccCheckConsole.exe" OR OriginalFileName="AccCheckConsole.exe") ((Process_Command_Line="* -window *" Process_Command_Line="*.dll*")))) | eval sigma_attack_tags="attack.execution" | eval sigma_title="Suspicious LOLBIN AccCheckConsole" | eval sigma_description="Detects suspicious LOLBIN AccCheckConsole execution with parameters as used to load an arbitrary DLL"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious LOLBIN AccCheckConsole - sysmon]
description = Detects suspicious LOLBIN AccCheckConsole execution with parameters as used to load an arbitrary DLL
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\AccCheckConsole.exe" OR OriginalFileName="AccCheckConsole.exe") ((CommandLine="* -window *" CommandLine="*.dll*")))) | eval sigma_attack_tags="attack.execution" | eval sigma_title="Suspicious LOLBIN AccCheckConsole" | eval sigma_description="Detects suspicious LOLBIN AccCheckConsole execution with parameters as used to load an arbitrary DLL"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Atbroker Execution - winevent]
description = Atbroker executing non-deafualt Assistive Technology applications
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*AtBroker.exe" Process_Command_Line="*start*")) NOT (((Process_Command_Line="*animations*" OR Process_Command_Line="*audiodescription*" OR Process_Command_Line="*caretbrowsing*" OR Process_Command_Line="*caretwidth*" OR Process_Command_Line="*colorfiltering*" OR Process_Command_Line="*cursorscheme*" OR Process_Command_Line="*filterkeys*" OR Process_Command_Line="*focusborderheight*" OR Process_Command_Line="*focusborderwidth*" OR Process_Command_Line="*highcontrast*" OR Process_Command_Line="*keyboardcues*" OR Process_Command_Line="*keyboardpref*" OR Process_Command_Line="*magnifierpane*" OR Process_Command_Line="*messageduration*" OR Process_Command_Line="*minimumhitradius*" OR Process_Command_Line="*mousekeys*" OR Process_Command_Line="*Narrator*" OR Process_Command_Line="*osk*" OR Process_Command_Line="*overlappedcontent*" OR Process_Command_Line="*showsounds*" OR Process_Command_Line="*soundsentry*" OR Process_Command_Line="*stickykeys*" OR Process_Command_Line="*togglekeys*" OR Process_Command_Line="*windowarranging*" OR Process_Command_Line="*windowtracking*" OR Process_Command_Line="*windowtrackingtimeout*" OR Process_Command_Line="*windowtrackingzorder*"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218" | eval sigma_title="Suspicious Atbroker Execution" | eval sigma_description="Atbroker executing non-deafualt Assistive Technology applications"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Atbroker Execution - sysmon]
description = Atbroker executing non-deafualt Assistive Technology applications
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*AtBroker.exe" CommandLine="*start*")) NOT (((CommandLine="*animations*" OR CommandLine="*audiodescription*" OR CommandLine="*caretbrowsing*" OR CommandLine="*caretwidth*" OR CommandLine="*colorfiltering*" OR CommandLine="*cursorscheme*" OR CommandLine="*filterkeys*" OR CommandLine="*focusborderheight*" OR CommandLine="*focusborderwidth*" OR CommandLine="*highcontrast*" OR CommandLine="*keyboardcues*" OR CommandLine="*keyboardpref*" OR CommandLine="*magnifierpane*" OR CommandLine="*messageduration*" OR CommandLine="*minimumhitradius*" OR CommandLine="*mousekeys*" OR CommandLine="*Narrator*" OR CommandLine="*osk*" OR CommandLine="*overlappedcontent*" OR CommandLine="*showsounds*" OR CommandLine="*soundsentry*" OR CommandLine="*stickykeys*" OR CommandLine="*togglekeys*" OR CommandLine="*windowarranging*" OR CommandLine="*windowtracking*" OR CommandLine="*windowtrackingtimeout*" OR CommandLine="*windowtrackingzorder*"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218" | eval sigma_title="Suspicious Atbroker Execution" | eval sigma_description="Atbroker executing non-deafualt Assistive Technology applications"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Certreq Command to Download - winevent]
description = Detects a suspicious certreq execution taken from the LOLBAS examples, which can be abused to download (small) files
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\certreq.exe" OR OriginalFileName="CertReq.exe") ((Process_Command_Line="* -Post *" Process_Command_Line="* -config *" Process_Command_Line="* http*" Process_Command_Line="* C:\\windows\\win.ini *")))) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.command_and_control attack.t1105" | eval sigma_title="Suspicious Certreq Command to Download" | eval sigma_description="Detects a suspicious certreq execution taken from the LOLBAS examples, which can be abused to download (small) files"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Certreq Command to Download - sysmon]
description = Detects a suspicious certreq execution taken from the LOLBAS examples, which can be abused to download (small) files
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\certreq.exe" OR OriginalFileName="CertReq.exe") ((CommandLine="* -Post *" CommandLine="* -config *" CommandLine="* http*" CommandLine="* C:\\windows\\win.ini *")))) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.command_and_control attack.t1105" | eval sigma_title="Suspicious Certreq Command to Download" | eval sigma_description="Detects a suspicious certreq execution taken from the LOLBAS examples, which can be abused to download (small) files"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Driver Install by pnputil.exe - winevent]
description = Detects when a possible suspicious driver is being installed via pnputil.exe lolbin
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (Process_Command_Line="*-i*" OR Process_Command_Line="*/install*" OR Process_Command_Line="*-a*" OR Process_Command_Line="*/add-driver*" OR Process_Command_Line="*.inf*") New_Process_Name="*\\pnputil.exe")) | table ComputerName,Account_Name,Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.persistence attack.t1547" | eval sigma_title="Suspicious Driver Install by pnputil.exe" | eval sigma_description="Detects when a possible suspicious driver is being installed via pnputil.exe lolbin"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Driver Install by pnputil.exe - sysmon]
description = Detects when a possible suspicious driver is being installed via pnputil.exe lolbin
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (CommandLine="*-i*" OR CommandLine="*/install*" OR CommandLine="*-a*" OR CommandLine="*/add-driver*" OR CommandLine="*.inf*") Image="*\\pnputil.exe")) | table ComputerName,User,CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.persistence attack.t1547" | eval sigma_title="Suspicious Driver Install by pnputil.exe" | eval sigma_description="Detects when a possible suspicious driver is being installed via pnputil.exe lolbin"
dispatch.earliest_time = -24h@h
alert.track = 0

[Application Whitelisting Bypass via Dxcap.exe - winevent]
description = Detects execution of of Dxcap.exe
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\DXCap.exe" OR OriginalFileName="DXCap.exe") Process_Command_Line="* -c *")) | eval sigma_attack_tags="attack.defense_evasion attack.t1218" | eval sigma_title="Application Whitelisting Bypass via Dxcap.exe" | eval sigma_description="Detects execution of of Dxcap.exe"
dispatch.earliest_time = -24h@h
alert.track = 0

[Application Whitelisting Bypass via Dxcap.exe - sysmon]
description = Detects execution of of Dxcap.exe
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\DXCap.exe" OR OriginalFileName="DXCap.exe") CommandLine="* -c *")) | eval sigma_attack_tags="attack.defense_evasion attack.t1218" | eval sigma_title="Application Whitelisting Bypass via Dxcap.exe" | eval sigma_description="Detects execution of of Dxcap.exe"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious GrpConv Execution - winevent]
description = Detects the suspicious execution of a utility to convert Windows 3.x .grp files or for persistence purposes by malicious software or actors
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (Process_Command_Line="*grpconv.exe -o*" OR Process_Command_Line="*grpconv -o*"))) | eval sigma_attack_tags="attack.persistence attack.t1547" | eval sigma_title="Suspicious GrpConv Execution" | eval sigma_description="Detects the suspicious execution of a utility to convert Windows 3.x .grp files or for persistence purposes by malicious software or actors"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious GrpConv Execution - sysmon]
description = Detects the suspicious execution of a utility to convert Windows 3.x .grp files or for persistence purposes by malicious software or actors
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (CommandLine="*grpconv.exe -o*" OR CommandLine="*grpconv -o*"))) | eval sigma_attack_tags="attack.persistence attack.t1547" | eval sigma_title="Suspicious GrpConv Execution" | eval sigma_description="Detects the suspicious execution of a utility to convert Windows 3.x .grp files or for persistence purposes by malicious software or actors"
dispatch.earliest_time = -24h@h
alert.track = 0

[Windows Defender Download Activity - winevent]
description = Detect the use of Windows Defender to download payloads
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (Process_Command_Line="*MpCmdRun.exe*" OR Description="Microsoft Malware Protection Command Line Utility") ((Process_Command_Line="*DownloadFile*" Process_Command_Line="*url*")))) | table Process_Command_Line | eval sigma_attack_tags="attack.defense_evasion attack.t1218 attack.command_and_control attack.t1105" | eval sigma_title="Windows Defender Download Activity" | eval sigma_description="Detect the use of Windows Defender to download payloads"
dispatch.earliest_time = -24h@h
alert.track = 0

[Windows Defender Download Activity - sysmon]
description = Detect the use of Windows Defender to download payloads
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (CommandLine="*MpCmdRun.exe*" OR Description="Microsoft Malware Protection Command Line Utility") ((CommandLine="*DownloadFile*" CommandLine="*url*")))) | table CommandLine | eval sigma_attack_tags="attack.defense_evasion attack.t1218 attack.command_and_control attack.t1105" | eval sigma_title="Windows Defender Download Activity" | eval sigma_description="Detect the use of Windows Defender to download payloads"
dispatch.earliest_time = -24h@h
alert.track = 0

[Dumping Process via Sqldumper.exe - winevent]
description = Detects process dump via legitimate sqldumper.exe binary
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\sqldumper.exe" (Process_Command_Line="*0x0110*" OR Process_Command_Line="*0x01100:40*"))) | eval sigma_attack_tags="attack.credential_access attack.t1003.001" | eval sigma_title="Dumping Process via Sqldumper.exe" | eval sigma_description="Detects process dump via legitimate sqldumper.exe binary"
dispatch.earliest_time = -24h@h
alert.track = 0

[Dumping Process via Sqldumper.exe - sysmon]
description = Detects process dump via legitimate sqldumper.exe binary
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\sqldumper.exe" (CommandLine="*0x0110*" OR CommandLine="*0x01100:40*"))) | eval sigma_attack_tags="attack.credential_access attack.t1003.001" | eval sigma_title="Dumping Process via Sqldumper.exe" | eval sigma_description="Detects process dump via legitimate sqldumper.exe binary"
dispatch.earliest_time = -24h@h
alert.track = 0

[Arbitrary Command Execution Using WSL - winevent]
description = Detects Possible usage of Windows Subsystem for Linux (WSL) binary as a LOLBIN to execute arbitrary linux and windows commands
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((New_Process_Name="*\\wsl.exe" OR OriginalFileName="wsl.exe") (Process_Command_Line="* -e *" OR Process_Command_Line="* --exec*" OR Process_Command_Line="* --system*" OR Process_Command_Line="* --shell-type *" OR Process_Command_Line="* /mnt/c*" OR Process_Command_Line="* --user root*" OR Process_Command_Line="* -u root*"))) NOT (((Creator_Process_Name="*\\cmd.exe" (Process_Command_Line="* -d *" Process_Command_Line="* -e kill *")))))) | eval sigma_attack_tags="attack.execution attack.defense_evasion attack.t1218 attack.t1202" | eval sigma_title="Arbitrary Command Execution Using WSL" | eval sigma_description="Detects Possible usage of Windows Subsystem for Linux (WSL) binary as a LOLBIN to execute arbitrary linux and windows commands"
dispatch.earliest_time = -24h@h
alert.track = 0

[Arbitrary Command Execution Using WSL - sysmon]
description = Detects Possible usage of Windows Subsystem for Linux (WSL) binary as a LOLBIN to execute arbitrary linux and windows commands
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((Image="*\\wsl.exe" OR OriginalFileName="wsl.exe") (CommandLine="* -e *" OR CommandLine="* --exec*" OR CommandLine="* --system*" OR CommandLine="* --shell-type *" OR CommandLine="* /mnt/c*" OR CommandLine="* --user root*" OR CommandLine="* -u root*"))) NOT (((ParentImage="*\\cmd.exe" (CommandLine="* -d *" CommandLine="* -e kill *")))))) | eval sigma_attack_tags="attack.execution attack.defense_evasion attack.t1218 attack.t1202" | eval sigma_title="Arbitrary Command Execution Using WSL" | eval sigma_description="Detects Possible usage of Windows Subsystem for Linux (WSL) binary as a LOLBIN to execute arbitrary linux and windows commands"
dispatch.earliest_time = -24h@h
alert.track = 0

[SyncAppvPublishingServer Execute Arbitrary PowerShell Code - winevent]
description = Executes arbitrary PowerShell code using SyncAppvPublishingServer.exe.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\SyncAppvPublishingServer.exe" OR OriginalFileName="syncappvpublishingserver.exe") Process_Command_Line="*\"n; *")) | table ComputerName,Account_Name,Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.t1218" | eval sigma_title="SyncAppvPublishingServer Execute Arbitrary PowerShell Code" | eval sigma_description="Executes arbitrary PowerShell code using SyncAppvPublishingServer.exe."
dispatch.earliest_time = -24h@h
alert.track = 0

[SyncAppvPublishingServer Execute Arbitrary PowerShell Code - sysmon]
description = Executes arbitrary PowerShell code using SyncAppvPublishingServer.exe.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\SyncAppvPublishingServer.exe" OR OriginalFileName="syncappvpublishingserver.exe") CommandLine="*\"n; *")) | table ComputerName,User,CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.t1218" | eval sigma_title="SyncAppvPublishingServer Execute Arbitrary PowerShell Code" | eval sigma_description="Executes arbitrary PowerShell code using SyncAppvPublishingServer.exe."
dispatch.earliest_time = -24h@h
alert.track = 0

[SyncAppvPublishingServer VBS Execute Arbitrary PowerShell Code - winevent]
description = Executes arbitrary PowerShell code using SyncAppvPublishingServer.vbs
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*\\SyncAppvPublishingServer.vbs*" Process_Command_Line="*;*")) | table ComputerName,Account_Name,Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.t1218 attack.t1216" | eval sigma_title="SyncAppvPublishingServer VBS Execute Arbitrary PowerShell Code" | eval sigma_description="Executes arbitrary PowerShell code using SyncAppvPublishingServer.vbs"
dispatch.earliest_time = -24h@h
alert.track = 0

[SyncAppvPublishingServer VBS Execute Arbitrary PowerShell Code - sysmon]
description = Executes arbitrary PowerShell code using SyncAppvPublishingServer.vbs
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*\\SyncAppvPublishingServer.vbs*" CommandLine="*;*")) | table ComputerName,User,CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.t1218 attack.t1216" | eval sigma_title="SyncAppvPublishingServer VBS Execute Arbitrary PowerShell Code" | eval sigma_description="Executes arbitrary PowerShell code using SyncAppvPublishingServer.vbs"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential DLL Injection Or Execution Using Tracker.exe - winevent]
description = Detects potential DLL injection and execution using 'Tracker.exe'
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((New_Process_Name="*\\tracker.exe" OR Description="Tracker") (Process_Command_Line="* /d *" OR Process_Command_Line="* /c *"))) NOT (((Process_Command_Line="* /ERRORREPORT:PROMPT *")) OR (((Creator_Process_Name="*\\Msbuild\\Current\\Bin\\MSBuild.exe" OR Creator_Process_Name="*\\Msbuild\\Current\\Bin\\amd64\\MSBuild.exe")))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1055.001" | eval sigma_title="Potential DLL Injection Or Execution Using Tracker.exe" | eval sigma_description="Detects potential DLL injection and execution using 'Tracker.exe'"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential DLL Injection Or Execution Using Tracker.exe - sysmon]
description = Detects potential DLL injection and execution using 'Tracker.exe'
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((Image="*\\tracker.exe" OR Description="Tracker") (CommandLine="* /d *" OR CommandLine="* /c *"))) NOT (((CommandLine="* /ERRORREPORT:PROMPT *")) OR (((ParentImage="*\\Msbuild\\Current\\Bin\\MSBuild.exe" OR ParentImage="*\\Msbuild\\Current\\Bin\\amd64\\MSBuild.exe")))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1055.001" | eval sigma_title="Potential DLL Injection Or Execution Using Tracker.exe" | eval sigma_description="Detects potential DLL injection and execution using 'Tracker.exe'"
dispatch.earliest_time = -24h@h
alert.track = 0

[Use of TTDInject.exe - winevent]
description = Detects the executiob of TTDInject.exe, which is used by Windows 10 v1809 and newer to debug time travel (underlying call of tttracer.exe)
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*ttdinject.exe" OR OriginalFileName="TTDInject.EXE"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1127" | eval sigma_title="Use of TTDInject.exe" | eval sigma_description="Detects the executiob of TTDInject.exe, which is used by Windows 10 v1809 and newer to debug time travel (underlying call of tttracer.exe)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Use of TTDInject.exe - sysmon]
description = Detects the executiob of TTDInject.exe, which is used by Windows 10 v1809 and newer to debug time travel (underlying call of tttracer.exe)
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*ttdinject.exe" OR OriginalFileName="TTDInject.EXE"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1127" | eval sigma_title="Use of TTDInject.exe" | eval sigma_description="Detects the executiob of TTDInject.exe, which is used by Windows 10 v1809 and newer to debug time travel (underlying call of tttracer.exe)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Time Travel Debugging Utility Usage - winevent]
description = Detects usage of Time Travel Debugging Utility. Adversaries can execute malicious processes and dump processes, such as lsass.exe, via tttracer.exe.
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Creator_Process_Name="*\\tttracer.exe")) | eval sigma_attack_tags="attack.defense_evasion attack.credential_access attack.t1218 attack.t1003.001" | eval sigma_title="Time Travel Debugging Utility Usage" | eval sigma_description="Detects usage of Time Travel Debugging Utility. Adversaries can execute malicious processes and dump processes, such as lsass.exe, via tttracer.exe."
dispatch.earliest_time = -24h@h
alert.track = 0

[Time Travel Debugging Utility Usage - sysmon]
description = Detects usage of Time Travel Debugging Utility. Adversaries can execute malicious processes and dump processes, such as lsass.exe, via tttracer.exe.
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") ParentImage="*\\tttracer.exe")) | eval sigma_attack_tags="attack.defense_evasion attack.credential_access attack.t1218 attack.t1003.001" | eval sigma_title="Time Travel Debugging Utility Usage" | eval sigma_description="Detects usage of Time Travel Debugging Utility. Adversaries can execute malicious processes and dump processes, such as lsass.exe, via tttracer.exe."
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential Download/Upload Activity Using Type Command - winevent]
description = Detects usage of the 'type' command to download/upload data from WebDAV server
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((Process_Command_Line="*type *" Process_Command_Line="* > \\\\\*")) OR ((Process_Command_Line="*type \\\\\*" Process_Command_Line="* > *"))))) | eval sigma_attack_tags="attack.command_and_control attack.t1105" | eval sigma_title="Potential Download/Upload Activity Using Type Command" | eval sigma_description="Detects usage of the 'type' command to download/upload data from WebDAV server"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential Download/Upload Activity Using Type Command - sysmon]
description = Detects usage of the 'type' command to download/upload data from WebDAV server
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((CommandLine="*type *" CommandLine="* > \\\\\*")) OR ((CommandLine="*type \\\\\*" CommandLine="* > *"))))) | eval sigma_attack_tags="attack.command_and_control attack.t1105" | eval sigma_title="Potential Download/Upload Activity Using Type Command" | eval sigma_description="Detects usage of the 'type' command to download/upload data from WebDAV server"
dispatch.earliest_time = -24h@h
alert.track = 0

[Lolbin Unregmp2.exe Use As Proxy - winevent]
description = Detect usage of the 'unregmp2.exe' binary as a proxy to launch a custom version of 'wmpnscfg.exe'
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\unregmp2.exe" OR OriginalFileName="unregmp2.exe") Process_Command_Line="* /HideWMP*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1218" | eval sigma_title="Lolbin Unregmp2.exe Use As Proxy" | eval sigma_description="Detect usage of the 'unregmp2.exe' binary as a proxy to launch a custom version of 'wmpnscfg.exe'"
dispatch.earliest_time = -24h@h
alert.track = 0

[Lolbin Unregmp2.exe Use As Proxy - sysmon]
description = Detect usage of the 'unregmp2.exe' binary as a proxy to launch a custom version of 'wmpnscfg.exe'
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\unregmp2.exe" OR OriginalFileName="unregmp2.exe") CommandLine="* /HideWMP*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1218" | eval sigma_title="Lolbin Unregmp2.exe Use As Proxy" | eval sigma_description="Detect usage of the 'unregmp2.exe' binary as a proxy to launch a custom version of 'wmpnscfg.exe'"
dispatch.earliest_time = -24h@h
alert.track = 0

[UtilityFunctions.ps1 Proxy Dll - winevent]
description = Detects the use of a Microsoft signed script executing a managed DLL with PowerShell.
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (Process_Command_Line="*UtilityFunctions.ps1*" OR Process_Command_Line="*RegSnapin *"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1216" | eval sigma_title="UtilityFunctions.ps1 Proxy Dll" | eval sigma_description="Detects the use of a Microsoft signed script executing a managed DLL with PowerShell."
dispatch.earliest_time = -24h@h
alert.track = 0

[UtilityFunctions.ps1 Proxy Dll - sysmon]
description = Detects the use of a Microsoft signed script executing a managed DLL with PowerShell.
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (CommandLine="*UtilityFunctions.ps1*" OR CommandLine="*RegSnapin *"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1216" | eval sigma_title="UtilityFunctions.ps1 Proxy Dll" | eval sigma_description="Detects the use of a Microsoft signed script executing a managed DLL with PowerShell."
dispatch.earliest_time = -24h@h
alert.track = 0

[Visual Basic Command Line Compiler Usage - winevent]
description = Detects successful code compilation via Visual Basic Command Line Compiler that utilizes Windows Resource to Object Converter.
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Creator_Process_Name="*\\vbc.exe" New_Process_Name="*\\cvtres.exe")) | eval sigma_attack_tags="attack.defense_evasion attack.t1027.004" | eval sigma_title="Visual Basic Command Line Compiler Usage" | eval sigma_description="Detects successful code compilation via Visual Basic Command Line Compiler that utilizes Windows Resource to Object Converter."
dispatch.earliest_time = -24h@h
alert.track = 0

[Visual Basic Command Line Compiler Usage - sysmon]
description = Detects successful code compilation via Visual Basic Command Line Compiler that utilizes Windows Resource to Object Converter.
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") ParentImage="*\\vbc.exe" Image="*\\cvtres.exe")) | eval sigma_attack_tags="attack.defense_evasion attack.t1027.004" | eval sigma_title="Visual Basic Command Line Compiler Usage" | eval sigma_description="Detects successful code compilation via Visual Basic Command Line Compiler that utilizes Windows Resource to Object Converter."
dispatch.earliest_time = -24h@h
alert.track = 0

[Use of VisualUiaVerifyNative.exe - winevent]
description = VisualUiaVerifyNative.exe is a Windows SDK that can be used for AWL bypass and is listed in Microsoft's recommended block rules.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\VisualUiaVerifyNative.exe" OR OriginalFileName="VisualUiaVerifyNative.exe"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218" | eval sigma_title="Use of VisualUiaVerifyNative.exe" | eval sigma_description="VisualUiaVerifyNative.exe is a Windows SDK that can be used for AWL bypass and is listed in Microsoft's recommended block rules."
dispatch.earliest_time = -24h@h
alert.track = 0

[Use of VisualUiaVerifyNative.exe - sysmon]
description = VisualUiaVerifyNative.exe is a Windows SDK that can be used for AWL bypass and is listed in Microsoft's recommended block rules.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\VisualUiaVerifyNative.exe" OR OriginalFileName="VisualUiaVerifyNative.exe"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218" | eval sigma_title="Use of VisualUiaVerifyNative.exe" | eval sigma_description="VisualUiaVerifyNative.exe is a Windows SDK that can be used for AWL bypass and is listed in Microsoft's recommended block rules."
dispatch.earliest_time = -24h@h
alert.track = 0

[Use of VSIISExeLauncher.exe - winevent]
description = The 'VSIISExeLauncher.exe' binary part of the Visual Studio/VS Code can be used to execute arbitrary binaries
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\VSIISExeLauncher.exe" OR OriginalFileName="VSIISExeLauncher.exe") (Process_Command_Line="* -p *" OR Process_Command_Line="* -a *"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1127" | eval sigma_title="Use of VSIISExeLauncher.exe" | eval sigma_description="The 'VSIISExeLauncher.exe' binary part of the Visual Studio/VS Code can be used to execute arbitrary binaries"
dispatch.earliest_time = -24h@h
alert.track = 0

[Use of VSIISExeLauncher.exe - sysmon]
description = The 'VSIISExeLauncher.exe' binary part of the Visual Studio/VS Code can be used to execute arbitrary binaries
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\VSIISExeLauncher.exe" OR OriginalFileName="VSIISExeLauncher.exe") (CommandLine="* -p *" OR CommandLine="* -a *"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1127" | eval sigma_title="Use of VSIISExeLauncher.exe" | eval sigma_description="The 'VSIISExeLauncher.exe' binary part of the Visual Studio/VS Code can be used to execute arbitrary binaries"
dispatch.earliest_time = -24h@h
alert.track = 0

[Use of Wfc.exe - winevent]
description = The Workflow Command-line Compiler can be used for AWL bypass and is listed in Microsoft's recommended block rules.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\wfc.exe" OR OriginalFileName="wfc.exe"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1127" | eval sigma_title="Use of Wfc.exe" | eval sigma_description="The Workflow Command-line Compiler can be used for AWL bypass and is listed in Microsoft's recommended block rules."
dispatch.earliest_time = -24h@h
alert.track = 0

[Use of Wfc.exe - sysmon]
description = The Workflow Command-line Compiler can be used for AWL bypass and is listed in Microsoft's recommended block rules.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\wfc.exe" OR OriginalFileName="wfc.exe"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1127" | eval sigma_title="Use of Wfc.exe" | eval sigma_description="The Workflow Command-line Compiler can be used for AWL bypass and is listed in Microsoft's recommended block rules."
dispatch.earliest_time = -24h@h
alert.track = 0

[Winword LOLBIN Usage - winevent]
description = Detects Winword process loading custmom dlls via the '/l' switch.
Winword can be abused as a LOLBIN to download arbitrary file or load arbitrary DLLs.

search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\WINWORD.exe" OR OriginalFileName="WinWord.exe") (Process_Command_Line="*/l *" OR Process_Command_Line="*.dll*" OR Process_Command_Line="*http://*" OR Process_Command_Line="*https://*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1202" | eval sigma_title="Winword LOLBIN Usage" | eval sigma_description="Detects Winword process loading custmom dlls via the '/l' switch.
Winword can be abused as a LOLBIN to download arbitrary file or load arbitrary DLLs.
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Winword LOLBIN Usage - sysmon]
description = Detects Winword process loading custmom dlls via the '/l' switch.
Winword can be abused as a LOLBIN to download arbitrary file or load arbitrary DLLs.

search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\WINWORD.exe" OR OriginalFileName="WinWord.exe") (CommandLine="*/l *" OR CommandLine="*.dll*" OR CommandLine="*http://*" OR CommandLine="*https://*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1202" | eval sigma_title="Winword LOLBIN Usage" | eval sigma_description="Detects Winword process loading custmom dlls via the '/l' switch.
Winword can be abused as a LOLBIN to download arbitrary file or load arbitrary DLLs.
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Wlrmdr Lolbin Use as Launcher - winevent]
description = Detects use of Wlrmdr.exe in which the -u parameter is passed to ShellExecute
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (Creator_Process_Name="*\\wlrmdr.exe" OR (((((New_Process_Name="*\\wlrmdr.exe" OR OriginalFileName="WLRMNDR.EXE") ((Process_Command_Line="*-s *" Process_Command_Line="*-f *" Process_Command_Line="*-t *" Process_Command_Line="*-m *" Process_Command_Line="*-a *" Process_Command_Line="*-u *")))) NOT (((Creator_Process_Name="C:\\Windows\\System32\\winlogon.exe")) OR ((Creator_Process_Name="-")))))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218" | eval sigma_title="Wlrmdr Lolbin Use as Launcher" | eval sigma_description="Detects use of Wlrmdr.exe in which the -u parameter is passed to ShellExecute"
dispatch.earliest_time = -24h@h
alert.track = 0

[Wlrmdr Lolbin Use as Launcher - sysmon]
description = Detects use of Wlrmdr.exe in which the -u parameter is passed to ShellExecute
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (ParentImage="*\\wlrmdr.exe" OR (((((Image="*\\wlrmdr.exe" OR OriginalFileName="WLRMNDR.EXE") ((CommandLine="*-s *" CommandLine="*-f *" CommandLine="*-t *" CommandLine="*-m *" CommandLine="*-a *" CommandLine="*-u *")))) NOT (((ParentImage="C:\\Windows\\System32\\winlogon.exe")) OR ((ParentImage="-")))))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218" | eval sigma_title="Wlrmdr Lolbin Use as Launcher" | eval sigma_description="Detects use of Wlrmdr.exe in which the -u parameter is passed to ShellExecute"
dispatch.earliest_time = -24h@h
alert.track = 0

[New Lolbin Process by Office Applications - winevent]
description = This rule will monitor any office apps that spins up a new LOLBin process. This activity is pretty suspicious and should be investigated.
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (New_Process_Name="*\\regsvr32.exe" OR New_Process_Name="*\\rundll32.exe" OR New_Process_Name="*\\msiexec.exe" OR New_Process_Name="*\\mshta.exe" OR New_Process_Name="*\\verclsid.exe" OR New_Process_Name="*\\msdt.exe" OR New_Process_Name="*\\control.exe" OR New_Process_Name="*\\msidb.exe") (Creator_Process_Name="*\\winword.exe" OR Creator_Process_Name="*\\excel.exe" OR Creator_Process_Name="*\\powerpnt.exe" OR Creator_Process_Name="*\\msaccess.exe" OR Creator_Process_Name="*\\mspub.exe" OR Creator_Process_Name="*\\eqnedt32.exe" OR Creator_Process_Name="*\\visio.exe" OR Creator_Process_Name="*\\wordpad.exe" OR Creator_Process_Name="*\\wordview.exe"))) | eval sigma_attack_tags="attack.t1204.002 attack.t1047 attack.t1218.010 attack.execution attack.defense_evasion" | eval sigma_title="New Lolbin Process by Office Applications" | eval sigma_description="This rule will monitor any office apps that spins up a new LOLBin process. This activity is pretty suspicious and should be investigated."
dispatch.earliest_time = -24h@h
alert.track = 0

[New Lolbin Process by Office Applications - sysmon]
description = This rule will monitor any office apps that spins up a new LOLBin process. This activity is pretty suspicious and should be investigated.
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (Image="*\\regsvr32.exe" OR Image="*\\rundll32.exe" OR Image="*\\msiexec.exe" OR Image="*\\mshta.exe" OR Image="*\\verclsid.exe" OR Image="*\\msdt.exe" OR Image="*\\control.exe" OR Image="*\\msidb.exe") (ParentImage="*\\winword.exe" OR ParentImage="*\\excel.exe" OR ParentImage="*\\powerpnt.exe" OR ParentImage="*\\msaccess.exe" OR ParentImage="*\\mspub.exe" OR ParentImage="*\\eqnedt32.exe" OR ParentImage="*\\visio.exe" OR ParentImage="*\\wordpad.exe" OR ParentImage="*\\wordview.exe"))) | eval sigma_attack_tags="attack.t1204.002 attack.t1047 attack.t1218.010 attack.execution attack.defense_evasion" | eval sigma_title="New Lolbin Process by Office Applications" | eval sigma_description="This rule will monitor any office apps that spins up a new LOLBin process. This activity is pretty suspicious and should be investigated."
dispatch.earliest_time = -24h@h
alert.track = 0

[Disabled RestrictedAdminMode For RDS - ProcCreation - winevent]
description = Detect activation of DisableRestrictedAdmin to desable RestrictedAdmin mode.
RestrictedAdmin mode prevents the transmission of reusable credentials to the remote system to which you connect using Remote Desktop.
This prevents your credentials from being harvested during the initial connection process if the remote server has been compromise

search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*\\System\\CurrentControlSet\\Control\\Lsa\\*" Process_Command_Line="*DisableRestrictedAdmin*" Process_Command_Line="* 1*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1112" | eval sigma_title="Disabled RestrictedAdminMode For RDS - ProcCreation" | eval sigma_description="Detect activation of DisableRestrictedAdmin to desable RestrictedAdmin mode.
RestrictedAdmin mode prevents the transmission of reusable credentials to the remote system to which you connect using Remote Desktop.
This prevents your credentials from being harvested during the initial connection process if the remote server has been compromise
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Disabled RestrictedAdminMode For RDS - ProcCreation - sysmon]
description = Detect activation of DisableRestrictedAdmin to desable RestrictedAdmin mode.
RestrictedAdmin mode prevents the transmission of reusable credentials to the remote system to which you connect using Remote Desktop.
This prevents your credentials from being harvested during the initial connection process if the remote server has been compromise

search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*\\System\\CurrentControlSet\\Control\\Lsa\\*" CommandLine="*DisableRestrictedAdmin*" CommandLine="* 1*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1112" | eval sigma_title="Disabled RestrictedAdminMode For RDS - ProcCreation" | eval sigma_description="Detect activation of DisableRestrictedAdmin to desable RestrictedAdmin mode.
RestrictedAdmin mode prevents the transmission of reusable credentials to the remote system to which you connect using Remote Desktop.
This prevents your credentials from being harvested during the initial connection process if the remote server has been compromise
"
dispatch.earliest_time = -24h@h
alert.track = 0

[LSASS Memory Dumping - winevent]
description = Detect creation of dump files containing the memory space of lsass.exe, which contains sensitive credentials.
Identifies usage of Sysinternals procdump.exe to export the memory space of lsass.exe which contains sensitive credentials.

search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((((Process_Command_Line="*lsass*" Process_Command_Line="*.dmp*")) NOT ((New_Process_Name="*\\werfault.exe")))) OR ((New_Process_Name="*\\procdump*" New_Process_Name="*.exe" Process_Command_Line="*lsass*"))))) | table ComputerName,Account_Name,Process_Command_Line | eval sigma_attack_tags="attack.credential_access attack.t1003.001" | eval sigma_title="LSASS Memory Dumping" | eval sigma_description="Detect creation of dump files containing the memory space of lsass.exe, which contains sensitive credentials.
Identifies usage of Sysinternals procdump.exe to export the memory space of lsass.exe which contains sensitive credentials.
"
dispatch.earliest_time = -24h@h
alert.track = 0

[LSASS Memory Dumping - sysmon]
description = Detect creation of dump files containing the memory space of lsass.exe, which contains sensitive credentials.
Identifies usage of Sysinternals procdump.exe to export the memory space of lsass.exe which contains sensitive credentials.

search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((((CommandLine="*lsass*" CommandLine="*.dmp*")) NOT ((Image="*\\werfault.exe")))) OR ((Image="*\\procdump*" Image="*.exe" CommandLine="*lsass*"))))) | table ComputerName,User,CommandLine | eval sigma_attack_tags="attack.credential_access attack.t1003.001" | eval sigma_title="LSASS Memory Dumping" | eval sigma_description="Detect creation of dump files containing the memory space of lsass.exe, which contains sensitive credentials.
Identifies usage of Sysinternals procdump.exe to export the memory space of lsass.exe which contains sensitive credentials.
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential Credential Dumping Via WER - winevent]
description = Detects potential credential dumping via Windows Error Reporting LSASS Shtinkering technique which uses the Windows Error Reporting to dump lsass
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((New_Process_Name="*\\Werfault.exe" OR OriginalFileName="WerFault.exe") (((ParentUser="*AUTHORI*" OR ParentUser="*AUTORI*") (Account_Name="*AUTHORI*" OR Account_Name="*AUTORI*") Process_Command_Line="* -u -p *" Process_Command_Line="* -ip *" Process_Command_Line="* -s *")))) NOT (((Creator_Process_Name="C:\\Windows\\System32\\lsass.exe"))))) | eval sigma_attack_tags="attack.credential_access attack.t1003.001" | eval sigma_title="Potential Credential Dumping Via WER" | eval sigma_description="Detects potential credential dumping via Windows Error Reporting LSASS Shtinkering technique which uses the Windows Error Reporting to dump lsass"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential Credential Dumping Via WER - sysmon]
description = Detects potential credential dumping via Windows Error Reporting LSASS Shtinkering technique which uses the Windows Error Reporting to dump lsass
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((Image="*\\Werfault.exe" OR OriginalFileName="WerFault.exe") (((ParentUser="*AUTHORI*" OR ParentUser="*AUTORI*") (User="*AUTHORI*" OR User="*AUTORI*") CommandLine="* -u -p *" CommandLine="* -ip *" CommandLine="* -s *")))) NOT (((ParentImage="C:\\Windows\\System32\\lsass.exe"))))) | eval sigma_attack_tags="attack.credential_access attack.t1003.001" | eval sigma_title="Potential Credential Dumping Via WER" | eval sigma_description="Detects potential credential dumping via Windows Error Reporting LSASS Shtinkering technique which uses the Windows Error Reporting to dump lsass"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious PowerShell Mailbox Export to Share - winevent]
description = Detects usage of the powerShell New-MailboxExportRequest Cmdlet to exports a mailbox to a remote or local share, as used in ProxyShell exploitations
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*New-MailboxExportRequest*" Process_Command_Line="* -Mailbox *" Process_Command_Line="* -FilePath \\\\\*")) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.exfiltration" | eval sigma_title="Suspicious PowerShell Mailbox Export to Share" | eval sigma_description="Detects usage of the powerShell New-MailboxExportRequest Cmdlet to exports a mailbox to a remote or local share, as used in ProxyShell exploitations"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious PowerShell Mailbox Export to Share - sysmon]
description = Detects usage of the powerShell New-MailboxExportRequest Cmdlet to exports a mailbox to a remote or local share, as used in ProxyShell exploitations
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*New-MailboxExportRequest*" CommandLine="* -Mailbox *" CommandLine="* -FilePath \\\\\*")) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.exfiltration" | eval sigma_title="Suspicious PowerShell Mailbox Export to Share" | eval sigma_description="Detects usage of the powerShell New-MailboxExportRequest Cmdlet to exports a mailbox to a remote or local share, as used in ProxyShell exploitations"
dispatch.earliest_time = -24h@h
alert.track = 0

[Adwind RAT / JRAT - winevent]
description = Detects javaw.exe in AppData folder as used by Adwind / JRAT
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((Process_Command_Line="*\\AppData\\Roaming\\Oracle*" Process_Command_Line="*\\java*" Process_Command_Line="*.exe *")) OR ((Process_Command_Line="*cscript.exe*" Process_Command_Line="*Retrive*" Process_Command_Line="*.vbs *"))))) | eval sigma_attack_tags="attack.execution attack.t1059.005 attack.t1059.007" | eval sigma_title="Adwind RAT / JRAT" | eval sigma_description="Detects javaw.exe in AppData folder as used by Adwind / JRAT"
dispatch.earliest_time = -24h@h
alert.track = 0

[Adwind RAT / JRAT - sysmon]
description = Detects javaw.exe in AppData folder as used by Adwind / JRAT
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((CommandLine="*\\AppData\\Roaming\\Oracle*" CommandLine="*\\java*" CommandLine="*.exe *")) OR ((CommandLine="*cscript.exe*" CommandLine="*Retrive*" CommandLine="*.vbs *"))))) | eval sigma_attack_tags="attack.execution attack.t1059.005 attack.t1059.007" | eval sigma_title="Adwind RAT / JRAT" | eval sigma_description="Detects javaw.exe in AppData folder as used by Adwind / JRAT"
dispatch.earliest_time = -24h@h
alert.track = 0

[Blue Mockingbird - winevent]
description = Attempts to detect system changes made by Blue Mockingbird
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((New_Process_Name="*\\cmd.exe" Process_Command_Line="*sc config*" Process_Command_Line="*wercplsupporte.dll*")) OR ((New_Process_Name="*\\wmic.exe" Process_Command_Line="*COR_PROFILER"))))) | eval sigma_attack_tags="attack.execution attack.t1112 attack.t1047" | eval sigma_title="Blue Mockingbird" | eval sigma_description="Attempts to detect system changes made by Blue Mockingbird"
dispatch.earliest_time = -24h@h
alert.track = 0

[Blue Mockingbird - sysmon]
description = Attempts to detect system changes made by Blue Mockingbird
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((Image="*\\cmd.exe" CommandLine="*sc config*" CommandLine="*wercplsupporte.dll*")) OR ((Image="*\\wmic.exe" CommandLine="*COR_PROFILER"))))) | eval sigma_attack_tags="attack.execution attack.t1112 attack.t1047" | eval sigma_title="Blue Mockingbird" | eval sigma_description="Attempts to detect system changes made by Blue Mockingbird"
dispatch.earliest_time = -24h@h
alert.track = 0

[DarkSide Ransomware Pattern - winevent]
description = Detects DarkSide Ransomware and helpers
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((Process_Command_Line="*=[char][byte]('0x'+*" OR Process_Command_Line="* -work worker0 -path *") OR ((ParentCommandLine="*DllHost.exe /Processid:{3E5FC7F9-9A51-4367-9063-A120244FBEC7}*" New_Process_Name="*\\AppData\\Local\\Temp\\*"))))) | eval sigma_attack_tags="attack.execution attack.t1204" | eval sigma_title="DarkSide Ransomware Pattern" | eval sigma_description="Detects DarkSide Ransomware and helpers"
dispatch.earliest_time = -24h@h
alert.track = 0

[DarkSide Ransomware Pattern - sysmon]
description = Detects DarkSide Ransomware and helpers
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((CommandLine="*=[char][byte]('0x'+*" OR CommandLine="* -work worker0 -path *") OR ((ParentCommandLine="*DllHost.exe /Processid:{3E5FC7F9-9A51-4367-9063-A120244FBEC7}*" Image="*\\AppData\\Local\\Temp\\*"))))) | eval sigma_attack_tags="attack.execution attack.t1204" | eval sigma_title="DarkSide Ransomware Pattern" | eval sigma_description="Detects DarkSide Ransomware and helpers"
dispatch.earliest_time = -24h@h
alert.track = 0

[Hermetic Wiper TG Process Patterns - winevent]
description = Detects process execution patterns found in intrusions related to the Hermetic Wiper malware attacks against Ukraine in February 2022
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\policydefinitions\\postgresql.exe" OR (Process_Command_Line="*CSIDL_SYSTEM_DRIVE\\temp\\sys.tmp*" OR Process_Command_Line="* 1> \\\\127.0.0.1\\ADMIN$\\__16*") OR ((Process_Command_Line="*powershell -c *" Process_Command_Line="*\\comsvcs.dll MiniDump *" Process_Command_Line="*\\winupd.log full*"))))) | eval sigma_attack_tags="attack.execution attack.lateral_movement attack.t1021.001" | eval sigma_title="Hermetic Wiper TG Process Patterns" | eval sigma_description="Detects process execution patterns found in intrusions related to the Hermetic Wiper malware attacks against Ukraine in February 2022"
dispatch.earliest_time = -24h@h
alert.track = 0

[Hermetic Wiper TG Process Patterns - sysmon]
description = Detects process execution patterns found in intrusions related to the Hermetic Wiper malware attacks against Ukraine in February 2022
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\policydefinitions\\postgresql.exe" OR (CommandLine="*CSIDL_SYSTEM_DRIVE\\temp\\sys.tmp*" OR CommandLine="* 1> \\\\127.0.0.1\\ADMIN$\\__16*") OR ((CommandLine="*powershell -c *" CommandLine="*\\comsvcs.dll MiniDump *" CommandLine="*\\winupd.log full*"))))) | eval sigma_attack_tags="attack.execution attack.lateral_movement attack.t1021.001" | eval sigma_title="Hermetic Wiper TG Process Patterns" | eval sigma_description="Detects process execution patterns found in intrusions related to the Hermetic Wiper malware attacks against Ukraine in February 2022"
dispatch.earliest_time = -24h@h
alert.track = 0

[LockerGoga Ransomware - winevent]
description = Detects LockerGoga Ransomware command line.
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*-i SM-tgytutrc -s*")) | eval sigma_attack_tags="attack.impact attack.t1486" | eval sigma_title="LockerGoga Ransomware" | eval sigma_description="Detects LockerGoga Ransomware command line."
dispatch.earliest_time = -24h@h
alert.track = 0

[LockerGoga Ransomware - sysmon]
description = Detects LockerGoga Ransomware command line.
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*-i SM-tgytutrc -s*")) | eval sigma_attack_tags="attack.impact attack.t1486" | eval sigma_title="LockerGoga Ransomware" | eval sigma_description="Detects LockerGoga Ransomware command line."
dispatch.earliest_time = -24h@h
alert.track = 0

[Ryuk Ransomware Command Line Activity - winevent]
description = Detects Ryuk Ransomware command lines
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (New_Process_Name="*\\net.exe" OR New_Process_Name="*\\net1.exe") Process_Command_Line="*stop*" (Process_Command_Line="*samss*" OR Process_Command_Line="*audioendpointbuilder*" OR Process_Command_Line="*unistoresvc_*"))) | eval sigma_attack_tags="attack.execution attack.t1204" | eval sigma_title="Ryuk Ransomware Command Line Activity" | eval sigma_description="Detects Ryuk Ransomware command lines"
dispatch.earliest_time = -24h@h
alert.track = 0

[Ryuk Ransomware Command Line Activity - sysmon]
description = Detects Ryuk Ransomware command lines
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (Image="*\\net.exe" OR Image="*\\net1.exe") CommandLine="*stop*" (CommandLine="*samss*" OR CommandLine="*audioendpointbuilder*" OR CommandLine="*unistoresvc_*"))) | eval sigma_attack_tags="attack.execution attack.t1204" | eval sigma_title="Ryuk Ransomware Command Line Activity" | eval sigma_description="Detects Ryuk Ransomware command lines"
dispatch.earliest_time = -24h@h
alert.track = 0

[Malicious PowerShell Commandlets - ProcessCreation - winevent]
description = Detects Commandlet names from well-known PowerShell exploitation frameworks
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (Process_Command_Line="*Add-Exfiltration*" OR Process_Command_Line="*Add-Persistence*" OR Process_Command_Line="*Add-RegBackdoor*" OR Process_Command_Line="*Add-RemoteRegBackdoor*" OR Process_Command_Line="*Add-ScrnSaveBackdoor*" OR Process_Command_Line="*Check-VM*" OR Process_Command_Line="*ConvertTo-Rc4ByteStream*" OR Process_Command_Line="*Decrypt-Hash*" OR Process_Command_Line="*Do-Exfiltration*" OR Process_Command_Line="*Enabled-DuplicateToken*" OR Process_Command_Line="*Exploit-Jboss*" OR Process_Command_Line="*Find-Fruit*" OR Process_Command_Line="*Find-GPOLocation*" OR Process_Command_Line="*Find-TrustedDocuments*" OR Process_Command_Line="*Get-ApplicationHost*" OR Process_Command_Line="*Get-ChromeDump*" OR Process_Command_Line="*Get-ClipboardContents*" OR Process_Command_Line="*Get-FoxDump*" OR Process_Command_Line="*Get-GPPPassword*" OR Process_Command_Line="*Get-IndexedItem*" OR Process_Command_Line="*Get-Keystrokes*" OR Process_Command_Line="*Get-LSASecret*" OR Process_Command_Line="*Get-PassHashes*" OR Process_Command_Line="*Get-RegAlwaysInstallElevated*" OR Process_Command_Line="*Get-RegAutoLogon*" OR Process_Command_Line="*Get-RemoteBootKey*" OR Process_Command_Line="*Get-RemoteCachedCredential*" OR Process_Command_Line="*Get-RemoteLocalAccountHash*" OR Process_Command_Line="*Get-RemoteLSAKey*" OR Process_Command_Line="*Get-RemoteMachineAccountHash*" OR Process_Command_Line="*Get-RemoteNLKMKey*" OR Process_Command_Line="*Get-RickAstley*" OR Process_Command_Line="*Get-Screenshot*" OR Process_Command_Line="*Get-SecurityPackages*" OR Process_Command_Line="*Get-ServiceFilePermission*" OR Process_Command_Line="*Get-ServicePermission*" OR Process_Command_Line="*Get-ServiceUnquoted*" OR Process_Command_Line="*Get-SiteListPassword*" OR Process_Command_Line="*Get-System*" OR Process_Command_Line="*Get-TimedScreenshot*" OR Process_Command_Line="*Get-UnattendedInstallFile*" OR Process_Command_Line="*Get-Unconstrained*" OR Process_Command_Line="*Get-USBKeystrokes*" OR Process_Command_Line="*Get-VaultCredential*" OR Process_Command_Line="*Get-VulnAutoRun*" OR Process_Command_Line="*Get-VulnSchTask*" OR Process_Command_Line="*Gupt-Backdoor*" OR Process_Command_Line="*HTTP-Login*" OR Process_Command_Line="*Install-ServiceBinary*" OR Process_Command_Line="*Install-SSP*" OR Process_Command_Line="*Invoke-ACLScanner*" OR Process_Command_Line="*Invoke-ADSBackdoor*" OR Process_Command_Line="*Invoke-AllChecks*" OR Process_Command_Line="*Invoke-ARPScan*" OR Process_Command_Line="*Invoke-AzureHound*" OR Process_Command_Line="*Invoke-BackdoorLNK*" OR Process_Command_Line="*Invoke-BadPotato*" OR Process_Command_Line="*Invoke-BetterSafetyKatz*" OR Process_Command_Line="*Invoke-BypassUAC*" OR Process_Command_Line="*Invoke-Carbuncle*" OR Process_Command_Line="*Invoke-Certify*" OR Process_Command_Line="*Invoke-ConPtyShell*" OR Process_Command_Line="*Invoke-CredentialInjection*" OR Process_Command_Line="*Invoke-DAFT*" OR Process_Command_Line="*Invoke-DCSync*" OR Process_Command_Line="*Invoke-DinvokeKatz*" OR Process_Command_Line="*Invoke-DllInjection*" OR Process_Command_Line="*Invoke-DomainPasswordSpray*" OR Process_Command_Line="*Invoke-DowngradeAccount*" OR Process_Command_Line="*Invoke-EgressCheck*" OR Process_Command_Line="*Invoke-Eyewitness*" OR Process_Command_Line="*Invoke-FakeLogonScreen*" OR Process_Command_Line="*Invoke-Farmer*" OR Process_Command_Line="*Invoke-Get-RBCD-Threaded*" OR Process_Command_Line="*Invoke-Gopher*" OR Process_Command_Line="*Invoke-Grouper*" OR Process_Command_Line="*Invoke-HandleKatz*" OR Process_Command_Line="*Invoke-ImpersonatedProcess*" OR Process_Command_Line="*Invoke-ImpersonateSystem*" OR Process_Command_Line="*Invoke-InteractiveSystemPowerShell*" OR Process_Command_Line="*Invoke-Internalmonologue*" OR Process_Command_Line="*Invoke-Inveigh*" OR Process_Command_Line="*Invoke-InveighRelay*" OR Process_Command_Line="*Invoke-KrbRelay*" OR Process_Command_Line="*Invoke-LdapSignCheck*" OR Process_Command_Line="*Invoke-Lockless*" OR Process_Command_Line="*Invoke-MalSCCM*" OR Process_Command_Line="*Invoke-Mimikatz*" OR Process_Command_Line="*Invoke-Mimikittenz*" OR Process_Command_Line="*Invoke-MITM6*" OR Process_Command_Line="*Invoke-NanoDump*" OR Process_Command_Line="*Invoke-NetRipper*" OR Process_Command_Line="*Invoke-Nightmare*" OR Process_Command_Line="*Invoke-NinjaCopy*" OR Process_Command_Line="*Invoke-OfficeScrape*" OR Process_Command_Line="*Invoke-OxidResolver*" OR Process_Command_Line="*Invoke-P0wnedshell*" OR Process_Command_Line="*Invoke-Paranoia*" OR Process_Command_Line="*Invoke-PortScan*" OR Process_Command_Line="*Invoke-PoshRatHttp*" OR Process_Command_Line="*Invoke-PostExfil*" OR Process_Command_Line="*Invoke-PowerDump*" OR Process_Command_Line="*Invoke-PowerShellTCP*" OR Process_Command_Line="*Invoke-PowerShellWMI*" OR Process_Command_Line="*Invoke-PPLDump*" OR Process_Command_Line="*Invoke-PsExec*" OR Process_Command_Line="*Invoke-PSInject*" OR Process_Command_Line="*Invoke-PsUaCme*" OR Process_Command_Line="*Invoke-ReflectivePEInjection*" OR Process_Command_Line="*Invoke-ReverseDNSLookup*" OR Process_Command_Line="*Invoke-Rubeus*" OR Process_Command_Line="*Invoke-RunAs*" OR Process_Command_Line="*Invoke-SafetyKatz*" OR Process_Command_Line="*Invoke-SauronEye*" OR Process_Command_Line="*Invoke-SCShell*" OR Process_Command_Line="*Invoke-Seatbelt*" OR Process_Command_Line="*Invoke-ServiceAbuse*" OR Process_Command_Line="*Invoke-ShadowSpray*" OR Process_Command_Line="*Invoke-Sharp*" OR Process_Command_Line="*Invoke-Shellcode*" OR Process_Command_Line="*Invoke-SMBScanner*" OR Process_Command_Line="*Invoke-Snaffler*" OR Process_Command_Line="*Invoke-Spoolsample*" OR Process_Command_Line="*Invoke-SpraySinglePassword*" OR Process_Command_Line="*Invoke-SSHCommand*" OR Process_Command_Line="*Invoke-StandIn*" OR Process_Command_Line="*Invoke-StickyNotesExtract*" OR Process_Command_Line="*Invoke-SystemCommand*" OR Process_Command_Line="*Invoke-Tasksbackdoor*" OR Process_Command_Line="*Invoke-Tater*" OR Process_Command_Line="*Invoke-Thunderfox*" OR Process_Command_Line="*Invoke-ThunderStruck*" OR Process_Command_Line="*Invoke-TokenManipulation*" OR Process_Command_Line="*Invoke-Tokenvator*" OR Process_Command_Line="*Invoke-TotalExec*" OR Process_Command_Line="*Invoke-UrbanBishop*" OR Process_Command_Line="*Invoke-UserHunter*" OR Process_Command_Line="*Invoke-VoiceTroll*" OR Process_Command_Line="*Invoke-Whisker*" OR Process_Command_Line="*Invoke-WinEnum*" OR Process_Command_Line="*Invoke-winPEAS*" OR Process_Command_Line="*Invoke-WireTap*" OR Process_Command_Line="*Invoke-WmiCommand*" OR Process_Command_Line="*Invoke-WScriptBypassUAC*" OR Process_Command_Line="*Invoke-Zerologon*" OR Process_Command_Line="*MailRaider*" OR Process_Command_Line="*New-HoneyHash*" OR Process_Command_Line="*New-InMemoryModule*" OR Process_Command_Line="*Out-Minidump*" OR Process_Command_Line="*Port-Scan*" OR Process_Command_Line="*PowerBreach*" OR Process_Command_Line="*powercat *" OR Process_Command_Line="*PowerUp*" OR Process_Command_Line="*PowerView*" OR Process_Command_Line="*Remove-Update*" OR Process_Command_Line="*Set-MacAttribute*" OR Process_Command_Line="*Set-Wallpaper*" OR Process_Command_Line="*Show-TargetScreen*" OR Process_Command_Line="*Start-CaptureServer*" OR Process_Command_Line="*Start-WebcamRecorder*" OR Process_Command_Line="*VolumeShadowCopyTools*"))) | eval sigma_attack_tags="attack.execution attack.discovery attack.t1482 attack.t1087 attack.t1087.001 attack.t1087.002 attack.t1069.001 attack.t1069.002 attack.t1069 attack.t1059.001" | eval sigma_title="Malicious PowerShell Commandlets - ProcessCreation" | eval sigma_description="Detects Commandlet names from well-known PowerShell exploitation frameworks"
dispatch.earliest_time = -24h@h
alert.track = 0

[Malicious PowerShell Commandlets - ProcessCreation - sysmon]
description = Detects Commandlet names from well-known PowerShell exploitation frameworks
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (CommandLine="*Add-Exfiltration*" OR CommandLine="*Add-Persistence*" OR CommandLine="*Add-RegBackdoor*" OR CommandLine="*Add-RemoteRegBackdoor*" OR CommandLine="*Add-ScrnSaveBackdoor*" OR CommandLine="*Check-VM*" OR CommandLine="*ConvertTo-Rc4ByteStream*" OR CommandLine="*Decrypt-Hash*" OR CommandLine="*Do-Exfiltration*" OR CommandLine="*Enabled-DuplicateToken*" OR CommandLine="*Exploit-Jboss*" OR CommandLine="*Find-Fruit*" OR CommandLine="*Find-GPOLocation*" OR CommandLine="*Find-TrustedDocuments*" OR CommandLine="*Get-ApplicationHost*" OR CommandLine="*Get-ChromeDump*" OR CommandLine="*Get-ClipboardContents*" OR CommandLine="*Get-FoxDump*" OR CommandLine="*Get-GPPPassword*" OR CommandLine="*Get-IndexedItem*" OR CommandLine="*Get-Keystrokes*" OR CommandLine="*Get-LSASecret*" OR CommandLine="*Get-PassHashes*" OR CommandLine="*Get-RegAlwaysInstallElevated*" OR CommandLine="*Get-RegAutoLogon*" OR CommandLine="*Get-RemoteBootKey*" OR CommandLine="*Get-RemoteCachedCredential*" OR CommandLine="*Get-RemoteLocalAccountHash*" OR CommandLine="*Get-RemoteLSAKey*" OR CommandLine="*Get-RemoteMachineAccountHash*" OR CommandLine="*Get-RemoteNLKMKey*" OR CommandLine="*Get-RickAstley*" OR CommandLine="*Get-Screenshot*" OR CommandLine="*Get-SecurityPackages*" OR CommandLine="*Get-ServiceFilePermission*" OR CommandLine="*Get-ServicePermission*" OR CommandLine="*Get-ServiceUnquoted*" OR CommandLine="*Get-SiteListPassword*" OR CommandLine="*Get-System*" OR CommandLine="*Get-TimedScreenshot*" OR CommandLine="*Get-UnattendedInstallFile*" OR CommandLine="*Get-Unconstrained*" OR CommandLine="*Get-USBKeystrokes*" OR CommandLine="*Get-VaultCredential*" OR CommandLine="*Get-VulnAutoRun*" OR CommandLine="*Get-VulnSchTask*" OR CommandLine="*Gupt-Backdoor*" OR CommandLine="*HTTP-Login*" OR CommandLine="*Install-ServiceBinary*" OR CommandLine="*Install-SSP*" OR CommandLine="*Invoke-ACLScanner*" OR CommandLine="*Invoke-ADSBackdoor*" OR CommandLine="*Invoke-AllChecks*" OR CommandLine="*Invoke-ARPScan*" OR CommandLine="*Invoke-AzureHound*" OR CommandLine="*Invoke-BackdoorLNK*" OR CommandLine="*Invoke-BadPotato*" OR CommandLine="*Invoke-BetterSafetyKatz*" OR CommandLine="*Invoke-BypassUAC*" OR CommandLine="*Invoke-Carbuncle*" OR CommandLine="*Invoke-Certify*" OR CommandLine="*Invoke-ConPtyShell*" OR CommandLine="*Invoke-CredentialInjection*" OR CommandLine="*Invoke-DAFT*" OR CommandLine="*Invoke-DCSync*" OR CommandLine="*Invoke-DinvokeKatz*" OR CommandLine="*Invoke-DllInjection*" OR CommandLine="*Invoke-DomainPasswordSpray*" OR CommandLine="*Invoke-DowngradeAccount*" OR CommandLine="*Invoke-EgressCheck*" OR CommandLine="*Invoke-Eyewitness*" OR CommandLine="*Invoke-FakeLogonScreen*" OR CommandLine="*Invoke-Farmer*" OR CommandLine="*Invoke-Get-RBCD-Threaded*" OR CommandLine="*Invoke-Gopher*" OR CommandLine="*Invoke-Grouper*" OR CommandLine="*Invoke-HandleKatz*" OR CommandLine="*Invoke-ImpersonatedProcess*" OR CommandLine="*Invoke-ImpersonateSystem*" OR CommandLine="*Invoke-InteractiveSystemPowerShell*" OR CommandLine="*Invoke-Internalmonologue*" OR CommandLine="*Invoke-Inveigh*" OR CommandLine="*Invoke-InveighRelay*" OR CommandLine="*Invoke-KrbRelay*" OR CommandLine="*Invoke-LdapSignCheck*" OR CommandLine="*Invoke-Lockless*" OR CommandLine="*Invoke-MalSCCM*" OR CommandLine="*Invoke-Mimikatz*" OR CommandLine="*Invoke-Mimikittenz*" OR CommandLine="*Invoke-MITM6*" OR CommandLine="*Invoke-NanoDump*" OR CommandLine="*Invoke-NetRipper*" OR CommandLine="*Invoke-Nightmare*" OR CommandLine="*Invoke-NinjaCopy*" OR CommandLine="*Invoke-OfficeScrape*" OR CommandLine="*Invoke-OxidResolver*" OR CommandLine="*Invoke-P0wnedshell*" OR CommandLine="*Invoke-Paranoia*" OR CommandLine="*Invoke-PortScan*" OR CommandLine="*Invoke-PoshRatHttp*" OR CommandLine="*Invoke-PostExfil*" OR CommandLine="*Invoke-PowerDump*" OR CommandLine="*Invoke-PowerShellTCP*" OR CommandLine="*Invoke-PowerShellWMI*" OR CommandLine="*Invoke-PPLDump*" OR CommandLine="*Invoke-PsExec*" OR CommandLine="*Invoke-PSInject*" OR CommandLine="*Invoke-PsUaCme*" OR CommandLine="*Invoke-ReflectivePEInjection*" OR CommandLine="*Invoke-ReverseDNSLookup*" OR CommandLine="*Invoke-Rubeus*" OR CommandLine="*Invoke-RunAs*" OR CommandLine="*Invoke-SafetyKatz*" OR CommandLine="*Invoke-SauronEye*" OR CommandLine="*Invoke-SCShell*" OR CommandLine="*Invoke-Seatbelt*" OR CommandLine="*Invoke-ServiceAbuse*" OR CommandLine="*Invoke-ShadowSpray*" OR CommandLine="*Invoke-Sharp*" OR CommandLine="*Invoke-Shellcode*" OR CommandLine="*Invoke-SMBScanner*" OR CommandLine="*Invoke-Snaffler*" OR CommandLine="*Invoke-Spoolsample*" OR CommandLine="*Invoke-SpraySinglePassword*" OR CommandLine="*Invoke-SSHCommand*" OR CommandLine="*Invoke-StandIn*" OR CommandLine="*Invoke-StickyNotesExtract*" OR CommandLine="*Invoke-SystemCommand*" OR CommandLine="*Invoke-Tasksbackdoor*" OR CommandLine="*Invoke-Tater*" OR CommandLine="*Invoke-Thunderfox*" OR CommandLine="*Invoke-ThunderStruck*" OR CommandLine="*Invoke-TokenManipulation*" OR CommandLine="*Invoke-Tokenvator*" OR CommandLine="*Invoke-TotalExec*" OR CommandLine="*Invoke-UrbanBishop*" OR CommandLine="*Invoke-UserHunter*" OR CommandLine="*Invoke-VoiceTroll*" OR CommandLine="*Invoke-Whisker*" OR CommandLine="*Invoke-WinEnum*" OR CommandLine="*Invoke-winPEAS*" OR CommandLine="*Invoke-WireTap*" OR CommandLine="*Invoke-WmiCommand*" OR CommandLine="*Invoke-WScriptBypassUAC*" OR CommandLine="*Invoke-Zerologon*" OR CommandLine="*MailRaider*" OR CommandLine="*New-HoneyHash*" OR CommandLine="*New-InMemoryModule*" OR CommandLine="*Out-Minidump*" OR CommandLine="*Port-Scan*" OR CommandLine="*PowerBreach*" OR CommandLine="*powercat *" OR CommandLine="*PowerUp*" OR CommandLine="*PowerView*" OR CommandLine="*Remove-Update*" OR CommandLine="*Set-MacAttribute*" OR CommandLine="*Set-Wallpaper*" OR CommandLine="*Show-TargetScreen*" OR CommandLine="*Start-CaptureServer*" OR CommandLine="*Start-WebcamRecorder*" OR CommandLine="*VolumeShadowCopyTools*"))) | eval sigma_attack_tags="attack.execution attack.discovery attack.t1482 attack.t1087 attack.t1087.001 attack.t1087.002 attack.t1069.001 attack.t1069.002 attack.t1069 attack.t1059.001" | eval sigma_title="Malicious PowerShell Commandlets - ProcessCreation" | eval sigma_description="Detects Commandlet names from well-known PowerShell exploitation frameworks"
dispatch.earliest_time = -24h@h
alert.track = 0

[Conti NTDS Exfiltration Command - winevent]
description = Detects a command used by conti to exfiltrate NTDS
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*7za.exe*" Process_Command_Line="*\\C$\\temp\\log.zip*")) | eval sigma_attack_tags="attack.collection attack.t1560" | eval sigma_title="Conti NTDS Exfiltration Command" | eval sigma_description="Detects a command used by conti to exfiltrate NTDS"
dispatch.earliest_time = -24h@h
alert.track = 0

[Conti NTDS Exfiltration Command - sysmon]
description = Detects a command used by conti to exfiltrate NTDS
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*7za.exe*" CommandLine="*\\C$\\temp\\log.zip*")) | eval sigma_attack_tags="attack.collection attack.t1560" | eval sigma_title="Conti NTDS Exfiltration Command" | eval sigma_description="Detects a command used by conti to exfiltrate NTDS"
dispatch.earliest_time = -24h@h
alert.track = 0

[Sensitive Registry Access via Volume Shadow Copy - winevent]
description = Detects a command that accesses password storing registry hives via volume shadow backups
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*\\\\\?\\GLOBALROOT\\Device\\HarddiskVolumeShadowCopy*" (Process_Command_Line="*\\NTDS.dit*" OR Process_Command_Line="*\\SYSTEM*" OR Process_Command_Line="*\\SECURITY*" OR Process_Command_Line="*C:\\tmp\\log*"))) | eval sigma_attack_tags="attack.impact attack.t1490" | eval sigma_title="Sensitive Registry Access via Volume Shadow Copy" | eval sigma_description="Detects a command that accesses password storing registry hives via volume shadow backups"
dispatch.earliest_time = -24h@h
alert.track = 0

[Sensitive Registry Access via Volume Shadow Copy - sysmon]
description = Detects a command that accesses password storing registry hives via volume shadow backups
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*\\\\\?\\GLOBALROOT\\Device\\HarddiskVolumeShadowCopy*" (CommandLine="*\\NTDS.dit*" OR CommandLine="*\\SYSTEM*" OR CommandLine="*\\SECURITY*" OR CommandLine="*C:\\tmp\\log*"))) | eval sigma_attack_tags="attack.impact attack.t1490" | eval sigma_title="Sensitive Registry Access via Volume Shadow Copy" | eval sigma_description="Detects a command that accesses password storing registry hives via volume shadow backups"
dispatch.earliest_time = -24h@h
alert.track = 0

[Conti Volume Shadow Listing - winevent]
description = Detects a command used by conti to find volume shadow backups
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*vssadmin list shadows*" Process_Command_Line="*log.txt*")) | table Account_Name,Process_Command_Line,Creator_Process_Name | eval sigma_attack_tags="attack.t1587.001 attack.resource_development" | eval sigma_title="Conti Volume Shadow Listing" | eval sigma_description="Detects a command used by conti to find volume shadow backups"
dispatch.earliest_time = -24h@h
alert.track = 0

[Conti Volume Shadow Listing - sysmon]
description = Detects a command used by conti to find volume shadow backups
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*vssadmin list shadows*" CommandLine="*log.txt*")) | table User,CommandLine,ParentImage | eval sigma_attack_tags="attack.t1587.001 attack.resource_development" | eval sigma_title="Conti Volume Shadow Listing" | eval sigma_description="Detects a command used by conti to find volume shadow backups"
dispatch.earliest_time = -24h@h
alert.track = 0

[Dridex Process Pattern - winevent]
description = Detects typical Dridex process patterns
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((New_Process_Name="*\\svchost.exe" Process_Command_Line="*C:\\Users\\*" Process_Command_Line="*\\Desktop\\*")) OR ((Creator_Process_Name="*\\svchost.exe" (((New_Process_Name="*\\whoami.exe" Process_Command_Line="*all*")) OR (((New_Process_Name="*\\net.exe" OR New_Process_Name="*\\net1.exe") Process_Command_Line="*view*")))))))) | eval sigma_attack_tags="attack.defense_evasion attack.privilege_escalation attack.t1055 attack.discovery attack.t1135 attack.t1033" | eval sigma_title="Dridex Process Pattern" | eval sigma_description="Detects typical Dridex process patterns"
dispatch.earliest_time = -24h@h
alert.track = 0

[Dridex Process Pattern - sysmon]
description = Detects typical Dridex process patterns
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((Image="*\\svchost.exe" CommandLine="*C:\\Users\\*" CommandLine="*\\Desktop\\*")) OR ((ParentImage="*\\svchost.exe" (((Image="*\\whoami.exe" CommandLine="*all*")) OR (((Image="*\\net.exe" OR Image="*\\net1.exe") CommandLine="*view*")))))))) | eval sigma_attack_tags="attack.defense_evasion attack.privilege_escalation attack.t1055 attack.discovery attack.t1135 attack.t1033" | eval sigma_title="Dridex Process Pattern" | eval sigma_description="Detects typical Dridex process patterns"
dispatch.earliest_time = -24h@h
alert.track = 0

[DTRACK Process Creation - winevent]
description = Detects specific process parameters as seen in DTRACK infections
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="* echo EEEE > *")) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.impact attack.t1490" | eval sigma_title="DTRACK Process Creation" | eval sigma_description="Detects specific process parameters as seen in DTRACK infections"
dispatch.earliest_time = -24h@h
alert.track = 0

[DTRACK Process Creation - sysmon]
description = Detects specific process parameters as seen in DTRACK infections
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="* echo EEEE > *")) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.impact attack.t1490" | eval sigma_title="DTRACK Process Creation" | eval sigma_description="Detects specific process parameters as seen in DTRACK infections"
dispatch.earliest_time = -24h@h
alert.track = 0

[Emotet Process Creation - winevent]
description = Detects all Emotet like process executions that are not covered by the more generic rules
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (Process_Command_Line="* -e* PAA*" OR Process_Command_Line="*JABlAG4AdgA6AHUAcwBlAHIAcAByAG8AZgBpAGwAZQ*" OR Process_Command_Line="*QAZQBuAHYAOgB1AHMAZQByAHAAcgBvAGYAaQBsAGUA*" OR Process_Command_Line="*kAGUAbgB2ADoAdQBzAGUAcgBwAHIAbwBmAGkAbABlA*" OR Process_Command_Line="*IgAoACcAKgAnACkAOwAkA*" OR Process_Command_Line="*IAKAAnACoAJwApADsAJA*" OR Process_Command_Line="*iACgAJwAqACcAKQA7ACQA*" OR Process_Command_Line="*JABGAGwAeAByAGgAYwBmAGQ*" OR Process_Command_Line="*PQAkAGUAbgB2ADoAdABlAG0AcAArACgA*" OR Process_Command_Line="*0AJABlAG4AdgA6AHQAZQBtAHAAKwAoA*" OR Process_Command_Line="*9ACQAZQBuAHYAOgB0AGUAbQBwACsAKA*") NOT (((Process_Command_Line="*fAAgAEMAbwBuAHYAZQByAHQAVABvAC0ASgBzAG8AbgAgAC0ARQByAHIAbwByAEEAYwB0AGkAbwBuACAAUwBpAGwAZQBuAHQAbAB5AEMAbwBuAHQAaQBuAHUAZQ*" OR Process_Command_Line="*wAIABDAG8AbgB2AGUAcgB0AFQAbwAtAEoAcwBvAG4AIAAtAEUAcgByAG8AcgBBAGMAdABpAG8AbgAgAFMAaQBsAGUAbgB0AGwAeQBDAG8AbgB0AGkAbgB1AGUA*" OR Process_Command_Line="*8ACAAQwBvAG4AdgBlAHIAdABUAG8ALQBKAHMAbwBuACAALQBFAHIAcgBvAHIAQQBjAHQAaQBvAG4AIABTAGkAbABlAG4AdABsAHkAQwBvAG4AdABpAG4AdQBlA*"))))) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.execution attack.t1059.001 attack.defense_evasion attack.t1027" | eval sigma_title="Emotet Process Creation" | eval sigma_description="Detects all Emotet like process executions that are not covered by the more generic rules"
dispatch.earliest_time = -24h@h
alert.track = 0

[Emotet Process Creation - sysmon]
description = Detects all Emotet like process executions that are not covered by the more generic rules
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (CommandLine="* -e* PAA*" OR CommandLine="*JABlAG4AdgA6AHUAcwBlAHIAcAByAG8AZgBpAGwAZQ*" OR CommandLine="*QAZQBuAHYAOgB1AHMAZQByAHAAcgBvAGYAaQBsAGUA*" OR CommandLine="*kAGUAbgB2ADoAdQBzAGUAcgBwAHIAbwBmAGkAbABlA*" OR CommandLine="*IgAoACcAKgAnACkAOwAkA*" OR CommandLine="*IAKAAnACoAJwApADsAJA*" OR CommandLine="*iACgAJwAqACcAKQA7ACQA*" OR CommandLine="*JABGAGwAeAByAGgAYwBmAGQ*" OR CommandLine="*PQAkAGUAbgB2ADoAdABlAG0AcAArACgA*" OR CommandLine="*0AJABlAG4AdgA6AHQAZQBtAHAAKwAoA*" OR CommandLine="*9ACQAZQBuAHYAOgB0AGUAbQBwACsAKA*") NOT (((CommandLine="*fAAgAEMAbwBuAHYAZQByAHQAVABvAC0ASgBzAG8AbgAgAC0ARQByAHIAbwByAEEAYwB0AGkAbwBuACAAUwBpAGwAZQBuAHQAbAB5AEMAbwBuAHQAaQBuAHUAZQ*" OR CommandLine="*wAIABDAG8AbgB2AGUAcgB0AFQAbwAtAEoAcwBvAG4AIAAtAEUAcgByAG8AcgBBAGMAdABpAG8AbgAgAFMAaQBsAGUAbgB0AGwAeQBDAG8AbgB0AGkAbgB1AGUA*" OR CommandLine="*8ACAAQwBvAG4AdgBlAHIAdABUAG8ALQBKAHMAbwBuACAALQBFAHIAcgBvAHIAQQBjAHQAaQBvAG4AIABTAGkAbABlAG4AdABsAHkAQwBvAG4AdABpAG4AdQBlA*"))))) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.execution attack.t1059.001 attack.defense_evasion attack.t1027" | eval sigma_title="Emotet Process Creation" | eval sigma_description="Detects all Emotet like process executions that are not covered by the more generic rules"
dispatch.earliest_time = -24h@h
alert.track = 0

[Formbook Process Creation - winevent]
description = Detects Formbook like process executions that inject code into a set of files in the System32 folder, which executes a special command command line to delete the dropper from the AppData Temp folder. We avoid false positives by excluding all parent process with command line parameters.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((ParentCommandLine="C:\\Windows\\System32\\*" OR ParentCommandLine="C:\\Windows\\SysWOW64\\*") ParentCommandLine="*.exe")) (((Process_Command_Line="*/c*" Process_Command_Line="*del*" Process_Command_Line="*C:\\Users\\*" Process_Command_Line="*\\AppData\\Local\\Temp\\*")) OR ((Process_Command_Line="*/c*" Process_Command_Line="*del*" Process_Command_Line="*C:\\Users\\*" Process_Command_Line="*\\Desktop\\*")) OR ((Process_Command_Line="*/C*" Process_Command_Line="*type nul >*" Process_Command_Line="*C:\\Users\\*" Process_Command_Line="*\\Desktop\\*"))) Process_Command_Line="*.exe")) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.resource_development attack.t1587.001" | eval sigma_title="Formbook Process Creation" | eval sigma_description="Detects Formbook like process executions that inject code into a set of files in the System32 folder, which executes a special command command line to delete the dropper from the AppData Temp folder. We avoid false positives by excluding all parent process with command line parameters."
dispatch.earliest_time = -24h@h
alert.track = 0

[Formbook Process Creation - sysmon]
description = Detects Formbook like process executions that inject code into a set of files in the System32 folder, which executes a special command command line to delete the dropper from the AppData Temp folder. We avoid false positives by excluding all parent process with command line parameters.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((ParentCommandLine="C:\\Windows\\System32\\*" OR ParentCommandLine="C:\\Windows\\SysWOW64\\*") ParentCommandLine="*.exe")) (((CommandLine="*/c*" CommandLine="*del*" CommandLine="*C:\\Users\\*" CommandLine="*\\AppData\\Local\\Temp\\*")) OR ((CommandLine="*/c*" CommandLine="*del*" CommandLine="*C:\\Users\\*" CommandLine="*\\Desktop\\*")) OR ((CommandLine="*/C*" CommandLine="*type nul >*" CommandLine="*C:\\Users\\*" CommandLine="*\\Desktop\\*"))) CommandLine="*.exe")) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.resource_development attack.t1587.001" | eval sigma_title="Formbook Process Creation" | eval sigma_description="Detects Formbook like process executions that inject code into a set of files in the System32 folder, which executes a special command command line to delete the dropper from the AppData Temp folder. We avoid false positives by excluding all parent process with command line parameters."
dispatch.earliest_time = -24h@h
alert.track = 0

[NotPetya Ransomware Activity - winevent]
description = Detects NotPetya ransomware activity in which the extracted passwords are passed back to the main module via named pipe, the file system journal of drive C is deleted and windows eventlogs are cleared using wevtutil
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((Process_Command_Line="*wevtutil cl Application & fsutil usn deletejournal /D C:*" OR Process_Command_Line="*dllhost.dat %WINDIR%\\ransoms*") OR ((New_Process_Name="*\\rundll32.exe" (Process_Command_Line="*.dat,#1" OR Process_Command_Line="*.dat #1" OR Process_Command_Line="*.zip.dll\",#1"))) OR "\\perfc.dat"))) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.t1218.011 attack.t1070.001 attack.credential_access attack.t1003.001 car.2016-04-002" | eval sigma_title="NotPetya Ransomware Activity" | eval sigma_description="Detects NotPetya ransomware activity in which the extracted passwords are passed back to the main module via named pipe, the file system journal of drive C is deleted and windows eventlogs are cleared using wevtutil"
dispatch.earliest_time = -24h@h
alert.track = 0

[NotPetya Ransomware Activity - sysmon]
description = Detects NotPetya ransomware activity in which the extracted passwords are passed back to the main module via named pipe, the file system journal of drive C is deleted and windows eventlogs are cleared using wevtutil
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((CommandLine="*wevtutil cl Application & fsutil usn deletejournal /D C:*" OR CommandLine="*dllhost.dat %WINDIR%\\ransoms*") OR ((Image="*\\rundll32.exe" (CommandLine="*.dat,#1" OR CommandLine="*.dat #1" OR CommandLine="*.zip.dll\",#1"))) OR "\\perfc.dat"))) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.t1218.011 attack.t1070.001 attack.credential_access attack.t1003.001 car.2016-04-002" | eval sigma_title="NotPetya Ransomware Activity" | eval sigma_description="Detects NotPetya ransomware activity in which the extracted passwords are passed back to the main module via named pipe, the file system journal of drive C is deleted and windows eventlogs are cleared using wevtutil"
dispatch.earliest_time = -24h@h
alert.track = 0

[QBot Process Creation - winevent]
description = Detects QBot like process executions
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((Creator_Process_Name="*\\WinRAR.exe" New_Process_Name="*\\wscript.exe")) OR Process_Command_Line="* /c ping.exe -n 6 127.0.0.1 & type *" OR ((Process_Command_Line="*regsvr32.exe*" Process_Command_Line="*C:\\ProgramData*" Process_Command_Line="*.tmp*"))))) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.execution attack.t1059.005" | eval sigma_title="QBot Process Creation" | eval sigma_description="Detects QBot like process executions"
dispatch.earliest_time = -24h@h
alert.track = 0

[QBot Process Creation - sysmon]
description = Detects QBot like process executions
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((ParentImage="*\\WinRAR.exe" Image="*\\wscript.exe")) OR CommandLine="* /c ping.exe -n 6 127.0.0.1 & type *" OR ((CommandLine="*regsvr32.exe*" CommandLine="*C:\\ProgramData*" CommandLine="*.tmp*"))))) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.execution attack.t1059.005" | eval sigma_title="QBot Process Creation" | eval sigma_description="Detects QBot like process executions"
dispatch.earliest_time = -24h@h
alert.track = 0

[Ryuk Ransomware - winevent]
description = Detects Ryuk ransomware activity
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*Microsoft\\Windows\\CurrentVersion\\Run*" Process_Command_Line="*C:\\users\\Public\\*")) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.persistence attack.t1547.001" | eval sigma_title="Ryuk Ransomware" | eval sigma_description="Detects Ryuk ransomware activity"
dispatch.earliest_time = -24h@h
alert.track = 0

[Ryuk Ransomware - sysmon]
description = Detects Ryuk ransomware activity
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*Microsoft\\Windows\\CurrentVersion\\Run*" CommandLine="*C:\\users\\Public\\*")) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.persistence attack.t1547.001" | eval sigma_title="Ryuk Ransomware" | eval sigma_description="Detects Ryuk ransomware activity"
dispatch.earliest_time = -24h@h
alert.track = 0

[WScript or CScript Dropper - winevent]
description = Detects wscript/cscript executions of scripts located in user directories
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((New_Process_Name="*\\wscript.exe" OR New_Process_Name="*\\cscript.exe") (Process_Command_Line="*C:\\Users\\*" OR Process_Command_Line="*C:\\ProgramData\\*") (Process_Command_Line="*.jse*" OR Process_Command_Line="*.vbe*" OR Process_Command_Line="*.js*" OR Process_Command_Line="*.vba*" OR Process_Command_Line="*.vbs*"))) NOT ((Creator_Process_Name="*\\winzip*")))) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.execution attack.t1059.005 attack.t1059.007" | eval sigma_title="WScript or CScript Dropper" | eval sigma_description="Detects wscript/cscript executions of scripts located in user directories"
dispatch.earliest_time = -24h@h
alert.track = 0

[WScript or CScript Dropper - sysmon]
description = Detects wscript/cscript executions of scripts located in user directories
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((Image="*\\wscript.exe" OR Image="*\\cscript.exe") (CommandLine="*C:\\Users\\*" OR CommandLine="*C:\\ProgramData\\*") (CommandLine="*.jse*" OR CommandLine="*.vbe*" OR CommandLine="*.js*" OR CommandLine="*.vba*" OR CommandLine="*.vbs*"))) NOT ((ParentImage="*\\winzip*")))) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.execution attack.t1059.005 attack.t1059.007" | eval sigma_title="WScript or CScript Dropper" | eval sigma_description="Detects wscript/cscript executions of scripts located in user directories"
dispatch.earliest_time = -24h@h
alert.track = 0

[Trickbot Malware Recon Activity - winevent]
description = Trickbot enumerates domain/network topology and executes certain commands automatically every few minutes. This detectors attempts to identify that activity based off a command rarely observed in an enterprise network.
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Creator_Process_Name="*\\cmd.exe" New_Process_Name="*\\nltest.exe" Process_Command_Line="*/domain_trusts /all_trusts*")) | eval sigma_attack_tags="attack.discovery attack.t1482" | eval sigma_title="Trickbot Malware Recon Activity" | eval sigma_description="Trickbot enumerates domain/network topology and executes certain commands automatically every few minutes. This detectors attempts to identify that activity based off a command rarely observed in an enterprise network."
dispatch.earliest_time = -24h@h
alert.track = 0

[Trickbot Malware Recon Activity - sysmon]
description = Trickbot enumerates domain/network topology and executes certain commands automatically every few minutes. This detectors attempts to identify that activity based off a command rarely observed in an enterprise network.
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") ParentImage="*\\cmd.exe" Image="*\\nltest.exe" CommandLine="*/domain_trusts /all_trusts*")) | eval sigma_attack_tags="attack.discovery attack.t1482" | eval sigma_title="Trickbot Malware Recon Activity" | eval sigma_description="Trickbot enumerates domain/network topology and executes certain commands automatically every few minutes. This detectors attempts to identify that activity based off a command rarely observed in an enterprise network."
dispatch.earliest_time = -24h@h
alert.track = 0

[Trickbot Malware Activity - winevent]
description = Detects Trickbot malware process tree pattern in which rundll32.exe is parent of wermgr.exe
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\wermgr.exe" Creator_Process_Name="*\\rundll32.exe" ParentCommandLine="*DllRegisterServer*")) | eval sigma_attack_tags="attack.execution attack.t1559" | eval sigma_title="Trickbot Malware Activity" | eval sigma_description="Detects Trickbot malware process tree pattern in which rundll32.exe is parent of wermgr.exe"
dispatch.earliest_time = -24h@h
alert.track = 0

[Trickbot Malware Activity - sysmon]
description = Detects Trickbot malware process tree pattern in which rundll32.exe is parent of wermgr.exe
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\wermgr.exe" ParentImage="*\\rundll32.exe" ParentCommandLine="*DllRegisterServer*")) | eval sigma_attack_tags="attack.execution attack.t1559" | eval sigma_title="Trickbot Malware Activity" | eval sigma_description="Detects Trickbot malware process tree pattern in which rundll32.exe is parent of wermgr.exe"
dispatch.earliest_time = -24h@h
alert.track = 0

[WannaCry Ransomware - winevent]
description = Detects WannaCry ransomware activity
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\tasksche.exe" OR New_Process_Name="*\\mssecsvc.exe" OR New_Process_Name="*\\taskdl.exe" OR New_Process_Name="*\\taskhsvc.exe" OR New_Process_Name="*\\taskse.exe" OR New_Process_Name="*\\111.exe" OR New_Process_Name="*\\lhdfrgui.exe" OR New_Process_Name="*\\linuxnew.exe" OR New_Process_Name="*\\wannacry.exe") OR New_Process_Name="*WanaDecryptor*" OR ((Process_Command_Line="*icacls*" Process_Command_Line="*/grant*" Process_Command_Line="*Everyone:F*" Process_Command_Line="*/T*" Process_Command_Line="*/C*" Process_Command_Line="*/Q*")) OR ((Process_Command_Line="*bcdedit*" Process_Command_Line="*/set*" Process_Command_Line="*{default}*" Process_Command_Line="*recoveryenabled*" Process_Command_Line="*no*")) OR ((Process_Command_Line="*wbadmin*" Process_Command_Line="*delete*" Process_Command_Line="*catalog*" Process_Command_Line="*-quiet*")) OR Process_Command_Line="*@Please_Read_Me@.txt*"))) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.lateral_movement attack.t1210 attack.discovery attack.t1083 attack.defense_evasion attack.t1222.001 attack.impact attack.t1486 attack.t1490" | eval sigma_title="WannaCry Ransomware" | eval sigma_description="Detects WannaCry ransomware activity"
dispatch.earliest_time = -24h@h
alert.track = 0

[WannaCry Ransomware - sysmon]
description = Detects WannaCry ransomware activity
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\tasksche.exe" OR Image="*\\mssecsvc.exe" OR Image="*\\taskdl.exe" OR Image="*\\taskhsvc.exe" OR Image="*\\taskse.exe" OR Image="*\\111.exe" OR Image="*\\lhdfrgui.exe" OR Image="*\\linuxnew.exe" OR Image="*\\wannacry.exe") OR Image="*WanaDecryptor*" OR ((CommandLine="*icacls*" CommandLine="*/grant*" CommandLine="*Everyone:F*" CommandLine="*/T*" CommandLine="*/C*" CommandLine="*/Q*")) OR ((CommandLine="*bcdedit*" CommandLine="*/set*" CommandLine="*{default}*" CommandLine="*recoveryenabled*" CommandLine="*no*")) OR ((CommandLine="*wbadmin*" CommandLine="*delete*" CommandLine="*catalog*" CommandLine="*-quiet*")) OR CommandLine="*@Please_Read_Me@.txt*"))) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.lateral_movement attack.t1210 attack.discovery attack.t1083 attack.defense_evasion attack.t1222.001 attack.impact attack.t1486 attack.t1490" | eval sigma_title="WannaCry Ransomware" | eval sigma_description="Detects WannaCry ransomware activity"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Usage of the Manage-bde.wsf Script - winevent]
description = Detects usage of the manage-bde.wsf script that may indicate an attempt of proxy execution from script
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*cscript*" Process_Command_Line="*manage-bde.wsf*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1216" | eval sigma_title="Suspicious Usage of the Manage-bde.wsf Script" | eval sigma_description="Detects usage of the manage-bde.wsf script that may indicate an attempt of proxy execution from script"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Usage of the Manage-bde.wsf Script - sysmon]
description = Detects usage of the manage-bde.wsf script that may indicate an attempt of proxy execution from script
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*cscript*" CommandLine="*manage-bde.wsf*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1216" | eval sigma_title="Suspicious Usage of the Manage-bde.wsf Script" | eval sigma_description="Detects usage of the manage-bde.wsf script that may indicate an attempt of proxy execution from script"
dispatch.earliest_time = -24h@h
alert.track = 0

[Meterpreter or Cobalt Strike Getsystem Service Start - winevent]
description = Detects the use of getsystem Meterpreter/Cobalt Strike command by detecting a specific service starting
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((Creator_Process_Name="*\\services.exe" (((Process_Command_Line="*cmd*" Process_Command_Line="*/c*" Process_Command_Line="*echo*" Process_Command_Line="*\\pipe\\*")) OR ((Process_Command_Line="*%COMSPEC%*" Process_Command_Line="*/c*" Process_Command_Line="*echo*" Process_Command_Line="*\\pipe\\*")) OR ((Process_Command_Line="*cmd.exe*" Process_Command_Line="*/c*" Process_Command_Line="*echo*" Process_Command_Line="*\\pipe\\*")) OR ((Process_Command_Line="*rundll32*" Process_Command_Line="*.dll,a*" Process_Command_Line="*/p:*"))))) NOT ((Process_Command_Line="*MpCmdRun*")))) | table ComputerName,Account_Name,Process_Command_Line | eval sigma_attack_tags="attack.privilege_escalation attack.t1134.001 attack.t1134.002" | eval sigma_title="Meterpreter or Cobalt Strike Getsystem Service Start" | eval sigma_description="Detects the use of getsystem Meterpreter/Cobalt Strike command by detecting a specific service starting"
dispatch.earliest_time = -24h@h
alert.track = 0

[Meterpreter or Cobalt Strike Getsystem Service Start - sysmon]
description = Detects the use of getsystem Meterpreter/Cobalt Strike command by detecting a specific service starting
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((ParentImage="*\\services.exe" (((CommandLine="*cmd*" CommandLine="*/c*" CommandLine="*echo*" CommandLine="*\\pipe\\*")) OR ((CommandLine="*%COMSPEC%*" CommandLine="*/c*" CommandLine="*echo*" CommandLine="*\\pipe\\*")) OR ((CommandLine="*cmd.exe*" CommandLine="*/c*" CommandLine="*echo*" CommandLine="*\\pipe\\*")) OR ((CommandLine="*rundll32*" CommandLine="*.dll,a*" CommandLine="*/p:*"))))) NOT ((CommandLine="*MpCmdRun*")))) | table ComputerName,User,CommandLine | eval sigma_attack_tags="attack.privilege_escalation attack.t1134.001 attack.t1134.002" | eval sigma_title="Meterpreter or Cobalt Strike Getsystem Service Start" | eval sigma_description="Detects the use of getsystem Meterpreter/Cobalt Strike command by detecting a specific service starting"
dispatch.earliest_time = -24h@h
alert.track = 0

[Mimikatz Command Line - winevent]
description = Detection well-known mimikatz command line arguments
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((Process_Command_Line="*DumpCreds*" OR Process_Command_Line="*invoke-mimikatz*") OR (((Process_Command_Line="*rpc*" OR Process_Command_Line="*token*" OR Process_Command_Line="*crypto*" OR Process_Command_Line="*dpapi*" OR Process_Command_Line="*sekurlsa*" OR Process_Command_Line="*kerberos*" OR Process_Command_Line="*lsadump*" OR Process_Command_Line="*privilege*" OR Process_Command_Line="*process*" OR Process_Command_Line="*vault*") Process_Command_Line="*::*"))) OR (((Process_Command_Line="*aadcookie*" OR Process_Command_Line="*detours*" OR Process_Command_Line="*memssp*" OR Process_Command_Line="*mflt*" OR Process_Command_Line="*ncroutemon*" OR Process_Command_Line="*ngcsign*" OR Process_Command_Line="*printnightmare*" OR Process_Command_Line="*skeleton*" OR Process_Command_Line="*preshutdown*" OR Process_Command_Line="*mstsc*" OR Process_Command_Line="*multirdp*") Process_Command_Line="*::*"))) NOT (((Process_Command_Line="*function Convert-GuidToCompressedGuid*")) OR ((Creator_Process_Name="*\\AppData\\Local\\Programs\\Microsoft VS Code\\Code.exe" (Process_Command_Line="*/d /s /c *" Process_Command_Line="*checkfilenameiocs --ioc-path *")))))) | eval sigma_attack_tags="attack.credential_access attack.t1003.001 attack.t1003.002 attack.t1003.004 attack.t1003.005 attack.t1003.006" | eval sigma_title="Mimikatz Command Line" | eval sigma_description="Detection well-known mimikatz command line arguments"
dispatch.earliest_time = -24h@h
alert.track = 0

[Mimikatz Command Line - sysmon]
description = Detection well-known mimikatz command line arguments
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((CommandLine="*DumpCreds*" OR CommandLine="*invoke-mimikatz*") OR (((CommandLine="*rpc*" OR CommandLine="*token*" OR CommandLine="*crypto*" OR CommandLine="*dpapi*" OR CommandLine="*sekurlsa*" OR CommandLine="*kerberos*" OR CommandLine="*lsadump*" OR CommandLine="*privilege*" OR CommandLine="*process*" OR CommandLine="*vault*") CommandLine="*::*"))) OR (((CommandLine="*aadcookie*" OR CommandLine="*detours*" OR CommandLine="*memssp*" OR CommandLine="*mflt*" OR CommandLine="*ncroutemon*" OR CommandLine="*ngcsign*" OR CommandLine="*printnightmare*" OR CommandLine="*skeleton*" OR CommandLine="*preshutdown*" OR CommandLine="*mstsc*" OR CommandLine="*multirdp*") CommandLine="*::*"))) NOT (((CommandLine="*function Convert-GuidToCompressedGuid*")) OR ((ParentImage="*\\AppData\\Local\\Programs\\Microsoft VS Code\\Code.exe" (CommandLine="*/d /s /c *" CommandLine="*checkfilenameiocs --ioc-path *")))))) | eval sigma_attack_tags="attack.credential_access attack.t1003.001 attack.t1003.002 attack.t1003.004 attack.t1003.005 attack.t1003.006" | eval sigma_title="Mimikatz Command Line" | eval sigma_description="Detection well-known mimikatz command line arguments"
dispatch.earliest_time = -24h@h
alert.track = 0

[MMC Spawning Windows Shell - winevent]
description = Detects a Windows command line executable started from MMC
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) Creator_Process_Name="*\\mmc.exe" ((New_Process_Name="*\\cmd.exe" OR New_Process_Name="*\\powershell.exe" OR New_Process_Name="*\\pwsh.exe" OR New_Process_Name="*\\wscript.exe" OR New_Process_Name="*\\cscript.exe" OR New_Process_Name="*\\sh.exe" OR New_Process_Name="*\\bash.exe" OR New_Process_Name="*\\reg.exe" OR New_Process_Name="*\\regsvr32.exe") OR New_Process_Name="*\\BITSADMIN*"))) | table Process_Command_Line,New_Process_Name,ParentCommandLine | eval sigma_attack_tags="attack.lateral_movement attack.t1021.003" | eval sigma_title="MMC Spawning Windows Shell" | eval sigma_description="Detects a Windows command line executable started from MMC"
dispatch.earliest_time = -24h@h
alert.track = 0

[MMC Spawning Windows Shell - sysmon]
description = Detects a Windows command line executable started from MMC
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ParentImage="*\\mmc.exe" ((Image="*\\cmd.exe" OR Image="*\\powershell.exe" OR Image="*\\pwsh.exe" OR Image="*\\wscript.exe" OR Image="*\\cscript.exe" OR Image="*\\sh.exe" OR Image="*\\bash.exe" OR Image="*\\reg.exe" OR Image="*\\regsvr32.exe") OR Image="*\\BITSADMIN*"))) | table CommandLine,Image,ParentCommandLine | eval sigma_attack_tags="attack.lateral_movement attack.t1021.003" | eval sigma_title="MMC Spawning Windows Shell" | eval sigma_description="Detects a Windows command line executable started from MMC"
dispatch.earliest_time = -24h@h
alert.track = 0

[MMC20 Lateral Movement - winevent]
description = Detects MMC20.Application Lateral Movement; specifically looks for the spawning of the parent MMC.exe with a command line of '-Embedding' as a child of svchost.exe
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Creator_Process_Name="*\\svchost.exe" New_Process_Name="*\\mmc.exe" Process_Command_Line="*-Embedding*")) | eval sigma_attack_tags="attack.execution attack.t1021.003" | eval sigma_title="MMC20 Lateral Movement" | eval sigma_description="Detects MMC20.Application Lateral Movement; specifically looks for the spawning of the parent MMC.exe with a command line of '-Embedding' as a child of svchost.exe"
dispatch.earliest_time = -24h@h
alert.track = 0

[MMC20 Lateral Movement - sysmon]
description = Detects MMC20.Application Lateral Movement; specifically looks for the spawning of the parent MMC.exe with a command line of '-Embedding' as a child of svchost.exe
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") ParentImage="*\\svchost.exe" Image="*\\mmc.exe" CommandLine="*-Embedding*")) | eval sigma_attack_tags="attack.execution attack.t1021.003" | eval sigma_title="MMC20 Lateral Movement" | eval sigma_description="Detects MMC20.Application Lateral Movement; specifically looks for the spawning of the parent MMC.exe with a command line of '-Embedding' as a child of svchost.exe"
dispatch.earliest_time = -24h@h
alert.track = 0

[Modification Of Existing Services For Persistence - winevent]
description = Detects modification of an existing service on a compromised host in order to execute an arbitrary payload when the service is started or killed as a method of persistence.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((((Process_Command_Line="*sc *" Process_Command_Line="*config *" Process_Command_Line="*binpath=*")) OR ((Process_Command_Line="*sc *" Process_Command_Line="*failure*" Process_Command_Line="*command=*"))) OR (((((Process_Command_Line="*reg *" Process_Command_Line="*add *" Process_Command_Line="*FailureCommand*")) OR ((Process_Command_Line="*reg *" Process_Command_Line="*add *" Process_Command_Line="*ImagePath*"))) (Process_Command_Line="*.sh*" OR Process_Command_Line="*.exe*" OR Process_Command_Line="*.dll*" OR Process_Command_Line="*.bin$*" OR Process_Command_Line="*.bat*" OR Process_Command_Line="*.cmd*" OR Process_Command_Line="*.js*" OR Process_Command_Line="*.msh$*" OR Process_Command_Line="*.reg$*" OR Process_Command_Line="*.scr*" OR Process_Command_Line="*.ps*" OR Process_Command_Line="*.vb*" OR Process_Command_Line="*.jar*" OR Process_Command_Line="*.pl*")))))) | eval sigma_attack_tags="attack.persistence attack.t1543.003 attack.t1574.011" | eval sigma_title="Modification Of Existing Services For Persistence" | eval sigma_description="Detects modification of an existing service on a compromised host in order to execute an arbitrary payload when the service is started or killed as a method of persistence."
dispatch.earliest_time = -24h@h
alert.track = 0

[Modification Of Existing Services For Persistence - sysmon]
description = Detects modification of an existing service on a compromised host in order to execute an arbitrary payload when the service is started or killed as a method of persistence.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((((CommandLine="*sc *" CommandLine="*config *" CommandLine="*binpath=*")) OR ((CommandLine="*sc *" CommandLine="*failure*" CommandLine="*command=*"))) OR (((((CommandLine="*reg *" CommandLine="*add *" CommandLine="*FailureCommand*")) OR ((CommandLine="*reg *" CommandLine="*add *" CommandLine="*ImagePath*"))) (CommandLine="*.sh*" OR CommandLine="*.exe*" OR CommandLine="*.dll*" OR CommandLine="*.bin$*" OR CommandLine="*.bat*" OR CommandLine="*.cmd*" OR CommandLine="*.js*" OR CommandLine="*.msh$*" OR CommandLine="*.reg$*" OR CommandLine="*.scr*" OR CommandLine="*.ps*" OR CommandLine="*.vb*" OR CommandLine="*.jar*" OR CommandLine="*.pl*")))))) | eval sigma_attack_tags="attack.persistence attack.t1543.003 attack.t1574.011" | eval sigma_title="Modification Of Existing Services For Persistence" | eval sigma_description="Detects modification of an existing service on a compromised host in order to execute an arbitrary payload when the service is started or killed as a method of persistence."
dispatch.earliest_time = -24h@h
alert.track = 0

[Modify Group Policy Settings - winevent]
description = Detect malicious GPO modifications can be used to implement many other malicious behaviors.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\reg.exe" OR OriginalFileName="reg.exe") Process_Command_Line="*\\SOFTWARE\\Policies\\Microsoft\\Windows\\System*" (Process_Command_Line="*GroupPolicyRefreshTimeDC*" OR Process_Command_Line="*GroupPolicyRefreshTimeOffsetDC*" OR Process_Command_Line="*GroupPolicyRefreshTime*" OR Process_Command_Line="*GroupPolicyRefreshTimeOffset*" OR Process_Command_Line="*EnableSmartScreen*" OR Process_Command_Line="*ShellSmartScreenLevel*"))) | eval sigma_attack_tags="attack.defense_evasion attack.privilege_escalation attack.t1484.001" | eval sigma_title="Modify Group Policy Settings" | eval sigma_description="Detect malicious GPO modifications can be used to implement many other malicious behaviors."
dispatch.earliest_time = -24h@h
alert.track = 0

[Modify Group Policy Settings - sysmon]
description = Detect malicious GPO modifications can be used to implement many other malicious behaviors.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\reg.exe" OR OriginalFileName="reg.exe") CommandLine="*\\SOFTWARE\\Policies\\Microsoft\\Windows\\System*" (CommandLine="*GroupPolicyRefreshTimeDC*" OR CommandLine="*GroupPolicyRefreshTimeOffsetDC*" OR CommandLine="*GroupPolicyRefreshTime*" OR CommandLine="*GroupPolicyRefreshTimeOffset*" OR CommandLine="*EnableSmartScreen*" OR CommandLine="*ShellSmartScreenLevel*"))) | eval sigma_attack_tags="attack.defense_evasion attack.privilege_escalation attack.t1484.001" | eval sigma_title="Modify Group Policy Settings" | eval sigma_description="Detect malicious GPO modifications can be used to implement many other malicious behaviors."
dispatch.earliest_time = -24h@h
alert.track = 0

[Monitoring For Persistence Via BITS - winevent]
description = BITS will allow you to schedule a command to execute after a successful download to notify you that the job is finished. When the job runs on the system the command specified in the BITS job will be executed. This can be abused by actors to create a backdoor within the system and for persistence. It will be chained in a BITS job to schedule the download of malware/additional binaries and execute the program after being downloaded
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((Process_Command_Line="*bitsadmin*" Process_Command_Line="*/SetNotifyCmdLine*" (Process_Command_Line="*%COMSPEC%*" OR Process_Command_Line="*cmd.exe*" OR Process_Command_Line="*regsvr32.exe*"))) OR ((Process_Command_Line="*bitsadmin*" Process_Command_Line="*/Addfile*" (Process_Command_Line="*http:*" OR Process_Command_Line="*https:*" OR Process_Command_Line="*ftp:*" OR Process_Command_Line="*ftps:*")))))) | table Process_Command_Line | eval sigma_attack_tags="attack.defense_evasion attack.t1197" | eval sigma_title="Monitoring For Persistence Via BITS" | eval sigma_description="BITS will allow you to schedule a command to execute after a successful download to notify you that the job is finished. When the job runs on the system the command specified in the BITS job will be executed. This can be abused by actors to create a backdoor within the system and for persistence. It will be chained in a BITS job to schedule the download of malware/additional binaries and execute the program after being downloaded"
dispatch.earliest_time = -24h@h
alert.track = 0

[Monitoring For Persistence Via BITS - sysmon]
description = BITS will allow you to schedule a command to execute after a successful download to notify you that the job is finished. When the job runs on the system the command specified in the BITS job will be executed. This can be abused by actors to create a backdoor within the system and for persistence. It will be chained in a BITS job to schedule the download of malware/additional binaries and execute the program after being downloaded
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((CommandLine="*bitsadmin*" CommandLine="*/SetNotifyCmdLine*" (CommandLine="*%COMSPEC%*" OR CommandLine="*cmd.exe*" OR CommandLine="*regsvr32.exe*"))) OR ((CommandLine="*bitsadmin*" CommandLine="*/Addfile*" (CommandLine="*http:*" OR CommandLine="*https:*" OR CommandLine="*ftp:*" OR CommandLine="*ftps:*")))))) | table CommandLine | eval sigma_attack_tags="attack.defense_evasion attack.t1197" | eval sigma_title="Monitoring For Persistence Via BITS" | eval sigma_description="BITS will allow you to schedule a command to execute after a successful download to notify you that the job is finished. When the job runs on the system the command specified in the BITS job will be executed. This can be abused by actors to create a backdoor within the system and for persistence. It will be chained in a BITS job to schedule the download of malware/additional binaries and execute the program after being downloaded"
dispatch.earliest_time = -24h@h
alert.track = 0

[Mouse Lock Credential Gathering - winevent]
description = In Kaspersky's 2020 Incident Response Analyst Report they listed legitimate tool 'Mouse Lock' as being used for both credential access and collection in security incidents.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (Product="*Mouse Lock*" OR Company="*Misc314*" OR Process_Command_Line="*Mouse Lock_*"))) | table Product,Company,Process_Command_Line | eval sigma_attack_tags="attack.credential_access attack.collection attack.t1056.002" | eval sigma_title="Mouse Lock Credential Gathering" | eval sigma_description="In Kaspersky's 2020 Incident Response Analyst Report they listed legitimate tool 'Mouse Lock' as being used for both credential access and collection in security incidents."
dispatch.earliest_time = -24h@h
alert.track = 0

[Mouse Lock Credential Gathering - sysmon]
description = In Kaspersky's 2020 Incident Response Analyst Report they listed legitimate tool 'Mouse Lock' as being used for both credential access and collection in security incidents.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Product="*Mouse Lock*" OR Company="*Misc314*" OR CommandLine="*Mouse Lock_*"))) | table Product,Company,CommandLine | eval sigma_attack_tags="attack.credential_access attack.collection attack.t1056.002" | eval sigma_title="Mouse Lock Credential Gathering" | eval sigma_description="In Kaspersky's 2020 Incident Response Analyst Report they listed legitimate tool 'Mouse Lock' as being used for both credential access and collection in security incidents."
dispatch.earliest_time = -24h@h
alert.track = 0

[Execute Files with Msdeploy.exe - winevent]
description = Detects file execution using the msdeploy.exe lolbin
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*verb:sync*" Process_Command_Line="*-source:RunCommand*" Process_Command_Line="*-dest:runCommand*" New_Process_Name="*\\msdeploy.exe")) | table ComputerName,Account_Name,Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.execution attack.t1218" | eval sigma_title="Execute Files with Msdeploy.exe" | eval sigma_description="Detects file execution using the msdeploy.exe lolbin"
dispatch.earliest_time = -24h@h
alert.track = 0

[Execute Files with Msdeploy.exe - sysmon]
description = Detects file execution using the msdeploy.exe lolbin
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*verb:sync*" CommandLine="*-source:RunCommand*" CommandLine="*-dest:runCommand*" Image="*\\msdeploy.exe")) | table ComputerName,User,CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.execution attack.t1218" | eval sigma_title="Execute Files with Msdeploy.exe" | eval sigma_description="Detects file execution using the msdeploy.exe lolbin"
dispatch.earliest_time = -24h@h
alert.track = 0

[Execute MSDT.EXE Using Diagcab File - winevent]
description = Detects diagcab leveraging the 'ms-msdt' handler or the 'msdt.exe' binary to execute arbitrary commands as seen in CVE-2022-30190
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\msdt.exe" OR OriginalFileName="msdt.exe") (Process_Command_Line="* /cab*" OR Process_Command_Line="* -cab*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1202" | eval sigma_title="Execute MSDT.EXE Using Diagcab File" | eval sigma_description="Detects diagcab leveraging the 'ms-msdt' handler or the 'msdt.exe' binary to execute arbitrary commands as seen in CVE-2022-30190"
dispatch.earliest_time = -24h@h
alert.track = 0

[Execute MSDT.EXE Using Diagcab File - sysmon]
description = Detects diagcab leveraging the 'ms-msdt' handler or the 'msdt.exe' binary to execute arbitrary commands as seen in CVE-2022-30190
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\msdt.exe" OR OriginalFileName="msdt.exe") (CommandLine="* /cab*" OR CommandLine="* -cab*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1202" | eval sigma_title="Execute MSDT.EXE Using Diagcab File" | eval sigma_description="Detects diagcab leveraging the 'ms-msdt' handler or the 'msdt.exe' binary to execute arbitrary commands as seen in CVE-2022-30190"
dispatch.earliest_time = -24h@h
alert.track = 0

[MSDT.EXE Execution With Suspicious Cab Option - winevent]
description = Detects execution of msdt.exe using the 'cab' flag which could indicates suspicious diagcab files with embedded answer files leveraging CVE-2022-30190
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\msdt.exe" OR OriginalFileName="msdt.exe") (Process_Command_Line="* /cab *" OR Process_Command_Line="* -cab *"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1202" | eval sigma_title="MSDT.EXE Execution With Suspicious Cab Option" | eval sigma_description="Detects execution of msdt.exe using the 'cab' flag which could indicates suspicious diagcab files with embedded answer files leveraging CVE-2022-30190"
dispatch.earliest_time = -24h@h
alert.track = 0

[MSDT.EXE Execution With Suspicious Cab Option - sysmon]
description = Detects execution of msdt.exe using the 'cab' flag which could indicates suspicious diagcab files with embedded answer files leveraging CVE-2022-30190
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\msdt.exe" OR OriginalFileName="msdt.exe") (CommandLine="* /cab *" OR CommandLine="* -cab *"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1202" | eval sigma_title="MSDT.EXE Execution With Suspicious Cab Option" | eval sigma_description="Detects execution of msdt.exe using the 'cab' flag which could indicates suspicious diagcab files with embedded answer files leveraging CVE-2022-30190"
dispatch.earliest_time = -24h@h
alert.track = 0

[MSDT Executed with Suspicious Parent - winevent]
description = Detects msdt.exe executed by a suspicious parent as seen in CVE-2022-30190 / Follina exploitation
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (Creator_Process_Name="*\\powershell.exe" OR Creator_Process_Name="*\\pwsh.exe" OR Creator_Process_Name="*\\cmd.exe" OR Creator_Process_Name="*\\mshta.exe" OR Creator_Process_Name="*\\cscript.exe" OR Creator_Process_Name="*\\wscript.exe" OR Creator_Process_Name="*\\wsl.exe" OR Creator_Process_Name="*\\rundll32.exe" OR Creator_Process_Name="*\\regsvr32.exe") (New_Process_Name="*\\msdt.exe" OR OriginalFileName="msdt.exe"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1036 attack.t1218" | eval sigma_title="MSDT Executed with Suspicious Parent" | eval sigma_description="Detects msdt.exe executed by a suspicious parent as seen in CVE-2022-30190 / Follina exploitation"
dispatch.earliest_time = -24h@h
alert.track = 0

[MSDT Executed with Suspicious Parent - sysmon]
description = Detects msdt.exe executed by a suspicious parent as seen in CVE-2022-30190 / Follina exploitation
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (ParentImage="*\\powershell.exe" OR ParentImage="*\\pwsh.exe" OR ParentImage="*\\cmd.exe" OR ParentImage="*\\mshta.exe" OR ParentImage="*\\cscript.exe" OR ParentImage="*\\wscript.exe" OR ParentImage="*\\wsl.exe" OR ParentImage="*\\rundll32.exe" OR ParentImage="*\\regsvr32.exe") (Image="*\\msdt.exe" OR OriginalFileName="msdt.exe"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1036 attack.t1218" | eval sigma_title="MSDT Executed with Suspicious Parent" | eval sigma_description="Detects msdt.exe executed by a suspicious parent as seen in CVE-2022-30190 / Follina exploitation"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential Arbitrary Command Execution Using MSDT.EXE - winevent]
description = Detects processes leveraging the 'ms-msdt' handler or the 'msdt.exe' binary to execute arbitrary commands as seen in the follina (CVE-2022-30190) vulnerability
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\msdt.exe" OR OriginalFileName="msdt.exe") (Process_Command_Line="*IT_BrowseForFile=*" OR ((Process_Command_Line="* PCWDiagnostic*" (Process_Command_Line="* /af *" OR Process_Command_Line="* -af *")))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1202" | eval sigma_title="Potential Arbitrary Command Execution Using MSDT.EXE" | eval sigma_description="Detects processes leveraging the 'ms-msdt' handler or the 'msdt.exe' binary to execute arbitrary commands as seen in the follina (CVE-2022-30190) vulnerability"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential Arbitrary Command Execution Using MSDT.EXE - sysmon]
description = Detects processes leveraging the 'ms-msdt' handler or the 'msdt.exe' binary to execute arbitrary commands as seen in the follina (CVE-2022-30190) vulnerability
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\msdt.exe" OR OriginalFileName="msdt.exe") (CommandLine="*IT_BrowseForFile=*" OR ((CommandLine="* PCWDiagnostic*" (CommandLine="* /af *" OR CommandLine="* -af *")))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1202" | eval sigma_title="Potential Arbitrary Command Execution Using MSDT.EXE" | eval sigma_description="Detects processes leveraging the 'ms-msdt' handler or the 'msdt.exe' binary to execute arbitrary commands as seen in the follina (CVE-2022-30190) vulnerability"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Minimized MSEdge Start - winevent]
description = Detects the suspicious minimized start of MsEdge browser, which can be used to download files from the Internet
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*start /min msedge*")) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.command_and_control attack.t1105" | eval sigma_title="Suspicious Minimized MSEdge Start" | eval sigma_description="Detects the suspicious minimized start of MsEdge browser, which can be used to download files from the Internet"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Minimized MSEdge Start - sysmon]
description = Detects the suspicious minimized start of MsEdge browser, which can be used to download files from the Internet
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*start /min msedge*")) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.command_and_control attack.t1105" | eval sigma_title="Suspicious Minimized MSEdge Start" | eval sigma_description="Detects the suspicious minimized start of MsEdge browser, which can be used to download files from the Internet"
dispatch.earliest_time = -24h@h
alert.track = 0

[MSExchange Transport Agent Installation - winevent]
description = Detects the Installation of a Exchange Transport Agent
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*Install-TransportAgent*")) | table AssemblyPath | eval sigma_attack_tags="attack.persistence attack.t1505.002" | eval sigma_title="MSExchange Transport Agent Installation" | eval sigma_description="Detects the Installation of a Exchange Transport Agent"
dispatch.earliest_time = -24h@h
alert.track = 0

[MSExchange Transport Agent Installation - sysmon]
description = Detects the Installation of a Exchange Transport Agent
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*Install-TransportAgent*")) | table AssemblyPath | eval sigma_attack_tags="attack.persistence attack.t1505.002" | eval sigma_title="MSExchange Transport Agent Installation" | eval sigma_description="Detects the Installation of a Exchange Transport Agent"
dispatch.earliest_time = -24h@h
alert.track = 0

[Mshta Remotely Hosted HTA File Execution - winevent]
description = Detects execution of the 'mshta' utility with an argument containing the 'http' keyword, which could indicate that an attacker is executing a remotely hosted malicious hta file
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\mshta.exe" OR OriginalFileName="MSHTA.EXE") (Process_Command_Line="*http://*" OR Process_Command_Line="*https://*" OR Process_Command_Line="*ftp://*"))) | eval sigma_attack_tags="attack.defense_evasion attack.execution attack.t1218.005" | eval sigma_title="Mshta Remotely Hosted HTA File Execution" | eval sigma_description="Detects execution of the 'mshta' utility with an argument containing the 'http' keyword, which could indicate that an attacker is executing a remotely hosted malicious hta file"
dispatch.earliest_time = -24h@h
alert.track = 0

[Mshta Remotely Hosted HTA File Execution - sysmon]
description = Detects execution of the 'mshta' utility with an argument containing the 'http' keyword, which could indicate that an attacker is executing a remotely hosted malicious hta file
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\mshta.exe" OR OriginalFileName="MSHTA.EXE") (CommandLine="*http://*" OR CommandLine="*https://*" OR CommandLine="*ftp://*"))) | eval sigma_attack_tags="attack.defense_evasion attack.execution attack.t1218.005" | eval sigma_title="Mshta Remotely Hosted HTA File Execution" | eval sigma_description="Detects execution of the 'mshta' utility with an argument containing the 'http' keyword, which could indicate that an attacker is executing a remotely hosted malicious hta file"
dispatch.earliest_time = -24h@h
alert.track = 0

[Mshta JavaScript Execution - winevent]
description = Identifies suspicious mshta.exe commands.
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\mshta.exe" Process_Command_Line="*javascript*")) | table ComputerName,Account_Name,Process_Command_Line | eval sigma_attack_tags="attack.defense_evasion attack.t1218.005" | eval sigma_title="Mshta JavaScript Execution" | eval sigma_description="Identifies suspicious mshta.exe commands."
dispatch.earliest_time = -24h@h
alert.track = 0

[Mshta JavaScript Execution - sysmon]
description = Identifies suspicious mshta.exe commands.
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\mshta.exe" CommandLine="*javascript*")) | table ComputerName,User,CommandLine | eval sigma_attack_tags="attack.defense_evasion attack.t1218.005" | eval sigma_title="Mshta JavaScript Execution" | eval sigma_description="Identifies suspicious mshta.exe commands."
dispatch.earliest_time = -24h@h
alert.track = 0

[MSHTA Spawning Windows Shell - winevent]
description = Detects a Windows command line executable started from MSHTA
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) Creator_Process_Name="*\\mshta.exe" ((New_Process_Name="*\\cmd.exe" OR New_Process_Name="*\\powershell.exe" OR New_Process_Name="*\\pwsh.exe" OR New_Process_Name="*\\wscript.exe" OR New_Process_Name="*\\cscript.exe" OR New_Process_Name="*\\sh.exe" OR New_Process_Name="*\\bash.exe" OR New_Process_Name="*\\reg.exe" OR New_Process_Name="*\\regsvr32.exe") OR New_Process_Name="*\\BITSADMIN*"))) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.t1218.005 car.2013-02-003 car.2013-03-001 car.2014-04-003" | eval sigma_title="MSHTA Spawning Windows Shell" | eval sigma_description="Detects a Windows command line executable started from MSHTA"
dispatch.earliest_time = -24h@h
alert.track = 0

[MSHTA Spawning Windows Shell - sysmon]
description = Detects a Windows command line executable started from MSHTA
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ParentImage="*\\mshta.exe" ((Image="*\\cmd.exe" OR Image="*\\powershell.exe" OR Image="*\\pwsh.exe" OR Image="*\\wscript.exe" OR Image="*\\cscript.exe" OR Image="*\\sh.exe" OR Image="*\\bash.exe" OR Image="*\\reg.exe" OR Image="*\\regsvr32.exe") OR Image="*\\BITSADMIN*"))) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.t1218.005 car.2013-02-003 car.2013-03-001 car.2014-04-003" | eval sigma_title="MSHTA Spawning Windows Shell" | eval sigma_description="Detects a Windows command line executable started from MSHTA"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Msiexec Load DLL - winevent]
description = Detects MsiExec loading a DLL and calling its DllUnregisterServer function
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\msiexec.exe" (Process_Command_Line="* /z *" OR Process_Command_Line="* -z *") Process_Command_Line="*.dll*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1218.007" | eval sigma_title="Suspicious Msiexec Load DLL" | eval sigma_description="Detects MsiExec loading a DLL and calling its DllUnregisterServer function"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Msiexec Load DLL - sysmon]
description = Detects MsiExec loading a DLL and calling its DllUnregisterServer function
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\msiexec.exe" (CommandLine="* /z *" OR CommandLine="* -z *") CommandLine="*.dll*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1218.007" | eval sigma_title="Suspicious Msiexec Load DLL" | eval sigma_description="Detects MsiExec loading a DLL and calling its DllUnregisterServer function"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious MsiExec Embedding Parent - winevent]
description = Adversaries may abuse msiexec.exe to proxy the execution of malicious payloads
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((New_Process_Name="*\\powershell.exe" OR New_Process_Name="*\\pwsh.exe" OR New_Process_Name="*\\cmd.exe") ParentCommandLine="*MsiExec.exe*" ParentCommandLine="*-Embedding *")) NOT (((New_Process_Name="*:\\Windows\\System32\\cmd.exe" Process_Command_Line="*C:\\Program Files\\SplunkUniversalForwarder\\bin\\*")) OR ((Process_Command_Line="*\\DismFoDInstall.cmd*") OR ((ParentCommandLine="*\\MsiExec.exe -Embedding *" ParentCommandLine="*Global\\MSI0000*")))))) | eval sigma_attack_tags="attack.t1218.007 attack.defense_evasion" | eval sigma_title="Suspicious MsiExec Embedding Parent" | eval sigma_description="Adversaries may abuse msiexec.exe to proxy the execution of malicious payloads"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious MsiExec Embedding Parent - sysmon]
description = Adversaries may abuse msiexec.exe to proxy the execution of malicious payloads
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((Image="*\\powershell.exe" OR Image="*\\pwsh.exe" OR Image="*\\cmd.exe") ParentCommandLine="*MsiExec.exe*" ParentCommandLine="*-Embedding *")) NOT (((Image="*:\\Windows\\System32\\cmd.exe" CommandLine="*C:\\Program Files\\SplunkUniversalForwarder\\bin\\*")) OR ((CommandLine="*\\DismFoDInstall.cmd*") OR ((ParentCommandLine="*\\MsiExec.exe -Embedding *" ParentCommandLine="*Global\\MSI0000*")))))) | eval sigma_attack_tags="attack.t1218.007 attack.defense_evasion" | eval sigma_title="Suspicious MsiExec Embedding Parent" | eval sigma_description="Adversaries may abuse msiexec.exe to proxy the execution of malicious payloads"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Msiexec Execute Arbitrary DLL - winevent]
description = Adversaries may abuse msiexec.exe to proxy execution of malicious payloads.
Msiexec.exe is the command-line utility for the Windows Installer and is thus commonly associated with executing installation packages (.msi)

search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\msiexec.exe" (Process_Command_Line="* /y*" OR Process_Command_Line="* -y*"))) NOT ((((Process_Command_Line="*\\MsiExec.exe\" /Y \"C:\\Program Files\\Bonjour\\mdnsNSP.dll*" OR Process_Command_Line="*\\MsiExec.exe\" /Y \"C:\\Program Files (x86)\\Bonjour\\mdnsNSP.dll*" OR Process_Command_Line="*\\MsiExec.exe\" /Y \"C:\\Program Files (x86)\\Apple Software Update\\ScriptingObjectModel.dll*" OR Process_Command_Line="*\\MsiExec.exe\" /Y \"C:\\Program Files (x86)\\Apple Software Update\\SoftwareUpdateAdmin.dll*" OR Process_Command_Line="*\\MsiExec.exe\" /Y \"C:\\Windows\\CCM\\*" OR Process_Command_Line="*\\MsiExec.exe\" /Y C:\\Windows\\CCM\\*" OR Process_Command_Line="*\\MsiExec.exe\" -Y \"C:\\Program Files\\Bonjour\\mdnsNSP.dll*" OR Process_Command_Line="*\\MsiExec.exe\" -Y \"C:\\Program Files (x86)\\Bonjour\\mdnsNSP.dll*" OR Process_Command_Line="*\\MsiExec.exe\" -Y \"C:\\Program Files (x86)\\Apple Software Update\\ScriptingObjectModel.dll*" OR Process_Command_Line="*\\MsiExec.exe\" -Y \"C:\\Program Files (x86)\\Apple Software Update\\SoftwareUpdateAdmin.dll*" OR Process_Command_Line="*\\MsiExec.exe\" -Y \"C:\\Windows\\CCM\\*" OR Process_Command_Line="*\\MsiExec.exe\" -Y C:\\Windows\\CCM\\*")))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218.007" | eval sigma_title="Suspicious Msiexec Execute Arbitrary DLL" | eval sigma_description="Adversaries may abuse msiexec.exe to proxy execution of malicious payloads.
Msiexec.exe is the command-line utility for the Windows Installer and is thus commonly associated with executing installation packages (.msi)
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Msiexec Execute Arbitrary DLL - sysmon]
description = Adversaries may abuse msiexec.exe to proxy execution of malicious payloads.
Msiexec.exe is the command-line utility for the Windows Installer and is thus commonly associated with executing installation packages (.msi)

search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\msiexec.exe" (CommandLine="* /y*" OR CommandLine="* -y*"))) NOT ((((CommandLine="*\\MsiExec.exe\" /Y \"C:\\Program Files\\Bonjour\\mdnsNSP.dll*" OR CommandLine="*\\MsiExec.exe\" /Y \"C:\\Program Files (x86)\\Bonjour\\mdnsNSP.dll*" OR CommandLine="*\\MsiExec.exe\" /Y \"C:\\Program Files (x86)\\Apple Software Update\\ScriptingObjectModel.dll*" OR CommandLine="*\\MsiExec.exe\" /Y \"C:\\Program Files (x86)\\Apple Software Update\\SoftwareUpdateAdmin.dll*" OR CommandLine="*\\MsiExec.exe\" /Y \"C:\\Windows\\CCM\\*" OR CommandLine="*\\MsiExec.exe\" /Y C:\\Windows\\CCM\\*" OR CommandLine="*\\MsiExec.exe\" -Y \"C:\\Program Files\\Bonjour\\mdnsNSP.dll*" OR CommandLine="*\\MsiExec.exe\" -Y \"C:\\Program Files (x86)\\Bonjour\\mdnsNSP.dll*" OR CommandLine="*\\MsiExec.exe\" -Y \"C:\\Program Files (x86)\\Apple Software Update\\ScriptingObjectModel.dll*" OR CommandLine="*\\MsiExec.exe\" -Y \"C:\\Program Files (x86)\\Apple Software Update\\SoftwareUpdateAdmin.dll*" OR CommandLine="*\\MsiExec.exe\" -Y \"C:\\Windows\\CCM\\*" OR CommandLine="*\\MsiExec.exe\" -Y C:\\Windows\\CCM\\*")))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218.007" | eval sigma_title="Suspicious Msiexec Execute Arbitrary DLL" | eval sigma_description="Adversaries may abuse msiexec.exe to proxy execution of malicious payloads.
Msiexec.exe is the command-line utility for the Windows Installer and is thus commonly associated with executing installation packages (.msi)
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Msiexec Quiet Install - winevent]
description = Adversaries may abuse msiexec.exe to proxy execution of malicious payloads.
Msiexec.exe is the command-line utility for the Windows Installer and is thus commonly associated with executing installation packages (.msi)

search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((New_Process_Name="*\\msiexec.exe" OR OriginalFileName="msiexec.exe") (Process_Command_Line="*/i*" OR Process_Command_Line="*-i*" OR Process_Command_Line="*/package*" OR Process_Command_Line="*-package*" OR Process_Command_Line="*/a*" OR Process_Command_Line="*-a*" OR Process_Command_Line="*/j*" OR Process_Command_Line="*-j*") (Process_Command_Line="*/q*" OR Process_Command_Line="*-q*"))) NOT (((Creator_Process_Name="C:\\Users\\*" Creator_Process_Name="*\\AppData\\Local\\Temp\\*")) OR ((Creator_Process_Name="C:\\Windows\\Temp\\*")) OR ((Creator_Process_Name="C:\\Windows\\CCM\\Ccm32BitLauncher.exe" IntegrityLevel="System"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218.007" | eval sigma_title="Suspicious Msiexec Quiet Install" | eval sigma_description="Adversaries may abuse msiexec.exe to proxy execution of malicious payloads.
Msiexec.exe is the command-line utility for the Windows Installer and is thus commonly associated with executing installation packages (.msi)
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Msiexec Quiet Install - sysmon]
description = Adversaries may abuse msiexec.exe to proxy execution of malicious payloads.
Msiexec.exe is the command-line utility for the Windows Installer and is thus commonly associated with executing installation packages (.msi)

search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((Image="*\\msiexec.exe" OR OriginalFileName="msiexec.exe") (CommandLine="*/i*" OR CommandLine="*-i*" OR CommandLine="*/package*" OR CommandLine="*-package*" OR CommandLine="*/a*" OR CommandLine="*-a*" OR CommandLine="*/j*" OR CommandLine="*-j*") (CommandLine="*/q*" OR CommandLine="*-q*"))) NOT (((ParentImage="C:\\Users\\*" ParentImage="*\\AppData\\Local\\Temp\\*")) OR ((ParentImage="C:\\Windows\\Temp\\*")) OR ((ParentImage="C:\\Windows\\CCM\\Ccm32BitLauncher.exe" IntegrityLevel="System"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218.007" | eval sigma_title="Suspicious Msiexec Quiet Install" | eval sigma_description="Adversaries may abuse msiexec.exe to proxy execution of malicious payloads.
Msiexec.exe is the command-line utility for the Windows Installer and is thus commonly associated with executing installation packages (.msi)
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Msiexec Quiet Install From Remote Location - winevent]
description = Detects usage of Msiexec.exe to install packages hosted remotely quietly
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\msiexec.exe" OR OriginalFileName="msiexec.exe") (Process_Command_Line="*/i*" OR Process_Command_Line="*-i*" OR Process_Command_Line="*/package*" OR Process_Command_Line="*-package*" OR Process_Command_Line="*/a*" OR Process_Command_Line="*-a*" OR Process_Command_Line="*/j*" OR Process_Command_Line="*-j*") (Process_Command_Line="*/q*" OR Process_Command_Line="*-q*") (Process_Command_Line="*http*" OR Process_Command_Line="*\\\\\*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218.007" | eval sigma_title="Suspicious Msiexec Quiet Install From Remote Location" | eval sigma_description="Detects usage of Msiexec.exe to install packages hosted remotely quietly"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Msiexec Quiet Install From Remote Location - sysmon]
description = Detects usage of Msiexec.exe to install packages hosted remotely quietly
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\msiexec.exe" OR OriginalFileName="msiexec.exe") (CommandLine="*/i*" OR CommandLine="*-i*" OR CommandLine="*/package*" OR CommandLine="*-package*" OR CommandLine="*/a*" OR CommandLine="*-a*" OR CommandLine="*/j*" OR CommandLine="*-j*") (CommandLine="*/q*" OR CommandLine="*-q*") (CommandLine="*http*" OR CommandLine="*\\\\\*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218.007" | eval sigma_title="Suspicious Msiexec Quiet Install From Remote Location" | eval sigma_description="Detects usage of Msiexec.exe to install packages hosted remotely quietly"
dispatch.earliest_time = -24h@h
alert.track = 0

[Msra.exe Process Injection - winevent]
description = Detects process injection using Microsoft Remote Asssistance (Msra.exe) which has been used for discovery and persistence tactics
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Creator_Process_Name="*\\msra.exe" ParentCommandLine="*msra.exe" (New_Process_Name="*\\arp.exe" OR New_Process_Name="*\\cmd.exe" OR New_Process_Name="*\\net.exe" OR New_Process_Name="*\\netstat.exe" OR New_Process_Name="*\\nslookup.exe" OR New_Process_Name="*\\route.exe" OR New_Process_Name="*\\schtasks.exe" OR New_Process_Name="*\\whoami.exe"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1055" | eval sigma_title="Msra.exe Process Injection" | eval sigma_description="Detects process injection using Microsoft Remote Asssistance (Msra.exe) which has been used for discovery and persistence tactics"
dispatch.earliest_time = -24h@h
alert.track = 0

[Msra.exe Process Injection - sysmon]
description = Detects process injection using Microsoft Remote Asssistance (Msra.exe) which has been used for discovery and persistence tactics
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") ParentImage="*\\msra.exe" ParentCommandLine="*msra.exe" (Image="*\\arp.exe" OR Image="*\\cmd.exe" OR Image="*\\net.exe" OR Image="*\\netstat.exe" OR Image="*\\nslookup.exe" OR Image="*\\route.exe" OR Image="*\\schtasks.exe" OR Image="*\\whoami.exe"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1055" | eval sigma_title="Msra.exe Process Injection" | eval sigma_description="Detects process injection using Microsoft Remote Asssistance (Msra.exe) which has been used for discovery and persistence tactics"
dispatch.earliest_time = -24h@h
alert.track = 0

[Quick Execution of a Series of Suspicious Commands - winevent]
description = Detects multiple suspicious process in a limited timeframe
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (Process_Command_Line="*arp.exe*" OR Process_Command_Line="*at.exe*" OR Process_Command_Line="*attrib.exe*" OR Process_Command_Line="*cscript.exe*" OR Process_Command_Line="*dsquery.exe*" OR Process_Command_Line="*hostname.exe*" OR Process_Command_Line="*ipconfig.exe*" OR Process_Command_Line="*mimikatz.exe*" OR Process_Command_Line="*nbtstat.exe*" OR Process_Command_Line="*net.exe*" OR Process_Command_Line="*netsh.exe*" OR Process_Command_Line="*nslookup.exe*" OR Process_Command_Line="*ping.exe*" OR Process_Command_Line="*quser.exe*" OR Process_Command_Line="*qwinsta.exe*" OR Process_Command_Line="*reg.exe*" OR Process_Command_Line="*runas.exe*" OR Process_Command_Line="*sc.exe*" OR Process_Command_Line="*schtasks.exe*" OR Process_Command_Line="*ssh.exe*" OR Process_Command_Line="*systeminfo.exe*" OR Process_Command_Line="*taskkill.exe*" OR Process_Command_Line="*telnet.exe*" OR Process_Command_Line="*tracert.exe*" OR Process_Command_Line="*wscript.exe*" OR Process_Command_Line="*xcopy.exe*" OR Process_Command_Line="*pscp.exe*" OR Process_Command_Line="*copy.exe*" OR Process_Command_Line="*robocopy.exe*" OR Process_Command_Line="*certutil.exe*" OR Process_Command_Line="*vssadmin.exe*" OR Process_Command_Line="*powershell.exe*" OR Process_Command_Line="*pwsh.exe*" OR Process_Command_Line="*wevtutil.exe*" OR Process_Command_Line="*psexec.exe*" OR Process_Command_Line="*bcedit.exe*" OR Process_Command_Line="*wbadmin.exe*" OR Process_Command_Line="*icacls.exe*" OR Process_Command_Line="*diskpart.exe*"))) | eventstats count as val by MachineName| search val > 5 | eval sigma_attack_tags="car.2013-04-002 attack.execution attack.t1059" | eval sigma_title="Quick Execution of a Series of Suspicious Commands" | eval sigma_description="Detects multiple suspicious process in a limited timeframe"
dispatch.earliest_time = -24h@h
alert.track = 0

[Quick Execution of a Series of Suspicious Commands - sysmon]
description = Detects multiple suspicious process in a limited timeframe
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (CommandLine="*arp.exe*" OR CommandLine="*at.exe*" OR CommandLine="*attrib.exe*" OR CommandLine="*cscript.exe*" OR CommandLine="*dsquery.exe*" OR CommandLine="*hostname.exe*" OR CommandLine="*ipconfig.exe*" OR CommandLine="*mimikatz.exe*" OR CommandLine="*nbtstat.exe*" OR CommandLine="*net.exe*" OR CommandLine="*netsh.exe*" OR CommandLine="*nslookup.exe*" OR CommandLine="*ping.exe*" OR CommandLine="*quser.exe*" OR CommandLine="*qwinsta.exe*" OR CommandLine="*reg.exe*" OR CommandLine="*runas.exe*" OR CommandLine="*sc.exe*" OR CommandLine="*schtasks.exe*" OR CommandLine="*ssh.exe*" OR CommandLine="*systeminfo.exe*" OR CommandLine="*taskkill.exe*" OR CommandLine="*telnet.exe*" OR CommandLine="*tracert.exe*" OR CommandLine="*wscript.exe*" OR CommandLine="*xcopy.exe*" OR CommandLine="*pscp.exe*" OR CommandLine="*copy.exe*" OR CommandLine="*robocopy.exe*" OR CommandLine="*certutil.exe*" OR CommandLine="*vssadmin.exe*" OR CommandLine="*powershell.exe*" OR CommandLine="*pwsh.exe*" OR CommandLine="*wevtutil.exe*" OR CommandLine="*psexec.exe*" OR CommandLine="*bcedit.exe*" OR CommandLine="*wbadmin.exe*" OR CommandLine="*icacls.exe*" OR CommandLine="*diskpart.exe*"))) | eventstats count as val by MachineName| search val > 5 | eval sigma_attack_tags="car.2013-04-002 attack.execution attack.t1059" | eval sigma_title="Quick Execution of a Series of Suspicious Commands" | eval sigma_description="Detects multiple suspicious process in a limited timeframe"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Manipulation Of Default Accounts - winevent]
description = Detects suspicious manipulations of default accounts such as 'administrator' and 'guest'. For example 'enable' or 'disable' accounts or change the password...etc
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((New_Process_Name="*\\net.exe" OR New_Process_Name="*\\net1.exe") Process_Command_Line="* user *" (Process_Command_Line="* Järjestelmänvalvoja *" OR Process_Command_Line="* Rendszergazda *" OR Process_Command_Line="* Администратор *" OR Process_Command_Line="* Administrateur *" OR Process_Command_Line="* Administrador *" OR Process_Command_Line="* Administratör *" OR Process_Command_Line="* Administrator *" OR Process_Command_Line="* guest *" OR Process_Command_Line="* DefaultAccount *" OR Process_Command_Line="* \"Järjestelmänvalvoja\" *" OR Process_Command_Line="* \"Rendszergazda\" *" OR Process_Command_Line="* \"Администратор\" *" OR Process_Command_Line="* \"Administrateur\" *" OR Process_Command_Line="* \"Administrador\" *" OR Process_Command_Line="* \"Administratör\" *" OR Process_Command_Line="* \"Administrator\" *" OR Process_Command_Line="* \"guest\" *" OR Process_Command_Line="* \"DefaultAccount\" *" OR Process_Command_Line="* 'Järjestelmänvalvoja' *" OR Process_Command_Line="* 'Rendszergazda' *" OR Process_Command_Line="* 'Администратор' *" OR Process_Command_Line="* 'Administrateur' *" OR Process_Command_Line="* 'Administrador' *" OR Process_Command_Line="* 'Administratör' *" OR Process_Command_Line="* 'Administrator' *" OR Process_Command_Line="* 'guest' *" OR Process_Command_Line="* 'DefaultAccount' *"))) NOT (((Process_Command_Line="*guest*" Process_Command_Line="*/active no*"))))) | eval sigma_attack_tags="attack.collection attack.t1560.001" | eval sigma_title="Suspicious Manipulation Of Default Accounts" | eval sigma_description="Detects suspicious manipulations of default accounts such as 'administrator' and 'guest'. For example 'enable' or 'disable' accounts or change the password...etc"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Manipulation Of Default Accounts - sysmon]
description = Detects suspicious manipulations of default accounts such as 'administrator' and 'guest'. For example 'enable' or 'disable' accounts or change the password...etc
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((Image="*\\net.exe" OR Image="*\\net1.exe") CommandLine="* user *" (CommandLine="* Järjestelmänvalvoja *" OR CommandLine="* Rendszergazda *" OR CommandLine="* Администратор *" OR CommandLine="* Administrateur *" OR CommandLine="* Administrador *" OR CommandLine="* Administratör *" OR CommandLine="* Administrator *" OR CommandLine="* guest *" OR CommandLine="* DefaultAccount *" OR CommandLine="* \"Järjestelmänvalvoja\" *" OR CommandLine="* \"Rendszergazda\" *" OR CommandLine="* \"Администратор\" *" OR CommandLine="* \"Administrateur\" *" OR CommandLine="* \"Administrador\" *" OR CommandLine="* \"Administratör\" *" OR CommandLine="* \"Administrator\" *" OR CommandLine="* \"guest\" *" OR CommandLine="* \"DefaultAccount\" *" OR CommandLine="* 'Järjestelmänvalvoja' *" OR CommandLine="* 'Rendszergazda' *" OR CommandLine="* 'Администратор' *" OR CommandLine="* 'Administrateur' *" OR CommandLine="* 'Administrador' *" OR CommandLine="* 'Administratör' *" OR CommandLine="* 'Administrator' *" OR CommandLine="* 'guest' *" OR CommandLine="* 'DefaultAccount' *"))) NOT (((CommandLine="*guest*" CommandLine="*/active no*"))))) | eval sigma_attack_tags="attack.collection attack.t1560.001" | eval sigma_title="Suspicious Manipulation Of Default Accounts" | eval sigma_description="Detects suspicious manipulations of default accounts such as 'administrator' and 'guest'. For example 'enable' or 'disable' accounts or change the password...etc"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Group And Account Reconnaissance Activity Using Net.EXE - winevent]
description = Detects suspicious reconnaissance command line activity on Windows systems using Net.EXE
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\net.exe" OR New_Process_Name="*\\net1.exe") OR (OriginalFileName="net.exe" OR OriginalFileName="net1.exe")) ((((Process_Command_Line="* group *" OR Process_Command_Line="* localgroup *") (Process_Command_Line="*domain admins*" OR Process_Command_Line="* administrator*" OR Process_Command_Line="* administrateur*" OR Process_Command_Line="*enterprise admins*" OR Process_Command_Line="*Exchange Trusted Subsystem*" OR Process_Command_Line="*Remote Desktop Users*" OR Process_Command_Line="*Utilisateurs du Bureau à distance*" OR Process_Command_Line="*Usuarios de escritorio remoto*" OR Process_Command_Line="* /do*"))) OR ((Process_Command_Line="* accounts *" Process_Command_Line="* /do*"))))) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.discovery attack.t1087.001 attack.t1087.002" | eval sigma_title="Suspicious Group And Account Reconnaissance Activity Using Net.EXE" | eval sigma_description="Detects suspicious reconnaissance command line activity on Windows systems using Net.EXE"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Group And Account Reconnaissance Activity Using Net.EXE - sysmon]
description = Detects suspicious reconnaissance command line activity on Windows systems using Net.EXE
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\net.exe" OR Image="*\\net1.exe") OR (OriginalFileName="net.exe" OR OriginalFileName="net1.exe")) ((((CommandLine="* group *" OR CommandLine="* localgroup *") (CommandLine="*domain admins*" OR CommandLine="* administrator*" OR CommandLine="* administrateur*" OR CommandLine="*enterprise admins*" OR CommandLine="*Exchange Trusted Subsystem*" OR CommandLine="*Remote Desktop Users*" OR CommandLine="*Utilisateurs du Bureau à distance*" OR CommandLine="*Usuarios de escritorio remoto*" OR CommandLine="* /do*"))) OR ((CommandLine="* accounts *" CommandLine="* /do*"))))) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.discovery attack.t1087.001 attack.t1087.002" | eval sigma_title="Suspicious Group And Account Reconnaissance Activity Using Net.EXE" | eval sigma_description="Detects suspicious reconnaissance command line activity on Windows systems using Net.EXE"
dispatch.earliest_time = -24h@h
alert.track = 0

[Share And Session Enumeration Using Net.EXE - winevent]
description = Detects attempts to enumerate file shares, printer shares and sessions using 'net.exe' with the 'view' flag.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((New_Process_Name="*\\net.exe" OR New_Process_Name="*\\net1.exe") Process_Command_Line="*view*")) NOT ((Process_Command_Line="*\\\\\*")))) | table ComputerName,Account_Name,Process_Command_Line | eval sigma_attack_tags="attack.discovery attack.t1018" | eval sigma_title="Share And Session Enumeration Using Net.EXE" | eval sigma_description="Detects attempts to enumerate file shares, printer shares and sessions using 'net.exe' with the 'view' flag."
dispatch.earliest_time = -24h@h
alert.track = 0

[Share And Session Enumeration Using Net.EXE - sysmon]
description = Detects attempts to enumerate file shares, printer shares and sessions using 'net.exe' with the 'view' flag.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((Image="*\\net.exe" OR Image="*\\net1.exe") CommandLine="*view*")) NOT ((CommandLine="*\\\\\*")))) | table ComputerName,User,CommandLine | eval sigma_attack_tags="attack.discovery attack.t1018" | eval sigma_title="Share And Session Enumeration Using Net.EXE" | eval sigma_description="Detects attempts to enumerate file shares, printer shares and sessions using 'net.exe' with the 'view' flag."
dispatch.earliest_time = -24h@h
alert.track = 0

[Services Started Via Net.EXE - winevent]
description = Detects the usage of the 'net.exe' command to start a service using the 'start' flag
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (New_Process_Name="*\\net.exe" OR New_Process_Name="*\\net1.exe") Process_Command_Line="* start *")) | eval sigma_attack_tags="attack.execution attack.t1569.002" | eval sigma_title="Services Started Via Net.EXE" | eval sigma_description="Detects the usage of the 'net.exe' command to start a service using the 'start' flag"
dispatch.earliest_time = -24h@h
alert.track = 0

[Services Started Via Net.EXE - sysmon]
description = Detects the usage of the 'net.exe' command to start a service using the 'start' flag
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (Image="*\\net.exe" OR Image="*\\net1.exe") CommandLine="* start *")) | eval sigma_attack_tags="attack.execution attack.t1569.002" | eval sigma_title="Services Started Via Net.EXE" | eval sigma_description="Detects the usage of the 'net.exe' command to start a service using the 'start' flag"
dispatch.earliest_time = -24h@h
alert.track = 0

[Windows Admin Share Mounted Via Net.EXE - winevent]
description = Detects when an admin share is mounted using net.exe
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (New_Process_Name="*\\net.exe" OR New_Process_Name="*\\net1.exe") Process_Command_Line="* use *" Process_Command_Line="* \\\\*\\*$*")) | eval sigma_attack_tags="attack.lateral_movement attack.t1021.002" | eval sigma_title="Windows Admin Share Mounted Via Net.EXE" | eval sigma_description="Detects when an admin share is mounted using net.exe"
dispatch.earliest_time = -24h@h
alert.track = 0

[Windows Admin Share Mounted Via Net.EXE - sysmon]
description = Detects when an admin share is mounted using net.exe
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (Image="*\\net.exe" OR Image="*\\net1.exe") CommandLine="* use *" CommandLine="* \\\\*\\*$*")) | eval sigma_attack_tags="attack.lateral_movement attack.t1021.002" | eval sigma_title="Windows Admin Share Mounted Via Net.EXE" | eval sigma_description="Detects when an admin share is mounted using net.exe"
dispatch.earliest_time = -24h@h
alert.track = 0

[Windows Share Mounted Via Net.EXE - winevent]
description = Detects when a share is mounted using the 'net.exe' utility
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (New_Process_Name="*\\net.exe" OR New_Process_Name="*\\net1.exe") (Process_Command_Line="* use *" OR Process_Command_Line="* \\\\\*"))) | eval sigma_attack_tags="attack.lateral_movement attack.t1021.002" | eval sigma_title="Windows Share Mounted Via Net.EXE" | eval sigma_description="Detects when a share is mounted using the 'net.exe' utility"
dispatch.earliest_time = -24h@h
alert.track = 0

[Windows Share Mounted Via Net.EXE - sysmon]
description = Detects when a share is mounted using the 'net.exe' utility
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (Image="*\\net.exe" OR Image="*\\net1.exe") (CommandLine="* use *" OR CommandLine="* \\\\\*"))) | eval sigma_attack_tags="attack.lateral_movement attack.t1021.002" | eval sigma_title="Windows Share Mounted Via Net.EXE" | eval sigma_description="Detects when a share is mounted using the 'net.exe' utility"
dispatch.earliest_time = -24h@h
alert.track = 0

[New User Created Via Net.EXE With Never Expire Option - winevent]
description = Detects creation of local users via the net.exe command with the option 'never expire'
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (New_Process_Name="*\\net.exe" OR New_Process_Name="*\\net1.exe") Process_Command_Line="*user*" Process_Command_Line="*add*" Process_Command_Line="*expires:never*")) | eval sigma_attack_tags="attack.persistence attack.t1136.001" | eval sigma_title="New User Created Via Net.EXE With Never Expire Option" | eval sigma_description="Detects creation of local users via the net.exe command with the option 'never expire'"
dispatch.earliest_time = -24h@h
alert.track = 0

[New User Created Via Net.EXE With Never Expire Option - sysmon]
description = Detects creation of local users via the net.exe command with the option 'never expire'
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (Image="*\\net.exe" OR Image="*\\net1.exe") CommandLine="*user*" CommandLine="*add*" CommandLine="*expires:never*")) | eval sigma_attack_tags="attack.persistence attack.t1136.001" | eval sigma_title="New User Created Via Net.EXE With Never Expire Option" | eval sigma_description="Detects creation of local users via the net.exe command with the option 'never expire'"
dispatch.earliest_time = -24h@h
alert.track = 0

[New User Created Via Net.EXE - winevent]
description = Identifies the creation of local users via the net.exe command.
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (New_Process_Name="*\\net.exe" OR New_Process_Name="*\\net1.exe") Process_Command_Line="*user*" Process_Command_Line="*add*")) | table ComputerName,Account_Name,Process_Command_Line | eval sigma_attack_tags="attack.persistence attack.t1136.001" | eval sigma_title="New User Created Via Net.EXE" | eval sigma_description="Identifies the creation of local users via the net.exe command."
dispatch.earliest_time = -24h@h
alert.track = 0

[New User Created Via Net.EXE - sysmon]
description = Identifies the creation of local users via the net.exe command.
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (Image="*\\net.exe" OR Image="*\\net1.exe") CommandLine="*user*" CommandLine="*add*")) | table ComputerName,User,CommandLine | eval sigma_attack_tags="attack.persistence attack.t1136.001" | eval sigma_title="New User Created Via Net.EXE" | eval sigma_description="Identifies the creation of local users via the net.exe command."
dispatch.earliest_time = -24h@h
alert.track = 0

[Netcat Suspicious Execution - winevent]
description = Detects execution of Netcat. Adversaries may use a non-application layer protocol for communication between host and C2 server or among infected hosts within a network
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\nc.exe" OR New_Process_Name="*\\ncat.exe" OR New_Process_Name="*\\netcat.exe") OR (Process_Command_Line="* -lvp *" OR Process_Command_Line="* -lvnp*" OR Process_Command_Line="* -l -v -p *" OR Process_Command_Line="* -lv -p *" OR Process_Command_Line="* -l --proxy-type http *" OR Process_Command_Line="* -vnl --exec *" OR Process_Command_Line="* -vnl -e *" OR Process_Command_Line="* --lua-exec *" OR Process_Command_Line="* --sh-exec *")))) | eval sigma_attack_tags="attack.command_and_control attack.t1095" | eval sigma_title="Netcat Suspicious Execution" | eval sigma_description="Detects execution of Netcat. Adversaries may use a non-application layer protocol for communication between host and C2 server or among infected hosts within a network"
dispatch.earliest_time = -24h@h
alert.track = 0

[Netcat Suspicious Execution - sysmon]
description = Detects execution of Netcat. Adversaries may use a non-application layer protocol for communication between host and C2 server or among infected hosts within a network
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\nc.exe" OR Image="*\\ncat.exe" OR Image="*\\netcat.exe") OR (CommandLine="* -lvp *" OR CommandLine="* -lvnp*" OR CommandLine="* -l -v -p *" OR CommandLine="* -lv -p *" OR CommandLine="* -l --proxy-type http *" OR CommandLine="* -vnl --exec *" OR CommandLine="* -vnl -e *" OR CommandLine="* --lua-exec *" OR CommandLine="* --sh-exec *")))) | eval sigma_attack_tags="attack.command_and_control attack.t1095" | eval sigma_title="Netcat Suspicious Execution" | eval sigma_description="Detects execution of Netcat. Adversaries may use a non-application layer protocol for communication between host and C2 server or among infected hosts within a network"
dispatch.earliest_time = -24h@h
alert.track = 0

[Netsh RDP Port Opening - winevent]
description = Detects netsh commands that opens the port 3389 used for RDP, used in Sarwent Malware
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((Process_Command_Line="*netsh*" Process_Command_Line="*firewall add portopening*" Process_Command_Line="*tcp 3389*")) OR ((Process_Command_Line="*netsh*" Process_Command_Line="*advfirewall firewall add rule*" Process_Command_Line="*action=allow*" Process_Command_Line="*protocol=TCP*" Process_Command_Line="*localport=3389*"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.004" | eval sigma_title="Netsh RDP Port Opening" | eval sigma_description="Detects netsh commands that opens the port 3389 used for RDP, used in Sarwent Malware"
dispatch.earliest_time = -24h@h
alert.track = 0

[Netsh RDP Port Opening - sysmon]
description = Detects netsh commands that opens the port 3389 used for RDP, used in Sarwent Malware
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((CommandLine="*netsh*" CommandLine="*firewall add portopening*" CommandLine="*tcp 3389*")) OR ((CommandLine="*netsh*" CommandLine="*advfirewall firewall add rule*" CommandLine="*action=allow*" CommandLine="*protocol=TCP*" CommandLine="*localport=3389*"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.004" | eval sigma_title="Netsh RDP Port Opening" | eval sigma_description="Detects netsh commands that opens the port 3389 used for RDP, used in Sarwent Malware"
dispatch.earliest_time = -24h@h
alert.track = 0

[Netsh Program Allowed with Suspcious Location - winevent]
description = Detects Netsh commands that allows a suspcious application location on Windows Firewall
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((New_Process_Name="*\\netsh.exe" Process_Command_Line="*firewall*" Process_Command_Line="*add*" Process_Command_Line="*allowedprogram*")) OR ((New_Process_Name="*\\netsh.exe" Process_Command_Line="*advfirewall*" Process_Command_Line="*firewall*" Process_Command_Line="*add*" Process_Command_Line="*rule*" Process_Command_Line="*action=allow*" Process_Command_Line="*program=*"))) ((Process_Command_Line="*%TEMP%*" OR Process_Command_Line="*%TMP%*" OR Process_Command_Line="*:\\RECYCLER\\*" OR Process_Command_Line="*C:\\$Recycle.bin\\*" OR Process_Command_Line="*:\\SystemVolumeInformation\\*" OR Process_Command_Line="*C:\\Windows\\Temp\\*" OR Process_Command_Line="*C:\\Temp\\*" OR Process_Command_Line="*C:\\Users\\Public\\*" OR Process_Command_Line="*C:\\Users\\Default\\*" OR Process_Command_Line="*C:\\Users\\Desktop\\*" OR Process_Command_Line="*\\Downloads\\*" OR Process_Command_Line="*\\Temporary Internet Files\\Content.Outlook\\*" OR Process_Command_Line="*\\Local Settings\\Temporary Internet Files\\*") OR (Process_Command_Line="C:\\Windows\\Tasks\\*" OR Process_Command_Line="C:\\Windows\\debug\\*" OR Process_Command_Line="C:\\Windows\\fonts\\*" OR Process_Command_Line="C:\\Windows\\help\\*" OR Process_Command_Line="C:\\Windows\\drivers\\*" OR Process_Command_Line="C:\\Windows\\addins\\*" OR Process_Command_Line="C:\\Windows\\cursors\\*" OR Process_Command_Line="C:\\Windows\\system32\\tasks\\*" OR Process_Command_Line="%Public%\\*")))) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.004" | eval sigma_title="Netsh Program Allowed with Suspcious Location" | eval sigma_description="Detects Netsh commands that allows a suspcious application location on Windows Firewall"
dispatch.earliest_time = -24h@h
alert.track = 0

[Netsh Program Allowed with Suspcious Location - sysmon]
description = Detects Netsh commands that allows a suspcious application location on Windows Firewall
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((Image="*\\netsh.exe" CommandLine="*firewall*" CommandLine="*add*" CommandLine="*allowedprogram*")) OR ((Image="*\\netsh.exe" CommandLine="*advfirewall*" CommandLine="*firewall*" CommandLine="*add*" CommandLine="*rule*" CommandLine="*action=allow*" CommandLine="*program=*"))) ((CommandLine="*%TEMP%*" OR CommandLine="*%TMP%*" OR CommandLine="*:\\RECYCLER\\*" OR CommandLine="*C:\\$Recycle.bin\\*" OR CommandLine="*:\\SystemVolumeInformation\\*" OR CommandLine="*C:\\Windows\\Temp\\*" OR CommandLine="*C:\\Temp\\*" OR CommandLine="*C:\\Users\\Public\\*" OR CommandLine="*C:\\Users\\Default\\*" OR CommandLine="*C:\\Users\\Desktop\\*" OR CommandLine="*\\Downloads\\*" OR CommandLine="*\\Temporary Internet Files\\Content.Outlook\\*" OR CommandLine="*\\Local Settings\\Temporary Internet Files\\*") OR (CommandLine="C:\\Windows\\Tasks\\*" OR CommandLine="C:\\Windows\\debug\\*" OR CommandLine="C:\\Windows\\fonts\\*" OR CommandLine="C:\\Windows\\help\\*" OR CommandLine="C:\\Windows\\drivers\\*" OR CommandLine="C:\\Windows\\addins\\*" OR CommandLine="C:\\Windows\\cursors\\*" OR CommandLine="C:\\Windows\\system32\\tasks\\*" OR CommandLine="%Public%\\*")))) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.004" | eval sigma_title="Netsh Program Allowed with Suspcious Location" | eval sigma_description="Detects Netsh commands that allows a suspcious application location on Windows Firewall"
dispatch.earliest_time = -24h@h
alert.track = 0

[Netsh Port or Application Allowed - winevent]
description = Allow Incoming Connections by Port or Application on Windows Firewall
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\netsh.exe" Process_Command_Line="*firewall*" Process_Command_Line="*add*")) NOT ((((Process_Command_Line="*\\netsh.exe advfirewall firewall add rule name=Dropbox dir=in action=allow \"program=C:\\Program Files (x86)\\Dropbox\\Client\\Dropbox.exe\" enable=yes profile=Any*" OR Process_Command_Line="*\\netsh.exe advfirewall firewall add rule name=Dropbox dir=in action=allow \"program=C:\\Program Files\\Dropbox\\Client\\Dropbox.exe\" enable=yes profile=Any*"))) OR ((Creator_Process_Name="C:\\Windows\\Temp\\asgard2-agent\\*" Creator_Process_Name="*\\thor64.exe" Process_Command_Line="*advfirewall firewall show rule name=all*"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.004" | eval sigma_title="Netsh Port or Application Allowed" | eval sigma_description="Allow Incoming Connections by Port or Application on Windows Firewall"
dispatch.earliest_time = -24h@h
alert.track = 0

[Netsh Port or Application Allowed - sysmon]
description = Allow Incoming Connections by Port or Application on Windows Firewall
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\netsh.exe" CommandLine="*firewall*" CommandLine="*add*")) NOT ((((CommandLine="*\\netsh.exe advfirewall firewall add rule name=Dropbox dir=in action=allow \"program=C:\\Program Files (x86)\\Dropbox\\Client\\Dropbox.exe\" enable=yes profile=Any*" OR CommandLine="*\\netsh.exe advfirewall firewall add rule name=Dropbox dir=in action=allow \"program=C:\\Program Files\\Dropbox\\Client\\Dropbox.exe\" enable=yes profile=Any*"))) OR ((ParentImage="C:\\Windows\\Temp\\asgard2-agent\\*" ParentImage="*\\thor64.exe" CommandLine="*advfirewall firewall show rule name=all*"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.004" | eval sigma_title="Netsh Port or Application Allowed" | eval sigma_description="Allow Incoming Connections by Port or Application on Windows Firewall"
dispatch.earliest_time = -24h@h
alert.track = 0

[Netsh Firewall Rule Deletion - winevent]
description = Detects the removal of a port or application rule in the Windows Firewall configuration using netsh
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\netsh.exe" Process_Command_Line="*firewall*" Process_Command_Line="*delete*")) NOT ((Creator_Process_Name="*\\Dropbox.exe" Process_Command_Line="*name=Dropbox*")))) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.004" | eval sigma_title="Netsh Firewall Rule Deletion" | eval sigma_description="Detects the removal of a port or application rule in the Windows Firewall configuration using netsh"
dispatch.earliest_time = -24h@h
alert.track = 0

[Netsh Firewall Rule Deletion - sysmon]
description = Detects the removal of a port or application rule in the Windows Firewall configuration using netsh
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\netsh.exe" CommandLine="*firewall*" CommandLine="*delete*")) NOT ((ParentImage="*\\Dropbox.exe" CommandLine="*name=Dropbox*")))) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.004" | eval sigma_title="Netsh Firewall Rule Deletion" | eval sigma_description="Detects the removal of a port or application rule in the Windows Firewall configuration using netsh"
dispatch.earliest_time = -24h@h
alert.track = 0

[Capture a Network Trace with netsh.exe - winevent]
description = Detects capture a network trace via netsh.exe trace functionality
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*netsh*" Process_Command_Line="*trace*" Process_Command_Line="*start*")) | eval sigma_attack_tags="attack.discovery attack.credential_access attack.t1040" | eval sigma_title="Capture a Network Trace with netsh.exe" | eval sigma_description="Detects capture a network trace via netsh.exe trace functionality"
dispatch.earliest_time = -24h@h
alert.track = 0

[Capture a Network Trace with netsh.exe - sysmon]
description = Detects capture a network trace via netsh.exe trace functionality
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*netsh*" CommandLine="*trace*" CommandLine="*start*")) | eval sigma_attack_tags="attack.discovery attack.credential_access attack.t1040" | eval sigma_title="Capture a Network Trace with netsh.exe" | eval sigma_description="Detects capture a network trace via netsh.exe trace functionality"
dispatch.earliest_time = -24h@h
alert.track = 0

[Netsh RDP Port Forwarding - winevent]
description = Detects netsh commands that configure a port forwarding of port 3389 used for RDP
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\netsh.exe" Process_Command_Line="* i*" Process_Command_Line="* p*" Process_Command_Line="*=3389*" Process_Command_Line="* c*")) | eval sigma_attack_tags="attack.lateral_movement attack.defense_evasion attack.command_and_control attack.t1090" | eval sigma_title="Netsh RDP Port Forwarding" | eval sigma_description="Detects netsh commands that configure a port forwarding of port 3389 used for RDP"
dispatch.earliest_time = -24h@h
alert.track = 0

[Netsh RDP Port Forwarding - sysmon]
description = Detects netsh commands that configure a port forwarding of port 3389 used for RDP
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\netsh.exe" CommandLine="* i*" CommandLine="* p*" CommandLine="*=3389*" CommandLine="* c*")) | eval sigma_attack_tags="attack.lateral_movement attack.defense_evasion attack.command_and_control attack.t1090" | eval sigma_title="Netsh RDP Port Forwarding" | eval sigma_description="Detects netsh commands that configure a port forwarding of port 3389 used for RDP"
dispatch.earliest_time = -24h@h
alert.track = 0

[Netsh Port Forwarding - winevent]
description = Detects netsh commands that configure a port forwarding (PortProxy)
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((New_Process_Name="*\\netsh.exe" Process_Command_Line="*interface*" Process_Command_Line="*portproxy*" Process_Command_Line="*add*" Process_Command_Line="*v4tov4*")) OR ((New_Process_Name="*\\netsh.exe" Process_Command_Line="*connectp*" Process_Command_Line="*listena*" Process_Command_Line="*c=*"))))) | eval sigma_attack_tags="attack.lateral_movement attack.defense_evasion attack.command_and_control attack.t1090" | eval sigma_title="Netsh Port Forwarding" | eval sigma_description="Detects netsh commands that configure a port forwarding (PortProxy)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Netsh Port Forwarding - sysmon]
description = Detects netsh commands that configure a port forwarding (PortProxy)
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((Image="*\\netsh.exe" CommandLine="*interface*" CommandLine="*portproxy*" CommandLine="*add*" CommandLine="*v4tov4*")) OR ((Image="*\\netsh.exe" CommandLine="*connectp*" CommandLine="*listena*" CommandLine="*c=*"))))) | eval sigma_attack_tags="attack.lateral_movement attack.defense_evasion attack.command_and_control attack.t1090" | eval sigma_title="Netsh Port Forwarding" | eval sigma_description="Detects netsh commands that configure a port forwarding (PortProxy)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Harvesting of Wifi Credentials Using netsh.exe - winevent]
description = Detect the harvesting of wifi credentials using netsh.exe
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\netsh.exe" Process_Command_Line="*wlan*" Process_Command_Line="* s*" Process_Command_Line="* p*" Process_Command_Line="* k*" Process_Command_Line="*=clear*")) | eval sigma_attack_tags="attack.discovery attack.credential_access attack.t1040" | eval sigma_title="Harvesting of Wifi Credentials Using netsh.exe" | eval sigma_description="Detect the harvesting of wifi credentials using netsh.exe"
dispatch.earliest_time = -24h@h
alert.track = 0

[Harvesting of Wifi Credentials Using netsh.exe - sysmon]
description = Detect the harvesting of wifi credentials using netsh.exe
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\netsh.exe" CommandLine="*wlan*" CommandLine="* s*" CommandLine="* p*" CommandLine="* k*" CommandLine="*=clear*")) | eval sigma_attack_tags="attack.discovery attack.credential_access attack.t1040" | eval sigma_title="Harvesting of Wifi Credentials Using netsh.exe" | eval sigma_description="Detect the harvesting of wifi credentials using netsh.exe"
dispatch.earliest_time = -24h@h
alert.track = 0

[Use of NetSupport Remote Access Software - winevent]
description = An adversary may use legitimate desktop support and remote access software, such as Team Viewer, Go2Assist, LogMein, AmmyyAdmin, etc, to establish an interactive command and control channel to target systems within networks.
These services are commonly used as legitimate technical support software, and may be allowed by application control within a target environment.
Remote access tools like VNC, Ammyy, and Teamviewer are used frequently when compared with other legitimate software commonly used by adversaries. (Citation: Symantec Living off the Land)

search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (Description="NetSupport Client Configurator" OR Product="NetSupport Remote Control" OR Company="NetSupport Ltd" OR OriginalFileName="PCICFGUI.EXE"))) | eval sigma_attack_tags="attack.command_and_control attack.t1219" | eval sigma_title="Use of NetSupport Remote Access Software" | eval sigma_description="An adversary may use legitimate desktop support and remote access software, such as Team Viewer, Go2Assist, LogMein, AmmyyAdmin, etc, to establish an interactive command and control channel to target systems within networks.
These services are commonly used as legitimate technical support software, and may be allowed by application control within a target environment.
Remote access tools like VNC, Ammyy, and Teamviewer are used frequently when compared with other legitimate software commonly used by adversaries. (Citation: Symantec Living off the Land)
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Use of NetSupport Remote Access Software - sysmon]
description = An adversary may use legitimate desktop support and remote access software, such as Team Viewer, Go2Assist, LogMein, AmmyyAdmin, etc, to establish an interactive command and control channel to target systems within networks.
These services are commonly used as legitimate technical support software, and may be allowed by application control within a target environment.
Remote access tools like VNC, Ammyy, and Teamviewer are used frequently when compared with other legitimate software commonly used by adversaries. (Citation: Symantec Living off the Land)

search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Description="NetSupport Client Configurator" OR Product="NetSupport Remote Control" OR Company="NetSupport Ltd" OR OriginalFileName="PCICFGUI.EXE"))) | eval sigma_attack_tags="attack.command_and_control attack.t1219" | eval sigma_title="Use of NetSupport Remote Access Software" | eval sigma_description="An adversary may use legitimate desktop support and remote access software, such as Team Viewer, Go2Assist, LogMein, AmmyyAdmin, etc, to establish an interactive command and control channel to target systems within networks.
These services are commonly used as legitimate technical support software, and may be allowed by application control within a target environment.
Remote access tools like VNC, Ammyy, and Teamviewer are used frequently when compared with other legitimate software commonly used by adversaries. (Citation: Symantec Living off the Land)
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Scan Loop Network - winevent]
description = Adversaries may attempt to get a listing of other systems by IP address, hostname, or other logical identifier on a network that may be used for Lateral Movement from the current system
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (Process_Command_Line="*for *" OR Process_Command_Line="*foreach *") (Process_Command_Line="*nslookup*" OR Process_Command_Line="*ping*"))) | eval sigma_attack_tags="attack.execution attack.t1059 attack.discovery attack.t1018" | eval sigma_title="Suspicious Scan Loop Network" | eval sigma_description="Adversaries may attempt to get a listing of other systems by IP address, hostname, or other logical identifier on a network that may be used for Lateral Movement from the current system"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Scan Loop Network - sysmon]
description = Adversaries may attempt to get a listing of other systems by IP address, hostname, or other logical identifier on a network that may be used for Lateral Movement from the current system
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (CommandLine="*for *" OR CommandLine="*foreach *") (CommandLine="*nslookup*" OR CommandLine="*ping*"))) | eval sigma_attack_tags="attack.execution attack.t1059 attack.discovery attack.t1018" | eval sigma_title="Suspicious Scan Loop Network" | eval sigma_description="Adversaries may attempt to get a listing of other systems by IP address, hostname, or other logical identifier on a network that may be used for Lateral Movement from the current system"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential Network Sniffing Activity Using Network Tools - winevent]
description = Detects potential network sniffing via use of network tools such as 'tshark', 'windump' or 'netsh'.
Network sniffing refers to using the network interface on a system to monitor or capture information sent over a wired or wireless connection.
An adversary may place a network interface into promiscuous mode to passively access data in transit over the network, or use span ports to capture a larger amount of data.

search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((New_Process_Name="*\\tshark.exe" Process_Command_Line="*-i*")) OR New_Process_Name="*\\windump.exe" OR ((New_Process_Name="*\\netsh.exe" Process_Command_Line="* trace *" Process_Command_Line="* start *" Process_Command_Line="* capture*" Process_Command_Line="*yes*"))))) | eval sigma_attack_tags="attack.credential_access attack.discovery attack.t1040" | eval sigma_title="Potential Network Sniffing Activity Using Network Tools" | eval sigma_description="Detects potential network sniffing via use of network tools such as 'tshark', 'windump' or 'netsh'.
Network sniffing refers to using the network interface on a system to monitor or capture information sent over a wired or wireless connection.
An adversary may place a network interface into promiscuous mode to passively access data in transit over the network, or use span ports to capture a larger amount of data.
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential Network Sniffing Activity Using Network Tools - sysmon]
description = Detects potential network sniffing via use of network tools such as 'tshark', 'windump' or 'netsh'.
Network sniffing refers to using the network interface on a system to monitor or capture information sent over a wired or wireless connection.
An adversary may place a network interface into promiscuous mode to passively access data in transit over the network, or use span ports to capture a larger amount of data.

search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((Image="*\\tshark.exe" CommandLine="*-i*")) OR Image="*\\windump.exe" OR ((Image="*\\netsh.exe" CommandLine="* trace *" CommandLine="* start *" CommandLine="* capture*" CommandLine="*yes*"))))) | eval sigma_attack_tags="attack.credential_access attack.discovery attack.t1040" | eval sigma_title="Potential Network Sniffing Activity Using Network Tools" | eval sigma_description="Detects potential network sniffing via use of network tools such as 'tshark', 'windump' or 'netsh'.
Network sniffing refers to using the network interface on a system to monitor or capture information sent over a wired or wireless connection.
An adversary may place a network interface into promiscuous mode to passively access data in transit over the network, or use span ports to capture a larger amount of data.
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential Credential Dumping Attempt Using New NetworkProvider - CLI - winevent]
description = Detects when an attacker tries to add a new network provider in order to dump clear text credentials, similar to how the NPPSpy tool does it
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*\\System\\CurrentControlSet\\Services\\*" Process_Command_Line="*\\NetworkProvider*")) | eval sigma_attack_tags="attack.credential_access attack.t1003" | eval sigma_title="Potential Credential Dumping Attempt Using New NetworkProvider - CLI" | eval sigma_description="Detects when an attacker tries to add a new network provider in order to dump clear text credentials, similar to how the NPPSpy tool does it"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential Credential Dumping Attempt Using New NetworkProvider - CLI - sysmon]
description = Detects when an attacker tries to add a new network provider in order to dump clear text credentials, similar to how the NPPSpy tool does it
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*\\System\\CurrentControlSet\\Services\\*" CommandLine="*\\NetworkProvider*")) | eval sigma_attack_tags="attack.credential_access attack.t1003" | eval sigma_title="Potential Credential Dumping Attempt Using New NetworkProvider - CLI" | eval sigma_description="Detects when an attacker tries to add a new network provider in order to dump clear text credentials, similar to how the NPPSpy tool does it"
dispatch.earliest_time = -24h@h
alert.track = 0

[New Service Creation - winevent]
description = Detects creation of a new service.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((New_Process_Name="*\\sc.exe" Process_Command_Line="*create*" Process_Command_Line="*binPath*")) OR ((Process_Command_Line="*New-Service*" Process_Command_Line="*-BinaryPathName*"))))) | eval sigma_attack_tags="attack.persistence attack.privilege_escalation attack.t1543.003" | eval sigma_title="New Service Creation" | eval sigma_description="Detects creation of a new service."
dispatch.earliest_time = -24h@h
alert.track = 0

[New Service Creation - sysmon]
description = Detects creation of a new service.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((Image="*\\sc.exe" CommandLine="*create*" CommandLine="*binPath*")) OR ((CommandLine="*New-Service*" CommandLine="*-BinaryPathName*"))))) | eval sigma_attack_tags="attack.persistence attack.privilege_escalation attack.t1543.003" | eval sigma_title="New Service Creation" | eval sigma_description="Detects creation of a new service."
dispatch.earliest_time = -24h@h
alert.track = 0

[File Downloaded Using Nimgrab - winevent]
description = Detects the usage of nimgrab, a tool bundled with the Nim programming framework and used for downloading files.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\nimgrab.exe" OR (Hashes="*MD5=2DD44C3C29D667F5C0EF5F9D7C7FFB8B*" OR Hashes="*SHA256=F266609E91985F0FE3E31C5E8FAEEEC4FFA5E0322D8B6F15FE69F4C5165B9559*" OR Hashes="*IMPHASH=C07FDDD21D123EA9B3A08EEF44AAAC45*") OR md5="2DD44C3C29D667F5C0EF5F9D7C7FFB8B" OR sha256="F266609E91985F0FE3E31C5E8FAEEEC4FFA5E0322D8B6F15FE69F4C5165B9559" OR Imphash="C07FDDD21D123EA9B3A08EEF44AAAC45"))) | eval sigma_attack_tags="attack.command_and_control attack.t1105" | eval sigma_title="File Downloaded Using Nimgrab" | eval sigma_description="Detects the usage of nimgrab, a tool bundled with the Nim programming framework and used for downloading files."
dispatch.earliest_time = -24h@h
alert.track = 0

[File Downloaded Using Nimgrab - sysmon]
description = Detects the usage of nimgrab, a tool bundled with the Nim programming framework and used for downloading files.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\nimgrab.exe" OR (Hashes="*MD5=2DD44C3C29D667F5C0EF5F9D7C7FFB8B*" OR Hashes="*SHA256=F266609E91985F0FE3E31C5E8FAEEEC4FFA5E0322D8B6F15FE69F4C5165B9559*" OR Hashes="*IMPHASH=C07FDDD21D123EA9B3A08EEF44AAAC45*") OR md5="2DD44C3C29D667F5C0EF5F9D7C7FFB8B" OR sha256="F266609E91985F0FE3E31C5E8FAEEEC4FFA5E0322D8B6F15FE69F4C5165B9559" OR Imphash="C07FDDD21D123EA9B3A08EEF44AAAC45"))) | eval sigma_attack_tags="attack.command_and_control attack.t1105" | eval sigma_title="File Downloaded Using Nimgrab" | eval sigma_description="Detects the usage of nimgrab, a tool bundled with the Nim programming framework and used for downloading files."
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential Recon Activity Via Nltest.EXE - winevent]
description = Detects nltest commands that can be used for information discovery
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\nltest.exe" OR OriginalFileName="nltestrk.exe") (((Process_Command_Line="*/server*" Process_Command_Line="*/query*")) OR (Process_Command_Line="*/dclist:*" OR Process_Command_Line="*/parentdomain*" OR Process_Command_Line="*/domain_trusts*" OR Process_Command_Line="*/trusted_domains*" OR Process_Command_Line="*/user*")))) | table New_Process_Name,Account_Name,Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.discovery attack.t1016 attack.t1482" | eval sigma_title="Potential Recon Activity Via Nltest.EXE" | eval sigma_description="Detects nltest commands that can be used for information discovery"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential Recon Activity Via Nltest.EXE - sysmon]
description = Detects nltest commands that can be used for information discovery
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\nltest.exe" OR OriginalFileName="nltestrk.exe") (((CommandLine="*/server*" CommandLine="*/query*")) OR (CommandLine="*/dclist:*" OR CommandLine="*/parentdomain*" OR CommandLine="*/domain_trusts*" OR CommandLine="*/trusted_domains*" OR CommandLine="*/user*")))) | table Image,User,CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.discovery attack.t1016 attack.t1482" | eval sigma_title="Potential Recon Activity Via Nltest.EXE" | eval sigma_description="Detects nltest commands that can be used for information discovery"
dispatch.earliest_time = -24h@h
alert.track = 0

[Nmap/Zenmap Execution - winevent]
description = Detects usage of namp/zenmap. Adversaries may attempt to get a listing of services running on remote hosts, including those that may be vulnerable to remote software exploitation
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\nmap.exe" OR New_Process_Name="*\\zennmap.exe") OR (OriginalFileName="nmap.exe" OR OriginalFileName="zennmap.exe")))) | eval sigma_attack_tags="attack.discovery attack.t1046" | eval sigma_title="Nmap/Zenmap Execution" | eval sigma_description="Detects usage of namp/zenmap. Adversaries may attempt to get a listing of services running on remote hosts, including those that may be vulnerable to remote software exploitation"
dispatch.earliest_time = -24h@h
alert.track = 0

[Nmap/Zenmap Execution - sysmon]
description = Detects usage of namp/zenmap. Adversaries may attempt to get a listing of services running on remote hosts, including those that may be vulnerable to remote software exploitation
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\nmap.exe" OR Image="*\\zennmap.exe") OR (OriginalFileName="nmap.exe" OR OriginalFileName="zennmap.exe")))) | eval sigma_attack_tags="attack.discovery attack.t1046" | eval sigma_title="Nmap/Zenmap Execution" | eval sigma_description="Detects usage of namp/zenmap. Adversaries may attempt to get a listing of services running on remote hosts, including those that may be vulnerable to remote software exploitation"
dispatch.earliest_time = -24h@h
alert.track = 0

[Node.exe Process Abuse - winevent]
description = Detects the execution node.exe which is shipped with multiple softwares such as VMware, Adobe...etc. In order to execute arbitrary code. For example to establish reverse shell as seen in Log4j attacks...etc
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\node.exe" (Process_Command_Line="* -e *" OR Process_Command_Line="* --eval *") Process_Command_Line="*.exec(*" Process_Command_Line="*net.socket*" Process_Command_Line="*.connect*" Process_Command_Line="*child_process*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1127" | eval sigma_title="Node.exe Process Abuse" | eval sigma_description="Detects the execution node.exe which is shipped with multiple softwares such as VMware, Adobe...etc. In order to execute arbitrary code. For example to establish reverse shell as seen in Log4j attacks...etc"
dispatch.earliest_time = -24h@h
alert.track = 0

[Node.exe Process Abuse - sysmon]
description = Detects the execution node.exe which is shipped with multiple softwares such as VMware, Adobe...etc. In order to execute arbitrary code. For example to establish reverse shell as seen in Log4j attacks...etc
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\node.exe" (CommandLine="* -e *" OR CommandLine="* --eval *") CommandLine="*.exec(*" CommandLine="*net.socket*" CommandLine="*.connect*" CommandLine="*child_process*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1127" | eval sigma_title="Node.exe Process Abuse" | eval sigma_description="Detects the execution node.exe which is shipped with multiple softwares such as VMware, Adobe...etc. In order to execute arbitrary code. For example to establish reverse shell as seen in Log4j attacks...etc"
dispatch.earliest_time = -24h@h
alert.track = 0

[Non Interactive PowerShell Process Spawned - winevent]
description = Detects non-interactive PowerShell activity by looking at powershell.exe with a non user process such as 'explorer.exe' as a parent.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\powershell.exe" OR New_Process_Name="*\\pwsh.exe") OR (OriginalFileName="PowerShell.EXE" OR OriginalFileName="pwsh.dll")) NOT ((((Creator_Process_Name="*\\explorer.exe" OR Creator_Process_Name="*\\CompatTelRunner.exe")) OR (Creator_Process_Name="C:\\$WINDOWS.~BT\\Sources\\SetupHost.exe")) OR ((Creator_Process_Name="C:\\Users\\*" Creator_Process_Name="*\\AppData\\Local\\Programs\\Microsoft VS Code\\Code.exe" ParentCommandLine="* --ms-enable-electron-run-as-node *"))))) | eval sigma_attack_tags="attack.execution attack.t1059.001" | eval sigma_title="Non Interactive PowerShell Process Spawned" | eval sigma_description="Detects non-interactive PowerShell activity by looking at powershell.exe with a non user process such as 'explorer.exe' as a parent."
dispatch.earliest_time = -24h@h
alert.track = 0

[Non Interactive PowerShell Process Spawned - sysmon]
description = Detects non-interactive PowerShell activity by looking at powershell.exe with a non user process such as 'explorer.exe' as a parent.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\powershell.exe" OR Image="*\\pwsh.exe") OR (OriginalFileName="PowerShell.EXE" OR OriginalFileName="pwsh.dll")) NOT ((((ParentImage="*\\explorer.exe" OR ParentImage="*\\CompatTelRunner.exe")) OR (ParentImage="C:\\$WINDOWS.~BT\\Sources\\SetupHost.exe")) OR ((ParentImage="C:\\Users\\*" ParentImage="*\\AppData\\Local\\Programs\\Microsoft VS Code\\Code.exe" ParentCommandLine="* --ms-enable-electron-run-as-node *"))))) | eval sigma_attack_tags="attack.execution attack.t1059.001" | eval sigma_title="Non Interactive PowerShell Process Spawned" | eval sigma_description="Detects non-interactive PowerShell activity by looking at powershell.exe with a non user process such as 'explorer.exe' as a parent."
dispatch.earliest_time = -24h@h
alert.track = 0

[Non-privileged Usage of Reg or Powershell - winevent]
description = Search for usage of reg or Powershell by non-privileged users to modify service configuration in registry
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((Process_Command_Line="*reg *" Process_Command_Line="*add*")) OR (Process_Command_Line="*powershell*" OR Process_Command_Line="*set-itemproperty*" OR Process_Command_Line="* sp *" OR Process_Command_Line="*new-itemproperty*")) ((IntegrityLevel="Medium" Process_Command_Line="*ControlSet*" Process_Command_Line="*Services*" (Process_Command_Line="*ImagePath*" OR Process_Command_Line="*FailureCommand*" OR Process_Command_Line="*ServiceDLL*"))))) | table EventCode,IntegrityLevel,Process_Command_Line | eval sigma_attack_tags="attack.defense_evasion attack.t1112" | eval sigma_title="Non-privileged Usage of Reg or Powershell" | eval sigma_description="Search for usage of reg or Powershell by non-privileged users to modify service configuration in registry"
dispatch.earliest_time = -24h@h
alert.track = 0

[Non-privileged Usage of Reg or Powershell - sysmon]
description = Search for usage of reg or Powershell by non-privileged users to modify service configuration in registry
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((CommandLine="*reg *" CommandLine="*add*")) OR (CommandLine="*powershell*" OR CommandLine="*set-itemproperty*" OR CommandLine="* sp *" OR CommandLine="*new-itemproperty*")) ((IntegrityLevel="Medium" CommandLine="*ControlSet*" CommandLine="*Services*" (CommandLine="*ImagePath*" OR CommandLine="*FailureCommand*" OR CommandLine="*ServiceDLL*"))))) | table EventCode,IntegrityLevel,CommandLine | eval sigma_attack_tags="attack.defense_evasion attack.t1112" | eval sigma_title="Non-privileged Usage of Reg or Powershell" | eval sigma_description="Search for usage of reg or Powershell by non-privileged users to modify service configuration in registry"
dispatch.earliest_time = -24h@h
alert.track = 0

[NPS Tunneling Tool - winevent]
description = Detects the use of NPS a port forwarding tool
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\npc.exe" OR ((Process_Command_Line="* -server=*" Process_Command_Line="* -vkey=*" Process_Command_Line="* -password=*")) OR Process_Command_Line="* -config=npc*" OR ((Hashes="*MD5=AE8ACF66BFE3A44148964048B826D005*" OR Hashes="*SHA1=CEA49E9B9B67F3A13AD0BE1C2655293EA3C18181*" OR Hashes="*SHA256=5A456283392FFCEEEACA3D3426C306EB470304637520D72FED1CC1FEBBBD6856*") OR md5="ae8acf66bfe3a44148964048b826d005" OR sha1="cea49e9b9b67f3a13ad0be1c2655293ea3c18181" OR sha256="5a456283392ffceeeaca3d3426c306eb470304637520d72fed1cc1febbbd6856")))) | eval sigma_attack_tags="attack.command_and_control attack.t1090" | eval sigma_title="NPS Tunneling Tool" | eval sigma_description="Detects the use of NPS a port forwarding tool"
dispatch.earliest_time = -24h@h
alert.track = 0

[NPS Tunneling Tool - sysmon]
description = Detects the use of NPS a port forwarding tool
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\npc.exe" OR ((CommandLine="* -server=*" CommandLine="* -vkey=*" CommandLine="* -password=*")) OR CommandLine="* -config=npc*" OR ((Hashes="*MD5=AE8ACF66BFE3A44148964048B826D005*" OR Hashes="*SHA1=CEA49E9B9B67F3A13AD0BE1C2655293EA3C18181*" OR Hashes="*SHA256=5A456283392FFCEEEACA3D3426C306EB470304637520D72FED1CC1FEBBBD6856*") OR md5="ae8acf66bfe3a44148964048b826d005" OR sha1="cea49e9b9b67f3a13ad0be1c2655293ea3c18181" OR sha256="5a456283392ffceeeaca3d3426c306eb470304637520d72fed1cc1febbbd6856")))) | eval sigma_attack_tags="attack.command_and_control attack.t1090" | eval sigma_title="NPS Tunneling Tool" | eval sigma_description="Detects the use of NPS a port forwarding tool"
dispatch.earliest_time = -24h@h
alert.track = 0

[Nslookup PowerShell Download Cradle - ProcessCreation - winevent]
description = Detects suspicious powershell download cradle using nslookup. This cradle uses nslookup to extract payloads from DNS records
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\nslookup.exe*" OR OriginalFileName="\\nslookup.exe") (((Creator_Process_Name="*\\powershell.exe" OR Creator_Process_Name="*\\pwsh.exe") (Process_Command_Line="* -q=txt *" OR Process_Command_Line="* -querytype=txt *"))))) | eval sigma_attack_tags="attack.defense_evasion" | eval sigma_title="Nslookup PowerShell Download Cradle - ProcessCreation" | eval sigma_description="Detects suspicious powershell download cradle using nslookup. This cradle uses nslookup to extract payloads from DNS records"
dispatch.earliest_time = -24h@h
alert.track = 0

[Nslookup PowerShell Download Cradle - ProcessCreation - sysmon]
description = Detects suspicious powershell download cradle using nslookup. This cradle uses nslookup to extract payloads from DNS records
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\nslookup.exe*" OR OriginalFileName="\\nslookup.exe") (((ParentImage="*\\powershell.exe" OR ParentImage="*\\pwsh.exe") (CommandLine="* -q=txt *" OR CommandLine="* -querytype=txt *"))))) | eval sigma_attack_tags="attack.defense_evasion" | eval sigma_title="Nslookup PowerShell Download Cradle - ProcessCreation" | eval sigma_description="Detects suspicious powershell download cradle using nslookup. This cradle uses nslookup to extract payloads from DNS records"
dispatch.earliest_time = -24h@h
alert.track = 0

[Invocation of Active Directory Diagnostic Tool (ntdsutil.exe) - winevent]
description = Detects execution of ntdsutil.exe, which can be used for various attacks against the NTDS database (NTDS.DIT)
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\ntdsutil.exe")) | eval sigma_attack_tags="attack.credential_access attack.t1003.003" | eval sigma_title="Invocation of Active Directory Diagnostic Tool (ntdsutil.exe)" | eval sigma_description="Detects execution of ntdsutil.exe, which can be used for various attacks against the NTDS database (NTDS.DIT)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Invocation of Active Directory Diagnostic Tool (ntdsutil.exe) - sysmon]
description = Detects execution of ntdsutil.exe, which can be used for various attacks against the NTDS database (NTDS.DIT)
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\ntdsutil.exe")) | eval sigma_attack_tags="attack.credential_access attack.t1003.003" | eval sigma_title="Invocation of Active Directory Diagnostic Tool (ntdsutil.exe)" | eval sigma_description="Detects execution of ntdsutil.exe, which can be used for various attacks against the NTDS database (NTDS.DIT)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Use Short Name Path in Command Line - winevent]
description = Detect use of the Windows 8.3 short name. Which could be used as a method to avoid command-line detection
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (Process_Command_Line="*~1\\*" OR Process_Command_Line="*~2\\*") NOT (((Creator_Process_Name="C:\\Windows\\System32\\Dism.exe" OR Creator_Process_Name="C:\\Windows\\System32\\cleanmgr.exe" OR Creator_Process_Name="C:\\Program Files\\GPSoftware\\Directory Opus\\dopus.exe")) OR ((Creator_Process_Name="*\\WebEx\\WebexHost.exe" OR Creator_Process_Name="*\\thor\\thor64.exe" OR Creator_Process_Name="*\\veam.backup.shell.exe" OR Creator_Process_Name="*\\winget.exe" OR Creator_Process_Name="*\\Everything\\Everything.exe")) OR (Creator_Process_Name="*\\AppData\\Local\\Temp\\WinGet\\*") OR ((Process_Command_Line="*\\appdata\\local\\webex\\webex64\\meetings\\wbxreport.exe*" OR Process_Command_Line="*C:\\Program Files\\Git\\post-install.bat*" OR Process_Command_Line="*C:\\Program Files\\Git\\cmd\\scalar.exe*"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1564.004" | eval sigma_title="Use Short Name Path in Command Line" | eval sigma_description="Detect use of the Windows 8.3 short name. Which could be used as a method to avoid command-line detection"
dispatch.earliest_time = -24h@h
alert.track = 0

[Use Short Name Path in Command Line - sysmon]
description = Detect use of the Windows 8.3 short name. Which could be used as a method to avoid command-line detection
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (CommandLine="*~1\\*" OR CommandLine="*~2\\*") NOT (((ParentImage="C:\\Windows\\System32\\Dism.exe" OR ParentImage="C:\\Windows\\System32\\cleanmgr.exe" OR ParentImage="C:\\Program Files\\GPSoftware\\Directory Opus\\dopus.exe")) OR ((ParentImage="*\\WebEx\\WebexHost.exe" OR ParentImage="*\\thor\\thor64.exe" OR ParentImage="*\\veam.backup.shell.exe" OR ParentImage="*\\winget.exe" OR ParentImage="*\\Everything\\Everything.exe")) OR (ParentImage="*\\AppData\\Local\\Temp\\WinGet\\*") OR ((CommandLine="*\\appdata\\local\\webex\\webex64\\meetings\\wbxreport.exe*" OR CommandLine="*C:\\Program Files\\Git\\post-install.bat*" OR CommandLine="*C:\\Program Files\\Git\\cmd\\scalar.exe*"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1564.004" | eval sigma_title="Use Short Name Path in Command Line" | eval sigma_description="Detect use of the Windows 8.3 short name. Which could be used as a method to avoid command-line detection"
dispatch.earliest_time = -24h@h
alert.track = 0

[Use Short Name Path in Image - winevent]
description = Detect use of the Windows 8.3 short name. Which could be used as a method to avoid Image detection
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*~1\\*" OR New_Process_Name="*~2\\*") NOT ((((Creator_Process_Name="C:\\Windows\\System32\\Dism.exe" OR Creator_Process_Name="C:\\Windows\\System32\\cleanmgr.exe")) OR ((Creator_Process_Name="*\\WebEx\\WebexHost.exe" OR Creator_Process_Name="*\\thor\\thor64.exe")) OR (Product="InstallShield (R)") OR (Description="InstallShield (R) Setup Engine") OR (Company="InstallShield Software Corporation")) OR (((New_Process_Name="*\\AppData\\*" New_Process_Name="*\\Temp\\*")) OR ((New_Process_Name="*~1\\unzip.exe" OR New_Process_Name="*~1\\7zG.exe")))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1564.004" | eval sigma_title="Use Short Name Path in Image" | eval sigma_description="Detect use of the Windows 8.3 short name. Which could be used as a method to avoid Image detection"
dispatch.earliest_time = -24h@h
alert.track = 0

[Use Short Name Path in Image - sysmon]
description = Detect use of the Windows 8.3 short name. Which could be used as a method to avoid Image detection
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*~1\\*" OR Image="*~2\\*") NOT ((((ParentImage="C:\\Windows\\System32\\Dism.exe" OR ParentImage="C:\\Windows\\System32\\cleanmgr.exe")) OR ((ParentImage="*\\WebEx\\WebexHost.exe" OR ParentImage="*\\thor\\thor64.exe")) OR (Product="InstallShield (R)") OR (Description="InstallShield (R) Setup Engine") OR (Company="InstallShield Software Corporation")) OR (((Image="*\\AppData\\*" Image="*\\Temp\\*")) OR ((Image="*~1\\unzip.exe" OR Image="*~1\\7zG.exe")))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1564.004" | eval sigma_title="Use Short Name Path in Image" | eval sigma_description="Detect use of the Windows 8.3 short name. Which could be used as a method to avoid Image detection"
dispatch.earliest_time = -24h@h
alert.track = 0

[Use NTFS Short Name in Command Line - winevent]
description = Detect use of the Windows 8.3 short name. Which could be used as a method to avoid command-line detection
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (Process_Command_Line="*~1.exe*" OR Process_Command_Line="*~1.bat*" OR Process_Command_Line="*~1.msi*" OR Process_Command_Line="*~1.vbe*" OR Process_Command_Line="*~1.vbs*" OR Process_Command_Line="*~1.dll*" OR Process_Command_Line="*~1.ps1*" OR Process_Command_Line="*~1.js*" OR Process_Command_Line="*~1.hta*" OR Process_Command_Line="*~2.exe*" OR Process_Command_Line="*~2.bat*" OR Process_Command_Line="*~2.msi*" OR Process_Command_Line="*~2.vbe*" OR Process_Command_Line="*~2.vbs*" OR Process_Command_Line="*~2.dll*" OR Process_Command_Line="*~2.ps1*" OR Process_Command_Line="*~2.js*" OR Process_Command_Line="*~2.hta*") NOT (((Creator_Process_Name="*\\WebEx\\WebexHost.exe" OR Creator_Process_Name="*\\thor\\thor64.exe")) OR (Process_Command_Line="*C:\\xampp\\vcredist\\VCREDI~1.EXE*")))) | eval sigma_attack_tags="attack.defense_evasion attack.t1564.004" | eval sigma_title="Use NTFS Short Name in Command Line" | eval sigma_description="Detect use of the Windows 8.3 short name. Which could be used as a method to avoid command-line detection"
dispatch.earliest_time = -24h@h
alert.track = 0

[Use NTFS Short Name in Command Line - sysmon]
description = Detect use of the Windows 8.3 short name. Which could be used as a method to avoid command-line detection
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (CommandLine="*~1.exe*" OR CommandLine="*~1.bat*" OR CommandLine="*~1.msi*" OR CommandLine="*~1.vbe*" OR CommandLine="*~1.vbs*" OR CommandLine="*~1.dll*" OR CommandLine="*~1.ps1*" OR CommandLine="*~1.js*" OR CommandLine="*~1.hta*" OR CommandLine="*~2.exe*" OR CommandLine="*~2.bat*" OR CommandLine="*~2.msi*" OR CommandLine="*~2.vbe*" OR CommandLine="*~2.vbs*" OR CommandLine="*~2.dll*" OR CommandLine="*~2.ps1*" OR CommandLine="*~2.js*" OR CommandLine="*~2.hta*") NOT (((ParentImage="*\\WebEx\\WebexHost.exe" OR ParentImage="*\\thor\\thor64.exe")) OR (CommandLine="*C:\\xampp\\vcredist\\VCREDI~1.EXE*")))) | eval sigma_attack_tags="attack.defense_evasion attack.t1564.004" | eval sigma_title="Use NTFS Short Name in Command Line" | eval sigma_description="Detect use of the Windows 8.3 short name. Which could be used as a method to avoid command-line detection"
dispatch.earliest_time = -24h@h
alert.track = 0

[Use NTFS Short Name in Image - winevent]
description = Detect use of the Windows 8.3 short name. Which could be used as a method to avoid Image based detection
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*~1.exe*" OR New_Process_Name="*~1.bat*" OR New_Process_Name="*~1.msi*" OR New_Process_Name="*~1.vbe*" OR New_Process_Name="*~1.vbs*" OR New_Process_Name="*~1.dll*" OR New_Process_Name="*~1.ps1*" OR New_Process_Name="*~1.js*" OR New_Process_Name="*~1.hta*" OR New_Process_Name="*~2.exe*" OR New_Process_Name="*~2.bat*" OR New_Process_Name="*~2.msi*" OR New_Process_Name="*~2.vbe*" OR New_Process_Name="*~2.vbs*" OR New_Process_Name="*~2.dll*" OR New_Process_Name="*~2.ps1*" OR New_Process_Name="*~2.js*" OR New_Process_Name="*~2.hta*") NOT (((Creator_Process_Name="*\\WebEx\\WebexHost.exe" OR Creator_Process_Name="*\\thor\\thor64.exe" OR Creator_Process_Name="*-installer.exe")) OR (New_Process_Name="*\\vcredi*") OR (Creator_Process_Name="C:\\Windows\\explorer.exe")))) | eval sigma_attack_tags="attack.defense_evasion attack.t1564.004" | eval sigma_title="Use NTFS Short Name in Image" | eval sigma_description="Detect use of the Windows 8.3 short name. Which could be used as a method to avoid Image based detection"
dispatch.earliest_time = -24h@h
alert.track = 0

[Use NTFS Short Name in Image - sysmon]
description = Detect use of the Windows 8.3 short name. Which could be used as a method to avoid Image based detection
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*~1.exe*" OR Image="*~1.bat*" OR Image="*~1.msi*" OR Image="*~1.vbe*" OR Image="*~1.vbs*" OR Image="*~1.dll*" OR Image="*~1.ps1*" OR Image="*~1.js*" OR Image="*~1.hta*" OR Image="*~2.exe*" OR Image="*~2.bat*" OR Image="*~2.msi*" OR Image="*~2.vbe*" OR Image="*~2.vbs*" OR Image="*~2.dll*" OR Image="*~2.ps1*" OR Image="*~2.js*" OR Image="*~2.hta*") NOT (((ParentImage="*\\WebEx\\WebexHost.exe" OR ParentImage="*\\thor\\thor64.exe" OR ParentImage="*-installer.exe")) OR (Image="*\\vcredi*") OR (ParentImage="C:\\Windows\\explorer.exe")))) | eval sigma_attack_tags="attack.defense_evasion attack.t1564.004" | eval sigma_title="Use NTFS Short Name in Image" | eval sigma_description="Detect use of the Windows 8.3 short name. Which could be used as a method to avoid Image based detection"
dispatch.earliest_time = -24h@h
alert.track = 0

[Obfuscated IP Download - winevent]
description = Detects use of an encoded/obfuscated version of an IP address (hex, octal...) in an URL combined with a download command
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (Process_Command_Line="*Invoke-WebRequest*" OR Process_Command_Line="*iwr *" OR Process_Command_Line="*wget *" OR Process_Command_Line="*curl *" OR Process_Command_Line="*DownloadFile*" OR Process_Command_Line="*DownloadString*") ((Process_Command_Line="*//0x*" OR Process_Command_Line="*.0x*" OR Process_Command_Line="*.00x*") OR ((Process_Command_Line="*http://%*" Process_Command_Line="*%2e*"))))) | eval sigma_attack_tags="attack.discovery" | eval sigma_title="Obfuscated IP Download" | eval sigma_description="Detects use of an encoded/obfuscated version of an IP address (hex, octal...) in an URL combined with a download command"
dispatch.earliest_time = -24h@h
alert.track = 0

[Obfuscated IP Download - sysmon]
description = Detects use of an encoded/obfuscated version of an IP address (hex, octal...) in an URL combined with a download command
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (CommandLine="*Invoke-WebRequest*" OR CommandLine="*iwr *" OR CommandLine="*wget *" OR CommandLine="*curl *" OR CommandLine="*DownloadFile*" OR CommandLine="*DownloadString*") ((CommandLine="*//0x*" OR CommandLine="*.0x*" OR CommandLine="*.00x*") OR ((CommandLine="*http://%*" CommandLine="*%2e*"))))) | eval sigma_attack_tags="attack.discovery" | eval sigma_title="Obfuscated IP Download" | eval sigma_description="Detects use of an encoded/obfuscated version of an IP address (hex, octal...) in an URL combined with a download command"
dispatch.earliest_time = -24h@h
alert.track = 0

[Office Directory Traversal CommandLine - winevent]
description = Detects Office Applications executing a Windows child process including directory traversal patterns
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (Creator_Process_Name="*\\winword.exe" OR Creator_Process_Name="*\\excel.exe" OR Creator_Process_Name="*\\powerpnt.exe" OR Creator_Process_Name="*\\msaccess.exe" OR Creator_Process_Name="*\\mspub.exe" OR Creator_Process_Name="*\\eqnedt32.exe" OR Creator_Process_Name="*\\visio.exe") (New_Process_Name="*\\Windows\\System32\\*" OR New_Process_Name="*\\Windows\\SysWOW64\\*") (Process_Command_Line="../../../.." OR Process_Command_Line="..\\..\\..\\.." OR Process_Command_Line="..//..//..//.."))) | eval sigma_attack_tags="attack.execution attack.defense_evasion" | eval sigma_title="Office Directory Traversal CommandLine" | eval sigma_description="Detects Office Applications executing a Windows child process including directory traversal patterns"
dispatch.earliest_time = -24h@h
alert.track = 0

[Office Directory Traversal CommandLine - sysmon]
description = Detects Office Applications executing a Windows child process including directory traversal patterns
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (ParentImage="*\\winword.exe" OR ParentImage="*\\excel.exe" OR ParentImage="*\\powerpnt.exe" OR ParentImage="*\\msaccess.exe" OR ParentImage="*\\mspub.exe" OR ParentImage="*\\eqnedt32.exe" OR ParentImage="*\\visio.exe") (Image="*\\Windows\\System32\\*" OR Image="*\\Windows\\SysWOW64\\*") (CommandLine="../../../.." OR CommandLine="..\\..\\..\\.." OR CommandLine="..//..//..//.."))) | eval sigma_attack_tags="attack.execution attack.defense_evasion" | eval sigma_title="Office Directory Traversal CommandLine" | eval sigma_description="Detects Office Applications executing a Windows child process including directory traversal patterns"
dispatch.earliest_time = -24h@h
alert.track = 0

[Microsoft Office Product Spawning Windows Shell - winevent]
description = Detects a Windows command and scripting interpreter executable started from Microsoft Word, Excel, Powerpoint, Publisher and Visio
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (Creator_Process_Name="*\\WINWORD.EXE" OR Creator_Process_Name="*\\EXCEL.EXE" OR Creator_Process_Name="*\\POWERPNT.exe" OR Creator_Process_Name="*\\MSPUB.exe" OR Creator_Process_Name="*\\VISIO.exe" OR Creator_Process_Name="*\\MSACCESS.EXE" OR Creator_Process_Name="*\\EQNEDT32.EXE") (New_Process_Name="*\\cmd.exe" OR New_Process_Name="*\\powershell.exe" OR New_Process_Name="*\\pwsh.exe" OR New_Process_Name="*\\wscript.exe" OR New_Process_Name="*\\cscript.exe" OR New_Process_Name="*\\sh.exe" OR New_Process_Name="*\\bash.exe" OR New_Process_Name="*\\scrcons.exe" OR New_Process_Name="*\\schtasks.exe" OR New_Process_Name="*\\regsvr32.exe" OR New_Process_Name="*\\hh.exe" OR New_Process_Name="*\\wmic.exe" OR New_Process_Name="*\\mshta.exe" OR New_Process_Name="*\\rundll32.exe" OR New_Process_Name="*\\msiexec.exe" OR New_Process_Name="*\\forfiles.exe" OR New_Process_Name="*\\scriptrunner.exe" OR New_Process_Name="*\\mftrace.exe" OR New_Process_Name="*\\AppVLP.exe" OR New_Process_Name="*\\svchost.exe" OR New_Process_Name="*\\msbuild.exe"))) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.execution attack.t1204.002" | eval sigma_title="Microsoft Office Product Spawning Windows Shell" | eval sigma_description="Detects a Windows command and scripting interpreter executable started from Microsoft Word, Excel, Powerpoint, Publisher and Visio"
dispatch.earliest_time = -24h@h
alert.track = 0

[Microsoft Office Product Spawning Windows Shell - sysmon]
description = Detects a Windows command and scripting interpreter executable started from Microsoft Word, Excel, Powerpoint, Publisher and Visio
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (ParentImage="*\\WINWORD.EXE" OR ParentImage="*\\EXCEL.EXE" OR ParentImage="*\\POWERPNT.exe" OR ParentImage="*\\MSPUB.exe" OR ParentImage="*\\VISIO.exe" OR ParentImage="*\\MSACCESS.EXE" OR ParentImage="*\\EQNEDT32.EXE") (Image="*\\cmd.exe" OR Image="*\\powershell.exe" OR Image="*\\pwsh.exe" OR Image="*\\wscript.exe" OR Image="*\\cscript.exe" OR Image="*\\sh.exe" OR Image="*\\bash.exe" OR Image="*\\scrcons.exe" OR Image="*\\schtasks.exe" OR Image="*\\regsvr32.exe" OR Image="*\\hh.exe" OR Image="*\\wmic.exe" OR Image="*\\mshta.exe" OR Image="*\\rundll32.exe" OR Image="*\\msiexec.exe" OR Image="*\\forfiles.exe" OR Image="*\\scriptrunner.exe" OR Image="*\\mftrace.exe" OR Image="*\\AppVLP.exe" OR Image="*\\svchost.exe" OR Image="*\\msbuild.exe"))) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.execution attack.t1204.002" | eval sigma_title="Microsoft Office Product Spawning Windows Shell" | eval sigma_description="Detects a Windows command and scripting interpreter executable started from Microsoft Word, Excel, Powerpoint, Publisher and Visio"
dispatch.earliest_time = -24h@h
alert.track = 0

[MS Office Product Spawning Exe in User Dir - winevent]
description = Detects an executable in the users directory started from Microsoft Word, Excel, Powerpoint, Publisher or Visio
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((Creator_Process_Name="*\\WINWORD.EXE" OR Creator_Process_Name="*\\EXCEL.EXE" OR Creator_Process_Name="*\\POWERPNT.exe" OR Creator_Process_Name="*\\MSPUB.exe" OR Creator_Process_Name="*\\VISIO.exe" OR Creator_Process_Name="*\\MSACCESS.exe" OR Creator_Process_Name="*\\EQNEDT32.exe") New_Process_Name="C:\\users\\*" New_Process_Name="*.exe")) NOT ((New_Process_Name="*\\Teams.exe")))) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.execution attack.t1204.002 attack.g0046 car.2013-05-002" | eval sigma_title="MS Office Product Spawning Exe in User Dir" | eval sigma_description="Detects an executable in the users directory started from Microsoft Word, Excel, Powerpoint, Publisher or Visio"
dispatch.earliest_time = -24h@h
alert.track = 0

[MS Office Product Spawning Exe in User Dir - sysmon]
description = Detects an executable in the users directory started from Microsoft Word, Excel, Powerpoint, Publisher or Visio
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((ParentImage="*\\WINWORD.EXE" OR ParentImage="*\\EXCEL.EXE" OR ParentImage="*\\POWERPNT.exe" OR ParentImage="*\\MSPUB.exe" OR ParentImage="*\\VISIO.exe" OR ParentImage="*\\MSACCESS.exe" OR ParentImage="*\\EQNEDT32.exe") Image="C:\\users\\*" Image="*.exe")) NOT ((Image="*\\Teams.exe")))) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.execution attack.t1204.002 attack.g0046 car.2013-05-002" | eval sigma_title="MS Office Product Spawning Exe in User Dir" | eval sigma_description="Detects an executable in the users directory started from Microsoft Word, Excel, Powerpoint, Publisher or Visio"
dispatch.earliest_time = -24h@h
alert.track = 0

[Office Applications Spawning Wmi Cli Alternate - winevent]
description = Initial execution of malicious document calls wmic to execute the file with regsvr32
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\wbem\\WMIC.exe" OR Process_Command_Line="*wmic *") (Creator_Process_Name="*\\winword.exe" OR Creator_Process_Name="*\\excel.exe" OR Creator_Process_Name="*\\powerpnt.exe" OR Creator_Process_Name="*\\msaccess.exe" OR Creator_Process_Name="*\\mspub.exe" OR Creator_Process_Name="*\\eqnedt32.exe" OR Creator_Process_Name="*\\visio.exe"))) | eval sigma_attack_tags="attack.t1204.002 attack.t1047 attack.t1218.010 attack.execution attack.defense_evasion" | eval sigma_title="Office Applications Spawning Wmi Cli Alternate" | eval sigma_description="Initial execution of malicious document calls wmic to execute the file with regsvr32"
dispatch.earliest_time = -24h@h
alert.track = 0

[Office Applications Spawning Wmi Cli Alternate - sysmon]
description = Initial execution of malicious document calls wmic to execute the file with regsvr32
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\wbem\\WMIC.exe" OR CommandLine="*wmic *") (ParentImage="*\\winword.exe" OR ParentImage="*\\excel.exe" OR ParentImage="*\\powerpnt.exe" OR ParentImage="*\\msaccess.exe" OR ParentImage="*\\mspub.exe" OR ParentImage="*\\eqnedt32.exe" OR ParentImage="*\\visio.exe"))) | eval sigma_attack_tags="attack.t1204.002 attack.t1047 attack.t1218.010 attack.execution attack.defense_evasion" | eval sigma_title="Office Applications Spawning Wmi Cli Alternate" | eval sigma_description="Initial execution of malicious document calls wmic to execute the file with regsvr32"
dispatch.earliest_time = -24h@h
alert.track = 0

[Svchost Spawning Office Application - winevent]
description = Detects svchost process spawning an instance of an office application. This happens when the initial word application create an instance of one of the office COM objects such as 'Word.Application', 'Excel.Application'...etc. This can be used by malicious actor to create a malicious office document with macros on the fly. (See vba2clr project in reference)
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Creator_Process_Name="*\\svchost.exe" (New_Process_Name="*\\winword.exe" OR New_Process_Name="*\\excel.exe" OR New_Process_Name="*\\powerpnt.exe" OR New_Process_Name="*\\msaccess.exe" OR New_Process_Name="*\\mspub.exe" OR New_Process_Name="*\\eqnedt32.exe" OR New_Process_Name="*\\visio.exe"))) | eval sigma_attack_tags="attack.execution attack.defense_evasion" | eval sigma_title="Svchost Spawning Office Application" | eval sigma_description="Detects svchost process spawning an instance of an office application. This happens when the initial word application create an instance of one of the office COM objects such as 'Word.Application', 'Excel.Application'...etc. This can be used by malicious actor to create a malicious office document with macros on the fly. (See vba2clr project in reference)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Svchost Spawning Office Application - sysmon]
description = Detects svchost process spawning an instance of an office application. This happens when the initial word application create an instance of one of the office COM objects such as 'Word.Application', 'Excel.Application'...etc. This can be used by malicious actor to create a malicious office document with macros on the fly. (See vba2clr project in reference)
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") ParentImage="*\\svchost.exe" (Image="*\\winword.exe" OR Image="*\\excel.exe" OR Image="*\\powerpnt.exe" OR Image="*\\msaccess.exe" OR Image="*\\mspub.exe" OR Image="*\\eqnedt32.exe" OR Image="*\\visio.exe"))) | eval sigma_attack_tags="attack.execution attack.defense_evasion" | eval sigma_title="Svchost Spawning Office Application" | eval sigma_description="Detects svchost process spawning an instance of an office application. This happens when the initial word application create an instance of one of the office COM objects such as 'Word.Application', 'Excel.Application'...etc. This can be used by malicious actor to create a malicious office document with macros on the fly. (See vba2clr project in reference)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Microsoft Outlook Product Spawning Windows Shell - winevent]
description = Detects a Windows command and scripting interpreter executable started from Microsoft Outlook
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Creator_Process_Name="*\\OUTLOOK.EXE" (New_Process_Name="*\\cmd.exe" OR New_Process_Name="*\\powershell.exe" OR New_Process_Name="*\\pwsh.exe" OR New_Process_Name="*\\wscript.exe" OR New_Process_Name="*\\cscript.exe" OR New_Process_Name="*\\sh.exe" OR New_Process_Name="*\\bash.exe" OR New_Process_Name="*\\scrcons.exe" OR New_Process_Name="*\\schtasks.exe" OR New_Process_Name="*\\regsvr32.exe" OR New_Process_Name="*\\hh.exe" OR New_Process_Name="*\\wmic.exe" OR New_Process_Name="*\\mshta.exe" OR New_Process_Name="*\\msiexec.exe" OR New_Process_Name="*\\forfiles.exe" OR New_Process_Name="*\\scriptrunner.exe" OR New_Process_Name="*\\mftrace.exe" OR New_Process_Name="*\\AppVLP.exe" OR New_Process_Name="*\\svchost.exe" OR New_Process_Name="*\\msbuild.exe" OR New_Process_Name="*\\msdt.exe"))) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.execution attack.t1204.002" | eval sigma_title="Microsoft Outlook Product Spawning Windows Shell" | eval sigma_description="Detects a Windows command and scripting interpreter executable started from Microsoft Outlook"
dispatch.earliest_time = -24h@h
alert.track = 0

[Microsoft Outlook Product Spawning Windows Shell - sysmon]
description = Detects a Windows command and scripting interpreter executable started from Microsoft Outlook
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") ParentImage="*\\OUTLOOK.EXE" (Image="*\\cmd.exe" OR Image="*\\powershell.exe" OR Image="*\\pwsh.exe" OR Image="*\\wscript.exe" OR Image="*\\cscript.exe" OR Image="*\\sh.exe" OR Image="*\\bash.exe" OR Image="*\\scrcons.exe" OR Image="*\\schtasks.exe" OR Image="*\\regsvr32.exe" OR Image="*\\hh.exe" OR Image="*\\wmic.exe" OR Image="*\\mshta.exe" OR Image="*\\msiexec.exe" OR Image="*\\forfiles.exe" OR Image="*\\scriptrunner.exe" OR Image="*\\mftrace.exe" OR Image="*\\AppVLP.exe" OR Image="*\\svchost.exe" OR Image="*\\msbuild.exe" OR Image="*\\msdt.exe"))) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.execution attack.t1204.002" | eval sigma_title="Microsoft Outlook Product Spawning Windows Shell" | eval sigma_description="Detects a Windows command and scripting interpreter executable started from Microsoft Outlook"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Execution Of PDQDeployRunner - winevent]
description = Detects suspicious execution of 'PDQDeployRunner' which is part of the PDQDeploy service stack that is responsible for executing commands and packages on a remote machines
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) Creator_Process_Name="*PDQDeployRunner-*" ((New_Process_Name="*\\wscript.exe" OR New_Process_Name="*\\cscript.exe" OR New_Process_Name="*\\rundll32.exe" OR New_Process_Name="*\\regsvr32.exe" OR New_Process_Name="*\\wmic.exe" OR New_Process_Name="*\\msiexec.exe" OR New_Process_Name="*\\mshta.exe" OR New_Process_Name="*\\csc.exe" OR New_Process_Name="*\\dllhost.exe" OR New_Process_Name="*\\certutil.exe" OR New_Process_Name="*\\scriptrunner.exe" OR New_Process_Name="*\\bash.exe" OR New_Process_Name="*\\wsl.exe") OR (New_Process_Name="*C:\\Users\\Public\\*" OR New_Process_Name="*C:\\ProgramData\\*" OR New_Process_Name="*C:\\Windows\\TEMP\\*" OR New_Process_Name="*\\AppData\\Local\\Temp*") OR (Process_Command_Line="*iex *" OR Process_Command_Line="*Invoke-*" OR Process_Command_Line="*DownloadString*" OR Process_Command_Line="*http*" OR Process_Command_Line="* -enc *" OR Process_Command_Line="* -encodedcommand *" OR Process_Command_Line="*FromBase64String*" OR Process_Command_Line="* -decode *" OR Process_Command_Line="* -w hidden*")))) | eval sigma_attack_tags="attack.execution" | eval sigma_title="Suspicious Execution Of PDQDeployRunner" | eval sigma_description="Detects suspicious execution of 'PDQDeployRunner' which is part of the PDQDeploy service stack that is responsible for executing commands and packages on a remote machines"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Execution Of PDQDeployRunner - sysmon]
description = Detects suspicious execution of 'PDQDeployRunner' which is part of the PDQDeploy service stack that is responsible for executing commands and packages on a remote machines
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ParentImage="*PDQDeployRunner-*" ((Image="*\\wscript.exe" OR Image="*\\cscript.exe" OR Image="*\\rundll32.exe" OR Image="*\\regsvr32.exe" OR Image="*\\wmic.exe" OR Image="*\\msiexec.exe" OR Image="*\\mshta.exe" OR Image="*\\csc.exe" OR Image="*\\dllhost.exe" OR Image="*\\certutil.exe" OR Image="*\\scriptrunner.exe" OR Image="*\\bash.exe" OR Image="*\\wsl.exe") OR (Image="*C:\\Users\\Public\\*" OR Image="*C:\\ProgramData\\*" OR Image="*C:\\Windows\\TEMP\\*" OR Image="*\\AppData\\Local\\Temp*") OR (CommandLine="*iex *" OR CommandLine="*Invoke-*" OR CommandLine="*DownloadString*" OR CommandLine="*http*" OR CommandLine="* -enc *" OR CommandLine="* -encodedcommand *" OR CommandLine="*FromBase64String*" OR CommandLine="* -decode *" OR CommandLine="* -w hidden*")))) | eval sigma_attack_tags="attack.execution" | eval sigma_title="Suspicious Execution Of PDQDeployRunner" | eval sigma_description="Detects suspicious execution of 'PDQDeployRunner' which is part of the PDQDeploy service stack that is responsible for executing commands and packages on a remote machines"
dispatch.earliest_time = -24h@h
alert.track = 0

[PDQ Deploy Remote Adminstartion Tool Execution - winevent]
description = Detect use of PDQ Deploy remote admin tool
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (Description="PDQ Deploy Console" OR Product="PDQ Deploy" OR Company="PDQ.com" OR OriginalFileName="PDQDeployConsole.exe"))) | eval sigma_attack_tags="attack.execution attack.lateral_movement attack.t1072" | eval sigma_title="PDQ Deploy Remote Adminstartion Tool Execution" | eval sigma_description="Detect use of PDQ Deploy remote admin tool"
dispatch.earliest_time = -24h@h
alert.track = 0

[PDQ Deploy Remote Adminstartion Tool Execution - sysmon]
description = Detect use of PDQ Deploy remote admin tool
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Description="PDQ Deploy Console" OR Product="PDQ Deploy" OR Company="PDQ.com" OR OriginalFileName="PDQDeployConsole.exe"))) | eval sigma_attack_tags="attack.execution attack.lateral_movement attack.t1072" | eval sigma_title="PDQ Deploy Remote Adminstartion Tool Execution" | eval sigma_description="Detect use of PDQ Deploy remote admin tool"
dispatch.earliest_time = -24h@h
alert.track = 0

[Perl Inline Command Execution - winevent]
description = Detects execution of perl using the '-e'/'-E' flags. This is could be used as a way to launch a reverse shell or execute live perl code.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\perl.exe" OR OriginalFileName="perl.exe") Process_Command_Line="* -e*")) | eval sigma_attack_tags="attack.execution attack.t1059" | eval sigma_title="Perl Inline Command Execution" | eval sigma_description="Detects execution of perl using the '-e'/'-E' flags. This is could be used as a way to launch a reverse shell or execute live perl code."
dispatch.earliest_time = -24h@h
alert.track = 0

[Perl Inline Command Execution - sysmon]
description = Detects execution of perl using the '-e'/'-E' flags. This is could be used as a way to launch a reverse shell or execute live perl code.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\perl.exe" OR OriginalFileName="perl.exe") CommandLine="* -e*")) | eval sigma_attack_tags="attack.execution attack.t1059" | eval sigma_title="Perl Inline Command Execution" | eval sigma_description="Detects execution of perl using the '-e'/'-E' flags. This is could be used as a way to launch a reverse shell or execute live perl code."
dispatch.earliest_time = -24h@h
alert.track = 0

[Persistence Via TypedPaths - CommandLine - winevent]
description = Detects modification addition to the 'TypedPaths' key in the user or admin registry via the commandline. Which might indicate persistence attempt
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\TypedPaths*")) | eval sigma_attack_tags="attack.persistence" | eval sigma_title="Persistence Via TypedPaths - CommandLine" | eval sigma_description="Detects modification addition to the 'TypedPaths' key in the user or admin registry via the commandline. Which might indicate persistence attempt"
dispatch.earliest_time = -24h@h
alert.track = 0

[Persistence Via TypedPaths - CommandLine - sysmon]
description = Detects modification addition to the 'TypedPaths' key in the user or admin registry via the commandline. Which might indicate persistence attempt
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\TypedPaths*")) | eval sigma_attack_tags="attack.persistence" | eval sigma_title="Persistence Via TypedPaths - CommandLine" | eval sigma_description="Detects modification addition to the 'TypedPaths' key in the user or admin registry via the commandline. Which might indicate persistence attempt"
dispatch.earliest_time = -24h@h
alert.track = 0

[Php Inline Command Execution - winevent]
description = Detects execution of php using the '-r' flag. This is could be used as a way to launch a reverse shell or execute live php code.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\php.exe" OR OriginalFileName="php.exe") Process_Command_Line="* -r*")) | eval sigma_attack_tags="attack.execution attack.t1059" | eval sigma_title="Php Inline Command Execution" | eval sigma_description="Detects execution of php using the '-r' flag. This is could be used as a way to launch a reverse shell or execute live php code."
dispatch.earliest_time = -24h@h
alert.track = 0

[Php Inline Command Execution - sysmon]
description = Detects execution of php using the '-r' flag. This is could be used as a way to launch a reverse shell or execute live php code.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\php.exe" OR OriginalFileName="php.exe") CommandLine="* -r*")) | eval sigma_attack_tags="attack.execution attack.t1059" | eval sigma_title="Php Inline Command Execution" | eval sigma_description="Detects execution of php using the '-r' flag. This is could be used as a way to launch a reverse shell or execute live php code."
dispatch.earliest_time = -24h@h
alert.track = 0

[Pingback Backdoor - winevent]
description = Detects the use of Pingback backdoor that creates ICMP tunnel for C2 as described in the trustwave report
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Creator_Process_Name="*updata.exe" Process_Command_Line="*config*" Process_Command_Line="*msdtc*" Process_Command_Line="*start*" Process_Command_Line="*auto*")) | eval sigma_attack_tags="attack.persistence attack.t1574.001" | eval sigma_title="Pingback Backdoor" | eval sigma_description="Detects the use of Pingback backdoor that creates ICMP tunnel for C2 as described in the trustwave report"
dispatch.earliest_time = -24h@h
alert.track = 0

[Pingback Backdoor - sysmon]
description = Detects the use of Pingback backdoor that creates ICMP tunnel for C2 as described in the trustwave report
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") ParentImage="*updata.exe" CommandLine="*config*" CommandLine="*msdtc*" CommandLine="*start*" CommandLine="*auto*")) | eval sigma_attack_tags="attack.persistence attack.t1574.001" | eval sigma_title="Pingback Backdoor" | eval sigma_description="Detects the use of Pingback backdoor that creates ICMP tunnel for C2 as described in the trustwave report"
dispatch.earliest_time = -24h@h
alert.track = 0

[Executable Used by PlugX in Uncommon Location - winevent]
description = Detects the execution of an executable that is typically used by PlugX for DLL side loading started from an uncommon location
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((((((((((((New_Process_Name="*\\CamMute.exe" NOT (((New_Process_Name="*\\Lenovo\\Communication Utility\\*" OR New_Process_Name="*\\Lenovo\\Communications Utility\\*"))))) OR ((New_Process_Name="*\\chrome_frame_helper.exe" NOT ((New_Process_Name="*\\Google\\Chrome\\application\\*"))))) OR ((New_Process_Name="*\\dvcemumanager.exe" NOT ((New_Process_Name="*\\Microsoft Device Emulator\\*"))))) OR ((New_Process_Name="*\\Gadget.exe" NOT ((New_Process_Name="*\\Windows Media Player\\*"))))) OR ((New_Process_Name="*\\hcc.exe" NOT ((New_Process_Name="*\\HTML Help Workshop\\*"))))) OR ((New_Process_Name="*\\hkcmd.exe" NOT (((New_Process_Name="*\\System32\\*" OR New_Process_Name="*\\SysNative\\*" OR New_Process_Name="*\\SysWow64\\*")))))) OR ((New_Process_Name="*\\Mc.exe" NOT (((New_Process_Name="*\\Microsoft Visual Studio*" OR New_Process_Name="*\\Microsoft SDK*" OR New_Process_Name="*\\Windows Kit*")))))) OR ((New_Process_Name="*\\MsMpEng.exe" NOT (((New_Process_Name="*\\Microsoft Security Client\\*" OR New_Process_Name="*\\Windows Defender\\*" OR New_Process_Name="*\\AntiMalware\\*")))))) OR ((New_Process_Name="*\\msseces.exe" NOT (((New_Process_Name="*\\Microsoft Security Center\\*" OR New_Process_Name="*\\Microsoft Security Client\\*" OR New_Process_Name="*\\Microsoft Security Essentials\\*")))))) OR ((New_Process_Name="*\\OInfoP11.exe" NOT ((New_Process_Name="*\\Common Files\\Microsoft Shared\\*"))))) OR ((New_Process_Name="*\\OleView.exe" NOT (((New_Process_Name="*\\Microsoft Visual Studio*" OR New_Process_Name="*\\Microsoft SDK*" OR New_Process_Name="*\\Windows Kit*" OR New_Process_Name="*\\Windows Resource Kit\\*")))))) OR ((New_Process_Name="*\\rc.exe" NOT (((New_Process_Name="*\\Microsoft Visual Studio*" OR New_Process_Name="*\\Microsoft SDK*" OR New_Process_Name="*\\Windows Kit*" OR New_Process_Name="*\\Windows Resource Kit\\*" OR New_Process_Name="*\\Microsoft.NET\\*")))))))) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.s0013 attack.defense_evasion attack.t1574.002" | eval sigma_title="Executable Used by PlugX in Uncommon Location" | eval sigma_description="Detects the execution of an executable that is typically used by PlugX for DLL side loading started from an uncommon location"
dispatch.earliest_time = -24h@h
alert.track = 0

[Executable Used by PlugX in Uncommon Location - sysmon]
description = Detects the execution of an executable that is typically used by PlugX for DLL side loading started from an uncommon location
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((((((((((((Image="*\\CamMute.exe" NOT (((Image="*\\Lenovo\\Communication Utility\\*" OR Image="*\\Lenovo\\Communications Utility\\*"))))) OR ((Image="*\\chrome_frame_helper.exe" NOT ((Image="*\\Google\\Chrome\\application\\*"))))) OR ((Image="*\\dvcemumanager.exe" NOT ((Image="*\\Microsoft Device Emulator\\*"))))) OR ((Image="*\\Gadget.exe" NOT ((Image="*\\Windows Media Player\\*"))))) OR ((Image="*\\hcc.exe" NOT ((Image="*\\HTML Help Workshop\\*"))))) OR ((Image="*\\hkcmd.exe" NOT (((Image="*\\System32\\*" OR Image="*\\SysNative\\*" OR Image="*\\SysWow64\\*")))))) OR ((Image="*\\Mc.exe" NOT (((Image="*\\Microsoft Visual Studio*" OR Image="*\\Microsoft SDK*" OR Image="*\\Windows Kit*")))))) OR ((Image="*\\MsMpEng.exe" NOT (((Image="*\\Microsoft Security Client\\*" OR Image="*\\Windows Defender\\*" OR Image="*\\AntiMalware\\*")))))) OR ((Image="*\\msseces.exe" NOT (((Image="*\\Microsoft Security Center\\*" OR Image="*\\Microsoft Security Client\\*" OR Image="*\\Microsoft Security Essentials\\*")))))) OR ((Image="*\\OInfoP11.exe" NOT ((Image="*\\Common Files\\Microsoft Shared\\*"))))) OR ((Image="*\\OleView.exe" NOT (((Image="*\\Microsoft Visual Studio*" OR Image="*\\Microsoft SDK*" OR Image="*\\Windows Kit*" OR Image="*\\Windows Resource Kit\\*")))))) OR ((Image="*\\rc.exe" NOT (((Image="*\\Microsoft Visual Studio*" OR Image="*\\Microsoft SDK*" OR Image="*\\Windows Kit*" OR Image="*\\Windows Resource Kit\\*" OR Image="*\\Microsoft.NET\\*")))))))) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.s0013 attack.defense_evasion attack.t1574.002" | eval sigma_title="Executable Used by PlugX in Uncommon Location" | eval sigma_description="Detects the execution of an executable that is typically used by PlugX for DLL side loading started from an uncommon location"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential Privilege Escalation via Service Permissions Weakness - winevent]
description = Detect modification of services configuration (ImagePath, FailureCommand and ServiceDLL) in registry by processes with Medium integrity level
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") IntegrityLevel="Medium" Process_Command_Line="*ControlSet*" Process_Command_Line="*services*" (Process_Command_Line="*\\ImagePath*" OR Process_Command_Line="*\\FailureCommand*" OR Process_Command_Line="*\\ServiceDll*"))) | eval sigma_attack_tags="attack.privilege_escalation attack.t1574.011" | eval sigma_title="Potential Privilege Escalation via Service Permissions Weakness" | eval sigma_description="Detect modification of services configuration (ImagePath, FailureCommand and ServiceDLL) in registry by processes with Medium integrity level"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential Privilege Escalation via Service Permissions Weakness - sysmon]
description = Detect modification of services configuration (ImagePath, FailureCommand and ServiceDLL) in registry by processes with Medium integrity level
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") IntegrityLevel="Medium" CommandLine="*ControlSet*" CommandLine="*services*" (CommandLine="*\\ImagePath*" OR CommandLine="*\\FailureCommand*" OR CommandLine="*\\ServiceDll*"))) | eval sigma_attack_tags="attack.privilege_escalation attack.t1574.011" | eval sigma_title="Potential Privilege Escalation via Service Permissions Weakness" | eval sigma_description="Detect modification of services configuration (ImagePath, FailureCommand and ServiceDLL) in registry by processes with Medium integrity level"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential Active Directory Enumeration Using AD Module - ProcCreation - winevent]
description = Detects usage of the 'Import-Module' cmdlet to load the 'Microsoft.ActiveDirectory.Management.dl' DLL. Which is often used by attackers to perform AD enumeration.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\powershell.exe" OR New_Process_Name="*\\pwsh.exe") OR (OriginalFileName="PowerShell.EXE" OR OriginalFileName="pwsh.dll")) (Process_Command_Line="*Import-Module *" OR Process_Command_Line="*ipmo *") Process_Command_Line="*Microsoft.ActiveDirectory.Management.dll*")) | eval sigma_attack_tags="attack.reconnaissance attack.discovery attack.impact" | eval sigma_title="Potential Active Directory Enumeration Using AD Module - ProcCreation" | eval sigma_description="Detects usage of the 'Import-Module' cmdlet to load the 'Microsoft.ActiveDirectory.Management.dl' DLL. Which is often used by attackers to perform AD enumeration."
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential Active Directory Enumeration Using AD Module - ProcCreation - sysmon]
description = Detects usage of the 'Import-Module' cmdlet to load the 'Microsoft.ActiveDirectory.Management.dl' DLL. Which is often used by attackers to perform AD enumeration.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\powershell.exe" OR Image="*\\pwsh.exe") OR (OriginalFileName="PowerShell.EXE" OR OriginalFileName="pwsh.dll")) (CommandLine="*Import-Module *" OR CommandLine="*ipmo *") CommandLine="*Microsoft.ActiveDirectory.Management.dll*")) | eval sigma_attack_tags="attack.reconnaissance attack.discovery attack.impact" | eval sigma_title="Potential Active Directory Enumeration Using AD Module - ProcCreation" | eval sigma_description="Detects usage of the 'Import-Module' cmdlet to load the 'Microsoft.ActiveDirectory.Management.dl' DLL. Which is often used by attackers to perform AD enumeration."
dispatch.earliest_time = -24h@h
alert.track = 0

[Add New Windows Capability - ProcCreation - winevent]
description = Detects usage of the 'Add-WindowsCapability' cmdlet to add new windows capabilities. Notable capabilities could be 'OpenSSH' and others.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\powershell.exe" OR New_Process_Name="*\\pwsh.exe") OR (OriginalFileName="PowerShell.EXE" OR OriginalFileName="pwsh.dll")) Process_Command_Line="*Add-WindowsCapability*" Process_Command_Line="*OpenSSH.*")) | eval sigma_attack_tags="attack.execution" | eval sigma_title="Add New Windows Capability - ProcCreation" | eval sigma_description="Detects usage of the 'Add-WindowsCapability' cmdlet to add new windows capabilities. Notable capabilities could be 'OpenSSH' and others."
dispatch.earliest_time = -24h@h
alert.track = 0

[Add New Windows Capability - ProcCreation - sysmon]
description = Detects usage of the 'Add-WindowsCapability' cmdlet to add new windows capabilities. Notable capabilities could be 'OpenSSH' and others.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\powershell.exe" OR Image="*\\pwsh.exe") OR (OriginalFileName="PowerShell.EXE" OR OriginalFileName="pwsh.dll")) CommandLine="*Add-WindowsCapability*" CommandLine="*OpenSSH.*")) | eval sigma_attack_tags="attack.execution" | eval sigma_title="Add New Windows Capability - ProcCreation" | eval sigma_description="Detects usage of the 'Add-WindowsCapability' cmdlet to add new windows capabilities. Notable capabilities could be 'OpenSSH' and others."
dispatch.earliest_time = -24h@h
alert.track = 0

[Powershell AMSI Bypass via .NET Reflection - winevent]
description = Detects Request to 'amsiInitFailed' that can be used to disable AMSI Scanning
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (Process_Command_Line="*System.Management.Automation.AmsiUtils*" OR Process_Command_Line="*amsiInitFailed*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.001" | eval sigma_title="Powershell AMSI Bypass via .NET Reflection" | eval sigma_description="Detects Request to 'amsiInitFailed' that can be used to disable AMSI Scanning"
dispatch.earliest_time = -24h@h
alert.track = 0

[Powershell AMSI Bypass via .NET Reflection - sysmon]
description = Detects Request to 'amsiInitFailed' that can be used to disable AMSI Scanning
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (CommandLine="*System.Management.Automation.AmsiUtils*" OR CommandLine="*amsiInitFailed*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.001" | eval sigma_title="Powershell AMSI Bypass via .NET Reflection" | eval sigma_description="Detects Request to 'amsiInitFailed' that can be used to disable AMSI Scanning"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential AMSI Bypass Using NULL Bits - ProcessCreation - winevent]
description = Detects usage of special strings/null bits in order to potentially bypass AMSI functionalities
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (Process_Command_Line="*if(0){{{0}}}' -f $(0 -as [char]) +*" OR Process_Command_Line="*#<NULL>*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.001" | eval sigma_title="Potential AMSI Bypass Using NULL Bits - ProcessCreation" | eval sigma_description="Detects usage of special strings/null bits in order to potentially bypass AMSI functionalities"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential AMSI Bypass Using NULL Bits - ProcessCreation - sysmon]
description = Detects usage of special strings/null bits in order to potentially bypass AMSI functionalities
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (CommandLine="*if(0){{{0}}}' -f $(0 -as [char]) +*" OR CommandLine="*#<NULL>*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.001" | eval sigma_title="Potential AMSI Bypass Using NULL Bits - ProcessCreation" | eval sigma_description="Detects usage of special strings/null bits in order to potentially bypass AMSI functionalities"
dispatch.earliest_time = -24h@h
alert.track = 0

[Audio Capture via PowerShell - winevent]
description = Detects audio capture via PowerShell Cmdlet.
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*WindowsAudioDevice-Powershell-Cmdlet*")) | eval sigma_attack_tags="attack.collection attack.t1123" | eval sigma_title="Audio Capture via PowerShell" | eval sigma_description="Detects audio capture via PowerShell Cmdlet."
dispatch.earliest_time = -24h@h
alert.track = 0

[Audio Capture via PowerShell - sysmon]
description = Detects audio capture via PowerShell Cmdlet.
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*WindowsAudioDevice-Powershell-Cmdlet*")) | eval sigma_attack_tags="attack.collection attack.t1123" | eval sigma_title="Audio Capture via PowerShell" | eval sigma_description="Detects audio capture via PowerShell Cmdlet."
dispatch.earliest_time = -24h@h
alert.track = 0

[PowerShell Base64 Encoded Invoke Keyword - winevent]
description = Detects UTF-8 and UTF-16 Base64 encoded powershell 'Invoke-' calls
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (Process_Command_Line="*SQBuAHYAbwBrAGUALQ*" OR Process_Command_Line="*kAbgB2AG8AawBlAC0A*" OR Process_Command_Line="*JAG4AdgBvAGsAZQAtA*" OR Process_Command_Line="*SW52b2tlL*" OR Process_Command_Line="*ludm9rZS*" OR Process_Command_Line="*JbnZva2Ut*"))) | eval sigma_attack_tags="attack.execution attack.t1059.001 attack.defense_evasion attack.t1027" | eval sigma_title="PowerShell Base64 Encoded Invoke Keyword" | eval sigma_description="Detects UTF-8 and UTF-16 Base64 encoded powershell 'Invoke-' calls"
dispatch.earliest_time = -24h@h
alert.track = 0

[PowerShell Base64 Encoded Invoke Keyword - sysmon]
description = Detects UTF-8 and UTF-16 Base64 encoded powershell 'Invoke-' calls
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (CommandLine="*SQBuAHYAbwBrAGUALQ*" OR CommandLine="*kAbgB2AG8AawBlAC0A*" OR CommandLine="*JAG4AdgBvAGsAZQAtA*" OR CommandLine="*SW52b2tlL*" OR CommandLine="*ludm9rZS*" OR CommandLine="*JbnZva2Ut*"))) | eval sigma_attack_tags="attack.execution attack.t1059.001 attack.defense_evasion attack.t1027" | eval sigma_title="PowerShell Base64 Encoded Invoke Keyword" | eval sigma_description="Detects UTF-8 and UTF-16 Base64 encoded powershell 'Invoke-' calls"
dispatch.earliest_time = -24h@h
alert.track = 0

[PowerShell Base64 Encoded Reflective Assembly Load - winevent]
description = Detects base64 encoded .NET reflective loading of Assembly
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (Process_Command_Line="*WwBSAGUAZgBsAGUAYwB0AGkAbwBuAC4AQQBzAHMAZQBtAGIAbAB5AF0AOgA6AEwAbwBhAGQAKA*" OR Process_Command_Line="*sAUgBlAGYAbABlAGMAdABpAG8AbgAuAEEAcwBzAGUAbQBiAGwAeQBdADoAOgBMAG8AYQBkACgA*" OR Process_Command_Line="*bAFIAZQBmAGwAZQBjAHQAaQBvAG4ALgBBAHMAcwBlAG0AYgBsAHkAXQA6ADoATABvAGEAZAAoA*" OR Process_Command_Line="*AFsAcgBlAGYAbABlAGMAdABpAG8AbgAuAGEAcwBzAGUAbQBiAGwAeQBdADoAOgAoACIATABvAGEAZAAiAC*" OR Process_Command_Line="*BbAHIAZQBmAGwAZQBjAHQAaQBvAG4ALgBhAHMAcwBlAG0AYgBsAHkAXQA6ADoAKAAiAEwAbwBhAGQAIgAp*" OR Process_Command_Line="*AWwByAGUAZgBsAGUAYwB0AGkAbwBuAC4AYQBzAHMAZQBtAGIAbAB5AF0AOgA6ACgAIgBMAG8AYQBkACIAK*" OR Process_Command_Line="*WwBSAGUAZgBsAGUAYwB0AGkAbwBuAC4AQQBzAHMAZQBtAGIAbAB5AF0AOgA6ACgAIgBMAG8AYQBkACIAKQ*" OR Process_Command_Line="*sAUgBlAGYAbABlAGMAdABpAG8AbgAuAEEAcwBzAGUAbQBiAGwAeQBdADoAOgAoACIATABvAGEAZAAiACkA*" OR Process_Command_Line="*bAFIAZQBmAGwAZQBjAHQAaQBvAG4ALgBBAHMAcwBlAG0AYgBsAHkAXQA6ADoAKAAiAEwAbwBhAGQAIgApA*" OR Process_Command_Line="*WwByAGUAZgBsAGUAYwB0AGkAbwBuAC4AYQBzAHMAZQBtAGIAbAB5AF0AOgA6AEwAbwBhAGQAKA*" OR Process_Command_Line="*sAcgBlAGYAbABlAGMAdABpAG8AbgAuAGEAcwBzAGUAbQBiAGwAeQBdADoAOgBMAG8AYQBkACgA*" OR Process_Command_Line="*bAHIAZQBmAGwAZQBjAHQAaQBvAG4ALgBhAHMAcwBlAG0AYgBsAHkAXQA6ADoATABvAGEAZAAoA*"))) | table Process_Command_Line | eval sigma_attack_tags="attack.execution attack.t1059.001 attack.defense_evasion attack.t1027 attack.t1620" | eval sigma_title="PowerShell Base64 Encoded Reflective Assembly Load" | eval sigma_description="Detects base64 encoded .NET reflective loading of Assembly"
dispatch.earliest_time = -24h@h
alert.track = 0

[PowerShell Base64 Encoded Reflective Assembly Load - sysmon]
description = Detects base64 encoded .NET reflective loading of Assembly
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (CommandLine="*WwBSAGUAZgBsAGUAYwB0AGkAbwBuAC4AQQBzAHMAZQBtAGIAbAB5AF0AOgA6AEwAbwBhAGQAKA*" OR CommandLine="*sAUgBlAGYAbABlAGMAdABpAG8AbgAuAEEAcwBzAGUAbQBiAGwAeQBdADoAOgBMAG8AYQBkACgA*" OR CommandLine="*bAFIAZQBmAGwAZQBjAHQAaQBvAG4ALgBBAHMAcwBlAG0AYgBsAHkAXQA6ADoATABvAGEAZAAoA*" OR CommandLine="*AFsAcgBlAGYAbABlAGMAdABpAG8AbgAuAGEAcwBzAGUAbQBiAGwAeQBdADoAOgAoACIATABvAGEAZAAiAC*" OR CommandLine="*BbAHIAZQBmAGwAZQBjAHQAaQBvAG4ALgBhAHMAcwBlAG0AYgBsAHkAXQA6ADoAKAAiAEwAbwBhAGQAIgAp*" OR CommandLine="*AWwByAGUAZgBsAGUAYwB0AGkAbwBuAC4AYQBzAHMAZQBtAGIAbAB5AF0AOgA6ACgAIgBMAG8AYQBkACIAK*" OR CommandLine="*WwBSAGUAZgBsAGUAYwB0AGkAbwBuAC4AQQBzAHMAZQBtAGIAbAB5AF0AOgA6ACgAIgBMAG8AYQBkACIAKQ*" OR CommandLine="*sAUgBlAGYAbABlAGMAdABpAG8AbgAuAEEAcwBzAGUAbQBiAGwAeQBdADoAOgAoACIATABvAGEAZAAiACkA*" OR CommandLine="*bAFIAZQBmAGwAZQBjAHQAaQBvAG4ALgBBAHMAcwBlAG0AYgBsAHkAXQA6ADoAKAAiAEwAbwBhAGQAIgApA*" OR CommandLine="*WwByAGUAZgBsAGUAYwB0AGkAbwBuAC4AYQBzAHMAZQBtAGIAbAB5AF0AOgA6AEwAbwBhAGQAKA*" OR CommandLine="*sAcgBlAGYAbABlAGMAdABpAG8AbgAuAGEAcwBzAGUAbQBiAGwAeQBdADoAOgBMAG8AYQBkACgA*" OR CommandLine="*bAHIAZQBmAGwAZQBjAHQAaQBvAG4ALgBhAHMAcwBlAG0AYgBsAHkAXQA6ADoATABvAGEAZAAoA*"))) | table CommandLine | eval sigma_attack_tags="attack.execution attack.t1059.001 attack.defense_evasion attack.t1027 attack.t1620" | eval sigma_title="PowerShell Base64 Encoded Reflective Assembly Load" | eval sigma_description="Detects base64 encoded .NET reflective loading of Assembly"
dispatch.earliest_time = -24h@h
alert.track = 0

[PowerShell Base64 Encoded Shellcode - winevent]
description = Detects Base64 encoded Shellcode
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (Process_Command_Line="*OiCAAAAYInlM*" OR Process_Command_Line="*OiJAAAAYInlM*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1027" | eval sigma_title="PowerShell Base64 Encoded Shellcode" | eval sigma_description="Detects Base64 encoded Shellcode"
dispatch.earliest_time = -24h@h
alert.track = 0

[PowerShell Base64 Encoded Shellcode - sysmon]
description = Detects Base64 encoded Shellcode
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (CommandLine="*OiCAAAAYInlM*" OR CommandLine="*OiJAAAAYInlM*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1027" | eval sigma_title="PowerShell Base64 Encoded Shellcode" | eval sigma_description="Detects Base64 encoded Shellcode"
dispatch.earliest_time = -24h@h
alert.track = 0

[PowerShell Base64 Encoded WMI Classes - winevent]
description = Detects calls to base64 encoded WMI class such as 'Win32_Shadowcopy', ''...etc.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\powershell.exe" OR New_Process_Name="*\\pwsh.exe") OR (OriginalFileName="PowerShell.EXE" OR OriginalFileName="pwsh.dll")) ((Process_Command_Line="*VwBpAG4AMwAyAF8AUwBoAGEAZABvAHcAYwBvAHAAeQ*" OR Process_Command_Line="*cAaQBuADMAMgBfAFMAaABhAGQAbwB3AGMAbwBwAHkA*" OR Process_Command_Line="*XAGkAbgAzADIAXwBTAGgAYQBkAG8AdwBjAG8AcAB5A*" OR Process_Command_Line="*V2luMzJfU2hhZG93Y29we*" OR Process_Command_Line="*dpbjMyX1NoYWRvd2NvcH*" OR Process_Command_Line="*XaW4zMl9TaGFkb3djb3B5*") OR (Process_Command_Line="*VwBpAG4AMwAyAF8AUwBjAGgAZQBkAHUAbABlAGQASgBvAGIA*" OR Process_Command_Line="*cAaQBuADMAMgBfAFMAYwBoAGUAZAB1AGwAZQBkAEoAbwBiA*" OR Process_Command_Line="*XAGkAbgAzADIAXwBTAGMAaABlAGQAdQBsAGUAZABKAG8AYg*" OR Process_Command_Line="*V2luMzJfU2NoZWR1bGVkSm9i*" OR Process_Command_Line="*dpbjMyX1NjaGVkdWxlZEpvY*" OR Process_Command_Line="*XaW4zMl9TY2hlZHVsZWRKb2*") OR (Process_Command_Line="*VwBpAG4AMwAyAF8AUAByAG8AYwBlAHMAcw*" OR Process_Command_Line="*cAaQBuADMAMgBfAFAAcgBvAGMAZQBzAHMA*" OR Process_Command_Line="*XAGkAbgAzADIAXwBQAHIAbwBjAGUAcwBzA*" OR Process_Command_Line="*V2luMzJfUHJvY2Vzc*" OR Process_Command_Line="*dpbjMyX1Byb2Nlc3*" OR Process_Command_Line="*XaW4zMl9Qcm9jZXNz*") OR (Process_Command_Line="*VwBpAG4AMwAyAF8AVQBzAGUAcgBBAGMAYwBvAHUAbgB0A*" OR Process_Command_Line="*cAaQBuADMAMgBfAFUAcwBlAHIAQQBjAGMAbwB1AG4AdA*" OR Process_Command_Line="*XAGkAbgAzADIAXwBVAHMAZQByAEEAYwBjAG8AdQBuAHQA*" OR Process_Command_Line="*V2luMzJfVXNlckFjY291bn*" OR Process_Command_Line="*dpbjMyX1VzZXJBY2NvdW50*" OR Process_Command_Line="*XaW4zMl9Vc2VyQWNjb3Vud*") OR (Process_Command_Line="*VwBpAG4AMwAyAF8ATABvAGcAZwBlAGQATwBuAFUAcwBlAHIA*" OR Process_Command_Line="*cAaQBuADMAMgBfAEwAbwBnAGcAZQBkAE8AbgBVAHMAZQByA*" OR Process_Command_Line="*XAGkAbgAzADIAXwBMAG8AZwBnAGUAZABPAG4AVQBzAGUAcg*" OR Process_Command_Line="*V2luMzJfTG9nZ2VkT25Vc2Vy*" OR Process_Command_Line="*dpbjMyX0xvZ2dlZE9uVXNlc*" OR Process_Command_Line="*XaW4zMl9Mb2dnZWRPblVzZX*")))) | eval sigma_attack_tags="attack.execution attack.t1059.001 attack.defense_evasion attack.t1027" | eval sigma_title="PowerShell Base64 Encoded WMI Classes" | eval sigma_description="Detects calls to base64 encoded WMI class such as 'Win32_Shadowcopy', ''...etc."
dispatch.earliest_time = -24h@h
alert.track = 0

[PowerShell Base64 Encoded WMI Classes - sysmon]
description = Detects calls to base64 encoded WMI class such as 'Win32_Shadowcopy', ''...etc.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\powershell.exe" OR Image="*\\pwsh.exe") OR (OriginalFileName="PowerShell.EXE" OR OriginalFileName="pwsh.dll")) ((CommandLine="*VwBpAG4AMwAyAF8AUwBoAGEAZABvAHcAYwBvAHAAeQ*" OR CommandLine="*cAaQBuADMAMgBfAFMAaABhAGQAbwB3AGMAbwBwAHkA*" OR CommandLine="*XAGkAbgAzADIAXwBTAGgAYQBkAG8AdwBjAG8AcAB5A*" OR CommandLine="*V2luMzJfU2hhZG93Y29we*" OR CommandLine="*dpbjMyX1NoYWRvd2NvcH*" OR CommandLine="*XaW4zMl9TaGFkb3djb3B5*") OR (CommandLine="*VwBpAG4AMwAyAF8AUwBjAGgAZQBkAHUAbABlAGQASgBvAGIA*" OR CommandLine="*cAaQBuADMAMgBfAFMAYwBoAGUAZAB1AGwAZQBkAEoAbwBiA*" OR CommandLine="*XAGkAbgAzADIAXwBTAGMAaABlAGQAdQBsAGUAZABKAG8AYg*" OR CommandLine="*V2luMzJfU2NoZWR1bGVkSm9i*" OR CommandLine="*dpbjMyX1NjaGVkdWxlZEpvY*" OR CommandLine="*XaW4zMl9TY2hlZHVsZWRKb2*") OR (CommandLine="*VwBpAG4AMwAyAF8AUAByAG8AYwBlAHMAcw*" OR CommandLine="*cAaQBuADMAMgBfAFAAcgBvAGMAZQBzAHMA*" OR CommandLine="*XAGkAbgAzADIAXwBQAHIAbwBjAGUAcwBzA*" OR CommandLine="*V2luMzJfUHJvY2Vzc*" OR CommandLine="*dpbjMyX1Byb2Nlc3*" OR CommandLine="*XaW4zMl9Qcm9jZXNz*") OR (CommandLine="*VwBpAG4AMwAyAF8AVQBzAGUAcgBBAGMAYwBvAHUAbgB0A*" OR CommandLine="*cAaQBuADMAMgBfAFUAcwBlAHIAQQBjAGMAbwB1AG4AdA*" OR CommandLine="*XAGkAbgAzADIAXwBVAHMAZQByAEEAYwBjAG8AdQBuAHQA*" OR CommandLine="*V2luMzJfVXNlckFjY291bn*" OR CommandLine="*dpbjMyX1VzZXJBY2NvdW50*" OR CommandLine="*XaW4zMl9Vc2VyQWNjb3Vud*") OR (CommandLine="*VwBpAG4AMwAyAF8ATABvAGcAZwBlAGQATwBuAFUAcwBlAHIA*" OR CommandLine="*cAaQBuADMAMgBfAEwAbwBnAGcAZQBkAE8AbgBVAHMAZQByA*" OR CommandLine="*XAGkAbgAzADIAXwBMAG8AZwBnAGUAZABPAG4AVQBzAGUAcg*" OR CommandLine="*V2luMzJfTG9nZ2VkT25Vc2Vy*" OR CommandLine="*dpbjMyX0xvZ2dlZE9uVXNlc*" OR CommandLine="*XaW4zMl9Mb2dnZWRPblVzZX*")))) | eval sigma_attack_tags="attack.execution attack.t1059.001 attack.defense_evasion attack.t1027" | eval sigma_title="PowerShell Base64 Encoded WMI Classes" | eval sigma_description="Detects calls to base64 encoded WMI class such as 'Win32_Shadowcopy', ''...etc."
dispatch.earliest_time = -24h@h
alert.track = 0

[ConvertTo-SecureString Cmdlet Usage Via CommandLine - winevent]
description = Detects usage of the 'ConvertTo-SecureString' cmdlet via the commandline. Which is fairly uncommon and could indicate potential suspicious activity
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\powershell.exe" OR New_Process_Name="*\\pwsh.exe") OR (OriginalFileName="PowerShell.EXE" OR OriginalFileName="pwsh.dll")) Process_Command_Line="*ConvertTo-SecureString*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1027 attack.execution attack.t1059.001" | eval sigma_title="ConvertTo-SecureString Cmdlet Usage Via CommandLine" | eval sigma_description="Detects usage of the 'ConvertTo-SecureString' cmdlet via the commandline. Which is fairly uncommon and could indicate potential suspicious activity"
dispatch.earliest_time = -24h@h
alert.track = 0

[ConvertTo-SecureString Cmdlet Usage Via CommandLine - sysmon]
description = Detects usage of the 'ConvertTo-SecureString' cmdlet via the commandline. Which is fairly uncommon and could indicate potential suspicious activity
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\powershell.exe" OR Image="*\\pwsh.exe") OR (OriginalFileName="PowerShell.EXE" OR OriginalFileName="pwsh.dll")) CommandLine="*ConvertTo-SecureString*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1027 attack.execution attack.t1059.001" | eval sigma_title="ConvertTo-SecureString Cmdlet Usage Via CommandLine" | eval sigma_description="Detects usage of the 'ConvertTo-SecureString' cmdlet via the commandline. Which is fairly uncommon and could indicate potential suspicious activity"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential PowerShell Obfuscation Via Reversed Commands - winevent]
description = Detects the presenece of reversed PowerShell commands in the CommandLine. This is often used as a method of obfuscation by attackers
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((((New_Process_Name="*\\powershell.exe" OR New_Process_Name="*\\pwsh.exe") OR (OriginalFileName="PowerShell.EXE" OR OriginalFileName="pwsh.dll")) (Process_Command_Line="*hctac*" OR Process_Command_Line="*kaerb*" OR Process_Command_Line="*dnammoc*" OR Process_Command_Line="*ekovn*" OR Process_Command_Line="*eliFd*" OR Process_Command_Line="*rahc*" OR Process_Command_Line="*etirw*" OR Process_Command_Line="*golon*" OR Process_Command_Line="*tninon*" OR Process_Command_Line="*eddih*" OR Process_Command_Line="*tpircS*" OR Process_Command_Line="*ssecorp*" OR Process_Command_Line="*llehsrewop*" OR Process_Command_Line="*esnopser*" OR Process_Command_Line="*daolnwod*" OR Process_Command_Line="*tneilCbeW*" OR Process_Command_Line="*tneilc*" OR Process_Command_Line="*ptth*" OR Process_Command_Line="*elifotevas*" OR Process_Command_Line="*46esab*" OR Process_Command_Line="*htaPpmeTteG*" OR Process_Command_Line="*tcejbO*" OR Process_Command_Line="*maerts*" OR Process_Command_Line="*hcaerof*" OR Process_Command_Line="*retupmoc*"))) NOT (((Creator_Process_Name="C:\\Windows\\System32\\cmd.exe" (Process_Command_Line="*-EncodedCommand*" Process_Command_Line="*rahc*")))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1027 attack.execution attack.t1059.001" | eval sigma_title="Potential PowerShell Obfuscation Via Reversed Commands" | eval sigma_description="Detects the presenece of reversed PowerShell commands in the CommandLine. This is often used as a method of obfuscation by attackers"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential PowerShell Obfuscation Via Reversed Commands - sysmon]
description = Detects the presenece of reversed PowerShell commands in the CommandLine. This is often used as a method of obfuscation by attackers
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((((Image="*\\powershell.exe" OR Image="*\\pwsh.exe") OR (OriginalFileName="PowerShell.EXE" OR OriginalFileName="pwsh.dll")) (CommandLine="*hctac*" OR CommandLine="*kaerb*" OR CommandLine="*dnammoc*" OR CommandLine="*ekovn*" OR CommandLine="*eliFd*" OR CommandLine="*rahc*" OR CommandLine="*etirw*" OR CommandLine="*golon*" OR CommandLine="*tninon*" OR CommandLine="*eddih*" OR CommandLine="*tpircS*" OR CommandLine="*ssecorp*" OR CommandLine="*llehsrewop*" OR CommandLine="*esnopser*" OR CommandLine="*daolnwod*" OR CommandLine="*tneilCbeW*" OR CommandLine="*tneilc*" OR CommandLine="*ptth*" OR CommandLine="*elifotevas*" OR CommandLine="*46esab*" OR CommandLine="*htaPpmeTteG*" OR CommandLine="*tcejbO*" OR CommandLine="*maerts*" OR CommandLine="*hcaerof*" OR CommandLine="*retupmoc*"))) NOT (((ParentImage="C:\\Windows\\System32\\cmd.exe" (CommandLine="*-EncodedCommand*" CommandLine="*rahc*")))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1027 attack.execution attack.t1059.001" | eval sigma_title="Potential PowerShell Obfuscation Via Reversed Commands" | eval sigma_description="Detects the presenece of reversed PowerShell commands in the CommandLine. This is often used as a method of obfuscation by attackers"
dispatch.earliest_time = -24h@h
alert.track = 0

[Powershell Defender Exclusion - winevent]
description = Detects requests to exclude files, folders or processes from Antivirus scanning using PowerShell cmdlets
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (Process_Command_Line="*Add-MpPreference *" OR Process_Command_Line="*Set-MpPreference *") (Process_Command_Line="* -ExclusionPath *" OR Process_Command_Line="* -ExclusionExtension *" OR Process_Command_Line="* -ExclusionProcess *" OR Process_Command_Line="* -ExclusionIpAddress *"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.001" | eval sigma_title="Powershell Defender Exclusion" | eval sigma_description="Detects requests to exclude files, folders or processes from Antivirus scanning using PowerShell cmdlets"
dispatch.earliest_time = -24h@h
alert.track = 0

[Powershell Defender Exclusion - sysmon]
description = Detects requests to exclude files, folders or processes from Antivirus scanning using PowerShell cmdlets
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (CommandLine="*Add-MpPreference *" OR CommandLine="*Set-MpPreference *") (CommandLine="* -ExclusionPath *" OR CommandLine="* -ExclusionExtension *" OR CommandLine="* -ExclusionProcess *" OR CommandLine="* -ExclusionIpAddress *"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.001" | eval sigma_title="Powershell Defender Exclusion" | eval sigma_description="Detects requests to exclude files, folders or processes from Antivirus scanning using PowerShell cmdlets"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential PowerShell Execution Via DLL - winevent]
description = Detects potential PowerShell execution from a DLL instead of the usual PowerShell process as seen used in PowerShdll
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\rundll32.exe" OR New_Process_Name="*\\regsvcs.exe" OR New_Process_Name="*\\InstallUtil.exe" OR New_Process_Name="*\\regasm.exe") OR (OriginalFileName="RUNDLL32.EXE" OR OriginalFileName="RegSvcs.exe" OR OriginalFileName="InstallUtil.exe" OR OriginalFileName="RegAsm.exe")) (Process_Command_Line="*Default.GetString*" OR Process_Command_Line="*FromBase64String*" OR Process_Command_Line="*Invoke-Expression*" OR Process_Command_Line="*IEX *" OR Process_Command_Line="*Invoke-Command*" OR Process_Command_Line="*ICM *" OR Process_Command_Line="*DownloadString*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218.011" | eval sigma_title="Potential PowerShell Execution Via DLL" | eval sigma_description="Detects potential PowerShell execution from a DLL instead of the usual PowerShell process as seen used in PowerShdll"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential PowerShell Execution Via DLL - sysmon]
description = Detects potential PowerShell execution from a DLL instead of the usual PowerShell process as seen used in PowerShdll
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\rundll32.exe" OR Image="*\\regsvcs.exe" OR Image="*\\InstallUtil.exe" OR Image="*\\regasm.exe") OR (OriginalFileName="RUNDLL32.EXE" OR OriginalFileName="RegSvcs.exe" OR OriginalFileName="InstallUtil.exe" OR OriginalFileName="RegAsm.exe")) (CommandLine="*Default.GetString*" OR CommandLine="*FromBase64String*" OR CommandLine="*Invoke-Expression*" OR CommandLine="*IEX *" OR CommandLine="*Invoke-Command*" OR CommandLine="*ICM *" OR CommandLine="*DownloadString*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218.011" | eval sigma_title="Potential PowerShell Execution Via DLL" | eval sigma_description="Detects potential PowerShell execution from a DLL instead of the usual PowerShell process as seen used in PowerShdll"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential PowerShell Downgrade Attack - winevent]
description = Detects PowerShell downgrade attack by comparing the host versions with the actually used engine version 2.0
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\powershell.exe" (Process_Command_Line="* -version 2 *" OR Process_Command_Line="* -versio 2 *" OR Process_Command_Line="* -versi 2 *" OR Process_Command_Line="* -vers 2 *" OR Process_Command_Line="* -ver 2 *" OR Process_Command_Line="* -ve 2 *" OR Process_Command_Line="* -v 2 *"))) | eval sigma_attack_tags="attack.defense_evasion attack.execution attack.t1059.001" | eval sigma_title="Potential PowerShell Downgrade Attack" | eval sigma_description="Detects PowerShell downgrade attack by comparing the host versions with the actually used engine version 2.0"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential PowerShell Downgrade Attack - sysmon]
description = Detects PowerShell downgrade attack by comparing the host versions with the actually used engine version 2.0
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\powershell.exe" (CommandLine="* -version 2 *" OR CommandLine="* -versio 2 *" OR CommandLine="* -versi 2 *" OR CommandLine="* -vers 2 *" OR CommandLine="* -ver 2 *" OR CommandLine="* -ve 2 *" OR CommandLine="* -v 2 *"))) | eval sigma_attack_tags="attack.defense_evasion attack.execution attack.t1059.001" | eval sigma_title="Potential PowerShell Downgrade Attack" | eval sigma_description="Detects PowerShell downgrade attack by comparing the host versions with the actually used engine version 2.0"
dispatch.earliest_time = -24h@h
alert.track = 0

[PowerShell Download Pattern - winevent]
description = Detects a Powershell process that contains download commands in its command line string
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\powershell.exe" OR New_Process_Name="*\\pwsh.exe") OR (OriginalFileName="PowerShell.EXE" OR OriginalFileName="pwsh.dll")) ((Process_Command_Line="*new-object*" Process_Command_Line="*net.webclient).*" Process_Command_Line="*download*" (Process_Command_Line="*string(*" OR Process_Command_Line="*file(*"))))) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.execution attack.t1059.001" | eval sigma_title="PowerShell Download Pattern" | eval sigma_description="Detects a Powershell process that contains download commands in its command line string"
dispatch.earliest_time = -24h@h
alert.track = 0

[PowerShell Download Pattern - sysmon]
description = Detects a Powershell process that contains download commands in its command line string
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\powershell.exe" OR Image="*\\pwsh.exe") OR (OriginalFileName="PowerShell.EXE" OR OriginalFileName="pwsh.dll")) ((CommandLine="*new-object*" CommandLine="*net.webclient).*" CommandLine="*download*" (CommandLine="*string(*" OR CommandLine="*file(*"))))) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.execution attack.t1059.001" | eval sigma_title="PowerShell Download Pattern" | eval sigma_description="Detects a Powershell process that contains download commands in its command line string"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential Encoded PowerShell Patterns In CommandLine - winevent]
description = Detects specific combinations of encoding methods in PowerShell via the commandline
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\powershell.exe" OR New_Process_Name="*\\pwsh.exe") OR (OriginalFileName="PowerShell.EXE" OR OriginalFileName="pwsh.dll")) ((((Process_Command_Line="*ToInt*" OR Process_Command_Line="*ToDecimal*" OR Process_Command_Line="*ToByte*" OR Process_Command_Line="*ToUint*" OR Process_Command_Line="*ToSingle*" OR Process_Command_Line="*ToSByte*") (Process_Command_Line="*ToChar*" OR Process_Command_Line="*ToString*" OR Process_Command_Line="*String*"))) OR (((Process_Command_Line="*char*" Process_Command_Line="*join*")) OR ((Process_Command_Line="*split*" Process_Command_Line="*join*")))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1027 attack.execution attack.t1059.001" | eval sigma_title="Potential Encoded PowerShell Patterns In CommandLine" | eval sigma_description="Detects specific combinations of encoding methods in PowerShell via the commandline"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential Encoded PowerShell Patterns In CommandLine - sysmon]
description = Detects specific combinations of encoding methods in PowerShell via the commandline
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\powershell.exe" OR Image="*\\pwsh.exe") OR (OriginalFileName="PowerShell.EXE" OR OriginalFileName="pwsh.dll")) ((((CommandLine="*ToInt*" OR CommandLine="*ToDecimal*" OR CommandLine="*ToByte*" OR CommandLine="*ToUint*" OR CommandLine="*ToSingle*" OR CommandLine="*ToSByte*") (CommandLine="*ToChar*" OR CommandLine="*ToString*" OR CommandLine="*String*"))) OR (((CommandLine="*char*" CommandLine="*join*")) OR ((CommandLine="*split*" CommandLine="*join*")))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1027 attack.execution attack.t1059.001" | eval sigma_title="Potential Encoded PowerShell Patterns In CommandLine" | eval sigma_description="Detects specific combinations of encoding methods in PowerShell via the commandline"
dispatch.earliest_time = -24h@h
alert.track = 0

[Base64 Encoded PowerShell Command Detected - winevent]
description = Detects usage of the 'FromBase64String' function in the commandline which is used to decode a base64 encoded string
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*::FromBase64String(*")) | eval sigma_attack_tags="attack.t1027 attack.defense_evasion attack.t1140 attack.t1059.001" | eval sigma_title="Base64 Encoded PowerShell Command Detected" | eval sigma_description="Detects usage of the 'FromBase64String' function in the commandline which is used to decode a base64 encoded string"
dispatch.earliest_time = -24h@h
alert.track = 0

[Base64 Encoded PowerShell Command Detected - sysmon]
description = Detects usage of the 'FromBase64String' function in the commandline which is used to decode a base64 encoded string
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*::FromBase64String(*")) | eval sigma_attack_tags="attack.t1027 attack.defense_evasion attack.t1140 attack.t1059.001" | eval sigma_title="Base64 Encoded PowerShell Command Detected" | eval sigma_description="Detects usage of the 'FromBase64String' function in the commandline which is used to decode a base64 encoded string"
dispatch.earliest_time = -24h@h
alert.track = 0

[PowerShell Get-Clipboard Cmdlet Via CLI - winevent]
description = Detects usage of the 'Get-Clipboard' cmdlet via CLI
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*Get-Clipboard*")) | eval sigma_attack_tags="attack.collection attack.t1115" | eval sigma_title="PowerShell Get-Clipboard Cmdlet Via CLI" | eval sigma_description="Detects usage of the 'Get-Clipboard' cmdlet via CLI"
dispatch.earliest_time = -24h@h
alert.track = 0

[PowerShell Get-Clipboard Cmdlet Via CLI - sysmon]
description = Detects usage of the 'Get-Clipboard' cmdlet via CLI
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*Get-Clipboard*")) | eval sigma_attack_tags="attack.collection attack.t1115" | eval sigma_title="PowerShell Get-Clipboard Cmdlet Via CLI" | eval sigma_description="Detects usage of the 'Get-Clipboard' cmdlet via CLI"
dispatch.earliest_time = -24h@h
alert.track = 0

[Execution of Powershell Script in Public Folder - winevent]
description = This rule detects execution of PowerShell scripts located in the 'C:\Users\Public' folder
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (New_Process_Name="*\\powershell.exe" OR New_Process_Name="*\\pwsh.exe") (Process_Command_Line="*-f C:\\Users\\Public*" OR Process_Command_Line="*-f \"C:\\Users\\Public*" OR Process_Command_Line="*-f %Public%*" OR Process_Command_Line="*-fi C:\\Users\\Public*" OR Process_Command_Line="*-fi \"C:\\Users\\Public*" OR Process_Command_Line="*-fi %Public%*" OR Process_Command_Line="*-fil C:\\Users\\Public*" OR Process_Command_Line="*-fil \"C:\\Users\\Public*" OR Process_Command_Line="*-fil %Public%*" OR Process_Command_Line="*-file C:\\Users\\Public*" OR Process_Command_Line="*-file \"C:\\Users\\Public*" OR Process_Command_Line="*-file %Public%*"))) | table Process_Command_Line | eval sigma_attack_tags="" | eval sigma_title="Execution of Powershell Script in Public Folder" | eval sigma_description="This rule detects execution of PowerShell scripts located in the 'C:\Users\Public' folder"
dispatch.earliest_time = -24h@h
alert.track = 0

[Execution of Powershell Script in Public Folder - sysmon]
description = This rule detects execution of PowerShell scripts located in the 'C:\Users\Public' folder
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (Image="*\\powershell.exe" OR Image="*\\pwsh.exe") (CommandLine="*-f C:\\Users\\Public*" OR CommandLine="*-f \"C:\\Users\\Public*" OR CommandLine="*-f %Public%*" OR CommandLine="*-fi C:\\Users\\Public*" OR CommandLine="*-fi \"C:\\Users\\Public*" OR CommandLine="*-fi %Public%*" OR CommandLine="*-fil C:\\Users\\Public*" OR CommandLine="*-fil \"C:\\Users\\Public*" OR CommandLine="*-fil %Public%*" OR CommandLine="*-file C:\\Users\\Public*" OR CommandLine="*-file \"C:\\Users\\Public*" OR CommandLine="*-file %Public%*"))) | table CommandLine | eval sigma_attack_tags="" | eval sigma_title="Execution of Powershell Script in Public Folder" | eval sigma_description="This rule detects execution of PowerShell scripts located in the 'C:\Users\Public' folder"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential Powershell ReverseShell Connection - winevent]
description = Detects usage of the 'TcpClient' class. Which can be abused to establish remote connections and reverse-shells. As seen used by the Nishang 'Invoke-PowerShellTcpOneLine' reverse shell.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((OriginalFileName="PowerShell.EXE" OR OriginalFileName="pwsh.dll") OR (New_Process_Name="*\\powershell.exe" OR New_Process_Name="*\\pwsh.exe")) ((Process_Command_Line="* System.Net.Sockets.TCPClient*" Process_Command_Line="*.GetBytes*" Process_Command_Line="*.Write*")))) | eval sigma_attack_tags="attack.execution attack.t1059.001" | eval sigma_title="Potential Powershell ReverseShell Connection" | eval sigma_description="Detects usage of the 'TcpClient' class. Which can be abused to establish remote connections and reverse-shells. As seen used by the Nishang 'Invoke-PowerShellTcpOneLine' reverse shell."
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential Powershell ReverseShell Connection - sysmon]
description = Detects usage of the 'TcpClient' class. Which can be abused to establish remote connections and reverse-shells. As seen used by the Nishang 'Invoke-PowerShellTcpOneLine' reverse shell.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((OriginalFileName="PowerShell.EXE" OR OriginalFileName="pwsh.dll") OR (Image="*\\powershell.exe" OR Image="*\\pwsh.exe")) ((CommandLine="* System.Net.Sockets.TCPClient*" CommandLine="*.GetBytes*" CommandLine="*.Write*")))) | eval sigma_attack_tags="attack.execution attack.t1059.001" | eval sigma_title="Potential Powershell ReverseShell Connection" | eval sigma_description="Detects usage of the 'TcpClient' class. Which can be abused to establish remote connections and reverse-shells. As seen used by the Nishang 'Invoke-PowerShellTcpOneLine' reverse shell."
dispatch.earliest_time = -24h@h
alert.track = 0

[Exchange PowerShell Snap-Ins Usage - winevent]
description = Detects adding and using Exchange PowerShell snap-ins to export mailbox data. As seen used by HAFNIUM and APT27
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\powershell.exe" OR New_Process_Name="*\\pwsh.exe") OR (OriginalFileName="PowerShell.EXE" OR OriginalFileName="pwsh.dll")) Process_Command_Line="*Add-PSSnapin*" (Process_Command_Line="*Microsoft.Exchange.Powershell.Snapin*" OR Process_Command_Line="*Microsoft.Exchange.Management.PowerShell.SnapIn*"))) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.execution attack.t1059.001 attack.collection attack.t1114" | eval sigma_title="Exchange PowerShell Snap-Ins Usage" | eval sigma_description="Detects adding and using Exchange PowerShell snap-ins to export mailbox data. As seen used by HAFNIUM and APT27"
dispatch.earliest_time = -24h@h
alert.track = 0

[Exchange PowerShell Snap-Ins Usage - sysmon]
description = Detects adding and using Exchange PowerShell snap-ins to export mailbox data. As seen used by HAFNIUM and APT27
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\powershell.exe" OR Image="*\\pwsh.exe") OR (OriginalFileName="PowerShell.EXE" OR OriginalFileName="pwsh.dll")) CommandLine="*Add-PSSnapin*" (CommandLine="*Microsoft.Exchange.Powershell.Snapin*" OR CommandLine="*Microsoft.Exchange.Management.PowerShell.SnapIn*"))) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.execution attack.t1059.001 attack.collection attack.t1114" | eval sigma_title="Exchange PowerShell Snap-Ins Usage" | eval sigma_description="Detects adding and using Exchange PowerShell snap-ins to export mailbox data. As seen used by HAFNIUM and APT27"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious PowerShell Download and Execute Pattern - winevent]
description = Detects suspicious PowerShell download patterns that are often used in malicious scripts, stagers or downloaders (make sure that your backend applies the strings case-insensitive)
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (Process_Command_Line="*IEX ((New-Object Net.WebClient).DownloadString*" OR Process_Command_Line="*IEX (New-Object Net.WebClient).DownloadString*" OR Process_Command_Line="*IEX((New-Object Net.WebClient).DownloadString*" OR Process_Command_Line="*IEX(New-Object Net.WebClient).DownloadString*" OR Process_Command_Line="* -command (New-Object System.Net.WebClient).DownloadFile(*" OR Process_Command_Line="* -c (New-Object System.Net.WebClient).DownloadFile(*"))) | eval sigma_attack_tags="attack.execution attack.t1059.001" | eval sigma_title="Suspicious PowerShell Download and Execute Pattern" | eval sigma_description="Detects suspicious PowerShell download patterns that are often used in malicious scripts, stagers or downloaders (make sure that your backend applies the strings case-insensitive)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious PowerShell Download and Execute Pattern - sysmon]
description = Detects suspicious PowerShell download patterns that are often used in malicious scripts, stagers or downloaders (make sure that your backend applies the strings case-insensitive)
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (CommandLine="*IEX ((New-Object Net.WebClient).DownloadString*" OR CommandLine="*IEX (New-Object Net.WebClient).DownloadString*" OR CommandLine="*IEX((New-Object Net.WebClient).DownloadString*" OR CommandLine="*IEX(New-Object Net.WebClient).DownloadString*" OR CommandLine="* -command (New-Object System.Net.WebClient).DownloadFile(*" OR CommandLine="* -c (New-Object System.Net.WebClient).DownloadFile(*"))) | eval sigma_attack_tags="attack.execution attack.t1059.001" | eval sigma_title="Suspicious PowerShell Download and Execute Pattern" | eval sigma_description="Detects suspicious PowerShell download patterns that are often used in malicious scripts, stagers or downloaders (make sure that your backend applies the strings case-insensitive)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious PowerShell Parameter Substring - winevent]
description = Detects suspicious PowerShell invocation with a parameter substring
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (New_Process_Name="*\\powershell.exe" OR New_Process_Name="*\\pwsh.exe") (Process_Command_Line="* -windowstyle h *" OR Process_Command_Line="* -windowstyl h*" OR Process_Command_Line="* -windowsty h*" OR Process_Command_Line="* -windowst h*" OR Process_Command_Line="* -windows h*" OR Process_Command_Line="* -windo h*" OR Process_Command_Line="* -wind h*" OR Process_Command_Line="* -win h*" OR Process_Command_Line="* -wi h*" OR Process_Command_Line="* -win h *" OR Process_Command_Line="* -win hi *" OR Process_Command_Line="* -win hid *" OR Process_Command_Line="* -win hidd *" OR Process_Command_Line="* -win hidde *" OR Process_Command_Line="* -NoPr *" OR Process_Command_Line="* -NoPro *" OR Process_Command_Line="* -NoProf *" OR Process_Command_Line="* -NoProfi *" OR Process_Command_Line="* -NoProfil *" OR Process_Command_Line="* -nonin *" OR Process_Command_Line="* -nonint *" OR Process_Command_Line="* -noninte *" OR Process_Command_Line="* -noninter *" OR Process_Command_Line="* -nonintera *" OR Process_Command_Line="* -noninterac *" OR Process_Command_Line="* -noninteract *" OR Process_Command_Line="* -noninteracti *" OR Process_Command_Line="* -noninteractiv *" OR Process_Command_Line="* -ec *" OR Process_Command_Line="* -encodedComman *" OR Process_Command_Line="* -encodedComma *" OR Process_Command_Line="* -encodedComm *" OR Process_Command_Line="* -encodedCom *" OR Process_Command_Line="* -encodedCo *" OR Process_Command_Line="* -encodedC *" OR Process_Command_Line="* -encoded *" OR Process_Command_Line="* -encode *" OR Process_Command_Line="* -encod *" OR Process_Command_Line="* -enco *" OR Process_Command_Line="* -en *" OR Process_Command_Line="* -executionpolic *" OR Process_Command_Line="* -executionpoli *" OR Process_Command_Line="* -executionpol *" OR Process_Command_Line="* -executionpo *" OR Process_Command_Line="* -executionp *" OR Process_Command_Line="* -execution bypass*" OR Process_Command_Line="* -executio bypass*" OR Process_Command_Line="* -executi bypass*" OR Process_Command_Line="* -execut bypass*" OR Process_Command_Line="* -execu bypass*" OR Process_Command_Line="* -exec bypass*" OR Process_Command_Line="* -exe bypass*" OR Process_Command_Line="* -ex bypass*" OR Process_Command_Line="* -ep bypass*" OR Process_Command_Line="* /windowstyle h *" OR Process_Command_Line="* /windowstyl h*" OR Process_Command_Line="* /windowsty h*" OR Process_Command_Line="* /windowst h*" OR Process_Command_Line="* /windows h*" OR Process_Command_Line="* /windo h*" OR Process_Command_Line="* /wind h*" OR Process_Command_Line="* /win h*" OR Process_Command_Line="* /wi h*" OR Process_Command_Line="* /win h *" OR Process_Command_Line="* /win hi *" OR Process_Command_Line="* /win hid *" OR Process_Command_Line="* /win hidd *" OR Process_Command_Line="* /win hidde *" OR Process_Command_Line="* /NoPr *" OR Process_Command_Line="* /NoPro *" OR Process_Command_Line="* /NoProf *" OR Process_Command_Line="* /NoProfi *" OR Process_Command_Line="* /NoProfil *" OR Process_Command_Line="* /nonin *" OR Process_Command_Line="* /nonint *" OR Process_Command_Line="* /noninte *" OR Process_Command_Line="* /noninter *" OR Process_Command_Line="* /nonintera *" OR Process_Command_Line="* /noninterac *" OR Process_Command_Line="* /noninteract *" OR Process_Command_Line="* /noninteracti *" OR Process_Command_Line="* /noninteractiv *" OR Process_Command_Line="* /ec *" OR Process_Command_Line="* /encodedComman *" OR Process_Command_Line="* /encodedComma *" OR Process_Command_Line="* /encodedComm *" OR Process_Command_Line="* /encodedCom *" OR Process_Command_Line="* /encodedCo *" OR Process_Command_Line="* /encodedC *" OR Process_Command_Line="* /encoded *" OR Process_Command_Line="* /encode *" OR Process_Command_Line="* /encod *" OR Process_Command_Line="* /enco *" OR Process_Command_Line="* /en *" OR Process_Command_Line="* /executionpolic *" OR Process_Command_Line="* /executionpoli *" OR Process_Command_Line="* /executionpol *" OR Process_Command_Line="* /executionpo *" OR Process_Command_Line="* /executionp *" OR Process_Command_Line="* /execution bypass*" OR Process_Command_Line="* /executio bypass*" OR Process_Command_Line="* /executi bypass*" OR Process_Command_Line="* /execut bypass*" OR Process_Command_Line="* /execu bypass*" OR Process_Command_Line="* /exec bypass*" OR Process_Command_Line="* /exe bypass*" OR Process_Command_Line="* /ex bypass*" OR Process_Command_Line="* /ep bypass*"))) | eval sigma_attack_tags="attack.execution attack.t1059.001" | eval sigma_title="Suspicious PowerShell Parameter Substring" | eval sigma_description="Detects suspicious PowerShell invocation with a parameter substring"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious PowerShell Parameter Substring - sysmon]
description = Detects suspicious PowerShell invocation with a parameter substring
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (Image="*\\powershell.exe" OR Image="*\\pwsh.exe") (CommandLine="* -windowstyle h *" OR CommandLine="* -windowstyl h*" OR CommandLine="* -windowsty h*" OR CommandLine="* -windowst h*" OR CommandLine="* -windows h*" OR CommandLine="* -windo h*" OR CommandLine="* -wind h*" OR CommandLine="* -win h*" OR CommandLine="* -wi h*" OR CommandLine="* -win h *" OR CommandLine="* -win hi *" OR CommandLine="* -win hid *" OR CommandLine="* -win hidd *" OR CommandLine="* -win hidde *" OR CommandLine="* -NoPr *" OR CommandLine="* -NoPro *" OR CommandLine="* -NoProf *" OR CommandLine="* -NoProfi *" OR CommandLine="* -NoProfil *" OR CommandLine="* -nonin *" OR CommandLine="* -nonint *" OR CommandLine="* -noninte *" OR CommandLine="* -noninter *" OR CommandLine="* -nonintera *" OR CommandLine="* -noninterac *" OR CommandLine="* -noninteract *" OR CommandLine="* -noninteracti *" OR CommandLine="* -noninteractiv *" OR CommandLine="* -ec *" OR CommandLine="* -encodedComman *" OR CommandLine="* -encodedComma *" OR CommandLine="* -encodedComm *" OR CommandLine="* -encodedCom *" OR CommandLine="* -encodedCo *" OR CommandLine="* -encodedC *" OR CommandLine="* -encoded *" OR CommandLine="* -encode *" OR CommandLine="* -encod *" OR CommandLine="* -enco *" OR CommandLine="* -en *" OR CommandLine="* -executionpolic *" OR CommandLine="* -executionpoli *" OR CommandLine="* -executionpol *" OR CommandLine="* -executionpo *" OR CommandLine="* -executionp *" OR CommandLine="* -execution bypass*" OR CommandLine="* -executio bypass*" OR CommandLine="* -executi bypass*" OR CommandLine="* -execut bypass*" OR CommandLine="* -execu bypass*" OR CommandLine="* -exec bypass*" OR CommandLine="* -exe bypass*" OR CommandLine="* -ex bypass*" OR CommandLine="* -ep bypass*" OR CommandLine="* /windowstyle h *" OR CommandLine="* /windowstyl h*" OR CommandLine="* /windowsty h*" OR CommandLine="* /windowst h*" OR CommandLine="* /windows h*" OR CommandLine="* /windo h*" OR CommandLine="* /wind h*" OR CommandLine="* /win h*" OR CommandLine="* /wi h*" OR CommandLine="* /win h *" OR CommandLine="* /win hi *" OR CommandLine="* /win hid *" OR CommandLine="* /win hidd *" OR CommandLine="* /win hidde *" OR CommandLine="* /NoPr *" OR CommandLine="* /NoPro *" OR CommandLine="* /NoProf *" OR CommandLine="* /NoProfi *" OR CommandLine="* /NoProfil *" OR CommandLine="* /nonin *" OR CommandLine="* /nonint *" OR CommandLine="* /noninte *" OR CommandLine="* /noninter *" OR CommandLine="* /nonintera *" OR CommandLine="* /noninterac *" OR CommandLine="* /noninteract *" OR CommandLine="* /noninteracti *" OR CommandLine="* /noninteractiv *" OR CommandLine="* /ec *" OR CommandLine="* /encodedComman *" OR CommandLine="* /encodedComma *" OR CommandLine="* /encodedComm *" OR CommandLine="* /encodedCom *" OR CommandLine="* /encodedCo *" OR CommandLine="* /encodedC *" OR CommandLine="* /encoded *" OR CommandLine="* /encode *" OR CommandLine="* /encod *" OR CommandLine="* /enco *" OR CommandLine="* /en *" OR CommandLine="* /executionpolic *" OR CommandLine="* /executionpoli *" OR CommandLine="* /executionpol *" OR CommandLine="* /executionpo *" OR CommandLine="* /executionp *" OR CommandLine="* /execution bypass*" OR CommandLine="* /executio bypass*" OR CommandLine="* /executi bypass*" OR CommandLine="* /execut bypass*" OR CommandLine="* /execu bypass*" OR CommandLine="* /exec bypass*" OR CommandLine="* /exe bypass*" OR CommandLine="* /ex bypass*" OR CommandLine="* /ep bypass*"))) | eval sigma_attack_tags="attack.execution attack.t1059.001" | eval sigma_title="Suspicious PowerShell Parameter Substring" | eval sigma_description="Detects suspicious PowerShell invocation with a parameter substring"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious XOR Encoded PowerShell Command - winevent]
description = Detects presence of a potentially xor encoded powershell command
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\powershell.exe" OR New_Process_Name="*\\pwsh.exe") OR (OriginalFileName="PowerShell.EXE" OR OriginalFileName="pwsh.dll") OR Description="Windows PowerShell" OR Product="PowerShell Core 6") Process_Command_Line="*bxor*" (Process_Command_Line="*ForEach*" OR Process_Command_Line="*for(*" OR Process_Command_Line="*for *" OR Process_Command_Line="*-join *" OR Process_Command_Line="*-join'*" OR Process_Command_Line="*-join\"*" OR Process_Command_Line="*-join`*" OR Process_Command_Line="*::Join*" OR Process_Command_Line="*[char]*"))) | eval sigma_attack_tags="attack.defense_evasion attack.execution attack.t1059.001 attack.t1140 attack.t1027" | eval sigma_title="Suspicious XOR Encoded PowerShell Command" | eval sigma_description="Detects presence of a potentially xor encoded powershell command"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious XOR Encoded PowerShell Command - sysmon]
description = Detects presence of a potentially xor encoded powershell command
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\powershell.exe" OR Image="*\\pwsh.exe") OR (OriginalFileName="PowerShell.EXE" OR OriginalFileName="pwsh.dll") OR Description="Windows PowerShell" OR Product="PowerShell Core 6") CommandLine="*bxor*" (CommandLine="*ForEach*" OR CommandLine="*for(*" OR CommandLine="*for *" OR CommandLine="*-join *" OR CommandLine="*-join'*" OR CommandLine="*-join\"*" OR CommandLine="*-join`*" OR CommandLine="*::Join*" OR CommandLine="*[char]*"))) | eval sigma_attack_tags="attack.defense_evasion attack.execution attack.t1059.001 attack.t1140 attack.t1027" | eval sigma_title="Suspicious XOR Encoded PowerShell Command" | eval sigma_description="Detects presence of a potentially xor encoded powershell command"
dispatch.earliest_time = -24h@h
alert.track = 0

[Default PowerSploit and Empire Schtasks Persistence - winevent]
description = Detects the creation of a schtask via PowerSploit or Empire Default Configuration.
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (Creator_Process_Name="*\\powershell.exe" OR Creator_Process_Name="*\\pwsh.exe") New_Process_Name="*\\schtasks.exe" Process_Command_Line="*/Create*" Process_Command_Line="*/SC*" Process_Command_Line="*/TN*" Process_Command_Line="*Updater*" Process_Command_Line="*/TR*" Process_Command_Line="*powershell*" (Process_Command_Line="*ONLOGON*" OR Process_Command_Line="*DAILY*" OR Process_Command_Line="*ONIDLE*" OR Process_Command_Line="*Updater*"))) | eval sigma_attack_tags="attack.execution attack.persistence attack.privilege_escalation attack.s0111 attack.g0022 attack.g0060 car.2013-08-001 attack.t1053.005 attack.t1059.001" | eval sigma_title="Default PowerSploit and Empire Schtasks Persistence" | eval sigma_description="Detects the creation of a schtask via PowerSploit or Empire Default Configuration."
dispatch.earliest_time = -24h@h
alert.track = 0

[Default PowerSploit and Empire Schtasks Persistence - sysmon]
description = Detects the creation of a schtask via PowerSploit or Empire Default Configuration.
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (ParentImage="*\\powershell.exe" OR ParentImage="*\\pwsh.exe") Image="*\\schtasks.exe" CommandLine="*/Create*" CommandLine="*/SC*" CommandLine="*/TN*" CommandLine="*Updater*" CommandLine="*/TR*" CommandLine="*powershell*" (CommandLine="*ONLOGON*" OR CommandLine="*DAILY*" OR CommandLine="*ONIDLE*" OR CommandLine="*Updater*"))) | eval sigma_attack_tags="attack.execution attack.persistence attack.privilege_escalation attack.s0111 attack.g0022 attack.g0060 car.2013-08-001 attack.t1053.005 attack.t1059.001" | eval sigma_title="Default PowerSploit and Empire Schtasks Persistence" | eval sigma_description="Detects the creation of a schtask via PowerSploit or Empire Default Configuration."
dispatch.earliest_time = -24h@h
alert.track = 0

[PowerTool Execution - winevent]
description = Detects the execution of the tool PowerTool which has the ability to kill a process, delete its process file, unload drivers, and delete the driver files
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\PowerTool.exe" OR New_Process_Name="*\\PowerTool64.exe") OR OriginalFileName="PowerTool.exe"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.001" | eval sigma_title="PowerTool Execution" | eval sigma_description="Detects the execution of the tool PowerTool which has the ability to kill a process, delete its process file, unload drivers, and delete the driver files"
dispatch.earliest_time = -24h@h
alert.track = 0

[PowerTool Execution - sysmon]
description = Detects the execution of the tool PowerTool which has the ability to kill a process, delete its process file, unload drivers, and delete the driver files
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\PowerTool.exe" OR Image="*\\PowerTool64.exe") OR OriginalFileName="PowerTool.exe"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.001" | eval sigma_title="PowerTool Execution" | eval sigma_description="Detects the execution of the tool PowerTool which has the ability to kill a process, delete its process file, unload drivers, and delete the driver files"
dispatch.earliest_time = -24h@h
alert.track = 0

[Privilege Escalation via Named Pipe Impersonation - winevent]
description = Detects a remote file copy attempt to a hidden network share. This may indicate lateral movement or data staging activity.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\cmd.exe" OR New_Process_Name="*\\powershell.exe") OR (OriginalFileName="Cmd.Exe" OR OriginalFileName="PowerShell.EXE")) ((Process_Command_Line="*echo*" Process_Command_Line="*>*" Process_Command_Line="*\\\\.\\pipe\\\*")))) | eval sigma_attack_tags="attack.lateral_movement attack.t1021" | eval sigma_title="Privilege Escalation via Named Pipe Impersonation" | eval sigma_description="Detects a remote file copy attempt to a hidden network share. This may indicate lateral movement or data staging activity."
dispatch.earliest_time = -24h@h
alert.track = 0

[Privilege Escalation via Named Pipe Impersonation - sysmon]
description = Detects a remote file copy attempt to a hidden network share. This may indicate lateral movement or data staging activity.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\cmd.exe" OR Image="*\\powershell.exe") OR (OriginalFileName="Cmd.Exe" OR OriginalFileName="PowerShell.EXE")) ((CommandLine="*echo*" CommandLine="*>*" CommandLine="*\\\\.\\pipe\\\*")))) | eval sigma_attack_tags="attack.lateral_movement attack.t1021" | eval sigma_title="Privilege Escalation via Named Pipe Impersonation" | eval sigma_description="Detects a remote file copy attempt to a hidden network share. This may indicate lateral movement or data staging activity."
dispatch.earliest_time = -24h@h
alert.track = 0

[CreateDump Process Dump - winevent]
description = Detects uses of the createdump.exe LOLOBIN utility to dump process memory
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\createdump.exe" OR OriginalFileName="FX_VER_INTERNALNAME_STR") (Process_Command_Line="* -u *" OR Process_Command_Line="* --full *" OR Process_Command_Line="* -f *" OR Process_Command_Line="* --name *" OR Process_Command_Line="*.dmp *"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1036 attack.t1003.001" | eval sigma_title="CreateDump Process Dump" | eval sigma_description="Detects uses of the createdump.exe LOLOBIN utility to dump process memory"
dispatch.earliest_time = -24h@h
alert.track = 0

[CreateDump Process Dump - sysmon]
description = Detects uses of the createdump.exe LOLOBIN utility to dump process memory
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\createdump.exe" OR OriginalFileName="FX_VER_INTERNALNAME_STR") (CommandLine="* -u *" OR CommandLine="* --full *" OR CommandLine="* -f *" OR CommandLine="* --name *" OR CommandLine="*.dmp *"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1036 attack.t1003.001" | eval sigma_title="CreateDump Process Dump" | eval sigma_description="Detects uses of the createdump.exe LOLOBIN utility to dump process memory"
dispatch.earliest_time = -24h@h
alert.track = 0

[DumpMinitool Usage - winevent]
description = Detects the use of a Visual Studio bundled tool named DumpMinitool.exe
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\DumpMinitool.exe" OR OriginalFileName="DumpMinitool.exe") OR ((Process_Command_Line="* --processId *" Process_Command_Line="* --dumpType Full*"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1036 attack.t1003.001" | eval sigma_title="DumpMinitool Usage" | eval sigma_description="Detects the use of a Visual Studio bundled tool named DumpMinitool.exe"
dispatch.earliest_time = -24h@h
alert.track = 0

[DumpMinitool Usage - sysmon]
description = Detects the use of a Visual Studio bundled tool named DumpMinitool.exe
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\DumpMinitool.exe" OR OriginalFileName="DumpMinitool.exe") OR ((CommandLine="* --processId *" CommandLine="* --dumpType Full*"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1036 attack.t1003.001" | eval sigma_title="DumpMinitool Usage" | eval sigma_description="Detects the use of a Visual Studio bundled tool named DumpMinitool.exe"
dispatch.earliest_time = -24h@h
alert.track = 0

[RdrLeakDiag Process Dump - winevent]
description = Detects uses of the rdrleakdiag.exe LOLOBIN utility to dump process memory
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((New_Process_Name="*\\rdrleakdiag.exe" Process_Command_Line="*/fullmemdmp*")) OR ((Process_Command_Line="*/fullmemdmp*" Process_Command_Line="* /o *" Process_Command_Line="* /p *"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1036 attack.t1003.001" | eval sigma_title="RdrLeakDiag Process Dump" | eval sigma_description="Detects uses of the rdrleakdiag.exe LOLOBIN utility to dump process memory"
dispatch.earliest_time = -24h@h
alert.track = 0

[RdrLeakDiag Process Dump - sysmon]
description = Detects uses of the rdrleakdiag.exe LOLOBIN utility to dump process memory
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((Image="*\\rdrleakdiag.exe" CommandLine="*/fullmemdmp*")) OR ((CommandLine="*/fullmemdmp*" CommandLine="* /o *" CommandLine="* /p *"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1036 attack.t1003.001" | eval sigma_title="RdrLeakDiag Process Dump" | eval sigma_description="Detects uses of the rdrleakdiag.exe LOLOBIN utility to dump process memory"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious DumpMinitool Usage - winevent]
description = Detects suspicious ways to use of a Visual Studio bundled tool named DumpMinitool.exe
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\DumpMinitool.exe" OR OriginalFileName="DumpMinitool.exe") ((NOT (((New_Process_Name="*\\Microsoft Visual Studio\\*" OR New_Process_Name="*\\Extensions\\*"))) OR Process_Command_Line="*.txt*") OR ((Process_Command_Line="* Full*" NOT ((Process_Command_Line="*--dumpType*"))))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1036 attack.t1003.001" | eval sigma_title="Suspicious DumpMinitool Usage" | eval sigma_description="Detects suspicious ways to use of a Visual Studio bundled tool named DumpMinitool.exe"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious DumpMinitool Usage - sysmon]
description = Detects suspicious ways to use of a Visual Studio bundled tool named DumpMinitool.exe
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\DumpMinitool.exe" OR OriginalFileName="DumpMinitool.exe") ((NOT (((Image="*\\Microsoft Visual Studio\\*" OR Image="*\\Extensions\\*"))) OR CommandLine="*.txt*") OR ((CommandLine="* Full*" NOT ((CommandLine="*--dumpType*"))))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1036 attack.t1003.001" | eval sigma_title="Suspicious DumpMinitool Usage" | eval sigma_description="Detects suspicious ways to use of a Visual Studio bundled tool named DumpMinitool.exe"
dispatch.earliest_time = -24h@h
alert.track = 0

[Windows Processes Suspicious Parent Directory - winevent]
description = Detect suspicious parent processes of well-known Windows processes
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\svchost.exe" OR New_Process_Name="*\\taskhost.exe" OR New_Process_Name="*\\lsm.exe" OR New_Process_Name="*\\lsass.exe" OR New_Process_Name="*\\services.exe" OR New_Process_Name="*\\lsaiso.exe" OR New_Process_Name="*\\csrss.exe" OR New_Process_Name="*\\wininit.exe" OR New_Process_Name="*\\winlogon.exe") NOT ((((Creator_Process_Name="*\\SavService.exe" OR Creator_Process_Name="*\\ngen.exe")) OR ((Creator_Process_Name="*\\System32\\*" OR Creator_Process_Name="*\\SysWOW64\\*"))) OR (((Creator_Process_Name="*\\Windows Defender\\*" OR Creator_Process_Name="*\\Microsoft Security Client\\*") Creator_Process_Name="*\\MsMpEng.exe")) OR ((NOT Creator_Process_Name="*") OR (Creator_Process_Name="-"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1036.003 attack.t1036.005" | eval sigma_title="Windows Processes Suspicious Parent Directory" | eval sigma_description="Detect suspicious parent processes of well-known Windows processes"
dispatch.earliest_time = -24h@h
alert.track = 0

[Windows Processes Suspicious Parent Directory - sysmon]
description = Detect suspicious parent processes of well-known Windows processes
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\svchost.exe" OR Image="*\\taskhost.exe" OR Image="*\\lsm.exe" OR Image="*\\lsass.exe" OR Image="*\\services.exe" OR Image="*\\lsaiso.exe" OR Image="*\\csrss.exe" OR Image="*\\wininit.exe" OR Image="*\\winlogon.exe") NOT ((((ParentImage="*\\SavService.exe" OR ParentImage="*\\ngen.exe")) OR ((ParentImage="*\\System32\\*" OR ParentImage="*\\SysWOW64\\*"))) OR (((ParentImage="*\\Windows Defender\\*" OR ParentImage="*\\Microsoft Security Client\\*") ParentImage="*\\MsMpEng.exe")) OR ((NOT ParentImage="*") OR (ParentImage="-"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1036.003 attack.t1036.005" | eval sigma_title="Windows Processes Suspicious Parent Directory" | eval sigma_description="Detect suspicious parent processes of well-known Windows processes"
dispatch.earliest_time = -24h@h
alert.track = 0

[Procdump Evasion - winevent]
description = Detects uses of the SysInternals Procdump utility in which procdump or its output get renamed or a dump file is moved ot copied to a different name
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((Process_Command_Line="*copy procdump*" OR Process_Command_Line="*move procdump*") OR ((Process_Command_Line="*copy *" Process_Command_Line="*.dmp *" (Process_Command_Line="*2.dmp*" OR Process_Command_Line="*lsass*" OR Process_Command_Line="*out.dmp*"))) OR (Process_Command_Line="*copy lsass.exe_*" OR Process_Command_Line="*move lsass.exe_*")))) | eval sigma_attack_tags="attack.defense_evasion attack.t1036 attack.t1003.001" | eval sigma_title="Procdump Evasion" | eval sigma_description="Detects uses of the SysInternals Procdump utility in which procdump or its output get renamed or a dump file is moved ot copied to a different name"
dispatch.earliest_time = -24h@h
alert.track = 0

[Procdump Evasion - sysmon]
description = Detects uses of the SysInternals Procdump utility in which procdump or its output get renamed or a dump file is moved ot copied to a different name
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((CommandLine="*copy procdump*" OR CommandLine="*move procdump*") OR ((CommandLine="*copy *" CommandLine="*.dmp *" (CommandLine="*2.dmp*" OR CommandLine="*lsass*" OR CommandLine="*out.dmp*"))) OR (CommandLine="*copy lsass.exe_*" OR CommandLine="*move lsass.exe_*")))) | eval sigma_attack_tags="attack.defense_evasion attack.t1036 attack.t1003.001" | eval sigma_title="Procdump Evasion" | eval sigma_description="Detects uses of the SysInternals Procdump utility in which procdump or its output get renamed or a dump file is moved ot copied to a different name"
dispatch.earliest_time = -24h@h
alert.track = 0

[Procdump Usage - winevent]
description = Detects usage of the SysInternals Procdump utility
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (New_Process_Name="*\\procdump.exe" OR New_Process_Name="*\\procdump64.exe"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1036 attack.t1003.001" | eval sigma_title="Procdump Usage" | eval sigma_description="Detects usage of the SysInternals Procdump utility"
dispatch.earliest_time = -24h@h
alert.track = 0

[Procdump Usage - sysmon]
description = Detects usage of the SysInternals Procdump utility
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (Image="*\\procdump.exe" OR Image="*\\procdump64.exe"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1036 attack.t1003.001" | eval sigma_title="Procdump Usage" | eval sigma_description="Detects usage of the SysInternals Procdump utility"
dispatch.earliest_time = -24h@h
alert.track = 0

[Process Dump via RdrLeakDiag.exe - winevent]
description = Detects a process memory dump performed by RdrLeakDiag.exe
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") OriginalFileName="RdrLeakDiag.exe" Process_Command_Line="*fullmemdmp*")) | eval sigma_attack_tags="attack.credential_access attack.t1003.001" | eval sigma_title="Process Dump via RdrLeakDiag.exe" | eval sigma_description="Detects a process memory dump performed by RdrLeakDiag.exe"
dispatch.earliest_time = -24h@h
alert.track = 0

[Process Dump via RdrLeakDiag.exe - sysmon]
description = Detects a process memory dump performed by RdrLeakDiag.exe
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") OriginalFileName="RdrLeakDiag.exe" CommandLine="*fullmemdmp*")) | eval sigma_attack_tags="attack.credential_access attack.t1003.001" | eval sigma_title="Process Dump via RdrLeakDiag.exe" | eval sigma_description="Detects a process memory dump performed by RdrLeakDiag.exe"
dispatch.earliest_time = -24h@h
alert.track = 0

[Process Dump via Rundll32 and Comsvcs.dll - winevent]
description = Detects process memory dump via comsvcs.dll and rundll32 using different techniques (ordinal, minidump function...etc)
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((((New_Process_Name="*\\rundll32.exe" OR OriginalFileName="RUNDLL32.EXE" OR Process_Command_Line="*rundll32*") ((Process_Command_Line="*comsvcs*" Process_Command_Line="*full*" (Process_Command_Line="*24 *" OR Process_Command_Line="*#24*" OR Process_Command_Line="*#+24*" OR Process_Command_Line="*MiniDump*"))))) OR Process_Command_Line="*#-4294967272*"))) | eval sigma_attack_tags="attack.defense_evasion attack.credential_access attack.t1036 attack.t1003.001 car.2013-05-009" | eval sigma_title="Process Dump via Rundll32 and Comsvcs.dll" | eval sigma_description="Detects process memory dump via comsvcs.dll and rundll32 using different techniques (ordinal, minidump function...etc)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Process Dump via Rundll32 and Comsvcs.dll - sysmon]
description = Detects process memory dump via comsvcs.dll and rundll32 using different techniques (ordinal, minidump function...etc)
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((((Image="*\\rundll32.exe" OR OriginalFileName="RUNDLL32.EXE" OR CommandLine="*rundll32*") ((CommandLine="*comsvcs*" CommandLine="*full*" (CommandLine="*24 *" OR CommandLine="*#24*" OR CommandLine="*#+24*" OR CommandLine="*MiniDump*"))))) OR CommandLine="*#-4294967272*"))) | eval sigma_attack_tags="attack.defense_evasion attack.credential_access attack.t1036 attack.t1003.001 car.2013-05-009" | eval sigma_title="Process Dump via Rundll32 and Comsvcs.dll" | eval sigma_description="Detects process memory dump via comsvcs.dll and rundll32 using different techniques (ordinal, minidump function...etc)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Proxy Execution via Wuauclt - winevent]
description = Detects the use of the Windows Update Client binary (wuauclt.exe) to proxy execute code.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((New_Process_Name="*wuauclt*" OR OriginalFileName="wuauclt.exe") ((Process_Command_Line="*UpdateDeploymentProvider*" Process_Command_Line="*.dll*" Process_Command_Line="*RunHandlerComServer*")))) NOT (((Process_Command_Line="* /UpdateDeploymentProvider UpdateDeploymentProvider.dll *" OR Process_Command_Line="* wuaueng.dll *"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218 attack.execution" | eval sigma_title="Proxy Execution via Wuauclt" | eval sigma_description="Detects the use of the Windows Update Client binary (wuauclt.exe) to proxy execute code."
dispatch.earliest_time = -24h@h
alert.track = 0

[Proxy Execution via Wuauclt - sysmon]
description = Detects the use of the Windows Update Client binary (wuauclt.exe) to proxy execute code.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((Image="*wuauclt*" OR OriginalFileName="wuauclt.exe") ((CommandLine="*UpdateDeploymentProvider*" CommandLine="*.dll*" CommandLine="*RunHandlerComServer*")))) NOT (((CommandLine="* /UpdateDeploymentProvider UpdateDeploymentProvider.dll *" OR CommandLine="* wuaueng.dll *"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218 attack.execution" | eval sigma_title="Proxy Execution via Wuauclt" | eval sigma_description="Detects the use of the Windows Update Client binary (wuauclt.exe) to proxy execute code."
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential COM Objects Download Cradles Usage - Process Creation - winevent]
description = Detects usage of COM objects that can be abused to download files in PowerShell by CLSID
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*[Type]::GetTypeFromCLSID(*" (Process_Command_Line="*0002DF01-0000-0000-C000-000000000046*" OR Process_Command_Line="*F6D90F16-9C73-11D3-B32E-00C04F990BB4*" OR Process_Command_Line="*F5078F35-C551-11D3-89B9-0000F81FE221*" OR Process_Command_Line="*88d96a0a-f192-11d4-a65f-0040963251e5*" OR Process_Command_Line="*AFBA6B42-5692-48EA-8141-DC517DCF0EF1*" OR Process_Command_Line="*AFB40FFD-B609-40A3-9828-F88BBE11E4E3*" OR Process_Command_Line="*88d96a0b-f192-11d4-a65f-0040963251e5*" OR Process_Command_Line="*2087c2f4-2cef-4953-a8ab-66779b670495*" OR Process_Command_Line="*000209FF-0000-0000-C000-000000000046*" OR Process_Command_Line="*00024500-0000-0000-C000-000000000046*"))) | eval sigma_attack_tags="" | eval sigma_title="Potential COM Objects Download Cradles Usage - Process Creation" | eval sigma_description="Detects usage of COM objects that can be abused to download files in PowerShell by CLSID"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential COM Objects Download Cradles Usage - Process Creation - sysmon]
description = Detects usage of COM objects that can be abused to download files in PowerShell by CLSID
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*[Type]::GetTypeFromCLSID(*" (CommandLine="*0002DF01-0000-0000-C000-000000000046*" OR CommandLine="*F6D90F16-9C73-11D3-B32E-00C04F990BB4*" OR CommandLine="*F5078F35-C551-11D3-89B9-0000F81FE221*" OR CommandLine="*88d96a0a-f192-11d4-a65f-0040963251e5*" OR CommandLine="*AFBA6B42-5692-48EA-8141-DC517DCF0EF1*" OR CommandLine="*AFB40FFD-B609-40A3-9828-F88BBE11E4E3*" OR CommandLine="*88d96a0b-f192-11d4-a65f-0040963251e5*" OR CommandLine="*2087c2f4-2cef-4953-a8ab-66779b670495*" OR CommandLine="*000209FF-0000-0000-C000-000000000046*" OR CommandLine="*00024500-0000-0000-C000-000000000046*"))) | eval sigma_attack_tags="" | eval sigma_title="Potential COM Objects Download Cradles Usage - Process Creation" | eval sigma_description="Detects usage of COM objects that can be abused to download files in PowerShell by CLSID"
dispatch.earliest_time = -24h@h
alert.track = 0

[Powershell Inline Execution From A File - winevent]
description = Detects inline execution of PowerShell code from a file
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (Process_Command_Line="*iex *" OR Process_Command_Line="*Invoke-Expression *" OR Process_Command_Line="*Invoke-Command *" OR Process_Command_Line="*icm *") (Process_Command_Line="*cat *" OR Process_Command_Line="*get-content *" OR Process_Command_Line="*type *") Process_Command_Line="* -raw*")) | eval sigma_attack_tags="" | eval sigma_title="Powershell Inline Execution From A File" | eval sigma_description="Detects inline execution of PowerShell code from a file"
dispatch.earliest_time = -24h@h
alert.track = 0

[Powershell Inline Execution From A File - sysmon]
description = Detects inline execution of PowerShell code from a file
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (CommandLine="*iex *" OR CommandLine="*Invoke-Expression *" OR CommandLine="*Invoke-Command *" OR CommandLine="*icm *") (CommandLine="*cat *" OR CommandLine="*get-content *" OR CommandLine="*type *") CommandLine="* -raw*")) | eval sigma_attack_tags="" | eval sigma_title="Powershell Inline Execution From A File" | eval sigma_description="Detects inline execution of PowerShell code from a file"
dispatch.earliest_time = -24h@h
alert.track = 0

[PsExec Service Start - winevent]
description = Detects a PsExec service start
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="C:\\Windows\\PSEXESVC.exe")) | eval sigma_attack_tags="attack.execution attack.s0029 attack.t1569.002" | eval sigma_title="PsExec Service Start" | eval sigma_description="Detects a PsExec service start"
dispatch.earliest_time = -24h@h
alert.track = 0

[PsExec Service Start - sysmon]
description = Detects a PsExec service start
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="C:\\Windows\\PSEXESVC.exe")) | eval sigma_attack_tags="attack.execution attack.s0029 attack.t1569.002" | eval sigma_title="PsExec Service Start" | eval sigma_description="Detects a PsExec service start"
dispatch.earliest_time = -24h@h
alert.track = 0

[PowerShell AMSI Bypass Pattern - winevent]
description = Detects attempts to disable AMSI in the command line. It is possible to bypass AMSI by disabling it before loading the main payload.
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (New_Process_Name="*\\powershell.exe" OR New_Process_Name="*\\pwsh.exe" OR New_Process_Name="*\\powershell_ise.exe") Process_Command_Line="*[Ref].Assembly.GetType*" Process_Command_Line="*SetValue($null,$true)*" Process_Command_Line="*NonPublic,Static*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.001 attack.execution" | eval sigma_title="PowerShell AMSI Bypass Pattern" | eval sigma_description="Detects attempts to disable AMSI in the command line. It is possible to bypass AMSI by disabling it before loading the main payload."
dispatch.earliest_time = -24h@h
alert.track = 0

[PowerShell AMSI Bypass Pattern - sysmon]
description = Detects attempts to disable AMSI in the command line. It is possible to bypass AMSI by disabling it before loading the main payload.
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (Image="*\\powershell.exe" OR Image="*\\pwsh.exe" OR Image="*\\powershell_ise.exe") CommandLine="*[Ref].Assembly.GetType*" CommandLine="*SetValue($null,$true)*" CommandLine="*NonPublic,Static*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.001 attack.execution" | eval sigma_title="PowerShell AMSI Bypass Pattern" | eval sigma_description="Detects attempts to disable AMSI in the command line. It is possible to bypass AMSI by disabling it before loading the main payload."
dispatch.earliest_time = -24h@h
alert.track = 0

[DefenderCheck Usage - winevent]
description = Detects the use of DefenderCheck, a tool to evaluate the signatures used in Microsoft Defender. It can be used to figure out the strings / byte chains used in Microsoft Defender to detect a tool and thus used for AV evasion.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\DefenderCheck.exe" OR Description="DefenderCheck"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1027.005" | eval sigma_title="DefenderCheck Usage" | eval sigma_description="Detects the use of DefenderCheck, a tool to evaluate the signatures used in Microsoft Defender. It can be used to figure out the strings / byte chains used in Microsoft Defender to detect a tool and thus used for AV evasion."
dispatch.earliest_time = -24h@h
alert.track = 0

[DefenderCheck Usage - sysmon]
description = Detects the use of DefenderCheck, a tool to evaluate the signatures used in Microsoft Defender. It can be used to figure out the strings / byte chains used in Microsoft Defender to detect a tool and thus used for AV evasion.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\DefenderCheck.exe" OR Description="DefenderCheck"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1027.005" | eval sigma_title="DefenderCheck Usage" | eval sigma_description="Detects the use of DefenderCheck, a tool to evaluate the signatures used in Microsoft Defender. It can be used to figure out the strings / byte chains used in Microsoft Defender to detect a tool and thus used for AV evasion."
dispatch.earliest_time = -24h@h
alert.track = 0

[Seatbelt PUA Tool - winevent]
description = Detects the execution of the PUA/Recon tool Seatbelt via PE information of command line parameters
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\Seatbelt.exe" OR OriginalFileName="Seatbelt.exe" OR Description="Seatbelt" OR (Process_Command_Line="* DpapiMasterKeys*" OR Process_Command_Line="* InterestingProcesses*" OR Process_Command_Line="* InterestingFiles*" OR Process_Command_Line="* CertificateThumbprints*" OR Process_Command_Line="* ChromiumBookmarks*" OR Process_Command_Line="* ChromiumHistory*" OR Process_Command_Line="* ChromiumPresence*" OR Process_Command_Line="* CloudCredentials*" OR Process_Command_Line="* CredEnum*" OR Process_Command_Line="* CredGuard*" OR Process_Command_Line="* FirefoxHistory*" OR Process_Command_Line="* ProcessCreationEvents*")) OR (((Process_Command_Line="* -group=misc*" OR Process_Command_Line="* -group=remote*" OR Process_Command_Line="* -group=chromium*" OR Process_Command_Line="* -group=slack*" OR Process_Command_Line="* -group=system*" OR Process_Command_Line="* -group=user*" OR Process_Command_Line="* -group=all*") Process_Command_Line="* -outputfile=*"))))) | eval sigma_attack_tags="attack.discovery attack.t1526 attack.t1087 attack.t1083" | eval sigma_title="Seatbelt PUA Tool" | eval sigma_description="Detects the execution of the PUA/Recon tool Seatbelt via PE information of command line parameters"
dispatch.earliest_time = -24h@h
alert.track = 0

[Seatbelt PUA Tool - sysmon]
description = Detects the execution of the PUA/Recon tool Seatbelt via PE information of command line parameters
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\Seatbelt.exe" OR OriginalFileName="Seatbelt.exe" OR Description="Seatbelt" OR (CommandLine="* DpapiMasterKeys*" OR CommandLine="* InterestingProcesses*" OR CommandLine="* InterestingFiles*" OR CommandLine="* CertificateThumbprints*" OR CommandLine="* ChromiumBookmarks*" OR CommandLine="* ChromiumHistory*" OR CommandLine="* ChromiumPresence*" OR CommandLine="* CloudCredentials*" OR CommandLine="* CredEnum*" OR CommandLine="* CredGuard*" OR CommandLine="* FirefoxHistory*" OR CommandLine="* ProcessCreationEvents*")) OR (((CommandLine="* -group=misc*" OR CommandLine="* -group=remote*" OR CommandLine="* -group=chromium*" OR CommandLine="* -group=slack*" OR CommandLine="* -group=system*" OR CommandLine="* -group=user*" OR CommandLine="* -group=all*") CommandLine="* -outputfile=*"))))) | eval sigma_attack_tags="attack.discovery attack.t1526 attack.t1087 attack.t1083" | eval sigma_title="Seatbelt PUA Tool" | eval sigma_description="Detects the execution of the PUA/Recon tool Seatbelt via PE information of command line parameters"
dispatch.earliest_time = -24h@h
alert.track = 0

[Parent in Public Folder Suspicious Process - winevent]
description = This rule detects suspicious processes with parent images located in the C:\Users\Public folder
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Creator_Process_Name="C:\\Users\\Public\\*" (Process_Command_Line="*powershell*" OR Process_Command_Line="*cmd.exe /c *" OR Process_Command_Line="*cmd.exe /r *" OR Process_Command_Line="*cmd.exe /k *" OR Process_Command_Line="*cmd /c *" OR Process_Command_Line="*cmd /r *" OR Process_Command_Line="*cmd /k *" OR Process_Command_Line="*wscript.exe*" OR Process_Command_Line="*cscript.exe*" OR Process_Command_Line="*bitsadmin*" OR Process_Command_Line="*certutil*" OR Process_Command_Line="*mshta.exe*"))) | table ComputerName,Account_Name,Process_Command_Line | eval sigma_attack_tags="" | eval sigma_title="Parent in Public Folder Suspicious Process" | eval sigma_description="This rule detects suspicious processes with parent images located in the C:\Users\Public folder"
dispatch.earliest_time = -24h@h
alert.track = 0

[Parent in Public Folder Suspicious Process - sysmon]
description = This rule detects suspicious processes with parent images located in the C:\Users\Public folder
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") ParentImage="C:\\Users\\Public\\*" (CommandLine="*powershell*" OR CommandLine="*cmd.exe /c *" OR CommandLine="*cmd.exe /r *" OR CommandLine="*cmd.exe /k *" OR CommandLine="*cmd /c *" OR CommandLine="*cmd /r *" OR CommandLine="*cmd /k *" OR CommandLine="*wscript.exe*" OR CommandLine="*cscript.exe*" OR CommandLine="*bitsadmin*" OR CommandLine="*certutil*" OR CommandLine="*mshta.exe*"))) | table ComputerName,User,CommandLine | eval sigma_attack_tags="" | eval sigma_title="Parent in Public Folder Suspicious Process" | eval sigma_description="This rule detects suspicious processes with parent images located in the C:\Users\Public folder"
dispatch.earliest_time = -24h@h
alert.track = 0

[PurpleSharp Indicator - winevent]
description = Detects the execution of the PurpleSharp adversary simulation tool
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\purplesharp*" OR OriginalFileName="PurpleSharp.exe" OR (Process_Command_Line="*xyz123456.exe*" OR Process_Command_Line="*PurpleSharp*")))) | eval sigma_attack_tags="attack.t1587 attack.resource_development" | eval sigma_title="PurpleSharp Indicator" | eval sigma_description="Detects the execution of the PurpleSharp adversary simulation tool"
dispatch.earliest_time = -24h@h
alert.track = 0

[PurpleSharp Indicator - sysmon]
description = Detects the execution of the PurpleSharp adversary simulation tool
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\purplesharp*" OR OriginalFileName="PurpleSharp.exe" OR (CommandLine="*xyz123456.exe*" OR CommandLine="*PurpleSharp*")))) | eval sigma_attack_tags="attack.t1587 attack.resource_development" | eval sigma_title="PurpleSharp Indicator" | eval sigma_description="Detects the execution of the PurpleSharp adversary simulation tool"
dispatch.earliest_time = -24h@h
alert.track = 0

[Python Inline Command Execution - winevent]
description = Detects execution of python using the '-c' flag. This is could be used as a way to launch a reverse shell or execute live python code.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((((New_Process_Name="*python.exe" OR New_Process_Name="*python3.exe" OR New_Process_Name="*python2.exe") OR OriginalFileName="python.exe") Process_Command_Line="* -c*")) NOT (((Creator_Process_Name="C:\\Program Files\\Python*" Creator_Process_Name="*\\python.exe")) OR ((Creator_Process_Name="*\\AppData\\Local\\Programs\\Microsoft VS Code\\Code.exe"))))) | eval sigma_attack_tags="attack.execution attack.t1059" | eval sigma_title="Python Inline Command Execution" | eval sigma_description="Detects execution of python using the '-c' flag. This is could be used as a way to launch a reverse shell or execute live python code."
dispatch.earliest_time = -24h@h
alert.track = 0

[Python Inline Command Execution - sysmon]
description = Detects execution of python using the '-c' flag. This is could be used as a way to launch a reverse shell or execute live python code.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((((Image="*python.exe" OR Image="*python3.exe" OR Image="*python2.exe") OR OriginalFileName="python.exe") CommandLine="* -c*")) NOT (((ParentImage="C:\\Program Files\\Python*" ParentImage="*\\python.exe")) OR ((ParentImage="*\\AppData\\Local\\Programs\\Microsoft VS Code\\Code.exe"))))) | eval sigma_attack_tags="attack.execution attack.t1059" | eval sigma_title="Python Inline Command Execution" | eval sigma_description="Detects execution of python using the '-c' flag. This is could be used as a way to launch a reverse shell or execute live python code."
dispatch.earliest_time = -24h@h
alert.track = 0

[Python Spawning Pretty TTY on Windows - winevent]
description = Detects python spawning a pretty tty
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*python.exe" OR New_Process_Name="*python3.exe" OR New_Process_Name="*python2.exe") (((Process_Command_Line="*import pty*" Process_Command_Line="*.spawn(*")) OR Process_Command_Line="*from pty import spawn*"))) | eval sigma_attack_tags="attack.execution attack.t1059" | eval sigma_title="Python Spawning Pretty TTY on Windows" | eval sigma_description="Detects python spawning a pretty tty"
dispatch.earliest_time = -24h@h
alert.track = 0

[Python Spawning Pretty TTY on Windows - sysmon]
description = Detects python spawning a pretty tty
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*python.exe" OR Image="*python3.exe" OR Image="*python2.exe") (((CommandLine="*import pty*" CommandLine="*.spawn(*")) OR CommandLine="*from pty import spawn*"))) | eval sigma_attack_tags="attack.execution attack.t1059" | eval sigma_title="Python Spawning Pretty TTY on Windows" | eval sigma_description="Detects python spawning a pretty tty"
dispatch.earliest_time = -24h@h
alert.track = 0

[Quarks PwDump Usage - winevent]
description = Detects usage of the Quarks PwDump tool via commandline arguments
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\QuarksPwDump.exe" OR (Process_Command_Line=" -dhl" OR Process_Command_Line=" --dump-hash-local" OR Process_Command_Line=" -dhdc" OR Process_Command_Line=" --dump-hash-domain-cached" OR Process_Command_Line=" --dump-bitlocker" OR Process_Command_Line=" -dhd " OR Process_Command_Line=" --dump-hash-domain " OR Process_Command_Line="--ntds-file")))) | eval sigma_attack_tags="attack.credential_access attack.t1003.002" | eval sigma_title="Quarks PwDump Usage" | eval sigma_description="Detects usage of the Quarks PwDump tool via commandline arguments"
dispatch.earliest_time = -24h@h
alert.track = 0

[Quarks PwDump Usage - sysmon]
description = Detects usage of the Quarks PwDump tool via commandline arguments
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\QuarksPwDump.exe" OR (CommandLine=" -dhl" OR CommandLine=" --dump-hash-local" OR CommandLine=" -dhdc" OR CommandLine=" --dump-hash-domain-cached" OR CommandLine=" --dump-bitlocker" OR CommandLine=" -dhd " OR CommandLine=" --dump-hash-domain " OR CommandLine="--ntds-file")))) | eval sigma_attack_tags="attack.credential_access attack.t1003.002" | eval sigma_title="Quarks PwDump Usage" | eval sigma_description="Detects usage of the Quarks PwDump tool via commandline arguments"
dispatch.earliest_time = -24h@h
alert.track = 0

[Query Registry - winevent]
description = Adversaries may interact with the Windows Registry to gather information about credentials, the system, configuration, and installed software.
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\reg.exe" (Process_Command_Line="*query*" OR Process_Command_Line="*save*" OR Process_Command_Line="*export*") (Process_Command_Line="*currentVersion\\windows*" OR Process_Command_Line="*winlogon\\*" OR Process_Command_Line="*currentVersion\\shellServiceObjectDelayLoad*" OR Process_Command_Line="*currentVersion\\run*" OR Process_Command_Line="*currentVersion\\policies\\explorer\\run*" OR Process_Command_Line="*currentcontrolset\\services*"))) | table New_Process_Name,Process_Command_Line,Account_Name,LogonGuid,Hashes,ParentProcessGuid,ParentCommandLine | eval sigma_attack_tags="attack.discovery attack.t1012 attack.t1007" | eval sigma_title="Query Registry" | eval sigma_description="Adversaries may interact with the Windows Registry to gather information about credentials, the system, configuration, and installed software."
dispatch.earliest_time = -24h@h
alert.track = 0

[Query Registry - sysmon]
description = Adversaries may interact with the Windows Registry to gather information about credentials, the system, configuration, and installed software.
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\reg.exe" (CommandLine="*query*" OR CommandLine="*save*" OR CommandLine="*export*") (CommandLine="*currentVersion\\windows*" OR CommandLine="*winlogon\\*" OR CommandLine="*currentVersion\\shellServiceObjectDelayLoad*" OR CommandLine="*currentVersion\\run*" OR CommandLine="*currentVersion\\policies\\explorer\\run*" OR CommandLine="*currentcontrolset\\services*"))) | table Image,CommandLine,User,LogonGuid,Hashes,ParentProcessGuid,ParentCommandLine | eval sigma_attack_tags="attack.discovery attack.t1012 attack.t1007" | eval sigma_title="Query Registry" | eval sigma_description="Adversaries may interact with the Windows Registry to gather information about credentials, the system, configuration, and installed software."
dispatch.earliest_time = -24h@h
alert.track = 0

[Query Usage To Exfil Data - winevent]
description = Detects usage of 'query.exe' a system binary to exfil information such as 'sessions' and 'processes' for later use
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*:\\Windows\\System32\\query.exe" (Process_Command_Line="*session >*" OR Process_Command_Line="*process >*"))) | eval sigma_attack_tags="attack.execution" | eval sigma_title="Query Usage To Exfil Data" | eval sigma_description="Detects usage of 'query.exe' a system binary to exfil information such as 'sessions' and 'processes' for later use"
dispatch.earliest_time = -24h@h
alert.track = 0

[Query Usage To Exfil Data - sysmon]
description = Detects usage of 'query.exe' a system binary to exfil information such as 'sessions' and 'processes' for later use
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*:\\Windows\\System32\\query.exe" (CommandLine="*session >*" OR CommandLine="*process >*"))) | eval sigma_attack_tags="attack.execution" | eval sigma_title="Query Usage To Exfil Data" | eval sigma_description="Detects usage of 'query.exe' a system binary to exfil information such as 'sessions' and 'processes' for later use"
dispatch.earliest_time = -24h@h
alert.track = 0

[BlackByte Ransomware Patterns - winevent]
description = This command line patterns found in BlackByte Ransomware operations
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((New_Process_Name="C:\\Users\\Public\\*" Process_Command_Line="* -single *")) OR (Process_Command_Line="*del C:\\Windows\\System32\\Taskmgr.exe*" OR Process_Command_Line="*;Set-Service -StartupType Disabled $*" OR Process_Command_Line="*powershell -command \"$x =[System.Text.Encoding]::Unicode.GetString([System.Convert]::FromBase64String(*" OR Process_Command_Line="* do start wordpad.exe /p *")))) | table ComputerName,Account_Name,Process_Command_Line | eval sigma_attack_tags="" | eval sigma_title="BlackByte Ransomware Patterns" | eval sigma_description="This command line patterns found in BlackByte Ransomware operations"
dispatch.earliest_time = -24h@h
alert.track = 0

[BlackByte Ransomware Patterns - sysmon]
description = This command line patterns found in BlackByte Ransomware operations
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((Image="C:\\Users\\Public\\*" CommandLine="* -single *")) OR (CommandLine="*del C:\\Windows\\System32\\Taskmgr.exe*" OR CommandLine="*;Set-Service -StartupType Disabled $*" OR CommandLine="*powershell -command \"$x =[System.Text.Encoding]::Unicode.GetString([System.Convert]::FromBase64String(*" OR CommandLine="* do start wordpad.exe /p *")))) | table ComputerName,User,CommandLine | eval sigma_attack_tags="" | eval sigma_title="BlackByte Ransomware Patterns" | eval sigma_description="This command line patterns found in BlackByte Ransomware operations"
dispatch.earliest_time = -24h@h
alert.track = 0

[RAR Greedy Compression - winevent]
description = Detects RAR usage that creates an archive from a suspicious folder, either a system folder or one of the folders often used by attackers for staging purposes
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\rar.exe" OR Description="Command line RAR" OR (Process_Command_Line="*.exe a *" OR Process_Command_Line="* a -m*")) ((Process_Command_Line="* -hp*" Process_Command_Line="* -r *" (Process_Command_Line="* C:\\\*.*" OR Process_Command_Line="* C:\\\\\*.*" OR Process_Command_Line="* C:\\Users\\Public\\*" OR Process_Command_Line="* %public%*" OR Process_Command_Line="* C:\\Windows\\*" OR Process_Command_Line="* C:\\PerfLogs\\*" OR Process_Command_Line="* C:\\Temp*" OR Process_Command_Line="* C:\\$Recycle.bin\\*"))))) | eval sigma_attack_tags="attack.execution attack.t1059" | eval sigma_title="RAR Greedy Compression" | eval sigma_description="Detects RAR usage that creates an archive from a suspicious folder, either a system folder or one of the folders often used by attackers for staging purposes"
dispatch.earliest_time = -24h@h
alert.track = 0

[RAR Greedy Compression - sysmon]
description = Detects RAR usage that creates an archive from a suspicious folder, either a system folder or one of the folders often used by attackers for staging purposes
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\rar.exe" OR Description="Command line RAR" OR (CommandLine="*.exe a *" OR CommandLine="* a -m*")) ((CommandLine="* -hp*" CommandLine="* -r *" (CommandLine="* C:\\\*.*" OR CommandLine="* C:\\\\\*.*" OR CommandLine="* C:\\Users\\Public\\*" OR CommandLine="* %public%*" OR CommandLine="* C:\\Windows\\*" OR CommandLine="* C:\\PerfLogs\\*" OR CommandLine="* C:\\Temp*" OR CommandLine="* C:\\$Recycle.bin\\*"))))) | eval sigma_attack_tags="attack.execution attack.t1059" | eval sigma_title="RAR Greedy Compression" | eval sigma_description="Detects RAR usage that creates an archive from a suspicious folder, either a system folder or one of the folders often used by attackers for staging purposes"
dispatch.earliest_time = -24h@h
alert.track = 0

[MSTSC Shadowing - winevent]
description = Detects RDP session hijacking by using MSTSC shadowing
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*noconsentprompt*" Process_Command_Line="*shadow:*")) | eval sigma_attack_tags="attack.lateral_movement attack.t1563.002" | eval sigma_title="MSTSC Shadowing" | eval sigma_description="Detects RDP session hijacking by using MSTSC shadowing"
dispatch.earliest_time = -24h@h
alert.track = 0

[MSTSC Shadowing - sysmon]
description = Detects RDP session hijacking by using MSTSC shadowing
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*noconsentprompt*" CommandLine="*shadow:*")) | eval sigma_attack_tags="attack.lateral_movement attack.t1563.002" | eval sigma_title="MSTSC Shadowing" | eval sigma_description="Detects RDP session hijacking by using MSTSC shadowing"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential RDP Session Hijacking Activity - winevent]
description = Detects RDP Session Hijacking on Windows systems
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\tscon.exe" OR OriginalFileName="tscon.exe") IntegrityLevel="SYSTEM")) | eval sigma_attack_tags="attack.execution" | eval sigma_title="Potential RDP Session Hijacking Activity" | eval sigma_description="Detects RDP Session Hijacking on Windows systems"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential RDP Session Hijacking Activity - sysmon]
description = Detects RDP Session Hijacking on Windows systems
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\tscon.exe" OR OriginalFileName="tscon.exe") IntegrityLevel="SYSTEM")) | eval sigma_attack_tags="attack.execution" | eval sigma_title="Potential RDP Session Hijacking Activity" | eval sigma_description="Detects RDP Session Hijacking on Windows systems"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Redirection to Local Admin Share - winevent]
description = Detects a suspicious output redirection to the local admins share, this technique is often found in malicious scripts or hacktool stagers
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) Process_Command_Line="*>*" ("\\\\127.0.0.1\\admin$\\" OR "\\\\localhost\\admin$\\"))) | eval sigma_attack_tags="" | eval sigma_title="Suspicious Redirection to Local Admin Share" | eval sigma_description="Detects a suspicious output redirection to the local admins share, this technique is often found in malicious scripts or hacktool stagers"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Redirection to Local Admin Share - sysmon]
description = Detects a suspicious output redirection to the local admins share, this technique is often found in malicious scripts or hacktool stagers
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) CommandLine="*>*" ("\\\\127.0.0.1\\admin$\\" OR "\\\\localhost\\admin$\\"))) | eval sigma_attack_tags="" | eval sigma_title="Suspicious Redirection to Local Admin Share" | eval sigma_description="Detects a suspicious output redirection to the local admins share, this technique is often found in malicious scripts or hacktool stagers"
dispatch.earliest_time = -24h@h
alert.track = 0

[RedMimicry Winnti Playbook Execution - winevent]
description = Detects actions caused by the RedMimicry Winnti playbook
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (New_Process_Name="*\\rundll32.exe" OR New_Process_Name="*\\cmd.exe") (Process_Command_Line="*gthread-3.6.dll*" OR Process_Command_Line="*\\Windows\\Temp\\tmp.bat*" OR Process_Command_Line="*sigcmm-2.4.dll*"))) | eval sigma_attack_tags="attack.execution attack.defense_evasion attack.t1106 attack.t1059.003 attack.t1218.011" | eval sigma_title="RedMimicry Winnti Playbook Execution" | eval sigma_description="Detects actions caused by the RedMimicry Winnti playbook"
dispatch.earliest_time = -24h@h
alert.track = 0

[RedMimicry Winnti Playbook Execution - sysmon]
description = Detects actions caused by the RedMimicry Winnti playbook
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (Image="*\\rundll32.exe" OR Image="*\\cmd.exe") (CommandLine="*gthread-3.6.dll*" OR CommandLine="*\\Windows\\Temp\\tmp.bat*" OR CommandLine="*sigcmm-2.4.dll*"))) | eval sigma_attack_tags="attack.execution attack.defense_evasion attack.t1106 attack.t1059.003 attack.t1218.011" | eval sigma_title="RedMimicry Winnti Playbook Execution" | eval sigma_description="Detects actions caused by the RedMimicry Winnti playbook"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential Persistence Attempt Via Run Keys Using Reg.EXE - winevent]
description = Detects suspicious command line reg.exe tool adding key to RUN key in Registry
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*reg*" Process_Command_Line="* ADD *" Process_Command_Line="*Software\\Microsoft\\Windows\\CurrentVersion\\Run*")) | eval sigma_attack_tags="attack.persistence attack.t1547.001" | eval sigma_title="Potential Persistence Attempt Via Run Keys Using Reg.EXE" | eval sigma_description="Detects suspicious command line reg.exe tool adding key to RUN key in Registry"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential Persistence Attempt Via Run Keys Using Reg.EXE - sysmon]
description = Detects suspicious command line reg.exe tool adding key to RUN key in Registry
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*reg*" CommandLine="* ADD *" CommandLine="*Software\\Microsoft\\Windows\\CurrentVersion\\Run*")) | eval sigma_attack_tags="attack.persistence attack.t1547.001" | eval sigma_title="Potential Persistence Attempt Via Run Keys Using Reg.EXE" | eval sigma_description="Detects suspicious command line reg.exe tool adding key to RUN key in Registry"
dispatch.earliest_time = -24h@h
alert.track = 0

[Add SafeBoot Keys Via Reg Utility - winevent]
description = Detects execution of 'reg.exe' commands with the 'add' or 'copy' flags on safe boot registry keys. Often used by attacker to allow the ransomware to work in safe mode as some security products do not
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*reg.exe" OR OriginalFileName="reg.exe") Process_Command_Line="*\\SYSTEM\\CurrentControlSet\\Control\\SafeBoot*" (Process_Command_Line="* copy *" OR Process_Command_Line="* add *"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.001" | eval sigma_title="Add SafeBoot Keys Via Reg Utility" | eval sigma_description="Detects execution of 'reg.exe' commands with the 'add' or 'copy' flags on safe boot registry keys. Often used by attacker to allow the ransomware to work in safe mode as some security products do not"
dispatch.earliest_time = -24h@h
alert.track = 0

[Add SafeBoot Keys Via Reg Utility - sysmon]
description = Detects execution of 'reg.exe' commands with the 'add' or 'copy' flags on safe boot registry keys. Often used by attacker to allow the ransomware to work in safe mode as some security products do not
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*reg.exe" OR OriginalFileName="reg.exe") CommandLine="*\\SYSTEM\\CurrentControlSet\\Control\\SafeBoot*" (CommandLine="* copy *" OR CommandLine="* add *"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.001" | eval sigma_title="Add SafeBoot Keys Via Reg Utility" | eval sigma_description="Detects execution of 'reg.exe' commands with the 'add' or 'copy' flags on safe boot registry keys. Often used by attacker to allow the ransomware to work in safe mode as some security products do not"
dispatch.earliest_time = -24h@h
alert.track = 0

[Registry Defender Exclusions - winevent]
description = Qbot used reg.exe to add Defender folder exceptions for folders within AppData and ProgramData.
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\reg.exe" (Process_Command_Line="*SOFTWARE\\Microsoft\\Windows Defender\\Exclusions\\Paths*" OR Process_Command_Line="*SOFTWARE\\Microsoft\\Microsoft Antimalware\\Exclusions\\Paths*") Process_Command_Line="*ADD *" Process_Command_Line="*/t *" Process_Command_Line="*REG_DWORD *" Process_Command_Line="*/v *" Process_Command_Line="*/d *" Process_Command_Line="*0*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.001" | eval sigma_title="Registry Defender Exclusions" | eval sigma_description="Qbot used reg.exe to add Defender folder exceptions for folders within AppData and ProgramData."
dispatch.earliest_time = -24h@h
alert.track = 0

[Registry Defender Exclusions - sysmon]
description = Qbot used reg.exe to add Defender folder exceptions for folders within AppData and ProgramData.
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\reg.exe" (CommandLine="*SOFTWARE\\Microsoft\\Windows Defender\\Exclusions\\Paths*" OR CommandLine="*SOFTWARE\\Microsoft\\Microsoft Antimalware\\Exclusions\\Paths*") CommandLine="*ADD *" CommandLine="*/t *" CommandLine="*REG_DWORD *" CommandLine="*/v *" CommandLine="*/d *" CommandLine="*0*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.001" | eval sigma_title="Registry Defender Exclusions" | eval sigma_description="Qbot used reg.exe to add Defender folder exceptions for folders within AppData and ProgramData."
dispatch.earliest_time = -24h@h
alert.track = 0

[Registry Defender Tampering - winevent]
description = Detects reg command lines that disable certain important features of Microsoft Defender
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((New_Process_Name="*\\reg.exe" OR OriginalFileName="reg.exe") (Process_Command_Line="*SOFTWARE\\Microsoft\\Windows Defender\\*" OR Process_Command_Line="*SOFTWARE\\Policies\\Microsoft\\Windows Defender\\*"))) (((Process_Command_Line="* add *" Process_Command_Line="* /d 0*" (Process_Command_Line="*Real-Time Protection*" OR Process_Command_Line="*TamperProtection*"))) OR ((Process_Command_Line="* add *" Process_Command_Line="* /d 1*" Process_Command_Line="*Notification_Suppress*"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.001" | eval sigma_title="Registry Defender Tampering" | eval sigma_description="Detects reg command lines that disable certain important features of Microsoft Defender"
dispatch.earliest_time = -24h@h
alert.track = 0

[Registry Defender Tampering - sysmon]
description = Detects reg command lines that disable certain important features of Microsoft Defender
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((Image="*\\reg.exe" OR OriginalFileName="reg.exe") (CommandLine="*SOFTWARE\\Microsoft\\Windows Defender\\*" OR CommandLine="*SOFTWARE\\Policies\\Microsoft\\Windows Defender\\*"))) (((CommandLine="* add *" CommandLine="* /d 0*" (CommandLine="*Real-Time Protection*" OR CommandLine="*TamperProtection*"))) OR ((CommandLine="* add *" CommandLine="* /d 1*" CommandLine="*Notification_Suppress*"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.001" | eval sigma_title="Registry Defender Tampering" | eval sigma_description="Detects reg command lines that disable certain important features of Microsoft Defender"
dispatch.earliest_time = -24h@h
alert.track = 0

[Delete SafeBoot Keys Via Reg Utility - winevent]
description = Detects execution of 'reg.exe' commands with the 'delete' flag on safe boot registry keys. Often used by attacker to prevent safeboot execution of security products
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*reg.exe" OR OriginalFileName="reg.exe") ((Process_Command_Line="* delete *" Process_Command_Line="*\\SYSTEM\\CurrentControlSet\\Control\\SafeBoot*")))) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.001" | eval sigma_title="Delete SafeBoot Keys Via Reg Utility" | eval sigma_description="Detects execution of 'reg.exe' commands with the 'delete' flag on safe boot registry keys. Often used by attacker to prevent safeboot execution of security products"
dispatch.earliest_time = -24h@h
alert.track = 0

[Delete SafeBoot Keys Via Reg Utility - sysmon]
description = Detects execution of 'reg.exe' commands with the 'delete' flag on safe boot registry keys. Often used by attacker to prevent safeboot execution of security products
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*reg.exe" OR OriginalFileName="reg.exe") ((CommandLine="* delete *" CommandLine="*\\SYSTEM\\CurrentControlSet\\Control\\SafeBoot*")))) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.001" | eval sigma_title="Delete SafeBoot Keys Via Reg Utility" | eval sigma_description="Detects execution of 'reg.exe' commands with the 'delete' flag on safe boot registry keys. Often used by attacker to prevent safeboot execution of security products"
dispatch.earliest_time = -24h@h
alert.track = 0

[Delete Services Via Reg Utility - winevent]
description = Detects execution of 'reg.exe' commands with the 'delete' flag on services registry key. Often used by attacker to remove AV software services
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*reg.exe" OR OriginalFileName="reg.exe") Process_Command_Line="* delete *" Process_Command_Line="*\\SYSTEM\\CurrentControlSet\\services\\*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.001" | eval sigma_title="Delete Services Via Reg Utility" | eval sigma_description="Detects execution of 'reg.exe' commands with the 'delete' flag on services registry key. Often used by attacker to remove AV software services"
dispatch.earliest_time = -24h@h
alert.track = 0

[Delete Services Via Reg Utility - sysmon]
description = Detects execution of 'reg.exe' commands with the 'delete' flag on services registry key. Often used by attacker to remove AV software services
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*reg.exe" OR OriginalFileName="reg.exe") CommandLine="* delete *" CommandLine="*\\SYSTEM\\CurrentControlSet\\services\\*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.001" | eval sigma_title="Delete Services Via Reg Utility" | eval sigma_description="Detects execution of 'reg.exe' commands with the 'delete' flag on services registry key. Often used by attacker to remove AV software services"
dispatch.earliest_time = -24h@h
alert.track = 0

[Enabling RDP Service via Reg.exe - winevent]
description = Detects the execution of reg.exe and subsequent command line arguments for enabling RDP service on the host by tampering with the 'CurrentControlSet\Control\Terminal Server' subkeys
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\reg.exe" Process_Command_Line="* add *" Process_Command_Line="*\\CurrentControlSet\\Control\\Terminal Server*" Process_Command_Line="*REG_DWORD*" Process_Command_Line="* /f*")) (((Process_Command_Line="*Licensing Core*" Process_Command_Line="*EnableConcurrentSessions*")) OR (Process_Command_Line="*WinStations\\RDP-Tcp*" OR Process_Command_Line="*MaxInstanceCount*" OR Process_Command_Line="*fEnableWinStation*" OR Process_Command_Line="*TSUserEnabled*" OR Process_Command_Line="*TSEnabled*" OR Process_Command_Line="*TSAppCompat*" OR Process_Command_Line="*IdleWinStationPoolCount*" OR Process_Command_Line="*TSAdvertise*" OR Process_Command_Line="*AllowTSConnections*" OR Process_Command_Line="*fSingleSessionPerUser*" OR Process_Command_Line="*fDenyTSConnections*")))) | eval sigma_attack_tags="attack.defense_evasion attack.lateral_movement attack.t1021.001 attack.t1112" | eval sigma_title="Enabling RDP Service via Reg.exe" | eval sigma_description="Detects the execution of reg.exe and subsequent command line arguments for enabling RDP service on the host by tampering with the 'CurrentControlSet\Control\Terminal Server' subkeys"
dispatch.earliest_time = -24h@h
alert.track = 0

[Enabling RDP Service via Reg.exe - sysmon]
description = Detects the execution of reg.exe and subsequent command line arguments for enabling RDP service on the host by tampering with the 'CurrentControlSet\Control\Terminal Server' subkeys
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\reg.exe" CommandLine="* add *" CommandLine="*\\CurrentControlSet\\Control\\Terminal Server*" CommandLine="*REG_DWORD*" CommandLine="* /f*")) (((CommandLine="*Licensing Core*" CommandLine="*EnableConcurrentSessions*")) OR (CommandLine="*WinStations\\RDP-Tcp*" OR CommandLine="*MaxInstanceCount*" OR CommandLine="*fEnableWinStation*" OR CommandLine="*TSUserEnabled*" OR CommandLine="*TSEnabled*" OR CommandLine="*TSAppCompat*" OR CommandLine="*IdleWinStationPoolCount*" OR CommandLine="*TSAdvertise*" OR CommandLine="*AllowTSConnections*" OR CommandLine="*fSingleSessionPerUser*" OR CommandLine="*fDenyTSConnections*")))) | eval sigma_attack_tags="attack.defense_evasion attack.lateral_movement attack.t1021.001 attack.t1112" | eval sigma_title="Enabling RDP Service via Reg.exe" | eval sigma_description="Detects the execution of reg.exe and subsequent command line arguments for enabling RDP service on the host by tampering with the 'CurrentControlSet\Control\Terminal Server' subkeys"
dispatch.earliest_time = -24h@h
alert.track = 0

[Imports Registry Key From a File Using Reg.exe - winevent]
description = Detects the import of the '.reg' files from suspicious paths using the 'reg.exe' utility
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\reg.exe" OR OriginalFileName="reg.exe") Process_Command_Line="* import *" (Process_Command_Line="*C:\\Users\\*" OR Process_Command_Line="*%temp%*" OR Process_Command_Line="*%tmp%*" OR Process_Command_Line="*%appdata%*" OR Process_Command_Line="*\\AppData\\Local\\Temp\\*" OR Process_Command_Line="*C:\\Windows\\Temp\\*" OR Process_Command_Line="*C:\\ProgramData\\*"))) | eval sigma_attack_tags="attack.t1112 attack.defense_evasion" | eval sigma_title="Imports Registry Key From a File Using Reg.exe" | eval sigma_description="Detects the import of the '.reg' files from suspicious paths using the 'reg.exe' utility"
dispatch.earliest_time = -24h@h
alert.track = 0

[Imports Registry Key From a File Using Reg.exe - sysmon]
description = Detects the import of the '.reg' files from suspicious paths using the 'reg.exe' utility
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\reg.exe" OR OriginalFileName="reg.exe") CommandLine="* import *" (CommandLine="*C:\\Users\\*" OR CommandLine="*%temp%*" OR CommandLine="*%tmp%*" OR CommandLine="*%appdata%*" OR CommandLine="*\\AppData\\Local\\Temp\\*" OR CommandLine="*C:\\Windows\\Temp\\*" OR CommandLine="*C:\\ProgramData\\*"))) | eval sigma_attack_tags="attack.t1112 attack.defense_evasion" | eval sigma_title="Imports Registry Key From a File Using Reg.exe" | eval sigma_description="Detects the import of the '.reg' files from suspicious paths using the 'reg.exe' utility"
dispatch.earliest_time = -24h@h
alert.track = 0

[LSA PPL Protection Disabled Via Reg.EXE - winevent]
description = Detects the usage of the 'reg.exe' utility to disable PPL protection on the LSA process
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\reg.exe" OR OriginalFileName="reg.exe") ((Process_Command_Line="*SYSTEM\\CurrentControlSet\\Control\\Lsa*" Process_Command_Line="* add *" Process_Command_Line="* /d 0*" Process_Command_Line="* /v RunAsPPL *")) (Process_Command_Line="*Real-Time Protection*" OR Process_Command_Line="*TamperProtection*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.010" | eval sigma_title="LSA PPL Protection Disabled Via Reg.EXE" | eval sigma_description="Detects the usage of the 'reg.exe' utility to disable PPL protection on the LSA process"
dispatch.earliest_time = -24h@h
alert.track = 0

[LSA PPL Protection Disabled Via Reg.EXE - sysmon]
description = Detects the usage of the 'reg.exe' utility to disable PPL protection on the LSA process
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\reg.exe" OR OriginalFileName="reg.exe") ((CommandLine="*SYSTEM\\CurrentControlSet\\Control\\Lsa*" CommandLine="* add *" CommandLine="* /d 0*" CommandLine="* /v RunAsPPL *")) (CommandLine="*Real-Time Protection*" OR CommandLine="*TamperProtection*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.010" | eval sigma_title="LSA PPL Protection Disabled Via Reg.EXE" | eval sigma_description="Detects the usage of the 'reg.exe' utility to disable PPL protection on the LSA process"
dispatch.earliest_time = -24h@h
alert.track = 0

[Exports Critical Registry Keys To a File - winevent]
description = Detects the export of a crital Registry key to a file.
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\regedit.exe" (Process_Command_Line="* /E *" OR Process_Command_Line="* -E *") (Process_Command_Line="*hklm*" OR Process_Command_Line="*hkey_local_machine*") (Process_Command_Line="*\\system" OR Process_Command_Line="*\\sam" OR Process_Command_Line="*\\security"))) | table Creator_Process_Name,Process_Command_Line | eval sigma_attack_tags="attack.exfiltration attack.t1012" | eval sigma_title="Exports Critical Registry Keys To a File" | eval sigma_description="Detects the export of a crital Registry key to a file."
dispatch.earliest_time = -24h@h
alert.track = 0

[Exports Critical Registry Keys To a File - sysmon]
description = Detects the export of a crital Registry key to a file.
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\regedit.exe" (CommandLine="* /E *" OR CommandLine="* -E *") (CommandLine="*hklm*" OR CommandLine="*hkey_local_machine*") (CommandLine="*\\system" OR CommandLine="*\\sam" OR CommandLine="*\\security"))) | table ParentImage,CommandLine | eval sigma_attack_tags="attack.exfiltration attack.t1012" | eval sigma_title="Exports Critical Registry Keys To a File" | eval sigma_description="Detects the export of a crital Registry key to a file."
dispatch.earliest_time = -24h@h
alert.track = 0

[Exports Registry Key To a File - winevent]
description = Detects the export of the target Registry key to a file.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\regedit.exe" (Process_Command_Line="* /E *" OR Process_Command_Line="* -E *"))) NOT (((((Process_Command_Line="*hklm*" OR Process_Command_Line="*hkey_local_machine*"))) (((Process_Command_Line="*\\system" OR Process_Command_Line="*\\sam" OR Process_Command_Line="*\\security"))))))) | table Creator_Process_Name,Process_Command_Line | eval sigma_attack_tags="attack.exfiltration attack.t1012" | eval sigma_title="Exports Registry Key To a File" | eval sigma_description="Detects the export of the target Registry key to a file."
dispatch.earliest_time = -24h@h
alert.track = 0

[Exports Registry Key To a File - sysmon]
description = Detects the export of the target Registry key to a file.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\regedit.exe" (CommandLine="* /E *" OR CommandLine="* -E *"))) NOT (((((CommandLine="*hklm*" OR CommandLine="*hkey_local_machine*"))) (((CommandLine="*\\system" OR CommandLine="*\\sam" OR CommandLine="*\\security"))))))) | table ParentImage,CommandLine | eval sigma_attack_tags="attack.exfiltration attack.t1012" | eval sigma_title="Exports Registry Key To a File" | eval sigma_description="Detects the export of the target Registry key to a file."
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential Remote Desktop Tunneling - winevent]
description = Detects potential use of an SSH utility to establish RDP over a reverse SSH Tunnel. This can be used by attackers to enable routing of network packets that would otherwise not reach their intended destination.
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*:3389*" (Process_Command_Line="* -L *" OR Process_Command_Line="* -P *" OR Process_Command_Line="* -R *" OR Process_Command_Line="* -pw *" OR Process_Command_Line="* -ssh *"))) | eval sigma_attack_tags="attack.lateral_movement attack.t1021" | eval sigma_title="Potential Remote Desktop Tunneling" | eval sigma_description="Detects potential use of an SSH utility to establish RDP over a reverse SSH Tunnel. This can be used by attackers to enable routing of network packets that would otherwise not reach their intended destination."
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential Remote Desktop Tunneling - sysmon]
description = Detects potential use of an SSH utility to establish RDP over a reverse SSH Tunnel. This can be used by attackers to enable routing of network packets that would otherwise not reach their intended destination.
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*:3389*" (CommandLine="* -L *" OR CommandLine="* -P *" OR CommandLine="* -R *" OR CommandLine="* -pw *" OR CommandLine="* -ssh *"))) | eval sigma_attack_tags="attack.lateral_movement attack.t1021" | eval sigma_title="Potential Remote Desktop Tunneling" | eval sigma_description="Detects potential use of an SSH utility to establish RDP over a reverse SSH Tunnel. This can be used by attackers to enable routing of network packets that would otherwise not reach their intended destination."
dispatch.earliest_time = -24h@h
alert.track = 0

[Remote File Download via Desktopimgdownldr Utility - winevent]
description = Detects the desktopimgdownldr utility being used to download a remote file. An adversary may use desktopimgdownldr to download arbitrary files as an alternative to certutil.
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\desktopimgdownldr.exe" Creator_Process_Name="*\\desktopimgdownldr.exe" Process_Command_Line="*/lockscreenurl:http*")) | eval sigma_attack_tags="attack.command_and_control attack.t1105" | eval sigma_title="Remote File Download via Desktopimgdownldr Utility" | eval sigma_description="Detects the desktopimgdownldr utility being used to download a remote file. An adversary may use desktopimgdownldr to download arbitrary files as an alternative to certutil."
dispatch.earliest_time = -24h@h
alert.track = 0

[Remote File Download via Desktopimgdownldr Utility - sysmon]
description = Detects the desktopimgdownldr utility being used to download a remote file. An adversary may use desktopimgdownldr to download arbitrary files as an alternative to certutil.
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\desktopimgdownldr.exe" ParentImage="*\\desktopimgdownldr.exe" CommandLine="*/lockscreenurl:http*")) | eval sigma_attack_tags="attack.command_and_control attack.t1105" | eval sigma_title="Remote File Download via Desktopimgdownldr Utility" | eval sigma_description="Detects the desktopimgdownldr utility being used to download a remote file. An adversary may use desktopimgdownldr to download arbitrary files as an alternative to certutil."
dispatch.earliest_time = -24h@h
alert.track = 0

[Remote PowerShell Session Host Process (WinRM) - winevent]
description = Detects remote PowerShell sections by monitoring for wsmprovhost (WinRM host process) as a parent or child process (sign of an active PowerShell remote session).
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\wsmprovhost.exe" OR Creator_Process_Name="*\\wsmprovhost.exe"))) | table ComputerName,Account_Name,Process_Command_Line | eval sigma_attack_tags="attack.execution attack.t1059.001 attack.t1021.006" | eval sigma_title="Remote PowerShell Session Host Process (WinRM)" | eval sigma_description="Detects remote PowerShell sections by monitoring for wsmprovhost (WinRM host process) as a parent or child process (sign of an active PowerShell remote session)."
dispatch.earliest_time = -24h@h
alert.track = 0

[Remote PowerShell Session Host Process (WinRM) - sysmon]
description = Detects remote PowerShell sections by monitoring for wsmprovhost (WinRM host process) as a parent or child process (sign of an active PowerShell remote session).
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\wsmprovhost.exe" OR ParentImage="*\\wsmprovhost.exe"))) | table ComputerName,User,CommandLine | eval sigma_attack_tags="attack.execution attack.t1059.001 attack.t1021.006" | eval sigma_title="Remote PowerShell Session Host Process (WinRM)" | eval sigma_description="Detects remote PowerShell sections by monitoring for wsmprovhost (WinRM host process) as a parent or child process (sign of an active PowerShell remote session)."
dispatch.earliest_time = -24h@h
alert.track = 0

[Discovery of a System Time - winevent]
description = Identifies use of various commands to query a systems time. This technique may be used before executing a scheduled task or to discover the time zone of a target system.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((((New_Process_Name="*\\net.exe" OR New_Process_Name="*\\net1.exe") Process_Command_Line="*time*")) OR ((New_Process_Name="*\\w32tm.exe" Process_Command_Line="*tz*"))))) | eval sigma_attack_tags="attack.discovery attack.t1124" | eval sigma_title="Discovery of a System Time" | eval sigma_description="Identifies use of various commands to query a systems time. This technique may be used before executing a scheduled task or to discover the time zone of a target system."
dispatch.earliest_time = -24h@h
alert.track = 0

[Discovery of a System Time - sysmon]
description = Identifies use of various commands to query a systems time. This technique may be used before executing a scheduled task or to discover the time zone of a target system.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((((Image="*\\net.exe" OR Image="*\\net1.exe") CommandLine="*time*")) OR ((Image="*\\w32tm.exe" CommandLine="*tz*"))))) | eval sigma_attack_tags="attack.discovery attack.t1124" | eval sigma_title="Discovery of a System Time" | eval sigma_description="Identifies use of various commands to query a systems time. This technique may be used before executing a scheduled task or to discover the time zone of a target system."
dispatch.earliest_time = -24h@h
alert.track = 0

[Remove Windows Defender Definition Files - winevent]
description = Adversaries may disable security tools to avoid possible detection of their tools and activities by removing Windows Defender Definition Files
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") OriginalFileName="MpCmdRun.exe" Process_Command_Line="* -RemoveDefinitions*" Process_Command_Line="* -All*")) | table ComputerName,Account_Name,Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.t1562.001" | eval sigma_title="Remove Windows Defender Definition Files" | eval sigma_description="Adversaries may disable security tools to avoid possible detection of their tools and activities by removing Windows Defender Definition Files"
dispatch.earliest_time = -24h@h
alert.track = 0

[Remove Windows Defender Definition Files - sysmon]
description = Adversaries may disable security tools to avoid possible detection of their tools and activities by removing Windows Defender Definition Files
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") OriginalFileName="MpCmdRun.exe" CommandLine="* -RemoveDefinitions*" CommandLine="* -All*")) | table ComputerName,User,CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.t1562.001" | eval sigma_title="Remove Windows Defender Definition Files" | eval sigma_description="Adversaries may disable security tools to avoid possible detection of their tools and activities by removing Windows Defender Definition Files"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential Defense Evasion Via Rename Of Highly Relevant Binaries - winevent]
description = Detects the execution of a renamed binary often used by attackers or malware leveraging new Sysmon OriginalFileName datapoint.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (Description="Execute processes remotely" OR Product="Sysinternals PsExec" OR (Description="Windows PowerShell*" OR Description="pwsh*") OR (OriginalFileName="powershell.exe" OR OriginalFileName="pwsh.dll" OR OriginalFileName="powershell_ise.exe" OR OriginalFileName="psexec.exe" OR OriginalFileName="psexec.c" OR OriginalFileName="psexesvc.exe" OR OriginalFileName="cscript.exe" OR OriginalFileName="wscript.exe" OR OriginalFileName="mshta.exe" OR OriginalFileName="regsvr32.exe" OR OriginalFileName="wmic.exe" OR OriginalFileName="certutil.exe" OR OriginalFileName="rundll32.exe" OR OriginalFileName="cmstp.exe" OR OriginalFileName="msiexec.exe")) NOT (((New_Process_Name="*\\powershell.exe" OR New_Process_Name="*\\pwsh.exe" OR New_Process_Name="*\\powershell_ise.exe" OR New_Process_Name="*\\psexec.exe" OR New_Process_Name="*\\psexec64.exe" OR New_Process_Name="*\\PSEXESVC.exe" OR New_Process_Name="*\\cscript.exe" OR New_Process_Name="*\\wscript.exe" OR New_Process_Name="*\\mshta.exe" OR New_Process_Name="*\\regsvr32.exe" OR New_Process_Name="*\\wmic.exe" OR New_Process_Name="*\\certutil.exe" OR New_Process_Name="*\\rundll32.exe" OR New_Process_Name="*\\cmstp.exe" OR New_Process_Name="*\\msiexec.exe"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1036.003 car.2013-05-009" | eval sigma_title="Potential Defense Evasion Via Rename Of Highly Relevant Binaries" | eval sigma_description="Detects the execution of a renamed binary often used by attackers or malware leveraging new Sysmon OriginalFileName datapoint."
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential Defense Evasion Via Rename Of Highly Relevant Binaries - sysmon]
description = Detects the execution of a renamed binary often used by attackers or malware leveraging new Sysmon OriginalFileName datapoint.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Description="Execute processes remotely" OR Product="Sysinternals PsExec" OR (Description="Windows PowerShell*" OR Description="pwsh*") OR (OriginalFileName="powershell.exe" OR OriginalFileName="pwsh.dll" OR OriginalFileName="powershell_ise.exe" OR OriginalFileName="psexec.exe" OR OriginalFileName="psexec.c" OR OriginalFileName="psexesvc.exe" OR OriginalFileName="cscript.exe" OR OriginalFileName="wscript.exe" OR OriginalFileName="mshta.exe" OR OriginalFileName="regsvr32.exe" OR OriginalFileName="wmic.exe" OR OriginalFileName="certutil.exe" OR OriginalFileName="rundll32.exe" OR OriginalFileName="cmstp.exe" OR OriginalFileName="msiexec.exe")) NOT (((Image="*\\powershell.exe" OR Image="*\\pwsh.exe" OR Image="*\\powershell_ise.exe" OR Image="*\\psexec.exe" OR Image="*\\psexec64.exe" OR Image="*\\PSEXESVC.exe" OR Image="*\\cscript.exe" OR Image="*\\wscript.exe" OR Image="*\\mshta.exe" OR Image="*\\regsvr32.exe" OR Image="*\\wmic.exe" OR Image="*\\certutil.exe" OR Image="*\\rundll32.exe" OR Image="*\\cmstp.exe" OR Image="*\\msiexec.exe"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1036.003 car.2013-05-009" | eval sigma_title="Potential Defense Evasion Via Rename Of Highly Relevant Binaries" | eval sigma_description="Detects the execution of a renamed binary often used by attackers or malware leveraging new Sysmon OriginalFileName datapoint."
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential Defense Evasion Via Binary Rename - winevent]
description = Detects the execution of a renamed binary often used by attackers or malware leveraging new Sysmon OriginalFileName datapoint.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (OriginalFileName="Cmd.Exe" OR OriginalFileName="CONHOST.EXE" OR OriginalFileName="7z.exe" OR OriginalFileName="WinRAR.exe" OR OriginalFileName="wevtutil.exe" OR OriginalFileName="net.exe" OR OriginalFileName="net1.exe" OR OriginalFileName="netsh.exe" OR OriginalFileName="InstallUtil.exe") NOT (((New_Process_Name="*\\cmd.exe" OR New_Process_Name="*\\conhost.exe" OR New_Process_Name="*\\7z.exe" OR New_Process_Name="*\\WinRAR.exe" OR New_Process_Name="*\\wevtutil.exe" OR New_Process_Name="*\\net.exe" OR New_Process_Name="*\\net1.exe" OR New_Process_Name="*\\netsh.exe" OR New_Process_Name="*\\InstallUtil.exe"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1036.003" | eval sigma_title="Potential Defense Evasion Via Binary Rename" | eval sigma_description="Detects the execution of a renamed binary often used by attackers or malware leveraging new Sysmon OriginalFileName datapoint."
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential Defense Evasion Via Binary Rename - sysmon]
description = Detects the execution of a renamed binary often used by attackers or malware leveraging new Sysmon OriginalFileName datapoint.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (OriginalFileName="Cmd.Exe" OR OriginalFileName="CONHOST.EXE" OR OriginalFileName="7z.exe" OR OriginalFileName="WinRAR.exe" OR OriginalFileName="wevtutil.exe" OR OriginalFileName="net.exe" OR OriginalFileName="net1.exe" OR OriginalFileName="netsh.exe" OR OriginalFileName="InstallUtil.exe") NOT (((Image="*\\cmd.exe" OR Image="*\\conhost.exe" OR Image="*\\7z.exe" OR Image="*\\WinRAR.exe" OR Image="*\\wevtutil.exe" OR Image="*\\net.exe" OR Image="*\\net1.exe" OR Image="*\\netsh.exe" OR Image="*\\InstallUtil.exe"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1036.003" | eval sigma_title="Potential Defense Evasion Via Binary Rename" | eval sigma_description="Detects the execution of a renamed binary often used by attackers or malware leveraging new Sysmon OriginalFileName datapoint."
dispatch.earliest_time = -24h@h
alert.track = 0

[Process Creation with Renamed BrowserCore.exe - winevent]
description = Detects process creation with a renamed BrowserCore.exe (used to extract Azure tokens)
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) OriginalFileName="BrowserCore.exe" NOT (((New_Process_Name="*\\BrowserCore.exe"))))) | eval sigma_attack_tags="attack.t1528 attack.t1036.003" | eval sigma_title="Process Creation with Renamed BrowserCore.exe" | eval sigma_description="Detects process creation with a renamed BrowserCore.exe (used to extract Azure tokens)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Process Creation with Renamed BrowserCore.exe - sysmon]
description = Detects process creation with a renamed BrowserCore.exe (used to extract Azure tokens)
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) OriginalFileName="BrowserCore.exe" NOT (((Image="*\\BrowserCore.exe"))))) | eval sigma_attack_tags="attack.t1528 attack.t1036.003" | eval sigma_title="Process Creation with Renamed BrowserCore.exe" | eval sigma_description="Detects process creation with a renamed BrowserCore.exe (used to extract Azure tokens)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Renamed FTP.EXE Binary Execution - winevent]
description = Detects execution of renamed ftp.exe binary based on OriginalFileName field
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) OriginalFileName="ftp.exe" NOT ((New_Process_Name="*\\ftp.exe")))) | table Process_Command_Line,Creator_Process_Name | eval sigma_attack_tags="attack.execution attack.t1059 attack.defense_evasion attack.t1202" | eval sigma_title="Renamed FTP.EXE Binary Execution" | eval sigma_description="Detects execution of renamed ftp.exe binary based on OriginalFileName field"
dispatch.earliest_time = -24h@h
alert.track = 0

[Renamed FTP.EXE Binary Execution - sysmon]
description = Detects execution of renamed ftp.exe binary based on OriginalFileName field
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) OriginalFileName="ftp.exe" NOT ((Image="*\\ftp.exe")))) | table CommandLine,ParentImage | eval sigma_attack_tags="attack.execution attack.t1059 attack.defense_evasion attack.t1202" | eval sigma_title="Renamed FTP.EXE Binary Execution" | eval sigma_description="Detects execution of renamed ftp.exe binary based on OriginalFileName field"
dispatch.earliest_time = -24h@h
alert.track = 0

[Renamed jusched.exe - winevent]
description = Detects renamed jusched.exe used by cobalt group
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (Description="Java Update Scheduler" OR Description="Java(TM) Update Scheduler") NOT ((New_Process_Name="*\\jusched.exe")))) | eval sigma_attack_tags="attack.execution attack.defense_evasion attack.t1036.003" | eval sigma_title="Renamed jusched.exe" | eval sigma_description="Detects renamed jusched.exe used by cobalt group"
dispatch.earliest_time = -24h@h
alert.track = 0

[Renamed jusched.exe - sysmon]
description = Detects renamed jusched.exe used by cobalt group
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Description="Java Update Scheduler" OR Description="Java(TM) Update Scheduler") NOT ((Image="*\\jusched.exe")))) | eval sigma_attack_tags="attack.execution attack.defense_evasion attack.t1036.003" | eval sigma_title="Renamed jusched.exe" | eval sigma_description="Detects renamed jusched.exe used by cobalt group"
dispatch.earliest_time = -24h@h
alert.track = 0

[Rename Mavinject Execution - winevent]
description = Detects execution of a renamed version of the 'Mavinject' process. Which can be abused to perform process injection using the '/INJECTRUNNING' flag
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (OriginalFileName="mavinject32.exe" OR OriginalFileName="mavinject64.exe") NOT (((New_Process_Name="*\\mavinject32.exe" OR New_Process_Name="*\\mavinject64.exe"))))) | eval sigma_attack_tags="attack.defense_evasion attack.privilege_escalation attack.t1055.001 attack.t1218.013" | eval sigma_title="Rename Mavinject Execution" | eval sigma_description="Detects execution of a renamed version of the 'Mavinject' process. Which can be abused to perform process injection using the '/INJECTRUNNING' flag"
dispatch.earliest_time = -24h@h
alert.track = 0

[Rename Mavinject Execution - sysmon]
description = Detects execution of a renamed version of the 'Mavinject' process. Which can be abused to perform process injection using the '/INJECTRUNNING' flag
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (OriginalFileName="mavinject32.exe" OR OriginalFileName="mavinject64.exe") NOT (((Image="*\\mavinject32.exe" OR Image="*\\mavinject64.exe"))))) | eval sigma_attack_tags="attack.defense_evasion attack.privilege_escalation attack.t1055.001 attack.t1218.013" | eval sigma_title="Rename Mavinject Execution" | eval sigma_description="Detects execution of a renamed version of the 'Mavinject' process. Which can be abused to perform process injection using the '/INJECTRUNNING' flag"
dispatch.earliest_time = -24h@h
alert.track = 0

[Renamed MegaSync - winevent]
description = Detects the execution of a renamed meg.exe of MegaSync during incident response engagements associated with ransomware families like Nefilim, Sodinokibi, Pysa, and Conti.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((Creator_Process_Name="*\\explorer.exe" Process_Command_Line="*C:\\Windows\\Temp\\meg.exe*")) OR ((OriginalFileName="meg.exe" NOT ((New_Process_Name="*\\meg.exe"))))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218" | eval sigma_title="Renamed MegaSync" | eval sigma_description="Detects the execution of a renamed meg.exe of MegaSync during incident response engagements associated with ransomware families like Nefilim, Sodinokibi, Pysa, and Conti."
dispatch.earliest_time = -24h@h
alert.track = 0

[Renamed MegaSync - sysmon]
description = Detects the execution of a renamed meg.exe of MegaSync during incident response engagements associated with ransomware families like Nefilim, Sodinokibi, Pysa, and Conti.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((ParentImage="*\\explorer.exe" CommandLine="*C:\\Windows\\Temp\\meg.exe*")) OR ((OriginalFileName="meg.exe" NOT ((Image="*\\meg.exe"))))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218" | eval sigma_title="Renamed MegaSync" | eval sigma_description="Detects the execution of a renamed meg.exe of MegaSync during incident response engagements associated with ransomware families like Nefilim, Sodinokibi, Pysa, and Conti."
dispatch.earliest_time = -24h@h
alert.track = 0

[Renamed Msdt.exe - winevent]
description = Detects process creation with a renamed Msdt.exe
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) OriginalFileName="msdt.exe" NOT (((New_Process_Name="*\\msdt.exe"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1036.003" | eval sigma_title="Renamed Msdt.exe" | eval sigma_description="Detects process creation with a renamed Msdt.exe"
dispatch.earliest_time = -24h@h
alert.track = 0

[Renamed Msdt.exe - sysmon]
description = Detects process creation with a renamed Msdt.exe
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) OriginalFileName="msdt.exe" NOT (((Image="*\\msdt.exe"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1036.003" | eval sigma_title="Renamed Msdt.exe" | eval sigma_description="Detects process creation with a renamed Msdt.exe"
dispatch.earliest_time = -24h@h
alert.track = 0

[Execution of Renamed NetSupport RAT - winevent]
description = Detects execution of renamed client32.exe (NetSupport RAT) via Imphash, Product and OriginalFileName strings
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (Product="*NetSupport Remote Control*" OR OriginalFileName="*client32.exe*" OR Imphash="a9d50692e95b79723f3e76fcf70d023e" OR Hashes="*IMPHASH=A9D50692E95B79723F3E76FCF70D023E*") NOT ((New_Process_Name="*\\client32.exe")))) | eval sigma_attack_tags="attack.defense_evasion" | eval sigma_title="Execution of Renamed NetSupport RAT" | eval sigma_description="Detects execution of renamed client32.exe (NetSupport RAT) via Imphash, Product and OriginalFileName strings"
dispatch.earliest_time = -24h@h
alert.track = 0

[Execution of Renamed NetSupport RAT - sysmon]
description = Detects execution of renamed client32.exe (NetSupport RAT) via Imphash, Product and OriginalFileName strings
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Product="*NetSupport Remote Control*" OR OriginalFileName="*client32.exe*" OR Imphash="a9d50692e95b79723f3e76fcf70d023e" OR Hashes="*IMPHASH=A9D50692E95B79723F3E76FCF70D023E*") NOT ((Image="*\\client32.exe")))) | eval sigma_attack_tags="attack.defense_evasion" | eval sigma_title="Execution of Renamed NetSupport RAT" | eval sigma_description="Detects execution of renamed client32.exe (NetSupport RAT) via Imphash, Product and OriginalFileName strings"
dispatch.earliest_time = -24h@h
alert.track = 0

[Renamed Office Binary Execution - winevent]
description = Detects the execution of a renamed office binaries
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((OriginalFileName="Excel.exe" OR OriginalFileName="MSACCESS.EXE" OR OriginalFileName="OneNote.exe" OR OriginalFileName="POWERPNT.EXE" OR OriginalFileName="WinWord.exe") OR (Description="Microsoft Access" OR Description="Microsoft Excel" OR Description="Microsoft OneNote" OR Description="Microsoft PowerPoint" OR Description="Microsoft Word")) NOT (((New_Process_Name="*\\EXCEL.exe" OR New_Process_Name="*\\MSACCESS.exe" OR New_Process_Name="*\\ONENOTE.EXE" OR New_Process_Name="*\\POWERPNT.EXE" OR New_Process_Name="*\\WINWORD.exe"))))) | eval sigma_attack_tags="attack.defense_evasion" | eval sigma_title="Renamed Office Binary Execution" | eval sigma_description="Detects the execution of a renamed office binaries"
dispatch.earliest_time = -24h@h
alert.track = 0

[Renamed Office Binary Execution - sysmon]
description = Detects the execution of a renamed office binaries
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((OriginalFileName="Excel.exe" OR OriginalFileName="MSACCESS.EXE" OR OriginalFileName="OneNote.exe" OR OriginalFileName="POWERPNT.EXE" OR OriginalFileName="WinWord.exe") OR (Description="Microsoft Access" OR Description="Microsoft Excel" OR Description="Microsoft OneNote" OR Description="Microsoft PowerPoint" OR Description="Microsoft Word")) NOT (((Image="*\\EXCEL.exe" OR Image="*\\MSACCESS.exe" OR Image="*\\ONENOTE.EXE" OR Image="*\\POWERPNT.EXE" OR Image="*\\WINWORD.exe"))))) | eval sigma_attack_tags="attack.defense_evasion" | eval sigma_title="Renamed Office Binary Execution" | eval sigma_description="Detects the execution of a renamed office binaries"
dispatch.earliest_time = -24h@h
alert.track = 0

[Execution of Renamed PaExec - winevent]
description = Detects execution of renamed paexec via imphash and executable product string
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((Product="*PAExec*" ((Imphash="11D40A7B7876288F919AB819CC2D9802" OR Imphash="6444f8a34e99b8f7d9647de66aabe516" OR Imphash="dfd6aa3f7b2b1035b76b718f1ddc689f" OR Imphash="1a6cca4d5460b1710a12dea39e4a592c") OR (Hashes="*IMPHASH=11D40A7B7876288F919AB819CC2D9802*" OR Hashes="*IMPHASH=6444f8a34e99b8f7d9647de66aabe516*" OR Hashes="*IMPHASH=dfd6aa3f7b2b1035b76b718f1ddc689f*" OR Hashes="*IMPHASH=1a6cca4d5460b1710a12dea39e4a592c*")))) NOT ((New_Process_Name="*paexec*")))) | eval sigma_attack_tags="attack.defense_evasion attack.t1036.003 attack.g0046 car.2013-05-009 attack.execution attack.t1569.002" | eval sigma_title="Execution of Renamed PaExec" | eval sigma_description="Detects execution of renamed paexec via imphash and executable product string"
dispatch.earliest_time = -24h@h
alert.track = 0

[Execution of Renamed PaExec - sysmon]
description = Detects execution of renamed paexec via imphash and executable product string
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Product="*PAExec*" ((Imphash="11D40A7B7876288F919AB819CC2D9802" OR Imphash="6444f8a34e99b8f7d9647de66aabe516" OR Imphash="dfd6aa3f7b2b1035b76b718f1ddc689f" OR Imphash="1a6cca4d5460b1710a12dea39e4a592c") OR (Hashes="*IMPHASH=11D40A7B7876288F919AB819CC2D9802*" OR Hashes="*IMPHASH=6444f8a34e99b8f7d9647de66aabe516*" OR Hashes="*IMPHASH=dfd6aa3f7b2b1035b76b718f1ddc689f*" OR Hashes="*IMPHASH=1a6cca4d5460b1710a12dea39e4a592c*")))) NOT ((Image="*paexec*")))) | eval sigma_attack_tags="attack.defense_evasion attack.t1036.003 attack.g0046 car.2013-05-009 attack.execution attack.t1569.002" | eval sigma_title="Execution of Renamed PaExec" | eval sigma_description="Detects execution of renamed paexec via imphash and executable product string"
dispatch.earliest_time = -24h@h
alert.track = 0

[Execution Of Renamed Plink Binary - winevent]
description = Execution of a renamed version of the Plink binary
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (OriginalFileName="Plink" OR ((Process_Command_Line="* -l forward*" Process_Command_Line="* -P *" Process_Command_Line="* -R *"))) NOT ((New_Process_Name="*\\plink.exe")))) | eval sigma_attack_tags="attack.defense_evasion attack.t1036" | eval sigma_title="Execution Of Renamed Plink Binary" | eval sigma_description="Execution of a renamed version of the Plink binary"
dispatch.earliest_time = -24h@h
alert.track = 0

[Execution Of Renamed Plink Binary - sysmon]
description = Execution of a renamed version of the Plink binary
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (OriginalFileName="Plink" OR ((CommandLine="* -l forward*" CommandLine="* -P *" CommandLine="* -R *"))) NOT ((Image="*\\plink.exe")))) | eval sigma_attack_tags="attack.defense_evasion attack.t1036" | eval sigma_title="Execution Of Renamed Plink Binary" | eval sigma_description="Execution of a renamed version of the Plink binary"
dispatch.earliest_time = -24h@h
alert.track = 0

[Renamed ProcDump Execution - winevent]
description = Detects the execution of a renamed ProcDump executable often used by attackers or malware
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (OriginalFileName="procdump" OR (((Process_Command_Line="* -ma *" OR Process_Command_Line="* /ma *") (Process_Command_Line="* -accepteula *" OR Process_Command_Line="* /accepteula *")))) NOT (((New_Process_Name="*\\procdump.exe" OR New_Process_Name="*\\procdump64.exe"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1036.003" | eval sigma_title="Renamed ProcDump Execution" | eval sigma_description="Detects the execution of a renamed ProcDump executable often used by attackers or malware"
dispatch.earliest_time = -24h@h
alert.track = 0

[Renamed ProcDump Execution - sysmon]
description = Detects the execution of a renamed ProcDump executable often used by attackers or malware
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (OriginalFileName="procdump" OR (((CommandLine="* -ma *" OR CommandLine="* /ma *") (CommandLine="* -accepteula *" OR CommandLine="* /accepteula *")))) NOT (((Image="*\\procdump.exe" OR Image="*\\procdump64.exe"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1036.003" | eval sigma_title="Renamed ProcDump Execution" | eval sigma_description="Detects the execution of a renamed ProcDump executable often used by attackers or malware"
dispatch.earliest_time = -24h@h
alert.track = 0

[Renamed Rundll32 Execution Via DllRegisterServer - winevent]
description = Detects when 'DllRegisterServer' is called in the commandline and the image is not rundll32. This could mean that the 'rundll32' utility has been renamed in order to avoid detection
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) Process_Command_Line="*DllRegisterServer*" NOT ((New_Process_Name="*\\rundll32.exe")))) | eval sigma_attack_tags="attack.execution" | eval sigma_title="Renamed Rundll32 Execution Via DllRegisterServer" | eval sigma_description="Detects when 'DllRegisterServer' is called in the commandline and the image is not rundll32. This could mean that the 'rundll32' utility has been renamed in order to avoid detection"
dispatch.earliest_time = -24h@h
alert.track = 0

[Renamed Rundll32 Execution Via DllRegisterServer - sysmon]
description = Detects when 'DllRegisterServer' is called in the commandline and the image is not rundll32. This could mean that the 'rundll32' utility has been renamed in order to avoid detection
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) CommandLine="*DllRegisterServer*" NOT ((Image="*\\rundll32.exe")))) | eval sigma_attack_tags="attack.execution" | eval sigma_title="Renamed Rundll32 Execution Via DllRegisterServer" | eval sigma_description="Detects when 'DllRegisterServer' is called in the commandline and the image is not rundll32. This could mean that the 'rundll32' utility has been renamed in order to avoid detection"
dispatch.earliest_time = -24h@h
alert.track = 0

[Execution of Renamed Remote Utilities RAT (RURAT) - winevent]
description = Detects execution of renamed Remote Utilities (RURAT) via Product PE header field
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) Product="Remote Utilities" NOT (((New_Process_Name="*\\rutserv.exe" OR New_Process_Name="*\\rfusclient.exe"))))) | eval sigma_attack_tags="attack.defense_evasion attack.collection attack.command_and_control attack.discovery attack.s0592" | eval sigma_title="Execution of Renamed Remote Utilities RAT (RURAT)" | eval sigma_description="Detects execution of renamed Remote Utilities (RURAT) via Product PE header field"
dispatch.earliest_time = -24h@h
alert.track = 0

[Execution of Renamed Remote Utilities RAT (RURAT) - sysmon]
description = Detects execution of renamed Remote Utilities (RURAT) via Product PE header field
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) Product="Remote Utilities" NOT (((Image="*\\rutserv.exe" OR Image="*\\rfusclient.exe"))))) | eval sigma_attack_tags="attack.defense_evasion attack.collection attack.command_and_control attack.discovery attack.s0592" | eval sigma_title="Execution of Renamed Remote Utilities RAT (RURAT)" | eval sigma_description="Detects execution of renamed Remote Utilities (RURAT) via Product PE header field"
dispatch.earliest_time = -24h@h
alert.track = 0

[Renamed Sysinternals Sdelete Usage - winevent]
description = Detects the use of a renamed SysInternals Sdelete, which is something an administrator shouldn't do (the renaming)
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) OriginalFileName="sdelete.exe" NOT (((New_Process_Name="*\\sdelete.exe" OR New_Process_Name="*\\sdelete64.exe"))))) | table ComputerName,Account_Name,Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.impact attack.t1485" | eval sigma_title="Renamed Sysinternals Sdelete Usage" | eval sigma_description="Detects the use of a renamed SysInternals Sdelete, which is something an administrator shouldn't do (the renaming)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Renamed Sysinternals Sdelete Usage - sysmon]
description = Detects the use of a renamed SysInternals Sdelete, which is something an administrator shouldn't do (the renaming)
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) OriginalFileName="sdelete.exe" NOT (((Image="*\\sdelete.exe" OR Image="*\\sdelete64.exe"))))) | table ComputerName,User,CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.impact attack.t1485" | eval sigma_title="Renamed Sysinternals Sdelete Usage" | eval sigma_description="Detects the use of a renamed SysInternals Sdelete, which is something an administrator shouldn't do (the renaming)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Renamed or Portable Vmnat.exe - winevent]
description = Detects renamed vmnat.exe or portable version that can be used for DLL side-loading
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) OriginalFileName="vmnat.exe" NOT (((New_Process_Name="*vmnat.exe")) OR (((New_Process_Name="C:\\Program Files (x86)\\VMware\\VMware Workstation\\vmnat.exe" OR New_Process_Name="C:\\Windows\\SysWOW64\\vmnat.exe")))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1574.002" | eval sigma_title="Renamed or Portable Vmnat.exe" | eval sigma_description="Detects renamed vmnat.exe or portable version that can be used for DLL side-loading"
dispatch.earliest_time = -24h@h
alert.track = 0

[Renamed or Portable Vmnat.exe - sysmon]
description = Detects renamed vmnat.exe or portable version that can be used for DLL side-loading
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) OriginalFileName="vmnat.exe" NOT (((Image="*vmnat.exe")) OR (((Image="C:\\Program Files (x86)\\VMware\\VMware Workstation\\vmnat.exe" OR Image="C:\\Windows\\SysWOW64\\vmnat.exe")))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1574.002" | eval sigma_title="Renamed or Portable Vmnat.exe" | eval sigma_description="Detects renamed vmnat.exe or portable version that can be used for DLL side-loading"
dispatch.earliest_time = -24h@h
alert.track = 0

[Renamed Whoami Execution - winevent]
description = Detects the execution of whoami that has been renamed to a different name to avoid detection
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) OriginalFileName="whoami.exe" NOT ((New_Process_Name="*\\whoami.exe")))) | eval sigma_attack_tags="attack.discovery attack.t1033 car.2016-03-001" | eval sigma_title="Renamed Whoami Execution" | eval sigma_description="Detects the execution of whoami that has been renamed to a different name to avoid detection"
dispatch.earliest_time = -24h@h
alert.track = 0

[Renamed Whoami Execution - sysmon]
description = Detects the execution of whoami that has been renamed to a different name to avoid detection
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) OriginalFileName="whoami.exe" NOT ((Image="*\\whoami.exe")))) | eval sigma_attack_tags="attack.discovery attack.t1033 car.2016-03-001" | eval sigma_title="Renamed Whoami Execution" | eval sigma_description="Detects the execution of whoami that has been renamed to a different name to avoid detection"
dispatch.earliest_time = -24h@h
alert.track = 0

[Rhadamanthys Stealer Module Launch via Rundll32 - winevent]
description = Detects the use of Rundll32 to launch an NSIS module that serves as the main stealer capability of Rhadamanthys infostealer, as observed in reports and samples in early 2023
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (OriginalFileName="RUNDLL32.EXE" OR New_Process_Name="*\\rundll32.exe") Process_Command_Line="*nsis_uns*" Process_Command_Line="*PrintUIEntry*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1218.011" | eval sigma_title="Rhadamanthys Stealer Module Launch via Rundll32" | eval sigma_description="Detects the use of Rundll32 to launch an NSIS module that serves as the main stealer capability of Rhadamanthys infostealer, as observed in reports and samples in early 2023"
dispatch.earliest_time = -24h@h
alert.track = 0

[Rhadamanthys Stealer Module Launch via Rundll32 - sysmon]
description = Detects the use of Rundll32 to launch an NSIS module that serves as the main stealer capability of Rhadamanthys infostealer, as observed in reports and samples in early 2023
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (OriginalFileName="RUNDLL32.EXE" OR Image="*\\rundll32.exe") CommandLine="*nsis_uns*" CommandLine="*PrintUIEntry*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1218.011" | eval sigma_title="Rhadamanthys Stealer Module Launch via Rundll32" | eval sigma_description="Detects the use of Rundll32 to launch an NSIS module that serves as the main stealer capability of Rhadamanthys infostealer, as observed in reports and samples in early 2023"
dispatch.earliest_time = -24h@h
alert.track = 0

[Root Certificate Installed - winevent]
description = Adversaries may install a root certificate on a compromised system to avoid warnings when connecting to adversary controlled web servers.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((New_Process_Name="*\\certutil.exe" Process_Command_Line="*-addstore*" Process_Command_Line="*root*")) OR ((New_Process_Name="*\\CertMgr.exe" Process_Command_Line="*/add*" Process_Command_Line="*root*"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1553.004" | eval sigma_title="Root Certificate Installed" | eval sigma_description="Adversaries may install a root certificate on a compromised system to avoid warnings when connecting to adversary controlled web servers."
dispatch.earliest_time = -24h@h
alert.track = 0

[Root Certificate Installed - sysmon]
description = Adversaries may install a root certificate on a compromised system to avoid warnings when connecting to adversary controlled web servers.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((Image="*\\certutil.exe" CommandLine="*-addstore*" CommandLine="*root*")) OR ((Image="*\\CertMgr.exe" CommandLine="*/add*" CommandLine="*root*"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1553.004" | eval sigma_title="Root Certificate Installed" | eval sigma_description="Adversaries may install a root certificate on a compromised system to avoid warnings when connecting to adversary controlled web servers."
dispatch.earliest_time = -24h@h
alert.track = 0

[Remote Procedure Call Service Anomaly - winevent]
description = Detects suspicious remote procedure call (RPC) service anomalies based on the spawned sub processes (long shot to detect the exploitation of vulnerabilities like CVE-2022-26809)
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") ParentCommandLine="C:\\WINDOWS\\system32\\svchost.exe -k RPCSS*")) | eval sigma_attack_tags="attack.initial_access attack.t1190 attack.execution attack.t1569.002" | eval sigma_title="Remote Procedure Call Service Anomaly" | eval sigma_description="Detects suspicious remote procedure call (RPC) service anomalies based on the spawned sub processes (long shot to detect the exploitation of vulnerabilities like CVE-2022-26809)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Remote Procedure Call Service Anomaly - sysmon]
description = Detects suspicious remote procedure call (RPC) service anomalies based on the spawned sub processes (long shot to detect the exploitation of vulnerabilities like CVE-2022-26809)
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") ParentCommandLine="C:\\WINDOWS\\system32\\svchost.exe -k RPCSS*")) | eval sigma_attack_tags="attack.initial_access attack.t1190 attack.execution attack.t1569.002" | eval sigma_title="Remote Procedure Call Service Anomaly" | eval sigma_description="Detects suspicious remote procedure call (RPC) service anomalies based on the spawned sub processes (long shot to detect the exploitation of vulnerabilities like CVE-2022-26809)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Ruby Inline Command Execution - winevent]
description = Detects execution of ruby using the '-e' flag. This is could be used as a way to launch a reverse shell or execute live ruby code.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\ruby.exe" OR OriginalFileName="ruby.exe") Process_Command_Line="* -e*")) | eval sigma_attack_tags="attack.execution attack.t1059" | eval sigma_title="Ruby Inline Command Execution" | eval sigma_description="Detects execution of ruby using the '-e' flag. This is could be used as a way to launch a reverse shell or execute live ruby code."
dispatch.earliest_time = -24h@h
alert.track = 0

[Ruby Inline Command Execution - sysmon]
description = Detects execution of ruby using the '-e' flag. This is could be used as a way to launch a reverse shell or execute live ruby code.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\ruby.exe" OR OriginalFileName="ruby.exe") CommandLine="* -e*")) | eval sigma_attack_tags="attack.execution attack.t1059" | eval sigma_title="Ruby Inline Command Execution" | eval sigma_description="Detects execution of ruby using the '-e' flag. This is could be used as a way to launch a reverse shell or execute live ruby code."
dispatch.earliest_time = -24h@h
alert.track = 0

[Rundll32 Execution Without DLL File - winevent]
description = Detects the execution of rundll32 with a command line that doesn't contain a .dll file
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) New_Process_Name="*\\rundll32.exe" NOT (((NOT Process_Command_Line="*")) OR ((Process_Command_Line="*.dll*") OR (Process_Command_Line="")) OR ((Creator_Process_Name="*:\\Program Files\\Internet Explorer\\iexplore.exe" Process_Command_Line="*.cpl*")) OR ((Creator_Process_Name="*:\\Windows\\SysWOW64\\msiexec.exe" ParentCommandLine="C:\\Windows\\syswow64\\MsiExec.exe -Embedding*")) OR ((Creator_Process_Name="*:\\Windows\\System32\\msiexec.exe" ParentCommandLine="C:\\Windows\\system32\\MsiExec.exe -Embedding*")) OR ((Creator_Process_Name="*:\\Windows\\System32\\cmd.exe" ParentCommandLine="* C:\\Program Files\\SplunkUniversalForwarder\\*")) OR ((Process_Command_Line="* -localserver *")) OR ((ParentCommandLine="C:\\Windows\\system32\\rundll32.exe\" \"C:\\Program Files\\McAfee\\MSC\\mcmscins.dll\",DllUninstallFunction *") OR (Process_Command_Line="C:\\Windows\\system32\\rundll32.exe\" /uninstall /longpath \"C:\\Program Files\\McAfee\\MSC\\mscrem.inf*")) OR ((Creator_Process_Name="C:\\Users\\*" Creator_Process_Name="*\\AppData\\Local\\Microsoft\\EdgeUpdate\\Install\\{*" Creator_Process_Name="*\\setup.exe" ParentCommandLine="*\\setup.exe\" --install-archive=\"C:\\Users\\*"))))) | table New_Process_Name,Process_Command_Line | eval sigma_attack_tags="" | eval sigma_title="Rundll32 Execution Without DLL File" | eval sigma_description="Detects the execution of rundll32 with a command line that doesn't contain a .dll file"
dispatch.earliest_time = -24h@h
alert.track = 0

[Rundll32 Execution Without DLL File - sysmon]
description = Detects the execution of rundll32 with a command line that doesn't contain a .dll file
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) Image="*\\rundll32.exe" NOT (((NOT CommandLine="*")) OR ((CommandLine="*.dll*") OR (CommandLine="")) OR ((ParentImage="*:\\Program Files\\Internet Explorer\\iexplore.exe" CommandLine="*.cpl*")) OR ((ParentImage="*:\\Windows\\SysWOW64\\msiexec.exe" ParentCommandLine="C:\\Windows\\syswow64\\MsiExec.exe -Embedding*")) OR ((ParentImage="*:\\Windows\\System32\\msiexec.exe" ParentCommandLine="C:\\Windows\\system32\\MsiExec.exe -Embedding*")) OR ((ParentImage="*:\\Windows\\System32\\cmd.exe" ParentCommandLine="* C:\\Program Files\\SplunkUniversalForwarder\\*")) OR ((CommandLine="* -localserver *")) OR ((ParentCommandLine="C:\\Windows\\system32\\rundll32.exe\" \"C:\\Program Files\\McAfee\\MSC\\mcmscins.dll\",DllUninstallFunction *") OR (CommandLine="C:\\Windows\\system32\\rundll32.exe\" /uninstall /longpath \"C:\\Program Files\\McAfee\\MSC\\mscrem.inf*")) OR ((ParentImage="C:\\Users\\*" ParentImage="*\\AppData\\Local\\Microsoft\\EdgeUpdate\\Install\\{*" ParentImage="*\\setup.exe" ParentCommandLine="*\\setup.exe\" --install-archive=\"C:\\Users\\*"))))) | table Image,CommandLine | eval sigma_attack_tags="" | eval sigma_title="Rundll32 Execution Without DLL File" | eval sigma_description="Detects the execution of rundll32 with a command line that doesn't contain a .dll file"
dispatch.earliest_time = -24h@h
alert.track = 0

[Run PowerShell Script from ADS - winevent]
description = Detects PowerShell script execution from Alternate Data Stream (ADS)
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (Creator_Process_Name="*\\powershell.exe" OR Creator_Process_Name="*\\pwsh.exe") (New_Process_Name="*\\powershell.exe" OR New_Process_Name="*\\pwsh.exe") Process_Command_Line="*Get-Content*" Process_Command_Line="*-Stream*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1564.004" | eval sigma_title="Run PowerShell Script from ADS" | eval sigma_description="Detects PowerShell script execution from Alternate Data Stream (ADS)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Run PowerShell Script from ADS - sysmon]
description = Detects PowerShell script execution from Alternate Data Stream (ADS)
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (ParentImage="*\\powershell.exe" OR ParentImage="*\\pwsh.exe") (Image="*\\powershell.exe" OR Image="*\\pwsh.exe") CommandLine="*Get-Content*" CommandLine="*-Stream*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1564.004" | eval sigma_title="Run PowerShell Script from ADS" | eval sigma_description="Detects PowerShell script execution from Alternate Data Stream (ADS)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Detect Virtualbox Driver Installation OR Starting Of VMs - winevent]
description = Adversaries can carry out malicious operations using a virtual instance to avoid detection. This rule is built to detect the registration of the Virtualbox driver or start of a Virtualbox VM.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((Process_Command_Line="*VBoxRT.dll,RTR3Init*" OR Process_Command_Line="*VBoxC.dll*" OR Process_Command_Line="*VBoxDrv.sys*") OR (Process_Command_Line="*startvm*" OR Process_Command_Line="*controlvm*")))) | table ComputerName,Account_Name,Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.t1564.006 attack.t1564" | eval sigma_title="Detect Virtualbox Driver Installation OR Starting Of VMs" | eval sigma_description="Adversaries can carry out malicious operations using a virtual instance to avoid detection. This rule is built to detect the registration of the Virtualbox driver or start of a Virtualbox VM."
dispatch.earliest_time = -24h@h
alert.track = 0

[Detect Virtualbox Driver Installation OR Starting Of VMs - sysmon]
description = Adversaries can carry out malicious operations using a virtual instance to avoid detection. This rule is built to detect the registration of the Virtualbox driver or start of a Virtualbox VM.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((CommandLine="*VBoxRT.dll,RTR3Init*" OR CommandLine="*VBoxC.dll*" OR CommandLine="*VBoxDrv.sys*") OR (CommandLine="*startvm*" OR CommandLine="*controlvm*")))) | table ComputerName,User,CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.t1564.006 attack.t1564" | eval sigma_title="Detect Virtualbox Driver Installation OR Starting Of VMs" | eval sigma_description="Adversaries can carry out malicious operations using a virtual instance to avoid detection. This rule is built to detect the registration of the Virtualbox driver or start of a Virtualbox VM."
dispatch.earliest_time = -24h@h
alert.track = 0

[Rundll32 With Suspicious Parent Process - winevent]
description = Detects suspicious start of rundll32.exe with a parent process of Explorer.exe. Variant of Raspberry Robin, as first reported by Red Canary.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\rundll32.exe" Creator_Process_Name="*\\explorer.exe")) NOT ((Process_Command_Line="* C:\\Windows\\System32\\*") OR (Process_Command_Line="* -localserver 22d8c27b-47a1-48d1-ad08-7da7abd79617")))) | table New_Process_Name,Creator_Process_Name | eval sigma_attack_tags="attack.defense_evasion" | eval sigma_title="Rundll32 With Suspicious Parent Process" | eval sigma_description="Detects suspicious start of rundll32.exe with a parent process of Explorer.exe. Variant of Raspberry Robin, as first reported by Red Canary."
dispatch.earliest_time = -24h@h
alert.track = 0

[Rundll32 With Suspicious Parent Process - sysmon]
description = Detects suspicious start of rundll32.exe with a parent process of Explorer.exe. Variant of Raspberry Robin, as first reported by Red Canary.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\rundll32.exe" ParentImage="*\\explorer.exe")) NOT ((CommandLine="* C:\\Windows\\System32\\*") OR (CommandLine="* -localserver 22d8c27b-47a1-48d1-ad08-7da7abd79617")))) | table Image,ParentImage | eval sigma_attack_tags="attack.defense_evasion" | eval sigma_title="Rundll32 With Suspicious Parent Process" | eval sigma_description="Detects suspicious start of rundll32.exe with a parent process of Explorer.exe. Variant of Raspberry Robin, as first reported by Red Canary."
dispatch.earliest_time = -24h@h
alert.track = 0

[Rundll32 Registered COM Objects - winevent]
description = load malicious registered COM objects
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\rundll32.exe" (Process_Command_Line="*-sta *" OR Process_Command_Line="*-localserver *") Process_Command_Line="*{*" Process_Command_Line="*}*")) | eval sigma_attack_tags="attack.privilege_escalation attack.persistence attack.t1546.015" | eval sigma_title="Rundll32 Registered COM Objects" | eval sigma_description="load malicious registered COM objects"
dispatch.earliest_time = -24h@h
alert.track = 0

[Rundll32 Registered COM Objects - sysmon]
description = load malicious registered COM objects
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\rundll32.exe" (CommandLine="*-sta *" OR CommandLine="*-localserver *") CommandLine="*{*" CommandLine="*}*")) | eval sigma_attack_tags="attack.privilege_escalation attack.persistence attack.t1546.015" | eval sigma_title="Rundll32 Registered COM Objects" | eval sigma_description="load malicious registered COM objects"
dispatch.earliest_time = -24h@h
alert.track = 0

[Rundll32 UNC Path Execution - winevent]
description = Detects rundll32 execution where the DLL is located on a remote location (share)
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\rundll32.exe" OR OriginalFileName="RUNDLL32.EXE" OR Process_Command_Line="*rundll32*") Process_Command_Line="* \\\\\*")) | eval sigma_attack_tags="attack.defense_evasion attack.execution attack.t1021.002 attack.t1218.011" | eval sigma_title="Rundll32 UNC Path Execution" | eval sigma_description="Detects rundll32 execution where the DLL is located on a remote location (share)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Rundll32 UNC Path Execution - sysmon]
description = Detects rundll32 execution where the DLL is located on a remote location (share)
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\rundll32.exe" OR OriginalFileName="RUNDLL32.EXE" OR CommandLine="*rundll32*") CommandLine="* \\\\\*")) | eval sigma_attack_tags="attack.defense_evasion attack.execution attack.t1021.002 attack.t1218.011" | eval sigma_title="Rundll32 UNC Path Execution" | eval sigma_description="Detects rundll32 execution where the DLL is located on a remote location (share)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Rundll32 Without Parameters - winevent]
description = Detects rundll32 execution without parameters as observed when running Metasploit windows/smb/psexec exploit module
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="rundll32.exe")) | table ComputerName,SubjectUserName,Process_Command_Line,New_Process_Name,Creator_Process_Name | eval sigma_attack_tags="attack.lateral_movement attack.t1021.002 attack.t1570 attack.execution attack.t1569.002" | eval sigma_title="Rundll32 Without Parameters" | eval sigma_description="Detects rundll32 execution without parameters as observed when running Metasploit windows/smb/psexec exploit module"
dispatch.earliest_time = -24h@h
alert.track = 0

[Rundll32 Without Parameters - sysmon]
description = Detects rundll32 execution without parameters as observed when running Metasploit windows/smb/psexec exploit module
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="rundll32.exe")) | table ComputerName,SubjectUserName,CommandLine,Image,ParentImage | eval sigma_attack_tags="attack.lateral_movement attack.t1021.002 attack.t1570 attack.execution attack.t1569.002" | eval sigma_title="Rundll32 Without Parameters" | eval sigma_description="Detects rundll32 execution without parameters as observed when running Metasploit windows/smb/psexec exploit module"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Execution of Sc to Delete AV Services - winevent]
description = Detects when attackers use 'sc.exe' to delete AV services from the system in order to avoid detection
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\sc.exe" OR OriginalFileName="sc.exe") Process_Command_Line="* delete *" (Process_Command_Line="*AvgAdminServer*" OR Process_Command_Line="*AVG Antivirus*" OR Process_Command_Line="*MBEndpointAgent*" OR Process_Command_Line="*MBAMService*" OR Process_Command_Line="*MBCloudEA*" OR Process_Command_Line="*avgAdminClient*" OR Process_Command_Line="*SAVService*" OR Process_Command_Line="*SAVAdminService*" OR Process_Command_Line="*Sophos AutoUpdate Service*" OR Process_Command_Line="*Sophos Clean Service*" OR Process_Command_Line="*Sophos Device Control Service*" OR Process_Command_Line="*Sophos File Scanner Service*" OR Process_Command_Line="*Sophos Health Service*" OR Process_Command_Line="*Sophos MCS Agent*" OR Process_Command_Line="*Sophos MCS Client*" OR Process_Command_Line="*SntpService*" OR Process_Command_Line="*swc_service*" OR Process_Command_Line="*swi_service*" OR Process_Command_Line="*Sophos UI*" OR Process_Command_Line="*swi_update*" OR Process_Command_Line="*Sophos Web Control Service*" OR Process_Command_Line="*Sophos System Protection Service*" OR Process_Command_Line="*Sophos Safestore Service*" OR Process_Command_Line="*hmpalertsvc*" OR Process_Command_Line="*RpcEptMapper*" OR Process_Command_Line="*Sophos Endpoint Defense Service*" OR Process_Command_Line="*SophosFIM*" OR Process_Command_Line="*swi_filter*" OR Process_Command_Line="*FirebirdGuardianDefaultInstance*" OR Process_Command_Line="*FirebirdServerDefaultInstance*" OR Process_Command_Line="*WRSVC*" OR Process_Command_Line="*ekrn*" OR Process_Command_Line="*ekrnEpsw*" OR Process_Command_Line="*klim6*" OR Process_Command_Line="*AVP18.0.0*" OR Process_Command_Line="*KLIF*" OR Process_Command_Line="*klpd*" OR Process_Command_Line="*klflt*" OR Process_Command_Line="*klbackupdisk*" OR Process_Command_Line="*klbackupflt*" OR Process_Command_Line="*klkbdflt*" OR Process_Command_Line="*klmouflt*" OR Process_Command_Line="*klhk*" OR Process_Command_Line="*KSDE1.0.0*" OR Process_Command_Line="*kltap*" OR Process_Command_Line="*ScSecSvc*" OR Process_Command_Line="*Core Mail Protection*" OR Process_Command_Line="*Core Scanning Server*" OR Process_Command_Line="*Core Scanning ServerEx*" OR Process_Command_Line="*Online Protection System*" OR Process_Command_Line="*RepairService*" OR Process_Command_Line="*Core Browsing Protection*" OR Process_Command_Line="*Quick Update Service*" OR Process_Command_Line="*McAfeeFramework*" OR Process_Command_Line="*macmnsvc*" OR Process_Command_Line="*masvc*" OR Process_Command_Line="*mfemms*" OR Process_Command_Line="*mfevtp*" OR Process_Command_Line="*TmFilter*" OR Process_Command_Line="*TMLWCSService*" OR Process_Command_Line="*tmusa*" OR Process_Command_Line="*TmPreFilter*" OR Process_Command_Line="*TMSmartRelayService*" OR Process_Command_Line="*TMiCRCScanService*" OR Process_Command_Line="*VSApiNt*" OR Process_Command_Line="*TmCCSF*" OR Process_Command_Line="*tmlisten*" OR Process_Command_Line="*TmProxy*" OR Process_Command_Line="*ntrtscan*" OR Process_Command_Line="*ofcservice*" OR Process_Command_Line="*TmPfw*" OR Process_Command_Line="*PccNTUpd*" OR Process_Command_Line="*PandaAetherAgent*" OR Process_Command_Line="*PSUAService*" OR Process_Command_Line="*NanoServiceMain*" OR Process_Command_Line="*EPIntegrationService*" OR Process_Command_Line="*EPProtectedService*" OR Process_Command_Line="*EPRedline*" OR Process_Command_Line="*EPSecurityService*" OR Process_Command_Line="*EPUpdateService*"))) | eval sigma_attack_tags="attack.execution attack.defense_evasion attack.t1562.001" | eval sigma_title="Suspicious Execution of Sc to Delete AV Services" | eval sigma_description="Detects when attackers use 'sc.exe' to delete AV services from the system in order to avoid detection"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Execution of Sc to Delete AV Services - sysmon]
description = Detects when attackers use 'sc.exe' to delete AV services from the system in order to avoid detection
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\sc.exe" OR OriginalFileName="sc.exe") CommandLine="* delete *" (CommandLine="*AvgAdminServer*" OR CommandLine="*AVG Antivirus*" OR CommandLine="*MBEndpointAgent*" OR CommandLine="*MBAMService*" OR CommandLine="*MBCloudEA*" OR CommandLine="*avgAdminClient*" OR CommandLine="*SAVService*" OR CommandLine="*SAVAdminService*" OR CommandLine="*Sophos AutoUpdate Service*" OR CommandLine="*Sophos Clean Service*" OR CommandLine="*Sophos Device Control Service*" OR CommandLine="*Sophos File Scanner Service*" OR CommandLine="*Sophos Health Service*" OR CommandLine="*Sophos MCS Agent*" OR CommandLine="*Sophos MCS Client*" OR CommandLine="*SntpService*" OR CommandLine="*swc_service*" OR CommandLine="*swi_service*" OR CommandLine="*Sophos UI*" OR CommandLine="*swi_update*" OR CommandLine="*Sophos Web Control Service*" OR CommandLine="*Sophos System Protection Service*" OR CommandLine="*Sophos Safestore Service*" OR CommandLine="*hmpalertsvc*" OR CommandLine="*RpcEptMapper*" OR CommandLine="*Sophos Endpoint Defense Service*" OR CommandLine="*SophosFIM*" OR CommandLine="*swi_filter*" OR CommandLine="*FirebirdGuardianDefaultInstance*" OR CommandLine="*FirebirdServerDefaultInstance*" OR CommandLine="*WRSVC*" OR CommandLine="*ekrn*" OR CommandLine="*ekrnEpsw*" OR CommandLine="*klim6*" OR CommandLine="*AVP18.0.0*" OR CommandLine="*KLIF*" OR CommandLine="*klpd*" OR CommandLine="*klflt*" OR CommandLine="*klbackupdisk*" OR CommandLine="*klbackupflt*" OR CommandLine="*klkbdflt*" OR CommandLine="*klmouflt*" OR CommandLine="*klhk*" OR CommandLine="*KSDE1.0.0*" OR CommandLine="*kltap*" OR CommandLine="*ScSecSvc*" OR CommandLine="*Core Mail Protection*" OR CommandLine="*Core Scanning Server*" OR CommandLine="*Core Scanning ServerEx*" OR CommandLine="*Online Protection System*" OR CommandLine="*RepairService*" OR CommandLine="*Core Browsing Protection*" OR CommandLine="*Quick Update Service*" OR CommandLine="*McAfeeFramework*" OR CommandLine="*macmnsvc*" OR CommandLine="*masvc*" OR CommandLine="*mfemms*" OR CommandLine="*mfevtp*" OR CommandLine="*TmFilter*" OR CommandLine="*TMLWCSService*" OR CommandLine="*tmusa*" OR CommandLine="*TmPreFilter*" OR CommandLine="*TMSmartRelayService*" OR CommandLine="*TMiCRCScanService*" OR CommandLine="*VSApiNt*" OR CommandLine="*TmCCSF*" OR CommandLine="*tmlisten*" OR CommandLine="*TmProxy*" OR CommandLine="*ntrtscan*" OR CommandLine="*ofcservice*" OR CommandLine="*TmPfw*" OR CommandLine="*PccNTUpd*" OR CommandLine="*PandaAetherAgent*" OR CommandLine="*PSUAService*" OR CommandLine="*NanoServiceMain*" OR CommandLine="*EPIntegrationService*" OR CommandLine="*EPProtectedService*" OR CommandLine="*EPRedline*" OR CommandLine="*EPSecurityService*" OR CommandLine="*EPUpdateService*"))) | eval sigma_attack_tags="attack.execution attack.defense_evasion attack.t1562.001" | eval sigma_title="Suspicious Execution of Sc to Delete AV Services" | eval sigma_description="Detects when attackers use 'sc.exe' to delete AV services from the system in order to avoid detection"
dispatch.earliest_time = -24h@h
alert.track = 0

[SC.EXE Query Execution - winevent]
description = Detects execution of 'sc.exe' to query information about registered services on the system
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\sc.exe" OriginalFileName="*sc.exe" Process_Command_Line="* query*")) | eval sigma_attack_tags="attack.discovery attack.t1007" | eval sigma_title="SC.EXE Query Execution" | eval sigma_description="Detects execution of 'sc.exe' to query information about registered services on the system"
dispatch.earliest_time = -24h@h
alert.track = 0

[SC.EXE Query Execution - sysmon]
description = Detects execution of 'sc.exe' to query information about registered services on the system
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\sc.exe" OriginalFileName="*sc.exe" CommandLine="* query*")) | eval sigma_attack_tags="attack.discovery attack.t1007" | eval sigma_title="SC.EXE Query Execution" | eval sigma_description="Detects execution of 'sc.exe' to query information about registered services on the system"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Schtasks Execution AppData Folder - winevent]
description = Detects the creation of a schtask that executes a file from C:\Users\<USER>\AppData\Local
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\schtasks.exe" Process_Command_Line="*/Create*" Process_Command_Line="*/RU*" Process_Command_Line="*/TR*" Process_Command_Line="*C:\\Users\\*" Process_Command_Line="*\\AppData\\Local\\*" (Process_Command_Line="*NT AUT*" OR Process_Command_Line="* SYSTEM *"))) NOT (((Creator_Process_Name="*\\AppData\\Local\\Temp\\*" Creator_Process_Name="*TeamViewer_.exe*") New_Process_Name="*\\schtasks.exe" Process_Command_Line="*/TN TVInstallRestore*")))) | eval sigma_attack_tags="attack.execution attack.persistence attack.t1053.005 attack.t1059.001" | eval sigma_title="Suspicious Schtasks Execution AppData Folder" | eval sigma_description="Detects the creation of a schtask that executes a file from C:\Users\<USER>\AppData\Local"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Schtasks Execution AppData Folder - sysmon]
description = Detects the creation of a schtask that executes a file from C:\Users\<USER>\AppData\Local
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\schtasks.exe" CommandLine="*/Create*" CommandLine="*/RU*" CommandLine="*/TR*" CommandLine="*C:\\Users\\*" CommandLine="*\\AppData\\Local\\*" (CommandLine="*NT AUT*" OR CommandLine="* SYSTEM *"))) NOT (((ParentImage="*\\AppData\\Local\\Temp\\*" ParentImage="*TeamViewer_.exe*") Image="*\\schtasks.exe" CommandLine="*/TN TVInstallRestore*")))) | eval sigma_attack_tags="attack.execution attack.persistence attack.t1053.005 attack.t1059.001" | eval sigma_title="Suspicious Schtasks Execution AppData Folder" | eval sigma_description="Detects the creation of a schtask that executes a file from C:\Users\<USER>\AppData\Local"
dispatch.earliest_time = -24h@h
alert.track = 0

[Uncommon Scheduled Task Once 00:00 - winevent]
description = Detects scheduled task creation events that include suspicious actions, and is run once at 00:00
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\schtasks.exe*" (Process_Command_Line="*wscript*" OR Process_Command_Line="*vbscript*" OR Process_Command_Line="*cscript*" OR Process_Command_Line="*wmic *" OR Process_Command_Line="*wmic.exe*" OR Process_Command_Line="*regsvr32.exe*" OR Process_Command_Line="*powershell*" OR Process_Command_Line="*\\AppData\\*"))) (((Process_Command_Line="*once*" Process_Command_Line="*00:00*")) OR Process_Command_Line="*Joke*"))) | eval sigma_attack_tags="" | eval sigma_title="Uncommon Scheduled Task Once 00:00" | eval sigma_description="Detects scheduled task creation events that include suspicious actions, and is run once at 00:00"
dispatch.earliest_time = -24h@h
alert.track = 0

[Uncommon Scheduled Task Once 00:00 - sysmon]
description = Detects scheduled task creation events that include suspicious actions, and is run once at 00:00
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\schtasks.exe*" (CommandLine="*wscript*" OR CommandLine="*vbscript*" OR CommandLine="*cscript*" OR CommandLine="*wmic *" OR CommandLine="*wmic.exe*" OR CommandLine="*regsvr32.exe*" OR CommandLine="*powershell*" OR CommandLine="*\\AppData\\*"))) (((CommandLine="*once*" CommandLine="*00:00*")) OR CommandLine="*Joke*"))) | eval sigma_attack_tags="" | eval sigma_title="Uncommon Scheduled Task Once 00:00" | eval sigma_description="Detects scheduled task creation events that include suspicious actions, and is run once at 00:00"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Powershell No File or Command - winevent]
description = Detects suspicious powershell execution that ends with a common flag instead of a command or a filename to execute (could be a sign of implicit execution that uses files in WindowsApps directory)
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (Process_Command_Line="* -windowstyle hidden\"" OR Process_Command_Line="* -windowstyle hidden" OR Process_Command_Line="* -windowstyle hidden'" OR Process_Command_Line="* -w hidden\"" OR Process_Command_Line="* -w hidden" OR Process_Command_Line="* -w hidden'" OR Process_Command_Line="* -ep bypass\"" OR Process_Command_Line="* -ep bypass" OR Process_Command_Line="* -ep bypass'" OR Process_Command_Line="* -noni\"" OR Process_Command_Line="* -noni" OR Process_Command_Line="* -noni'"))) | eval sigma_attack_tags="attack.execution attack.persistence attack.t1053.005 attack.t1059.001" | eval sigma_title="Suspicious Powershell No File or Command" | eval sigma_description="Detects suspicious powershell execution that ends with a common flag instead of a command or a filename to execute (could be a sign of implicit execution that uses files in WindowsApps directory)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Powershell No File or Command - sysmon]
description = Detects suspicious powershell execution that ends with a common flag instead of a command or a filename to execute (could be a sign of implicit execution that uses files in WindowsApps directory)
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (CommandLine="* -windowstyle hidden\"" OR CommandLine="* -windowstyle hidden" OR CommandLine="* -windowstyle hidden'" OR CommandLine="* -w hidden\"" OR CommandLine="* -w hidden" OR CommandLine="* -w hidden'" OR CommandLine="* -ep bypass\"" OR CommandLine="* -ep bypass" OR CommandLine="* -ep bypass'" OR CommandLine="* -noni\"" OR CommandLine="* -noni" OR CommandLine="* -noni'"))) | eval sigma_attack_tags="attack.execution attack.persistence attack.t1053.005 attack.t1059.001" | eval sigma_title="Suspicious Powershell No File or Command" | eval sigma_description="Detects suspicious powershell execution that ends with a common flag instead of a command or a filename to execute (could be a sign of implicit execution that uses files in WindowsApps directory)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Scheduled Task Executing Powershell Encoded Payload from Registry - winevent]
description = Detects the creation of a schtask that executes a base64 encoded payload stored in the Windows Registry using PowerShell.
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\schtasks.exe" Process_Command_Line="*/Create*" Process_Command_Line="*/SC*" Process_Command_Line="*FromBase64String*" Process_Command_Line="*Get-ItemProperty*" (Process_Command_Line="*HKCU:*" OR Process_Command_Line="*HKLM:*" OR Process_Command_Line="*registry::*" OR Process_Command_Line="*HKEY_*"))) | eval sigma_attack_tags="attack.execution attack.persistence attack.t1053.005 attack.t1059.001" | eval sigma_title="Scheduled Task Executing Powershell Encoded Payload from Registry" | eval sigma_description="Detects the creation of a schtask that executes a base64 encoded payload stored in the Windows Registry using PowerShell."
dispatch.earliest_time = -24h@h
alert.track = 0

[Scheduled Task Executing Powershell Encoded Payload from Registry - sysmon]
description = Detects the creation of a schtask that executes a base64 encoded payload stored in the Windows Registry using PowerShell.
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\schtasks.exe" CommandLine="*/Create*" CommandLine="*/SC*" CommandLine="*FromBase64String*" CommandLine="*Get-ItemProperty*" (CommandLine="*HKCU:*" OR CommandLine="*HKLM:*" OR CommandLine="*registry::*" OR CommandLine="*HKEY_*"))) | eval sigma_attack_tags="attack.execution attack.persistence attack.t1053.005 attack.t1059.001" | eval sigma_title="Scheduled Task Executing Powershell Encoded Payload from Registry" | eval sigma_description="Detects the creation of a schtask that executes a base64 encoded payload stored in the Windows Registry using PowerShell."
dispatch.earliest_time = -24h@h
alert.track = 0

[Schtasks Creation Or Modification With SYSTEM Privileges - winevent]
description = Detects the creation or update of a scheduled task to run with 'NT AUTHORITY\SYSTEM' privileges
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\schtasks.exe" (Process_Command_Line="* /change *" OR Process_Command_Line="* /create *") Process_Command_Line="*/ru *" (Process_Command_Line="*NT AUT*" OR Process_Command_Line="* SYSTEM *"))) NOT (((Creator_Process_Name="*\\AppData\\Local\\Temp\\*" Creator_Process_Name="*TeamViewer_.exe*") New_Process_Name="*\\schtasks.exe" Process_Command_Line="*/TN TVInstallRestore*")))) | eval sigma_attack_tags="attack.execution attack.persistence attack.t1053.005" | eval sigma_title="Schtasks Creation Or Modification With SYSTEM Privileges" | eval sigma_description="Detects the creation or update of a scheduled task to run with 'NT AUTHORITY\SYSTEM' privileges"
dispatch.earliest_time = -24h@h
alert.track = 0

[Schtasks Creation Or Modification With SYSTEM Privileges - sysmon]
description = Detects the creation or update of a scheduled task to run with 'NT AUTHORITY\SYSTEM' privileges
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\schtasks.exe" (CommandLine="* /change *" OR CommandLine="* /create *") CommandLine="*/ru *" (CommandLine="*NT AUT*" OR CommandLine="* SYSTEM *"))) NOT (((ParentImage="*\\AppData\\Local\\Temp\\*" ParentImage="*TeamViewer_.exe*") Image="*\\schtasks.exe" CommandLine="*/TN TVInstallRestore*")))) | eval sigma_attack_tags="attack.execution attack.persistence attack.t1053.005" | eval sigma_title="Schtasks Creation Or Modification With SYSTEM Privileges" | eval sigma_description="Detects the creation or update of a scheduled task to run with 'NT AUTHORITY\SYSTEM' privileges"
dispatch.earliest_time = -24h@h
alert.track = 0

[ScreenConnect Backstage Mode Anomaly - winevent]
description = Detects suspicious sub processes started by the ScreenConnect client service, which indicates the use of the so-called Backstage mode
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Creator_Process_Name="*ScreenConnect.ClientService.exe" (New_Process_Name="*\\cmd.exe" OR New_Process_Name="*\\powershell.exe" OR New_Process_Name="*\\pwsh.exe"))) | eval sigma_attack_tags="attack.command_and_control attack.t1219" | eval sigma_title="ScreenConnect Backstage Mode Anomaly" | eval sigma_description="Detects suspicious sub processes started by the ScreenConnect client service, which indicates the use of the so-called Backstage mode"
dispatch.earliest_time = -24h@h
alert.track = 0

[ScreenConnect Backstage Mode Anomaly - sysmon]
description = Detects suspicious sub processes started by the ScreenConnect client service, which indicates the use of the so-called Backstage mode
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") ParentImage="*ScreenConnect.ClientService.exe" (Image="*\\cmd.exe" OR Image="*\\powershell.exe" OR Image="*\\pwsh.exe"))) | eval sigma_attack_tags="attack.command_and_control attack.t1219" | eval sigma_title="ScreenConnect Backstage Mode Anomaly" | eval sigma_description="Detects suspicious sub processes started by the ScreenConnect client service, which indicates the use of the so-called Backstage mode"
dispatch.earliest_time = -24h@h
alert.track = 0

[Script Event Consumer Spawning Process - winevent]
description = Detects a suspicious child process of Script Event Consumer (scrcons.exe).
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Creator_Process_Name="*\\scrcons.exe" (New_Process_Name="*\\svchost.exe" OR New_Process_Name="*\\dllhost.exe" OR New_Process_Name="*\\powershell.exe" OR New_Process_Name="*\\pwsh.exe" OR New_Process_Name="*\\wscript.exe" OR New_Process_Name="*\\cscript.exe" OR New_Process_Name="*\\schtasks.exe" OR New_Process_Name="*\\regsvr32.exe" OR New_Process_Name="*\\mshta.exe" OR New_Process_Name="*\\rundll32.exe" OR New_Process_Name="*\\msiexec.exe" OR New_Process_Name="*\\msbuild.exe"))) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.execution attack.t1047" | eval sigma_title="Script Event Consumer Spawning Process" | eval sigma_description="Detects a suspicious child process of Script Event Consumer (scrcons.exe)."
dispatch.earliest_time = -24h@h
alert.track = 0

[Script Event Consumer Spawning Process - sysmon]
description = Detects a suspicious child process of Script Event Consumer (scrcons.exe).
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") ParentImage="*\\scrcons.exe" (Image="*\\svchost.exe" OR Image="*\\dllhost.exe" OR Image="*\\powershell.exe" OR Image="*\\pwsh.exe" OR Image="*\\wscript.exe" OR Image="*\\cscript.exe" OR Image="*\\schtasks.exe" OR Image="*\\regsvr32.exe" OR Image="*\\mshta.exe" OR Image="*\\rundll32.exe" OR Image="*\\msiexec.exe" OR Image="*\\msbuild.exe"))) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.execution attack.t1047" | eval sigma_title="Script Event Consumer Spawning Process" | eval sigma_description="Detects a suspicious child process of Script Event Consumer (scrcons.exe)."
dispatch.earliest_time = -24h@h
alert.track = 0

[Possible Shim Database Persistence via sdbinst.exe - winevent]
description = Detects installation of a new shim using sdbinst.exe. A shim can be used to load malicious DLLs into applications.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\sdbinst.exe" Process_Command_Line="*.sdb*")) NOT ((Process_Command_Line="*iisexpressshim.sdb*")))) | eval sigma_attack_tags="attack.persistence attack.privilege_escalation attack.t1546.011" | eval sigma_title="Possible Shim Database Persistence via sdbinst.exe" | eval sigma_description="Detects installation of a new shim using sdbinst.exe. A shim can be used to load malicious DLLs into applications."
dispatch.earliest_time = -24h@h
alert.track = 0

[Possible Shim Database Persistence via sdbinst.exe - sysmon]
description = Detects installation of a new shim using sdbinst.exe. A shim can be used to load malicious DLLs into applications.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\sdbinst.exe" CommandLine="*.sdb*")) NOT ((CommandLine="*iisexpressshim.sdb*")))) | eval sigma_attack_tags="attack.persistence attack.privilege_escalation attack.t1546.011" | eval sigma_title="Possible Shim Database Persistence via sdbinst.exe" | eval sigma_description="Detects installation of a new shim using sdbinst.exe. A shim can be used to load malicious DLLs into applications."
dispatch.earliest_time = -24h@h
alert.track = 0

[Sdclt Child Processes - winevent]
description = A General detection for sdclt spawning new processes. This could be an indicator of sdclt being used for bypass UAC techniques.
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Creator_Process_Name="*\\sdclt.exe")) | eval sigma_attack_tags="attack.privilege_escalation attack.t1548.002" | eval sigma_title="Sdclt Child Processes" | eval sigma_description="A General detection for sdclt spawning new processes. This could be an indicator of sdclt being used for bypass UAC techniques."
dispatch.earliest_time = -24h@h
alert.track = 0

[Sdclt Child Processes - sysmon]
description = A General detection for sdclt spawning new processes. This could be an indicator of sdclt being used for bypass UAC techniques.
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") ParentImage="*\\sdclt.exe")) | eval sigma_attack_tags="attack.privilege_escalation attack.t1548.002" | eval sigma_title="Sdclt Child Processes" | eval sigma_description="A General detection for sdclt spawning new processes. This could be an indicator of sdclt being used for bypass UAC techniques."
dispatch.earliest_time = -24h@h
alert.track = 0

[Sysinternals SDelete Delete File - winevent]
description = Detects the use of SDelete to erase a file not the free space
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) OriginalFileName="sdelete.exe" NOT (((Process_Command_Line="* -h*" OR Process_Command_Line="* -c*" OR Process_Command_Line="* -z*" OR Process_Command_Line="* /\?*"))))) | table ComputerName,Account_Name,Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.impact attack.t1485" | eval sigma_title="Sysinternals SDelete Delete File" | eval sigma_description="Detects the use of SDelete to erase a file not the free space"
dispatch.earliest_time = -24h@h
alert.track = 0

[Sysinternals SDelete Delete File - sysmon]
description = Detects the use of SDelete to erase a file not the free space
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) OriginalFileName="sdelete.exe" NOT (((CommandLine="* -h*" OR CommandLine="* -c*" OR CommandLine="* -z*" OR CommandLine="* /\?*"))))) | table ComputerName,User,CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.impact attack.t1485" | eval sigma_title="Sysinternals SDelete Delete File" | eval sigma_description="Detects the use of SDelete to erase a file not the free space"
dispatch.earliest_time = -24h@h
alert.track = 0

[Sdiagnhost Calling Suspicious Child Process - winevent]
description = Detects sdiagnhost.exe calling a suspicious child process (e.g. used in exploits for Follina / CVE-2022-30190)
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Creator_Process_Name="*\\sdiagnhost.exe" (New_Process_Name="*\\powershell.exe" OR New_Process_Name="*\\pwsh.exe" OR New_Process_Name="*\\cmd.exe" OR New_Process_Name="*\\mshta.exe" OR New_Process_Name="*\\cscript.exe" OR New_Process_Name="*\\wscript.exe" OR New_Process_Name="*\\taskkill.exe" OR New_Process_Name="*\\regsvr32.exe" OR New_Process_Name="*\\rundll32.exe" OR New_Process_Name="*\\calc.exe"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1036 attack.t1218" | eval sigma_title="Sdiagnhost Calling Suspicious Child Process" | eval sigma_description="Detects sdiagnhost.exe calling a suspicious child process (e.g. used in exploits for Follina / CVE-2022-30190)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Sdiagnhost Calling Suspicious Child Process - sysmon]
description = Detects sdiagnhost.exe calling a suspicious child process (e.g. used in exploits for Follina / CVE-2022-30190)
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") ParentImage="*\\sdiagnhost.exe" (Image="*\\powershell.exe" OR Image="*\\pwsh.exe" OR Image="*\\cmd.exe" OR Image="*\\mshta.exe" OR Image="*\\cscript.exe" OR Image="*\\wscript.exe" OR Image="*\\taskkill.exe" OR Image="*\\regsvr32.exe" OR Image="*\\rundll32.exe" OR Image="*\\calc.exe"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1036 attack.t1218" | eval sigma_title="Sdiagnhost Calling Suspicious Child Process" | eval sigma_description="Detects sdiagnhost.exe calling a suspicious child process (e.g. used in exploits for Follina / CVE-2022-30190)"
dispatch.earliest_time = -24h@h
alert.track = 0

[PPID Spoofing Tool Usage - winevent]
description = Detects the use of parent process ID spoofing tools like Didier Stevens tool SelectMyParent
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\SelectMyParent.exe" OR (Process_Command_Line="*PPID-spoof*" OR Process_Command_Line="*ppid_spoof*" OR Process_Command_Line="*spoof-ppid*" OR Process_Command_Line="*spoof_ppid*" OR Process_Command_Line="*ppidspoof*" OR Process_Command_Line="*spoofppid*" OR Process_Command_Line="*spoofedppid*" OR Process_Command_Line="* -spawnto *") OR (OriginalFileName="*PPID-spoof*" OR OriginalFileName="*ppid_spoof*" OR OriginalFileName="*spoof-ppid*" OR OriginalFileName="*spoof_ppid*" OR OriginalFileName="*ppidspoof*" OR OriginalFileName="*spoofppid*" OR OriginalFileName="*spoofedppid*") OR Description="SelectMyParent" OR (Imphash="04d974875bd225f00902b4cad9af3fbc" OR Imphash="a782af154c9e743ddf3f3eb2b8f3d16e" OR Imphash="89059503d7fbf470e68f7e63313da3ad" OR Imphash="ca28337632625c8281ab8a130b3d6bad") OR (Hashes="*IMPHASH=04D974875BD225F00902B4CAD9AF3FBC*" OR Hashes="*IMPHASH=A782AF154C9E743DDF3F3EB2B8F3D16E*" OR Hashes="*IMPHASH=89059503D7FBF470E68F7E63313DA3AD*" OR Hashes="*IMPHASH=CA28337632625C8281AB8A130B3D6BAD*")))) | eval sigma_attack_tags="attack.defense_evasion attack.t1134.004" | eval sigma_title="PPID Spoofing Tool Usage" | eval sigma_description="Detects the use of parent process ID spoofing tools like Didier Stevens tool SelectMyParent"
dispatch.earliest_time = -24h@h
alert.track = 0

[PPID Spoofing Tool Usage - sysmon]
description = Detects the use of parent process ID spoofing tools like Didier Stevens tool SelectMyParent
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\SelectMyParent.exe" OR (CommandLine="*PPID-spoof*" OR CommandLine="*ppid_spoof*" OR CommandLine="*spoof-ppid*" OR CommandLine="*spoof_ppid*" OR CommandLine="*ppidspoof*" OR CommandLine="*spoofppid*" OR CommandLine="*spoofedppid*" OR CommandLine="* -spawnto *") OR (OriginalFileName="*PPID-spoof*" OR OriginalFileName="*ppid_spoof*" OR OriginalFileName="*spoof-ppid*" OR OriginalFileName="*spoof_ppid*" OR OriginalFileName="*ppidspoof*" OR OriginalFileName="*spoofppid*" OR OriginalFileName="*spoofedppid*") OR Description="SelectMyParent" OR (Imphash="04d974875bd225f00902b4cad9af3fbc" OR Imphash="a782af154c9e743ddf3f3eb2b8f3d16e" OR Imphash="89059503d7fbf470e68f7e63313da3ad" OR Imphash="ca28337632625c8281ab8a130b3d6bad") OR (Hashes="*IMPHASH=04D974875BD225F00902B4CAD9AF3FBC*" OR Hashes="*IMPHASH=A782AF154C9E743DDF3F3EB2B8F3D16E*" OR Hashes="*IMPHASH=89059503D7FBF470E68F7E63313DA3AD*" OR Hashes="*IMPHASH=CA28337632625C8281AB8A130B3D6BAD*")))) | eval sigma_attack_tags="attack.defense_evasion attack.t1134.004" | eval sigma_title="PPID Spoofing Tool Usage" | eval sigma_description="Detects the use of parent process ID spoofing tools like Didier Stevens tool SelectMyParent"
dispatch.earliest_time = -24h@h
alert.track = 0

[Stop Windows Service - winevent]
description = Detects a windows service to be stopped
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((((((OriginalFileName="sc.exe" OR OriginalFileName="net.exe" OR OriginalFileName="net1.exe") OR (New_Process_Name="*\\sc.exe" OR New_Process_Name="*\\net.exe" OR New_Process_Name="*\\net1.exe")) Process_Command_Line="* stop *")) NOT (((Process_Command_Line="sc  stop KSCWebConsoleMessageQueue" OR Process_Command_Line="sc  stop LGHUBUpdaterService") (Account_Name="*AUTHORI*" OR Account_Name="*AUTORI*"))))) OR (((New_Process_Name="*\\powershell.exe" OR New_Process_Name="*\\pwsh.exe") Process_Command_Line="*Stop-Service *"))))) | table ComputerName,Account_Name,Process_Command_Line | eval sigma_attack_tags="attack.impact attack.t1489" | eval sigma_title="Stop Windows Service" | eval sigma_description="Detects a windows service to be stopped"
dispatch.earliest_time = -24h@h
alert.track = 0

[Stop Windows Service - sysmon]
description = Detects a windows service to be stopped
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((((((OriginalFileName="sc.exe" OR OriginalFileName="net.exe" OR OriginalFileName="net1.exe") OR (Image="*\\sc.exe" OR Image="*\\net.exe" OR Image="*\\net1.exe")) CommandLine="* stop *")) NOT (((CommandLine="sc  stop KSCWebConsoleMessageQueue" OR CommandLine="sc  stop LGHUBUpdaterService") (User="*AUTHORI*" OR User="*AUTORI*"))))) OR (((Image="*\\powershell.exe" OR Image="*\\pwsh.exe") CommandLine="*Stop-Service *"))))) | table ComputerName,User,CommandLine | eval sigma_attack_tags="attack.impact attack.t1489" | eval sigma_title="Stop Windows Service" | eval sigma_description="Detects a windows service to be stopped"
dispatch.earliest_time = -24h@h
alert.track = 0

[Change PowerShell Policies to an Insecure Level - winevent]
description = Detects use of executionpolicy option to set insecure policies
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((Process_Command_Line="* -executionpolicy *" OR Process_Command_Line="* -ep *" OR Process_Command_Line="* -exec *") (Process_Command_Line="*Unrestricted*" OR Process_Command_Line="*bypass*" OR Process_Command_Line="*RemoteSigned*"))) NOT (((Process_Command_Line="*C:\\Program Files*" OR Process_Command_Line="*C:\\ProgramData*" OR Process_Command_Line="*\\AppData\\Roaming\\Code\\*"))))) | eval sigma_attack_tags="attack.execution attack.t1059.001" | eval sigma_title="Change PowerShell Policies to an Insecure Level" | eval sigma_description="Detects use of executionpolicy option to set insecure policies"
dispatch.earliest_time = -24h@h
alert.track = 0

[Change PowerShell Policies to an Insecure Level - sysmon]
description = Detects use of executionpolicy option to set insecure policies
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((CommandLine="* -executionpolicy *" OR CommandLine="* -ep *" OR CommandLine="* -exec *") (CommandLine="*Unrestricted*" OR CommandLine="*bypass*" OR CommandLine="*RemoteSigned*"))) NOT (((CommandLine="*C:\\Program Files*" OR CommandLine="*C:\\ProgramData*" OR CommandLine="*\\AppData\\Roaming\\Code\\*"))))) | eval sigma_attack_tags="attack.execution attack.t1059.001" | eval sigma_title="Change PowerShell Policies to an Insecure Level" | eval sigma_description="Detects use of executionpolicy option to set insecure policies"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential PowerShell Execution Policy Tampering - ProcCreation - winevent]
description = Detects changes to the PowerShell execution policy registry key in order to bypass signing requirements for script execution from the CommandLine
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (Process_Command_Line="*\\ShellIds\\Microsoft.PowerShell\\ExecutionPolicy*" OR Process_Command_Line="*\\Policies\\Microsoft\\Windows\\PowerShell\\ExecutionPolicy*") (Process_Command_Line="*Bypass*" OR Process_Command_Line="*RemoteSigned*" OR Process_Command_Line="*Unrestricted*"))) | eval sigma_attack_tags="attack.defense_evasion" | eval sigma_title="Potential PowerShell Execution Policy Tampering - ProcCreation" | eval sigma_description="Detects changes to the PowerShell execution policy registry key in order to bypass signing requirements for script execution from the CommandLine"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential PowerShell Execution Policy Tampering - ProcCreation - sysmon]
description = Detects changes to the PowerShell execution policy registry key in order to bypass signing requirements for script execution from the CommandLine
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (CommandLine="*\\ShellIds\\Microsoft.PowerShell\\ExecutionPolicy*" OR CommandLine="*\\Policies\\Microsoft\\Windows\\PowerShell\\ExecutionPolicy*") (CommandLine="*Bypass*" OR CommandLine="*RemoteSigned*" OR CommandLine="*Unrestricted*"))) | eval sigma_attack_tags="attack.defense_evasion" | eval sigma_title="Potential PowerShell Execution Policy Tampering - ProcCreation" | eval sigma_description="Detects changes to the PowerShell execution policy registry key in order to bypass signing requirements for script execution from the CommandLine"
dispatch.earliest_time = -24h@h
alert.track = 0

[Shadow Copies Access via Symlink - winevent]
description = Shadow Copies storage symbolic link creation using operating systems utilities
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*mklink*" Process_Command_Line="*HarddiskVolumeShadowCopy*")) | eval sigma_attack_tags="attack.credential_access attack.t1003.002 attack.t1003.003" | eval sigma_title="Shadow Copies Access via Symlink" | eval sigma_description="Shadow Copies storage symbolic link creation using operating systems utilities"
dispatch.earliest_time = -24h@h
alert.track = 0

[Shadow Copies Access via Symlink - sysmon]
description = Shadow Copies storage symbolic link creation using operating systems utilities
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*mklink*" CommandLine="*HarddiskVolumeShadowCopy*")) | eval sigma_attack_tags="attack.credential_access attack.t1003.002 attack.t1003.003" | eval sigma_title="Shadow Copies Access via Symlink" | eval sigma_description="Shadow Copies storage symbolic link creation using operating systems utilities"
dispatch.earliest_time = -24h@h
alert.track = 0

[Shadow Copies Creation Using Operating Systems Utilities - winevent]
description = Shadow Copies creation using operating systems utilities, possible credential access
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\powershell.exe" OR New_Process_Name="*\\pwsh.exe" OR New_Process_Name="*\\wmic.exe" OR New_Process_Name="*\\vssadmin.exe") OR (OriginalFileName="PowerShell.EXE" OR OriginalFileName="pwsh.dll" OR OriginalFileName="wmic.exe" OR OriginalFileName="VSSADMIN.EXE")) ((Process_Command_Line="*shadow*" Process_Command_Line="*create*")))) | eval sigma_attack_tags="attack.credential_access attack.t1003 attack.t1003.002 attack.t1003.003" | eval sigma_title="Shadow Copies Creation Using Operating Systems Utilities" | eval sigma_description="Shadow Copies creation using operating systems utilities, possible credential access"
dispatch.earliest_time = -24h@h
alert.track = 0

[Shadow Copies Creation Using Operating Systems Utilities - sysmon]
description = Shadow Copies creation using operating systems utilities, possible credential access
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\powershell.exe" OR Image="*\\pwsh.exe" OR Image="*\\wmic.exe" OR Image="*\\vssadmin.exe") OR (OriginalFileName="PowerShell.EXE" OR OriginalFileName="pwsh.dll" OR OriginalFileName="wmic.exe" OR OriginalFileName="VSSADMIN.EXE")) ((CommandLine="*shadow*" CommandLine="*create*")))) | eval sigma_attack_tags="attack.credential_access attack.t1003 attack.t1003.002 attack.t1003.003" | eval sigma_title="Shadow Copies Creation Using Operating Systems Utilities" | eval sigma_description="Shadow Copies creation using operating systems utilities, possible credential access"
dispatch.earliest_time = -24h@h
alert.track = 0

[Shadow Copies Deletion Using Operating Systems Utilities - winevent]
description = Shadow Copies deletion using operating systems utilities
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((((((New_Process_Name="*\\powershell.exe" OR New_Process_Name="*\\pwsh.exe" OR New_Process_Name="*\\wmic.exe" OR New_Process_Name="*\\vssadmin.exe" OR New_Process_Name="*\\diskshadow.exe") OR (OriginalFileName="PowerShell.EXE" OR OriginalFileName="pwsh.dll" OR OriginalFileName="wmic.exe" OR OriginalFileName="VSSADMIN.EXE" OR OriginalFileName="diskshadow.exe")) ((Process_Command_Line="*shadow*" Process_Command_Line="*delete*")))) OR (((New_Process_Name="*\\wbadmin.exe" OR OriginalFileName="WBADMIN.EXE") ((Process_Command_Line="*delete*" Process_Command_Line="*catalog*" Process_Command_Line="*quiet*"))))) OR (((New_Process_Name="*\\vssadmin.exe" OR OriginalFileName="VSSADMIN.EXE") ((Process_Command_Line="*resize*" Process_Command_Line="*shadowstorage*" (Process_Command_Line="*unbounded*" OR Process_Command_Line="*/MaxSize=*")))))))) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.impact attack.t1070 attack.t1490" | eval sigma_title="Shadow Copies Deletion Using Operating Systems Utilities" | eval sigma_description="Shadow Copies deletion using operating systems utilities"
dispatch.earliest_time = -24h@h
alert.track = 0

[Shadow Copies Deletion Using Operating Systems Utilities - sysmon]
description = Shadow Copies deletion using operating systems utilities
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((((((Image="*\\powershell.exe" OR Image="*\\pwsh.exe" OR Image="*\\wmic.exe" OR Image="*\\vssadmin.exe" OR Image="*\\diskshadow.exe") OR (OriginalFileName="PowerShell.EXE" OR OriginalFileName="pwsh.dll" OR OriginalFileName="wmic.exe" OR OriginalFileName="VSSADMIN.EXE" OR OriginalFileName="diskshadow.exe")) ((CommandLine="*shadow*" CommandLine="*delete*")))) OR (((Image="*\\wbadmin.exe" OR OriginalFileName="WBADMIN.EXE") ((CommandLine="*delete*" CommandLine="*catalog*" CommandLine="*quiet*"))))) OR (((Image="*\\vssadmin.exe" OR OriginalFileName="VSSADMIN.EXE") ((CommandLine="*resize*" CommandLine="*shadowstorage*" (CommandLine="*unbounded*" OR CommandLine="*/MaxSize=*")))))))) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.impact attack.t1070 attack.t1490" | eval sigma_title="Shadow Copies Deletion Using Operating Systems Utilities" | eval sigma_description="Shadow Copies deletion using operating systems utilities"
dispatch.earliest_time = -24h@h
alert.track = 0

[Deletion of Volume Shadow Copies via WMI with PowerShell - winevent]
description = Detects deletion of Windows Volume Shadow Copies with PowerShell code and Get-WMIObject. This technique is used by numerous ransomware families such as Sodinokibi/REvil
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (Process_Command_Line="*Get-WmiObject*" OR Process_Command_Line="*gwmi*" OR Process_Command_Line="*Get-CimInstance*" OR Process_Command_Line="*gcim*") Process_Command_Line="*Win32_Shadowcopy*" (Process_Command_Line="*.Delete()*" OR Process_Command_Line="*Remove-WmiObject*" OR Process_Command_Line="*rwmi*" OR Process_Command_Line="*Remove-CimInstance*" OR Process_Command_Line="*rcim*"))) | eval sigma_attack_tags="attack.impact attack.t1490" | eval sigma_title="Deletion of Volume Shadow Copies via WMI with PowerShell" | eval sigma_description="Detects deletion of Windows Volume Shadow Copies with PowerShell code and Get-WMIObject. This technique is used by numerous ransomware families such as Sodinokibi/REvil"
dispatch.earliest_time = -24h@h
alert.track = 0

[Deletion of Volume Shadow Copies via WMI with PowerShell - sysmon]
description = Detects deletion of Windows Volume Shadow Copies with PowerShell code and Get-WMIObject. This technique is used by numerous ransomware families such as Sodinokibi/REvil
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (CommandLine="*Get-WmiObject*" OR CommandLine="*gwmi*" OR CommandLine="*Get-CimInstance*" OR CommandLine="*gcim*") CommandLine="*Win32_Shadowcopy*" (CommandLine="*.Delete()*" OR CommandLine="*Remove-WmiObject*" OR CommandLine="*rwmi*" OR CommandLine="*Remove-CimInstance*" OR CommandLine="*rcim*"))) | eval sigma_attack_tags="attack.impact attack.t1490" | eval sigma_title="Deletion of Volume Shadow Copies via WMI with PowerShell" | eval sigma_description="Detects deletion of Windows Volume Shadow Copies with PowerShell code and Get-WMIObject. This technique is used by numerous ransomware families such as Sodinokibi/REvil"
dispatch.earliest_time = -24h@h
alert.track = 0

[SharpChisel Usage - winevent]
description = Detects usage of the Sharp Chisel via the commandline arguments
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\SharpChisel.exe" OR Product="SharpChisel"))) | eval sigma_attack_tags="attack.command_and_control attack.t1090.001" | eval sigma_title="SharpChisel Usage" | eval sigma_description="Detects usage of the Sharp Chisel via the commandline arguments"
dispatch.earliest_time = -24h@h
alert.track = 0

[SharpChisel Usage - sysmon]
description = Detects usage of the Sharp Chisel via the commandline arguments
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\SharpChisel.exe" OR Product="SharpChisel"))) | eval sigma_attack_tags="attack.command_and_control attack.t1090.001" | eval sigma_title="SharpChisel Usage" | eval sigma_description="Detects usage of the Sharp Chisel via the commandline arguments"
dispatch.earliest_time = -24h@h
alert.track = 0

[SharpImpersonation Execution - winevent]
description = Detects execution of the SharpImpersonation tool. Which can be used to manipulate tokens on a Windows computers remotely (PsExec/WmiExec) or interactively
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\SharpImpersonation.exe" OR OriginalFileName="SharpImpersonation.exe" OR ((Process_Command_Line="* user:*" Process_Command_Line="* binary:*")) OR ((Process_Command_Line="* user:*" Process_Command_Line="* shellcode:*")) OR (Process_Command_Line="* technique:CreateProcessAsUserW*" OR Process_Command_Line="* technique:ImpersonateLoggedOnuser*")))) | eval sigma_attack_tags="attack.privilege_escalation attack.defense_evasion attack.t1134.001 attack.t1134.003" | eval sigma_title="SharpImpersonation Execution" | eval sigma_description="Detects execution of the SharpImpersonation tool. Which can be used to manipulate tokens on a Windows computers remotely (PsExec/WmiExec) or interactively"
dispatch.earliest_time = -24h@h
alert.track = 0

[SharpImpersonation Execution - sysmon]
description = Detects execution of the SharpImpersonation tool. Which can be used to manipulate tokens on a Windows computers remotely (PsExec/WmiExec) or interactively
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\SharpImpersonation.exe" OR OriginalFileName="SharpImpersonation.exe" OR ((CommandLine="* user:*" CommandLine="* binary:*")) OR ((CommandLine="* user:*" CommandLine="* shellcode:*")) OR (CommandLine="* technique:CreateProcessAsUserW*" OR CommandLine="* technique:ImpersonateLoggedOnuser*")))) | eval sigma_attack_tags="attack.privilege_escalation attack.defense_evasion attack.t1134.001 attack.t1134.003" | eval sigma_title="SharpImpersonation Execution" | eval sigma_description="Detects execution of the SharpImpersonation tool. Which can be used to manipulate tokens on a Windows computers remotely (PsExec/WmiExec) or interactively"
dispatch.earliest_time = -24h@h
alert.track = 0

[SharpLDAPmonitor Execution - winevent]
description = Detects execution of the SharpLDAPmonitor. Which can monitor the creation, deletion and changes to LDAP objects.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\SharpLDAPmonitor.exe" OR OriginalFileName="SharpLDAPmonitor.exe") OR ((Process_Command_Line="*/user:*" Process_Command_Line="*/pass:*" Process_Command_Line="*/dcip:*"))))) | eval sigma_attack_tags="attack.discovery" | eval sigma_title="SharpLDAPmonitor Execution" | eval sigma_description="Detects execution of the SharpLDAPmonitor. Which can monitor the creation, deletion and changes to LDAP objects."
dispatch.earliest_time = -24h@h
alert.track = 0

[SharpLDAPmonitor Execution - sysmon]
description = Detects execution of the SharpLDAPmonitor. Which can monitor the creation, deletion and changes to LDAP objects.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\SharpLDAPmonitor.exe" OR OriginalFileName="SharpLDAPmonitor.exe") OR ((CommandLine="*/user:*" CommandLine="*/pass:*" CommandLine="*/dcip:*"))))) | eval sigma_attack_tags="attack.discovery" | eval sigma_title="SharpLDAPmonitor Execution" | eval sigma_description="Detects execution of the SharpLDAPmonitor. Which can monitor the creation, deletion and changes to LDAP objects."
dispatch.earliest_time = -24h@h
alert.track = 0

[SharpUp PrivEsc Tool - winevent]
description = Detects the use of SharpUp, a tool for local privilege escalation
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\SharpUp.exe" OR Description="SharpUp" OR (Process_Command_Line="*HijackablePaths*" OR Process_Command_Line="*UnquotedServicePath*" OR Process_Command_Line="*ProcessDLLHijack*" OR Process_Command_Line="*ModifiableServiceBinaries*" OR Process_Command_Line="*ModifiableScheduledTask*" OR Process_Command_Line="*DomainGPPPassword*" OR Process_Command_Line="*CachedGPPPassword*")))) | eval sigma_attack_tags="attack.privilege_escalation attack.t1615 attack.t1569.002 attack.t1574.005" | eval sigma_title="SharpUp PrivEsc Tool" | eval sigma_description="Detects the use of SharpUp, a tool for local privilege escalation"
dispatch.earliest_time = -24h@h
alert.track = 0

[SharpUp PrivEsc Tool - sysmon]
description = Detects the use of SharpUp, a tool for local privilege escalation
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\SharpUp.exe" OR Description="SharpUp" OR (CommandLine="*HijackablePaths*" OR CommandLine="*UnquotedServicePath*" OR CommandLine="*ProcessDLLHijack*" OR CommandLine="*ModifiableServiceBinaries*" OR CommandLine="*ModifiableScheduledTask*" OR CommandLine="*DomainGPPPassword*" OR CommandLine="*CachedGPPPassword*")))) | eval sigma_attack_tags="attack.privilege_escalation attack.t1615 attack.t1569.002 attack.t1574.005" | eval sigma_title="SharpUp PrivEsc Tool" | eval sigma_description="Detects the use of SharpUp, a tool for local privilege escalation"
dispatch.earliest_time = -24h@h
alert.track = 0

[Shells Spawned by Java - winevent]
description = Detects shell spawned from Java host process, which could be a sign of exploitation (e.g. log4j exploitation)
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((Creator_Process_Name="*\\java.exe" (New_Process_Name="*\\cmd.exe" OR New_Process_Name="*\\powershell.exe" OR New_Process_Name="*\\pwsh.exe"))) NOT ((Creator_Process_Name="*build*" Process_Command_Line="*build*")))) | eval sigma_attack_tags="attack.initial_access attack.persistence attack.privilege_escalation" | eval sigma_title="Shells Spawned by Java" | eval sigma_description="Detects shell spawned from Java host process, which could be a sign of exploitation (e.g. log4j exploitation)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Shells Spawned by Java - sysmon]
description = Detects shell spawned from Java host process, which could be a sign of exploitation (e.g. log4j exploitation)
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((ParentImage="*\\java.exe" (Image="*\\cmd.exe" OR Image="*\\powershell.exe" OR Image="*\\pwsh.exe"))) NOT ((ParentImage="*build*" CommandLine="*build*")))) | eval sigma_attack_tags="attack.initial_access attack.persistence attack.privilege_escalation" | eval sigma_title="Shells Spawned by Java" | eval sigma_description="Detects shell spawned from Java host process, which could be a sign of exploitation (e.g. log4j exploitation)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Windows Shell/Scripting Processes Spawning Suspicious Programs - winevent]
description = Detects suspicious child processes of a Windows shell and scripting processes such as wscript, rundll32, powershell, mshta...etc.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((Creator_Process_Name="*\\mshta.exe" OR Creator_Process_Name="*\\powershell.exe" OR Creator_Process_Name="*\\pwsh.exe" OR Creator_Process_Name="*\\rundll32.exe" OR Creator_Process_Name="*\\cscript.exe" OR Creator_Process_Name="*\\wscript.exe" OR Creator_Process_Name="*\\wmiprvse.exe" OR Creator_Process_Name="*\\regsvr32.exe") (New_Process_Name="*\\schtasks.exe" OR New_Process_Name="*\\nslookup.exe" OR New_Process_Name="*\\certutil.exe" OR New_Process_Name="*\\bitsadmin.exe" OR New_Process_Name="*\\mshta.exe"))) NOT (((CurrentDirectory="*\\ccmcache\\*")) OR (((ParentCommandLine="*\\Program Files\\Amazon\\WorkSpacesConfig\\Scripts\\setup-scheduledtask.ps1*" OR ParentCommandLine="*\\Program Files\\Amazon\\WorkSpacesConfig\\Scripts\\set-selfhealing.ps1*" OR ParentCommandLine="*\\Program Files\\Amazon\\WorkSpacesConfig\\Scripts\\check-workspacehealth.ps1*" OR ParentCommandLine="*\\nessus_*"))) OR ((Process_Command_Line="*\\nessus_*"))))) | table Process_Command_Line,ParentCommandLine,CurrentDirectory,New_Process_Name,Creator_Process_Name | eval sigma_attack_tags="attack.execution attack.defense_evasion attack.t1059.005 attack.t1059.001 attack.t1218" | eval sigma_title="Windows Shell/Scripting Processes Spawning Suspicious Programs" | eval sigma_description="Detects suspicious child processes of a Windows shell and scripting processes such as wscript, rundll32, powershell, mshta...etc."
dispatch.earliest_time = -24h@h
alert.track = 0

[Windows Shell/Scripting Processes Spawning Suspicious Programs - sysmon]
description = Detects suspicious child processes of a Windows shell and scripting processes such as wscript, rundll32, powershell, mshta...etc.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((ParentImage="*\\mshta.exe" OR ParentImage="*\\powershell.exe" OR ParentImage="*\\pwsh.exe" OR ParentImage="*\\rundll32.exe" OR ParentImage="*\\cscript.exe" OR ParentImage="*\\wscript.exe" OR ParentImage="*\\wmiprvse.exe" OR ParentImage="*\\regsvr32.exe") (Image="*\\schtasks.exe" OR Image="*\\nslookup.exe" OR Image="*\\certutil.exe" OR Image="*\\bitsadmin.exe" OR Image="*\\mshta.exe"))) NOT (((CurrentDirectory="*\\ccmcache\\*")) OR (((ParentCommandLine="*\\Program Files\\Amazon\\WorkSpacesConfig\\Scripts\\setup-scheduledtask.ps1*" OR ParentCommandLine="*\\Program Files\\Amazon\\WorkSpacesConfig\\Scripts\\set-selfhealing.ps1*" OR ParentCommandLine="*\\Program Files\\Amazon\\WorkSpacesConfig\\Scripts\\check-workspacehealth.ps1*" OR ParentCommandLine="*\\nessus_*"))) OR ((CommandLine="*\\nessus_*"))))) | table CommandLine,ParentCommandLine,CurrentDirectory,Image,ParentImage | eval sigma_attack_tags="attack.execution attack.defense_evasion attack.t1059.005 attack.t1059.001 attack.t1218" | eval sigma_title="Windows Shell/Scripting Processes Spawning Suspicious Programs" | eval sigma_description="Detects suspicious child processes of a Windows shell and scripting processes such as wscript, rundll32, powershell, mshta...etc."
dispatch.earliest_time = -24h@h
alert.track = 0

[SILENTTRINITY Stager Execution - winevent]
description = Detects SILENTTRINITY stager use
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Description="*st2stager*")) | eval sigma_attack_tags="attack.command_and_control attack.t1071" | eval sigma_title="SILENTTRINITY Stager Execution" | eval sigma_description="Detects SILENTTRINITY stager use"
dispatch.earliest_time = -24h@h
alert.track = 0

[SILENTTRINITY Stager Execution - sysmon]
description = Detects SILENTTRINITY stager use
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Description="*st2stager*")) | eval sigma_attack_tags="attack.command_and_control attack.t1071" | eval sigma_title="SILENTTRINITY Stager Execution" | eval sigma_description="Detects SILENTTRINITY stager use"
dispatch.earliest_time = -24h@h
alert.track = 0

[Detected Windows Software Discovery - winevent]
description = Adversaries may attempt to enumerate software for a variety of reasons, such as figuring out what security measures are present or if the compromised system has a version of software that is vulnerable.
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\reg.exe" Process_Command_Line="*query*" Process_Command_Line="*\\software\\*" Process_Command_Line="*/v*" Process_Command_Line="*svcversion*")) | eval sigma_attack_tags="attack.discovery attack.t1518" | eval sigma_title="Detected Windows Software Discovery" | eval sigma_description="Adversaries may attempt to enumerate software for a variety of reasons, such as figuring out what security measures are present or if the compromised system has a version of software that is vulnerable."
dispatch.earliest_time = -24h@h
alert.track = 0

[Detected Windows Software Discovery - sysmon]
description = Adversaries may attempt to enumerate software for a variety of reasons, such as figuring out what security measures are present or if the compromised system has a version of software that is vulnerable.
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\reg.exe" CommandLine="*query*" CommandLine="*\\software\\*" CommandLine="*/v*" CommandLine="*svcversion*")) | eval sigma_attack_tags="attack.discovery attack.t1518" | eval sigma_title="Detected Windows Software Discovery" | eval sigma_description="Adversaries may attempt to enumerate software for a variety of reasons, such as figuring out what security measures are present or if the compromised system has a version of software that is vulnerable."
dispatch.earliest_time = -24h@h
alert.track = 0

[Audio Capture via SoundRecorder - winevent]
description = Detect attacker collecting audio via SoundRecorder application.
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\SoundRecorder.exe" Process_Command_Line="*/FILE*")) | eval sigma_attack_tags="attack.collection attack.t1123" | eval sigma_title="Audio Capture via SoundRecorder" | eval sigma_description="Detect attacker collecting audio via SoundRecorder application."
dispatch.earliest_time = -24h@h
alert.track = 0

[Audio Capture via SoundRecorder - sysmon]
description = Detect attacker collecting audio via SoundRecorder application.
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\SoundRecorder.exe" CommandLine="*/FILE*")) | eval sigma_attack_tags="attack.collection attack.t1123" | eval sigma_title="Audio Capture via SoundRecorder" | eval sigma_description="Detect attacker collecting audio via SoundRecorder application."
dispatch.earliest_time = -24h@h
alert.track = 0

[Possible SPN Enumeration - winevent]
description = Detects Service Principal Name Enumeration used for Kerberoasting
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\setspn.exe" OR ((Description="*Query or reset the computer*" Description="*SPN attribute*"))) Process_Command_Line="*-q*")) | eval sigma_attack_tags="attack.credential_access attack.t1558.003" | eval sigma_title="Possible SPN Enumeration" | eval sigma_description="Detects Service Principal Name Enumeration used for Kerberoasting"
dispatch.earliest_time = -24h@h
alert.track = 0

[Possible SPN Enumeration - sysmon]
description = Detects Service Principal Name Enumeration used for Kerberoasting
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\setspn.exe" OR ((Description="*Query or reset the computer*" Description="*SPN attribute*"))) CommandLine="*-q*")) | eval sigma_attack_tags="attack.credential_access attack.t1558.003" | eval sigma_title="Possible SPN Enumeration" | eval sigma_description="Detects Service Principal Name Enumeration used for Kerberoasting"
dispatch.earliest_time = -24h@h
alert.track = 0

[VeeamBackup Database Credentials Dump - winevent]
description = Detects dump of credentials in VeeamBackup dbo
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\sqlcmd.exe" Process_Command_Line="*SELECT*" Process_Command_Line="*TOP*" Process_Command_Line="*[VeeamBackup].[dbo].[Credentials]*")) | eval sigma_attack_tags="attack.collection attack.t1005" | eval sigma_title="VeeamBackup Database Credentials Dump" | eval sigma_description="Detects dump of credentials in VeeamBackup dbo"
dispatch.earliest_time = -24h@h
alert.track = 0

[VeeamBackup Database Credentials Dump - sysmon]
description = Detects dump of credentials in VeeamBackup dbo
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\sqlcmd.exe" CommandLine="*SELECT*" CommandLine="*TOP*" CommandLine="*[VeeamBackup].[dbo].[Credentials]*")) | eval sigma_attack_tags="attack.collection attack.t1005" | eval sigma_title="VeeamBackup Database Credentials Dump" | eval sigma_description="Detects dump of credentials in VeeamBackup dbo"
dispatch.earliest_time = -24h@h
alert.track = 0

[SQLite Chromium Profile Data DB Access - winevent]
description = Detect usage of the 'sqlite' binary to query databases in Chromium-based browsers for potential data stealing.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (Product="SQLite" OR (New_Process_Name="*\\sqlite.exe" OR New_Process_Name="*\\sqlite3.exe")) (Process_Command_Line="*\\User Data\\*" OR Process_Command_Line="*\\Opera Software\\*" OR Process_Command_Line="*\\ChromiumViewer\\*") (Process_Command_Line="*Login Data*" OR Process_Command_Line="*Cookies*" OR Process_Command_Line="*Web Data*" OR Process_Command_Line="*History*" OR Process_Command_Line="*Bookmarks*"))) | eval sigma_attack_tags="attack.credential_access attack.t1539 attack.t1555.003 attack.collection attack.t1005" | eval sigma_title="SQLite Chromium Profile Data DB Access" | eval sigma_description="Detect usage of the 'sqlite' binary to query databases in Chromium-based browsers for potential data stealing."
dispatch.earliest_time = -24h@h
alert.track = 0

[SQLite Chromium Profile Data DB Access - sysmon]
description = Detect usage of the 'sqlite' binary to query databases in Chromium-based browsers for potential data stealing.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Product="SQLite" OR (Image="*\\sqlite.exe" OR Image="*\\sqlite3.exe")) (CommandLine="*\\User Data\\*" OR CommandLine="*\\Opera Software\\*" OR CommandLine="*\\ChromiumViewer\\*") (CommandLine="*Login Data*" OR CommandLine="*Cookies*" OR CommandLine="*Web Data*" OR CommandLine="*History*" OR CommandLine="*Bookmarks*"))) | eval sigma_attack_tags="attack.credential_access attack.t1539 attack.t1555.003 attack.collection attack.t1005" | eval sigma_title="SQLite Chromium Profile Data DB Access" | eval sigma_description="Detect usage of the 'sqlite' binary to query databases in Chromium-based browsers for potential data stealing."
dispatch.earliest_time = -24h@h
alert.track = 0

[SQLite Firefox Profile Data DB Access - winevent]
description = Detect usage of the 'sqlite' binary to query databases in Firefox and other Gecko-based browsers for potential data stealing.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (Product="SQLite" OR (New_Process_Name="*\\sqlite.exe" OR New_Process_Name="*\\sqlite3.exe")) (Process_Command_Line="*cookies.sqlite*" OR Process_Command_Line="*places.sqlite*"))) | eval sigma_attack_tags="attack.credential_access attack.t1539 attack.collection attack.t1005" | eval sigma_title="SQLite Firefox Profile Data DB Access" | eval sigma_description="Detect usage of the 'sqlite' binary to query databases in Firefox and other Gecko-based browsers for potential data stealing."
dispatch.earliest_time = -24h@h
alert.track = 0

[SQLite Firefox Profile Data DB Access - sysmon]
description = Detect usage of the 'sqlite' binary to query databases in Firefox and other Gecko-based browsers for potential data stealing.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Product="SQLite" OR (Image="*\\sqlite.exe" OR Image="*\\sqlite3.exe")) (CommandLine="*cookies.sqlite*" OR CommandLine="*places.sqlite*"))) | eval sigma_attack_tags="attack.credential_access attack.t1539 attack.collection attack.t1005" | eval sigma_title="SQLite Firefox Profile Data DB Access" | eval sigma_description="Detect usage of the 'sqlite' binary to query databases in Firefox and other Gecko-based browsers for potential data stealing."
dispatch.earliest_time = -24h@h
alert.track = 0

[Port Forwarding Attempt Via SSH - winevent]
description = Detects suspicious SSH tunnel port forwarding to a local port
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\ssh.exe" Process_Command_Line="* -R *")) | eval sigma_attack_tags="attack.command_and_control attack.t1572 attack.lateral_movement attack.t1021.001" | eval sigma_title="Port Forwarding Attempt Via SSH" | eval sigma_description="Detects suspicious SSH tunnel port forwarding to a local port"
dispatch.earliest_time = -24h@h
alert.track = 0

[Port Forwarding Attempt Via SSH - sysmon]
description = Detects suspicious SSH tunnel port forwarding to a local port
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\ssh.exe" CommandLine="* -R *")) | eval sigma_attack_tags="attack.command_and_control attack.t1572 attack.lateral_movement attack.t1021.001" | eval sigma_title="Port Forwarding Attempt Via SSH" | eval sigma_description="Detects suspicious SSH tunnel port forwarding to a local port"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential RDP Tunneling Via SSH - winevent]
description = Execution of ssh.exe to perform data exfiltration and tunneling through RDP
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\ssh.exe" Process_Command_Line="*:3389*")) | eval sigma_attack_tags="attack.command_and_control attack.t1572" | eval sigma_title="Potential RDP Tunneling Via SSH" | eval sigma_description="Execution of ssh.exe to perform data exfiltration and tunneling through RDP"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential RDP Tunneling Via SSH - sysmon]
description = Execution of ssh.exe to perform data exfiltration and tunneling through RDP
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\ssh.exe" CommandLine="*:3389*")) | eval sigma_attack_tags="attack.command_and_control attack.t1572" | eval sigma_title="Potential RDP Tunneling Via SSH" | eval sigma_description="Execution of ssh.exe to perform data exfiltration and tunneling through RDP"
dispatch.earliest_time = -24h@h
alert.track = 0

[Sticky-Key Backdoor Copy Cmd.exe - winevent]
description = By replacing the sticky keys executable with the local admins CMD executable, an attacker is able to access a privileged windows console session without authenticating to the system.
When the sticky keys are 'activated' the privilleged shell is launched.

search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="copy /y C:\\windows\\system32\\cmd.exe C:\\windows\\system32\\sethc.exe")) | table Process_Command_Line,ParentProcess | eval sigma_attack_tags="attack.t1546.008 attack.privilege_escalation" | eval sigma_title="Sticky-Key Backdoor Copy Cmd.exe" | eval sigma_description="By replacing the sticky keys executable with the local admins CMD executable, an attacker is able to access a privileged windows console session without authenticating to the system.
When the sticky keys are 'activated' the privilleged shell is launched.
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Sticky-Key Backdoor Copy Cmd.exe - sysmon]
description = By replacing the sticky keys executable with the local admins CMD executable, an attacker is able to access a privileged windows console session without authenticating to the system.
When the sticky keys are 'activated' the privilleged shell is launched.

search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="copy /y C:\\windows\\system32\\cmd.exe C:\\windows\\system32\\sethc.exe")) | table CommandLine,ParentProcess | eval sigma_attack_tags="attack.t1546.008 attack.privilege_escalation" | eval sigma_title="Sticky-Key Backdoor Copy Cmd.exe" | eval sigma_description="By replacing the sticky keys executable with the local admins CMD executable, an attacker is able to access a privileged windows console session without authenticating to the system.
When the sticky keys are 'activated' the privilleged shell is launched.
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Sticky Key Like Backdoor Usage - winevent]
description = Detects the usage and installation of a backdoor that uses an option to register a malicious debugger for built-in tools that are accessible in the login screen
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Creator_Process_Name="*\\winlogon.exe" New_Process_Name="*\\cmd.exe" (Process_Command_Line="*sethc.exe*" OR Process_Command_Line="*utilman.exe*" OR Process_Command_Line="*osk.exe*" OR Process_Command_Line="*Magnify.exe*" OR Process_Command_Line="*Narrator.exe*" OR Process_Command_Line="*DisplaySwitch.exe*"))) | eval sigma_attack_tags="attack.privilege_escalation attack.persistence attack.t1546.008 car.2014-11-003 car.2014-11-008" | eval sigma_title="Sticky Key Like Backdoor Usage" | eval sigma_description="Detects the usage and installation of a backdoor that uses an option to register a malicious debugger for built-in tools that are accessible in the login screen"
dispatch.earliest_time = -24h@h
alert.track = 0

[Sticky Key Like Backdoor Usage - sysmon]
description = Detects the usage and installation of a backdoor that uses an option to register a malicious debugger for built-in tools that are accessible in the login screen
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") ParentImage="*\\winlogon.exe" Image="*\\cmd.exe" (CommandLine="*sethc.exe*" OR CommandLine="*utilman.exe*" OR CommandLine="*osk.exe*" OR CommandLine="*Magnify.exe*" OR CommandLine="*Narrator.exe*" OR CommandLine="*DisplaySwitch.exe*"))) | eval sigma_attack_tags="attack.privilege_escalation attack.persistence attack.t1546.008 car.2014-11-003 car.2014-11-008" | eval sigma_title="Sticky Key Like Backdoor Usage" | eval sigma_description="Detects the usage and installation of a backdoor that uses an option to register a malicious debugger for built-in tools that are accessible in the login screen"
dispatch.earliest_time = -24h@h
alert.track = 0

[Execution via stordiag.exe - winevent]
description = Detects the use of stordiag.exe to execute schtasks.exe systeminfo.exe and fltmc.exe
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((Creator_Process_Name="*\\stordiag.exe" (New_Process_Name="*\\schtasks.exe" OR New_Process_Name="*\\systeminfo.exe" OR New_Process_Name="*\\fltmc.exe"))) NOT (((Creator_Process_Name="c:\\windows\\system32\\*" OR Creator_Process_Name="c:\\windows\\syswow64\\*"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218" | eval sigma_title="Execution via stordiag.exe" | eval sigma_description="Detects the use of stordiag.exe to execute schtasks.exe systeminfo.exe and fltmc.exe"
dispatch.earliest_time = -24h@h
alert.track = 0

[Execution via stordiag.exe - sysmon]
description = Detects the use of stordiag.exe to execute schtasks.exe systeminfo.exe and fltmc.exe
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((ParentImage="*\\stordiag.exe" (Image="*\\schtasks.exe" OR Image="*\\systeminfo.exe" OR Image="*\\fltmc.exe"))) NOT (((ParentImage="c:\\windows\\system32\\*" OR ParentImage="c:\\windows\\syswow64\\*"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218" | eval sigma_title="Execution via stordiag.exe" | eval sigma_description="Detects the use of stordiag.exe to execute schtasks.exe systeminfo.exe and fltmc.exe"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Auditpol Usage - winevent]
description = Threat actors can use auditpol binary to change audit policy configuration to impair detection capability.
This can be carried out by selectively disabling/removing certain audit policies as well as restoring a custom policy owned by the threat actor.

search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\auditpol.exe" (Process_Command_Line="*disable*" OR Process_Command_Line="*clear*" OR Process_Command_Line="*remove*" OR Process_Command_Line="*restore*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.002" | eval sigma_title="Suspicious Auditpol Usage" | eval sigma_description="Threat actors can use auditpol binary to change audit policy configuration to impair detection capability.
This can be carried out by selectively disabling/removing certain audit policies as well as restoring a custom policy owned by the threat actor.
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Auditpol Usage - sysmon]
description = Threat actors can use auditpol binary to change audit policy configuration to impair detection capability.
This can be carried out by selectively disabling/removing certain audit policies as well as restoring a custom policy owned by the threat actor.

search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\auditpol.exe" (CommandLine="*disable*" OR CommandLine="*clear*" OR CommandLine="*remove*" OR CommandLine="*restore*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.002" | eval sigma_title="Suspicious Auditpol Usage" | eval sigma_description="Threat actors can use auditpol binary to change audit policy configuration to impair detection capability.
This can be carried out by selectively disabling/removing certain audit policies as well as restoring a custom policy owned by the threat actor.
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Start of NT Virtual DOS Machine - winevent]
description = Ntvdm.exe allows the execution of 16-bit Windows applications on 32-bit Windows operating systems, as well as the execution of both 16-bit and 32-bit DOS applications
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (New_Process_Name="*\\ntvdm.exe" OR New_Process_Name="*\\csrstub.exe"))) | eval sigma_attack_tags="attack.defense_evasion" | eval sigma_title="Start of NT Virtual DOS Machine" | eval sigma_description="Ntvdm.exe allows the execution of 16-bit Windows applications on 32-bit Windows operating systems, as well as the execution of both 16-bit and 32-bit DOS applications"
dispatch.earliest_time = -24h@h
alert.track = 0

[Start of NT Virtual DOS Machine - sysmon]
description = Ntvdm.exe allows the execution of 16-bit Windows applications on 32-bit Windows operating systems, as well as the execution of both 16-bit and 32-bit DOS applications
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (Image="*\\ntvdm.exe" OR Image="*\\csrstub.exe"))) | eval sigma_attack_tags="attack.defense_evasion" | eval sigma_title="Start of NT Virtual DOS Machine" | eval sigma_description="Ntvdm.exe allows the execution of 16-bit Windows applications on 32-bit Windows operating systems, as well as the execution of both 16-bit and 32-bit DOS applications"
dispatch.earliest_time = -24h@h
alert.track = 0

[3Proxy Usage - winevent]
description = Detects the use of 3proxy, a tiny free proxy server
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\3proxy.exe" OR Description="3proxy - tiny proxy server" OR Process_Command_Line="*.exe -i127.0.0.1 -p*"))) | eval sigma_attack_tags="attack.command_and_control attack.t1572" | eval sigma_title="3Proxy Usage" | eval sigma_description="Detects the use of 3proxy, a tiny free proxy server"
dispatch.earliest_time = -24h@h
alert.track = 0

[3Proxy Usage - sysmon]
description = Detects the use of 3proxy, a tiny free proxy server
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\3proxy.exe" OR Description="3proxy - tiny proxy server" OR CommandLine="*.exe -i127.0.0.1 -p*"))) | eval sigma_attack_tags="attack.command_and_control attack.t1572" | eval sigma_title="3Proxy Usage" | eval sigma_description="Detects the use of 3proxy, a tiny free proxy server"
dispatch.earliest_time = -24h@h
alert.track = 0

[Compress Data and Lock With Password for Exfiltration With 7-ZIP - winevent]
description = An adversary may compress or encrypt data that is collected prior to exfiltration using 3rd party utilities
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (Process_Command_Line="*7z.exe*" OR Process_Command_Line="*7za.exe*") Process_Command_Line="* -p*" (Process_Command_Line="* a *" OR Process_Command_Line="* u *"))) | table Process_Command_Line,ParentCommandLine,CurrentDirectory | eval sigma_attack_tags="attack.collection attack.t1560.001" | eval sigma_title="Compress Data and Lock With Password for Exfiltration With 7-ZIP" | eval sigma_description="An adversary may compress or encrypt data that is collected prior to exfiltration using 3rd party utilities"
dispatch.earliest_time = -24h@h
alert.track = 0

[Compress Data and Lock With Password for Exfiltration With 7-ZIP - sysmon]
description = An adversary may compress or encrypt data that is collected prior to exfiltration using 3rd party utilities
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (CommandLine="*7z.exe*" OR CommandLine="*7za.exe*") CommandLine="* -p*" (CommandLine="* a *" OR CommandLine="* u *"))) | table CommandLine,ParentCommandLine,CurrentDirectory | eval sigma_attack_tags="attack.collection attack.t1560.001" | eval sigma_title="Compress Data and Lock With Password for Exfiltration With 7-ZIP" | eval sigma_description="An adversary may compress or encrypt data that is collected prior to exfiltration using 3rd party utilities"
dispatch.earliest_time = -24h@h
alert.track = 0

[7Zip Compressing Dump Files - winevent]
description = Detects a suspicious 7zip execution that involves a file with a .dmp extension, which could be a step in a process of dump file exfiltration
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\7z.exe" OR New_Process_Name="*\\7zr.exe" OR New_Process_Name="*\\7za.exe") OR Description="*7-Zip*") Process_Command_Line="*.dmp*")) | eval sigma_attack_tags="attack.collection attack.t1560.001" | eval sigma_title="7Zip Compressing Dump Files" | eval sigma_description="Detects a suspicious 7zip execution that involves a file with a .dmp extension, which could be a step in a process of dump file exfiltration"
dispatch.earliest_time = -24h@h
alert.track = 0

[7Zip Compressing Dump Files - sysmon]
description = Detects a suspicious 7zip execution that involves a file with a .dmp extension, which could be a step in a process of dump file exfiltration
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\7z.exe" OR Image="*\\7zr.exe" OR Image="*\\7za.exe") OR Description="*7-Zip*") CommandLine="*.dmp*")) | eval sigma_attack_tags="attack.collection attack.t1560.001" | eval sigma_title="7Zip Compressing Dump Files" | eval sigma_description="Detects a suspicious 7zip execution that involves a file with a .dmp extension, which could be a step in a process of dump file exfiltration"
dispatch.earliest_time = -24h@h
alert.track = 0

[Add User to Local Administrators - winevent]
description = Detects suspicious command line that adds an account to the local administrators/administrateurs group
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((Process_Command_Line="*localgroup *" Process_Command_Line="* /add*")) OR ((Process_Command_Line="*Add-LocalGroupMember *" Process_Command_Line="* -Group *"))) (Process_Command_Line="* administrators *" OR Process_Command_Line="* administrateur*"))) | eval sigma_attack_tags="attack.persistence attack.t1098" | eval sigma_title="Add User to Local Administrators" | eval sigma_description="Detects suspicious command line that adds an account to the local administrators/administrateurs group"
dispatch.earliest_time = -24h@h
alert.track = 0

[Add User to Local Administrators - sysmon]
description = Detects suspicious command line that adds an account to the local administrators/administrateurs group
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((CommandLine="*localgroup *" CommandLine="* /add*")) OR ((CommandLine="*Add-LocalGroupMember *" CommandLine="* -Group *"))) (CommandLine="* administrators *" OR CommandLine="* administrateur*"))) | eval sigma_attack_tags="attack.persistence attack.t1098" | eval sigma_title="Add User to Local Administrators" | eval sigma_description="Detects suspicious command line that adds an account to the local administrators/administrateurs group"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Add User to Remote Desktop Users Group - winevent]
description = Detects suspicious command line in which a user gets added to the local Remote Desktop Users group
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((Process_Command_Line="*localgroup *" Process_Command_Line="* /add*")) OR ((Process_Command_Line="*Add-LocalGroupMember *" Process_Command_Line="* -Group *"))) (Process_Command_Line="*Remote Desktop Users*" OR Process_Command_Line="*Utilisateurs du Bureau à distance*" OR Process_Command_Line="*Usuarios de escritorio remoto*"))) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.persistence attack.lateral_movement attack.t1133 attack.t1136.001 attack.t1021.001" | eval sigma_title="Suspicious Add User to Remote Desktop Users Group" | eval sigma_description="Detects suspicious command line in which a user gets added to the local Remote Desktop Users group"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Add User to Remote Desktop Users Group - sysmon]
description = Detects suspicious command line in which a user gets added to the local Remote Desktop Users group
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((CommandLine="*localgroup *" CommandLine="* /add*")) OR ((CommandLine="*Add-LocalGroupMember *" CommandLine="* -Group *"))) (CommandLine="*Remote Desktop Users*" OR CommandLine="*Utilisateurs du Bureau à distance*" OR CommandLine="*Usuarios de escritorio remoto*"))) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.persistence attack.lateral_movement attack.t1133 attack.t1136.001 attack.t1021.001" | eval sigma_title="Suspicious Add User to Remote Desktop Users Group" | eval sigma_description="Detects suspicious command line in which a user gets added to the local Remote Desktop Users group"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious AdFind Enumeration - winevent]
description = Detects the execution of a AdFind for enumeration based on it's commadline flags
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((Process_Command_Line="*lockoutduration*" OR Process_Command_Line="*lockoutthreshold*" OR Process_Command_Line="*lockoutobservationwindow*" OR Process_Command_Line="*maxpwdage*" OR Process_Command_Line="*minpwdage*" OR Process_Command_Line="*minpwdlength*" OR Process_Command_Line="*pwdhistorylength*" OR Process_Command_Line="*pwdproperties*") OR Process_Command_Line="*-sc admincountdmp*" OR Process_Command_Line="*-sc exchaddresses*"))) | eval sigma_attack_tags="attack.discovery attack.t1087.002" | eval sigma_title="Suspicious AdFind Enumeration" | eval sigma_description="Detects the execution of a AdFind for enumeration based on it's commadline flags"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious AdFind Enumeration - sysmon]
description = Detects the execution of a AdFind for enumeration based on it's commadline flags
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((CommandLine="*lockoutduration*" OR CommandLine="*lockoutthreshold*" OR CommandLine="*lockoutobservationwindow*" OR CommandLine="*maxpwdage*" OR CommandLine="*minpwdage*" OR CommandLine="*minpwdlength*" OR CommandLine="*pwdhistorylength*" OR CommandLine="*pwdproperties*") OR CommandLine="*-sc admincountdmp*" OR CommandLine="*-sc exchaddresses*"))) | eval sigma_attack_tags="attack.discovery attack.t1087.002" | eval sigma_title="Suspicious AdFind Enumeration" | eval sigma_description="Detects the execution of a AdFind for enumeration based on it's commadline flags"
dispatch.earliest_time = -24h@h
alert.track = 0

[AdFind Usage Detection - winevent]
description = AdFind continues to be seen across majority of breaches. It is used to domain trust discovery to plan out subsequent steps in the attack chain.
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (Process_Command_Line="*domainlist*" OR Process_Command_Line="*trustdmp*" OR Process_Command_Line="*dcmodes*" OR Process_Command_Line="*adinfo*" OR Process_Command_Line="* dclist *" OR Process_Command_Line="*computer_pwdnotreqd*" OR Process_Command_Line="*objectcategory=*" OR Process_Command_Line="*-subnets -f*" OR Process_Command_Line="*name=\"Domain Admins\"*" OR Process_Command_Line="*-sc u:*" OR Process_Command_Line="*domainncs*" OR Process_Command_Line="*dompol*" OR Process_Command_Line="* oudmp *" OR Process_Command_Line="*subnetdmp*" OR Process_Command_Line="*gpodmp*" OR Process_Command_Line="*fspdmp*" OR Process_Command_Line="*users_noexpire*" OR Process_Command_Line="*computers_active*" OR Process_Command_Line="*computers_pwdnotreqd*"))) | eval sigma_attack_tags="attack.discovery attack.t1018 attack.t1087.002 attack.t1482 attack.t1069.002" | eval sigma_title="AdFind Usage Detection" | eval sigma_description="AdFind continues to be seen across majority of breaches. It is used to domain trust discovery to plan out subsequent steps in the attack chain."
dispatch.earliest_time = -24h@h
alert.track = 0

[AdFind Usage Detection - sysmon]
description = AdFind continues to be seen across majority of breaches. It is used to domain trust discovery to plan out subsequent steps in the attack chain.
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (CommandLine="*domainlist*" OR CommandLine="*trustdmp*" OR CommandLine="*dcmodes*" OR CommandLine="*adinfo*" OR CommandLine="* dclist *" OR CommandLine="*computer_pwdnotreqd*" OR CommandLine="*objectcategory=*" OR CommandLine="*-subnets -f*" OR CommandLine="*name=\"Domain Admins\"*" OR CommandLine="*-sc u:*" OR CommandLine="*domainncs*" OR CommandLine="*dompol*" OR CommandLine="* oudmp *" OR CommandLine="*subnetdmp*" OR CommandLine="*gpodmp*" OR CommandLine="*fspdmp*" OR CommandLine="*users_noexpire*" OR CommandLine="*computers_active*" OR CommandLine="*computers_pwdnotreqd*"))) | eval sigma_attack_tags="attack.discovery attack.t1018 attack.t1087.002 attack.t1482 attack.t1069.002" | eval sigma_title="AdFind Usage Detection" | eval sigma_description="AdFind continues to be seen across majority of breaches. It is used to domain trust discovery to plan out subsequent steps in the attack chain."
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious AdvancedRun Runas Priv User - winevent]
description = Detects the execution of AdvancedRun utility in the context of the TrustedInstaller, SYSTEM, Local Service or Network Service accounts
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (Process_Command_Line="*/EXEFilename*" OR Process_Command_Line="*/CommandLine*") ((Process_Command_Line="* /RunAs 8 *" OR Process_Command_Line="* /RunAs 4 *" OR Process_Command_Line="* /RunAs 10 *" OR Process_Command_Line="* /RunAs 11 *") OR (Process_Command_Line="*/RunAs 8" OR Process_Command_Line="*/RunAs 4" OR Process_Command_Line="*/RunAs 10" OR Process_Command_Line="*/RunAs 11")))) | eval sigma_attack_tags="" | eval sigma_title="Suspicious AdvancedRun Runas Priv User" | eval sigma_description="Detects the execution of AdvancedRun utility in the context of the TrustedInstaller, SYSTEM, Local Service or Network Service accounts"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious AdvancedRun Runas Priv User - sysmon]
description = Detects the execution of AdvancedRun utility in the context of the TrustedInstaller, SYSTEM, Local Service or Network Service accounts
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (CommandLine="*/EXEFilename*" OR CommandLine="*/CommandLine*") ((CommandLine="* /RunAs 8 *" OR CommandLine="* /RunAs 4 *" OR CommandLine="* /RunAs 10 *" OR CommandLine="* /RunAs 11 *") OR (CommandLine="*/RunAs 8" OR CommandLine="*/RunAs 4" OR CommandLine="*/RunAs 10" OR CommandLine="*/RunAs 11")))) | eval sigma_attack_tags="" | eval sigma_title="Suspicious AdvancedRun Runas Priv User" | eval sigma_description="Detects the execution of AdvancedRun utility in the context of the TrustedInstaller, SYSTEM, Local Service or Network Service accounts"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious AdvancedRun Execution - winevent]
description = Detects the execution of AdvancedRun utility
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (OriginalFileName="AdvancedRun.exe" OR ((Process_Command_Line="* /EXEFilename *" Process_Command_Line="* /Run*")) OR ((Process_Command_Line="* /WindowState 0*" Process_Command_Line="* /RunAs *" Process_Command_Line="* /CommandLine *"))))) | eval sigma_attack_tags="" | eval sigma_title="Suspicious AdvancedRun Execution" | eval sigma_description="Detects the execution of AdvancedRun utility"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious AdvancedRun Execution - sysmon]
description = Detects the execution of AdvancedRun utility
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (OriginalFileName="AdvancedRun.exe" OR ((CommandLine="* /EXEFilename *" CommandLine="* /Run*")) OR ((CommandLine="* /WindowState 0*" CommandLine="* /RunAs *" CommandLine="* /CommandLine *"))))) | eval sigma_attack_tags="" | eval sigma_title="Suspicious AdvancedRun Execution" | eval sigma_description="Detects the execution of AdvancedRun utility"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Windows App Activity - winevent]
description = Detects suspicious children of application launched from inside the WindowsApps directory. This could be a sign of a rogue '.appx' package installation/execution
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) Creator_Process_Name="*C:\\Program Files\\WindowsApps\\*" ((New_Process_Name="*\\poweshell.exe" OR New_Process_Name="*\\pwsh.exe" OR New_Process_Name="*\\rundll32.exe" OR New_Process_Name="*\\regsvr32.exe" OR New_Process_Name="*\\mshta.exe" OR New_Process_Name="*\\cscript.exe" OR New_Process_Name="*\\wscript.exe") OR (Process_Command_Line="*cmd /c*" OR Process_Command_Line="*Invoke-*" OR Process_Command_Line="*Base64*")))) | eval sigma_attack_tags="attack.defense_evasion" | eval sigma_title="Suspicious Windows App Activity" | eval sigma_description="Detects suspicious children of application launched from inside the WindowsApps directory. This could be a sign of a rogue '.appx' package installation/execution"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Windows App Activity - sysmon]
description = Detects suspicious children of application launched from inside the WindowsApps directory. This could be a sign of a rogue '.appx' package installation/execution
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ParentImage="*C:\\Program Files\\WindowsApps\\*" ((Image="*\\poweshell.exe" OR Image="*\\pwsh.exe" OR Image="*\\rundll32.exe" OR Image="*\\regsvr32.exe" OR Image="*\\mshta.exe" OR Image="*\\cscript.exe" OR Image="*\\wscript.exe") OR (CommandLine="*cmd /c*" OR CommandLine="*Invoke-*" OR CommandLine="*Base64*")))) | eval sigma_attack_tags="attack.defense_evasion" | eval sigma_title="Suspicious Windows App Activity" | eval sigma_description="Detects suspicious children of application launched from inside the WindowsApps directory. This could be a sign of a rogue '.appx' package installation/execution"
dispatch.earliest_time = -24h@h
alert.track = 0

[Abusable Invoke-ATHRemoteFXvGPUDisablementCommand - winevent]
description = RemoteFXvGPUDisablement.exe is an abusable, signed PowerShell host executable that was introduced in Windows 10 and Server 2019 (OS Build 17763.1339).
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*Invoke-ATHRemoteFXvGPUDisablementCommand *" (Process_Command_Line="*-ModuleName *" OR Process_Command_Line="*-ModulePath *" OR Process_Command_Line="*-ScriptBlock *" OR Process_Command_Line="*-RemoteFXvGPUDisablementFilePath*"))) | table ComputerName,Account_Name,Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.t1218" | eval sigma_title="Abusable Invoke-ATHRemoteFXvGPUDisablementCommand" | eval sigma_description="RemoteFXvGPUDisablement.exe is an abusable, signed PowerShell host executable that was introduced in Windows 10 and Server 2019 (OS Build 17763.1339)."
dispatch.earliest_time = -24h@h
alert.track = 0

[Abusable Invoke-ATHRemoteFXvGPUDisablementCommand - sysmon]
description = RemoteFXvGPUDisablement.exe is an abusable, signed PowerShell host executable that was introduced in Windows 10 and Server 2019 (OS Build 17763.1339).
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*Invoke-ATHRemoteFXvGPUDisablementCommand *" (CommandLine="*-ModuleName *" OR CommandLine="*-ModulePath *" OR CommandLine="*-ScriptBlock *" OR CommandLine="*-RemoteFXvGPUDisablementFilePath*"))) | table ComputerName,User,CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.t1218" | eval sigma_title="Abusable Invoke-ATHRemoteFXvGPUDisablementCommand" | eval sigma_description="RemoteFXvGPUDisablement.exe is an abusable, signed PowerShell host executable that was introduced in Windows 10 and Server 2019 (OS Build 17763.1339)."
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Encoded Obfuscated LOAD String - winevent]
description = Detects suspicious base64 encoded and obbfuscated LOAD string often used for reflection.assembly load
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (Process_Command_Line="*OgA6ACgAIgBMACIAKwAiAG8AYQBkACIAKQ*" OR Process_Command_Line="*oAOgAoACIATAAiACsAIgBvAGEAZAAiACkA*" OR Process_Command_Line="*6ADoAKAAiAEwAIgArACIAbwBhAGQAIgApA*" OR Process_Command_Line="*OgA6ACgAIgBMAG8AIgArACIAYQBkACIAKQ*" OR Process_Command_Line="*oAOgAoACIATABvACIAKwAiAGEAZAAiACkA*" OR Process_Command_Line="*6ADoAKAAiAEwAbwAiACsAIgBhAGQAIgApA*" OR Process_Command_Line="*OgA6ACgAIgBMAG8AYQAiACsAIgBkACIAKQ*" OR Process_Command_Line="*oAOgAoACIATABvAGEAIgArACIAZAAiACkA*" OR Process_Command_Line="*6ADoAKAAiAEwAbwBhACIAKwAiAGQAIgApA*" OR Process_Command_Line="*OgA6ACgAJwBMACcAKwAnAG8AYQBkACcAKQ*" OR Process_Command_Line="*oAOgAoACcATAAnACsAJwBvAGEAZAAnACkA*" OR Process_Command_Line="*6ADoAKAAnAEwAJwArACcAbwBhAGQAJwApA*" OR Process_Command_Line="*OgA6ACgAJwBMAG8AJwArACcAYQBkACcAKQ*" OR Process_Command_Line="*oAOgAoACcATABvACcAKwAnAGEAZAAnACkA*" OR Process_Command_Line="*6ADoAKAAnAEwAbwAnACsAJwBhAGQAJwApA*" OR Process_Command_Line="*OgA6ACgAJwBMAG8AYQAnACsAJwBkACcAKQ*" OR Process_Command_Line="*oAOgAoACcATABvAGEAJwArACcAZAAnACkA*" OR Process_Command_Line="*6ADoAKAAnAEwAbwBhACcAKwAnAGQAJwApA*"))) | table Process_Command_Line | eval sigma_attack_tags="attack.execution attack.t1059.001 attack.defense_evasion attack.t1027" | eval sigma_title="Suspicious Encoded Obfuscated LOAD String" | eval sigma_description="Detects suspicious base64 encoded and obbfuscated LOAD string often used for reflection.assembly load"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Encoded Obfuscated LOAD String - sysmon]
description = Detects suspicious base64 encoded and obbfuscated LOAD string often used for reflection.assembly load
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (CommandLine="*OgA6ACgAIgBMACIAKwAiAG8AYQBkACIAKQ*" OR CommandLine="*oAOgAoACIATAAiACsAIgBvAGEAZAAiACkA*" OR CommandLine="*6ADoAKAAiAEwAIgArACIAbwBhAGQAIgApA*" OR CommandLine="*OgA6ACgAIgBMAG8AIgArACIAYQBkACIAKQ*" OR CommandLine="*oAOgAoACIATABvACIAKwAiAGEAZAAiACkA*" OR CommandLine="*6ADoAKAAiAEwAbwAiACsAIgBhAGQAIgApA*" OR CommandLine="*OgA6ACgAIgBMAG8AYQAiACsAIgBkACIAKQ*" OR CommandLine="*oAOgAoACIATABvAGEAIgArACIAZAAiACkA*" OR CommandLine="*6ADoAKAAiAEwAbwBhACIAKwAiAGQAIgApA*" OR CommandLine="*OgA6ACgAJwBMACcAKwAnAG8AYQBkACcAKQ*" OR CommandLine="*oAOgAoACcATAAnACsAJwBvAGEAZAAnACkA*" OR CommandLine="*6ADoAKAAnAEwAJwArACcAbwBhAGQAJwApA*" OR CommandLine="*OgA6ACgAJwBMAG8AJwArACcAYQBkACcAKQ*" OR CommandLine="*oAOgAoACcATABvACcAKwAnAGEAZAAnACkA*" OR CommandLine="*6ADoAKAAnAEwAbwAnACsAJwBhAGQAJwApA*" OR CommandLine="*OgA6ACgAJwBMAG8AYQAnACsAJwBkACcAKQ*" OR CommandLine="*oAOgAoACcATABvAGEAJwArACcAZAAnACkA*" OR CommandLine="*6ADoAKAAnAEwAbwBhACcAKwAnAGQAJwApA*"))) | table CommandLine | eval sigma_attack_tags="attack.execution attack.t1059.001 attack.defense_evasion attack.t1027" | eval sigma_title="Suspicious Encoded Obfuscated LOAD String" | eval sigma_description="Detects suspicious base64 encoded and obbfuscated LOAD string often used for reflection.assembly load"
dispatch.earliest_time = -24h@h
alert.track = 0

[Possible Ransomware or Unauthorized MBR Modifications - winevent]
description = Detects, possibly, malicious unauthorized usage of bcdedit.exe
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\bcdedit.exe" (Process_Command_Line="*delete*" OR Process_Command_Line="*deletevalue*" OR Process_Command_Line="*import*" OR Process_Command_Line="*safeboot*" OR Process_Command_Line="*network*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1070 attack.persistence attack.t1542.003" | eval sigma_title="Possible Ransomware or Unauthorized MBR Modifications" | eval sigma_description="Detects, possibly, malicious unauthorized usage of bcdedit.exe"
dispatch.earliest_time = -24h@h
alert.track = 0

[Possible Ransomware or Unauthorized MBR Modifications - sysmon]
description = Detects, possibly, malicious unauthorized usage of bcdedit.exe
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\bcdedit.exe" (CommandLine="*delete*" OR CommandLine="*deletevalue*" OR CommandLine="*import*" OR CommandLine="*safeboot*" OR CommandLine="*network*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1070 attack.persistence attack.t1542.003" | eval sigma_title="Possible Ransomware or Unauthorized MBR Modifications" | eval sigma_description="Detects, possibly, malicious unauthorized usage of bcdedit.exe"
dispatch.earliest_time = -24h@h
alert.track = 0

[Application Whitelisting Bypass via Bginfo - winevent]
description = Execute VBscript code that is referenced within the *.bgi file.
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\bginfo.exe" Process_Command_Line="*/popup*" Process_Command_Line="*/nolicprompt*")) | eval sigma_attack_tags="attack.execution attack.t1059.005 attack.defense_evasion attack.t1218 attack.t1202" | eval sigma_title="Application Whitelisting Bypass via Bginfo" | eval sigma_description="Execute VBscript code that is referenced within the *.bgi file."
dispatch.earliest_time = -24h@h
alert.track = 0

[Application Whitelisting Bypass via Bginfo - sysmon]
description = Execute VBscript code that is referenced within the *.bgi file.
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\bginfo.exe" CommandLine="*/popup*" CommandLine="*/nolicprompt*")) | eval sigma_attack_tags="attack.execution attack.t1059.005 attack.defense_evasion attack.t1218 attack.t1202" | eval sigma_title="Application Whitelisting Bypass via Bginfo" | eval sigma_description="Execute VBscript code that is referenced within the *.bgi file."
dispatch.earliest_time = -24h@h
alert.track = 0

[Reconnaissance Activity Using BuiltIn Commands - winevent]
description = Detects execution of a set of builtin commands often used in recon stages by different attack groups
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((Process_Command_Line="tasklist" OR Process_Command_Line="net time" OR Process_Command_Line="systeminfo" OR Process_Command_Line="whoami" OR Process_Command_Line="nbtstat" OR Process_Command_Line="net start" OR Process_Command_Line="qprocess" OR Process_Command_Line="nslookup" OR Process_Command_Line="hostname.exe" OR Process_Command_Line="netstat -an") OR (Process_Command_Line="*\\net1 start" OR Process_Command_Line="*\\net1 user /domain" OR Process_Command_Line="*\\net1 group /domain" OR Process_Command_Line="*\\net1 group \"domain admins\" /domain" OR Process_Command_Line="*\\net1 group \"Exchange Trusted Subsystem\" /domain" OR Process_Command_Line="*\\net1 accounts /domain" OR Process_Command_Line="*\\net1 user net localgroup administrators")))) | eventstats count as val by Process_Command_Line| search val > 4 | eval sigma_attack_tags="attack.discovery attack.t1087 attack.t1082 car.2016-03-001" | eval sigma_title="Reconnaissance Activity Using BuiltIn Commands" | eval sigma_description="Detects execution of a set of builtin commands often used in recon stages by different attack groups"
dispatch.earliest_time = -24h@h
alert.track = 0

[Reconnaissance Activity Using BuiltIn Commands - sysmon]
description = Detects execution of a set of builtin commands often used in recon stages by different attack groups
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((CommandLine="tasklist" OR CommandLine="net time" OR CommandLine="systeminfo" OR CommandLine="whoami" OR CommandLine="nbtstat" OR CommandLine="net start" OR CommandLine="qprocess" OR CommandLine="nslookup" OR CommandLine="hostname.exe" OR CommandLine="netstat -an") OR (CommandLine="*\\net1 start" OR CommandLine="*\\net1 user /domain" OR CommandLine="*\\net1 group /domain" OR CommandLine="*\\net1 group \"domain admins\" /domain" OR CommandLine="*\\net1 group \"Exchange Trusted Subsystem\" /domain" OR CommandLine="*\\net1 accounts /domain" OR CommandLine="*\\net1 user net localgroup administrators")))) | eventstats count as val by CommandLine| search val > 4 | eval sigma_attack_tags="attack.discovery attack.t1087 attack.t1082 car.2016-03-001" | eval sigma_title="Reconnaissance Activity Using BuiltIn Commands" | eval sigma_description="Detects execution of a set of builtin commands often used in recon stages by different attack groups"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Calculator Usage - winevent]
description = Detects suspicious use of 'calc.exe' with command line parameters or in a suspicious directory, which is likely caused by some PoC or detection evasion
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (Process_Command_Line="*\\calc.exe *" OR ((New_Process_Name="*\\calc.exe" NOT (((New_Process_Name="C:\\Windows\\System32\\*" OR New_Process_Name="C:\\Windows\\SysWOW64\\*" OR New_Process_Name="C:\\Windows\\WinSxS\\*")))))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1036" | eval sigma_title="Suspicious Calculator Usage" | eval sigma_description="Detects suspicious use of 'calc.exe' with command line parameters or in a suspicious directory, which is likely caused by some PoC or detection evasion"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Calculator Usage - sysmon]
description = Detects suspicious use of 'calc.exe' with command line parameters or in a suspicious directory, which is likely caused by some PoC or detection evasion
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (CommandLine="*\\calc.exe *" OR ((Image="*\\calc.exe" NOT (((Image="C:\\Windows\\System32\\*" OR Image="C:\\Windows\\SysWOW64\\*" OR Image="C:\\Windows\\WinSxS\\*")))))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1036" | eval sigma_title="Suspicious Calculator Usage" | eval sigma_description="Detects suspicious use of 'calc.exe' with command line parameters or in a suspicious directory, which is likely caused by some PoC or detection evasion"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Certutil Command Usage - winevent]
description = Detects a suspicious Microsoft certutil execution with sub commands like 'decode' sub command, which is sometimes used to decode malicious code
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\certutil.exe" OR OriginalFileName="CertUtil.exe") (Process_Command_Line="* -decode *" OR Process_Command_Line="* -decodehex *" OR Process_Command_Line="* -urlcache *" OR Process_Command_Line="* -verifyctl *" OR Process_Command_Line="* -encode *" OR Process_Command_Line="* -exportPFX *" OR Process_Command_Line="* /decode *" OR Process_Command_Line="* /decodehex *" OR Process_Command_Line="* /urlcache *" OR Process_Command_Line="* /verifyctl *" OR Process_Command_Line="* /encode *" OR Process_Command_Line="* /exportPFX *"))) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.t1140 attack.command_and_control attack.t1105 attack.s0160 attack.g0007 attack.g0010 attack.g0045 attack.g0049 attack.g0075 attack.g0096" | eval sigma_title="Suspicious Certutil Command Usage" | eval sigma_description="Detects a suspicious Microsoft certutil execution with sub commands like 'decode' sub command, which is sometimes used to decode malicious code"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Certutil Command Usage - sysmon]
description = Detects a suspicious Microsoft certutil execution with sub commands like 'decode' sub command, which is sometimes used to decode malicious code
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\certutil.exe" OR OriginalFileName="CertUtil.exe") (CommandLine="* -decode *" OR CommandLine="* -decodehex *" OR CommandLine="* -urlcache *" OR CommandLine="* -verifyctl *" OR CommandLine="* -encode *" OR CommandLine="* -exportPFX *" OR CommandLine="* /decode *" OR CommandLine="* /decodehex *" OR CommandLine="* /urlcache *" OR CommandLine="* /verifyctl *" OR CommandLine="* /encode *" OR CommandLine="* /exportPFX *"))) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.t1140 attack.command_and_control attack.t1105 attack.s0160 attack.g0007 attack.g0010 attack.g0045 attack.g0049 attack.g0075 attack.g0096" | eval sigma_title="Suspicious Certutil Command Usage" | eval sigma_description="Detects a suspicious Microsoft certutil execution with sub commands like 'decode' sub command, which is sometimes used to decode malicious code"
dispatch.earliest_time = -24h@h
alert.track = 0

[Certutil Encode - winevent]
description = Detects suspicious a certutil command that used to encode files, which is sometimes used for data exfiltration
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\certutil.exe" Process_Command_Line="*-f*" Process_Command_Line="*-encode*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1027" | eval sigma_title="Certutil Encode" | eval sigma_description="Detects suspicious a certutil command that used to encode files, which is sometimes used for data exfiltration"
dispatch.earliest_time = -24h@h
alert.track = 0

[Certutil Encode - sysmon]
description = Detects suspicious a certutil command that used to encode files, which is sometimes used for data exfiltration
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\certutil.exe" CommandLine="*-f*" CommandLine="*-encode*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1027" | eval sigma_title="Certutil Encode" | eval sigma_description="Detects suspicious a certutil command that used to encode files, which is sometimes used for data exfiltration"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Child Process Created as System - winevent]
description = Detection of child processes spawned with SYSTEM privileges by parents with LOCAL SERVICE or NETWORK SERVICE accounts
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((ParentUser="*AUTHORI*" OR ParentUser="*AUTORI*") (ParentUser="*\\NETWORK SERVICE" OR ParentUser="*\\LOCAL SERVICE") (Account_Name="*AUTHORI*" OR Account_Name="*AUTORI*") (Account_Name="*\\SYSTEM" OR Account_Name="*\\Système" OR Account_Name="*\\СИСТЕМА") IntegrityLevel="System")) NOT (((New_Process_Name="*\\rundll32.exe" Process_Command_Line="*DavSetCookie*"))))) | eval sigma_attack_tags="attack.privilege_escalation attack.t1134.002" | eval sigma_title="Suspicious Child Process Created as System" | eval sigma_description="Detection of child processes spawned with SYSTEM privileges by parents with LOCAL SERVICE or NETWORK SERVICE accounts"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Child Process Created as System - sysmon]
description = Detection of child processes spawned with SYSTEM privileges by parents with LOCAL SERVICE or NETWORK SERVICE accounts
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((ParentUser="*AUTHORI*" OR ParentUser="*AUTORI*") (ParentUser="*\\NETWORK SERVICE" OR ParentUser="*\\LOCAL SERVICE") (User="*AUTHORI*" OR User="*AUTORI*") (User="*\\SYSTEM" OR User="*\\Système" OR User="*\\СИСТЕМА") IntegrityLevel="System")) NOT (((Image="*\\rundll32.exe" CommandLine="*DavSetCookie*"))))) | eval sigma_attack_tags="attack.privilege_escalation attack.t1134.002" | eval sigma_title="Suspicious Child Process Created as System" | eval sigma_description="Detection of child processes spawned with SYSTEM privileges by parents with LOCAL SERVICE or NETWORK SERVICE accounts"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Commandline Escape - winevent]
description = Detects suspicious process that use escape characters
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (Process_Command_Line="*h^t^t^p*" OR Process_Command_Line="*h\"t\"t\"p*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1140" | eval sigma_title="Suspicious Commandline Escape" | eval sigma_description="Detects suspicious process that use escape characters"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Commandline Escape - sysmon]
description = Detects suspicious process that use escape characters
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (CommandLine="*h^t^t^p*" OR CommandLine="*h\"t\"t\"p*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1140" | eval sigma_title="Suspicious Commandline Escape" | eval sigma_description="Detects suspicious process that use escape characters"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious CLSID Folder Name In Suspicious Locations - winevent]
description = Detects usage of a CLSID folder name located in a suspicious location from the commandline as seen being used in IcedID
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((Process_Command_Line="*\\AppData\\Roaming\\*" OR Process_Command_Line="*\\AppData\\Local\\Temp\\*") Process_Command_Line="*\\{*" Process_Command_Line="*}\\*")) NOT ((((New_Process_Name="*\\{*" New_Process_Name="*}\\*"))) OR ((NOT New_Process_Name="*")) OR ((New_Process_Name="C:\\Windows\\System32\\drvinst.exe"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1027" | eval sigma_title="Suspicious CLSID Folder Name In Suspicious Locations" | eval sigma_description="Detects usage of a CLSID folder name located in a suspicious location from the commandline as seen being used in IcedID"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious CLSID Folder Name In Suspicious Locations - sysmon]
description = Detects usage of a CLSID folder name located in a suspicious location from the commandline as seen being used in IcedID
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((CommandLine="*\\AppData\\Roaming\\*" OR CommandLine="*\\AppData\\Local\\Temp\\*") CommandLine="*\\{*" CommandLine="*}\\*")) NOT ((((Image="*\\{*" Image="*}\\*"))) OR ((NOT Image="*")) OR ((Image="C:\\Windows\\System32\\drvinst.exe"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1027" | eval sigma_title="Suspicious CLSID Folder Name In Suspicious Locations" | eval sigma_description="Detects usage of a CLSID folder name located in a suspicious location from the commandline as seen being used in IcedID"
dispatch.earliest_time = -24h@h
alert.track = 0

[Command Line Execution with Suspicious URL and AppData Strings - winevent]
description = Detects a suspicious command line execution that includes an URL and AppData string in the command line parameters as used by several droppers (js/vbs > powershell)
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\cmd.exe" Process_Command_Line="*http*" Process_Command_Line="*://*" Process_Command_Line="*%AppData%*")) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.execution attack.t1059.003 attack.t1059.001 attack.command_and_control attack.t1105" | eval sigma_title="Command Line Execution with Suspicious URL and AppData Strings" | eval sigma_description="Detects a suspicious command line execution that includes an URL and AppData string in the command line parameters as used by several droppers (js/vbs > powershell)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Command Line Execution with Suspicious URL and AppData Strings - sysmon]
description = Detects a suspicious command line execution that includes an URL and AppData string in the command line parameters as used by several droppers (js/vbs > powershell)
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\cmd.exe" CommandLine="*http*" CommandLine="*://*" CommandLine="*%AppData%*")) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.execution attack.t1059.003 attack.t1059.001 attack.command_and_control attack.t1105" | eval sigma_title="Command Line Execution with Suspicious URL and AppData Strings" | eval sigma_description="Detects a suspicious command line execution that includes an URL and AppData string in the command line parameters as used by several droppers (js/vbs > powershell)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Copy from Volume Shadow Copy - winevent]
description = Detects a copy execution that targets a shadow copy (sometimes used to copy registry hives that are in use)
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*copy \\\\\?\\GLOBALROOT\\Device\\HarddiskVolumeShadowCopy*")) | eval sigma_attack_tags="attack.impact attack.t1490" | eval sigma_title="Copy from Volume Shadow Copy" | eval sigma_description="Detects a copy execution that targets a shadow copy (sometimes used to copy registry hives that are in use)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Copy from Volume Shadow Copy - sysmon]
description = Detects a copy execution that targets a shadow copy (sometimes used to copy registry hives that are in use)
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*copy \\\\\?\\GLOBALROOT\\Device\\HarddiskVolumeShadowCopy*")) | eval sigma_attack_tags="attack.impact attack.t1490" | eval sigma_title="Copy from Volume Shadow Copy" | eval sigma_description="Detects a copy execution that targets a shadow copy (sometimes used to copy registry hives that are in use)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Elevated System Shell - winevent]
description = Detects when a shell program such as the windows Command Prompt or PowerShell is launched with system privileges.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((((New_Process_Name="*\\powershell.exe" OR New_Process_Name="*\\pwsh.exe" OR New_Process_Name="*\\cmd.exe") OR (OriginalFileName="PowerShell.EXE" OR OriginalFileName="pwsh.dll" OR OriginalFileName="Cmd.Exe")) (((Account_Name="*AUTHORI*" OR Account_Name="*AUTORI*") SubjectLogonId="0x3e7")))) NOT ((((Creator_Process_Name="C:\\Windows\\System32\\*" OR Creator_Process_Name="C:\\Program Files (x86)\\*" OR Creator_Process_Name="C:\\Program Files\\*") (New_Process_Name="*\\cmd.exe" OR New_Process_Name="*\\powershell.exe"))) OR ((Creator_Process_Name="C:\\ManageEngine\\ADManager Plus\\pgsql\\bin\\postgres.exe" New_Process_Name="*\\cmd.exe")) OR ((Creator_Process_Name="C:\\Windows\\SysWOW64\\config\\systemprofile\\Citrix\\UpdaterBinaries\\*" Creator_Process_Name="*\\CitrixReceiverUpdater.exe" New_Process_Name="*\\cmd.exe")) OR ((Creator_Process_Name="*\\python.exe" Process_Command_Line="C:\\WINDOWS\\system32\\cmd.exe /c \"ver\"" CurrentDirectory="*C:\\WINDOWS\\Temp\\asgard2-agent\\*")) OR ((Creator_Process_Name="C:\\Windows\\Temp*" Creator_Process_Name="*\\invcol.exe" ParentCommandLine="*C:\\ProgramData\\Dell\\UpdateService\\*" New_Process_Name="*\\cmd.exe")) OR ((Process_Command_Line="powershell.exe -ExecutionPolicy Restricted -Command Write-Host 'Final result: 1';"))))) | eval sigma_attack_tags="attack.privilege_escalation attack.defense_evasion attack.execution attack.t1059" | eval sigma_title="Suspicious Elevated System Shell" | eval sigma_description="Detects when a shell program such as the windows Command Prompt or PowerShell is launched with system privileges."
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Elevated System Shell - sysmon]
description = Detects when a shell program such as the windows Command Prompt or PowerShell is launched with system privileges.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((((Image="*\\powershell.exe" OR Image="*\\pwsh.exe" OR Image="*\\cmd.exe") OR (OriginalFileName="PowerShell.EXE" OR OriginalFileName="pwsh.dll" OR OriginalFileName="Cmd.Exe")) (((User="*AUTHORI*" OR User="*AUTORI*") LogonId="0x3e7")))) NOT ((((ParentImage="C:\\Windows\\System32\\*" OR ParentImage="C:\\Program Files (x86)\\*" OR ParentImage="C:\\Program Files\\*") (Image="*\\cmd.exe" OR Image="*\\powershell.exe"))) OR ((ParentImage="C:\\ManageEngine\\ADManager Plus\\pgsql\\bin\\postgres.exe" Image="*\\cmd.exe")) OR ((ParentImage="C:\\Windows\\SysWOW64\\config\\systemprofile\\Citrix\\UpdaterBinaries\\*" ParentImage="*\\CitrixReceiverUpdater.exe" Image="*\\cmd.exe")) OR ((ParentImage="*\\python.exe" CommandLine="C:\\WINDOWS\\system32\\cmd.exe /c \"ver\"" CurrentDirectory="*C:\\WINDOWS\\Temp\\asgard2-agent\\*")) OR ((ParentImage="C:\\Windows\\Temp*" ParentImage="*\\invcol.exe" ParentCommandLine="*C:\\ProgramData\\Dell\\UpdateService\\*" Image="*\\cmd.exe")) OR ((CommandLine="powershell.exe -ExecutionPolicy Restricted -Command Write-Host 'Final result: 1';"))))) | eval sigma_attack_tags="attack.privilege_escalation attack.defense_evasion attack.execution attack.t1059" | eval sigma_title="Suspicious Elevated System Shell" | eval sigma_description="Detects when a shell program such as the windows Command Prompt or PowerShell is launched with system privileges."
dispatch.earliest_time = -24h@h
alert.track = 0

[CHCP CodePage Locale Lookup - winevent]
description = Detects use of chcp to look up the system locale value as part of host discovery
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((Creator_Process_Name="*\\cmd.exe" (ParentCommandLine="* /c *" OR ParentCommandLine="* /r *" OR ParentCommandLine="* /k *") New_Process_Name="*\\chcp.com" (Process_Command_Line="*chcp" OR Process_Command_Line="*chcp " OR Process_Command_Line="*chcp  "))) NOT (((GrandparentCommandLine="*/c C:\\ProgramData\\Anaconda3*"))))) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.discovery attack.t1614.001" | eval sigma_title="CHCP CodePage Locale Lookup" | eval sigma_description="Detects use of chcp to look up the system locale value as part of host discovery"
dispatch.earliest_time = -24h@h
alert.track = 0

[CHCP CodePage Locale Lookup - sysmon]
description = Detects use of chcp to look up the system locale value as part of host discovery
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((ParentImage="*\\cmd.exe" (ParentCommandLine="* /c *" OR ParentCommandLine="* /r *" OR ParentCommandLine="* /k *") Image="*\\chcp.com" (CommandLine="*chcp" OR CommandLine="*chcp " OR CommandLine="*chcp  "))) NOT (((GrandparentCommandLine="*/c C:\\ProgramData\\Anaconda3*"))))) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.discovery attack.t1614.001" | eval sigma_title="CHCP CodePage Locale Lookup" | eval sigma_description="Detects use of chcp to look up the system locale value as part of host discovery"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Code Page Switch - winevent]
description = Detects a code page switch in command line or batch scripts to a rare language
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\chcp.com" (Process_Command_Line="* 936" OR Process_Command_Line="* 1258"))) | table ParentCommandLine | eval sigma_attack_tags="attack.t1036 attack.defense_evasion" | eval sigma_title="Suspicious Code Page Switch" | eval sigma_description="Detects a code page switch in command line or batch scripts to a rare language"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Code Page Switch - sysmon]
description = Detects a code page switch in command line or batch scripts to a rare language
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\chcp.com" (CommandLine="* 936" OR CommandLine="* 1258"))) | table ParentCommandLine | eval sigma_attack_tags="attack.t1036 attack.defense_evasion" | eval sigma_title="Suspicious Code Page Switch" | eval sigma_description="Detects a code page switch in command line or batch scripts to a rare language"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious RunAs-Like Flag Combination - winevent]
description = Detects suspicious command line flags that let the user set a target user and command as e.g. seen in PsExec-like tools
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (Process_Command_Line="* -u system *" OR Process_Command_Line="* --user system *" OR Process_Command_Line="* -u NT*" OR Process_Command_Line="* -u \"NT*" OR Process_Command_Line="* -u 'NT*" OR Process_Command_Line="* --system *" OR Process_Command_Line="* -u administrator *") (Process_Command_Line="* -c cmd*" OR Process_Command_Line="* -c \"cmd*" OR Process_Command_Line="* -c powershell*" OR Process_Command_Line="* -c \"powershell*" OR Process_Command_Line="* --command cmd*" OR Process_Command_Line="* --command powershell*" OR Process_Command_Line="* -c whoami*" OR Process_Command_Line="* -c wscript*" OR Process_Command_Line="* -c cscript*"))) | eval sigma_attack_tags="" | eval sigma_title="Suspicious RunAs-Like Flag Combination" | eval sigma_description="Detects suspicious command line flags that let the user set a target user and command as e.g. seen in PsExec-like tools"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious RunAs-Like Flag Combination - sysmon]
description = Detects suspicious command line flags that let the user set a target user and command as e.g. seen in PsExec-like tools
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (CommandLine="* -u system *" OR CommandLine="* --user system *" OR CommandLine="* -u NT*" OR CommandLine="* -u \"NT*" OR CommandLine="* -u 'NT*" OR CommandLine="* --system *" OR CommandLine="* -u administrator *") (CommandLine="* -c cmd*" OR CommandLine="* -c \"cmd*" OR CommandLine="* -c powershell*" OR CommandLine="* -c \"powershell*" OR CommandLine="* --command cmd*" OR CommandLine="* --command powershell*" OR CommandLine="* -c whoami*" OR CommandLine="* -c wscript*" OR CommandLine="* -c cscript*"))) | eval sigma_attack_tags="" | eval sigma_title="Suspicious RunAs-Like Flag Combination" | eval sigma_description="Detects suspicious command line flags that let the user set a target user and command as e.g. seen in PsExec-like tools"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Characters in CommandLine - winevent]
description = Detects suspicious Unicode characters in the command line, which could be a sign of obfuscation or defense evasion
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((Process_Command_Line="*ˣ*" OR Process_Command_Line="*˪*" OR Process_Command_Line="*ˢ*") OR (Process_Command_Line="*∕*" OR Process_Command_Line="*⁄*") OR (Process_Command_Line="*―*" OR Process_Command_Line="*—*")))) | eval sigma_attack_tags="" | eval sigma_title="Suspicious Characters in CommandLine" | eval sigma_description="Detects suspicious Unicode characters in the command line, which could be a sign of obfuscation or defense evasion"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Characters in CommandLine - sysmon]
description = Detects suspicious Unicode characters in the command line, which could be a sign of obfuscation or defense evasion
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((CommandLine="*ˣ*" OR CommandLine="*˪*" OR CommandLine="*ˢ*") OR (CommandLine="*∕*" OR CommandLine="*⁄*") OR (CommandLine="*―*" OR CommandLine="*—*")))) | eval sigma_attack_tags="" | eval sigma_title="Suspicious Characters in CommandLine" | eval sigma_description="Detects suspicious Unicode characters in the command line, which could be a sign of obfuscation or defense evasion"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Compression Tool Parameters - winevent]
description = Detects suspicious command line arguments of common data compression tools
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((OriginalFileName="7z*.exe" OR OriginalFileName="*rar.exe" OR OriginalFileName="*Command*Line*RAR*") (Process_Command_Line="* -p*" OR Process_Command_Line="* -ta*" OR Process_Command_Line="* -tb*" OR Process_Command_Line="* -sdel*" OR Process_Command_Line="* -dw*" OR Process_Command_Line="* -hp*"))) NOT ((Creator_Process_Name="C:\\Program*")))) | eval sigma_attack_tags="attack.collection attack.t1560.001" | eval sigma_title="Suspicious Compression Tool Parameters" | eval sigma_description="Detects suspicious command line arguments of common data compression tools"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Compression Tool Parameters - sysmon]
description = Detects suspicious command line arguments of common data compression tools
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((OriginalFileName="7z*.exe" OR OriginalFileName="*rar.exe" OR OriginalFileName="*Command*Line*RAR*") (CommandLine="* -p*" OR CommandLine="* -ta*" OR CommandLine="* -tb*" OR CommandLine="* -sdel*" OR CommandLine="* -dw*" OR CommandLine="* -hp*"))) NOT ((ParentImage="C:\\Program*")))) | eval sigma_attack_tags="attack.collection attack.t1560.001" | eval sigma_title="Suspicious Compression Tool Parameters" | eval sigma_description="Detects suspicious command line arguments of common data compression tools"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious High IntegrityLevel Conhost Legacy Option - winevent]
description = ForceV1 asks for information directly from the kernel space. Conhost connects to the console application. High IntegrityLevel means the process is running with elevated privileges, such as an Administrator context.
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") IntegrityLevel="High" Process_Command_Line="*conhost.exe*" Process_Command_Line="*0xffffffff*" Process_Command_Line="*-ForceV1*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1202" | eval sigma_title="Suspicious High IntegrityLevel Conhost Legacy Option" | eval sigma_description="ForceV1 asks for information directly from the kernel space. Conhost connects to the console application. High IntegrityLevel means the process is running with elevated privileges, such as an Administrator context."
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious High IntegrityLevel Conhost Legacy Option - sysmon]
description = ForceV1 asks for information directly from the kernel space. Conhost connects to the console application. High IntegrityLevel means the process is running with elevated privileges, such as an Administrator context.
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") IntegrityLevel="High" CommandLine="*conhost.exe*" CommandLine="*0xffffffff*" CommandLine="*-ForceV1*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1202" | eval sigma_title="Suspicious High IntegrityLevel Conhost Legacy Option" | eval sigma_description="ForceV1 asks for information directly from the kernel space. Conhost connects to the console application. High IntegrityLevel means the process is running with elevated privileges, such as an Administrator context."
dispatch.earliest_time = -24h@h
alert.track = 0

[Conhost Parent Process Executions - winevent]
description = Detects the conhost execution as parent process. Can be used to evaded defense mechanism.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) Creator_Process_Name="*\\conhost.exe" NOT (((Provider_Name="SystemTraceProvider-Process")) OR ((Provider_Name="Microsoft-Windows-Kernel-Process" New_Process_Name="*\\git.exe" (ParentCommandLine="* show --textconv *" OR ParentCommandLine="* cat-file -s *"))) OR ((ParentCommandLine="*C:\\WINDOWS\\system32\\conhost.exe 0x4*" (Process_Command_Line="* show --textconv *" OR Process_Command_Line="* cat-file -s *"))) OR ((Provider_Name="Microsoft-Windows-Kernel-Process" (ParentCommandLine="* cat-file -s *" OR ParentCommandLine="*show --textconv*") New_Process_Name="C:\\Windows\\System32\\conhost.exe")) OR (((ParentCommandLine="\\\?\?\\C:\\WINDOWS\\system32\\conhost.exe 0x4" OR ParentCommandLine="\\\?\?\\C:\\WINDOWS\\system32\\conhost.exe 0xffffffff -ForceV1") New_Process_Name="C:\\Windows\\System32\\conhost.exe")) OR (((ParentCommandLine="\\\?\?\\C:\\WINDOWS\\system32\\conhost.exe 0xffffffff -ForceV1'" OR ParentCommandLine="\\\?\?\\C:\\WINDOWS\\system32\\conhost.exe 0x4'") New_Process_Name="C:\\Program Files\\Git\\mingw64\\bin\\git.exe"))))) | table New_Process_Name,Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.t1202" | eval sigma_title="Conhost Parent Process Executions" | eval sigma_description="Detects the conhost execution as parent process. Can be used to evaded defense mechanism."
dispatch.earliest_time = -24h@h
alert.track = 0

[Conhost Parent Process Executions - sysmon]
description = Detects the conhost execution as parent process. Can be used to evaded defense mechanism.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ParentImage="*\\conhost.exe" NOT (((Provider_Name="SystemTraceProvider-Process")) OR ((Provider_Name="Microsoft-Windows-Kernel-Process" Image="*\\git.exe" (ParentCommandLine="* show --textconv *" OR ParentCommandLine="* cat-file -s *"))) OR ((ParentCommandLine="*C:\\WINDOWS\\system32\\conhost.exe 0x4*" (CommandLine="* show --textconv *" OR CommandLine="* cat-file -s *"))) OR ((Provider_Name="Microsoft-Windows-Kernel-Process" (ParentCommandLine="* cat-file -s *" OR ParentCommandLine="*show --textconv*") Image="C:\\Windows\\System32\\conhost.exe")) OR (((ParentCommandLine="\\\?\?\\C:\\WINDOWS\\system32\\conhost.exe 0x4" OR ParentCommandLine="\\\?\?\\C:\\WINDOWS\\system32\\conhost.exe 0xffffffff -ForceV1") Image="C:\\Windows\\System32\\conhost.exe")) OR (((ParentCommandLine="\\\?\?\\C:\\WINDOWS\\system32\\conhost.exe 0xffffffff -ForceV1'" OR ParentCommandLine="\\\?\?\\C:\\WINDOWS\\system32\\conhost.exe 0x4'") Image="C:\\Program Files\\Git\\mingw64\\bin\\git.exe"))))) | table Image,CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.t1202" | eval sigma_title="Conhost Parent Process Executions" | eval sigma_description="Detects the conhost execution as parent process. Can be used to evaded defense mechanism."
dispatch.earliest_time = -24h@h
alert.track = 0

[CVE-2021-40444 Process Pattern - winevent]
description = Detects a suspicious process pattern found in CVE-2021-40444 exploitation
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\control.exe" (Creator_Process_Name="*\\winword.exe" OR Creator_Process_Name="*\\powerpnt.exe" OR Creator_Process_Name="*\\excel.exe"))) NOT (((Process_Command_Line="*\\control.exe input.dll" OR Process_Command_Line="*\\control.exe\" input.dll"))))) | eval sigma_attack_tags="attack.execution attack.t1059" | eval sigma_title="CVE-2021-40444 Process Pattern" | eval sigma_description="Detects a suspicious process pattern found in CVE-2021-40444 exploitation"
dispatch.earliest_time = -24h@h
alert.track = 0

[CVE-2021-40444 Process Pattern - sysmon]
description = Detects a suspicious process pattern found in CVE-2021-40444 exploitation
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\control.exe" (ParentImage="*\\winword.exe" OR ParentImage="*\\powerpnt.exe" OR ParentImage="*\\excel.exe"))) NOT (((CommandLine="*\\control.exe input.dll" OR CommandLine="*\\control.exe\" input.dll"))))) | eval sigma_attack_tags="attack.execution attack.t1059" | eval sigma_title="CVE-2021-40444 Process Pattern" | eval sigma_description="Detects a suspicious process pattern found in CVE-2021-40444 exploitation"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Control Panel DLL Load - winevent]
description = Detects suspicious Rundll32 execution from control.exe as used by Equation Group and Exploit Kits
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((Creator_Process_Name="*\\System32\\control.exe" New_Process_Name="*\\rundll32.exe ")) NOT ((Process_Command_Line="*Shell32.dll*")))) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.t1218.011" | eval sigma_title="Suspicious Control Panel DLL Load" | eval sigma_description="Detects suspicious Rundll32 execution from control.exe as used by Equation Group and Exploit Kits"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Control Panel DLL Load - sysmon]
description = Detects suspicious Rundll32 execution from control.exe as used by Equation Group and Exploit Kits
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((ParentImage="*\\System32\\control.exe" Image="*\\rundll32.exe ")) NOT ((CommandLine="*Shell32.dll*")))) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.t1218.011" | eval sigma_title="Suspicious Control Panel DLL Load" | eval sigma_description="Detects suspicious Rundll32 execution from control.exe as used by Equation Group and Exploit Kits"
dispatch.earliest_time = -24h@h
alert.track = 0

[Copy from Admin Share - winevent]
description = Detects a suspicious copy command to or from an Admin share or remote
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((Process_Command_Line="*\\\\\*" Process_Command_Line="*$*")) ((((New_Process_Name="*\\robocopy.exe" OR New_Process_Name="*\\xcopy.exe") OR (OriginalFileName="robocopy.exe" OR OriginalFileName="XCOPY.EXE")) OR (((New_Process_Name="*\\cmd.exe" OR OriginalFileName="Cmd.Exe") Process_Command_Line="*copy*"))) OR ((((New_Process_Name="*\\powershell.exe*" OR New_Process_Name="*\\pwsh.exe*") OR (OriginalFileName="PowerShell.EXE" OR OriginalFileName="pwsh.dll")) (Process_Command_Line="*copy-item*" OR Process_Command_Line="*copy *" OR Process_Command_Line="*cpi *" OR Process_Command_Line="* cp *" OR Process_Command_Line="*move *" OR Process_Command_Line="*move-item*" OR Process_Command_Line="* mi *" OR Process_Command_Line="* mv *")))))) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.lateral_movement attack.collection attack.exfiltration attack.t1039 attack.t1048 attack.t1021.002" | eval sigma_title="Copy from Admin Share" | eval sigma_description="Detects a suspicious copy command to or from an Admin share or remote"
dispatch.earliest_time = -24h@h
alert.track = 0

[Copy from Admin Share - sysmon]
description = Detects a suspicious copy command to or from an Admin share or remote
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((CommandLine="*\\\\\*" CommandLine="*$*")) ((((Image="*\\robocopy.exe" OR Image="*\\xcopy.exe") OR (OriginalFileName="robocopy.exe" OR OriginalFileName="XCOPY.EXE")) OR (((Image="*\\cmd.exe" OR OriginalFileName="Cmd.Exe") CommandLine="*copy*"))) OR ((((Image="*\\powershell.exe*" OR Image="*\\pwsh.exe*") OR (OriginalFileName="PowerShell.EXE" OR OriginalFileName="pwsh.dll")) (CommandLine="*copy-item*" OR CommandLine="*copy *" OR CommandLine="*cpi *" OR CommandLine="* cp *" OR CommandLine="*move *" OR CommandLine="*move-item*" OR CommandLine="* mi *" OR CommandLine="* mv *")))))) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.lateral_movement attack.collection attack.exfiltration attack.t1039 attack.t1048 attack.t1021.002" | eval sigma_title="Copy from Admin Share" | eval sigma_description="Detects a suspicious copy command to or from an Admin share or remote"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Copy From or To System32 - winevent]
description = Detects a suspicious copy operation that tries to copy a program from a system (System32 or SysWOW64) directory to another on disk.
Often used to move LOLBINs such as 'certutil' or 'desktopimgdownldr' to a different location with a different name in order to bypass detections based on locations

search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((New_Process_Name="*\\cmd.exe" Process_Command_Line="*copy *")) OR (((New_Process_Name="*\\powershell.exe" OR New_Process_Name="*\\pwsh.exe") (Process_Command_Line="*copy-item*" OR Process_Command_Line="* copy *" OR Process_Command_Line="*cpi *" OR Process_Command_Line="* cp *"))) OR ((New_Process_Name="*\\robocopy.exe" OR New_Process_Name="*\\xcopy.exe") OR (OriginalFileName="robocopy.exe" OR OriginalFileName="XCOPY.EXE"))) (Process_Command_Line="*\\System32*" OR Process_Command_Line="*\\SysWOW64*"))) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.t1036.003" | eval sigma_title="Suspicious Copy From or To System32" | eval sigma_description="Detects a suspicious copy operation that tries to copy a program from a system (System32 or SysWOW64) directory to another on disk.
Often used to move LOLBINs such as 'certutil' or 'desktopimgdownldr' to a different location with a different name in order to bypass detections based on locations
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Copy From or To System32 - sysmon]
description = Detects a suspicious copy operation that tries to copy a program from a system (System32 or SysWOW64) directory to another on disk.
Often used to move LOLBINs such as 'certutil' or 'desktopimgdownldr' to a different location with a different name in order to bypass detections based on locations

search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((Image="*\\cmd.exe" CommandLine="*copy *")) OR (((Image="*\\powershell.exe" OR Image="*\\pwsh.exe") (CommandLine="*copy-item*" OR CommandLine="* copy *" OR CommandLine="*cpi *" OR CommandLine="* cp *"))) OR ((Image="*\\robocopy.exe" OR Image="*\\xcopy.exe") OR (OriginalFileName="robocopy.exe" OR OriginalFileName="XCOPY.EXE"))) (CommandLine="*\\System32*" OR CommandLine="*\\SysWOW64*"))) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.t1036.003" | eval sigma_title="Suspicious Copy From or To System32" | eval sigma_description="Detects a suspicious copy operation that tries to copy a program from a system (System32 or SysWOW64) directory to another on disk.
Often used to move LOLBINs such as 'certutil' or 'desktopimgdownldr' to a different location with a different name in order to bypass detections based on locations
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Covenant Launcher Indicators - winevent]
description = Detects suspicious command lines used in Covenant luanchers
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((Process_Command_Line="*-Sta*" Process_Command_Line="*-Nop*" Process_Command_Line="*-Window*" Process_Command_Line="*Hidden*" (Process_Command_Line="*-Command*" OR Process_Command_Line="*-EncodedCommand*"))) OR (Process_Command_Line="*sv o (New-Object IO.MemorySteam);sv d *" OR Process_Command_Line="*mshta file.hta*" OR Process_Command_Line="*GruntHTTP*" OR Process_Command_Line="*-EncodedCommand cwB2ACAAbwAgA*")))) | eval sigma_attack_tags="attack.execution attack.defense_evasion attack.t1059.001 attack.t1564.003" | eval sigma_title="Covenant Launcher Indicators" | eval sigma_description="Detects suspicious command lines used in Covenant luanchers"
dispatch.earliest_time = -24h@h
alert.track = 0

[Covenant Launcher Indicators - sysmon]
description = Detects suspicious command lines used in Covenant luanchers
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((CommandLine="*-Sta*" CommandLine="*-Nop*" CommandLine="*-Window*" CommandLine="*Hidden*" (CommandLine="*-Command*" OR CommandLine="*-EncodedCommand*"))) OR (CommandLine="*sv o (New-Object IO.MemorySteam);sv d *" OR CommandLine="*mshta file.hta*" OR CommandLine="*GruntHTTP*" OR CommandLine="*-EncodedCommand cwB2ACAAbwAgA*")))) | eval sigma_attack_tags="attack.execution attack.defense_evasion attack.t1059.001 attack.t1564.003" | eval sigma_title="Covenant Launcher Indicators" | eval sigma_description="Detects suspicious command lines used in Covenant luanchers"
dispatch.earliest_time = -24h@h
alert.track = 0

[CrackMapExec Command Execution - winevent]
description = Detect various execution methods of the CrackMapExec pentesting framework
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (Process_Command_Line="*cmd.exe /Q /c * 1> \\\\*\\*\\* 2>&1" OR Process_Command_Line="*cmd.exe /C * > \\\\*\\*\\* 2>&1" OR Process_Command_Line="*cmd.exe /C * > *\\Temp\\* 2>&1") (Process_Command_Line="*powershell.exe -exec bypass -noni -nop -w 1 -C \"*" OR Process_Command_Line="*powershell.exe -noni -nop -w 1 -enc *"))) | table ComputerName,Account_Name,Process_Command_Line | eval sigma_attack_tags="attack.execution attack.t1047 attack.t1053 attack.t1059.003 attack.t1059.001 attack.s0106" | eval sigma_title="CrackMapExec Command Execution" | eval sigma_description="Detect various execution methods of the CrackMapExec pentesting framework"
dispatch.earliest_time = -24h@h
alert.track = 0

[CrackMapExec Command Execution - sysmon]
description = Detect various execution methods of the CrackMapExec pentesting framework
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (CommandLine="*cmd.exe /Q /c * 1> \\\\*\\*\\* 2>&1" OR CommandLine="*cmd.exe /C * > \\\\*\\*\\* 2>&1" OR CommandLine="*cmd.exe /C * > *\\Temp\\* 2>&1") (CommandLine="*powershell.exe -exec bypass -noni -nop -w 1 -C \"*" OR CommandLine="*powershell.exe -noni -nop -w 1 -enc *"))) | table ComputerName,User,CommandLine | eval sigma_attack_tags="attack.execution attack.t1047 attack.t1053 attack.t1059.003 attack.t1059.001 attack.s0106" | eval sigma_title="CrackMapExec Command Execution" | eval sigma_description="Detect various execution methods of the CrackMapExec pentesting framework"
dispatch.earliest_time = -24h@h
alert.track = 0

[CrackMapExec Command Line Flags - winevent]
description = This rule detect common flag combinations used by CrackMapExec in order to detect its use even if the binary has been replaced.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((Process_Command_Line="* -M pe_inject *" OR ((Process_Command_Line="* --local-auth*" Process_Command_Line="* -u *" Process_Command_Line="* -x *")) OR ((Process_Command_Line="* --local-auth*" Process_Command_Line="* -u *" Process_Command_Line="* -p *" Process_Command_Line="* -H 'NTHASH'*")) OR ((Process_Command_Line="* mssql *" Process_Command_Line="* -u *" Process_Command_Line="* -p *" Process_Command_Line="* -M *" Process_Command_Line="* -d *")) OR ((Process_Command_Line="* smb *" Process_Command_Line="* -u *" Process_Command_Line="* -H *" Process_Command_Line="* -M *" Process_Command_Line="* -o *")) OR ((Process_Command_Line="* smb *" Process_Command_Line="* -u *" Process_Command_Line="* -p *" Process_Command_Line="* --local-auth*"))) OR ((Process_Command_Line="* --local-auth*" Process_Command_Line="* -u *" Process_Command_Line="* -p *" Process_Command_Line="* 10.*" Process_Command_Line="* 192.168.*" Process_Command_Line="*/24 *"))))) | table ComputerName,Account_Name,Process_Command_Line | eval sigma_attack_tags="" | eval sigma_title="CrackMapExec Command Line Flags" | eval sigma_description="This rule detect common flag combinations used by CrackMapExec in order to detect its use even if the binary has been replaced."
dispatch.earliest_time = -24h@h
alert.track = 0

[CrackMapExec Command Line Flags - sysmon]
description = This rule detect common flag combinations used by CrackMapExec in order to detect its use even if the binary has been replaced.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((CommandLine="* -M pe_inject *" OR ((CommandLine="* --local-auth*" CommandLine="* -u *" CommandLine="* -x *")) OR ((CommandLine="* --local-auth*" CommandLine="* -u *" CommandLine="* -p *" CommandLine="* -H 'NTHASH'*")) OR ((CommandLine="* mssql *" CommandLine="* -u *" CommandLine="* -p *" CommandLine="* -M *" CommandLine="* -d *")) OR ((CommandLine="* smb *" CommandLine="* -u *" CommandLine="* -H *" CommandLine="* -M *" CommandLine="* -o *")) OR ((CommandLine="* smb *" CommandLine="* -u *" CommandLine="* -p *" CommandLine="* --local-auth*"))) OR ((CommandLine="* --local-auth*" CommandLine="* -u *" CommandLine="* -p *" CommandLine="* 10.*" CommandLine="* 192.168.*" CommandLine="*/24 *"))))) | table ComputerName,User,CommandLine | eval sigma_attack_tags="" | eval sigma_title="CrackMapExec Command Line Flags" | eval sigma_description="This rule detect common flag combinations used by CrackMapExec in order to detect its use even if the binary has been replaced."
dispatch.earliest_time = -24h@h
alert.track = 0

[CrackMapExec PowerShell Obfuscation - winevent]
description = The CrachMapExec pentesting framework implements a PowerShell obfuscation with some static strings detected by this rule.
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (Process_Command_Line="*powershell.exe*" OR Process_Command_Line="*pwsh.exe*") (Process_Command_Line="*join*split*" OR Process_Command_Line="*( $ShellId[1]+$ShellId[13]+'x')*" OR Process_Command_Line="*( $PSHome[*]+$PSHOME[*]+*" OR Process_Command_Line="*( $env:Public[13]+$env:Public[5]+'x')*" OR Process_Command_Line="*( $env:ComSpec[4,*,25]-Join'')*" OR Process_Command_Line="*[1,3]+'x'-Join'')*"))) | table ComputerName,Account_Name,Process_Command_Line | eval sigma_attack_tags="attack.execution attack.t1059.001 attack.defense_evasion attack.t1027.005" | eval sigma_title="CrackMapExec PowerShell Obfuscation" | eval sigma_description="The CrachMapExec pentesting framework implements a PowerShell obfuscation with some static strings detected by this rule."
dispatch.earliest_time = -24h@h
alert.track = 0

[CrackMapExec PowerShell Obfuscation - sysmon]
description = The CrachMapExec pentesting framework implements a PowerShell obfuscation with some static strings detected by this rule.
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (CommandLine="*powershell.exe*" OR CommandLine="*pwsh.exe*") (CommandLine="*join*split*" OR CommandLine="*( $ShellId[1]+$ShellId[13]+'x')*" OR CommandLine="*( $PSHome[*]+$PSHOME[*]+*" OR CommandLine="*( $env:Public[13]+$env:Public[5]+'x')*" OR CommandLine="*( $env:ComSpec[4,*,25]-Join'')*" OR CommandLine="*[1,3]+'x'-Join'')*"))) | table ComputerName,User,CommandLine | eval sigma_attack_tags="attack.execution attack.t1059.001 attack.defense_evasion attack.t1027.005" | eval sigma_title="CrackMapExec PowerShell Obfuscation" | eval sigma_description="The CrachMapExec pentesting framework implements a PowerShell obfuscation with some static strings detected by this rule."
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Csc.exe Source File Folder - winevent]
description = Detects a suspicious execution of csc.exe, which uses a source in a suspicious folder (e.g. AppData)
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\csc.exe" (Process_Command_Line="*\\AppData\\*" OR Process_Command_Line="*\\Windows\\Temp\\*"))) NOT ((Creator_Process_Name="C:\\Program Files*") OR ((Creator_Process_Name="*\\sdiagnhost.exe" OR Creator_Process_Name="*\\w3wp.exe" OR Creator_Process_Name="*\\choco.exe")) OR (ParentCommandLine="*\\ProgramData\\Microsoft\\Windows Defender Advanced Threat Protection*")))) | eval sigma_attack_tags="attack.defense_evasion attack.t1027.004" | eval sigma_title="Suspicious Csc.exe Source File Folder" | eval sigma_description="Detects a suspicious execution of csc.exe, which uses a source in a suspicious folder (e.g. AppData)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Csc.exe Source File Folder - sysmon]
description = Detects a suspicious execution of csc.exe, which uses a source in a suspicious folder (e.g. AppData)
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\csc.exe" (CommandLine="*\\AppData\\*" OR CommandLine="*\\Windows\\Temp\\*"))) NOT ((ParentImage="C:\\Program Files*") OR ((ParentImage="*\\sdiagnhost.exe" OR ParentImage="*\\w3wp.exe" OR ParentImage="*\\choco.exe")) OR (ParentCommandLine="*\\ProgramData\\Microsoft\\Windows Defender Advanced Threat Protection*")))) | eval sigma_attack_tags="attack.defense_evasion attack.t1027.004" | eval sigma_title="Suspicious Csc.exe Source File Folder" | eval sigma_description="Detects a suspicious execution of csc.exe, which uses a source in a suspicious folder (e.g. AppData)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Parent of Csc.exe - winevent]
description = Detects a suspicious parent of csc.exe, which could by a sign of payload delivery
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\csc.exe" (Creator_Process_Name="*\\wscript.exe" OR Creator_Process_Name="*\\cscript.exe" OR Creator_Process_Name="*\\mshta.exe"))) | eval sigma_attack_tags="attack.execution attack.t1059.005 attack.t1059.007 attack.defense_evasion attack.t1218.005 attack.t1027.004" | eval sigma_title="Suspicious Parent of Csc.exe" | eval sigma_description="Detects a suspicious parent of csc.exe, which could by a sign of payload delivery"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Parent of Csc.exe - sysmon]
description = Detects a suspicious parent of csc.exe, which could by a sign of payload delivery
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\csc.exe" (ParentImage="*\\wscript.exe" OR ParentImage="*\\cscript.exe" OR ParentImage="*\\mshta.exe"))) | eval sigma_attack_tags="attack.execution attack.t1059.005 attack.t1059.007 attack.defense_evasion attack.t1218.005 attack.t1027.004" | eval sigma_title="Suspicious Parent of Csc.exe" | eval sigma_description="Detects a suspicious parent of csc.exe, which could by a sign of payload delivery"
dispatch.earliest_time = -24h@h
alert.track = 0

[Cscript Visual Basic Script Execution - winevent]
description = Adversaries may abuse Visual Basic (VB) for execution
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\cscript.exe" Process_Command_Line="*.vbs*")) | eval sigma_attack_tags="attack.execution attack.t1059.005" | eval sigma_title="Cscript Visual Basic Script Execution" | eval sigma_description="Adversaries may abuse Visual Basic (VB) for execution"
dispatch.earliest_time = -24h@h
alert.track = 0

[Cscript Visual Basic Script Execution - sysmon]
description = Adversaries may abuse Visual Basic (VB) for execution
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\cscript.exe" CommandLine="*.vbs*")) | eval sigma_attack_tags="attack.execution attack.t1059.005" | eval sigma_title="Cscript Visual Basic Script Execution" | eval sigma_description="Adversaries may abuse Visual Basic (VB) for execution"
dispatch.earliest_time = -24h@h
alert.track = 0

[CsExec Remote Execution Tool Usage - winevent]
description = Detects the use of the lesser known remote execution tool named CsExec (a PsExec alternative)
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\csexec.exe" OR Description="csexec"))) | eval sigma_attack_tags="attack.resource_development attack.t1587.001 attack.execution attack.t1569.002" | eval sigma_title="CsExec Remote Execution Tool Usage" | eval sigma_description="Detects the use of the lesser known remote execution tool named CsExec (a PsExec alternative)"
dispatch.earliest_time = -24h@h
alert.track = 0

[CsExec Remote Execution Tool Usage - sysmon]
description = Detects the use of the lesser known remote execution tool named CsExec (a PsExec alternative)
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\csexec.exe" OR Description="csexec"))) | eval sigma_attack_tags="attack.resource_development attack.t1587.001 attack.execution attack.t1569.002" | eval sigma_title="CsExec Remote Execution Tool Usage" | eval sigma_description="Detects the use of the lesser known remote execution tool named CsExec (a PsExec alternative)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Csi.exe Usage - winevent]
description = Csi.exe is a signed binary from Microsoft that comes with Visual Studio and provides C# interactive capabilities. It can be used to run C# code from a file passed as a parameter in command line. Early version of this utility provided with Microsoft “Roslyn” Community Technology Preview was named 'rcsi.exe'
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\csi.exe" OR New_Process_Name="*\\rcsi.exe") OR (OriginalFileName="csi.exe" OR OriginalFileName="rcsi.exe")) Company="Microsoft Corporation")) | table ComputerName,Account_Name,Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.execution attack.t1072 attack.defense_evasion attack.t1218" | eval sigma_title="Suspicious Csi.exe Usage" | eval sigma_description="Csi.exe is a signed binary from Microsoft that comes with Visual Studio and provides C# interactive capabilities. It can be used to run C# code from a file passed as a parameter in command line. Early version of this utility provided with Microsoft “Roslyn” Community Technology Preview was named 'rcsi.exe'"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Csi.exe Usage - sysmon]
description = Csi.exe is a signed binary from Microsoft that comes with Visual Studio and provides C# interactive capabilities. It can be used to run C# code from a file passed as a parameter in command line. Early version of this utility provided with Microsoft “Roslyn” Community Technology Preview was named 'rcsi.exe'
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\csi.exe" OR Image="*\\rcsi.exe") OR (OriginalFileName="csi.exe" OR OriginalFileName="rcsi.exe")) Company="Microsoft Corporation")) | table ComputerName,User,CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.execution attack.t1072 attack.defense_evasion attack.t1218" | eval sigma_title="Suspicious Csi.exe Usage" | eval sigma_description="Csi.exe is a signed binary from Microsoft that comes with Visual Studio and provides C# interactive capabilities. It can be used to run C# code from a file passed as a parameter in command line. Early version of this utility provided with Microsoft “Roslyn” Community Technology Preview was named 'rcsi.exe'"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Curl Usage on Windows - winevent]
description = Detects a suspicious curl process start on Windows and outputs the requested document to a local file
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((New_Process_Name="*\\curl.exe" OR Product="The curl executable") ((Process_Command_Line="*\\AppData\\*" OR Process_Command_Line="*\\Users\\Public\\*" OR Process_Command_Line="*\\Temp\\*" OR Process_Command_Line="*%AppData%*" OR Process_Command_Line="*%Temp%*" OR Process_Command_Line="*%tmp%*" OR Process_Command_Line="*%Public%*" OR Process_Command_Line="*\\Desktop\\*" OR Process_Command_Line="*C:\\PerfLogs\\*") OR (Process_Command_Line="*.jpg" OR Process_Command_Line="*.jpeg" OR Process_Command_Line="*.png" OR Process_Command_Line="*.gif" OR Process_Command_Line="*.tmp" OR Process_Command_Line="*.temp" OR Process_Command_Line="*.txt") OR (Process_Command_Line="* -O*" OR Process_Command_Line="*--remote-name*" OR Process_Command_Line="*--output*")))) NOT (((Creator_Process_Name="C:\\Program Files\\Git\\usr\\bin\\sh.exe" New_Process_Name="C:\\Program Files\\Git\\mingw64\\bin\\curl.exe" (Process_Command_Line="*--silent --show-error --output *" Process_Command_Line="*gfw-httpget-*")))))) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.command_and_control attack.t1105" | eval sigma_title="Suspicious Curl Usage on Windows" | eval sigma_description="Detects a suspicious curl process start on Windows and outputs the requested document to a local file"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Curl Usage on Windows - sysmon]
description = Detects a suspicious curl process start on Windows and outputs the requested document to a local file
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((Image="*\\curl.exe" OR Product="The curl executable") ((CommandLine="*\\AppData\\*" OR CommandLine="*\\Users\\Public\\*" OR CommandLine="*\\Temp\\*" OR CommandLine="*%AppData%*" OR CommandLine="*%Temp%*" OR CommandLine="*%tmp%*" OR CommandLine="*%Public%*" OR CommandLine="*\\Desktop\\*" OR CommandLine="*C:\\PerfLogs\\*") OR (CommandLine="*.jpg" OR CommandLine="*.jpeg" OR CommandLine="*.png" OR CommandLine="*.gif" OR CommandLine="*.tmp" OR CommandLine="*.temp" OR CommandLine="*.txt") OR (CommandLine="* -O*" OR CommandLine="*--remote-name*" OR CommandLine="*--output*")))) NOT (((ParentImage="C:\\Program Files\\Git\\usr\\bin\\sh.exe" Image="C:\\Program Files\\Git\\mingw64\\bin\\curl.exe" (CommandLine="*--silent --show-error --output *" CommandLine="*gfw-httpget-*")))))) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.command_and_control attack.t1105" | eval sigma_title="Suspicious Curl Usage on Windows" | eval sigma_description="Detects a suspicious curl process start on Windows and outputs the requested document to a local file"
dispatch.earliest_time = -24h@h
alert.track = 0

[Curl Start Combination - winevent]
description = Adversaries can use curl to download payloads remotely and execute them. Curl is included by default in Windows 10 build 17063 and later.
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="* /c *" Process_Command_Line="*curl *" Process_Command_Line="*http*" Process_Command_Line="*-o*" Process_Command_Line="*&*")) | table Creator_Process_Name,Process_Command_Line | eval sigma_attack_tags="attack.execution attack.t1218 attack.command_and_control attack.t1105" | eval sigma_title="Curl Start Combination" | eval sigma_description="Adversaries can use curl to download payloads remotely and execute them. Curl is included by default in Windows 10 build 17063 and later."
dispatch.earliest_time = -24h@h
alert.track = 0

[Curl Start Combination - sysmon]
description = Adversaries can use curl to download payloads remotely and execute them. Curl is included by default in Windows 10 build 17063 and later.
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="* /c *" CommandLine="*curl *" CommandLine="*http*" CommandLine="*-o*" CommandLine="*&*")) | table ParentImage,CommandLine | eval sigma_attack_tags="attack.execution attack.t1218 attack.command_and_control attack.t1105" | eval sigma_title="Curl Start Combination" | eval sigma_description="Adversaries can use curl to download payloads remotely and execute them. Curl is included by default in Windows 10 build 17063 and later."
dispatch.earliest_time = -24h@h
alert.track = 0

[ZOHO Dctask64 Process Injection - winevent]
description = Detects suspicious process injection using ZOHO's dctask64.exe
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) New_Process_Name="*\\dctask64.exe" NOT ((Process_Command_Line="*DesktopCentral_Agent\\agent*")))) | table Process_Command_Line,ParentCommandLine,Creator_Process_Name | eval sigma_attack_tags="attack.defense_evasion attack.t1055.001" | eval sigma_title="ZOHO Dctask64 Process Injection" | eval sigma_description="Detects suspicious process injection using ZOHO's dctask64.exe"
dispatch.earliest_time = -24h@h
alert.track = 0

[ZOHO Dctask64 Process Injection - sysmon]
description = Detects suspicious process injection using ZOHO's dctask64.exe
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) Image="*\\dctask64.exe" NOT ((CommandLine="*DesktopCentral_Agent\\agent*")))) | table CommandLine,ParentCommandLine,ParentImage | eval sigma_attack_tags="attack.defense_evasion attack.t1055.001" | eval sigma_title="ZOHO Dctask64 Process Injection" | eval sigma_description="Detects suspicious process injection using ZOHO's dctask64.exe"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Del in CommandLine - winevent]
description = Detects suspicious command line to remove and 'exe' or 'dll'
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((Process_Command_Line="*del *" Process_Command_Line="*\*.exe*" Process_Command_Line="*/f *" Process_Command_Line="*/q *")) OR ((Process_Command_Line="*del *" Process_Command_Line="*\*.dll*" Process_Command_Line="*C:\\ProgramData\\*"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1070.004" | eval sigma_title="Suspicious Del in CommandLine" | eval sigma_description="Detects suspicious command line to remove and 'exe' or 'dll'"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Del in CommandLine - sysmon]
description = Detects suspicious command line to remove and 'exe' or 'dll'
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((CommandLine="*del *" CommandLine="*\*.exe*" CommandLine="*/f *" CommandLine="*/q *")) OR ((CommandLine="*del *" CommandLine="*\*.dll*" CommandLine="*C:\\ProgramData\\*"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1070.004" | eval sigma_title="Suspicious Del in CommandLine" | eval sigma_description="Detects suspicious command line to remove and 'exe' or 'dll'"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Desktopimgdownldr Command - winevent]
description = Detects a suspicious Microsoft desktopimgdownldr execution with parameters used to download files from the Internet
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((Process_Command_Line="* /lockscreenurl:*" NOT (((Process_Command_Line="*.jpg*" OR Process_Command_Line="*.jpeg*" OR Process_Command_Line="*.png*"))))) OR ((Process_Command_Line="*reg delete*" Process_Command_Line="*\\PersonalizationCSP*"))))) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.command_and_control attack.t1105" | eval sigma_title="Suspicious Desktopimgdownldr Command" | eval sigma_description="Detects a suspicious Microsoft desktopimgdownldr execution with parameters used to download files from the Internet"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Desktopimgdownldr Command - sysmon]
description = Detects a suspicious Microsoft desktopimgdownldr execution with parameters used to download files from the Internet
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((CommandLine="* /lockscreenurl:*" NOT (((CommandLine="*.jpg*" OR CommandLine="*.jpeg*" OR CommandLine="*.png*"))))) OR ((CommandLine="*reg delete*" CommandLine="*\\PersonalizationCSP*"))))) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.command_and_control attack.t1105" | eval sigma_title="Suspicious Desktopimgdownldr Command" | eval sigma_description="Detects a suspicious Microsoft desktopimgdownldr execution with parameters used to download files from the Internet"
dispatch.earliest_time = -24h@h
alert.track = 0

[DevInit Lolbin Download - winevent]
description = Detects a certain command line flag combination used by devinit.exe lolbin to download arbitrary MSI packages on a Windows system
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="* -t msi-install *" Process_Command_Line="* -i http*")) | eval sigma_attack_tags="attack.execution attack.defense_evasion attack.t1218" | eval sigma_title="DevInit Lolbin Download" | eval sigma_description="Detects a certain command line flag combination used by devinit.exe lolbin to download arbitrary MSI packages on a Windows system"
dispatch.earliest_time = -24h@h
alert.track = 0

[DevInit Lolbin Download - sysmon]
description = Detects a certain command line flag combination used by devinit.exe lolbin to download arbitrary MSI packages on a Windows system
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="* -t msi-install *" CommandLine="* -i http*")) | eval sigma_attack_tags="attack.execution attack.defense_evasion attack.t1218" | eval sigma_title="DevInit Lolbin Download" | eval sigma_description="Detects a certain command line flag combination used by devinit.exe lolbin to download arbitrary MSI packages on a Windows system"
dispatch.earliest_time = -24h@h
alert.track = 0

[Devtoolslauncher.exe Executes Specified Binary - winevent]
description = The Devtoolslauncher.exe executes other binary
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\devtoolslauncher.exe" Process_Command_Line="*LaunchForDeploy*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1218" | eval sigma_title="Devtoolslauncher.exe Executes Specified Binary" | eval sigma_description="The Devtoolslauncher.exe executes other binary"
dispatch.earliest_time = -24h@h
alert.track = 0

[Devtoolslauncher.exe Executes Specified Binary - sysmon]
description = The Devtoolslauncher.exe executes other binary
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\devtoolslauncher.exe" CommandLine="*LaunchForDeploy*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1218" | eval sigma_title="Devtoolslauncher.exe Executes Specified Binary" | eval sigma_description="The Devtoolslauncher.exe executes other binary"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious DIR Execution - winevent]
description = Detects usage of the 'dir' command that's part of windows batch/cmd to collect information about directories
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*dir *" Process_Command_Line="* /s*" Process_Command_Line="* /b*")) | eval sigma_attack_tags="attack.discovery attack.t1217" | eval sigma_title="Suspicious DIR Execution" | eval sigma_description="Detects usage of the 'dir' command that's part of windows batch/cmd to collect information about directories"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious DIR Execution - sysmon]
description = Detects usage of the 'dir' command that's part of windows batch/cmd to collect information about directories
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*dir *" CommandLine="* /s*" CommandLine="* /b*")) | eval sigma_attack_tags="attack.discovery attack.t1217" | eval sigma_title="Suspicious DIR Execution" | eval sigma_description="Detects usage of the 'dir' command that's part of windows batch/cmd to collect information about directories"
dispatch.earliest_time = -24h@h
alert.track = 0

[Direct Autorun Keys Modification - winevent]
description = Detects direct modification of autostart extensibility point (ASEP) in registry using reg.exe.
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\reg.exe" Process_Command_Line="*add*" (Process_Command_Line="*\\software\\Microsoft\\Windows\\CurrentVersion\\Run*" OR Process_Command_Line="*\\software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\Userinit*" OR Process_Command_Line="*\\software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\Shell*" OR Process_Command_Line="*\\software\\Microsoft\\Windows NT\\CurrentVersion\\Windows*" OR Process_Command_Line="*\\software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\User Shell Folders*" OR Process_Command_Line="*\\system\\CurrentControlSet\\Control\\SafeBoot\\AlternateShell*"))) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.persistence attack.t1547.001" | eval sigma_title="Direct Autorun Keys Modification" | eval sigma_description="Detects direct modification of autostart extensibility point (ASEP) in registry using reg.exe."
dispatch.earliest_time = -24h@h
alert.track = 0

[Direct Autorun Keys Modification - sysmon]
description = Detects direct modification of autostart extensibility point (ASEP) in registry using reg.exe.
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\reg.exe" CommandLine="*add*" (CommandLine="*\\software\\Microsoft\\Windows\\CurrentVersion\\Run*" OR CommandLine="*\\software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\Userinit*" OR CommandLine="*\\software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\Shell*" OR CommandLine="*\\software\\Microsoft\\Windows NT\\CurrentVersion\\Windows*" OR CommandLine="*\\software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\User Shell Folders*" OR CommandLine="*\\system\\CurrentControlSet\\Control\\SafeBoot\\AlternateShell*"))) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.persistence attack.t1547.001" | eval sigma_title="Direct Autorun Keys Modification" | eval sigma_description="Detects direct modification of autostart extensibility point (ASEP) in registry using reg.exe."
dispatch.earliest_time = -24h@h
alert.track = 0

[Disable or Delete Windows Eventlog - winevent]
description = Detects command that is used to disable or delete Windows eventlog via logman Windows utility
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*logman *" (Process_Command_Line="*stop *" OR Process_Command_Line="*delete *") Process_Command_Line="*EventLog-System*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.001 attack.t1070.001" | eval sigma_title="Disable or Delete Windows Eventlog" | eval sigma_description="Detects command that is used to disable or delete Windows eventlog via logman Windows utility"
dispatch.earliest_time = -24h@h
alert.track = 0

[Disable or Delete Windows Eventlog - sysmon]
description = Detects command that is used to disable or delete Windows eventlog via logman Windows utility
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*logman *" (CommandLine="*stop *" OR CommandLine="*delete *") CommandLine="*EventLog-System*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.001 attack.t1070.001" | eval sigma_title="Disable or Delete Windows Eventlog" | eval sigma_description="Detects command that is used to disable or delete Windows eventlog via logman Windows utility"
dispatch.earliest_time = -24h@h
alert.track = 0

[Disabled IE Security Features - winevent]
description = Detects command lines that indicate unwanted modifications to registry keys that disable important Internet Explorer security features
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((Process_Command_Line="* -name IEHarden *" Process_Command_Line="* -value 0 *")) OR ((Process_Command_Line="* -name DEPOff *" Process_Command_Line="* -value 1 *")) OR ((Process_Command_Line="* -name DisableFirstRunCustomize *" Process_Command_Line="* -value 2 *"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.001" | eval sigma_title="Disabled IE Security Features" | eval sigma_description="Detects command lines that indicate unwanted modifications to registry keys that disable important Internet Explorer security features"
dispatch.earliest_time = -24h@h
alert.track = 0

[Disabled IE Security Features - sysmon]
description = Detects command lines that indicate unwanted modifications to registry keys that disable important Internet Explorer security features
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((CommandLine="* -name IEHarden *" CommandLine="* -value 0 *")) OR ((CommandLine="* -name DEPOff *" CommandLine="* -value 1 *")) OR ((CommandLine="* -name DisableFirstRunCustomize *" CommandLine="* -value 2 *"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.001" | eval sigma_title="Disabled IE Security Features" | eval sigma_description="Detects command lines that indicate unwanted modifications to registry keys that disable important Internet Explorer security features"
dispatch.earliest_time = -24h@h
alert.track = 0

[Raccine Uninstall - winevent]
description = Detects commands that indicate a Raccine removal from an end system. Raccine is a free ransomware protection tool.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((Process_Command_Line="*taskkill *" Process_Command_Line="*RaccineSettings.exe*")) OR ((Process_Command_Line="*reg.exe*" Process_Command_Line="*delete*" Process_Command_Line="*Raccine Tray*")) OR ((Process_Command_Line="*schtasks*" Process_Command_Line="*/DELETE*" Process_Command_Line="*Raccine Rules Updater*"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.001" | eval sigma_title="Raccine Uninstall" | eval sigma_description="Detects commands that indicate a Raccine removal from an end system. Raccine is a free ransomware protection tool."
dispatch.earliest_time = -24h@h
alert.track = 0

[Raccine Uninstall - sysmon]
description = Detects commands that indicate a Raccine removal from an end system. Raccine is a free ransomware protection tool.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((CommandLine="*taskkill *" CommandLine="*RaccineSettings.exe*")) OR ((CommandLine="*reg.exe*" CommandLine="*delete*" CommandLine="*Raccine Tray*")) OR ((CommandLine="*schtasks*" CommandLine="*/DELETE*" CommandLine="*Raccine Rules Updater*"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.001" | eval sigma_title="Raccine Uninstall" | eval sigma_description="Detects commands that indicate a Raccine removal from an end system. Raccine is a free ransomware protection tool."
dispatch.earliest_time = -24h@h
alert.track = 0

[Execution via Diskshadow.exe - winevent]
description = Detects using Diskshadow.exe to execute arbitrary code in text file
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\diskshadow.exe" (Process_Command_Line="*/s*" OR Process_Command_Line="*-s*"))) | table Process_Command_Line | eval sigma_attack_tags="attack.execution attack.t1218" | eval sigma_title="Execution via Diskshadow.exe" | eval sigma_description="Detects using Diskshadow.exe to execute arbitrary code in text file"
dispatch.earliest_time = -24h@h
alert.track = 0

[Execution via Diskshadow.exe - sysmon]
description = Detects using Diskshadow.exe to execute arbitrary code in text file
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\diskshadow.exe" (CommandLine="*/s*" OR CommandLine="*-s*"))) | table CommandLine | eval sigma_attack_tags="attack.execution attack.t1218" | eval sigma_title="Execution via Diskshadow.exe" | eval sigma_description="Detects using Diskshadow.exe to execute arbitrary code in text file"
dispatch.earliest_time = -24h@h
alert.track = 0

[DIT Snapshot Viewer Use - winevent]
description = Detects the use of Ditsnap tool. Seems to be a tool for ransomware groups.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\ditsnap.exe" OR Process_Command_Line="*ditsnap.exe*"))) | eval sigma_attack_tags="attack.credential_access attack.t1003.003" | eval sigma_title="DIT Snapshot Viewer Use" | eval sigma_description="Detects the use of Ditsnap tool. Seems to be a tool for ransomware groups."
dispatch.earliest_time = -24h@h
alert.track = 0

[DIT Snapshot Viewer Use - sysmon]
description = Detects the use of Ditsnap tool. Seems to be a tool for ransomware groups.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\ditsnap.exe" OR CommandLine="*ditsnap.exe*"))) | eval sigma_attack_tags="attack.credential_access attack.t1003.003" | eval sigma_title="DIT Snapshot Viewer Use" | eval sigma_description="Detects the use of Ditsnap tool. Seems to be a tool for ransomware groups."
dispatch.earliest_time = -24h@h
alert.track = 0

[Dllhost Process With No CommandLine - winevent]
description = Detects a 'dllhost' spawning with no commandline arguments which is a very rare thing to happen and could indicate process injection activity or malware mimicking similar system processes
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*dllhost.exe" New_Process_Name="*\\dllhost.exe")) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.t1055" | eval sigma_title="Dllhost Process With No CommandLine" | eval sigma_description="Detects a 'dllhost' spawning with no commandline arguments which is a very rare thing to happen and could indicate process injection activity or malware mimicking similar system processes"
dispatch.earliest_time = -24h@h
alert.track = 0

[Dllhost Process With No CommandLine - sysmon]
description = Detects a 'dllhost' spawning with no commandline arguments which is a very rare thing to happen and could indicate process injection activity or malware mimicking similar system processes
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*dllhost.exe" Image="*\\dllhost.exe")) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.t1055" | eval sigma_title="Dllhost Process With No CommandLine" | eval sigma_description="Detects a 'dllhost' spawning with no commandline arguments which is a very rare thing to happen and could indicate process injection activity or malware mimicking similar system processes"
dispatch.earliest_time = -24h@h
alert.track = 0

[Application Whitelisting Bypass via Dnx.exe - winevent]
description = Execute C# code located in the consoleapp folder
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\dnx.exe")) | eval sigma_attack_tags="attack.defense_evasion attack.t1218 attack.t1027.004" | eval sigma_title="Application Whitelisting Bypass via Dnx.exe" | eval sigma_description="Execute C# code located in the consoleapp folder"
dispatch.earliest_time = -24h@h
alert.track = 0

[Application Whitelisting Bypass via Dnx.exe - sysmon]
description = Execute C# code located in the consoleapp folder
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\dnx.exe")) | eval sigma_attack_tags="attack.defense_evasion attack.t1218 attack.t1027.004" | eval sigma_title="Application Whitelisting Bypass via Dnx.exe" | eval sigma_description="Execute C# code located in the consoleapp folder"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Double Extension - winevent]
description = Detects suspicious use of an .exe extension after a non-executable file extension like .pdf.exe, a set of spaces or underlines to cloak the executable file in spear phishing campaigns
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (New_Process_Name="*.doc.exe" OR New_Process_Name="*.docx.exe" OR New_Process_Name="*.xls.exe" OR New_Process_Name="*.xlsx.exe" OR New_Process_Name="*.ppt.exe" OR New_Process_Name="*.pptx.exe" OR New_Process_Name="*.rtf.exe" OR New_Process_Name="*.pdf.exe" OR New_Process_Name="*.txt.exe" OR New_Process_Name="*      .exe" OR New_Process_Name="*______.exe"))) | eval sigma_attack_tags="attack.initial_access attack.t1566.001" | eval sigma_title="Suspicious Double Extension" | eval sigma_description="Detects suspicious use of an .exe extension after a non-executable file extension like .pdf.exe, a set of spaces or underlines to cloak the executable file in spear phishing campaigns"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Double Extension - sysmon]
description = Detects suspicious use of an .exe extension after a non-executable file extension like .pdf.exe, a set of spaces or underlines to cloak the executable file in spear phishing campaigns
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (Image="*.doc.exe" OR Image="*.docx.exe" OR Image="*.xls.exe" OR Image="*.xlsx.exe" OR Image="*.ppt.exe" OR Image="*.pptx.exe" OR Image="*.rtf.exe" OR Image="*.pdf.exe" OR Image="*.txt.exe" OR Image="*      .exe" OR Image="*______.exe"))) | eval sigma_attack_tags="attack.initial_access attack.t1566.001" | eval sigma_title="Suspicious Double Extension" | eval sigma_description="Detects suspicious use of an .exe extension after a non-executable file extension like .pdf.exe, a set of spaces or underlines to cloak the executable file in spear phishing campaigns"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Download from Office Domain - winevent]
description = Detects suspicious ways to download files from Microsoft domains that are used to store attachments in Emails or OneNote documents
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\curl.exe" OR New_Process_Name="*\\wget.exe") OR (Process_Command_Line="*Invoke-WebRequest*" OR Process_Command_Line="*iwr *" OR Process_Command_Line="*curl *" OR Process_Command_Line="*wget *" OR Process_Command_Line="*Start-BitsTransfer*" OR Process_Command_Line="*.DownloadFile(*" OR Process_Command_Line="*.DownloadString(*")) (Process_Command_Line="*https://attachment.outlook.live.net/owa/*" OR Process_Command_Line="*https://onenoteonlinesync.onenote.com/onenoteonlinesync/*"))) | eval sigma_attack_tags="" | eval sigma_title="Suspicious Download from Office Domain" | eval sigma_description="Detects suspicious ways to download files from Microsoft domains that are used to store attachments in Emails or OneNote documents"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Download from Office Domain - sysmon]
description = Detects suspicious ways to download files from Microsoft domains that are used to store attachments in Emails or OneNote documents
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\curl.exe" OR Image="*\\wget.exe") OR (CommandLine="*Invoke-WebRequest*" OR CommandLine="*iwr *" OR CommandLine="*curl *" OR CommandLine="*wget *" OR CommandLine="*Start-BitsTransfer*" OR CommandLine="*.DownloadFile(*" OR CommandLine="*.DownloadString(*")) (CommandLine="*https://attachment.outlook.live.net/owa/*" OR CommandLine="*https://onenoteonlinesync.onenote.com/onenoteonlinesync/*"))) | eval sigma_attack_tags="" | eval sigma_title="Suspicious Download from Office Domain" | eval sigma_description="Detects suspicious ways to download files from Microsoft domains that are used to store attachments in Emails or OneNote documents"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Kernel Dump Using Dtrace - winevent]
description = Detects suspicious way to dump the kernel on Windows systems using dtrace.exe, which is available on Windows systems since Windows 10 19H1
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((New_Process_Name="*\\dtrace.exe" Process_Command_Line="*lkd(0)*")) OR ((Process_Command_Line="*syscall:::return*" Process_Command_Line="*lkd(*"))))) | eval sigma_attack_tags="" | eval sigma_title="Suspicious Kernel Dump Using Dtrace" | eval sigma_description="Detects suspicious way to dump the kernel on Windows systems using dtrace.exe, which is available on Windows systems since Windows 10 19H1"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Kernel Dump Using Dtrace - sysmon]
description = Detects suspicious way to dump the kernel on Windows systems using dtrace.exe, which is available on Windows systems since Windows 10 19H1
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((Image="*\\dtrace.exe" CommandLine="*lkd(0)*")) OR ((CommandLine="*syscall:::return*" CommandLine="*lkd(*"))))) | eval sigma_attack_tags="" | eval sigma_title="Suspicious Kernel Dump Using Dtrace" | eval sigma_description="Detects suspicious way to dump the kernel on Windows systems using dtrace.exe, which is available on Windows systems since Windows 10 19H1"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Electron Application Child Processes - winevent]
description = Detects suspicious child processes of electron apps (teams, discord, slack...).
This could be a potential sign of '.asar' file tampering (See reference section for more information)

search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((Creator_Process_Name="*\\Teams.exe" OR Creator_Process_Name="*\\slack.exe" OR Creator_Process_Name="*\\discord.exe") (New_Process_Name="*\\cmd.exe" OR New_Process_Name="*\\powershell.exe" OR New_Process_Name="*\\pwsh.exe" OR New_Process_Name="*\\cscript.exe" OR New_Process_Name="*\\wscript.exe" OR New_Process_Name="*\\mshta.exe"))) NOT ((Creator_Process_Name="*\\Discord.exe" Process_Command_Line="*\\NVSMI\\nvidia-smi.exe*")))) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.execution" | eval sigma_title="Suspicious Electron Application Child Processes" | eval sigma_description="Detects suspicious child processes of electron apps (teams, discord, slack...).
This could be a potential sign of '.asar' file tampering (See reference section for more information)
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Electron Application Child Processes - sysmon]
description = Detects suspicious child processes of electron apps (teams, discord, slack...).
This could be a potential sign of '.asar' file tampering (See reference section for more information)

search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((ParentImage="*\\Teams.exe" OR ParentImage="*\\slack.exe" OR ParentImage="*\\discord.exe") (Image="*\\cmd.exe" OR Image="*\\powershell.exe" OR Image="*\\pwsh.exe" OR Image="*\\cscript.exe" OR Image="*\\wscript.exe" OR Image="*\\mshta.exe"))) NOT ((ParentImage="*\\Discord.exe" CommandLine="*\\NVSMI\\nvidia-smi.exe*")))) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.execution" | eval sigma_title="Suspicious Electron Application Child Processes" | eval sigma_description="Detects suspicious child processes of electron apps (teams, discord, slack...).
This could be a potential sign of '.asar' file tampering (See reference section for more information)
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Emotet RunDLL32 Process Creation - winevent]
description = Detecting Emotet DLL loading by looking for rundll32.exe processes with command lines ending in ,RunDLL or ,Control_RunDLL
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((((New_Process_Name="*\\rundll32.exe" (Process_Command_Line="*,RunDLL" OR Process_Command_Line="*,Control_RunDLL"))) NOT ((Creator_Process_Name="*\\tracker.exe")))) NOT (((Process_Command_Line="*.dll,Control_RunDLL" OR Process_Command_Line="*.dll\",Control_RunDLL" OR Process_Command_Line="*.dll',Control_RunDLL"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218.011" | eval sigma_title="Emotet RunDLL32 Process Creation" | eval sigma_description="Detecting Emotet DLL loading by looking for rundll32.exe processes with command lines ending in ,RunDLL or ,Control_RunDLL"
dispatch.earliest_time = -24h@h
alert.track = 0

[Emotet RunDLL32 Process Creation - sysmon]
description = Detecting Emotet DLL loading by looking for rundll32.exe processes with command lines ending in ,RunDLL or ,Control_RunDLL
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((((Image="*\\rundll32.exe" (CommandLine="*,RunDLL" OR CommandLine="*,Control_RunDLL"))) NOT ((ParentImage="*\\tracker.exe")))) NOT (((CommandLine="*.dll,Control_RunDLL" OR CommandLine="*.dll\",Control_RunDLL" OR CommandLine="*.dll',Control_RunDLL"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218.011" | eval sigma_title="Emotet RunDLL32 Process Creation" | eval sigma_description="Detecting Emotet DLL loading by looking for rundll32.exe processes with command lines ending in ,RunDLL or ,Control_RunDLL"
dispatch.earliest_time = -24h@h
alert.track = 0

[Esentutl Gather Credentials - winevent]
description = Conti recommendation to its affiliates to use esentutl to access NTDS dumped file. Trickbot also uses this utilities to get MSEdge info via its module pwgrab.
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*esentutl*" Process_Command_Line="* /p*")) | table Account_Name,Process_Command_Line,ParentCommandLine,CurrentDirectory | eval sigma_attack_tags="attack.credential_access attack.t1003 attack.t1003.003" | eval sigma_title="Esentutl Gather Credentials" | eval sigma_description="Conti recommendation to its affiliates to use esentutl to access NTDS dumped file. Trickbot also uses this utilities to get MSEdge info via its module pwgrab."
dispatch.earliest_time = -24h@h
alert.track = 0

[Esentutl Gather Credentials - sysmon]
description = Conti recommendation to its affiliates to use esentutl to access NTDS dumped file. Trickbot also uses this utilities to get MSEdge info via its module pwgrab.
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*esentutl*" CommandLine="* /p*")) | table User,CommandLine,ParentCommandLine,CurrentDirectory | eval sigma_attack_tags="attack.credential_access attack.t1003 attack.t1003.003" | eval sigma_title="Esentutl Gather Credentials" | eval sigma_description="Conti recommendation to its affiliates to use esentutl to access NTDS dumped file. Trickbot also uses this utilities to get MSEdge info via its module pwgrab."
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Eventlog Clear or Configuration Change - winevent]
description = Detects clearing or configuration of eventlogs using wevtutil, powershell and wmic. Might be used by ransomwares during the attack (seen by NotPetya and others).
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((New_Process_Name="*\\wevtutil.exe" (Process_Command_Line="*clear-log *" OR Process_Command_Line="* cl *" OR Process_Command_Line="*set-log *" OR Process_Command_Line="* sl *" OR Process_Command_Line="*lfn:*"))) OR (((New_Process_Name="*\\powershell.exe" OR New_Process_Name="*\\pwsh.exe") (Process_Command_Line="*Clear-EventLog *" OR Process_Command_Line="*Remove-EventLog *" OR Process_Command_Line="*Limit-EventLog *" OR Process_Command_Line="*Clear-WinEvent *"))) OR ((New_Process_Name="*\\wmic.exe" Process_Command_Line="* ClearEventLog *"))) NOT ((((Creator_Process_Name="C:\\Windows\\SysWOW64\\msiexec.exe" OR Creator_Process_Name="C:\\Windows\\System32\\msiexec.exe") Process_Command_Line="* sl *"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1070.001 attack.t1562.002 car.2016-04-002" | eval sigma_title="Suspicious Eventlog Clear or Configuration Change" | eval sigma_description="Detects clearing or configuration of eventlogs using wevtutil, powershell and wmic. Might be used by ransomwares during the attack (seen by NotPetya and others)."
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Eventlog Clear or Configuration Change - sysmon]
description = Detects clearing or configuration of eventlogs using wevtutil, powershell and wmic. Might be used by ransomwares during the attack (seen by NotPetya and others).
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((Image="*\\wevtutil.exe" (CommandLine="*clear-log *" OR CommandLine="* cl *" OR CommandLine="*set-log *" OR CommandLine="* sl *" OR CommandLine="*lfn:*"))) OR (((Image="*\\powershell.exe" OR Image="*\\pwsh.exe") (CommandLine="*Clear-EventLog *" OR CommandLine="*Remove-EventLog *" OR CommandLine="*Limit-EventLog *" OR CommandLine="*Clear-WinEvent *"))) OR ((Image="*\\wmic.exe" CommandLine="* ClearEventLog *"))) NOT ((((ParentImage="C:\\Windows\\SysWOW64\\msiexec.exe" OR ParentImage="C:\\Windows\\System32\\msiexec.exe") CommandLine="* sl *"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1070.001 attack.t1562.002 car.2016-04-002" | eval sigma_title="Suspicious Eventlog Clear or Configuration Change" | eval sigma_description="Detects clearing or configuration of eventlogs using wevtutil, powershell and wmic. Might be used by ransomwares during the attack (seen by NotPetya and others)."
dispatch.earliest_time = -24h@h
alert.track = 0

[Execution in Webserver Root Folder - winevent]
description = Detects a suspicious program execution in a web service root folder (filter out false positives)
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\wwwroot\\*" OR New_Process_Name="*\\wmpub\\*" OR New_Process_Name="*\\htdocs\\*") NOT (((New_Process_Name="*bin\\*" OR New_Process_Name="*\\Tools\\*" OR New_Process_Name="*\\SMSComponent\\*") Creator_Process_Name="*\\services.exe")))) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.persistence attack.t1505.003" | eval sigma_title="Execution in Webserver Root Folder" | eval sigma_description="Detects a suspicious program execution in a web service root folder (filter out false positives)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Execution in Webserver Root Folder - sysmon]
description = Detects a suspicious program execution in a web service root folder (filter out false positives)
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\wwwroot\\*" OR Image="*\\wmpub\\*" OR Image="*\\htdocs\\*") NOT (((Image="*bin\\*" OR Image="*\\Tools\\*" OR Image="*\\SMSComponent\\*") ParentImage="*\\services.exe")))) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.persistence attack.t1505.003" | eval sigma_title="Execution in Webserver Root Folder" | eval sigma_description="Detects a suspicious program execution in a web service root folder (filter out false positives)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Execution from Suspicious Folder - winevent]
description = Detects a suspicious execution from an uncommon folder
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\$Recycle.bin\\*" OR New_Process_Name="*\\config\\systemprofile\\*" OR New_Process_Name="*\\Intel\\Logs\\*" OR New_Process_Name="*\\RSA\\MachineKeys\\*" OR New_Process_Name="*\\Users\\All Users\\*" OR New_Process_Name="*\\Users\\Default\\*" OR New_Process_Name="*\\Users\\NetworkService\\*" OR New_Process_Name="*\\Users\\Public\\*" OR New_Process_Name="*\\Windows\\addins\\*" OR New_Process_Name="*\\Windows\\debug\\*" OR New_Process_Name="*\\Windows\\Fonts\\*" OR New_Process_Name="*\\Windows\\Help\\*" OR New_Process_Name="*\\Windows\\IME\\*" OR New_Process_Name="*\\Windows\\Media\\*" OR New_Process_Name="*\\Windows\\repair\\*" OR New_Process_Name="*\\Windows\\security\\*" OR New_Process_Name="*\\Windows\\System32\\Tasks\\*" OR New_Process_Name="*\\Windows\\Tasks\\*") OR New_Process_Name="C:\\Perflogs\\*") NOT (((New_Process_Name="C:\\Users\\Public\\IBM\\ClientSolutions\\Start_Programs\\*")) OR ((New_Process_Name="C:\\Windows\\SysWOW64\\config\\systemprofile\\Citrix\\UpdaterBinaries\\*" New_Process_Name="*\\CitrixReceiverUpdater.exe"))))) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.t1036" | eval sigma_title="Execution from Suspicious Folder" | eval sigma_description="Detects a suspicious execution from an uncommon folder"
dispatch.earliest_time = -24h@h
alert.track = 0

[Execution from Suspicious Folder - sysmon]
description = Detects a suspicious execution from an uncommon folder
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\$Recycle.bin\\*" OR Image="*\\config\\systemprofile\\*" OR Image="*\\Intel\\Logs\\*" OR Image="*\\RSA\\MachineKeys\\*" OR Image="*\\Users\\All Users\\*" OR Image="*\\Users\\Default\\*" OR Image="*\\Users\\NetworkService\\*" OR Image="*\\Users\\Public\\*" OR Image="*\\Windows\\addins\\*" OR Image="*\\Windows\\debug\\*" OR Image="*\\Windows\\Fonts\\*" OR Image="*\\Windows\\Help\\*" OR Image="*\\Windows\\IME\\*" OR Image="*\\Windows\\Media\\*" OR Image="*\\Windows\\repair\\*" OR Image="*\\Windows\\security\\*" OR Image="*\\Windows\\System32\\Tasks\\*" OR Image="*\\Windows\\Tasks\\*") OR Image="C:\\Perflogs\\*") NOT (((Image="C:\\Users\\Public\\IBM\\ClientSolutions\\Start_Programs\\*")) OR ((Image="C:\\Windows\\SysWOW64\\config\\systemprofile\\Citrix\\UpdaterBinaries\\*" Image="*\\CitrixReceiverUpdater.exe"))))) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.t1036" | eval sigma_title="Execution from Suspicious Folder" | eval sigma_description="Detects a suspicious execution from an uncommon folder"
dispatch.earliest_time = -24h@h
alert.track = 0

[Explorer Process Tree Break - winevent]
description = Detects a command line process that uses explorer.exe to launch arbitrary commands or binaries,
which is similar to cmd.exe /c, only it breaks the process tree and makes its parent a new instance of explorer spawning from 'svchost'

search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (Process_Command_Line="*/factory,{75dff2b7-6936-4c06-a8bb-676a7b00b24b}*" OR ((Process_Command_Line="*explorer.exe*" Process_Command_Line="* /root,*"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1036" | eval sigma_title="Explorer Process Tree Break" | eval sigma_description="Detects a command line process that uses explorer.exe to launch arbitrary commands or binaries,
which is similar to cmd.exe /c, only it breaks the process tree and makes its parent a new instance of explorer spawning from 'svchost'
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Explorer Process Tree Break - sysmon]
description = Detects a command line process that uses explorer.exe to launch arbitrary commands or binaries,
which is similar to cmd.exe /c, only it breaks the process tree and makes its parent a new instance of explorer spawning from 'svchost'

search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (CommandLine="*/factory,{75dff2b7-6936-4c06-a8bb-676a7b00b24b}*" OR ((CommandLine="*explorer.exe*" CommandLine="* /root,*"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1036" | eval sigma_title="Explorer Process Tree Break" | eval sigma_description="Detects a command line process that uses explorer.exe to launch arbitrary commands or binaries,
which is similar to cmd.exe /c, only it breaks the process tree and makes its parent a new instance of explorer spawning from 'svchost'
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Explorer NOUACCHECK Flag - winevent]
description = Detects suspicious starts of explorer.exe that use the /NOUACCHECK flag that allows to run all sub processes of that newly started explorer.exe without any UAC checks
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\explorer.exe" Process_Command_Line="*/NOUACCHECK*")) NOT (((ParentCommandLine="C:\\Windows\\system32\\svchost.exe -k netsvcs -p -s Schedule") OR (Creator_Process_Name="C:\\Windows\\System32\\svchost.exe"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1548.002" | eval sigma_title="Explorer NOUACCHECK Flag" | eval sigma_description="Detects suspicious starts of explorer.exe that use the /NOUACCHECK flag that allows to run all sub processes of that newly started explorer.exe without any UAC checks"
dispatch.earliest_time = -24h@h
alert.track = 0

[Explorer NOUACCHECK Flag - sysmon]
description = Detects suspicious starts of explorer.exe that use the /NOUACCHECK flag that allows to run all sub processes of that newly started explorer.exe without any UAC checks
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\explorer.exe" CommandLine="*/NOUACCHECK*")) NOT (((ParentCommandLine="C:\\Windows\\system32\\svchost.exe -k netsvcs -p -s Schedule") OR (ParentImage="C:\\Windows\\System32\\svchost.exe"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1548.002" | eval sigma_title="Explorer NOUACCHECK Flag" | eval sigma_description="Detects suspicious starts of explorer.exe that use the /NOUACCHECK flag that allows to run all sub processes of that newly started explorer.exe without any UAC checks"
dispatch.earliest_time = -24h@h
alert.track = 0

[Proxy Execution Via Explorer.exe - winevent]
description = Attackers can use explorer.exe for evading defense mechanisms
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\explorer.exe" Creator_Process_Name="*\\cmd.exe" Process_Command_Line="*explorer.exe*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1218" | eval sigma_title="Proxy Execution Via Explorer.exe" | eval sigma_description="Attackers can use explorer.exe for evading defense mechanisms"
dispatch.earliest_time = -24h@h
alert.track = 0

[Proxy Execution Via Explorer.exe - sysmon]
description = Attackers can use explorer.exe for evading defense mechanisms
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\explorer.exe" ParentImage="*\\cmd.exe" CommandLine="*explorer.exe*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1218" | eval sigma_title="Proxy Execution Via Explorer.exe" | eval sigma_description="Attackers can use explorer.exe for evading defense mechanisms"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious File Characteristics Due to Missing Fields - winevent]
description = Detects Executables in the Downloads folder without FileVersion,Description,Product,Company likely created with py2exe
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((((Description="\?" FileVersion="\?")) OR ((Description="\?" Product="\?"))) OR ((Description="\?" Company="\?"))) New_Process_Name="*\\Downloads\\*")) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.execution attack.t1059.006" | eval sigma_title="Suspicious File Characteristics Due to Missing Fields" | eval sigma_description="Detects Executables in the Downloads folder without FileVersion,Description,Product,Company likely created with py2exe"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious File Characteristics Due to Missing Fields - sysmon]
description = Detects Executables in the Downloads folder without FileVersion,Description,Product,Company likely created with py2exe
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((((Description="\?" FileVersion="\?")) OR ((Description="\?" Product="\?"))) OR ((Description="\?" Company="\?"))) Image="*\\Downloads\\*")) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.execution attack.t1059.006" | eval sigma_title="Suspicious File Characteristics Due to Missing Fields" | eval sigma_description="Detects Executables in the Downloads folder without FileVersion,Description,Product,Company likely created with py2exe"
dispatch.earliest_time = -24h@h
alert.track = 0

[GfxDownloadWrapper.exe Downloads File from Suspicious URL - winevent]
description = Detects when GfxDownloadWrapper.exe downloads file from non standard URL
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) New_Process_Name="*\\GfxDownloadWrapper.exe" NOT ((Process_Command_Line="*gameplayapi.intel.com*" (Creator_Process_Name="*\\GfxDownloadWrapper.exe" OR Creator_Process_Name="*\\igfxEM.exe"))))) | table Process_Command_Line | eval sigma_attack_tags="attack.command_and_control attack.t1105" | eval sigma_title="GfxDownloadWrapper.exe Downloads File from Suspicious URL" | eval sigma_description="Detects when GfxDownloadWrapper.exe downloads file from non standard URL"
dispatch.earliest_time = -24h@h
alert.track = 0

[GfxDownloadWrapper.exe Downloads File from Suspicious URL - sysmon]
description = Detects when GfxDownloadWrapper.exe downloads file from non standard URL
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) Image="*\\GfxDownloadWrapper.exe" NOT ((CommandLine="*gameplayapi.intel.com*" (ParentImage="*\\GfxDownloadWrapper.exe" OR ParentImage="*\\igfxEM.exe"))))) | table CommandLine | eval sigma_attack_tags="attack.command_and_control attack.t1105" | eval sigma_title="GfxDownloadWrapper.exe Downloads File from Suspicious URL" | eval sigma_description="Detects when GfxDownloadWrapper.exe downloads file from non standard URL"
dispatch.earliest_time = -24h@h
alert.track = 0

[Findstr Launching .lnk File - winevent]
description = Detects usage of findstr to identify and execute a lnk file as seen within the HHS redirect attack
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\findstr.exe" Process_Command_Line="*.lnk")) | table New_Process_Name,Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.t1036 attack.t1202 attack.t1027.003" | eval sigma_title="Findstr Launching .lnk File" | eval sigma_description="Detects usage of findstr to identify and execute a lnk file as seen within the HHS redirect attack"
dispatch.earliest_time = -24h@h
alert.track = 0

[Findstr Launching .lnk File - sysmon]
description = Detects usage of findstr to identify and execute a lnk file as seen within the HHS redirect attack
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\findstr.exe" CommandLine="*.lnk")) | table Image,CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.t1036 attack.t1202 attack.t1027.003" | eval sigma_title="Findstr Launching .lnk File" | eval sigma_description="Detects usage of findstr to identify and execute a lnk file as seen within the HHS redirect attack"
dispatch.earliest_time = -24h@h
alert.track = 0

[Finger.exe Suspicious Invocation - winevent]
description = Detects suspicious aged finger.exe tool execution often used in malware attacks nowadays
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (OriginalFileName="finger.exe" OR New_Process_Name="*\\finger.exe"))) | eval sigma_attack_tags="attack.command_and_control attack.t1105" | eval sigma_title="Finger.exe Suspicious Invocation" | eval sigma_description="Detects suspicious aged finger.exe tool execution often used in malware attacks nowadays"
dispatch.earliest_time = -24h@h
alert.track = 0

[Finger.exe Suspicious Invocation - sysmon]
description = Detects suspicious aged finger.exe tool execution often used in malware attacks nowadays
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (OriginalFileName="finger.exe" OR Image="*\\finger.exe"))) | eval sigma_attack_tags="attack.command_and_control attack.t1105" | eval sigma_title="Finger.exe Suspicious Invocation" | eval sigma_description="Detects suspicious aged finger.exe tool execution often used in malware attacks nowadays"
dispatch.earliest_time = -24h@h
alert.track = 0

[Format.com FileSystem LOLBIN - winevent]
description = Detects the execution of format.com with a suspicious filesystem selection that could indicate a defense evasion activity in which format.com is used to load malicious DLL files or other programs
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\format.com" Process_Command_Line="*/fs:*")) NOT ((((Process_Command_Line="*/fs:FAT*" OR Process_Command_Line="*/fs:exFAT*" OR Process_Command_Line="*/fs:NTFS*" OR Process_Command_Line="*/fs:UDF*" OR Process_Command_Line="*/fs:ReFS*")))))) | eval sigma_attack_tags="attack.defense_evasion" | eval sigma_title="Format.com FileSystem LOLBIN" | eval sigma_description="Detects the execution of format.com with a suspicious filesystem selection that could indicate a defense evasion activity in which format.com is used to load malicious DLL files or other programs"
dispatch.earliest_time = -24h@h
alert.track = 0

[Format.com FileSystem LOLBIN - sysmon]
description = Detects the execution of format.com with a suspicious filesystem selection that could indicate a defense evasion activity in which format.com is used to load malicious DLL files or other programs
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\format.com" CommandLine="*/fs:*")) NOT ((((CommandLine="*/fs:FAT*" OR CommandLine="*/fs:exFAT*" OR CommandLine="*/fs:NTFS*" OR CommandLine="*/fs:UDF*" OR CommandLine="*/fs:ReFS*")))))) | eval sigma_attack_tags="attack.defense_evasion" | eval sigma_title="Format.com FileSystem LOLBIN" | eval sigma_description="Detects the execution of format.com with a suspicious filesystem selection that could indicate a defense evasion activity in which format.com is used to load malicious DLL files or other programs"
dispatch.earliest_time = -24h@h
alert.track = 0

[Fsutil Suspicious Invocation - winevent]
description = Detects suspicious parameters of fsutil (deleting USN journal, configuring it with small size, etc).
Might be used by ransomwares during the attack (seen by NotPetya and others).

search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\fsutil.exe" OR OriginalFileName="fsutil.exe") (Process_Command_Line="*deletejournal*" OR Process_Command_Line="*createjournal*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1070" | eval sigma_title="Fsutil Suspicious Invocation" | eval sigma_description="Detects suspicious parameters of fsutil (deleting USN journal, configuring it with small size, etc).
Might be used by ransomwares during the attack (seen by NotPetya and others).
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Fsutil Suspicious Invocation - sysmon]
description = Detects suspicious parameters of fsutil (deleting USN journal, configuring it with small size, etc).
Might be used by ransomwares during the attack (seen by NotPetya and others).

search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\fsutil.exe" OR OriginalFileName="fsutil.exe") (CommandLine="*deletejournal*" OR CommandLine="*createjournal*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1070" | eval sigma_title="Fsutil Suspicious Invocation" | eval sigma_description="Detects suspicious parameters of fsutil (deleting USN journal, configuring it with small size, etc).
Might be used by ransomwares during the attack (seen by NotPetya and others).
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Git Clone - winevent]
description = Detects execution of 'git' in order to clone a remote repository that contain suspicious keywords which might be suspicious
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\git.exe" OR New_Process_Name="*\\git-remote-https.exe") OR OriginalFileName="git.exe") (Process_Command_Line="* clone *" OR Process_Command_Line="*git-remote-https *") (Process_Command_Line="*exploit*" OR Process_Command_Line="*Vulns*" OR Process_Command_Line="*vulnerability*" OR Process_Command_Line="*RemoteCodeExecution*" OR Process_Command_Line="*Invoke-*" OR Process_Command_Line="*CVE-*" OR Process_Command_Line="*poc-*" OR Process_Command_Line="*ProofOfConcept*" OR Process_Command_Line="*proxyshell*" OR Process_Command_Line="*log4shell*" OR Process_Command_Line="*eternalblue*" OR Process_Command_Line="*eternal-blue*" OR Process_Command_Line="*MS17-*"))) | eval sigma_attack_tags="attack.reconnaissance attack.t1593.003" | eval sigma_title="Suspicious Git Clone" | eval sigma_description="Detects execution of 'git' in order to clone a remote repository that contain suspicious keywords which might be suspicious"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Git Clone - sysmon]
description = Detects execution of 'git' in order to clone a remote repository that contain suspicious keywords which might be suspicious
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\git.exe" OR Image="*\\git-remote-https.exe") OR OriginalFileName="git.exe") (CommandLine="* clone *" OR CommandLine="*git-remote-https *") (CommandLine="*exploit*" OR CommandLine="*Vulns*" OR CommandLine="*vulnerability*" OR CommandLine="*RemoteCodeExecution*" OR CommandLine="*Invoke-*" OR CommandLine="*CVE-*" OR CommandLine="*poc-*" OR CommandLine="*ProofOfConcept*" OR CommandLine="*proxyshell*" OR CommandLine="*log4shell*" OR CommandLine="*eternalblue*" OR CommandLine="*eternal-blue*" OR CommandLine="*MS17-*"))) | eval sigma_attack_tags="attack.reconnaissance attack.t1593.003" | eval sigma_title="Suspicious Git Clone" | eval sigma_description="Detects execution of 'git' in order to clone a remote repository that contain suspicious keywords which might be suspicious"
dispatch.earliest_time = -24h@h
alert.track = 0

[Gpresult Display Group Policy Information - winevent]
description = Detects cases in which a user uses the built-in Windows utility gpresult to display the Resultant Set of Policy (RSoP) information
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\gpresult.exe" (Process_Command_Line="*/z*" OR Process_Command_Line="*/v*"))) | eval sigma_attack_tags="attack.discovery attack.t1615" | eval sigma_title="Gpresult Display Group Policy Information" | eval sigma_description="Detects cases in which a user uses the built-in Windows utility gpresult to display the Resultant Set of Policy (RSoP) information"
dispatch.earliest_time = -24h@h
alert.track = 0

[Gpresult Display Group Policy Information - sysmon]
description = Detects cases in which a user uses the built-in Windows utility gpresult to display the Resultant Set of Policy (RSoP) information
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\gpresult.exe" (CommandLine="*/z*" OR CommandLine="*/v*"))) | eval sigma_attack_tags="attack.discovery attack.t1615" | eval sigma_title="Gpresult Display Group Policy Information" | eval sigma_description="Detects cases in which a user uses the built-in Windows utility gpresult to display the Resultant Set of Policy (RSoP) information"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Scheduled Task Name As GUID - winevent]
description = Detects creation of a scheduled task with a GUID like name
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\schtasks.exe" Process_Command_Line="*/Create *" (Process_Command_Line="*/TN \"{*" OR Process_Command_Line="*/TN '{*" OR Process_Command_Line="*/TN {*") (Process_Command_Line="*}\"*" OR Process_Command_Line="*}'*" OR Process_Command_Line="*} *"))) | eval sigma_attack_tags="attack.execution attack.t1053.005" | eval sigma_title="Suspicious Scheduled Task Name As GUID" | eval sigma_description="Detects creation of a scheduled task with a GUID like name"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Scheduled Task Name As GUID - sysmon]
description = Detects creation of a scheduled task with a GUID like name
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\schtasks.exe" CommandLine="*/Create *" (CommandLine="*/TN \"{*" OR CommandLine="*/TN '{*" OR CommandLine="*/TN {*") (CommandLine="*}\"*" OR CommandLine="*}'*" OR CommandLine="*} *"))) | eval sigma_attack_tags="attack.execution attack.t1053.005" | eval sigma_title="Suspicious Scheduled Task Name As GUID" | eval sigma_description="Detects creation of a scheduled task with a GUID like name"
dispatch.earliest_time = -24h@h
alert.track = 0

[Download Files Using Notepad++ GUP Utility - winevent]
description = Detects execution of the Notepad++ updater (gup) from a process other than Notepad++ to download files.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((New_Process_Name="*\\GUP.exe" OR OriginalFileName="gup.exe") ((Process_Command_Line="* -unzipTo *" Process_Command_Line="*http*")))) NOT ((Creator_Process_Name="*\\notepad++.exe")))) | eval sigma_attack_tags="attack.command_and_control attack.t1105" | eval sigma_title="Download Files Using Notepad++ GUP Utility" | eval sigma_description="Detects execution of the Notepad++ updater (gup) from a process other than Notepad++ to download files."
dispatch.earliest_time = -24h@h
alert.track = 0

[Download Files Using Notepad++ GUP Utility - sysmon]
description = Detects execution of the Notepad++ updater (gup) from a process other than Notepad++ to download files.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((Image="*\\GUP.exe" OR OriginalFileName="gup.exe") ((CommandLine="* -unzipTo *" CommandLine="*http*")))) NOT ((ParentImage="*\\notepad++.exe")))) | eval sigma_attack_tags="attack.command_and_control attack.t1105" | eval sigma_title="Download Files Using Notepad++ GUP Utility" | eval sigma_description="Detects execution of the Notepad++ updater (gup) from a process other than Notepad++ to download files."
dispatch.earliest_time = -24h@h
alert.track = 0

[Execute Arbitrary Binaries Using GUP Utility - winevent]
description = Detects execution of the Notepad++ updater (gup) to launch other commands or executables
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((Creator_Process_Name="*\\gup.exe" New_Process_Name="*\\explorer.exe")) NOT (((New_Process_Name="*\\explorer.exe" Process_Command_Line="*\\Notepad++\\notepad++.exe*")) OR ((Creator_Process_Name="*\\Notepad++\\updater\\*")) OR ((NOT Process_Command_Line="*"))))) | eval sigma_attack_tags="attack.execution" | eval sigma_title="Execute Arbitrary Binaries Using GUP Utility" | eval sigma_description="Detects execution of the Notepad++ updater (gup) to launch other commands or executables"
dispatch.earliest_time = -24h@h
alert.track = 0

[Execute Arbitrary Binaries Using GUP Utility - sysmon]
description = Detects execution of the Notepad++ updater (gup) to launch other commands or executables
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((ParentImage="*\\gup.exe" Image="*\\explorer.exe")) NOT (((Image="*\\explorer.exe" CommandLine="*\\Notepad++\\notepad++.exe*")) OR ((ParentImage="*\\Notepad++\\updater\\*")) OR ((NOT CommandLine="*"))))) | eval sigma_attack_tags="attack.execution" | eval sigma_title="Execute Arbitrary Binaries Using GUP Utility" | eval sigma_description="Detects execution of the Notepad++ updater (gup) to launch other commands or executables"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious GUP Usage - winevent]
description = Detects execution of the Notepad++ updater in a suspicious directory, which is often used in DLL side-loading attacks
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) New_Process_Name="*\\GUP.exe" NOT ((((New_Process_Name="*\\Program Files\\Notepad++\\updater\\GUP.exe" OR New_Process_Name="*\\Program Files (x86)\\Notepad++\\updater\\GUP.exe"))) OR ((New_Process_Name="*\\Users\\*" (New_Process_Name="*\\AppData\\Local\\Notepad++\\updater\\GUP.exe" OR New_Process_Name="*\\AppData\\Roaming\\Notepad++\\updater\\GUP.exe")))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1574.002" | eval sigma_title="Suspicious GUP Usage" | eval sigma_description="Detects execution of the Notepad++ updater in a suspicious directory, which is often used in DLL side-loading attacks"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious GUP Usage - sysmon]
description = Detects execution of the Notepad++ updater in a suspicious directory, which is often used in DLL side-loading attacks
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) Image="*\\GUP.exe" NOT ((((Image="*\\Program Files\\Notepad++\\updater\\GUP.exe" OR Image="*\\Program Files (x86)\\Notepad++\\updater\\GUP.exe"))) OR ((Image="*\\Users\\*" (Image="*\\AppData\\Local\\Notepad++\\updater\\GUP.exe" OR Image="*\\AppData\\Roaming\\Notepad++\\updater\\GUP.exe")))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1574.002" | eval sigma_title="Suspicious GUP Usage" | eval sigma_description="Detects execution of the Notepad++ updater in a suspicious directory, which is often used in DLL side-loading attacks"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious IIS Module Registration - winevent]
description = Detects a suspicious IIS module registration as described in Microsoft threat report on IIS backdoors
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) Creator_Process_Name="*\\w3wp.exe" (Process_Command_Line="*appcmd.exe add module*" OR ((Process_Command_Line="* system.enterpriseservices.internal.publish*" New_Process_Name="*\\powershell.exe")) OR ((Process_Command_Line="*gacutil*" Process_Command_Line="* /I*"))))) | eval sigma_attack_tags="" | eval sigma_title="Suspicious IIS Module Registration" | eval sigma_description="Detects a suspicious IIS module registration as described in Microsoft threat report on IIS backdoors"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious IIS Module Registration - sysmon]
description = Detects a suspicious IIS module registration as described in Microsoft threat report on IIS backdoors
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ParentImage="*\\w3wp.exe" (CommandLine="*appcmd.exe add module*" OR ((CommandLine="* system.enterpriseservices.internal.publish*" Image="*\\powershell.exe")) OR ((CommandLine="*gacutil*" CommandLine="* /I*"))))) | eval sigma_attack_tags="" | eval sigma_title="Suspicious IIS Module Registration" | eval sigma_description="Detects a suspicious IIS module registration as described in Microsoft threat report on IIS backdoors"
dispatch.earliest_time = -24h@h
alert.track = 0

[Execution Of Non-Existing File - winevent]
description = Checks whether the image specified in a process creation event is not a full, absolute path (caused by process ghosting or other unorthodox methods to start a process)
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) NOT ((New_Process_Name="*\\*")) NOT (((NOT New_Process_Name="*")) OR (((New_Process_Name="-" OR New_Process_Name=""))) OR (((New_Process_Name="System" OR New_Process_Name="Registry" OR New_Process_Name="MemCompression" OR New_Process_Name="vmmem")) OR ((Process_Command_Line="Registry" OR Process_Command_Line="MemCompression" OR Process_Command_Line="vmmem")))))) | eval sigma_attack_tags="attack.defense_evasion" | eval sigma_title="Execution Of Non-Existing File" | eval sigma_description="Checks whether the image specified in a process creation event is not a full, absolute path (caused by process ghosting or other unorthodox methods to start a process)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Execution Of Non-Existing File - sysmon]
description = Checks whether the image specified in a process creation event is not a full, absolute path (caused by process ghosting or other unorthodox methods to start a process)
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) NOT ((Image="*\\*")) NOT (((NOT Image="*")) OR (((Image="-" OR Image=""))) OR (((Image="System" OR Image="Registry" OR Image="MemCompression" OR Image="vmmem")) OR ((CommandLine="Registry" OR CommandLine="MemCompression" OR CommandLine="vmmem")))))) | eval sigma_attack_tags="attack.defense_evasion" | eval sigma_title="Execution Of Non-Existing File" | eval sigma_description="Checks whether the image specified in a process creation event is not a full, absolute path (caused by process ghosting or other unorthodox methods to start a process)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Execution of InstallUtil Without Log - winevent]
description = Uses the .NET InstallUtil.exe application in order to execute image without log
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\InstallUtil.exe" New_Process_Name="*Microsoft.NET\\Framework*" Process_Command_Line="*/logfile= *" Process_Command_Line="*/LogToConsole=false*")) | eval sigma_attack_tags="attack.defense_evasion" | eval sigma_title="Suspicious Execution of InstallUtil Without Log" | eval sigma_description="Uses the .NET InstallUtil.exe application in order to execute image without log"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Execution of InstallUtil Without Log - sysmon]
description = Uses the .NET InstallUtil.exe application in order to execute image without log
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\InstallUtil.exe" Image="*Microsoft.NET\\Framework*" CommandLine="*/logfile= *" CommandLine="*/LogToConsole=false*")) | eval sigma_attack_tags="attack.defense_evasion" | eval sigma_title="Suspicious Execution of InstallUtil Without Log" | eval sigma_description="Uses the .NET InstallUtil.exe application in order to execute image without log"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Invoke-WebRequest Usage - winevent]
description = Detects a suspicious call to Invoke-WebRequest cmdlet where the and output is located in a suspicious location
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (New_Process_Name="*\\powershell.exe" OR New_Process_Name="*\\pwsh.exe" OR New_Process_Name="*\\cmd.exe") (Process_Command_Line="*Invoke-WebRequest*" OR Process_Command_Line="*iwr *" OR Process_Command_Line="*wget *" OR Process_Command_Line="*curl *") (Process_Command_Line="* -ur*" OR Process_Command_Line="* -o*") (Process_Command_Line="*\\AppData\\*" OR Process_Command_Line="*\\Users\\Public\\*" OR Process_Command_Line="*\\Temp\\*" OR Process_Command_Line="*%AppData%*" OR Process_Command_Line="*%Temp%*" OR Process_Command_Line="*%tmp%*" OR Process_Command_Line="*%Public%*" OR Process_Command_Line="*\\Desktop\\*" OR Process_Command_Line="*C:\\Windows\\*"))) | eval sigma_attack_tags="attack.command_and_control attack.t1105" | eval sigma_title="Suspicious Invoke-WebRequest Usage" | eval sigma_description="Detects a suspicious call to Invoke-WebRequest cmdlet where the and output is located in a suspicious location"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Invoke-WebRequest Usage - sysmon]
description = Detects a suspicious call to Invoke-WebRequest cmdlet where the and output is located in a suspicious location
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (Image="*\\powershell.exe" OR Image="*\\pwsh.exe" OR Image="*\\cmd.exe") (CommandLine="*Invoke-WebRequest*" OR CommandLine="*iwr *" OR CommandLine="*wget *" OR CommandLine="*curl *") (CommandLine="* -ur*" OR CommandLine="* -o*") (CommandLine="*\\AppData\\*" OR CommandLine="*\\Users\\Public\\*" OR CommandLine="*\\Temp\\*" OR CommandLine="*%AppData%*" OR CommandLine="*%Temp%*" OR CommandLine="*%tmp%*" OR CommandLine="*%Public%*" OR CommandLine="*\\Desktop\\*" OR CommandLine="*C:\\Windows\\*"))) | eval sigma_attack_tags="attack.command_and_control attack.t1105" | eval sigma_title="Suspicious Invoke-WebRequest Usage" | eval sigma_description="Detects a suspicious call to Invoke-WebRequest cmdlet where the and output is located in a suspicious location"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Execution of Shutdown to Log Out - winevent]
description = Detects the rare use of the command line tool shutdown to logoff a user
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\shutdown.exe" Process_Command_Line="*/l*")) | eval sigma_attack_tags="attack.impact attack.t1529" | eval sigma_title="Suspicious Execution of Shutdown to Log Out" | eval sigma_description="Detects the rare use of the command line tool shutdown to logoff a user"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Execution of Shutdown to Log Out - sysmon]
description = Detects the rare use of the command line tool shutdown to logoff a user
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\shutdown.exe" CommandLine="*/l*")) | eval sigma_attack_tags="attack.impact attack.t1529" | eval sigma_title="Suspicious Execution of Shutdown to Log Out" | eval sigma_description="Detects the rare use of the command line tool shutdown to logoff a user"
dispatch.earliest_time = -24h@h
alert.track = 0

[Wscript Execution from Non C Drive - winevent]
description = Detects Wscript or Cscript executing from a drive other than C. This has been observed with Qakbot executing from within a mounted ISO file.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((New_Process_Name="*\\wscript.exe" OR New_Process_Name="*\\cscript.exe") (Process_Command_Line="*.js*" OR Process_Command_Line="*.vbs*" OR Process_Command_Line="*.vbe*") Process_Command_Line="*:\\*")) NOT ((((Process_Command_Line="* C:\\\*" OR Process_Command_Line="* 'C:\\*" OR Process_Command_Line="* \"C:\\\*"))) OR ((Process_Command_Line="*%*")) OR ((Process_Command_Line="* \\\\\*"))))) | eval sigma_attack_tags="attack.execution attack.t1059" | eval sigma_title="Wscript Execution from Non C Drive" | eval sigma_description="Detects Wscript or Cscript executing from a drive other than C. This has been observed with Qakbot executing from within a mounted ISO file."
dispatch.earliest_time = -24h@h
alert.track = 0

[Wscript Execution from Non C Drive - sysmon]
description = Detects Wscript or Cscript executing from a drive other than C. This has been observed with Qakbot executing from within a mounted ISO file.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((Image="*\\wscript.exe" OR Image="*\\cscript.exe") (CommandLine="*.js*" OR CommandLine="*.vbs*" OR CommandLine="*.vbe*") CommandLine="*:\\*")) NOT ((((CommandLine="* C:\\\*" OR CommandLine="* 'C:\\*" OR CommandLine="* \"C:\\\*"))) OR ((CommandLine="*%*")) OR ((CommandLine="* \\\\\*"))))) | eval sigma_attack_tags="attack.execution attack.t1059" | eval sigma_title="Wscript Execution from Non C Drive" | eval sigma_description="Detects Wscript or Cscript executing from a drive other than C. This has been observed with Qakbot executing from within a mounted ISO file."
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious LSASS Process Clone - winevent]
description = Detects a suspicious LSASS process process clone that could be a sign of process dumping activity
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\Windows\\System32\\lsass.exe" Creator_Process_Name="*\\Windows\\System32\\lsass.exe")) | eval sigma_attack_tags="attack.credential_access attack.t1003 attack.t1003.001" | eval sigma_title="Suspicious LSASS Process Clone" | eval sigma_description="Detects a suspicious LSASS process process clone that could be a sign of process dumping activity"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious LSASS Process Clone - sysmon]
description = Detects a suspicious LSASS process process clone that could be a sign of process dumping activity
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\Windows\\System32\\lsass.exe" ParentImage="*\\Windows\\System32\\lsass.exe")) | eval sigma_attack_tags="attack.credential_access attack.t1003 attack.t1003.001" | eval sigma_title="Suspicious LSASS Process Clone" | eval sigma_description="Detects a suspicious LSASS process process clone that could be a sign of process dumping activity"
dispatch.earliest_time = -24h@h
alert.track = 0

[Manage Engine Java Suspicious Sub Process - winevent]
description = Detects suspicious sub processes started by the Manage Engine ServiceDesk Plus Java web service process
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((Creator_Process_Name="*\\ManageEngine\\ServiceDesk\\*" Creator_Process_Name="*\\java.exe*" (New_Process_Name="*\\powershell.exe" OR New_Process_Name="*\\sh.exe" OR New_Process_Name="*\\bash.exe" OR New_Process_Name="*\\pwsh.exe" OR New_Process_Name="*\\schtasks.exe" OR New_Process_Name="*\\certutil.exe" OR New_Process_Name="*\\whoami.exe" OR New_Process_Name="*\\bitsadmin.exe" OR New_Process_Name="*\\wscript.exe" OR New_Process_Name="*\\cscript.exe" OR New_Process_Name="*\\scrcons.exe" OR New_Process_Name="*\\wmic.exe" OR New_Process_Name="*\\mshta.exe" OR New_Process_Name="*\\forfiles.exe" OR New_Process_Name="*\\mftrace.exe" OR New_Process_Name="*\\AppVLP.exe" OR New_Process_Name="*\\curl.exe" OR New_Process_Name="*\\notepad.exe" OR New_Process_Name="*\\systeminfo.exe" OR New_Process_Name="*\\net.exe" OR New_Process_Name="*\\net1.exe" OR New_Process_Name="*\\reg.exe" OR New_Process_Name="*\\query.exe"))) NOT ((((New_Process_Name="*\\net.exe" OR New_Process_Name="*\\net1.exe") Process_Command_Line="* stop*"))))) | table Process_Command_Line | eval sigma_attack_tags="" | eval sigma_title="Manage Engine Java Suspicious Sub Process" | eval sigma_description="Detects suspicious sub processes started by the Manage Engine ServiceDesk Plus Java web service process"
dispatch.earliest_time = -24h@h
alert.track = 0

[Manage Engine Java Suspicious Sub Process - sysmon]
description = Detects suspicious sub processes started by the Manage Engine ServiceDesk Plus Java web service process
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((ParentImage="*\\ManageEngine\\ServiceDesk\\*" ParentImage="*\\java.exe*" (Image="*\\powershell.exe" OR Image="*\\sh.exe" OR Image="*\\bash.exe" OR Image="*\\pwsh.exe" OR Image="*\\schtasks.exe" OR Image="*\\certutil.exe" OR Image="*\\whoami.exe" OR Image="*\\bitsadmin.exe" OR Image="*\\wscript.exe" OR Image="*\\cscript.exe" OR Image="*\\scrcons.exe" OR Image="*\\wmic.exe" OR Image="*\\mshta.exe" OR Image="*\\forfiles.exe" OR Image="*\\mftrace.exe" OR Image="*\\AppVLP.exe" OR Image="*\\curl.exe" OR Image="*\\notepad.exe" OR Image="*\\systeminfo.exe" OR Image="*\\net.exe" OR Image="*\\net1.exe" OR Image="*\\reg.exe" OR Image="*\\query.exe"))) NOT ((((Image="*\\net.exe" OR Image="*\\net1.exe") CommandLine="* stop*"))))) | table CommandLine | eval sigma_attack_tags="" | eval sigma_title="Manage Engine Java Suspicious Sub Process" | eval sigma_description="Detects suspicious sub processes started by the Manage Engine ServiceDesk Plus Java web service process"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Microsoft OneNote Child Process - winevent]
description = Detects suspicious child processes of the Microsoft OneNote application. This may indicate an attempt to execute malicious embedded objects from a .one file.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) Creator_Process_Name="*\\onenote.exe" (((OriginalFileName="RUNDLL32.exe" OR OriginalFileName="REGSVR32.exe" OR OriginalFileName="bitsadmin.exe" OR OriginalFileName="CertUtil.exe" OR OriginalFileName="InstallUtil.exe" OR OriginalFileName="schtasks.exe" OR OriginalFileName="wmic.exe" OR OriginalFileName="cscript.exe" OR OriginalFileName="wscript.exe" OR OriginalFileName="CMSTP.EXE" OR OriginalFileName="Microsoft.Workflow.Compiler.exe" OR OriginalFileName="RegAsm.exe" OR OriginalFileName="RegSvcs.exe" OR OriginalFileName="MSHTA.EXE" OR OriginalFileName="Msxsl.exe" OR OriginalFileName="IEExec.exe" OR OriginalFileName="Cmd.Exe" OR OriginalFileName="PowerShell.EXE" OR OriginalFileName="HH.exe" OR OriginalFileName="javaw.exe" OR OriginalFileName="pcalua.exe" OR OriginalFileName="curl.exe" OR OriginalFileName="ScriptRunner.exe" OR OriginalFileName="CertOC.exe" OR OriginalFileName="WorkFolders.exe" OR OriginalFileName="odbcconf.exe" OR OriginalFileName="msiexec.exe" OR OriginalFileName="msdt.exe") OR (New_Process_Name="*\\rundll32.exe" OR New_Process_Name="*\\regsvr32.exe" OR New_Process_Name="*\\bitsadmin.exe" OR New_Process_Name="*\\certutil.exe" OR New_Process_Name="*\\installutil.exe" OR New_Process_Name="*\\schtasks.exe" OR New_Process_Name="*\\wmic.exe" OR New_Process_Name="*\\cscript.exe" OR New_Process_Name="*\\wscript.exe" OR New_Process_Name="*\\cmstp.exe" OR New_Process_Name="*\\Microsoft.Workflow.Compiler.exe" OR New_Process_Name="*\\regasm.exe" OR New_Process_Name="*\\regsvcs.exe" OR New_Process_Name="*\\mshta.exe" OR New_Process_Name="*\\msxsl.exe" OR New_Process_Name="*\\ieexec.exe" OR New_Process_Name="*\\cmd.exe" OR New_Process_Name="*\\powershell.exe" OR New_Process_Name="*\\hh.exe" OR New_Process_Name="*\\javaw.exe" OR New_Process_Name="*\\pcalua.exe" OR New_Process_Name="*\\curl.exe" OR New_Process_Name="*\\scriptrunner.exe" OR New_Process_Name="*\\certoc.exe" OR New_Process_Name="*\\workfolders.exe" OR New_Process_Name="*\\odbcconf.exe" OR New_Process_Name="*\\msiexec.exe" OR New_Process_Name="*\\msdt.exe")) OR ((New_Process_Name="*\\explorer.exe" (Process_Command_Line="*.hta*" OR Process_Command_Line="*.vb*" OR Process_Command_Line="*.wsh*" OR Process_Command_Line="*.js*" OR Process_Command_Line="*.ps*" OR Process_Command_Line="*.scr*" OR Process_Command_Line="*.pif*" OR Process_Command_Line="*.bat*" OR Process_Command_Line="*.cmd*"))) OR (New_Process_Name="*\\AppData\\*" OR New_Process_Name="*\\Users\\Public\\*" OR New_Process_Name="*\\ProgramData\\*" OR New_Process_Name="*\\Windows\\Tasks\\*" OR New_Process_Name="*\\Windows\\Temp\\*" OR New_Process_Name="*\\Windows\\System32\\Tasks\\*")))) | eval sigma_attack_tags="attack.t1566 attack.t1566.001 attack.initial_access" | eval sigma_title="Suspicious Microsoft OneNote Child Process" | eval sigma_description="Detects suspicious child processes of the Microsoft OneNote application. This may indicate an attempt to execute malicious embedded objects from a .one file."
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Microsoft OneNote Child Process - sysmon]
description = Detects suspicious child processes of the Microsoft OneNote application. This may indicate an attempt to execute malicious embedded objects from a .one file.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ParentImage="*\\onenote.exe" (((OriginalFileName="RUNDLL32.exe" OR OriginalFileName="REGSVR32.exe" OR OriginalFileName="bitsadmin.exe" OR OriginalFileName="CertUtil.exe" OR OriginalFileName="InstallUtil.exe" OR OriginalFileName="schtasks.exe" OR OriginalFileName="wmic.exe" OR OriginalFileName="cscript.exe" OR OriginalFileName="wscript.exe" OR OriginalFileName="CMSTP.EXE" OR OriginalFileName="Microsoft.Workflow.Compiler.exe" OR OriginalFileName="RegAsm.exe" OR OriginalFileName="RegSvcs.exe" OR OriginalFileName="MSHTA.EXE" OR OriginalFileName="Msxsl.exe" OR OriginalFileName="IEExec.exe" OR OriginalFileName="Cmd.Exe" OR OriginalFileName="PowerShell.EXE" OR OriginalFileName="HH.exe" OR OriginalFileName="javaw.exe" OR OriginalFileName="pcalua.exe" OR OriginalFileName="curl.exe" OR OriginalFileName="ScriptRunner.exe" OR OriginalFileName="CertOC.exe" OR OriginalFileName="WorkFolders.exe" OR OriginalFileName="odbcconf.exe" OR OriginalFileName="msiexec.exe" OR OriginalFileName="msdt.exe") OR (Image="*\\rundll32.exe" OR Image="*\\regsvr32.exe" OR Image="*\\bitsadmin.exe" OR Image="*\\certutil.exe" OR Image="*\\installutil.exe" OR Image="*\\schtasks.exe" OR Image="*\\wmic.exe" OR Image="*\\cscript.exe" OR Image="*\\wscript.exe" OR Image="*\\cmstp.exe" OR Image="*\\Microsoft.Workflow.Compiler.exe" OR Image="*\\regasm.exe" OR Image="*\\regsvcs.exe" OR Image="*\\mshta.exe" OR Image="*\\msxsl.exe" OR Image="*\\ieexec.exe" OR Image="*\\cmd.exe" OR Image="*\\powershell.exe" OR Image="*\\hh.exe" OR Image="*\\javaw.exe" OR Image="*\\pcalua.exe" OR Image="*\\curl.exe" OR Image="*\\scriptrunner.exe" OR Image="*\\certoc.exe" OR Image="*\\workfolders.exe" OR Image="*\\odbcconf.exe" OR Image="*\\msiexec.exe" OR Image="*\\msdt.exe")) OR ((Image="*\\explorer.exe" (CommandLine="*.hta*" OR CommandLine="*.vb*" OR CommandLine="*.wsh*" OR CommandLine="*.js*" OR CommandLine="*.ps*" OR CommandLine="*.scr*" OR CommandLine="*.pif*" OR CommandLine="*.bat*" OR CommandLine="*.cmd*"))) OR (Image="*\\AppData\\*" OR Image="*\\Users\\Public\\*" OR Image="*\\ProgramData\\*" OR Image="*\\Windows\\Tasks\\*" OR Image="*\\Windows\\Temp\\*" OR Image="*\\Windows\\System32\\Tasks\\*")))) | eval sigma_attack_tags="attack.t1566 attack.t1566.001 attack.initial_access" | eval sigma_title="Suspicious Microsoft OneNote Child Process" | eval sigma_description="Detects suspicious child processes of the Microsoft OneNote application. This may indicate an attempt to execute malicious embedded objects from a .one file."
dispatch.earliest_time = -24h@h
alert.track = 0

[Missing Space Characters in Command Lines - winevent]
description = Detects Windows command lines that miss a space before or after the /c flag when running a command using the cmd.exe.
This could be a sign of obfuscation of a fat finger problem (typo by the developer).

search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((Process_Command_Line="*cmd.exe/c*" OR Process_Command_Line="*\\cmd/c*" OR Process_Command_Line="*\"cmd/c*" OR Process_Command_Line="*cmd.exe/k*" OR Process_Command_Line="*\\cmd/k*" OR Process_Command_Line="*\"cmd/k*" OR Process_Command_Line="*cmd.exe/r*" OR Process_Command_Line="*\\cmd/r*" OR Process_Command_Line="*\"cmd/r*") OR (Process_Command_Line="*/cwhoami*" OR Process_Command_Line="*/cpowershell*" OR Process_Command_Line="*/cschtasks*" OR Process_Command_Line="*/cbitsadmin*" OR Process_Command_Line="*/ccertutil*" OR Process_Command_Line="*/kwhoami*" OR Process_Command_Line="*/kpowershell*" OR Process_Command_Line="*/kschtasks*" OR Process_Command_Line="*/kbitsadmin*" OR Process_Command_Line="*/kcertutil*") OR (Process_Command_Line="*cmd.exe /c*" OR Process_Command_Line="*cmd /c*" OR Process_Command_Line="*cmd.exe /k*" OR Process_Command_Line="*cmd /k*" OR Process_Command_Line="*cmd.exe /r*" OR Process_Command_Line="*cmd /r*")) NOT ((((Process_Command_Line="*cmd.exe /c *" OR Process_Command_Line="*cmd /c *" OR Process_Command_Line="*cmd.exe /k *" OR Process_Command_Line="*cmd /k *" OR Process_Command_Line="*cmd.exe /r *" OR Process_Command_Line="*cmd /r *"))) OR ((Process_Command_Line="*AppData\\Local\\Programs\\Microsoft VS Code\\resources\\app\\node_modules*") OR (Process_Command_Line="*cmd.exe/c .") OR (Process_Command_Line="cmd.exe /c"))))) | eval sigma_attack_tags="attack.execution attack.t1059.001" | eval sigma_title="Missing Space Characters in Command Lines" | eval sigma_description="Detects Windows command lines that miss a space before or after the /c flag when running a command using the cmd.exe.
This could be a sign of obfuscation of a fat finger problem (typo by the developer).
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Missing Space Characters in Command Lines - sysmon]
description = Detects Windows command lines that miss a space before or after the /c flag when running a command using the cmd.exe.
This could be a sign of obfuscation of a fat finger problem (typo by the developer).

search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((CommandLine="*cmd.exe/c*" OR CommandLine="*\\cmd/c*" OR CommandLine="*\"cmd/c*" OR CommandLine="*cmd.exe/k*" OR CommandLine="*\\cmd/k*" OR CommandLine="*\"cmd/k*" OR CommandLine="*cmd.exe/r*" OR CommandLine="*\\cmd/r*" OR CommandLine="*\"cmd/r*") OR (CommandLine="*/cwhoami*" OR CommandLine="*/cpowershell*" OR CommandLine="*/cschtasks*" OR CommandLine="*/cbitsadmin*" OR CommandLine="*/ccertutil*" OR CommandLine="*/kwhoami*" OR CommandLine="*/kpowershell*" OR CommandLine="*/kschtasks*" OR CommandLine="*/kbitsadmin*" OR CommandLine="*/kcertutil*") OR (CommandLine="*cmd.exe /c*" OR CommandLine="*cmd /c*" OR CommandLine="*cmd.exe /k*" OR CommandLine="*cmd /k*" OR CommandLine="*cmd.exe /r*" OR CommandLine="*cmd /r*")) NOT ((((CommandLine="*cmd.exe /c *" OR CommandLine="*cmd /c *" OR CommandLine="*cmd.exe /k *" OR CommandLine="*cmd /k *" OR CommandLine="*cmd.exe /r *" OR CommandLine="*cmd /r *"))) OR ((CommandLine="*AppData\\Local\\Programs\\Microsoft VS Code\\resources\\app\\node_modules*") OR (CommandLine="*cmd.exe/c .") OR (CommandLine="cmd.exe /c"))))) | eval sigma_attack_tags="attack.execution attack.t1059.001" | eval sigma_title="Missing Space Characters in Command Lines" | eval sigma_description="Detects Windows command lines that miss a space before or after the /c flag when running a command using the cmd.exe.
This could be a sign of obfuscation of a fat finger problem (typo by the developer).
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Mofcomp Execution - winevent]
description = Detects execution of the 'mofcomp' utility as a child of a suspicious shell or script running utility or by having a supsicious path in the commandline.
The 'mofcomp' utility parses a file containing MOF statements and adds the classes and class instances defined in the file to the WMI repository.
Attackers abuse this utility to install malicious MOF scripts

search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) New_Process_Name="*\\mofcomp.exe" ((Creator_Process_Name="*\\cmd.exe" OR Creator_Process_Name="*\\powershell.exe" OR Creator_Process_Name="*\\pwsh.exe" OR Creator_Process_Name="*\\wsl.exe" OR Creator_Process_Name="*\\wscript.exe" OR Creator_Process_Name="*\\cscript.exe") OR (Process_Command_Line="*\\AppData\\Local\\Temp*" OR Process_Command_Line="*\\Users\\Public\\*" OR Process_Command_Line="*\\WINDOWS\\Temp\\*" OR Process_Command_Line="*%temp%*" OR Process_Command_Line="*%tmp%*" OR Process_Command_Line="*%appdata%*")))) | eval sigma_attack_tags="attack.execution attack.t1218" | eval sigma_title="Suspicious Mofcomp Execution" | eval sigma_description="Detects execution of the 'mofcomp' utility as a child of a suspicious shell or script running utility or by having a supsicious path in the commandline.
The 'mofcomp' utility parses a file containing MOF statements and adds the classes and class instances defined in the file to the WMI repository.
Attackers abuse this utility to install malicious MOF scripts
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Mofcomp Execution - sysmon]
description = Detects execution of the 'mofcomp' utility as a child of a suspicious shell or script running utility or by having a supsicious path in the commandline.
The 'mofcomp' utility parses a file containing MOF statements and adds the classes and class instances defined in the file to the WMI repository.
Attackers abuse this utility to install malicious MOF scripts

search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) Image="*\\mofcomp.exe" ((ParentImage="*\\cmd.exe" OR ParentImage="*\\powershell.exe" OR ParentImage="*\\pwsh.exe" OR ParentImage="*\\wsl.exe" OR ParentImage="*\\wscript.exe" OR ParentImage="*\\cscript.exe") OR (CommandLine="*\\AppData\\Local\\Temp*" OR CommandLine="*\\Users\\Public\\*" OR CommandLine="*\\WINDOWS\\Temp\\*" OR CommandLine="*%temp%*" OR CommandLine="*%tmp%*" OR CommandLine="*%appdata%*")))) | eval sigma_attack_tags="attack.execution attack.t1218" | eval sigma_title="Suspicious Mofcomp Execution" | eval sigma_description="Detects execution of the 'mofcomp' utility as a child of a suspicious shell or script running utility or by having a supsicious path in the commandline.
The 'mofcomp' utility parses a file containing MOF statements and adds the classes and class instances defined in the file to the WMI repository.
Attackers abuse this utility to install malicious MOF scripts
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Mounted Share Deleted - winevent]
description = Detects when when a mounted share is removed. Adversaries may remove share connections that are no longer useful in order to clean up traces of their operation
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\net.exe" OR New_Process_Name="*\\net1.exe") OR (OriginalFileName="net.exe" OR OriginalFileName="net1.exe")) ((Process_Command_Line="*share*" Process_Command_Line="*/delete*")))) | eval sigma_attack_tags="attack.defense_evasion attack.t1070.005" | eval sigma_title="Mounted Share Deleted" | eval sigma_description="Detects when when a mounted share is removed. Adversaries may remove share connections that are no longer useful in order to clean up traces of their operation"
dispatch.earliest_time = -24h@h
alert.track = 0

[Mounted Share Deleted - sysmon]
description = Detects when when a mounted share is removed. Adversaries may remove share connections that are no longer useful in order to clean up traces of their operation
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\net.exe" OR Image="*\\net1.exe") OR (OriginalFileName="net.exe" OR OriginalFileName="net1.exe")) ((CommandLine="*share*" CommandLine="*/delete*")))) | eval sigma_attack_tags="attack.defense_evasion attack.t1070.005" | eval sigma_title="Mounted Share Deleted" | eval sigma_description="Detects when when a mounted share is removed. Adversaries may remove share connections that are no longer useful in order to clean up traces of their operation"
dispatch.earliest_time = -24h@h
alert.track = 0

[MpiExec Lolbin - winevent]
description = Detects a certain command line flag combination used by mpiexec.exe LOLBIN from HPC pack that can be used to execute any other binary
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\mpiexec.exe" OR Imphash="d8b52ef6aaa3a81501bdfff9dbb96217" OR Hashes="*IMPHASH=d8b52ef6aaa3a81501bdfff9dbb96217*") (Process_Command_Line="* /n 1 *" OR Process_Command_Line="* -n 1 *"))) | eval sigma_attack_tags="attack.execution attack.defense_evasion attack.t1218" | eval sigma_title="MpiExec Lolbin" | eval sigma_description="Detects a certain command line flag combination used by mpiexec.exe LOLBIN from HPC pack that can be used to execute any other binary"
dispatch.earliest_time = -24h@h
alert.track = 0

[MpiExec Lolbin - sysmon]
description = Detects a certain command line flag combination used by mpiexec.exe LOLBIN from HPC pack that can be used to execute any other binary
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\mpiexec.exe" OR Imphash="d8b52ef6aaa3a81501bdfff9dbb96217" OR Hashes="*IMPHASH=d8b52ef6aaa3a81501bdfff9dbb96217*") (CommandLine="* /n 1 *" OR CommandLine="* -n 1 *"))) | eval sigma_attack_tags="attack.execution attack.defense_evasion attack.t1218" | eval sigma_title="MpiExec Lolbin" | eval sigma_description="Detects a certain command line flag combination used by mpiexec.exe LOLBIN from HPC pack that can be used to execute any other binary"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Msbuild Execution By Uncommon Parent Process - winevent]
description = Detects suspicious execution of 'Msbuild.exe' by a uncommon parent process
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\MSBuild.exe" OR OriginalFileName="MSBuild.exe") NOT (((Creator_Process_Name="*\\devenv.exe" OR Creator_Process_Name="*\\cmd.exe" OR Creator_Process_Name="*\\msbuild.exe" OR Creator_Process_Name="*\\python.exe" OR Creator_Process_Name="*\\explorer.exe" OR Creator_Process_Name="*\\nuget.exe"))))) | eval sigma_attack_tags="attack.defense_evasion" | eval sigma_title="Suspicious Msbuild Execution By Uncommon Parent Process" | eval sigma_description="Detects suspicious execution of 'Msbuild.exe' by a uncommon parent process"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Msbuild Execution By Uncommon Parent Process - sysmon]
description = Detects suspicious execution of 'Msbuild.exe' by a uncommon parent process
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\MSBuild.exe" OR OriginalFileName="MSBuild.exe") NOT (((ParentImage="*\\devenv.exe" OR ParentImage="*\\cmd.exe" OR ParentImage="*\\msbuild.exe" OR ParentImage="*\\python.exe" OR ParentImage="*\\explorer.exe" OR ParentImage="*\\nuget.exe"))))) | eval sigma_attack_tags="attack.defense_evasion" | eval sigma_title="Suspicious Msbuild Execution By Uncommon Parent Process" | eval sigma_description="Detects suspicious execution of 'Msbuild.exe' by a uncommon parent process"
dispatch.earliest_time = -24h@h
alert.track = 0

[MSHTA Suspicious Execution 01 - winevent]
description = Detection for mshta.exe suspicious execution patterns sometimes involving file polyglotism
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\mshta.exe" (Process_Command_Line="*vbscript*" OR Process_Command_Line="*.jpg*" OR Process_Command_Line="*.png*" OR Process_Command_Line="*.lnk*" OR Process_Command_Line="*.xls*" OR Process_Command_Line="*.doc*" OR Process_Command_Line="*.zip*" OR Process_Command_Line="*.dll*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1140 attack.t1218.005 attack.execution attack.t1059.007 cve.2020.1599" | eval sigma_title="MSHTA Suspicious Execution 01" | eval sigma_description="Detection for mshta.exe suspicious execution patterns sometimes involving file polyglotism"
dispatch.earliest_time = -24h@h
alert.track = 0

[MSHTA Suspicious Execution 01 - sysmon]
description = Detection for mshta.exe suspicious execution patterns sometimes involving file polyglotism
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\mshta.exe" (CommandLine="*vbscript*" OR CommandLine="*.jpg*" OR CommandLine="*.png*" OR CommandLine="*.lnk*" OR CommandLine="*.xls*" OR CommandLine="*.doc*" OR CommandLine="*.zip*" OR CommandLine="*.dll*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1140 attack.t1218.005 attack.execution attack.t1059.007 cve.2020.1599" | eval sigma_title="MSHTA Suspicious Execution 01" | eval sigma_description="Detection for mshta.exe suspicious execution patterns sometimes involving file polyglotism"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious MSHTA Process Patterns - winevent]
description = Detects suspicious mshta process patterns
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((New_Process_Name="*\\mshta.exe" ((Creator_Process_Name="*\\cmd.exe" OR Creator_Process_Name="*\\powershell.exe" OR Creator_Process_Name="*\\pwsh.exe") OR (Process_Command_Line="*\\AppData\\Local*" OR Process_Command_Line="*C:\\Windows\\Temp*" OR Process_Command_Line="*C:\\Users\\Public*")))) OR ((New_Process_Name="*\\mshta.exe" NOT ((((New_Process_Name="C:\\Windows\\System32*" OR New_Process_Name="C:\\Windows\\SysWOW64*"))) OR (((Process_Command_Line="*.htm*" OR Process_Command_Line="*.hta*") (Process_Command_Line="*mshta.exe" OR Process_Command_Line="*mshta"))))))))) | eval sigma_attack_tags="attack.execution attack.t1106" | eval sigma_title="Suspicious MSHTA Process Patterns" | eval sigma_description="Detects suspicious mshta process patterns"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious MSHTA Process Patterns - sysmon]
description = Detects suspicious mshta process patterns
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((Image="*\\mshta.exe" ((ParentImage="*\\cmd.exe" OR ParentImage="*\\powershell.exe" OR ParentImage="*\\pwsh.exe") OR (CommandLine="*\\AppData\\Local*" OR CommandLine="*C:\\Windows\\Temp*" OR CommandLine="*C:\\Users\\Public*")))) OR ((Image="*\\mshta.exe" NOT ((((Image="C:\\Windows\\System32*" OR Image="C:\\Windows\\SysWOW64*"))) OR (((CommandLine="*.htm*" OR CommandLine="*.hta*") (CommandLine="*mshta.exe" OR CommandLine="*mshta"))))))))) | eval sigma_attack_tags="attack.execution attack.t1106" | eval sigma_title="Suspicious MSHTA Process Patterns" | eval sigma_description="Detects suspicious mshta process patterns"
dispatch.earliest_time = -24h@h
alert.track = 0

[Mshtml DLL RunHTMLApplication Abuse - winevent]
description = Detects suspicious command line using the 'mshtml.dll' RunHTMLApplication export to run arbitrary code via different protocol handlers (vbscript, javascript, file, htpp...)
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*\\..\\*" Process_Command_Line="*mshtml*" Process_Command_Line="*RunHTMLApplication*")) | eval sigma_attack_tags="attack.defense_evasion" | eval sigma_title="Mshtml DLL RunHTMLApplication Abuse" | eval sigma_description="Detects suspicious command line using the 'mshtml.dll' RunHTMLApplication export to run arbitrary code via different protocol handlers (vbscript, javascript, file, htpp...)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Mshtml DLL RunHTMLApplication Abuse - sysmon]
description = Detects suspicious command line using the 'mshtml.dll' RunHTMLApplication export to run arbitrary code via different protocol handlers (vbscript, javascript, file, htpp...)
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*\\..\\*" CommandLine="*mshtml*" CommandLine="*RunHTMLApplication*")) | eval sigma_attack_tags="attack.defense_evasion" | eval sigma_title="Mshtml DLL RunHTMLApplication Abuse" | eval sigma_description="Detects suspicious command line using the 'mshtml.dll' RunHTMLApplication export to run arbitrary code via different protocol handlers (vbscript, javascript, file, htpp...)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious MsiExec Directory - winevent]
description = Detects execution of msiexec from an uncommon directory
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) New_Process_Name="*\\msiexec.exe" NOT (((New_Process_Name="C:\\Windows\\System32\\*" OR New_Process_Name="C:\\Windows\\SysWOW64\\*" OR New_Process_Name="C:\\Windows\\WinSxS\\*"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1036.005" | eval sigma_title="Suspicious MsiExec Directory" | eval sigma_description="Detects execution of msiexec from an uncommon directory"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious MsiExec Directory - sysmon]
description = Detects execution of msiexec from an uncommon directory
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) Image="*\\msiexec.exe" NOT (((Image="C:\\Windows\\System32\\*" OR Image="C:\\Windows\\SysWOW64\\*" OR Image="C:\\Windows\\WinSxS\\*"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1036.005" | eval sigma_title="Suspicious MsiExec Directory" | eval sigma_description="Detects execution of msiexec from an uncommon directory"
dispatch.earliest_time = -24h@h
alert.track = 0

[MsiExec Web Install - winevent]
description = Detects suspicious msiexec process starts with web addresses as parameter
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="* msiexec*" Process_Command_Line="*://*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1218.007 attack.command_and_control attack.t1105" | eval sigma_title="MsiExec Web Install" | eval sigma_description="Detects suspicious msiexec process starts with web addresses as parameter"
dispatch.earliest_time = -24h@h
alert.track = 0

[MsiExec Web Install - sysmon]
description = Detects suspicious msiexec process starts with web addresses as parameter
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="* msiexec*" CommandLine="*://*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1218.007 attack.command_and_control attack.t1105" | eval sigma_title="MsiExec Web Install" | eval sigma_description="Detects suspicious msiexec process starts with web addresses as parameter"
dispatch.earliest_time = -24h@h
alert.track = 0

[Malicious Payload Download via Office Binaries - winevent]
description = Downloads payload from remote server
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (New_Process_Name="*\\powerpnt.exe" OR New_Process_Name="*\\winword.exe" OR New_Process_Name="*\\excel.exe") Process_Command_Line="*http*")) | eval sigma_attack_tags="attack.command_and_control attack.t1105" | eval sigma_title="Malicious Payload Download via Office Binaries" | eval sigma_description="Downloads payload from remote server"
dispatch.earliest_time = -24h@h
alert.track = 0

[Malicious Payload Download via Office Binaries - sysmon]
description = Downloads payload from remote server
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (Image="*\\powerpnt.exe" OR Image="*\\winword.exe" OR Image="*\\excel.exe") CommandLine="*http*")) | eval sigma_attack_tags="attack.command_and_control attack.t1105" | eval sigma_title="Malicious Payload Download via Office Binaries" | eval sigma_description="Downloads payload from remote server"
dispatch.earliest_time = -24h@h
alert.track = 0

[Password Provided In Command Line Of Net.exe - winevent]
description = Detects a when net.exe is called with a password in the command line
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="C:\\Windows\\System32\\net.exe" Process_Command_Line="*net*" Process_Command_Line="* use *" Process_Command_Line="*:*\\\*" Process_Command_Line="*/USER:* *")) NOT (((Process_Command_Line="* "))))) | eval sigma_attack_tags="" | eval sigma_title="Password Provided In Command Line Of Net.exe" | eval sigma_description="Detects a when net.exe is called with a password in the command line"
dispatch.earliest_time = -24h@h
alert.track = 0

[Password Provided In Command Line Of Net.exe - sysmon]
description = Detects a when net.exe is called with a password in the command line
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="C:\\Windows\\System32\\net.exe" CommandLine="*net*" CommandLine="* use *" CommandLine="*:*\\\*" CommandLine="*/USER:* *")) NOT (((CommandLine="* "))))) | eval sigma_attack_tags="" | eval sigma_title="Password Provided In Command Line Of Net.exe" | eval sigma_description="Detects a when net.exe is called with a password in the command line"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Net Use Command Combo - winevent]
description = Detects net use command combo which executes files from WebDAV server; seen in malicious LNK files
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\cmd.exe*" Process_Command_Line="* net use http*" Process_Command_Line="*& start /b *" Process_Command_Line="*\\DavWWWRoot\\*" (Process_Command_Line="*.exe *" OR Process_Command_Line="*.dll *" OR Process_Command_Line="*.bat *" OR Process_Command_Line="*.vbs *" OR Process_Command_Line="*.ps1 *"))) | eval sigma_attack_tags="attack.execution attack.t1059.001" | eval sigma_title="Suspicious Net Use Command Combo" | eval sigma_description="Detects net use command combo which executes files from WebDAV server; seen in malicious LNK files"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Net Use Command Combo - sysmon]
description = Detects net use command combo which executes files from WebDAV server; seen in malicious LNK files
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\cmd.exe*" CommandLine="* net use http*" CommandLine="*& start /b *" CommandLine="*\\DavWWWRoot\\*" (CommandLine="*.exe *" OR CommandLine="*.dll *" OR CommandLine="*.bat *" OR CommandLine="*.vbs *" OR CommandLine="*.ps1 *"))) | eval sigma_attack_tags="attack.execution attack.t1059.001" | eval sigma_title="Suspicious Net Use Command Combo" | eval sigma_description="Detects net use command combo which executes files from WebDAV server; seen in malicious LNK files"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Netsh Discovery Command - winevent]
description = Adversaries may look for details about the network configuration and settings of systems they access or through information discovery of remote systems
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*netsh *" Process_Command_Line="*show *" Process_Command_Line="*firewall *" (Process_Command_Line="*config *" OR Process_Command_Line="*state *" OR Process_Command_Line="*rule *" OR Process_Command_Line="*name=all*"))) | eval sigma_attack_tags="attack.discovery attack.t1016" | eval sigma_title="Suspicious Netsh Discovery Command" | eval sigma_description="Adversaries may look for details about the network configuration and settings of systems they access or through information discovery of remote systems"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Netsh Discovery Command - sysmon]
description = Adversaries may look for details about the network configuration and settings of systems they access or through information discovery of remote systems
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*netsh *" CommandLine="*show *" CommandLine="*firewall *" (CommandLine="*config *" OR CommandLine="*state *" OR CommandLine="*rule *" OR CommandLine="*name=all*"))) | eval sigma_attack_tags="attack.discovery attack.t1016" | eval sigma_title="Suspicious Netsh Discovery Command" | eval sigma_description="Adversaries may look for details about the network configuration and settings of systems they access or through information discovery of remote systems"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Netsh DLL Persistence - winevent]
description = Detects persitence via netsh helper
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\netsh.exe" Process_Command_Line="*add*" Process_Command_Line="*helper*")) | table ComputerName,Account_Name,Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.privilege_escalation attack.t1546.007 attack.s0108" | eval sigma_title="Suspicious Netsh DLL Persistence" | eval sigma_description="Detects persitence via netsh helper"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Netsh DLL Persistence - sysmon]
description = Detects persitence via netsh helper
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\netsh.exe" CommandLine="*add*" CommandLine="*helper*")) | table ComputerName,User,CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.privilege_escalation attack.t1546.007 attack.s0108" | eval sigma_title="Suspicious Netsh DLL Persistence" | eval sigma_description="Detects persitence via netsh helper"
dispatch.earliest_time = -24h@h
alert.track = 0

[Firewall Disabled via Netsh - winevent]
description = Detects netsh commands that turns off the Windows firewall
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((Process_Command_Line="*netsh*" Process_Command_Line="*firewall*" Process_Command_Line="*set*" Process_Command_Line="*opmode*" Process_Command_Line="*mode=disable*")) OR ((Process_Command_Line="*netsh*" Process_Command_Line="*advfirewall*" Process_Command_Line="*set*" Process_Command_Line="*state*" Process_Command_Line="*off*"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.004 attack.s0108" | eval sigma_title="Firewall Disabled via Netsh" | eval sigma_description="Detects netsh commands that turns off the Windows firewall"
dispatch.earliest_time = -24h@h
alert.track = 0

[Firewall Disabled via Netsh - sysmon]
description = Detects netsh commands that turns off the Windows firewall
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((CommandLine="*netsh*" CommandLine="*firewall*" CommandLine="*set*" CommandLine="*opmode*" CommandLine="*mode=disable*")) OR ((CommandLine="*netsh*" CommandLine="*advfirewall*" CommandLine="*set*" CommandLine="*state*" CommandLine="*off*"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.004 attack.s0108" | eval sigma_title="Firewall Disabled via Netsh" | eval sigma_description="Detects netsh commands that turns off the Windows firewall"
dispatch.earliest_time = -24h@h
alert.track = 0

[Execution of NetSupport RAT From Unusual Location - winevent]
description = Detects execution of client32.exe (NetSupport RAT) from an unsual location (outisde of 'C:\Program Files')
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\client32.exe" OR Product="*NetSupport Remote Control*" OR OriginalFileName="*client32.exe*" OR Imphash="a9d50692e95b79723f3e76fcf70d023e" OR Hashes="*IMPHASH=a9d50692e95b79723f3e76fcf70d023e*") NOT (((New_Process_Name="C:\\Program Files\\*" OR New_Process_Name="C:\\Program Files (x86)\\*"))))) | eval sigma_attack_tags="attack.defense_evasion" | eval sigma_title="Execution of NetSupport RAT From Unusual Location" | eval sigma_description="Detects execution of client32.exe (NetSupport RAT) from an unsual location (outisde of 'C:\Program Files')"
dispatch.earliest_time = -24h@h
alert.track = 0

[Execution of NetSupport RAT From Unusual Location - sysmon]
description = Detects execution of client32.exe (NetSupport RAT) from an unsual location (outisde of 'C:\Program Files')
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\client32.exe" OR Product="*NetSupport Remote Control*" OR OriginalFileName="*client32.exe*" OR Imphash="a9d50692e95b79723f3e76fcf70d023e" OR Hashes="*IMPHASH=a9d50692e95b79723f3e76fcf70d023e*") NOT (((Image="C:\\Program Files\\*" OR Image="C:\\Program Files (x86)\\*"))))) | eval sigma_attack_tags="attack.defense_evasion" | eval sigma_title="Execution of NetSupport RAT From Unusual Location" | eval sigma_description="Detects execution of client32.exe (NetSupport RAT) from an unsual location (outisde of 'C:\Program Files')"
dispatch.earliest_time = -24h@h
alert.track = 0

[New Kernel Driver Via SC.EXE - winevent]
description = Detects creation of a new service (kernel driver) with the type 'kernel'
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\sc.exe" (Process_Command_Line="*create*" OR Process_Command_Line="*config*") Process_Command_Line="*binPath*" Process_Command_Line="*type*" Process_Command_Line="*kernel*")) | eval sigma_attack_tags="attack.persistence attack.privilege_escalation attack.t1543.003" | eval sigma_title="New Kernel Driver Via SC.EXE" | eval sigma_description="Detects creation of a new service (kernel driver) with the type 'kernel'"
dispatch.earliest_time = -24h@h
alert.track = 0

[New Kernel Driver Via SC.EXE - sysmon]
description = Detects creation of a new service (kernel driver) with the type 'kernel'
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\sc.exe" (CommandLine="*create*" OR CommandLine="*config*") CommandLine="*binPath*" CommandLine="*type*" CommandLine="*kernel*")) | eval sigma_attack_tags="attack.persistence attack.privilege_escalation attack.t1543.003" | eval sigma_title="New Kernel Driver Via SC.EXE" | eval sigma_description="Detects creation of a new service (kernel driver) with the type 'kernel'"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious New Service Creation - winevent]
description = Detects creation of a new service via 'sc' command or the powershell 'new-service' cmdlet with suspicious binary paths
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((New_Process_Name="*\\sc.exe" Process_Command_Line="*create*" Process_Command_Line="*binPath=*")) OR ((Process_Command_Line="*New-Service*" Process_Command_Line="*-BinaryPathName*"))) (Process_Command_Line="*powershell*" OR Process_Command_Line="*mshta*" OR Process_Command_Line="*wscript*" OR Process_Command_Line="*cscript*" OR Process_Command_Line="*svchost*" OR Process_Command_Line="*dllhost*" OR Process_Command_Line="*cmd *" OR Process_Command_Line="*cmd.exe /c*" OR Process_Command_Line="*cmd.exe /k*" OR Process_Command_Line="*cmd.exe /r*" OR Process_Command_Line="*rundll32*" OR Process_Command_Line="*C:\\Users\\Public*" OR Process_Command_Line="*\\Downloads\\*" OR Process_Command_Line="*\\Desktop\\*" OR Process_Command_Line="*\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\*" OR Process_Command_Line="*C:\\Windows\\TEMP\\*" OR Process_Command_Line="*\\AppData\\Local\\Temp*"))) | eval sigma_attack_tags="attack.persistence attack.privilege_escalation attack.t1543.003" | eval sigma_title="Suspicious New Service Creation" | eval sigma_description="Detects creation of a new service via 'sc' command or the powershell 'new-service' cmdlet with suspicious binary paths"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious New Service Creation - sysmon]
description = Detects creation of a new service via 'sc' command or the powershell 'new-service' cmdlet with suspicious binary paths
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((Image="*\\sc.exe" CommandLine="*create*" CommandLine="*binPath=*")) OR ((CommandLine="*New-Service*" CommandLine="*-BinaryPathName*"))) (CommandLine="*powershell*" OR CommandLine="*mshta*" OR CommandLine="*wscript*" OR CommandLine="*cscript*" OR CommandLine="*svchost*" OR CommandLine="*dllhost*" OR CommandLine="*cmd *" OR CommandLine="*cmd.exe /c*" OR CommandLine="*cmd.exe /k*" OR CommandLine="*cmd.exe /r*" OR CommandLine="*rundll32*" OR CommandLine="*C:\\Users\\Public*" OR CommandLine="*\\Downloads\\*" OR CommandLine="*\\Desktop\\*" OR CommandLine="*\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\*" OR CommandLine="*C:\\Windows\\TEMP\\*" OR CommandLine="*\\AppData\\Local\\Temp*"))) | eval sigma_attack_tags="attack.persistence attack.privilege_escalation attack.t1543.003" | eval sigma_title="Suspicious New Service Creation" | eval sigma_description="Detects creation of a new service via 'sc' command or the powershell 'new-service' cmdlet with suspicious binary paths"
dispatch.earliest_time = -24h@h
alert.track = 0

[Ngrok Usage - winevent]
description = Detects the use of Ngrok, a utility used for port forwarding and tunneling, often used by threat actors to make local protected services publicly available.
Involved domains are bin.equinox.io for download and *.ngrok.io for connections.

search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((Process_Command_Line="* tcp 139*" OR Process_Command_Line="* tcp 445*" OR Process_Command_Line="* tcp 3389*" OR Process_Command_Line="* tcp 5985*" OR Process_Command_Line="* tcp 5986*") OR ((Process_Command_Line="* start *" Process_Command_Line="*--all*" Process_Command_Line="*--config*" Process_Command_Line="*.yml*")) OR ((New_Process_Name="*ngrok.exe" (Process_Command_Line="* tcp *" OR Process_Command_Line="* http *" OR Process_Command_Line="* authtoken *"))) OR (Process_Command_Line="*.exe authtoken *" OR Process_Command_Line="*.exe start --all*")))) | eval sigma_attack_tags="attack.command_and_control attack.t1572" | eval sigma_title="Ngrok Usage" | eval sigma_description="Detects the use of Ngrok, a utility used for port forwarding and tunneling, often used by threat actors to make local protected services publicly available.
Involved domains are bin.equinox.io for download and *.ngrok.io for connections.
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Ngrok Usage - sysmon]
description = Detects the use of Ngrok, a utility used for port forwarding and tunneling, often used by threat actors to make local protected services publicly available.
Involved domains are bin.equinox.io for download and *.ngrok.io for connections.

search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((CommandLine="* tcp 139*" OR CommandLine="* tcp 445*" OR CommandLine="* tcp 3389*" OR CommandLine="* tcp 5985*" OR CommandLine="* tcp 5986*") OR ((CommandLine="* start *" CommandLine="*--all*" CommandLine="*--config*" CommandLine="*.yml*")) OR ((Image="*ngrok.exe" (CommandLine="* tcp *" OR CommandLine="* http *" OR CommandLine="* authtoken *"))) OR (CommandLine="*.exe authtoken *" OR CommandLine="*.exe start --all*")))) | eval sigma_attack_tags="attack.command_and_control attack.t1572" | eval sigma_title="Ngrok Usage" | eval sigma_description="Detects the use of Ngrok, a utility used for port forwarding and tunneling, often used by threat actors to make local protected services publicly available.
Involved domains are bin.equinox.io for download and *.ngrok.io for connections.
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Execution of Suspicious File Type Extension - winevent]
description = Checks whether the image specified in a process creation event doesn't refer to an .exe file (caused by process ghosting or other unorthodox methods to start a process)
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) NOT (((New_Process_Name="*.exe" OR New_Process_Name="*.tmp"))) NOT (((NOT New_Process_Name="*")) OR (((New_Process_Name="System" OR New_Process_Name="Registry" OR New_Process_Name="MemCompression" OR New_Process_Name="vmmem"))) OR (((New_Process_Name="-" OR New_Process_Name=""))) OR ((New_Process_Name="C:\\Windows\\Installer\\MSI*")) OR (((Creator_Process_Name="C:\\ProgramData\\Avira\\*" OR Creator_Process_Name="C:\\Windows\\System32\\DriverStore\\FileRepository\\*"))) OR ((New_Process_Name="*.scr")) OR ((New_Process_Name="*NVIDIA\\NvBackend\\*" New_Process_Name="*.dat")) OR (((New_Process_Name="C:\\Windows\\System32\\*" OR New_Process_Name="C:\\Windows\\SysWOW64\\*") New_Process_Name="*.com")) OR ((New_Process_Name="*\\WinSCP.com")) OR (((New_Process_Name="*C:\\Users\\*" New_Process_Name="*\\AppData\\*" New_Process_Name="*.tmp*" New_Process_Name="*CodeSetup*"))) OR ((New_Process_Name="*\\program\\soffice.bin")) OR (((New_Process_Name="C:\\Program Files\\EMC NetWorker\\Management\\GST\\apache\\cgi-bin\\update_jnlp.cgi" OR New_Process_Name="C:\\Program Files (x86)\\EMC NetWorker\\Management\\GST\\apache\\cgi-bin\\update_jnlp.cgi"))) OR (((New_Process_Name="C:\\Program Files (x86)\\WINPAKPRO\\*" OR New_Process_Name="C:\\Program Files\\WINPAKPRO\\*") New_Process_Name="*.ngn")) OR (((New_Process_Name="C:\\Program Files (x86)\\MyQ\\Server\\pcltool.dll" OR New_Process_Name="C:\\Program Files\\MyQ\\Server\\pcltool.dll"))) OR (((New_Process_Name="C:\\Program Files\\Microsoft Visual Studio\\*" OR New_Process_Name="C:\\Program Files (x86)\\Microsoft Visual Studio*") New_Process_Name="*.com")) OR ((New_Process_Name="C:\\Config.Msi\\*" (New_Process_Name="*.rbf" OR New_Process_Name="*.rbs"))) OR (((New_Process_Name="*\\AppData\\Local\\Packages\\*" New_Process_Name="*\\LocalState\\rootfs\\*"))) OR ((New_Process_Name="*\\LZMA_EXE")) OR ((Creator_Process_Name="C:\\Windows\\Temp\\*" New_Process_Name="C:\\Windows\\Temp\\Helper\\*")) OR ((Creator_Process_Name="C:\\Windows\\Temp\\*" Creator_Process_Name="*\\TBT_Dock_Firmware\\GetDockVer32W.exe")) OR ((New_Process_Name="C:\\Program Files\\Mozilla Firefox\\tobedeleted\\*"))))) | eval sigma_attack_tags="attack.defense_evasion" | eval sigma_title="Execution of Suspicious File Type Extension" | eval sigma_description="Checks whether the image specified in a process creation event doesn't refer to an .exe file (caused by process ghosting or other unorthodox methods to start a process)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Execution of Suspicious File Type Extension - sysmon]
description = Checks whether the image specified in a process creation event doesn't refer to an .exe file (caused by process ghosting or other unorthodox methods to start a process)
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) NOT (((Image="*.exe" OR Image="*.tmp"))) NOT (((NOT Image="*")) OR (((Image="System" OR Image="Registry" OR Image="MemCompression" OR Image="vmmem"))) OR (((Image="-" OR Image=""))) OR ((Image="C:\\Windows\\Installer\\MSI*")) OR (((ParentImage="C:\\ProgramData\\Avira\\*" OR ParentImage="C:\\Windows\\System32\\DriverStore\\FileRepository\\*"))) OR ((Image="*.scr")) OR ((Image="*NVIDIA\\NvBackend\\*" Image="*.dat")) OR (((Image="C:\\Windows\\System32\\*" OR Image="C:\\Windows\\SysWOW64\\*") Image="*.com")) OR ((Image="*\\WinSCP.com")) OR (((Image="*C:\\Users\\*" Image="*\\AppData\\*" Image="*.tmp*" Image="*CodeSetup*"))) OR ((Image="*\\program\\soffice.bin")) OR (((Image="C:\\Program Files\\EMC NetWorker\\Management\\GST\\apache\\cgi-bin\\update_jnlp.cgi" OR Image="C:\\Program Files (x86)\\EMC NetWorker\\Management\\GST\\apache\\cgi-bin\\update_jnlp.cgi"))) OR (((Image="C:\\Program Files (x86)\\WINPAKPRO\\*" OR Image="C:\\Program Files\\WINPAKPRO\\*") Image="*.ngn")) OR (((Image="C:\\Program Files (x86)\\MyQ\\Server\\pcltool.dll" OR Image="C:\\Program Files\\MyQ\\Server\\pcltool.dll"))) OR (((Image="C:\\Program Files\\Microsoft Visual Studio\\*" OR Image="C:\\Program Files (x86)\\Microsoft Visual Studio*") Image="*.com")) OR ((Image="C:\\Config.Msi\\*" (Image="*.rbf" OR Image="*.rbs"))) OR (((Image="*\\AppData\\Local\\Packages\\*" Image="*\\LocalState\\rootfs\\*"))) OR ((Image="*\\LZMA_EXE")) OR ((ParentImage="C:\\Windows\\Temp\\*" Image="C:\\Windows\\Temp\\Helper\\*")) OR ((ParentImage="C:\\Windows\\Temp\\*" ParentImage="*\\TBT_Dock_Firmware\\GetDockVer32W.exe")) OR ((Image="C:\\Program Files\\Mozilla Firefox\\tobedeleted\\*"))))) | eval sigma_attack_tags="attack.defense_evasion" | eval sigma_title="Execution of Suspicious File Type Extension" | eval sigma_description="Checks whether the image specified in a process creation event doesn't refer to an .exe file (caused by process ghosting or other unorthodox methods to start a process)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious NT Resource Kit Auditpol Usage - winevent]
description = Threat actors can use an older version of the auditpol binary available inside the NT resource kit to change audit policy configuration to impair detection capability.
This can be carried out by selectively disabling/removing certain audit policies as well as restoring a custom policy owned by the threat actor.

search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (Process_Command_Line="*/logon:none*" OR Process_Command_Line="*/system:none*" OR Process_Command_Line="*/sam:none*" OR Process_Command_Line="*/privilege:none*" OR Process_Command_Line="*/object:none*" OR Process_Command_Line="*/process:none*" OR Process_Command_Line="*/policy:none*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.002" | eval sigma_title="Suspicious NT Resource Kit Auditpol Usage" | eval sigma_description="Threat actors can use an older version of the auditpol binary available inside the NT resource kit to change audit policy configuration to impair detection capability.
This can be carried out by selectively disabling/removing certain audit policies as well as restoring a custom policy owned by the threat actor.
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious NT Resource Kit Auditpol Usage - sysmon]
description = Threat actors can use an older version of the auditpol binary available inside the NT resource kit to change audit policy configuration to impair detection capability.
This can be carried out by selectively disabling/removing certain audit policies as well as restoring a custom policy owned by the threat actor.

search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (CommandLine="*/logon:none*" OR CommandLine="*/system:none*" OR CommandLine="*/sam:none*" OR CommandLine="*/privilege:none*" OR CommandLine="*/object:none*" OR CommandLine="*/process:none*" OR CommandLine="*/policy:none*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.002" | eval sigma_title="Suspicious NT Resource Kit Auditpol Usage" | eval sigma_description="Threat actors can use an older version of the auditpol binary available inside the NT resource kit to change audit policy configuration to impair detection capability.
This can be carried out by selectively disabling/removing certain audit policies as well as restoring a custom policy owned by the threat actor.
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Ntdll Pipe Redirection - winevent]
description = Detects command that type the content of ntdll.dll to a different file or a pipe in order to evade AV / EDR detection
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (Process_Command_Line="*type %windir%\\system32\\ntdll.dll*" OR Process_Command_Line="*type %systemroot%\\system32\\ntdll.dll*" OR Process_Command_Line="*type c:\\windows\\system32\\ntdll.dll*" OR Process_Command_Line="*\\ntdll.dll > \\\\.\\pipe\\\*"))) | eval sigma_attack_tags="attack.defense_evasion" | eval sigma_title="Suspicious Ntdll Pipe Redirection" | eval sigma_description="Detects command that type the content of ntdll.dll to a different file or a pipe in order to evade AV / EDR detection"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Ntdll Pipe Redirection - sysmon]
description = Detects command that type the content of ntdll.dll to a different file or a pipe in order to evade AV / EDR detection
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (CommandLine="*type %windir%\\system32\\ntdll.dll*" OR CommandLine="*type %systemroot%\\system32\\ntdll.dll*" OR CommandLine="*type c:\\windows\\system32\\ntdll.dll*" OR CommandLine="*\\ntdll.dll > \\\\.\\pipe\\\*"))) | eval sigma_attack_tags="attack.defense_evasion" | eval sigma_title="Suspicious Ntdll Pipe Redirection" | eval sigma_description="Detects command that type the content of ntdll.dll to a different file or a pipe in order to evade AV / EDR detection"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Process Patterns NTDS.DIT Exfil - winevent]
description = Detects suspicious process patterns used in NTDS.DIT exfiltration
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((((New_Process_Name="*\\NTDSDump.exe" OR New_Process_Name="*\\NTDSDumpEx.exe") OR ((Process_Command_Line="*ntds.dit*" Process_Command_Line="*system.hiv*")) OR Process_Command_Line="*NTDSgrab.ps1*") OR ((Process_Command_Line="*ac i ntds*" Process_Command_Line="*create full*")) OR ((Process_Command_Line="*/c copy *" Process_Command_Line="*\\windows\\ntds\\ntds.dit*")) OR ((Process_Command_Line="*activate instance ntds*" Process_Command_Line="*create full*")) OR ((Process_Command_Line="*powershell*" Process_Command_Line="*ntds.dit*"))) OR ((Process_Command_Line="*ntds.dit*" ((Creator_Process_Name="*\\apache*" OR Creator_Process_Name="*\\tomcat*" OR Creator_Process_Name="*\\AppData\\*" OR Creator_Process_Name="*\\Temp\\*" OR Creator_Process_Name="*\\Public\\*" OR Creator_Process_Name="*\\PerfLogs\\*") OR (New_Process_Name="*\\apache*" OR New_Process_Name="*\\tomcat*" OR New_Process_Name="*\\AppData\\*" OR New_Process_Name="*\\Temp\\*" OR New_Process_Name="*\\Public\\*" OR New_Process_Name="*\\PerfLogs\\*"))))))) | eval sigma_attack_tags="attack.credential_access attack.t1003.003" | eval sigma_title="Suspicious Process Patterns NTDS.DIT Exfil" | eval sigma_description="Detects suspicious process patterns used in NTDS.DIT exfiltration"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Process Patterns NTDS.DIT Exfil - sysmon]
description = Detects suspicious process patterns used in NTDS.DIT exfiltration
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((((Image="*\\NTDSDump.exe" OR Image="*\\NTDSDumpEx.exe") OR ((CommandLine="*ntds.dit*" CommandLine="*system.hiv*")) OR CommandLine="*NTDSgrab.ps1*") OR ((CommandLine="*ac i ntds*" CommandLine="*create full*")) OR ((CommandLine="*/c copy *" CommandLine="*\\windows\\ntds\\ntds.dit*")) OR ((CommandLine="*activate instance ntds*" CommandLine="*create full*")) OR ((CommandLine="*powershell*" CommandLine="*ntds.dit*"))) OR ((CommandLine="*ntds.dit*" ((ParentImage="*\\apache*" OR ParentImage="*\\tomcat*" OR ParentImage="*\\AppData\\*" OR ParentImage="*\\Temp\\*" OR ParentImage="*\\Public\\*" OR ParentImage="*\\PerfLogs\\*") OR (Image="*\\apache*" OR Image="*\\tomcat*" OR Image="*\\AppData\\*" OR Image="*\\Temp\\*" OR Image="*\\Public\\*" OR Image="*\\PerfLogs\\*"))))))) | eval sigma_attack_tags="attack.credential_access attack.t1003.003" | eval sigma_title="Suspicious Process Patterns NTDS.DIT Exfil" | eval sigma_description="Detects suspicious process patterns used in NTDS.DIT exfiltration"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Usage Of Active Directory Diagnostic Tool (ntdsutil.exe) - winevent]
description = Detects execution of ntdsutil.exe to perform different actions such as restoring snapshots...etc.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\ntdsutil.exe" OR OriginalFileName="ntdsutil.exe") (((Process_Command_Line="*snapshot*" Process_Command_Line="*mount *")) OR ((Process_Command_Line="*ac*" Process_Command_Line="* i*" Process_Command_Line="* ntds*"))))) | eval sigma_attack_tags="attack.credential_access attack.t1003.003" | eval sigma_title="Suspicious Usage Of Active Directory Diagnostic Tool (ntdsutil.exe)" | eval sigma_description="Detects execution of ntdsutil.exe to perform different actions such as restoring snapshots...etc."
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Usage Of Active Directory Diagnostic Tool (ntdsutil.exe) - sysmon]
description = Detects execution of ntdsutil.exe to perform different actions such as restoring snapshots...etc.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\ntdsutil.exe" OR OriginalFileName="ntdsutil.exe") (((CommandLine="*snapshot*" CommandLine="*mount *")) OR ((CommandLine="*ac*" CommandLine="* i*" CommandLine="* ntds*"))))) | eval sigma_attack_tags="attack.credential_access attack.t1003.003" | eval sigma_title="Suspicious Usage Of Active Directory Diagnostic Tool (ntdsutil.exe)" | eval sigma_description="Detects execution of ntdsutil.exe to perform different actions such as restoring snapshots...etc."
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious NTLM Authentication on the Printer Spooler Service - winevent]
description = Detects a privilege elevation attempt by coercing NTLM authentication on the Printer Spooler service
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\rundll32.exe" Process_Command_Line="*C:\\windows\\system32\\davclnt.dll,DavSetCookie*" Process_Command_Line="*http*" (Process_Command_Line="*spoolss*" OR Process_Command_Line="*srvsvc*" OR Process_Command_Line="*/print/pipe/*"))) | eval sigma_attack_tags="attack.privilege_escalation attack.credential_access attack.t1212" | eval sigma_title="Suspicious NTLM Authentication on the Printer Spooler Service" | eval sigma_description="Detects a privilege elevation attempt by coercing NTLM authentication on the Printer Spooler service"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious NTLM Authentication on the Printer Spooler Service - sysmon]
description = Detects a privilege elevation attempt by coercing NTLM authentication on the Printer Spooler service
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\rundll32.exe" CommandLine="*C:\\windows\\system32\\davclnt.dll,DavSetCookie*" CommandLine="*http*" (CommandLine="*spoolss*" OR CommandLine="*srvsvc*" OR CommandLine="*/print/pipe/*"))) | eval sigma_attack_tags="attack.privilege_escalation attack.credential_access attack.t1212" | eval sigma_title="Suspicious NTLM Authentication on the Printer Spooler Service" | eval sigma_description="Detects a privilege elevation attempt by coercing NTLM authentication on the Printer Spooler service"
dispatch.earliest_time = -24h@h
alert.track = 0

[Application Whitelisting Bypass via DLL Loaded by odbcconf.exe - winevent]
description = Detects defence evasion attempt via odbcconf.exe execution to load DLL
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((((New_Process_Name="*\\odbcconf.exe" OR OriginalFileName="odbcconf.exe") (Process_Command_Line="*-a*" OR Process_Command_Line="*-f*" OR Process_Command_Line="*/a*" OR Process_Command_Line="*/f*" OR Process_Command_Line="*regsvr*"))) OR ((Creator_Process_Name="*\\odbcconf.exe" New_Process_Name="*\\rundll32.exe"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218.008" | eval sigma_title="Application Whitelisting Bypass via DLL Loaded by odbcconf.exe" | eval sigma_description="Detects defence evasion attempt via odbcconf.exe execution to load DLL"
dispatch.earliest_time = -24h@h
alert.track = 0

[Application Whitelisting Bypass via DLL Loaded by odbcconf.exe - sysmon]
description = Detects defence evasion attempt via odbcconf.exe execution to load DLL
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((((Image="*\\odbcconf.exe" OR OriginalFileName="odbcconf.exe") (CommandLine="*-a*" OR CommandLine="*-f*" OR CommandLine="*/a*" OR CommandLine="*/f*" OR CommandLine="*regsvr*"))) OR ((ParentImage="*\\odbcconf.exe" Image="*\\rundll32.exe"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218.008" | eval sigma_title="Application Whitelisting Bypass via DLL Loaded by odbcconf.exe" | eval sigma_description="Detects defence evasion attempt via odbcconf.exe execution to load DLL"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Office Token Search Via CLI - winevent]
description = Detects possible search for office tokens via CLI by looking for the string 'eyJ0eX'. This string is used as an anchor to look for the start of the JWT token used by office and similar apps.
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (Process_Command_Line="*eyJ0eXAiOi*" OR Process_Command_Line="* eyJ0eX*" OR Process_Command_Line="* \"eyJ0eX\"*" OR Process_Command_Line="* 'eyJ0eX'*"))) | eval sigma_attack_tags="attack.credential_access attack.t1528" | eval sigma_title="Suspicious Office Token Search Via CLI" | eval sigma_description="Detects possible search for office tokens via CLI by looking for the string 'eyJ0eX'. This string is used as an anchor to look for the start of the JWT token used by office and similar apps."
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Office Token Search Via CLI - sysmon]
description = Detects possible search for office tokens via CLI by looking for the string 'eyJ0eX'. This string is used as an anchor to look for the start of the JWT token used by office and similar apps.
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (CommandLine="*eyJ0eXAiOi*" OR CommandLine="* eyJ0eX*" OR CommandLine="* \"eyJ0eX\"*" OR CommandLine="* 'eyJ0eX'*"))) | eval sigma_attack_tags="attack.credential_access attack.t1528" | eval sigma_title="Suspicious Office Token Search Via CLI" | eval sigma_description="Detects possible search for office tokens via CLI by looking for the string 'eyJ0eX'. This string is used as an anchor to look for the start of the JWT token used by office and similar apps."
dispatch.earliest_time = -24h@h
alert.track = 0

[OpenWith.exe Executes Specified Binary - winevent]
description = The OpenWith.exe executes other binary
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\OpenWith.exe" Process_Command_Line="*/c*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1218" | eval sigma_title="OpenWith.exe Executes Specified Binary" | eval sigma_description="The OpenWith.exe executes other binary"
dispatch.earliest_time = -24h@h
alert.track = 0

[OpenWith.exe Executes Specified Binary - sysmon]
description = The OpenWith.exe executes other binary
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\OpenWith.exe" CommandLine="*/c*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1218" | eval sigma_title="OpenWith.exe Executes Specified Binary" | eval sigma_description="The OpenWith.exe executes other binary"
dispatch.earliest_time = -24h@h
alert.track = 0

[Execution in Outlook Temp Folder - winevent]
description = Detects a suspicious program execution in Outlook temp folder
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\Temporary Internet Files\\Content.Outlook\\*")) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.initial_access attack.t1566.001" | eval sigma_title="Execution in Outlook Temp Folder" | eval sigma_description="Detects a suspicious program execution in Outlook temp folder"
dispatch.earliest_time = -24h@h
alert.track = 0

[Execution in Outlook Temp Folder - sysmon]
description = Detects a suspicious program execution in Outlook temp folder
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\Temporary Internet Files\\Content.Outlook\\*")) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.initial_access attack.t1566.001" | eval sigma_title="Execution in Outlook Temp Folder" | eval sigma_description="Detects a suspicious program execution in Outlook temp folder"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Execution from Outlook - winevent]
description = Detects EnableUnsafeClientMailRules used for Script Execution from Outlook
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (Process_Command_Line="*EnableUnsafeClientMailRules*" OR ((Creator_Process_Name="*\\outlook.exe" Process_Command_Line="*\\\\\*" Process_Command_Line="*\\\*" Process_Command_Line="*.exe*"))))) | eval sigma_attack_tags="attack.execution attack.t1059 attack.t1202" | eval sigma_title="Suspicious Execution from Outlook" | eval sigma_description="Detects EnableUnsafeClientMailRules used for Script Execution from Outlook"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Execution from Outlook - sysmon]
description = Detects EnableUnsafeClientMailRules used for Script Execution from Outlook
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (CommandLine="*EnableUnsafeClientMailRules*" OR ((ParentImage="*\\outlook.exe" CommandLine="*\\\\\*" CommandLine="*\\\*" CommandLine="*.exe*"))))) | eval sigma_attack_tags="attack.execution attack.t1059 attack.t1202" | eval sigma_title="Suspicious Execution from Outlook" | eval sigma_description="Detects EnableUnsafeClientMailRules used for Script Execution from Outlook"
dispatch.earliest_time = -24h@h
alert.track = 0

[Conhost Spawned By Suspicious Parent Process - winevent]
description = Detects when the Console Window Host (conhost.exe) process is spawned by a suspicious parent process, which could be indicative of code injection.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\conhost.exe" (Creator_Process_Name="*\\svchost.exe" OR Creator_Process_Name="*\\lsass.exe" OR Creator_Process_Name="*\\services.exe" OR Creator_Process_Name="*\\smss.exe" OR Creator_Process_Name="*\\winlogon.exe" OR Creator_Process_Name="*\\explorer.exe" OR Creator_Process_Name="*\\rundll32.exe" OR Creator_Process_Name="*\\regsvr32.exe" OR Creator_Process_Name="*\\userinit.exe" OR Creator_Process_Name="*\\wininit.exe" OR Creator_Process_Name="*\\spoolsv.exe"))) NOT (((ParentCommandLine="*-k apphost -s AppHostSvc*" OR ParentCommandLine="*-k imgsvc*" OR ParentCommandLine="*-k localService -p -s RemoteRegistry*" OR ParentCommandLine="*-k LocalSystemNetworkRestricted -p -s NgcSvc*" OR ParentCommandLine="*-k NetSvcs -p -s NcaSvc*" OR ParentCommandLine="*-k netsvcs -p -s NetSetupSvc*" OR ParentCommandLine="*-k netsvcs -p -s wlidsvc*" OR ParentCommandLine="*-k NetworkService -p -s DoSvc*" OR ParentCommandLine="*-k wsappx -p -s AppXSvc*" OR ParentCommandLine="*-k wsappx -p -s ClipSVC*" OR ParentCommandLine="*C:\\Program Files (x86)\\Dropbox\\Client\\*" OR ParentCommandLine="*C:\\Program Files\\Dropbox\\Client\\*"))))) | eval sigma_attack_tags="attack.execution attack.t1059" | eval sigma_title="Conhost Spawned By Suspicious Parent Process" | eval sigma_description="Detects when the Console Window Host (conhost.exe) process is spawned by a suspicious parent process, which could be indicative of code injection."
dispatch.earliest_time = -24h@h
alert.track = 0

[Conhost Spawned By Suspicious Parent Process - sysmon]
description = Detects when the Console Window Host (conhost.exe) process is spawned by a suspicious parent process, which could be indicative of code injection.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\conhost.exe" (ParentImage="*\\svchost.exe" OR ParentImage="*\\lsass.exe" OR ParentImage="*\\services.exe" OR ParentImage="*\\smss.exe" OR ParentImage="*\\winlogon.exe" OR ParentImage="*\\explorer.exe" OR ParentImage="*\\rundll32.exe" OR ParentImage="*\\regsvr32.exe" OR ParentImage="*\\userinit.exe" OR ParentImage="*\\wininit.exe" OR ParentImage="*\\spoolsv.exe"))) NOT (((ParentCommandLine="*-k apphost -s AppHostSvc*" OR ParentCommandLine="*-k imgsvc*" OR ParentCommandLine="*-k localService -p -s RemoteRegistry*" OR ParentCommandLine="*-k LocalSystemNetworkRestricted -p -s NgcSvc*" OR ParentCommandLine="*-k NetSvcs -p -s NcaSvc*" OR ParentCommandLine="*-k netsvcs -p -s NetSetupSvc*" OR ParentCommandLine="*-k netsvcs -p -s wlidsvc*" OR ParentCommandLine="*-k NetworkService -p -s DoSvc*" OR ParentCommandLine="*-k wsappx -p -s AppXSvc*" OR ParentCommandLine="*-k wsappx -p -s ClipSVC*" OR ParentCommandLine="*C:\\Program Files (x86)\\Dropbox\\Client\\*" OR ParentCommandLine="*C:\\Program Files\\Dropbox\\Client\\*"))))) | eval sigma_attack_tags="attack.execution attack.t1059" | eval sigma_title="Conhost Spawned By Suspicious Parent Process" | eval sigma_description="Detects when the Console Window Host (conhost.exe) process is spawned by a suspicious parent process, which could be indicative of code injection."
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Process Parents - winevent]
description = Detects suspicious parent processes that should not have any children or should only have a single possible child program
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((Creator_Process_Name="*\\minesweeper.exe" OR Creator_Process_Name="*\\winver.exe" OR Creator_Process_Name="*\\bitsadmin.exe") OR (((Creator_Process_Name="*\\csrss.exe" OR Creator_Process_Name="*\\certutil.exe" OR Creator_Process_Name="*\\eventvwr.exe" OR Creator_Process_Name="*\\calc.exe" OR Creator_Process_Name="*\\notepad.exe") NOT ((((New_Process_Name="*\\WerFault.exe" OR New_Process_Name="*\\wermgr.exe" OR New_Process_Name="*\\conhost.exe" OR New_Process_Name="*\\mmc.exe" OR New_Process_Name="*\\win32calc.exe" OR New_Process_Name="*\\notepad.exe"))) OR ((NOT New_Process_Name="*")))))))) | eval sigma_attack_tags="" | eval sigma_title="Suspicious Process Parents" | eval sigma_description="Detects suspicious parent processes that should not have any children or should only have a single possible child program"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Process Parents - sysmon]
description = Detects suspicious parent processes that should not have any children or should only have a single possible child program
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((ParentImage="*\\minesweeper.exe" OR ParentImage="*\\winver.exe" OR ParentImage="*\\bitsadmin.exe") OR (((ParentImage="*\\csrss.exe" OR ParentImage="*\\certutil.exe" OR ParentImage="*\\eventvwr.exe" OR ParentImage="*\\calc.exe" OR ParentImage="*\\notepad.exe") NOT ((((Image="*\\WerFault.exe" OR Image="*\\wermgr.exe" OR Image="*\\conhost.exe" OR Image="*\\mmc.exe" OR Image="*\\win32calc.exe" OR Image="*\\notepad.exe"))) OR ((NOT Image="*")))))))) | eval sigma_attack_tags="" | eval sigma_title="Suspicious Process Parents" | eval sigma_description="Detects suspicious parent processes that should not have any children or should only have a single possible child program"
dispatch.earliest_time = -24h@h
alert.track = 0

[PCHunter Usage - winevent]
description = Detects suspicious use of PCHunter, a tool like Process Hacker to view and manipulate processes, kernel options and other low level stuff
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\PCHunter64.exe" OR New_Process_Name="*\\PCHunter32.exe") OR OriginalFileName="PCHunter.exe" OR Description="Epoolsoft Windows Information View Tools" OR (Hashes="*SHA1=5F1CBC3D99558307BC1250D084FA968521482025*" OR Hashes="*MD5=987B65CD9B9F4E9A1AFD8F8B48CF64A7*" OR Hashes="*SHA256=2B214BDDAAB130C274DE6204AF6DBA5AEEC7433DA99AA950022FA306421A6D32*" OR Hashes="*IMPHASH=444D210CEA1FF8112F256A4997EED7FF*" OR Hashes="*SHA1=3FB89787CB97D902780DA080545584D97FB1C2EB*" OR Hashes="*MD5=228DD0C2E6287547E26FFBD973A40F14*" OR Hashes="*SHA256=55F041BF4E78E9BFA6D4EE68BE40E496CE3A1353E1CA4306598589E19802522C*" OR Hashes="*IMPHASH=0479F44DF47CFA2EF1CCC4416A538663*") OR (md5="228dd0c2e6287547e26ffbd973a40f14" OR md5="987b65cd9b9f4e9a1afd8f8b48cf64a7") OR (sha1="5f1cbc3d99558307bc1250d084fa968521482025" OR sha1="3fb89787cb97d902780da080545584d97fb1c2eb") OR (sha256="2b214bddaab130c274de6204af6dba5aeec7433da99aa950022fa306421a6d32" OR sha256="55f041bf4e78e9bfa6d4ee68be40e496ce3a1353e1ca4306598589e19802522c") OR (Imphash="444d210cea1ff8112f256a4997eed7ff" OR Imphash="0479f44df47cfa2ef1ccc4416a538663")))) | eval sigma_attack_tags="" | eval sigma_title="PCHunter Usage" | eval sigma_description="Detects suspicious use of PCHunter, a tool like Process Hacker to view and manipulate processes, kernel options and other low level stuff"
dispatch.earliest_time = -24h@h
alert.track = 0

[PCHunter Usage - sysmon]
description = Detects suspicious use of PCHunter, a tool like Process Hacker to view and manipulate processes, kernel options and other low level stuff
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\PCHunter64.exe" OR Image="*\\PCHunter32.exe") OR OriginalFileName="PCHunter.exe" OR Description="Epoolsoft Windows Information View Tools" OR (Hashes="*SHA1=5F1CBC3D99558307BC1250D084FA968521482025*" OR Hashes="*MD5=987B65CD9B9F4E9A1AFD8F8B48CF64A7*" OR Hashes="*SHA256=2B214BDDAAB130C274DE6204AF6DBA5AEEC7433DA99AA950022FA306421A6D32*" OR Hashes="*IMPHASH=444D210CEA1FF8112F256A4997EED7FF*" OR Hashes="*SHA1=3FB89787CB97D902780DA080545584D97FB1C2EB*" OR Hashes="*MD5=228DD0C2E6287547E26FFBD973A40F14*" OR Hashes="*SHA256=55F041BF4E78E9BFA6D4EE68BE40E496CE3A1353E1CA4306598589E19802522C*" OR Hashes="*IMPHASH=0479F44DF47CFA2EF1CCC4416A538663*") OR (md5="228dd0c2e6287547e26ffbd973a40f14" OR md5="987b65cd9b9f4e9a1afd8f8b48cf64a7") OR (sha1="5f1cbc3d99558307bc1250d084fa968521482025" OR sha1="3fb89787cb97d902780da080545584d97fb1c2eb") OR (sha256="2b214bddaab130c274de6204af6dba5aeec7433da99aa950022fa306421a6d32" OR sha256="55f041bf4e78e9bfa6d4ee68be40e496ce3a1353e1ca4306598589e19802522c") OR (Imphash="444d210cea1ff8112f256a4997eed7ff" OR Imphash="0479f44df47cfa2ef1ccc4416a538663")))) | eval sigma_attack_tags="" | eval sigma_title="PCHunter Usage" | eval sigma_description="Detects suspicious use of PCHunter, a tool like Process Hacker to view and manipulate processes, kernel options and other low level stuff"
dispatch.earliest_time = -24h@h
alert.track = 0

[Code Execution via Pcwutl.dll - winevent]
description = Detects launch of executable by calling the LaunchApplication function from pcwutl.dll library.
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\rundll32.exe" Process_Command_Line="*pcwutl*" Process_Command_Line="*LaunchApplication*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1218.011" | eval sigma_title="Code Execution via Pcwutl.dll" | eval sigma_description="Detects launch of executable by calling the LaunchApplication function from pcwutl.dll library."
dispatch.earliest_time = -24h@h
alert.track = 0

[Code Execution via Pcwutl.dll - sysmon]
description = Detects launch of executable by calling the LaunchApplication function from pcwutl.dll library.
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\rundll32.exe" CommandLine="*pcwutl*" CommandLine="*LaunchApplication*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1218.011" | eval sigma_title="Code Execution via Pcwutl.dll" | eval sigma_description="Detects launch of executable by calling the LaunchApplication function from pcwutl.dll library."
dispatch.earliest_time = -24h@h
alert.track = 0

[Execute Code with Pester.bat as Parent - winevent]
description = Detects code execution via Pester.bat (Pester - Powershell Modulte for testing)
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (Creator_Process_Name="*\\powershell.exe" OR Creator_Process_Name="*\\pwsh.exe") ParentCommandLine="*\\WindowsPowerShell\\Modules\\Pester\\*" (ParentCommandLine="*{ Invoke-Pester -EnableExit ;*" OR ParentCommandLine="*{ Get-Help \"*"))) | eval sigma_attack_tags="attack.execution attack.t1059.001 attack.defense_evasion attack.t1216" | eval sigma_title="Execute Code with Pester.bat as Parent" | eval sigma_description="Detects code execution via Pester.bat (Pester - Powershell Modulte for testing)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Execute Code with Pester.bat as Parent - sysmon]
description = Detects code execution via Pester.bat (Pester - Powershell Modulte for testing)
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (ParentImage="*\\powershell.exe" OR ParentImage="*\\pwsh.exe") ParentCommandLine="*\\WindowsPowerShell\\Modules\\Pester\\*" (ParentCommandLine="*{ Invoke-Pester -EnableExit ;*" OR ParentCommandLine="*{ Get-Help \"*"))) | eval sigma_attack_tags="attack.execution attack.t1059.001 attack.defense_evasion attack.t1216" | eval sigma_title="Execute Code with Pester.bat as Parent" | eval sigma_description="Detects code execution via Pester.bat (Pester - Powershell Modulte for testing)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Execute Code with Pester.bat - winevent]
description = Detects code execution via Pester.bat (Pester - Powershell Modulte for testing)
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((((New_Process_Name="*\\powershell.exe" OR New_Process_Name="*\\pwsh.exe") Process_Command_Line="*Pester*" Process_Command_Line="*Get-Help*")) OR ((New_Process_Name="*\\cmd.exe" Process_Command_Line="*pester*" Process_Command_Line="*;*" (Process_Command_Line="*help*" OR Process_Command_Line="*?*")))))) | eval sigma_attack_tags="attack.execution attack.t1059.001 attack.defense_evasion attack.t1216" | eval sigma_title="Execute Code with Pester.bat" | eval sigma_description="Detects code execution via Pester.bat (Pester - Powershell Modulte for testing)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Execute Code with Pester.bat - sysmon]
description = Detects code execution via Pester.bat (Pester - Powershell Modulte for testing)
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((((Image="*\\powershell.exe" OR Image="*\\pwsh.exe") CommandLine="*Pester*" CommandLine="*Get-Help*")) OR ((Image="*\\cmd.exe" CommandLine="*pester*" CommandLine="*;*" (CommandLine="*help*" OR CommandLine="*?*")))))) | eval sigma_attack_tags="attack.execution attack.t1059.001 attack.defense_evasion attack.t1216" | eval sigma_title="Execute Code with Pester.bat" | eval sigma_description="Detects code execution via Pester.bat (Pester - Powershell Modulte for testing)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Ping And Del Combination - winevent]
description = Detects a method often used by ransomware. Which combines the 'ping' to wait a couple of seconds and then 'del' to delete the file in question. Its used to hide the file responsible for the initial infection for example
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (Process_Command_Line="* -n *" OR Process_Command_Line="* /n *") Process_Command_Line="*Nul*" (" /f " OR " -f " OR " /q " OR " -q ") ((Process_Command_Line="*ping*" Process_Command_Line="*del *")))) | eval sigma_attack_tags="attack.defense_evasion attack.t1070.004" | eval sigma_title="Suspicious Ping And Del Combination" | eval sigma_description="Detects a method often used by ransomware. Which combines the 'ping' to wait a couple of seconds and then 'del' to delete the file in question. Its used to hide the file responsible for the initial infection for example"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Ping And Del Combination - sysmon]
description = Detects a method often used by ransomware. Which combines the 'ping' to wait a couple of seconds and then 'del' to delete the file in question. Its used to hide the file responsible for the initial infection for example
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (CommandLine="* -n *" OR CommandLine="* /n *") CommandLine="*Nul*" (" /f " OR " -f " OR " /q " OR " -q ") ((CommandLine="*ping*" CommandLine="*del *")))) | eval sigma_attack_tags="attack.defense_evasion attack.t1070.004" | eval sigma_title="Suspicious Ping And Del Combination" | eval sigma_description="Detects a method often used by ransomware. Which combines the 'ping' to wait a couple of seconds and then 'del' to delete the file in question. Its used to hide the file responsible for the initial infection for example"
dispatch.earliest_time = -24h@h
alert.track = 0

[Ping Hex IP - winevent]
description = Detects a ping command that uses a hex encoded IP address
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\ping.exe" Process_Command_Line="*0x*")) | table ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.t1140 attack.t1027" | eval sigma_title="Ping Hex IP" | eval sigma_description="Detects a ping command that uses a hex encoded IP address"
dispatch.earliest_time = -24h@h
alert.track = 0

[Ping Hex IP - sysmon]
description = Detects a ping command that uses a hex encoded IP address
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\ping.exe" CommandLine="*0x*")) | table ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.t1140 attack.t1027" | eval sigma_title="Ping Hex IP" | eval sigma_description="Detects a ping command that uses a hex encoded IP address"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Plink Port Forwarding - winevent]
description = Detects suspicious Plink tunnel port forwarding to a local port
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Description="Command-line SSH, Telnet, and Rlogin client" Process_Command_Line="* -R *")) | eval sigma_attack_tags="attack.command_and_control attack.t1572 attack.lateral_movement attack.t1021.001" | eval sigma_title="Suspicious Plink Port Forwarding" | eval sigma_description="Detects suspicious Plink tunnel port forwarding to a local port"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Plink Port Forwarding - sysmon]
description = Detects suspicious Plink tunnel port forwarding to a local port
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Description="Command-line SSH, Telnet, and Rlogin client" CommandLine="* -R *")) | eval sigma_attack_tags="attack.command_and_control attack.t1572 attack.lateral_movement attack.t1021.001" | eval sigma_title="Suspicious Plink Port Forwarding" | eval sigma_description="Detects suspicious Plink tunnel port forwarding to a local port"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential RDP Tunneling Via SSH Plink - winevent]
description = Execution of plink to perform data exfiltration and tunneling
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((New_Process_Name="*\\plink.exe" Process_Command_Line="*:127.0.0.1:3389*")) OR ((New_Process_Name="*\\plink.exe" Process_Command_Line="*:3389*" (Process_Command_Line="* -P 443*" OR Process_Command_Line="* -P 22*")))))) | eval sigma_attack_tags="attack.command_and_control attack.t1572" | eval sigma_title="Potential RDP Tunneling Via SSH Plink" | eval sigma_description="Execution of plink to perform data exfiltration and tunneling"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential RDP Tunneling Via SSH Plink - sysmon]
description = Execution of plink to perform data exfiltration and tunneling
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((Image="*\\plink.exe" CommandLine="*:127.0.0.1:3389*")) OR ((Image="*\\plink.exe" CommandLine="*:3389*" (CommandLine="* -P 443*" OR CommandLine="* -P 22*")))))) | eval sigma_attack_tags="attack.command_and_control attack.t1572" | eval sigma_title="Potential RDP Tunneling Via SSH Plink" | eval sigma_description="Execution of plink to perform data exfiltration and tunneling"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Powercfg Execution To Change Lock Screen Timeout - winevent]
description = Detects suspicious execution of 'Powercfg.exe' to change lock screen timeout
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\powercfg.exe" OR OriginalFileName="PowerCfg.exe") (((Process_Command_Line="*/setacvalueindex *" Process_Command_Line="*SCHEME_CURRENT*" Process_Command_Line="*SUB_VIDEO*" Process_Command_Line="*VIDEOCONLOCK*")) OR ((Process_Command_Line="*-change *" Process_Command_Line="*-standby-timeout-*"))))) | eval sigma_attack_tags="attack.defense_evasion" | eval sigma_title="Suspicious Powercfg Execution To Change Lock Screen Timeout" | eval sigma_description="Detects suspicious execution of 'Powercfg.exe' to change lock screen timeout"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Powercfg Execution To Change Lock Screen Timeout - sysmon]
description = Detects suspicious execution of 'Powercfg.exe' to change lock screen timeout
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\powercfg.exe" OR OriginalFileName="PowerCfg.exe") (((CommandLine="*/setacvalueindex *" CommandLine="*SCHEME_CURRENT*" CommandLine="*SUB_VIDEO*" CommandLine="*VIDEOCONLOCK*")) OR ((CommandLine="*-change *" CommandLine="*-standby-timeout-*"))))) | eval sigma_attack_tags="attack.defense_evasion" | eval sigma_title="Suspicious Powercfg Execution To Change Lock Screen Timeout" | eval sigma_description="Detects suspicious execution of 'Powercfg.exe' to change lock screen timeout"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Encoded PowerShell Command Line - winevent]
description = Detects suspicious powershell process starts with base64 encoded commands (e.g. Emotet)
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((((Process_Command_Line="* -e*" Process_Command_Line="* JAB*")) OR ((Process_Command_Line="* -e*" Process_Command_Line="* JAB*" Process_Command_Line="* -w*" Process_Command_Line="* hidden *"))) OR ((Process_Command_Line="* -e*" (Process_Command_Line="* BA^J*" OR Process_Command_Line="* SUVYI*" OR Process_Command_Line="* SQBFAFgA*" OR Process_Command_Line="* aQBlAHgA*" OR Process_Command_Line="* aWV4I*" OR Process_Command_Line="* IAA*" OR Process_Command_Line="* IAB*" OR Process_Command_Line="* UwB*" OR Process_Command_Line="* cwB*"))) OR Process_Command_Line="*.exe -ENCOD *") NOT (((Process_Command_Line="* -ExecutionPolicy*" Process_Command_Line="*remotesigned *"))))) | eval sigma_attack_tags="attack.execution attack.t1059.001" | eval sigma_title="Suspicious Encoded PowerShell Command Line" | eval sigma_description="Detects suspicious powershell process starts with base64 encoded commands (e.g. Emotet)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Encoded PowerShell Command Line - sysmon]
description = Detects suspicious powershell process starts with base64 encoded commands (e.g. Emotet)
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((((CommandLine="* -e*" CommandLine="* JAB*")) OR ((CommandLine="* -e*" CommandLine="* JAB*" CommandLine="* -w*" CommandLine="* hidden *"))) OR ((CommandLine="* -e*" (CommandLine="* BA^J*" OR CommandLine="* SUVYI*" OR CommandLine="* SQBFAFgA*" OR CommandLine="* aQBlAHgA*" OR CommandLine="* aWV4I*" OR CommandLine="* IAA*" OR CommandLine="* IAB*" OR CommandLine="* UwB*" OR CommandLine="* cwB*"))) OR CommandLine="*.exe -ENCOD *") NOT (((CommandLine="* -ExecutionPolicy*" CommandLine="*remotesigned *"))))) | eval sigma_attack_tags="attack.execution attack.t1059.001" | eval sigma_title="Suspicious Encoded PowerShell Command Line" | eval sigma_description="Detects suspicious powershell process starts with base64 encoded commands (e.g. Emotet)"
dispatch.earliest_time = -24h@h
alert.track = 0

[PowerShell Web Download - winevent]
description = Detects suspicious ways to download files or content using PowerShell
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (Process_Command_Line="*.DownloadString(*" OR Process_Command_Line="*.DownloadFile(*" OR Process_Command_Line="*Invoke-WebRequest *" OR Process_Command_Line="*iwr *"))) | eval sigma_attack_tags="" | eval sigma_title="PowerShell Web Download" | eval sigma_description="Detects suspicious ways to download files or content using PowerShell"
dispatch.earliest_time = -24h@h
alert.track = 0

[PowerShell Web Download - sysmon]
description = Detects suspicious ways to download files or content using PowerShell
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (CommandLine="*.DownloadString(*" OR CommandLine="*.DownloadFile(*" OR CommandLine="*Invoke-WebRequest *" OR CommandLine="*iwr *"))) | eval sigma_attack_tags="" | eval sigma_title="PowerShell Web Download" | eval sigma_description="Detects suspicious ways to download files or content using PowerShell"
dispatch.earliest_time = -24h@h
alert.track = 0

[PowerShell Web Download and Execution - winevent]
description = Detects suspicious ways to download files or content and execute them using PowerShell Invoke-Expression
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (Process_Command_Line="*.DownloadString(*" OR Process_Command_Line="*.DownloadFile(*" OR Process_Command_Line="*Invoke-WebRequest *" OR Process_Command_Line="*iwr *") (Process_Command_Line="*IEX(*" OR Process_Command_Line="*IEX (*" OR Process_Command_Line="*I`EX*" OR Process_Command_Line="*IE`X*" OR Process_Command_Line="*I`E`X*" OR Process_Command_Line="*| IEX*" OR Process_Command_Line="*|IEX *" OR Process_Command_Line="*Invoke-Expression*" OR Process_Command_Line="*;iex $*"))) | eval sigma_attack_tags="attack.execution attack.t1059" | eval sigma_title="PowerShell Web Download and Execution" | eval sigma_description="Detects suspicious ways to download files or content and execute them using PowerShell Invoke-Expression"
dispatch.earliest_time = -24h@h
alert.track = 0

[PowerShell Web Download and Execution - sysmon]
description = Detects suspicious ways to download files or content and execute them using PowerShell Invoke-Expression
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (CommandLine="*.DownloadString(*" OR CommandLine="*.DownloadFile(*" OR CommandLine="*Invoke-WebRequest *" OR CommandLine="*iwr *") (CommandLine="*IEX(*" OR CommandLine="*IEX (*" OR CommandLine="*I`EX*" OR CommandLine="*IE`X*" OR CommandLine="*I`E`X*" OR CommandLine="*| IEX*" OR CommandLine="*|IEX *" OR CommandLine="*Invoke-Expression*" OR CommandLine="*;iex $*"))) | eval sigma_attack_tags="attack.execution attack.t1059" | eval sigma_title="PowerShell Web Download and Execution" | eval sigma_description="Detects suspicious ways to download files or content and execute them using PowerShell Invoke-Expression"
dispatch.earliest_time = -24h@h
alert.track = 0

[Empire PowerShell Launch Parameters - winevent]
description = Detects suspicious powershell command line parameters used in Empire
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (Process_Command_Line="* -NoP -sta -NonI -W Hidden -Enc *" OR Process_Command_Line="* -noP -sta -w 1 -enc *" OR Process_Command_Line="* -NoP -NonI -W Hidden -enc *" OR Process_Command_Line="* -noP -sta -w 1 -enc*" OR Process_Command_Line="* -enc  SQB*" OR Process_Command_Line="* -nop -exec bypass -EncodedCommand *"))) | eval sigma_attack_tags="attack.execution attack.t1059.001" | eval sigma_title="Empire PowerShell Launch Parameters" | eval sigma_description="Detects suspicious powershell command line parameters used in Empire"
dispatch.earliest_time = -24h@h
alert.track = 0

[Empire PowerShell Launch Parameters - sysmon]
description = Detects suspicious powershell command line parameters used in Empire
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (CommandLine="* -NoP -sta -NonI -W Hidden -Enc *" OR CommandLine="* -noP -sta -w 1 -enc *" OR CommandLine="* -NoP -NonI -W Hidden -enc *" OR CommandLine="* -noP -sta -w 1 -enc*" OR CommandLine="* -enc  SQB*" OR CommandLine="* -nop -exec bypass -EncodedCommand *"))) | eval sigma_attack_tags="attack.execution attack.t1059.001" | eval sigma_title="Empire PowerShell Launch Parameters" | eval sigma_description="Detects suspicious powershell command line parameters used in Empire"
dispatch.earliest_time = -24h@h
alert.track = 0

[Empire PowerShell UAC Bypass - winevent]
description = Detects some Empire PowerShell UAC bypass methods
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (Process_Command_Line="* -NoP -NonI -w Hidden -c $x=$((gp HKCU:Software\\Microsoft\\Windows Update).Update)*" OR Process_Command_Line="* -NoP -NonI -c $x=$((gp HKCU:Software\\Microsoft\\Windows Update).Update);*"))) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.privilege_escalation attack.t1548.002 car.2019-04-001" | eval sigma_title="Empire PowerShell UAC Bypass" | eval sigma_description="Detects some Empire PowerShell UAC bypass methods"
dispatch.earliest_time = -24h@h
alert.track = 0

[Empire PowerShell UAC Bypass - sysmon]
description = Detects some Empire PowerShell UAC bypass methods
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (CommandLine="* -NoP -NonI -w Hidden -c $x=$((gp HKCU:Software\\Microsoft\\Windows Update).Update)*" OR CommandLine="* -NoP -NonI -c $x=$((gp HKCU:Software\\Microsoft\\Windows Update).Update);*"))) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.privilege_escalation attack.t1548.002 car.2019-04-001" | eval sigma_title="Empire PowerShell UAC Bypass" | eval sigma_description="Detects some Empire PowerShell UAC bypass methods"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious PowerShell Encoded Command Patterns - winevent]
description = Detects PowerShell command line patterns in combincation with encoded commands that often appear in malware infection chains
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((((New_Process_Name="*\\powershell.exe" OR New_Process_Name="*\\pwsh.exe") OR (OriginalFileName="PowerShell.Exe" OR OriginalFileName="pwsh.dll")) (Process_Command_Line="* -e *" OR Process_Command_Line="* -en *" OR Process_Command_Line="* -enc *" OR Process_Command_Line="* -enco*") (Process_Command_Line="* JAB*" OR Process_Command_Line="* SUVYI*" OR Process_Command_Line="* SQBFAFgA*" OR Process_Command_Line="* aWV4I*" OR Process_Command_Line="* IAB*" OR Process_Command_Line="* PAA*" OR Process_Command_Line="* aQBlAHgA*"))) NOT ((((Creator_Process_Name="*C:\\Packages\\Plugins\\Microsoft.GuestConfiguration.ConfigurationforWindows\\*" OR Creator_Process_Name="*\\gc_worker.exe*")))))) | eval sigma_attack_tags="attack.execution attack.t1059.001" | eval sigma_title="Suspicious PowerShell Encoded Command Patterns" | eval sigma_description="Detects PowerShell command line patterns in combincation with encoded commands that often appear in malware infection chains"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious PowerShell Encoded Command Patterns - sysmon]
description = Detects PowerShell command line patterns in combincation with encoded commands that often appear in malware infection chains
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((((Image="*\\powershell.exe" OR Image="*\\pwsh.exe") OR (OriginalFileName="PowerShell.Exe" OR OriginalFileName="pwsh.dll")) (CommandLine="* -e *" OR CommandLine="* -en *" OR CommandLine="* -enc *" OR CommandLine="* -enco*") (CommandLine="* JAB*" OR CommandLine="* SUVYI*" OR CommandLine="* SQBFAFgA*" OR CommandLine="* aWV4I*" OR CommandLine="* IAB*" OR CommandLine="* PAA*" OR CommandLine="* aQBlAHgA*"))) NOT ((((ParentImage="*C:\\Packages\\Plugins\\Microsoft.GuestConfiguration.ConfigurationforWindows\\*" OR ParentImage="*\\gc_worker.exe*")))))) | eval sigma_attack_tags="attack.execution attack.t1059.001" | eval sigma_title="Suspicious PowerShell Encoded Command Patterns" | eval sigma_description="Detects PowerShell command line patterns in combincation with encoded commands that often appear in malware infection chains"
dispatch.earliest_time = -24h@h
alert.track = 0

[PowerShell Get-Process LSASS - winevent]
description = Detects a 'Get-Process' cmdlet and it's aliases on lsass process, which is in almost all cases a sign of malicious activity
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (Process_Command_Line="*Get-Process lsas*" OR Process_Command_Line="*ps lsas*" OR Process_Command_Line="*gps lsas*"))) | eval sigma_attack_tags="attack.credential_access attack.t1552.004" | eval sigma_title="PowerShell Get-Process LSASS" | eval sigma_description="Detects a 'Get-Process' cmdlet and it's aliases on lsass process, which is in almost all cases a sign of malicious activity"
dispatch.earliest_time = -24h@h
alert.track = 0

[PowerShell Get-Process LSASS - sysmon]
description = Detects a 'Get-Process' cmdlet and it's aliases on lsass process, which is in almost all cases a sign of malicious activity
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (CommandLine="*Get-Process lsas*" OR CommandLine="*ps lsas*" OR CommandLine="*gps lsas*"))) | eval sigma_attack_tags="attack.credential_access attack.t1552.004" | eval sigma_title="PowerShell Get-Process LSASS" | eval sigma_description="Detects a 'Get-Process' cmdlet and it's aliases on lsass process, which is in almost all cases a sign of malicious activity"
dispatch.earliest_time = -24h@h
alert.track = 0

[Malicious Base64 Encoded PowerShell Keywords in Command Lines - winevent]
description = Detects base64 encoded strings used in hidden malicious PowerShell command lines
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\powershell.exe" OR New_Process_Name="*\\pwsh.exe") OR (OriginalFileName="PowerShell.EXE" OR OriginalFileName="pwsh.dll")) Process_Command_Line="* hidden *" (Process_Command_Line="*AGkAdABzAGEAZABtAGkAbgAgAC8AdAByAGEAbgBzAGYAZQByA*" OR Process_Command_Line="*aXRzYWRtaW4gL3RyYW5zZmVy*" OR Process_Command_Line="*IAaQB0AHMAYQBkAG0AaQBuACAALwB0AHIAYQBuAHMAZgBlAHIA*" OR Process_Command_Line="*JpdHNhZG1pbiAvdHJhbnNmZX*" OR Process_Command_Line="*YgBpAHQAcwBhAGQAbQBpAG4AIAAvAHQAcgBhAG4AcwBmAGUAcg*" OR Process_Command_Line="*Yml0c2FkbWluIC90cmFuc2Zlc*" OR Process_Command_Line="*AGMAaAB1AG4AawBfAHMAaQB6AGUA*" OR Process_Command_Line="*JABjAGgAdQBuAGsAXwBzAGkAegBlA*" OR Process_Command_Line="*JGNodW5rX3Npem*" OR Process_Command_Line="*QAYwBoAHUAbgBrAF8AcwBpAHoAZQ*" OR Process_Command_Line="*RjaHVua19zaXpl*" OR Process_Command_Line="*Y2h1bmtfc2l6Z*" OR Process_Command_Line="*AE8ALgBDAG8AbQBwAHIAZQBzAHMAaQBvAG4A*" OR Process_Command_Line="*kATwAuAEMAbwBtAHAAcgBlAHMAcwBpAG8Abg*" OR Process_Command_Line="*lPLkNvbXByZXNzaW9u*" OR Process_Command_Line="*SQBPAC4AQwBvAG0AcAByAGUAcwBzAGkAbwBuA*" OR Process_Command_Line="*SU8uQ29tcHJlc3Npb2*" OR Process_Command_Line="*Ty5Db21wcmVzc2lvb*" OR Process_Command_Line="*AE8ALgBNAGUAbQBvAHIAeQBTAHQAcgBlAGEAbQ*" OR Process_Command_Line="*kATwAuAE0AZQBtAG8AcgB5AFMAdAByAGUAYQBtA*" OR Process_Command_Line="*lPLk1lbW9yeVN0cmVhb*" OR Process_Command_Line="*SQBPAC4ATQBlAG0AbwByAHkAUwB0AHIAZQBhAG0A*" OR Process_Command_Line="*SU8uTWVtb3J5U3RyZWFt*" OR Process_Command_Line="*Ty5NZW1vcnlTdHJlYW*" OR Process_Command_Line="*4ARwBlAHQAQwBoAHUAbgBrA*" OR Process_Command_Line="*5HZXRDaHVua*" OR Process_Command_Line="*AEcAZQB0AEMAaAB1AG4Aaw*" OR Process_Command_Line="*LgBHAGUAdABDAGgAdQBuAGsA*" OR Process_Command_Line="*LkdldENodW5r*" OR Process_Command_Line="*R2V0Q2h1bm*" OR Process_Command_Line="*AEgAUgBFAEEARABfAEkATgBGAE8ANgA0A*" OR Process_Command_Line="*QASABSAEUAQQBEAF8ASQBOAEYATwA2ADQA*" OR Process_Command_Line="*RIUkVBRF9JTkZPNj*" OR Process_Command_Line="*SFJFQURfSU5GTzY0*" OR Process_Command_Line="*VABIAFIARQBBAEQAXwBJAE4ARgBPADYANA*" OR Process_Command_Line="*VEhSRUFEX0lORk82N*" OR Process_Command_Line="*AHIAZQBhAHQAZQBSAGUAbQBvAHQAZQBUAGgAcgBlAGEAZA*" OR Process_Command_Line="*cmVhdGVSZW1vdGVUaHJlYW*" OR Process_Command_Line="*MAcgBlAGEAdABlAFIAZQBtAG8AdABlAFQAaAByAGUAYQBkA*" OR Process_Command_Line="*NyZWF0ZVJlbW90ZVRocmVhZ*" OR Process_Command_Line="*Q3JlYXRlUmVtb3RlVGhyZWFk*" OR Process_Command_Line="*QwByAGUAYQB0AGUAUgBlAG0AbwB0AGUAVABoAHIAZQBhAGQA*" OR Process_Command_Line="*0AZQBtAG0AbwB2AGUA*" OR Process_Command_Line="*1lbW1vdm*" OR Process_Command_Line="*AGUAbQBtAG8AdgBlA*" OR Process_Command_Line="*bQBlAG0AbQBvAHYAZQ*" OR Process_Command_Line="*bWVtbW92Z*" OR Process_Command_Line="*ZW1tb3Zl*"))) | eval sigma_attack_tags="attack.execution attack.t1059.001" | eval sigma_title="Malicious Base64 Encoded PowerShell Keywords in Command Lines" | eval sigma_description="Detects base64 encoded strings used in hidden malicious PowerShell command lines"
dispatch.earliest_time = -24h@h
alert.track = 0

[Malicious Base64 Encoded PowerShell Keywords in Command Lines - sysmon]
description = Detects base64 encoded strings used in hidden malicious PowerShell command lines
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\powershell.exe" OR Image="*\\pwsh.exe") OR (OriginalFileName="PowerShell.EXE" OR OriginalFileName="pwsh.dll")) CommandLine="* hidden *" (CommandLine="*AGkAdABzAGEAZABtAGkAbgAgAC8AdAByAGEAbgBzAGYAZQByA*" OR CommandLine="*aXRzYWRtaW4gL3RyYW5zZmVy*" OR CommandLine="*IAaQB0AHMAYQBkAG0AaQBuACAALwB0AHIAYQBuAHMAZgBlAHIA*" OR CommandLine="*JpdHNhZG1pbiAvdHJhbnNmZX*" OR CommandLine="*YgBpAHQAcwBhAGQAbQBpAG4AIAAvAHQAcgBhAG4AcwBmAGUAcg*" OR CommandLine="*Yml0c2FkbWluIC90cmFuc2Zlc*" OR CommandLine="*AGMAaAB1AG4AawBfAHMAaQB6AGUA*" OR CommandLine="*JABjAGgAdQBuAGsAXwBzAGkAegBlA*" OR CommandLine="*JGNodW5rX3Npem*" OR CommandLine="*QAYwBoAHUAbgBrAF8AcwBpAHoAZQ*" OR CommandLine="*RjaHVua19zaXpl*" OR CommandLine="*Y2h1bmtfc2l6Z*" OR CommandLine="*AE8ALgBDAG8AbQBwAHIAZQBzAHMAaQBvAG4A*" OR CommandLine="*kATwAuAEMAbwBtAHAAcgBlAHMAcwBpAG8Abg*" OR CommandLine="*lPLkNvbXByZXNzaW9u*" OR CommandLine="*SQBPAC4AQwBvAG0AcAByAGUAcwBzAGkAbwBuA*" OR CommandLine="*SU8uQ29tcHJlc3Npb2*" OR CommandLine="*Ty5Db21wcmVzc2lvb*" OR CommandLine="*AE8ALgBNAGUAbQBvAHIAeQBTAHQAcgBlAGEAbQ*" OR CommandLine="*kATwAuAE0AZQBtAG8AcgB5AFMAdAByAGUAYQBtA*" OR CommandLine="*lPLk1lbW9yeVN0cmVhb*" OR CommandLine="*SQBPAC4ATQBlAG0AbwByAHkAUwB0AHIAZQBhAG0A*" OR CommandLine="*SU8uTWVtb3J5U3RyZWFt*" OR CommandLine="*Ty5NZW1vcnlTdHJlYW*" OR CommandLine="*4ARwBlAHQAQwBoAHUAbgBrA*" OR CommandLine="*5HZXRDaHVua*" OR CommandLine="*AEcAZQB0AEMAaAB1AG4Aaw*" OR CommandLine="*LgBHAGUAdABDAGgAdQBuAGsA*" OR CommandLine="*LkdldENodW5r*" OR CommandLine="*R2V0Q2h1bm*" OR CommandLine="*AEgAUgBFAEEARABfAEkATgBGAE8ANgA0A*" OR CommandLine="*QASABSAEUAQQBEAF8ASQBOAEYATwA2ADQA*" OR CommandLine="*RIUkVBRF9JTkZPNj*" OR CommandLine="*SFJFQURfSU5GTzY0*" OR CommandLine="*VABIAFIARQBBAEQAXwBJAE4ARgBPADYANA*" OR CommandLine="*VEhSRUFEX0lORk82N*" OR CommandLine="*AHIAZQBhAHQAZQBSAGUAbQBvAHQAZQBUAGgAcgBlAGEAZA*" OR CommandLine="*cmVhdGVSZW1vdGVUaHJlYW*" OR CommandLine="*MAcgBlAGEAdABlAFIAZQBtAG8AdABlAFQAaAByAGUAYQBkA*" OR CommandLine="*NyZWF0ZVJlbW90ZVRocmVhZ*" OR CommandLine="*Q3JlYXRlUmVtb3RlVGhyZWFk*" OR CommandLine="*QwByAGUAYQB0AGUAUgBlAG0AbwB0AGUAVABoAHIAZQBhAGQA*" OR CommandLine="*0AZQBtAG0AbwB2AGUA*" OR CommandLine="*1lbW1vdm*" OR CommandLine="*AGUAbQBtAG8AdgBlA*" OR CommandLine="*bQBlAG0AbQBvAHYAZQ*" OR CommandLine="*bWVtbW92Z*" OR CommandLine="*ZW1tb3Zl*"))) | eval sigma_attack_tags="attack.execution attack.t1059.001" | eval sigma_title="Malicious Base64 Encoded PowerShell Keywords in Command Lines" | eval sigma_description="Detects base64 encoded strings used in hidden malicious PowerShell command lines"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious PowerShell IEX Execution Patterns - winevent]
description = Detects suspicious ways to run Invoke-Execution using IEX alias
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((((New_Process_Name="*\\powershell.exe" OR New_Process_Name="*\\pwsh.exe") (Process_Command_Line="* | iex;*" OR Process_Command_Line="* | iex *" OR Process_Command_Line="* | iex}*" OR Process_Command_Line="* | IEX ;*" OR Process_Command_Line="* | IEX -Error*" OR Process_Command_Line="* | IEX (new*" OR Process_Command_Line="*);IEX *") (Process_Command_Line="*::FromBase64String*" OR Process_Command_Line="*.GetString([System.Convert]::*"))) OR (Process_Command_Line="*)|iex;$*" OR Process_Command_Line="*);iex($*" OR Process_Command_Line="*);iex $*" OR Process_Command_Line="* | IEX | *")))) | eval sigma_attack_tags="" | eval sigma_title="Suspicious PowerShell IEX Execution Patterns" | eval sigma_description="Detects suspicious ways to run Invoke-Execution using IEX alias"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious PowerShell IEX Execution Patterns - sysmon]
description = Detects suspicious ways to run Invoke-Execution using IEX alias
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((((Image="*\\powershell.exe" OR Image="*\\pwsh.exe") (CommandLine="* | iex;*" OR CommandLine="* | iex *" OR CommandLine="* | iex}*" OR CommandLine="* | IEX ;*" OR CommandLine="* | IEX -Error*" OR CommandLine="* | IEX (new*" OR CommandLine="*);IEX *") (CommandLine="*::FromBase64String*" OR CommandLine="*.GetString([System.Convert]::*"))) OR (CommandLine="*)|iex;$*" OR CommandLine="*);iex($*" OR CommandLine="*);iex $*" OR CommandLine="* | IEX | *")))) | eval sigma_attack_tags="" | eval sigma_title="Suspicious PowerShell IEX Execution Patterns" | eval sigma_description="Detects suspicious ways to run Invoke-Execution using IEX alias"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious PowerShell Invocations - Specific - ProcessCreation - winevent]
description = Detects suspicious PowerShell invocation command parameters
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((Process_Command_Line="*-nop*" Process_Command_Line="* -w *" Process_Command_Line="*hidden*" Process_Command_Line="* -c *" Process_Command_Line="*[Convert]::FromBase64String*")) OR ((Process_Command_Line="* -w *" Process_Command_Line="*hidden*" Process_Command_Line="*-noni*" Process_Command_Line="*-nop*" Process_Command_Line="* -c *" Process_Command_Line="*iex*" Process_Command_Line="*New-Object*")) OR ((Process_Command_Line="* -w *" Process_Command_Line="*hidden*" Process_Command_Line="*-ep*" Process_Command_Line="*bypass*" Process_Command_Line="*-Enc*")) OR ((Process_Command_Line="*powershell*" Process_Command_Line="*reg*" Process_Command_Line="*add*" Process_Command_Line="*\\software\\*")) OR ((Process_Command_Line="*bypass*" Process_Command_Line="*-noprofile*" Process_Command_Line="*-windowstyle*" Process_Command_Line="*hidden*" Process_Command_Line="*new-object*" Process_Command_Line="*system.net.webclient*" Process_Command_Line="*.download*")) OR ((Process_Command_Line="*iex*" Process_Command_Line="*New-Object*" Process_Command_Line="*Net.WebClient*" Process_Command_Line="*.Download*"))) NOT ((((Process_Command_Line="*(New-Object System.Net.WebClient).DownloadString('https://community.chocolatey.org/install.ps1*" OR Process_Command_Line="*Write-ChocolateyWarning*")))))) | eval sigma_attack_tags="attack.defense_evasion" | eval sigma_title="Suspicious PowerShell Invocations - Specific - ProcessCreation" | eval sigma_description="Detects suspicious PowerShell invocation command parameters"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious PowerShell Invocations - Specific - ProcessCreation - sysmon]
description = Detects suspicious PowerShell invocation command parameters
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((CommandLine="*-nop*" CommandLine="* -w *" CommandLine="*hidden*" CommandLine="* -c *" CommandLine="*[Convert]::FromBase64String*")) OR ((CommandLine="* -w *" CommandLine="*hidden*" CommandLine="*-noni*" CommandLine="*-nop*" CommandLine="* -c *" CommandLine="*iex*" CommandLine="*New-Object*")) OR ((CommandLine="* -w *" CommandLine="*hidden*" CommandLine="*-ep*" CommandLine="*bypass*" CommandLine="*-Enc*")) OR ((CommandLine="*powershell*" CommandLine="*reg*" CommandLine="*add*" CommandLine="*\\software\\*")) OR ((CommandLine="*bypass*" CommandLine="*-noprofile*" CommandLine="*-windowstyle*" CommandLine="*hidden*" CommandLine="*new-object*" CommandLine="*system.net.webclient*" CommandLine="*.download*")) OR ((CommandLine="*iex*" CommandLine="*New-Object*" CommandLine="*Net.WebClient*" CommandLine="*.Download*"))) NOT ((((CommandLine="*(New-Object System.Net.WebClient).DownloadString('https://community.chocolatey.org/install.ps1*" OR CommandLine="*Write-ChocolateyWarning*")))))) | eval sigma_attack_tags="attack.defense_evasion" | eval sigma_title="Suspicious PowerShell Invocations - Specific - ProcessCreation" | eval sigma_description="Detects suspicious PowerShell invocation command parameters"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential PowerShell Obfuscation Via WCHAR - winevent]
description = Detects suspicious encoded character syntax often used for defense evasion
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*(WCHAR)0x*")) | eval sigma_attack_tags="attack.execution attack.t1059.001 attack.defense_evasion attack.t1027" | eval sigma_title="Potential PowerShell Obfuscation Via WCHAR" | eval sigma_description="Detects suspicious encoded character syntax often used for defense evasion"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential PowerShell Obfuscation Via WCHAR - sysmon]
description = Detects suspicious encoded character syntax often used for defense evasion
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*(WCHAR)0x*")) | eval sigma_attack_tags="attack.execution attack.t1059.001 attack.defense_evasion attack.t1027" | eval sigma_title="Potential PowerShell Obfuscation Via WCHAR" | eval sigma_description="Detects suspicious encoded character syntax often used for defense evasion"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious PowerShell Parent Process - winevent]
description = Detects a suspicious or uncommon parent processes of PowerShell
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((Creator_Process_Name="*\\mshta.exe" OR Creator_Process_Name="*\\rundll32.exe" OR Creator_Process_Name="*\\regsvr32.exe" OR Creator_Process_Name="*\\services.exe" OR Creator_Process_Name="*\\winword.exe" OR Creator_Process_Name="*\\powerpnt.exe" OR Creator_Process_Name="*\\excel.exe" OR Creator_Process_Name="*\\msaccess.exe" OR Creator_Process_Name="*\\mspub.exe" OR Creator_Process_Name="*\\visio.exe" OR Creator_Process_Name="*\\outlook.exe" OR Creator_Process_Name="*\\amigo.exe" OR Creator_Process_Name="*\\chrome.exe" OR Creator_Process_Name="*\\firefox.exe" OR Creator_Process_Name="*\\iexplore.exe" OR Creator_Process_Name="*\\microsoftedgecp.exe" OR Creator_Process_Name="*\\microsoftedge.exe" OR Creator_Process_Name="*\\browser.exe" OR Creator_Process_Name="*\\vivaldi.exe" OR Creator_Process_Name="*\\safari.exe" OR Creator_Process_Name="*\\sqlagent.exe" OR Creator_Process_Name="*\\sqlserver.exe" OR Creator_Process_Name="*\\sqlservr.exe" OR Creator_Process_Name="*\\w3wp.exe" OR Creator_Process_Name="*\\httpd.exe" OR Creator_Process_Name="*\\nginx.exe" OR Creator_Process_Name="*\\php-cgi.exe" OR Creator_Process_Name="*\\jbosssvc.exe" OR Creator_Process_Name="*\\MicrosoftEdgeSH.exe") OR Creator_Process_Name="*tomcat*") ((New_Process_Name="*\\powershell.exe" OR New_Process_Name="*\\pwsh.exe") OR (Process_Command_Line="*/c powershell*" OR Process_Command_Line="*/c pwsh*") OR Description="Windows PowerShell" OR Product="PowerShell Core 6" OR (OriginalFileName="PowerShell.EXE" OR OriginalFileName="pwsh.dll")))) | eval sigma_attack_tags="attack.execution attack.t1059.001" | eval sigma_title="Suspicious PowerShell Parent Process" | eval sigma_description="Detects a suspicious or uncommon parent processes of PowerShell"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious PowerShell Parent Process - sysmon]
description = Detects a suspicious or uncommon parent processes of PowerShell
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((ParentImage="*\\mshta.exe" OR ParentImage="*\\rundll32.exe" OR ParentImage="*\\regsvr32.exe" OR ParentImage="*\\services.exe" OR ParentImage="*\\winword.exe" OR ParentImage="*\\powerpnt.exe" OR ParentImage="*\\excel.exe" OR ParentImage="*\\msaccess.exe" OR ParentImage="*\\mspub.exe" OR ParentImage="*\\visio.exe" OR ParentImage="*\\outlook.exe" OR ParentImage="*\\amigo.exe" OR ParentImage="*\\chrome.exe" OR ParentImage="*\\firefox.exe" OR ParentImage="*\\iexplore.exe" OR ParentImage="*\\microsoftedgecp.exe" OR ParentImage="*\\microsoftedge.exe" OR ParentImage="*\\browser.exe" OR ParentImage="*\\vivaldi.exe" OR ParentImage="*\\safari.exe" OR ParentImage="*\\sqlagent.exe" OR ParentImage="*\\sqlserver.exe" OR ParentImage="*\\sqlservr.exe" OR ParentImage="*\\w3wp.exe" OR ParentImage="*\\httpd.exe" OR ParentImage="*\\nginx.exe" OR ParentImage="*\\php-cgi.exe" OR ParentImage="*\\jbosssvc.exe" OR ParentImage="*\\MicrosoftEdgeSH.exe") OR ParentImage="*tomcat*") ((Image="*\\powershell.exe" OR Image="*\\pwsh.exe") OR (CommandLine="*/c powershell*" OR CommandLine="*/c pwsh*") OR Description="Windows PowerShell" OR Product="PowerShell Core 6" OR (OriginalFileName="PowerShell.EXE" OR OriginalFileName="pwsh.dll")))) | eval sigma_attack_tags="attack.execution attack.t1059.001" | eval sigma_title="Suspicious PowerShell Parent Process" | eval sigma_description="Detects a suspicious or uncommon parent processes of PowerShell"
dispatch.earliest_time = -24h@h
alert.track = 0

[PowerShell SAM Copy - winevent]
description = Detects suspicious PowerShell scripts accessing SAM hives
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*\\HarddiskVolumeShadowCopy*" Process_Command_Line="*System32\\config\\sam*" (Process_Command_Line="*Copy-Item*" OR Process_Command_Line="*cp $_.*" OR Process_Command_Line="*cpi $_.*" OR Process_Command_Line="*copy $_.*" OR Process_Command_Line="*.File]::Copy(*"))) | eval sigma_attack_tags="attack.credential_access attack.t1003.002" | eval sigma_title="PowerShell SAM Copy" | eval sigma_description="Detects suspicious PowerShell scripts accessing SAM hives"
dispatch.earliest_time = -24h@h
alert.track = 0

[PowerShell SAM Copy - sysmon]
description = Detects suspicious PowerShell scripts accessing SAM hives
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*\\HarddiskVolumeShadowCopy*" CommandLine="*System32\\config\\sam*" (CommandLine="*Copy-Item*" OR CommandLine="*cp $_.*" OR CommandLine="*cpi $_.*" OR CommandLine="*copy $_.*" OR CommandLine="*.File]::Copy(*"))) | eval sigma_attack_tags="attack.credential_access attack.t1003.002" | eval sigma_title="PowerShell SAM Copy" | eval sigma_description="Detects suspicious PowerShell scripts accessing SAM hives"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious PowerShell Invocation From Script Engines - winevent]
description = Detects suspicious powershell invocations from interpreters or unusual programs
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((Creator_Process_Name="*\\wscript.exe" OR Creator_Process_Name="*\\cscript.exe") (New_Process_Name="*\\powershell.exe" OR New_Process_Name="*\\pwsh.exe"))) NOT (((CurrentDirectory="*\\Health Service State\\*"))))) | eval sigma_attack_tags="attack.execution attack.t1059.001" | eval sigma_title="Suspicious PowerShell Invocation From Script Engines" | eval sigma_description="Detects suspicious powershell invocations from interpreters or unusual programs"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious PowerShell Invocation From Script Engines - sysmon]
description = Detects suspicious powershell invocations from interpreters or unusual programs
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((ParentImage="*\\wscript.exe" OR ParentImage="*\\cscript.exe") (Image="*\\powershell.exe" OR Image="*\\pwsh.exe"))) NOT (((CurrentDirectory="*\\Health Service State\\*"))))) | eval sigma_attack_tags="attack.execution attack.t1059.001" | eval sigma_title="Suspicious PowerShell Invocation From Script Engines" | eval sigma_description="Detects suspicious powershell invocations from interpreters or unusual programs"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious PowerShell Child Processes - winevent]
description = Detects suspicious child processes spawned by PowerShell
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((Creator_Process_Name="*\\powershell.exe" OR Creator_Process_Name="*\\pwsh.exe" OR Creator_Process_Name="*\\powershell_ise.exe") (New_Process_Name="*\\sh.exe" OR New_Process_Name="*\\bash.exe" OR New_Process_Name="*\\schtasks.exe" OR New_Process_Name="*\\certutil.exe" OR New_Process_Name="*\\bitsadmin.exe" OR New_Process_Name="*\\wscript.exe" OR New_Process_Name="*\\cscript.exe" OR New_Process_Name="*\\scrcons.exe" OR New_Process_Name="*\\regsvr32.exe" OR New_Process_Name="*\\hh.exe" OR New_Process_Name="*\\wmic.exe" OR New_Process_Name="*\\mshta.exe" OR New_Process_Name="*\\rundll32.exe" OR New_Process_Name="*\\forfiles.exe" OR New_Process_Name="*\\scriptrunner.exe"))) NOT (((ParentCommandLine="*\\Program Files\\Amazon\\WorkspacesConfig\\Scripts\\*" Process_Command_Line="*\\Program Files\\Amazon\\WorkspacesConfig\\Scripts\\*"))))) | eval sigma_attack_tags="" | eval sigma_title="Suspicious PowerShell Child Processes" | eval sigma_description="Detects suspicious child processes spawned by PowerShell"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious PowerShell Child Processes - sysmon]
description = Detects suspicious child processes spawned by PowerShell
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((ParentImage="*\\powershell.exe" OR ParentImage="*\\pwsh.exe" OR ParentImage="*\\powershell_ise.exe") (Image="*\\sh.exe" OR Image="*\\bash.exe" OR Image="*\\schtasks.exe" OR Image="*\\certutil.exe" OR Image="*\\bitsadmin.exe" OR Image="*\\wscript.exe" OR Image="*\\cscript.exe" OR Image="*\\scrcons.exe" OR Image="*\\regsvr32.exe" OR Image="*\\hh.exe" OR Image="*\\wmic.exe" OR Image="*\\mshta.exe" OR Image="*\\rundll32.exe" OR Image="*\\forfiles.exe" OR Image="*\\scriptrunner.exe"))) NOT (((ParentCommandLine="*\\Program Files\\Amazon\\WorkspacesConfig\\Scripts\\*" CommandLine="*\\Program Files\\Amazon\\WorkspacesConfig\\Scripts\\*"))))) | eval sigma_attack_tags="" | eval sigma_title="Suspicious PowerShell Child Processes" | eval sigma_description="Detects suspicious child processes spawned by PowerShell"
dispatch.earliest_time = -24h@h
alert.track = 0

[Net WebClient Casing Anomalies - winevent]
description = Detects PowerShell command line contents that include a suspicious abnormal casing in the Net.Webclient (e.g. nEt.WEbCliEnT) string as used in obfuscation techniques
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\powershell.exe" OR New_Process_Name="*\\pwsh.exe") OR (OriginalFileName="PowerShell.EXE" OR OriginalFileName="pwsh.dll")) (Process_Command_Line="*TgBlAFQALgB3AEUAQg*" OR Process_Command_Line="*4AZQBUAC4AdwBFAEIA*" OR Process_Command_Line="*OAGUAVAAuAHcARQBCA*" OR Process_Command_Line="*bgBFAHQALgB3AGUAYg*" OR Process_Command_Line="*4ARQB0AC4AdwBlAGIA*" OR Process_Command_Line="*uAEUAdAAuAHcAZQBiA*" OR Process_Command_Line="*TgBFAHQALgB3AGUAYg*" OR Process_Command_Line="*OAEUAdAAuAHcAZQBiA*" OR Process_Command_Line="*bgBlAFQALgB3AGUAYg*" OR Process_Command_Line="*4AZQBUAC4AdwBlAGIA*" OR Process_Command_Line="*uAGUAVAAuAHcAZQBiA*" OR Process_Command_Line="*TgBlAFQALgB3AGUAYg*" OR Process_Command_Line="*OAGUAVAAuAHcAZQBiA*" OR Process_Command_Line="*bgBFAFQALgB3AGUAYg*" OR Process_Command_Line="*4ARQBUAC4AdwBlAGIA*" OR Process_Command_Line="*uAEUAVAAuAHcAZQBiA*" OR Process_Command_Line="*bgBlAHQALgBXAGUAYg*" OR Process_Command_Line="*4AZQB0AC4AVwBlAGIA*" OR Process_Command_Line="*uAGUAdAAuAFcAZQBiA*" OR Process_Command_Line="*bgBFAHQALgBXAGUAYg*" OR Process_Command_Line="*4ARQB0AC4AVwBlAGIA*" OR Process_Command_Line="*uAEUAdAAuAFcAZQBiA*" OR Process_Command_Line="*TgBFAHQALgBXAGUAYg*" OR Process_Command_Line="*OAEUAdAAuAFcAZQBiA*" OR Process_Command_Line="*bgBlAFQALgBXAGUAYg*" OR Process_Command_Line="*4AZQBUAC4AVwBlAGIA*" OR Process_Command_Line="*uAGUAVAAuAFcAZQBiA*" OR Process_Command_Line="*TgBlAFQALgBXAGUAYg*" OR Process_Command_Line="*OAGUAVAAuAFcAZQBiA*" OR Process_Command_Line="*bgBFAFQALgBXAGUAYg*" OR Process_Command_Line="*4ARQBUAC4AVwBlAGIA*" OR Process_Command_Line="*uAEUAVAAuAFcAZQBiA*" OR Process_Command_Line="*bgBlAHQALgB3AEUAYg*" OR Process_Command_Line="*4AZQB0AC4AdwBFAGIA*" OR Process_Command_Line="*uAGUAdAAuAHcARQBiA*" OR Process_Command_Line="*TgBlAHQALgB3AEUAYg*" OR Process_Command_Line="*OAGUAdAAuAHcARQBiA*" OR Process_Command_Line="*bgBFAHQALgB3AEUAYg*" OR Process_Command_Line="*4ARQB0AC4AdwBFAGIA*" OR Process_Command_Line="*uAEUAdAAuAHcARQBiA*" OR Process_Command_Line="*TgBFAHQALgB3AEUAYg*" OR Process_Command_Line="*OAEUAdAAuAHcARQBiA*" OR Process_Command_Line="*bgBlAFQALgB3AEUAYg*" OR Process_Command_Line="*4AZQBUAC4AdwBFAGIA*" OR Process_Command_Line="*uAGUAVAAuAHcARQBiA*" OR Process_Command_Line="*TgBlAFQALgB3AEUAYg*" OR Process_Command_Line="*OAGUAVAAuAHcARQBiA*" OR Process_Command_Line="*bgBFAFQALgB3AEUAYg*" OR Process_Command_Line="*4ARQBUAC4AdwBFAGIA*" OR Process_Command_Line="*uAEUAVAAuAHcARQBiA*" OR Process_Command_Line="*TgBFAFQALgB3AEUAYg*" OR Process_Command_Line="*OAEUAVAAuAHcARQBiA*" OR Process_Command_Line="*bgBlAHQALgBXAEUAYg*" OR Process_Command_Line="*4AZQB0AC4AVwBFAGIA*" OR Process_Command_Line="*uAGUAdAAuAFcARQBiA*" OR Process_Command_Line="*TgBlAHQALgBXAEUAYg*" OR Process_Command_Line="*OAGUAdAAuAFcARQBiA*" OR Process_Command_Line="*bgBFAHQALgBXAEUAYg*" OR Process_Command_Line="*4ARQB0AC4AVwBFAGIA*" OR Process_Command_Line="*uAEUAdAAuAFcARQBiA*" OR Process_Command_Line="*TgBFAHQALgBXAEUAYg*" OR Process_Command_Line="*OAEUAdAAuAFcARQBiA*" OR Process_Command_Line="*bgBlAFQALgBXAEUAYg*" OR Process_Command_Line="*4AZQBUAC4AVwBFAGIA*" OR Process_Command_Line="*uAGUAVAAuAFcARQBiA*" OR Process_Command_Line="*TgBlAFQALgBXAEUAYg*" OR Process_Command_Line="*OAGUAVAAuAFcARQBiA*" OR Process_Command_Line="*bgBFAFQALgBXAEUAYg*" OR Process_Command_Line="*4ARQBUAC4AVwBFAGIA*" OR Process_Command_Line="*uAEUAVAAuAFcARQBiA*" OR Process_Command_Line="*TgBFAFQALgBXAEUAYg*" OR Process_Command_Line="*OAEUAVAAuAFcARQBiA*" OR Process_Command_Line="*bgBlAHQALgB3AGUAQg*" OR Process_Command_Line="*4AZQB0AC4AdwBlAEIA*" OR Process_Command_Line="*uAGUAdAAuAHcAZQBCA*" OR Process_Command_Line="*TgBlAHQALgB3AGUAQg*" OR Process_Command_Line="*OAGUAdAAuAHcAZQBCA*" OR Process_Command_Line="*bgBFAHQALgB3AGUAQg*" OR Process_Command_Line="*4ARQB0AC4AdwBlAEIA*" OR Process_Command_Line="*uAEUAdAAuAHcAZQBCA*" OR Process_Command_Line="*TgBFAHQALgB3AGUAQg*" OR Process_Command_Line="*OAEUAdAAuAHcAZQBCA*" OR Process_Command_Line="*bgBlAFQALgB3AGUAQg*" OR Process_Command_Line="*4AZQBUAC4AdwBlAEIA*" OR Process_Command_Line="*uAGUAVAAuAHcAZQBCA*" OR Process_Command_Line="*TgBlAFQALgB3AGUAQg*" OR Process_Command_Line="*OAGUAVAAuAHcAZQBCA*" OR Process_Command_Line="*bgBFAFQALgB3AGUAQg*" OR Process_Command_Line="*4ARQBUAC4AdwBlAEIA*" OR Process_Command_Line="*uAEUAVAAuAHcAZQBCA*" OR Process_Command_Line="*TgBFAFQALgB3AGUAQg*" OR Process_Command_Line="*OAEUAVAAuAHcAZQBCA*" OR Process_Command_Line="*bgBlAHQALgBXAGUAQg*" OR Process_Command_Line="*4AZQB0AC4AVwBlAEIA*" OR Process_Command_Line="*uAGUAdAAuAFcAZQBCA*" OR Process_Command_Line="*TgBlAHQALgBXAGUAQg*" OR Process_Command_Line="*OAGUAdAAuAFcAZQBCA*" OR Process_Command_Line="*bgBFAHQALgBXAGUAQg*" OR Process_Command_Line="*4ARQB0AC4AVwBlAEIA*" OR Process_Command_Line="*uAEUAdAAuAFcAZQBCA*" OR Process_Command_Line="*TgBFAHQALgBXAGUAQg*" OR Process_Command_Line="*OAEUAdAAuAFcAZQBCA*" OR Process_Command_Line="*bgBlAFQALgBXAGUAQg*" OR Process_Command_Line="*4AZQBUAC4AVwBlAEIA*" OR Process_Command_Line="*uAGUAVAAuAFcAZQBCA*" OR Process_Command_Line="*TgBlAFQALgBXAGUAQg*" OR Process_Command_Line="*OAGUAVAAuAFcAZQBCA*" OR Process_Command_Line="*bgBFAFQALgBXAGUAQg*" OR Process_Command_Line="*4ARQBUAC4AVwBlAEIA*" OR Process_Command_Line="*uAEUAVAAuAFcAZQBCA*" OR Process_Command_Line="*TgBFAFQALgBXAGUAQg*" OR Process_Command_Line="*OAEUAVAAuAFcAZQBCA*" OR Process_Command_Line="*bgBlAHQALgB3AEUAQg*" OR Process_Command_Line="*4AZQB0AC4AdwBFAEIA*" OR Process_Command_Line="*uAGUAdAAuAHcARQBCA*" OR Process_Command_Line="*TgBlAHQALgB3AEUAQg*" OR Process_Command_Line="*OAGUAdAAuAHcARQBCA*" OR Process_Command_Line="*bgBFAHQALgB3AEUAQg*" OR Process_Command_Line="*4ARQB0AC4AdwBFAEIA*" OR Process_Command_Line="*uAEUAdAAuAHcARQBCA*" OR Process_Command_Line="*TgBFAHQALgB3AEUAQg*" OR Process_Command_Line="*OAEUAdAAuAHcARQBCA*" OR Process_Command_Line="*bgBlAFQALgB3AEUAQg*" OR Process_Command_Line="*uAGUAVAAuAHcARQBCA*" OR Process_Command_Line="*bgBFAFQALgB3AEUAQg*" OR Process_Command_Line="*4ARQBUAC4AdwBFAEIA*" OR Process_Command_Line="*uAEUAVAAuAHcARQBCA*" OR Process_Command_Line="*TgBFAFQALgB3AEUAQg*" OR Process_Command_Line="*OAEUAVAAuAHcARQBCA*" OR Process_Command_Line="*TgBlAHQALgBXAEUAQg*" OR Process_Command_Line="*4AZQB0AC4AVwBFAEIA*" OR Process_Command_Line="*OAGUAdAAuAFcARQBCA*" OR Process_Command_Line="*bgBFAHQALgBXAEUAQg*" OR Process_Command_Line="*4ARQB0AC4AVwBFAEIA*" OR Process_Command_Line="*uAEUAdAAuAFcARQBCA*" OR Process_Command_Line="*TgBFAHQALgBXAEUAQg*" OR Process_Command_Line="*OAEUAdAAuAFcARQBCA*" OR Process_Command_Line="*bgBlAFQALgBXAEUAQg*" OR Process_Command_Line="*4AZQBUAC4AVwBFAEIA*" OR Process_Command_Line="*uAGUAVAAuAFcARQBCA*" OR Process_Command_Line="*TgBlAFQALgBXAEUAQg*" OR Process_Command_Line="*OAGUAVAAuAFcARQBCA*" OR Process_Command_Line="*bgBFAFQALgBXAEUAQg*" OR Process_Command_Line="*4ARQBUAC4AVwBFAEIA*" OR Process_Command_Line="*uAEUAVAAuAFcARQBCA*"))) | eval sigma_attack_tags="attack.execution attack.t1059.001" | eval sigma_title="Net WebClient Casing Anomalies" | eval sigma_description="Detects PowerShell command line contents that include a suspicious abnormal casing in the Net.Webclient (e.g. nEt.WEbCliEnT) string as used in obfuscation techniques"
dispatch.earliest_time = -24h@h
alert.track = 0

[Net WebClient Casing Anomalies - sysmon]
description = Detects PowerShell command line contents that include a suspicious abnormal casing in the Net.Webclient (e.g. nEt.WEbCliEnT) string as used in obfuscation techniques
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\powershell.exe" OR Image="*\\pwsh.exe") OR (OriginalFileName="PowerShell.EXE" OR OriginalFileName="pwsh.dll")) (CommandLine="*TgBlAFQALgB3AEUAQg*" OR CommandLine="*4AZQBUAC4AdwBFAEIA*" OR CommandLine="*OAGUAVAAuAHcARQBCA*" OR CommandLine="*bgBFAHQALgB3AGUAYg*" OR CommandLine="*4ARQB0AC4AdwBlAGIA*" OR CommandLine="*uAEUAdAAuAHcAZQBiA*" OR CommandLine="*TgBFAHQALgB3AGUAYg*" OR CommandLine="*OAEUAdAAuAHcAZQBiA*" OR CommandLine="*bgBlAFQALgB3AGUAYg*" OR CommandLine="*4AZQBUAC4AdwBlAGIA*" OR CommandLine="*uAGUAVAAuAHcAZQBiA*" OR CommandLine="*TgBlAFQALgB3AGUAYg*" OR CommandLine="*OAGUAVAAuAHcAZQBiA*" OR CommandLine="*bgBFAFQALgB3AGUAYg*" OR CommandLine="*4ARQBUAC4AdwBlAGIA*" OR CommandLine="*uAEUAVAAuAHcAZQBiA*" OR CommandLine="*bgBlAHQALgBXAGUAYg*" OR CommandLine="*4AZQB0AC4AVwBlAGIA*" OR CommandLine="*uAGUAdAAuAFcAZQBiA*" OR CommandLine="*bgBFAHQALgBXAGUAYg*" OR CommandLine="*4ARQB0AC4AVwBlAGIA*" OR CommandLine="*uAEUAdAAuAFcAZQBiA*" OR CommandLine="*TgBFAHQALgBXAGUAYg*" OR CommandLine="*OAEUAdAAuAFcAZQBiA*" OR CommandLine="*bgBlAFQALgBXAGUAYg*" OR CommandLine="*4AZQBUAC4AVwBlAGIA*" OR CommandLine="*uAGUAVAAuAFcAZQBiA*" OR CommandLine="*TgBlAFQALgBXAGUAYg*" OR CommandLine="*OAGUAVAAuAFcAZQBiA*" OR CommandLine="*bgBFAFQALgBXAGUAYg*" OR CommandLine="*4ARQBUAC4AVwBlAGIA*" OR CommandLine="*uAEUAVAAuAFcAZQBiA*" OR CommandLine="*bgBlAHQALgB3AEUAYg*" OR CommandLine="*4AZQB0AC4AdwBFAGIA*" OR CommandLine="*uAGUAdAAuAHcARQBiA*" OR CommandLine="*TgBlAHQALgB3AEUAYg*" OR CommandLine="*OAGUAdAAuAHcARQBiA*" OR CommandLine="*bgBFAHQALgB3AEUAYg*" OR CommandLine="*4ARQB0AC4AdwBFAGIA*" OR CommandLine="*uAEUAdAAuAHcARQBiA*" OR CommandLine="*TgBFAHQALgB3AEUAYg*" OR CommandLine="*OAEUAdAAuAHcARQBiA*" OR CommandLine="*bgBlAFQALgB3AEUAYg*" OR CommandLine="*4AZQBUAC4AdwBFAGIA*" OR CommandLine="*uAGUAVAAuAHcARQBiA*" OR CommandLine="*TgBlAFQALgB3AEUAYg*" OR CommandLine="*OAGUAVAAuAHcARQBiA*" OR CommandLine="*bgBFAFQALgB3AEUAYg*" OR CommandLine="*4ARQBUAC4AdwBFAGIA*" OR CommandLine="*uAEUAVAAuAHcARQBiA*" OR CommandLine="*TgBFAFQALgB3AEUAYg*" OR CommandLine="*OAEUAVAAuAHcARQBiA*" OR CommandLine="*bgBlAHQALgBXAEUAYg*" OR CommandLine="*4AZQB0AC4AVwBFAGIA*" OR CommandLine="*uAGUAdAAuAFcARQBiA*" OR CommandLine="*TgBlAHQALgBXAEUAYg*" OR CommandLine="*OAGUAdAAuAFcARQBiA*" OR CommandLine="*bgBFAHQALgBXAEUAYg*" OR CommandLine="*4ARQB0AC4AVwBFAGIA*" OR CommandLine="*uAEUAdAAuAFcARQBiA*" OR CommandLine="*TgBFAHQALgBXAEUAYg*" OR CommandLine="*OAEUAdAAuAFcARQBiA*" OR CommandLine="*bgBlAFQALgBXAEUAYg*" OR CommandLine="*4AZQBUAC4AVwBFAGIA*" OR CommandLine="*uAGUAVAAuAFcARQBiA*" OR CommandLine="*TgBlAFQALgBXAEUAYg*" OR CommandLine="*OAGUAVAAuAFcARQBiA*" OR CommandLine="*bgBFAFQALgBXAEUAYg*" OR CommandLine="*4ARQBUAC4AVwBFAGIA*" OR CommandLine="*uAEUAVAAuAFcARQBiA*" OR CommandLine="*TgBFAFQALgBXAEUAYg*" OR CommandLine="*OAEUAVAAuAFcARQBiA*" OR CommandLine="*bgBlAHQALgB3AGUAQg*" OR CommandLine="*4AZQB0AC4AdwBlAEIA*" OR CommandLine="*uAGUAdAAuAHcAZQBCA*" OR CommandLine="*TgBlAHQALgB3AGUAQg*" OR CommandLine="*OAGUAdAAuAHcAZQBCA*" OR CommandLine="*bgBFAHQALgB3AGUAQg*" OR CommandLine="*4ARQB0AC4AdwBlAEIA*" OR CommandLine="*uAEUAdAAuAHcAZQBCA*" OR CommandLine="*TgBFAHQALgB3AGUAQg*" OR CommandLine="*OAEUAdAAuAHcAZQBCA*" OR CommandLine="*bgBlAFQALgB3AGUAQg*" OR CommandLine="*4AZQBUAC4AdwBlAEIA*" OR CommandLine="*uAGUAVAAuAHcAZQBCA*" OR CommandLine="*TgBlAFQALgB3AGUAQg*" OR CommandLine="*OAGUAVAAuAHcAZQBCA*" OR CommandLine="*bgBFAFQALgB3AGUAQg*" OR CommandLine="*4ARQBUAC4AdwBlAEIA*" OR CommandLine="*uAEUAVAAuAHcAZQBCA*" OR CommandLine="*TgBFAFQALgB3AGUAQg*" OR CommandLine="*OAEUAVAAuAHcAZQBCA*" OR CommandLine="*bgBlAHQALgBXAGUAQg*" OR CommandLine="*4AZQB0AC4AVwBlAEIA*" OR CommandLine="*uAGUAdAAuAFcAZQBCA*" OR CommandLine="*TgBlAHQALgBXAGUAQg*" OR CommandLine="*OAGUAdAAuAFcAZQBCA*" OR CommandLine="*bgBFAHQALgBXAGUAQg*" OR CommandLine="*4ARQB0AC4AVwBlAEIA*" OR CommandLine="*uAEUAdAAuAFcAZQBCA*" OR CommandLine="*TgBFAHQALgBXAGUAQg*" OR CommandLine="*OAEUAdAAuAFcAZQBCA*" OR CommandLine="*bgBlAFQALgBXAGUAQg*" OR CommandLine="*4AZQBUAC4AVwBlAEIA*" OR CommandLine="*uAGUAVAAuAFcAZQBCA*" OR CommandLine="*TgBlAFQALgBXAGUAQg*" OR CommandLine="*OAGUAVAAuAFcAZQBCA*" OR CommandLine="*bgBFAFQALgBXAGUAQg*" OR CommandLine="*4ARQBUAC4AVwBlAEIA*" OR CommandLine="*uAEUAVAAuAFcAZQBCA*" OR CommandLine="*TgBFAFQALgBXAGUAQg*" OR CommandLine="*OAEUAVAAuAFcAZQBCA*" OR CommandLine="*bgBlAHQALgB3AEUAQg*" OR CommandLine="*4AZQB0AC4AdwBFAEIA*" OR CommandLine="*uAGUAdAAuAHcARQBCA*" OR CommandLine="*TgBlAHQALgB3AEUAQg*" OR CommandLine="*OAGUAdAAuAHcARQBCA*" OR CommandLine="*bgBFAHQALgB3AEUAQg*" OR CommandLine="*4ARQB0AC4AdwBFAEIA*" OR CommandLine="*uAEUAdAAuAHcARQBCA*" OR CommandLine="*TgBFAHQALgB3AEUAQg*" OR CommandLine="*OAEUAdAAuAHcARQBCA*" OR CommandLine="*bgBlAFQALgB3AEUAQg*" OR CommandLine="*uAGUAVAAuAHcARQBCA*" OR CommandLine="*bgBFAFQALgB3AEUAQg*" OR CommandLine="*4ARQBUAC4AdwBFAEIA*" OR CommandLine="*uAEUAVAAuAHcARQBCA*" OR CommandLine="*TgBFAFQALgB3AEUAQg*" OR CommandLine="*OAEUAVAAuAHcARQBCA*" OR CommandLine="*TgBlAHQALgBXAEUAQg*" OR CommandLine="*4AZQB0AC4AVwBFAEIA*" OR CommandLine="*OAGUAdAAuAFcARQBCA*" OR CommandLine="*bgBFAHQALgBXAEUAQg*" OR CommandLine="*4ARQB0AC4AVwBFAEIA*" OR CommandLine="*uAEUAdAAuAFcARQBCA*" OR CommandLine="*TgBFAHQALgBXAEUAQg*" OR CommandLine="*OAEUAdAAuAFcARQBCA*" OR CommandLine="*bgBlAFQALgBXAEUAQg*" OR CommandLine="*4AZQBUAC4AVwBFAEIA*" OR CommandLine="*uAGUAVAAuAFcARQBCA*" OR CommandLine="*TgBlAFQALgBXAEUAQg*" OR CommandLine="*OAGUAVAAuAFcARQBCA*" OR CommandLine="*bgBFAFQALgBXAEUAQg*" OR CommandLine="*4ARQBUAC4AVwBFAEIA*" OR CommandLine="*uAEUAVAAuAFcARQBCA*"))) | eval sigma_attack_tags="attack.execution attack.t1059.001" | eval sigma_title="Net WebClient Casing Anomalies" | eval sigma_description="Detects PowerShell command line contents that include a suspicious abnormal casing in the Net.Webclient (e.g. nEt.WEbCliEnT) string as used in obfuscation techniques"
dispatch.earliest_time = -24h@h
alert.track = 0

[NodejsTools PressAnyKey Lolbin - winevent]
description = Detects a certain command line flag combination used by Microsoft.NodejsTools.PressAnyKey.exe that can be used to execute any other binary
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (Process_Command_Line="*Microsoft.NodejsTools.PressAnyKey.exe normal *" OR ((Process_Command_Line="*.exe normal *" Process_Command_Line="*.exe"))) NOT (((New_Process_Name="*\\Microsoft\\NodeJsTools\\NodeJsTools*"))))) | eval sigma_attack_tags="attack.execution attack.defense_evasion attack.t1218" | eval sigma_title="NodejsTools PressAnyKey Lolbin" | eval sigma_description="Detects a certain command line flag combination used by Microsoft.NodejsTools.PressAnyKey.exe that can be used to execute any other binary"
dispatch.earliest_time = -24h@h
alert.track = 0

[NodejsTools PressAnyKey Lolbin - sysmon]
description = Detects a certain command line flag combination used by Microsoft.NodejsTools.PressAnyKey.exe that can be used to execute any other binary
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (CommandLine="*Microsoft.NodejsTools.PressAnyKey.exe normal *" OR ((CommandLine="*.exe normal *" CommandLine="*.exe"))) NOT (((Image="*\\Microsoft\\NodeJsTools\\NodeJsTools*"))))) | eval sigma_attack_tags="attack.execution attack.defense_evasion attack.t1218" | eval sigma_title="NodejsTools PressAnyKey Lolbin" | eval sigma_description="Detects a certain command line flag combination used by Microsoft.NodejsTools.PressAnyKey.exe that can be used to execute any other binary"
dispatch.earliest_time = -24h@h
alert.track = 0

[Abusing Print Executable - winevent]
description = Attackers can use print.exe for remote file copy
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\print.exe" Process_Command_Line="print*" Process_Command_Line="*/D*" Process_Command_Line="*.exe*")) NOT ((Process_Command_Line="*print.exe*")))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218" | eval sigma_title="Abusing Print Executable" | eval sigma_description="Attackers can use print.exe for remote file copy"
dispatch.earliest_time = -24h@h
alert.track = 0

[Abusing Print Executable - sysmon]
description = Attackers can use print.exe for remote file copy
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\print.exe" CommandLine="print*" CommandLine="*/D*" CommandLine="*.exe*")) NOT ((CommandLine="*print.exe*")))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218" | eval sigma_title="Abusing Print Executable" | eval sigma_description="Attackers can use print.exe for remote file copy"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Use of Procdump on LSASS - winevent]
description = Detects suspicious uses of the SysInternals Procdump utility by using a special command line parameter in combination with the lsass.exe process. This way we're also able to catch cases in which the attacker has renamed the procdump executable.
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (Process_Command_Line="* -ma *" OR Process_Command_Line="* /ma *") Process_Command_Line="* ls*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1036 attack.credential_access attack.t1003.001 car.2013-05-009" | eval sigma_title="Suspicious Use of Procdump on LSASS" | eval sigma_description="Detects suspicious uses of the SysInternals Procdump utility by using a special command line parameter in combination with the lsass.exe process. This way we're also able to catch cases in which the attacker has renamed the procdump executable."
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Use of Procdump on LSASS - sysmon]
description = Detects suspicious uses of the SysInternals Procdump utility by using a special command line parameter in combination with the lsass.exe process. This way we're also able to catch cases in which the attacker has renamed the procdump executable.
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (CommandLine="* -ma *" OR CommandLine="* /ma *") CommandLine="* ls*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1036 attack.credential_access attack.t1003.001 car.2013-05-009" | eval sigma_title="Suspicious Use of Procdump on LSASS" | eval sigma_description="Detects suspicious uses of the SysInternals Procdump utility by using a special command line parameter in combination with the lsass.exe process. This way we're also able to catch cases in which the attacker has renamed the procdump executable."
dispatch.earliest_time = -24h@h
alert.track = 0

[Process Hacker / System Informer Usage - winevent]
description = Detects suspicious use of Process Hacker and its newer version named System Informer, a tool to view and manipulate processes, kernel options and other low level stuff
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\ProcessHacker_*" OR (New_Process_Name="*\\SystemInformer.exe" OR New_Process_Name="*\\ProcessHacker.exe") OR (OriginalFileName="ProcessHacker.exe" OR OriginalFileName="Process Hacker" OR OriginalFileName="SystemInformer.exe") OR (Description="Process Hacker" OR Description="System Informer") OR Product="Process Hacker" OR (Hashes="*MD5=68F9B52895F4D34E74112F3129B3B00D*" OR Hashes="*SHA1=C5E2018BF7C0F314FED4FD7FE7E69FA2E648359E*" OR Hashes="*SHA256=D4A0FE56316A2C45B9BA9AC1005363309A3EDC7ACF9E4DF64D326A0FF273E80F*" OR Hashes="*IMPHASH=04DE0AD9C37EB7BD52043D2ECAC958DF*" OR Hashes="*MD5=B365AF317AE730A67C936F21432B9C71*" OR Hashes="*SHA1=A0BDFAC3CE1880B32FF9B696458327CE352E3B1D*" OR Hashes="*SHA256=BD2C2CF0631D881ED382817AFCCE2B093F4E412FFB170A719E2762F250ABFEA4*" OR Hashes="*IMPHASH=3695333C60DEDECDCAFF1590409AA462*") OR (md5="68f9b52895f4d34e74112f3129b3b00d" OR md5="b365af317ae730a67c936f21432b9c71") OR (sha1="c5e2018bf7c0f314fed4fd7fe7e69fa2e648359e" OR sha1="a0bdfac3ce1880b32ff9b696458327ce352e3b1d") OR (sha256="d4a0fe56316a2c45b9ba9ac1005363309a3edc7acf9e4df64d326a0ff273e80f" OR sha256="bd2c2cf0631d881ed382817afcce2b093f4e412ffb170a719e2762f250abfea4") OR (Imphash="04de0ad9c37eb7bd52043d2ecac958df" OR Imphash="3695333c60dedecdcaff1590409aa462")))) | eval sigma_attack_tags="" | eval sigma_title="Process Hacker / System Informer Usage" | eval sigma_description="Detects suspicious use of Process Hacker and its newer version named System Informer, a tool to view and manipulate processes, kernel options and other low level stuff"
dispatch.earliest_time = -24h@h
alert.track = 0

[Process Hacker / System Informer Usage - sysmon]
description = Detects suspicious use of Process Hacker and its newer version named System Informer, a tool to view and manipulate processes, kernel options and other low level stuff
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\ProcessHacker_*" OR (Image="*\\SystemInformer.exe" OR Image="*\\ProcessHacker.exe") OR (OriginalFileName="ProcessHacker.exe" OR OriginalFileName="Process Hacker" OR OriginalFileName="SystemInformer.exe") OR (Description="Process Hacker" OR Description="System Informer") OR Product="Process Hacker" OR (Hashes="*MD5=68F9B52895F4D34E74112F3129B3B00D*" OR Hashes="*SHA1=C5E2018BF7C0F314FED4FD7FE7E69FA2E648359E*" OR Hashes="*SHA256=D4A0FE56316A2C45B9BA9AC1005363309A3EDC7ACF9E4DF64D326A0FF273E80F*" OR Hashes="*IMPHASH=04DE0AD9C37EB7BD52043D2ECAC958DF*" OR Hashes="*MD5=B365AF317AE730A67C936F21432B9C71*" OR Hashes="*SHA1=A0BDFAC3CE1880B32FF9B696458327CE352E3B1D*" OR Hashes="*SHA256=BD2C2CF0631D881ED382817AFCCE2B093F4E412FFB170A719E2762F250ABFEA4*" OR Hashes="*IMPHASH=3695333C60DEDECDCAFF1590409AA462*") OR (md5="68f9b52895f4d34e74112f3129b3b00d" OR md5="b365af317ae730a67c936f21432b9c71") OR (sha1="c5e2018bf7c0f314fed4fd7fe7e69fa2e648359e" OR sha1="a0bdfac3ce1880b32ff9b696458327ce352e3b1d") OR (sha256="d4a0fe56316a2c45b9ba9ac1005363309a3edc7acf9e4df64d326a0ff273e80f" OR sha256="bd2c2cf0631d881ed382817afcce2b093f4e412ffb170a719e2762f250abfea4") OR (Imphash="04de0ad9c37eb7bd52043d2ecac958df" OR Imphash="3695333c60dedecdcaff1590409aa462")))) | eval sigma_attack_tags="" | eval sigma_title="Process Hacker / System Informer Usage" | eval sigma_description="Detects suspicious use of Process Hacker and its newer version named System Informer, a tool to view and manipulate processes, kernel options and other low level stuff"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Program Names - winevent]
description = Detects suspicious patterns in program names or folders that are often found in malicious samples or hacktools
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\CVE-202*" OR (New_Process_Name="*\\poc.exe" OR New_Process_Name="*\\artifact.exe" OR New_Process_Name="*\\artifact64.exe" OR New_Process_Name="*\\artifact_protected.exe" OR New_Process_Name="*\\artifact32.exe" OR New_Process_Name="*\\artifact32big.exe" OR New_Process_Name="*obfuscated.exe" OR New_Process_Name="*obfusc.exe" OR New_Process_Name="*\\meterpreter") OR (Process_Command_Line="*inject.ps1*" OR Process_Command_Line="*Invoke-CVE*" OR Process_Command_Line="*pupy.ps1*" OR Process_Command_Line="*payload.ps1*" OR Process_Command_Line="*beacon.ps1*" OR Process_Command_Line="*PowerView.ps1*" OR Process_Command_Line="*bypass.ps1*" OR Process_Command_Line="*obfuscated.ps1*" OR Process_Command_Line="*obfusc.ps1*" OR Process_Command_Line="*obfus.ps1*" OR Process_Command_Line="*obfs.ps1*" OR Process_Command_Line="*evil.ps1*" OR Process_Command_Line="*MiniDogz.ps1*" OR Process_Command_Line="*_enc.ps1*" OR Process_Command_Line="*\\shell.ps1*" OR Process_Command_Line="*\\rshell.ps1*" OR Process_Command_Line="*revshell.ps1*" OR Process_Command_Line="*\\av.ps1*" OR Process_Command_Line="*\\av_test.ps1*" OR Process_Command_Line="*adrecon.ps1*" OR Process_Command_Line="*mimikatz.ps1*" OR Process_Command_Line="*\\PowerUp_*" OR Process_Command_Line="*powerup.ps1*" OR Process_Command_Line="*\\Temp\\a.ps1*" OR Process_Command_Line="*\\Temp\\p.ps1*" OR Process_Command_Line="*\\Temp\\1.ps1*" OR Process_Command_Line="*Hound.ps1*" OR Process_Command_Line="*encode.ps1*" OR Process_Command_Line="*powercat.ps1*")))) | table Process_Command_Line,ParentCommandLine,CurrentDirectory | eval sigma_attack_tags="" | eval sigma_title="Suspicious Program Names" | eval sigma_description="Detects suspicious patterns in program names or folders that are often found in malicious samples or hacktools"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Program Names - sysmon]
description = Detects suspicious patterns in program names or folders that are often found in malicious samples or hacktools
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\CVE-202*" OR (Image="*\\poc.exe" OR Image="*\\artifact.exe" OR Image="*\\artifact64.exe" OR Image="*\\artifact_protected.exe" OR Image="*\\artifact32.exe" OR Image="*\\artifact32big.exe" OR Image="*obfuscated.exe" OR Image="*obfusc.exe" OR Image="*\\meterpreter") OR (CommandLine="*inject.ps1*" OR CommandLine="*Invoke-CVE*" OR CommandLine="*pupy.ps1*" OR CommandLine="*payload.ps1*" OR CommandLine="*beacon.ps1*" OR CommandLine="*PowerView.ps1*" OR CommandLine="*bypass.ps1*" OR CommandLine="*obfuscated.ps1*" OR CommandLine="*obfusc.ps1*" OR CommandLine="*obfus.ps1*" OR CommandLine="*obfs.ps1*" OR CommandLine="*evil.ps1*" OR CommandLine="*MiniDogz.ps1*" OR CommandLine="*_enc.ps1*" OR CommandLine="*\\shell.ps1*" OR CommandLine="*\\rshell.ps1*" OR CommandLine="*revshell.ps1*" OR CommandLine="*\\av.ps1*" OR CommandLine="*\\av_test.ps1*" OR CommandLine="*adrecon.ps1*" OR CommandLine="*mimikatz.ps1*" OR CommandLine="*\\PowerUp_*" OR CommandLine="*powerup.ps1*" OR CommandLine="*\\Temp\\a.ps1*" OR CommandLine="*\\Temp\\p.ps1*" OR CommandLine="*\\Temp\\1.ps1*" OR CommandLine="*Hound.ps1*" OR CommandLine="*encode.ps1*" OR CommandLine="*powercat.ps1*")))) | table CommandLine,ParentCommandLine,CurrentDirectory | eval sigma_attack_tags="" | eval sigma_title="Suspicious Program Names" | eval sigma_description="Detects suspicious patterns in program names or folders that are often found in malicious samples or hacktools"
dispatch.earliest_time = -24h@h
alert.track = 0

[PowerShell Script Run in AppData - winevent]
description = Detects a suspicious command line execution that invokes PowerShell with reference to an AppData folder
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (Process_Command_Line="*powershell.exe*" OR Process_Command_Line="*\\powershell*" OR Process_Command_Line="*\\pwsh*" OR Process_Command_Line="*pwsh.exe*") Process_Command_Line="*/c *" Process_Command_Line="*\\AppData\\*" (Process_Command_Line="*Local\\*" OR Process_Command_Line="*Roaming\\*"))) | eval sigma_attack_tags="attack.execution attack.t1059.001" | eval sigma_title="PowerShell Script Run in AppData" | eval sigma_description="Detects a suspicious command line execution that invokes PowerShell with reference to an AppData folder"
dispatch.earliest_time = -24h@h
alert.track = 0

[PowerShell Script Run in AppData - sysmon]
description = Detects a suspicious command line execution that invokes PowerShell with reference to an AppData folder
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (CommandLine="*powershell.exe*" OR CommandLine="*\\powershell*" OR CommandLine="*\\pwsh*" OR CommandLine="*pwsh.exe*") CommandLine="*/c *" CommandLine="*\\AppData\\*" (CommandLine="*Local\\*" OR CommandLine="*Roaming\\*"))) | eval sigma_attack_tags="attack.execution attack.t1059.001" | eval sigma_title="PowerShell Script Run in AppData" | eval sigma_description="Detects a suspicious command line execution that invokes PowerShell with reference to an AppData folder"
dispatch.earliest_time = -24h@h
alert.track = 0

[PowerShell DownloadFile - winevent]
description = Detects the execution of powershell, a WebClient object creation and the invocation of DownloadFile in a single command line
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*powershell*" Process_Command_Line="*.DownloadFile*" Process_Command_Line="*System.Net.WebClient*")) | eval sigma_attack_tags="attack.execution attack.t1059.001 attack.command_and_control attack.t1104 attack.t1105" | eval sigma_title="PowerShell DownloadFile" | eval sigma_description="Detects the execution of powershell, a WebClient object creation and the invocation of DownloadFile in a single command line"
dispatch.earliest_time = -24h@h
alert.track = 0

[PowerShell DownloadFile - sysmon]
description = Detects the execution of powershell, a WebClient object creation and the invocation of DownloadFile in a single command line
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*powershell*" CommandLine="*.DownloadFile*" CommandLine="*System.Net.WebClient*")) | eval sigma_attack_tags="attack.execution attack.t1059.001 attack.command_and_control attack.t1104 attack.t1105" | eval sigma_title="PowerShell DownloadFile" | eval sigma_description="Detects the execution of powershell, a WebClient object creation and the invocation of DownloadFile in a single command line"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious PowerShell Obfuscated PowerShell Code - winevent]
description = Detects suspicious UTF16 and base64 encoded and often obfuscated PowerShell code often used in command lines
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (Process_Command_Line="*IAAtAGIAeABvAHIAIAAwAHgA*" OR Process_Command_Line="*AALQBiAHgAbwByACAAMAB4A*" OR Process_Command_Line="*gAC0AYgB4AG8AcgAgADAAeA*" OR Process_Command_Line="*AC4ASQBuAHYAbwBrAGUAKAApACAAfAAg*" OR Process_Command_Line="*AuAEkAbgB2AG8AawBlACgAKQAgAHwAI*" OR Process_Command_Line="*ALgBJAG4AdgBvAGsAZQAoACkAIAB8AC*" OR Process_Command_Line="*AHsAMQB9AHsAMAB9ACIAIAAtAGYAI*" OR Process_Command_Line="*B7ADEAfQB7ADAAfQAiACAALQBmAC*" OR Process_Command_Line="*AewAxAH0AewAwAH0AIgAgAC0AZgAg*" OR Process_Command_Line="*AHsAMAB9AHsAMwB9ACIAIAAtAGYAI*" OR Process_Command_Line="*B7ADAAfQB7ADMAfQAiACAALQBmAC*" OR Process_Command_Line="*AewAwAH0AewAzAH0AIgAgAC0AZgAg*" OR Process_Command_Line="*AHsAMgB9AHsAMAB9ACIAIAAtAGYAI*" OR Process_Command_Line="*B7ADIAfQB7ADAAfQAiACAALQBmAC*" OR Process_Command_Line="*AewAyAH0AewAwAH0AIgAgAC0AZgAg*" OR Process_Command_Line="*AHsAMQB9AHsAMAB9ACcAIAAtAGYAI*" OR Process_Command_Line="*B7ADEAfQB7ADAAfQAnACAALQBmAC*" OR Process_Command_Line="*AewAxAH0AewAwAH0AJwAgAC0AZgAg*" OR Process_Command_Line="*AHsAMAB9AHsAMwB9ACcAIAAtAGYAI*" OR Process_Command_Line="*B7ADAAfQB7ADMAfQAnACAALQBmAC*" OR Process_Command_Line="*AewAwAH0AewAzAH0AJwAgAC0AZgAg*" OR Process_Command_Line="*AHsAMgB9AHsAMAB9ACcAIAAtAGYAI*" OR Process_Command_Line="*B7ADIAfQB7ADAAfQAnACAALQBmAC*" OR Process_Command_Line="*AewAyAH0AewAwAH0AJwAgAC0AZgAg*"))) | eval sigma_attack_tags="attack.defense_evasion" | eval sigma_title="Suspicious PowerShell Obfuscated PowerShell Code" | eval sigma_description="Detects suspicious UTF16 and base64 encoded and often obfuscated PowerShell code often used in command lines"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious PowerShell Obfuscated PowerShell Code - sysmon]
description = Detects suspicious UTF16 and base64 encoded and often obfuscated PowerShell code often used in command lines
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (CommandLine="*IAAtAGIAeABvAHIAIAAwAHgA*" OR CommandLine="*AALQBiAHgAbwByACAAMAB4A*" OR CommandLine="*gAC0AYgB4AG8AcgAgADAAeA*" OR CommandLine="*AC4ASQBuAHYAbwBrAGUAKAApACAAfAAg*" OR CommandLine="*AuAEkAbgB2AG8AawBlACgAKQAgAHwAI*" OR CommandLine="*ALgBJAG4AdgBvAGsAZQAoACkAIAB8AC*" OR CommandLine="*AHsAMQB9AHsAMAB9ACIAIAAtAGYAI*" OR CommandLine="*B7ADEAfQB7ADAAfQAiACAALQBmAC*" OR CommandLine="*AewAxAH0AewAwAH0AIgAgAC0AZgAg*" OR CommandLine="*AHsAMAB9AHsAMwB9ACIAIAAtAGYAI*" OR CommandLine="*B7ADAAfQB7ADMAfQAiACAALQBmAC*" OR CommandLine="*AewAwAH0AewAzAH0AIgAgAC0AZgAg*" OR CommandLine="*AHsAMgB9AHsAMAB9ACIAIAAtAGYAI*" OR CommandLine="*B7ADIAfQB7ADAAfQAiACAALQBmAC*" OR CommandLine="*AewAyAH0AewAwAH0AIgAgAC0AZgAg*" OR CommandLine="*AHsAMQB9AHsAMAB9ACcAIAAtAGYAI*" OR CommandLine="*B7ADEAfQB7ADAAfQAnACAALQBmAC*" OR CommandLine="*AewAxAH0AewAwAH0AJwAgAC0AZgAg*" OR CommandLine="*AHsAMAB9AHsAMwB9ACcAIAAtAGYAI*" OR CommandLine="*B7ADAAfQB7ADMAfQAnACAALQBmAC*" OR CommandLine="*AewAwAH0AewAzAH0AJwAgAC0AZgAg*" OR CommandLine="*AHsAMgB9AHsAMAB9ACcAIAAtAGYAI*" OR CommandLine="*B7ADIAfQB7ADAAfQAnACAALQBmAC*" OR CommandLine="*AewAyAH0AewAwAH0AJwAgAC0AZgAg*"))) | eval sigma_attack_tags="attack.defense_evasion" | eval sigma_title="Suspicious PowerShell Obfuscated PowerShell Code" | eval sigma_description="Detects suspicious UTF16 and base64 encoded and often obfuscated PowerShell code often used in command lines"
dispatch.earliest_time = -24h@h
alert.track = 0

[Psexec Accepteula Condition - winevent]
description = Detects user accept agreement execution in psexec commandline
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\psexec.exe" Process_Command_Line="*accepteula*")) | table New_Process_Name,Process_Command_Line | eval sigma_attack_tags="attack.execution attack.t1569 attack.t1021" | eval sigma_title="Psexec Accepteula Condition" | eval sigma_description="Detects user accept agreement execution in psexec commandline"
dispatch.earliest_time = -24h@h
alert.track = 0

[Psexec Accepteula Condition - sysmon]
description = Detects user accept agreement execution in psexec commandline
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\psexec.exe" CommandLine="*accepteula*")) | table Image,CommandLine | eval sigma_attack_tags="attack.execution attack.t1569 attack.t1021" | eval sigma_title="Psexec Accepteula Condition" | eval sigma_description="Detects user accept agreement execution in psexec commandline"
dispatch.earliest_time = -24h@h
alert.track = 0

[PsExec Service Execution as LOCAL SYSTEM - winevent]
description = Detects suspicious launch of the PSEXESVC service on this system and a sub process run as LOCAL_SYSTEM (-s), which means that someone remotely started a command on this system running it with highest privileges and not only the privileges of the login user account (e.g. the administrator account)
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Creator_Process_Name="C:\\Windows\\PSEXESVC.exe" (Account_Name="*AUTHORI*" OR Account_Name="*AUTORI*"))) | eval sigma_attack_tags="attack.execution" | eval sigma_title="PsExec Service Execution as LOCAL SYSTEM" | eval sigma_description="Detects suspicious launch of the PSEXESVC service on this system and a sub process run as LOCAL_SYSTEM (-s), which means that someone remotely started a command on this system running it with highest privileges and not only the privileges of the login user account (e.g. the administrator account)"
dispatch.earliest_time = -24h@h
alert.track = 0

[PsExec Service Execution as LOCAL SYSTEM - sysmon]
description = Detects suspicious launch of the PSEXESVC service on this system and a sub process run as LOCAL_SYSTEM (-s), which means that someone remotely started a command on this system running it with highest privileges and not only the privileges of the login user account (e.g. the administrator account)
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") ParentImage="C:\\Windows\\PSEXESVC.exe" (User="*AUTHORI*" OR User="*AUTORI*"))) | eval sigma_attack_tags="attack.execution" | eval sigma_title="PsExec Service Execution as LOCAL SYSTEM" | eval sigma_description="Detects suspicious launch of the PSEXESVC service on this system and a sub process run as LOCAL_SYSTEM (-s), which means that someone remotely started a command on this system running it with highest privileges and not only the privileges of the login user account (e.g. the administrator account)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Renamed PsExec Service Execution - winevent]
description = Detects suspicious launch of a renamed version of the PSEXESVC service with, which is not often used by legitimate administrators
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) OriginalFileName="psexesvc.exe" NOT ((New_Process_Name="C:\\Windows\\PSEXESVC.exe")))) | eval sigma_attack_tags="attack.execution" | eval sigma_title="Renamed PsExec Service Execution" | eval sigma_description="Detects suspicious launch of a renamed version of the PSEXESVC service with, which is not often used by legitimate administrators"
dispatch.earliest_time = -24h@h
alert.track = 0

[Renamed PsExec Service Execution - sysmon]
description = Detects suspicious launch of a renamed version of the PSEXESVC service with, which is not often used by legitimate administrators
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) OriginalFileName="psexesvc.exe" NOT ((Image="C:\\Windows\\PSEXESVC.exe")))) | eval sigma_attack_tags="attack.execution" | eval sigma_title="Renamed PsExec Service Execution" | eval sigma_description="Detects suspicious launch of a renamed version of the PSEXESVC service with, which is not often used by legitimate administrators"
dispatch.earliest_time = -24h@h
alert.track = 0

[PsExec Service Execution - winevent]
description = Detects launch of the PSEXESVC service, which means that this system was the target of a psexec remote execution
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="C:\\Windows\\PSEXESVC.exe" OR OriginalFileName="psexesvc.exe"))) | eval sigma_attack_tags="attack.execution" | eval sigma_title="PsExec Service Execution" | eval sigma_description="Detects launch of the PSEXESVC service, which means that this system was the target of a psexec remote execution"
dispatch.earliest_time = -24h@h
alert.track = 0

[PsExec Service Execution - sysmon]
description = Detects launch of the PSEXESVC service, which means that this system was the target of a psexec remote execution
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="C:\\Windows\\PSEXESVC.exe" OR OriginalFileName="psexesvc.exe"))) | eval sigma_attack_tags="attack.execution" | eval sigma_title="PsExec Service Execution" | eval sigma_description="Detects launch of the PSEXESVC service, which means that this system was the target of a psexec remote execution"
dispatch.earliest_time = -24h@h
alert.track = 0

[PsExec/PAExec Escalation to LOCAL SYSTEM - winevent]
description = Detects suspicious flags used by PsExec and PAExec to escalate a command line to LOCAL_SYSTEM rights
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (Process_Command_Line="* -s cmd*" OR Process_Command_Line="* /s cmd*" OR Process_Command_Line="* -s -i cmd*" OR Process_Command_Line="* /s /i cmd*" OR Process_Command_Line="* /s -i cmd*" OR Process_Command_Line="* -s /i cmd*" OR Process_Command_Line="* -i -s cmd*" OR Process_Command_Line="* /i /s cmd*" OR Process_Command_Line="* -i /s cmd*" OR Process_Command_Line="* /i -s cmd*" OR Process_Command_Line="* -s pwsh*" OR Process_Command_Line="* /s pwsh*" OR Process_Command_Line="* -s -i pwsh*" OR Process_Command_Line="* /s /i pwsh*" OR Process_Command_Line="* /s -i pwsh*" OR Process_Command_Line="* -s /i pwsh*" OR Process_Command_Line="* -i -s pwsh*" OR Process_Command_Line="* /i /s pwsh*" OR Process_Command_Line="* -i /s pwsh*" OR Process_Command_Line="* /i -s pwsh*" OR Process_Command_Line="* -s powershell*" OR Process_Command_Line="* /s powershell*" OR Process_Command_Line="* -s -i powershell*" OR Process_Command_Line="* /s /i powershell*" OR Process_Command_Line="* /s -i powershell*" OR Process_Command_Line="* -s /i powershell*" OR Process_Command_Line="* -i -s powershell*" OR Process_Command_Line="* /i /s powershell*" OR Process_Command_Line="* -i /s powershell*" OR Process_Command_Line="* /i -s powershell*") (Process_Command_Line="*psexec*" OR Process_Command_Line="*paexec*" OR Process_Command_Line="*accepteula*" OR Process_Command_Line="*cmd /c *" OR Process_Command_Line="*cmd /k *" OR Process_Command_Line="*cmd /r *"))) | eval sigma_attack_tags="attack.resource_development attack.t1587.001" | eval sigma_title="PsExec/PAExec Escalation to LOCAL SYSTEM" | eval sigma_description="Detects suspicious flags used by PsExec and PAExec to escalate a command line to LOCAL_SYSTEM rights"
dispatch.earliest_time = -24h@h
alert.track = 0

[PsExec/PAExec Escalation to LOCAL SYSTEM - sysmon]
description = Detects suspicious flags used by PsExec and PAExec to escalate a command line to LOCAL_SYSTEM rights
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (CommandLine="* -s cmd*" OR CommandLine="* /s cmd*" OR CommandLine="* -s -i cmd*" OR CommandLine="* /s /i cmd*" OR CommandLine="* /s -i cmd*" OR CommandLine="* -s /i cmd*" OR CommandLine="* -i -s cmd*" OR CommandLine="* /i /s cmd*" OR CommandLine="* -i /s cmd*" OR CommandLine="* /i -s cmd*" OR CommandLine="* -s pwsh*" OR CommandLine="* /s pwsh*" OR CommandLine="* -s -i pwsh*" OR CommandLine="* /s /i pwsh*" OR CommandLine="* /s -i pwsh*" OR CommandLine="* -s /i pwsh*" OR CommandLine="* -i -s pwsh*" OR CommandLine="* /i /s pwsh*" OR CommandLine="* -i /s pwsh*" OR CommandLine="* /i -s pwsh*" OR CommandLine="* -s powershell*" OR CommandLine="* /s powershell*" OR CommandLine="* -s -i powershell*" OR CommandLine="* /s /i powershell*" OR CommandLine="* /s -i powershell*" OR CommandLine="* -s /i powershell*" OR CommandLine="* -i -s powershell*" OR CommandLine="* /i /s powershell*" OR CommandLine="* -i /s powershell*" OR CommandLine="* /i -s powershell*") (CommandLine="*psexec*" OR CommandLine="*paexec*" OR CommandLine="*accepteula*" OR CommandLine="*cmd /c *" OR CommandLine="*cmd /k *" OR CommandLine="*cmd /r *"))) | eval sigma_attack_tags="attack.resource_development attack.t1587.001" | eval sigma_title="PsExec/PAExec Escalation to LOCAL SYSTEM" | eval sigma_description="Detects suspicious flags used by PsExec and PAExec to escalate a command line to LOCAL_SYSTEM rights"
dispatch.earliest_time = -24h@h
alert.track = 0

[PsExec/PAExec Flags - winevent]
description = Detects suspicious flags used by PsExec and PAExec but no usual program name in command line
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((Process_Command_Line="* -s cmd*" OR Process_Command_Line="* /s cmd*" OR Process_Command_Line="* -s -i cmd*" OR Process_Command_Line="* /s /i cmd*" OR Process_Command_Line="* /s -i cmd*" OR Process_Command_Line="* -s /i cmd*" OR Process_Command_Line="* -i -s cmd*" OR Process_Command_Line="* /i /s cmd*" OR Process_Command_Line="* -i /s cmd*" OR Process_Command_Line="* /i -s cmd*" OR Process_Command_Line="* -s pwsh*" OR Process_Command_Line="* /s pwsh*" OR Process_Command_Line="* -s -i pwsh*" OR Process_Command_Line="* /s /i pwsh*" OR Process_Command_Line="* /s -i pwsh*" OR Process_Command_Line="* -s /i pwsh*" OR Process_Command_Line="* -i -s pwsh*" OR Process_Command_Line="* /i /s pwsh*" OR Process_Command_Line="* -i /s pwsh*" OR Process_Command_Line="* /i -s pwsh*" OR Process_Command_Line="* -s powershell*" OR Process_Command_Line="* /s powershell*" OR Process_Command_Line="* -s -i powershell*" OR Process_Command_Line="* /s /i powershell*" OR Process_Command_Line="* /s -i powershell*" OR Process_Command_Line="* -s /i powershell*" OR Process_Command_Line="* -i -s powershell*" OR Process_Command_Line="* /i /s powershell*" OR Process_Command_Line="* -i /s powershell*" OR Process_Command_Line="* /i -s powershell*") OR ((Process_Command_Line="*accepteula*" Process_Command_Line="* -u *" Process_Command_Line="* -p *" Process_Command_Line="* \\\*"))) NOT (((Process_Command_Line="*paexec*" OR Process_Command_Line="*PsExec*"))))) | eval sigma_attack_tags="attack.resource_development attack.t1587.001" | eval sigma_title="PsExec/PAExec Flags" | eval sigma_description="Detects suspicious flags used by PsExec and PAExec but no usual program name in command line"
dispatch.earliest_time = -24h@h
alert.track = 0

[PsExec/PAExec Flags - sysmon]
description = Detects suspicious flags used by PsExec and PAExec but no usual program name in command line
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((CommandLine="* -s cmd*" OR CommandLine="* /s cmd*" OR CommandLine="* -s -i cmd*" OR CommandLine="* /s /i cmd*" OR CommandLine="* /s -i cmd*" OR CommandLine="* -s /i cmd*" OR CommandLine="* -i -s cmd*" OR CommandLine="* /i /s cmd*" OR CommandLine="* -i /s cmd*" OR CommandLine="* /i -s cmd*" OR CommandLine="* -s pwsh*" OR CommandLine="* /s pwsh*" OR CommandLine="* -s -i pwsh*" OR CommandLine="* /s /i pwsh*" OR CommandLine="* /s -i pwsh*" OR CommandLine="* -s /i pwsh*" OR CommandLine="* -i -s pwsh*" OR CommandLine="* /i /s pwsh*" OR CommandLine="* -i /s pwsh*" OR CommandLine="* /i -s pwsh*" OR CommandLine="* -s powershell*" OR CommandLine="* /s powershell*" OR CommandLine="* -s -i powershell*" OR CommandLine="* /s /i powershell*" OR CommandLine="* /s -i powershell*" OR CommandLine="* -s /i powershell*" OR CommandLine="* -i -s powershell*" OR CommandLine="* /i /s powershell*" OR CommandLine="* -i /s powershell*" OR CommandLine="* /i -s powershell*") OR ((CommandLine="*accepteula*" CommandLine="* -u *" CommandLine="* -p *" CommandLine="* \\\*"))) NOT (((CommandLine="*paexec*" OR CommandLine="*PsExec*"))))) | eval sigma_attack_tags="attack.resource_development attack.t1587.001" | eval sigma_title="PsExec/PAExec Flags" | eval sigma_description="Detects suspicious flags used by PsExec and PAExec but no usual program name in command line"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Use of PsLogList - winevent]
description = Detects usage of the PsLogList utility to dump event log in order to extract admin accounts and perform account discovery or delete events logs
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (OriginalFileName="psloglist.exe" OR (New_Process_Name="*\\psloglist.exe" OR New_Process_Name="*\\psloglist64.exe")) (Process_Command_Line="* security*" OR Process_Command_Line="* application*" OR Process_Command_Line="* system*") (Process_Command_Line="* -d*" OR Process_Command_Line="* /d*" OR Process_Command_Line="* -x*" OR Process_Command_Line="* /x*" OR Process_Command_Line="* -s*" OR Process_Command_Line="* /s*" OR Process_Command_Line="* -c*" OR Process_Command_Line="* /c*" OR Process_Command_Line="* -g*" OR Process_Command_Line="* /g*"))) | eval sigma_attack_tags="attack.discovery attack.t1087 attack.t1087.001 attack.t1087.002" | eval sigma_title="Suspicious Use of PsLogList" | eval sigma_description="Detects usage of the PsLogList utility to dump event log in order to extract admin accounts and perform account discovery or delete events logs"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Use of PsLogList - sysmon]
description = Detects usage of the PsLogList utility to dump event log in order to extract admin accounts and perform account discovery or delete events logs
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (OriginalFileName="psloglist.exe" OR (Image="*\\psloglist.exe" OR Image="*\\psloglist64.exe")) (CommandLine="* security*" OR CommandLine="* application*" OR CommandLine="* system*") (CommandLine="* -d*" OR CommandLine="* /d*" OR CommandLine="* -x*" OR CommandLine="* /x*" OR CommandLine="* -s*" OR CommandLine="* /s*" OR CommandLine="* -c*" OR CommandLine="* /c*" OR CommandLine="* -g*" OR CommandLine="* /g*"))) | eval sigma_attack_tags="attack.discovery attack.t1087 attack.t1087.001 attack.t1087.002" | eval sigma_title="Suspicious Use of PsLogList" | eval sigma_description="Detects usage of the PsLogList utility to dump event log in order to extract admin accounts and perform account discovery or delete events logs"
dispatch.earliest_time = -24h@h
alert.track = 0

[Psr.exe Capture Screenshots - winevent]
description = The psr.exe captures desktop screenshots and saves them on the local machine
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\Psr.exe" Process_Command_Line="*/start*")) | eval sigma_attack_tags="attack.collection attack.t1113" | eval sigma_title="Psr.exe Capture Screenshots" | eval sigma_description="The psr.exe captures desktop screenshots and saves them on the local machine"
dispatch.earliest_time = -24h@h
alert.track = 0

[Psr.exe Capture Screenshots - sysmon]
description = The psr.exe captures desktop screenshots and saves them on the local machine
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\Psr.exe" CommandLine="*/start*")) | eval sigma_attack_tags="attack.collection attack.t1113" | eval sigma_title="Psr.exe Capture Screenshots" | eval sigma_description="The psr.exe captures desktop screenshots and saves them on the local machine"
dispatch.earliest_time = -24h@h
alert.track = 0

[Rar Usage with Password and Compression Level - winevent]
description = Detects the use of rar.exe, on the command line, to create an archive with password protection or with a specific compression level. This is pretty indicative of malicious actions.
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="* -hp*" (Process_Command_Line="* -m*" OR Process_Command_Line="* a *"))) | eval sigma_attack_tags="attack.collection attack.t1560.001" | eval sigma_title="Rar Usage with Password and Compression Level" | eval sigma_description="Detects the use of rar.exe, on the command line, to create an archive with password protection or with a specific compression level. This is pretty indicative of malicious actions."
dispatch.earliest_time = -24h@h
alert.track = 0

[Rar Usage with Password and Compression Level - sysmon]
description = Detects the use of rar.exe, on the command line, to create an archive with password protection or with a specific compression level. This is pretty indicative of malicious actions.
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="* -hp*" (CommandLine="* -m*" OR CommandLine="* a *"))) | eval sigma_attack_tags="attack.collection attack.t1560.001" | eval sigma_title="Rar Usage with Password and Compression Level" | eval sigma_description="Detects the use of rar.exe, on the command line, to create an archive with password protection or with a specific compression level. This is pretty indicative of malicious actions."
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious RASdial Activity - winevent]
description = Detects suspicious process related to rasdial.exe
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*rasdial.exe")) | eval sigma_attack_tags="attack.defense_evasion attack.execution attack.t1059" | eval sigma_title="Suspicious RASdial Activity" | eval sigma_description="Detects suspicious process related to rasdial.exe"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious RASdial Activity - sysmon]
description = Detects suspicious process related to rasdial.exe
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*rasdial.exe")) | eval sigma_attack_tags="attack.defense_evasion attack.execution attack.t1059" | eval sigma_title="Suspicious RASdial Activity" | eval sigma_description="Detects suspicious process related to rasdial.exe"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious RazerInstaller Explorer Subprocess - winevent]
description = Detects a explorer.exe sub process of the RazerInstaller software which can be invoked from the installer to select a different installation folder but can also be exploited to escalate privileges to LOCAL SYSTEM
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((Creator_Process_Name="*\\RazerInstaller.exe" IntegrityLevel="System")) NOT ((New_Process_Name="C:\\Windows\\Installer\\Razer\\Installer\\*")))) | eval sigma_attack_tags="attack.privilege_escalation attack.t1553" | eval sigma_title="Suspicious RazerInstaller Explorer Subprocess" | eval sigma_description="Detects a explorer.exe sub process of the RazerInstaller software which can be invoked from the installer to select a different installation folder but can also be exploited to escalate privileges to LOCAL SYSTEM"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious RazerInstaller Explorer Subprocess - sysmon]
description = Detects a explorer.exe sub process of the RazerInstaller software which can be invoked from the installer to select a different installation folder but can also be exploited to escalate privileges to LOCAL SYSTEM
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((ParentImage="*\\RazerInstaller.exe" IntegrityLevel="System")) NOT ((Image="C:\\Windows\\Installer\\Razer\\Installer\\*")))) | eval sigma_attack_tags="attack.privilege_escalation attack.t1553" | eval sigma_title="Suspicious RazerInstaller Explorer Subprocess" | eval sigma_description="Detects a explorer.exe sub process of the RazerInstaller software which can be invoked from the installer to select a different installation folder but can also be exploited to escalate privileges to LOCAL SYSTEM"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential PE Metadata Tamper Using Rcedit - winevent]
description = Detects the use of rcedit to potentially alter executable PE metadata properties, which could conceal efforts to rename system utilities for defense evasion.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\rcedit-x64.exe" OR New_Process_Name="*\\rcedit-x86.exe") OR Description="Edit resources of exe" OR Product="rcedit") Process_Command_Line="*--set-*" (Process_Command_Line="*OriginalFileName*" OR Process_Command_Line="*CompanyName*" OR Process_Command_Line="*FileDescription*" OR Process_Command_Line="*ProductName*" OR Process_Command_Line="*ProductVersion*" OR Process_Command_Line="*LegalCopyright*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1036.003 attack.t1036 attack.t1027.005 attack.t1027" | eval sigma_title="Potential PE Metadata Tamper Using Rcedit" | eval sigma_description="Detects the use of rcedit to potentially alter executable PE metadata properties, which could conceal efforts to rename system utilities for defense evasion."
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential PE Metadata Tamper Using Rcedit - sysmon]
description = Detects the use of rcedit to potentially alter executable PE metadata properties, which could conceal efforts to rename system utilities for defense evasion.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\rcedit-x64.exe" OR Image="*\\rcedit-x86.exe") OR Description="Edit resources of exe" OR Product="rcedit") CommandLine="*--set-*" (CommandLine="*OriginalFileName*" OR CommandLine="*CompanyName*" OR CommandLine="*FileDescription*" OR CommandLine="*ProductName*" OR CommandLine="*ProductVersion*" OR CommandLine="*LegalCopyright*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1036.003 attack.t1036 attack.t1027.005 attack.t1027" | eval sigma_title="Potential PE Metadata Tamper Using Rcedit" | eval sigma_description="Detects the use of rcedit to potentially alter executable PE metadata properties, which could conceal efforts to rename system utilities for defense evasion."
dispatch.earliest_time = -24h@h
alert.track = 0

[Rclone Execution via Command Line or PowerShell - winevent]
description = Detects execution of RClone utility for exfiltration as used by various ransomwares strains like REvil, Conti, FiveHands, etc
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((Process_Command_Line="*--config *" Process_Command_Line="*--no-check-certificate *" Process_Command_Line="* copy *")) OR (((Process_Command_Line="*pass*" OR Process_Command_Line="*user*" OR Process_Command_Line="*copy*" OR Process_Command_Line="*sync*" OR Process_Command_Line="*config*" OR Process_Command_Line="*lsd*" OR Process_Command_Line="*remote*" OR Process_Command_Line="*ls*" OR Process_Command_Line="*mega*" OR Process_Command_Line="*pcloud*" OR Process_Command_Line="*ftp*" OR Process_Command_Line="*ignore-existing*" OR Process_Command_Line="*auto-confirm*" OR Process_Command_Line="*transfers*" OR Process_Command_Line="*multi-thread-streams*" OR Process_Command_Line="*no-check-certificate *") (Description="Rsync for cloud storage" OR ((New_Process_Name="*\\rclone.exe" (Creator_Process_Name="*\\PowerShell.exe" OR Creator_Process_Name="*\\pwsh.exe" OR Creator_Process_Name="*\\cmd.exe"))))))))) | table Process_Command_Line,ParentCommandLine,NewValue | eval sigma_attack_tags="attack.exfiltration attack.t1567.002" | eval sigma_title="Rclone Execution via Command Line or PowerShell" | eval sigma_description="Detects execution of RClone utility for exfiltration as used by various ransomwares strains like REvil, Conti, FiveHands, etc"
dispatch.earliest_time = -24h@h
alert.track = 0

[Rclone Execution via Command Line or PowerShell - sysmon]
description = Detects execution of RClone utility for exfiltration as used by various ransomwares strains like REvil, Conti, FiveHands, etc
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((CommandLine="*--config *" CommandLine="*--no-check-certificate *" CommandLine="* copy *")) OR (((CommandLine="*pass*" OR CommandLine="*user*" OR CommandLine="*copy*" OR CommandLine="*sync*" OR CommandLine="*config*" OR CommandLine="*lsd*" OR CommandLine="*remote*" OR CommandLine="*ls*" OR CommandLine="*mega*" OR CommandLine="*pcloud*" OR CommandLine="*ftp*" OR CommandLine="*ignore-existing*" OR CommandLine="*auto-confirm*" OR CommandLine="*transfers*" OR CommandLine="*multi-thread-streams*" OR CommandLine="*no-check-certificate *") (Description="Rsync for cloud storage" OR ((Image="*\\rclone.exe" (ParentImage="*\\PowerShell.exe" OR ParentImage="*\\pwsh.exe" OR ParentImage="*\\cmd.exe"))))))))) | table CommandLine,ParentCommandLine,Details | eval sigma_attack_tags="attack.exfiltration attack.t1567.002" | eval sigma_title="Rclone Execution via Command Line or PowerShell" | eval sigma_description="Detects execution of RClone utility for exfiltration as used by various ransomwares strains like REvil, Conti, FiveHands, etc"
dispatch.earliest_time = -24h@h
alert.track = 0

[Network Reconnaissance Activity - winevent]
description = Detects a set of suspicious network related commands often used in recon stages
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*nslookup*" Process_Command_Line="*_ldap._tcp.dc._msdcs.*")) | eval sigma_attack_tags="attack.discovery attack.t1087 attack.t1082 car.2016-03-001" | eval sigma_title="Network Reconnaissance Activity" | eval sigma_description="Detects a set of suspicious network related commands often used in recon stages"
dispatch.earliest_time = -24h@h
alert.track = 0

[Network Reconnaissance Activity - sysmon]
description = Detects a set of suspicious network related commands often used in recon stages
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*nslookup*" CommandLine="*_ldap._tcp.dc._msdcs.*")) | eval sigma_attack_tags="attack.discovery attack.t1087 attack.t1082 car.2016-03-001" | eval sigma_title="Network Reconnaissance Activity" | eval sigma_description="Detects a set of suspicious network related commands often used in recon stages"
dispatch.earliest_time = -24h@h
alert.track = 0

[Recon Information for Export with Command Prompt - winevent]
description = Once established within a system or network, an adversary may use automated techniques for collecting internal data.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\tree.com" OR New_Process_Name="*\\WMIC.exe" OR New_Process_Name="*\\doskey.exe" OR New_Process_Name="*\\sc.exe") OR (OriginalFileName="wmic.exe" OR OriginalFileName="DOSKEY.EXE" OR OriginalFileName="sc.exe")) (ParentCommandLine="* > %TEMP%\\*" OR ParentCommandLine="* > %TMP%\\*"))) | eval sigma_attack_tags="attack.collection attack.t1119" | eval sigma_title="Recon Information for Export with Command Prompt" | eval sigma_description="Once established within a system or network, an adversary may use automated techniques for collecting internal data."
dispatch.earliest_time = -24h@h
alert.track = 0

[Recon Information for Export with Command Prompt - sysmon]
description = Once established within a system or network, an adversary may use automated techniques for collecting internal data.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\tree.com" OR Image="*\\WMIC.exe" OR Image="*\\doskey.exe" OR Image="*\\sc.exe") OR (OriginalFileName="wmic.exe" OR OriginalFileName="DOSKEY.EXE" OR OriginalFileName="sc.exe")) (ParentCommandLine="* > %TEMP%\\*" OR ParentCommandLine="* > %TMP%\\*"))) | eval sigma_attack_tags="attack.collection attack.t1119" | eval sigma_title="Recon Information for Export with Command Prompt" | eval sigma_description="Once established within a system or network, an adversary may use automated techniques for collecting internal data."
dispatch.earliest_time = -24h@h
alert.track = 0

[Reg Add Suspicious Paths - winevent]
description = Detects when an adversary uses the reg.exe utility to add or modify new keys or subkeys
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\reg.exe" OR OriginalFileName="reg.exe") (Process_Command_Line="*\\AppDataLow\\Software\\Microsoft\\*" OR Process_Command_Line="*\\Policies\\Microsoft\\Windows\\OOBE*" OR Process_Command_Line="*\\Policies\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon*" OR Process_Command_Line="*\\SOFTWARE\\Microsoft\\Windows NT\\Currentversion\\Winlogon*" OR Process_Command_Line="*\\CurrentControlSet\\Control\\SecurityProviders\\WDigest*" OR Process_Command_Line="*\\Microsoft\\Windows Defender\\*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1112 attack.t1562.001" | eval sigma_title="Reg Add Suspicious Paths" | eval sigma_description="Detects when an adversary uses the reg.exe utility to add or modify new keys or subkeys"
dispatch.earliest_time = -24h@h
alert.track = 0

[Reg Add Suspicious Paths - sysmon]
description = Detects when an adversary uses the reg.exe utility to add or modify new keys or subkeys
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\reg.exe" OR OriginalFileName="reg.exe") (CommandLine="*\\AppDataLow\\Software\\Microsoft\\*" OR CommandLine="*\\Policies\\Microsoft\\Windows\\OOBE*" OR CommandLine="*\\Policies\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon*" OR CommandLine="*\\SOFTWARE\\Microsoft\\Windows NT\\Currentversion\\Winlogon*" OR CommandLine="*\\CurrentControlSet\\Control\\SecurityProviders\\WDigest*" OR CommandLine="*\\Microsoft\\Windows Defender\\*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1112 attack.t1562.001" | eval sigma_title="Reg Add Suspicious Paths" | eval sigma_description="Detects when an adversary uses the reg.exe utility to add or modify new keys or subkeys"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Reg Add BitLocker - winevent]
description = Detects suspicious addition to BitLocker related registry keys via the reg.exe utility
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*REG*" Process_Command_Line="*ADD*" Process_Command_Line="*\\SOFTWARE\\Policies\\Microsoft\\FVE*" Process_Command_Line="*/v*" Process_Command_Line="*/f*" (Process_Command_Line="*EnableBDEWithNoTPM*" OR Process_Command_Line="*UseAdvancedStartup*" OR Process_Command_Line="*UseTPM*" OR Process_Command_Line="*UseTPMKey*" OR Process_Command_Line="*UseTPMKeyPIN*" OR Process_Command_Line="*RecoveryKeyMessageSource*" OR Process_Command_Line="*UseTPMPIN*" OR Process_Command_Line="*RecoveryKeyMessage*"))) | eval sigma_attack_tags="attack.impact attack.t1486" | eval sigma_title="Suspicious Reg Add BitLocker" | eval sigma_description="Detects suspicious addition to BitLocker related registry keys via the reg.exe utility"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Reg Add BitLocker - sysmon]
description = Detects suspicious addition to BitLocker related registry keys via the reg.exe utility
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*REG*" CommandLine="*ADD*" CommandLine="*\\SOFTWARE\\Policies\\Microsoft\\FVE*" CommandLine="*/v*" CommandLine="*/f*" (CommandLine="*EnableBDEWithNoTPM*" OR CommandLine="*UseAdvancedStartup*" OR CommandLine="*UseTPM*" OR CommandLine="*UseTPMKey*" OR CommandLine="*UseTPMKeyPIN*" OR CommandLine="*RecoveryKeyMessageSource*" OR CommandLine="*UseTPMPIN*" OR CommandLine="*RecoveryKeyMessage*"))) | eval sigma_attack_tags="attack.impact attack.t1486" | eval sigma_title="Suspicious Reg Add BitLocker" | eval sigma_description="Detects suspicious addition to BitLocker related registry keys via the reg.exe utility"
dispatch.earliest_time = -24h@h
alert.track = 0

[Reg Disable Security Service - winevent]
description = Detects a suspicious reg.exe invocation that looks as if it would disable an important security service
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((Process_Command_Line="*reg*" Process_Command_Line="*add*")) (((Process_Command_Line="* /d 4*" Process_Command_Line="* /v Start*" (Process_Command_Line="*\\Sense*" OR Process_Command_Line="*\\WinDefend*" OR Process_Command_Line="*\\MsMpSvc*" OR Process_Command_Line="*\\NisSrv*" OR Process_Command_Line="*\\WdBoot*" OR Process_Command_Line="*\\WdNisDrv*" OR Process_Command_Line="*\\WdNisSvc*" OR Process_Command_Line="*\\wscsvc*" OR Process_Command_Line="*\\SecurityHealthService*" OR Process_Command_Line="*\\wuauserv*" OR Process_Command_Line="*\\UsoSvc*" OR Process_Command_Line="*\\WdFilter*" OR Process_Command_Line="*\\AppIDSvc*"))) OR ((Process_Command_Line="* /d 1*" Process_Command_Line="*Windows Defender*" (Process_Command_Line="*DisableIOAVProtection*" OR Process_Command_Line="*DisableOnAccessProtection*" OR Process_Command_Line="*DisableRoutinelyTakingAction*" OR Process_Command_Line="*DisableScanOnRealtimeEnable*" OR Process_Command_Line="*DisableBlockAtFirstSeen*" OR Process_Command_Line="*DisableBehaviorMonitoring*" OR Process_Command_Line="*DisableEnhancedNotifications*" OR Process_Command_Line="*DisableAntiSpyware*" OR Process_Command_Line="*DisableAntiSpywareRealtimeProtection*" OR Process_Command_Line="*DisableConfig*" OR Process_Command_Line="*DisablePrivacyMode*" OR Process_Command_Line="*SignatureDisableUpdateOnStartupWithoutEngine*" OR Process_Command_Line="*DisableArchiveScanning*" OR Process_Command_Line="*DisableIntrusionPreventionSystem*" OR Process_Command_Line="*DisableScriptScanning*")))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.001" | eval sigma_title="Reg Disable Security Service" | eval sigma_description="Detects a suspicious reg.exe invocation that looks as if it would disable an important security service"
dispatch.earliest_time = -24h@h
alert.track = 0

[Reg Disable Security Service - sysmon]
description = Detects a suspicious reg.exe invocation that looks as if it would disable an important security service
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((CommandLine="*reg*" CommandLine="*add*")) (((CommandLine="* /d 4*" CommandLine="* /v Start*" (CommandLine="*\\Sense*" OR CommandLine="*\\WinDefend*" OR CommandLine="*\\MsMpSvc*" OR CommandLine="*\\NisSrv*" OR CommandLine="*\\WdBoot*" OR CommandLine="*\\WdNisDrv*" OR CommandLine="*\\WdNisSvc*" OR CommandLine="*\\wscsvc*" OR CommandLine="*\\SecurityHealthService*" OR CommandLine="*\\wuauserv*" OR CommandLine="*\\UsoSvc*" OR CommandLine="*\\WdFilter*" OR CommandLine="*\\AppIDSvc*"))) OR ((CommandLine="* /d 1*" CommandLine="*Windows Defender*" (CommandLine="*DisableIOAVProtection*" OR CommandLine="*DisableOnAccessProtection*" OR CommandLine="*DisableRoutinelyTakingAction*" OR CommandLine="*DisableScanOnRealtimeEnable*" OR CommandLine="*DisableBlockAtFirstSeen*" OR CommandLine="*DisableBehaviorMonitoring*" OR CommandLine="*DisableEnhancedNotifications*" OR CommandLine="*DisableAntiSpyware*" OR CommandLine="*DisableAntiSpywareRealtimeProtection*" OR CommandLine="*DisableConfig*" OR CommandLine="*DisablePrivacyMode*" OR CommandLine="*SignatureDisableUpdateOnStartupWithoutEngine*" OR CommandLine="*DisableArchiveScanning*" OR CommandLine="*DisableIntrusionPreventionSystem*" OR CommandLine="*DisableScriptScanning*")))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.001" | eval sigma_title="Reg Disable Security Service" | eval sigma_description="Detects a suspicious reg.exe invocation that looks as if it would disable an important security service"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Reg Add Open Command - winevent]
description = Threat actors performed dumping of SAM, SECURITY and SYSTEM registry hives using DelegateExecute key
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((Process_Command_Line="*reg*" Process_Command_Line="*add*" Process_Command_Line="*hkcu\\software\\classes\\ms-settings\\shell\\open\\command*" Process_Command_Line="*/ve *" Process_Command_Line="*/d*")) OR ((Process_Command_Line="*reg*" Process_Command_Line="*add*" Process_Command_Line="*hkcu\\software\\classes\\ms-settings\\shell\\open\\command*" Process_Command_Line="*/v*" Process_Command_Line="*DelegateExecute*")) OR ((Process_Command_Line="*reg*" Process_Command_Line="*delete*" Process_Command_Line="*hkcu\\software\\classes\\ms-settings*"))))) | eval sigma_attack_tags="attack.credential_access attack.t1003" | eval sigma_title="Suspicious Reg Add Open Command" | eval sigma_description="Threat actors performed dumping of SAM, SECURITY and SYSTEM registry hives using DelegateExecute key"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Reg Add Open Command - sysmon]
description = Threat actors performed dumping of SAM, SECURITY and SYSTEM registry hives using DelegateExecute key
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((CommandLine="*reg*" CommandLine="*add*" CommandLine="*hkcu\\software\\classes\\ms-settings\\shell\\open\\command*" CommandLine="*/ve *" CommandLine="*/d*")) OR ((CommandLine="*reg*" CommandLine="*add*" CommandLine="*hkcu\\software\\classes\\ms-settings\\shell\\open\\command*" CommandLine="*/v*" CommandLine="*DelegateExecute*")) OR ((CommandLine="*reg*" CommandLine="*delete*" CommandLine="*hkcu\\software\\classes\\ms-settings*"))))) | eval sigma_attack_tags="attack.credential_access attack.t1003" | eval sigma_title="Suspicious Reg Add Open Command" | eval sigma_description="Threat actors performed dumping of SAM, SECURITY and SYSTEM registry hives using DelegateExecute key"
dispatch.earliest_time = -24h@h
alert.track = 0

[Regedit as Trusted Installer - winevent]
description = Detects a regedit started with TrustedInstaller privileges or by ProcessHacker.exe
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\regedit.exe" (Creator_Process_Name="*\\TrustedInstaller.exe" OR Creator_Process_Name="*\\ProcessHacker.exe"))) | eval sigma_attack_tags="attack.privilege_escalation attack.t1548" | eval sigma_title="Regedit as Trusted Installer" | eval sigma_description="Detects a regedit started with TrustedInstaller privileges or by ProcessHacker.exe"
dispatch.earliest_time = -24h@h
alert.track = 0

[Regedit as Trusted Installer - sysmon]
description = Detects a regedit started with TrustedInstaller privileges or by ProcessHacker.exe
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\regedit.exe" (ParentImage="*\\TrustedInstaller.exe" OR ParentImage="*\\ProcessHacker.exe"))) | eval sigma_attack_tags="attack.privilege_escalation attack.t1548" | eval sigma_title="Regedit as Trusted Installer" | eval sigma_description="Detects a regedit started with TrustedInstaller privileges or by ProcessHacker.exe"
dispatch.earliest_time = -24h@h
alert.track = 0

[DLL Execution Via Register-cimprovider.exe - winevent]
description = Detects using register-cimprovider.exe to execute arbitrary dll file.
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\register-cimprovider.exe" Process_Command_Line="*-path*" Process_Command_Line="*dll*")) | table Process_Command_Line | eval sigma_attack_tags="attack.defense_evasion attack.t1574" | eval sigma_title="DLL Execution Via Register-cimprovider.exe" | eval sigma_description="Detects using register-cimprovider.exe to execute arbitrary dll file."
dispatch.earliest_time = -24h@h
alert.track = 0

[DLL Execution Via Register-cimprovider.exe - sysmon]
description = Detects using register-cimprovider.exe to execute arbitrary dll file.
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\register-cimprovider.exe" CommandLine="*-path*" CommandLine="*dll*")) | table CommandLine | eval sigma_attack_tags="attack.defense_evasion attack.t1574" | eval sigma_title="DLL Execution Via Register-cimprovider.exe" | eval sigma_description="Detects using register-cimprovider.exe to execute arbitrary dll file."
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Registration via cscript.exe - winevent]
description = Detects when the registration of a VSS/VDS Provider as a COM+ application.
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\cscript.exe" Process_Command_Line="*-register*" (Process_Command_Line="*\\Windows Kits\\10\\bin\\10.0.22000.0\\x64*" OR Process_Command_Line="*\\Windows Kits\\10\\bin\\10.0.19041.0\\x64*" OR Process_Command_Line="*\\Windows Kits\\10\\bin\\10.0.17763.0\\x64*"))) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.t1218" | eval sigma_title="Suspicious Registration via cscript.exe" | eval sigma_description="Detects when the registration of a VSS/VDS Provider as a COM+ application."
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Registration via cscript.exe - sysmon]
description = Detects when the registration of a VSS/VDS Provider as a COM+ application.
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\cscript.exe" CommandLine="*-register*" (CommandLine="*\\Windows Kits\\10\\bin\\10.0.22000.0\\x64*" OR CommandLine="*\\Windows Kits\\10\\bin\\10.0.19041.0\\x64*" OR CommandLine="*\\Windows Kits\\10\\bin\\10.0.17763.0\\x64*"))) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.t1218" | eval sigma_title="Suspicious Registration via cscript.exe" | eval sigma_description="Detects when the registration of a VSS/VDS Provider as a COM+ application."
dispatch.earliest_time = -24h@h
alert.track = 0

[Regsvr32 Anomaly - winevent]
description = Detects various anomalies in relation to regsvr32.exe
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((New_Process_Name="*\\regsvr32.exe" Process_Command_Line="*\\Temp\\*")) OR ((New_Process_Name="*\\regsvr32.exe" (Creator_Process_Name="*\\powershell.exe" OR Creator_Process_Name="*\\pwsh.exe" OR Creator_Process_Name="*\\powershell_ise.exe"))) OR ((New_Process_Name="*\\regsvr32.exe" Creator_Process_Name="*\\cmd.exe")) OR ((New_Process_Name="*\\regsvr32.exe" Process_Command_Line="*/i:*" Process_Command_Line="*http*" Process_Command_Line="*scrobj.dll")) OR ((New_Process_Name="*\\regsvr32.exe" Process_Command_Line="*/i:*" Process_Command_Line="*ftp*" Process_Command_Line="*scrobj.dll")) OR ((New_Process_Name="*\\wscript.exe" Creator_Process_Name="*\\regsvr32.exe")) OR ((New_Process_Name="*\\EXCEL.EXE" Process_Command_Line="*..\\..\\..\\Windows\\System32\\regsvr32.exe *")) OR ((Creator_Process_Name="*\\mshta.exe" New_Process_Name="*\\regsvr32.exe")) OR ((New_Process_Name="*\\regsvr32.exe" (Process_Command_Line="*\\AppData\\Local*" OR Process_Command_Line="*C:\\Users\\Public*"))) OR ((New_Process_Name="*\\regsvr32.exe" (Process_Command_Line="*.jpg" OR Process_Command_Line="*.jpeg" OR Process_Command_Line="*.png" OR Process_Command_Line="*.gif" OR Process_Command_Line="*.bin" OR Process_Command_Line="*.tmp" OR Process_Command_Line="*.temp" OR Process_Command_Line="*.txt")))) NOT ((((Process_Command_Line="*\\AppData\\Local\\Microsoft\\Teams*" OR Process_Command_Line="*\\AppData\\Local\\WebEx\\WebEx64\\Meetings\\atucfobj.dll*"))) OR ((Creator_Process_Name="C:\\Program Files\\Box\\Box\\FS\\streem.exe" Process_Command_Line="*\\Program Files\\Box\\Box\\Temp\\*")) OR ((Process_Command_Line="*/s C:\\Windows\\System32\\RpcProxy\\RpcProxy.dll"))))) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.t1218.010 car.2019-04-002 car.2019-04-003" | eval sigma_title="Regsvr32 Anomaly" | eval sigma_description="Detects various anomalies in relation to regsvr32.exe"
dispatch.earliest_time = -24h@h
alert.track = 0

[Regsvr32 Anomaly - sysmon]
description = Detects various anomalies in relation to regsvr32.exe
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((Image="*\\regsvr32.exe" CommandLine="*\\Temp\\*")) OR ((Image="*\\regsvr32.exe" (ParentImage="*\\powershell.exe" OR ParentImage="*\\pwsh.exe" OR ParentImage="*\\powershell_ise.exe"))) OR ((Image="*\\regsvr32.exe" ParentImage="*\\cmd.exe")) OR ((Image="*\\regsvr32.exe" CommandLine="*/i:*" CommandLine="*http*" CommandLine="*scrobj.dll")) OR ((Image="*\\regsvr32.exe" CommandLine="*/i:*" CommandLine="*ftp*" CommandLine="*scrobj.dll")) OR ((Image="*\\wscript.exe" ParentImage="*\\regsvr32.exe")) OR ((Image="*\\EXCEL.EXE" CommandLine="*..\\..\\..\\Windows\\System32\\regsvr32.exe *")) OR ((ParentImage="*\\mshta.exe" Image="*\\regsvr32.exe")) OR ((Image="*\\regsvr32.exe" (CommandLine="*\\AppData\\Local*" OR CommandLine="*C:\\Users\\Public*"))) OR ((Image="*\\regsvr32.exe" (CommandLine="*.jpg" OR CommandLine="*.jpeg" OR CommandLine="*.png" OR CommandLine="*.gif" OR CommandLine="*.bin" OR CommandLine="*.tmp" OR CommandLine="*.temp" OR CommandLine="*.txt")))) NOT ((((CommandLine="*\\AppData\\Local\\Microsoft\\Teams*" OR CommandLine="*\\AppData\\Local\\WebEx\\WebEx64\\Meetings\\atucfobj.dll*"))) OR ((ParentImage="C:\\Program Files\\Box\\Box\\FS\\streem.exe" CommandLine="*\\Program Files\\Box\\Box\\Temp\\*")) OR ((CommandLine="*/s C:\\Windows\\System32\\RpcProxy\\RpcProxy.dll"))))) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.t1218.010 car.2019-04-002 car.2019-04-003" | eval sigma_title="Regsvr32 Anomaly" | eval sigma_description="Detects various anomalies in relation to regsvr32.exe"
dispatch.earliest_time = -24h@h
alert.track = 0

[Regsvr32 Flags Anomaly - winevent]
description = Detects a flag anomaly in which regsvr32.exe uses a /i flag without using a /n flag at the same time
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\regsvr32.exe" Process_Command_Line="* /i:*")) NOT ((Process_Command_Line="* /n *")))) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.t1218.010" | eval sigma_title="Regsvr32 Flags Anomaly" | eval sigma_description="Detects a flag anomaly in which regsvr32.exe uses a /i flag without using a /n flag at the same time"
dispatch.earliest_time = -24h@h
alert.track = 0

[Regsvr32 Flags Anomaly - sysmon]
description = Detects a flag anomaly in which regsvr32.exe uses a /i flag without using a /n flag at the same time
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\regsvr32.exe" CommandLine="* /i:*")) NOT ((CommandLine="* /n *")))) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.t1218.010" | eval sigma_title="Regsvr32 Flags Anomaly" | eval sigma_description="Detects a flag anomaly in which regsvr32.exe uses a /i flag without using a /n flag at the same time"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Regsvr32 HTTP IP Pattern - winevent]
description = Detects a certain command line flag combination used by regsvr32 when used to download and register a DLL from a remote address which uses HTTP (not HTTPS) and a IP address and not FQDN
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="* /s*" Process_Command_Line="* /u*" (Process_Command_Line="* /i:http://1*" OR Process_Command_Line="* /i:http://2*" OR Process_Command_Line="* /i:http://3*" OR Process_Command_Line="* /i:http://4*" OR Process_Command_Line="* /i:http://5*" OR Process_Command_Line="* /i:http://6*" OR Process_Command_Line="* /i:http://7*" OR Process_Command_Line="* /i:http://8*" OR Process_Command_Line="* /i:http://9*" OR Process_Command_Line="* /i:https://1*" OR Process_Command_Line="* /i:https://2*" OR Process_Command_Line="* /i:https://3*" OR Process_Command_Line="* /i:https://4*" OR Process_Command_Line="* /i:https://5*" OR Process_Command_Line="* /i:https://6*" OR Process_Command_Line="* /i:https://7*" OR Process_Command_Line="* /i:https://8*" OR Process_Command_Line="* /i:https://9*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218.010" | eval sigma_title="Suspicious Regsvr32 HTTP IP Pattern" | eval sigma_description="Detects a certain command line flag combination used by regsvr32 when used to download and register a DLL from a remote address which uses HTTP (not HTTPS) and a IP address and not FQDN"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Regsvr32 HTTP IP Pattern - sysmon]
description = Detects a certain command line flag combination used by regsvr32 when used to download and register a DLL from a remote address which uses HTTP (not HTTPS) and a IP address and not FQDN
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="* /s*" CommandLine="* /u*" (CommandLine="* /i:http://1*" OR CommandLine="* /i:http://2*" OR CommandLine="* /i:http://3*" OR CommandLine="* /i:http://4*" OR CommandLine="* /i:http://5*" OR CommandLine="* /i:http://6*" OR CommandLine="* /i:http://7*" OR CommandLine="* /i:http://8*" OR CommandLine="* /i:http://9*" OR CommandLine="* /i:https://1*" OR CommandLine="* /i:https://2*" OR CommandLine="* /i:https://3*" OR CommandLine="* /i:https://4*" OR CommandLine="* /i:https://5*" OR CommandLine="* /i:https://6*" OR CommandLine="* /i:https://7*" OR CommandLine="* /i:https://8*" OR CommandLine="* /i:https://9*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218.010" | eval sigma_title="Suspicious Regsvr32 HTTP IP Pattern" | eval sigma_description="Detects a certain command line flag combination used by regsvr32 when used to download and register a DLL from a remote address which uses HTTP (not HTTPS) and a IP address and not FQDN"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Regsvr32 Execution With Image Extension - winevent]
description = Detects execution of REGSVR32.exe with DLL masquerading as image files
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\regsvr32.exe" OR OriginalFileName="\\REGSVR32.EXE") (Process_Command_Line="*.jpg" OR Process_Command_Line="*.jpeg" OR Process_Command_Line="*.gif" OR Process_Command_Line="*.png" OR Process_Command_Line="*.ico" OR Process_Command_Line="*.bmp" OR Process_Command_Line="*.tif" OR Process_Command_Line="*.tiff" OR Process_Command_Line="*.eps" OR Process_Command_Line="*.raw" OR Process_Command_Line="*.cr2" OR Process_Command_Line="*.nef" OR Process_Command_Line="*.orf" OR Process_Command_Line="*.sr2"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218.010" | eval sigma_title="Suspicious Regsvr32 Execution With Image Extension" | eval sigma_description="Detects execution of REGSVR32.exe with DLL masquerading as image files"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Regsvr32 Execution With Image Extension - sysmon]
description = Detects execution of REGSVR32.exe with DLL masquerading as image files
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\regsvr32.exe" OR OriginalFileName="\\REGSVR32.EXE") (CommandLine="*.jpg" OR CommandLine="*.jpeg" OR CommandLine="*.gif" OR CommandLine="*.png" OR CommandLine="*.ico" OR CommandLine="*.bmp" OR CommandLine="*.tif" OR CommandLine="*.tiff" OR CommandLine="*.eps" OR CommandLine="*.raw" OR CommandLine="*.cr2" OR CommandLine="*.nef" OR CommandLine="*.orf" OR CommandLine="*.sr2"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218.010" | eval sigma_title="Suspicious Regsvr32 Execution With Image Extension" | eval sigma_description="Detects execution of REGSVR32.exe with DLL masquerading as image files"
dispatch.earliest_time = -24h@h
alert.track = 0

[Regsvr32 Command Line Without DLL - winevent]
description = Detects a regsvr.exe execution that doesn't contain a DLL in the command line
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((((New_Process_Name="*\\regsvr32.exe" NOT (((Process_Command_Line="*.dll*" OR Process_Command_Line="*.ocx*" OR Process_Command_Line="*.cpl*" OR Process_Command_Line="*.ax*" OR Process_Command_Line="*.bav*" OR Process_Command_Line="*.ppl*"))))) NOT ((NOT Process_Command_Line="*")))) NOT ((Process_Command_Line="")))) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.t1574 attack.execution" | eval sigma_title="Regsvr32 Command Line Without DLL" | eval sigma_description="Detects a regsvr.exe execution that doesn't contain a DLL in the command line"
dispatch.earliest_time = -24h@h
alert.track = 0

[Regsvr32 Command Line Without DLL - sysmon]
description = Detects a regsvr.exe execution that doesn't contain a DLL in the command line
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((((Image="*\\regsvr32.exe" NOT (((CommandLine="*.dll*" OR CommandLine="*.ocx*" OR CommandLine="*.cpl*" OR CommandLine="*.ax*" OR CommandLine="*.bav*" OR CommandLine="*.ppl*"))))) NOT ((NOT CommandLine="*")))) NOT ((CommandLine="")))) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.t1574 attack.execution" | eval sigma_title="Regsvr32 Command Line Without DLL" | eval sigma_description="Detects a regsvr.exe execution that doesn't contain a DLL in the command line"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Regsvr32 Execution From Remote Share - winevent]
description = Detects REGSVR32.exe to execute DLL hosted on remote shares
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\regsvr32.exe" OR OriginalFileName="\\REGSVR32.EXE") Process_Command_Line="* \\\\\*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1218.010" | eval sigma_title="Suspicious Regsvr32 Execution From Remote Share" | eval sigma_description="Detects REGSVR32.exe to execute DLL hosted on remote shares"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Regsvr32 Execution From Remote Share - sysmon]
description = Detects REGSVR32.exe to execute DLL hosted on remote shares
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\regsvr32.exe" OR OriginalFileName="\\REGSVR32.EXE") CommandLine="* \\\\\*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1218.010" | eval sigma_title="Suspicious Regsvr32 Execution From Remote Share" | eval sigma_description="Detects REGSVR32.exe to execute DLL hosted on remote shares"
dispatch.earliest_time = -24h@h
alert.track = 0

[Regsvr32 Spawning Explorer - winevent]
description = Detects 'regsvr32.exe' spawning 'explorer.exe', which is very uncommon.
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Creator_Process_Name="*\\regsvr32.exe" New_Process_Name="*\\explorer.exe")) | eval sigma_attack_tags="attack.defense_evasion attack.t1218.010" | eval sigma_title="Regsvr32 Spawning Explorer" | eval sigma_description="Detects 'regsvr32.exe' spawning 'explorer.exe', which is very uncommon."
dispatch.earliest_time = -24h@h
alert.track = 0

[Regsvr32 Spawning Explorer - sysmon]
description = Detects 'regsvr32.exe' spawning 'explorer.exe', which is very uncommon.
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") ParentImage="*\\regsvr32.exe" Image="*\\explorer.exe")) | eval sigma_attack_tags="attack.defense_evasion attack.t1218.010" | eval sigma_title="Regsvr32 Spawning Explorer" | eval sigma_description="Detects 'regsvr32.exe' spawning 'explorer.exe', which is very uncommon."
dispatch.earliest_time = -24h@h
alert.track = 0

[Renamed AdFind Detection - winevent]
description = Detects the use of a renamed Adfind.exe. AdFind continues to be seen across majority of breaches. It is used to domain trust discovery to plan out subsequent steps in the attack chain.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((Process_Command_Line="*domainlist*" OR Process_Command_Line="*trustdmp*" OR Process_Command_Line="*dcmodes*" OR Process_Command_Line="*adinfo*" OR Process_Command_Line="* dclist *" OR Process_Command_Line="*computer_pwdnotreqd*" OR Process_Command_Line="*objectcategory=*" OR Process_Command_Line="*-subnets -f*" OR Process_Command_Line="*name=\"Domain Admins\"*" OR Process_Command_Line="*-sc u:*" OR Process_Command_Line="*domainncs*" OR Process_Command_Line="*dompol*" OR Process_Command_Line="* oudmp *" OR Process_Command_Line="*subnetdmp*" OR Process_Command_Line="*gpodmp*" OR Process_Command_Line="*fspdmp*" OR Process_Command_Line="*users_noexpire*" OR Process_Command_Line="*computers_active*" OR Process_Command_Line="*computers_pwdnotreqd*") OR (Imphash="bca5675746d13a1f246e2da3c2217492" OR Imphash="53e117a96057eaf19c41380d0e87f1c2") OR (Hashes="*IMPHASH=BCA5675746D13A1F246E2DA3C2217492*" OR Hashes="*IMPHASH=53E117A96057EAF19C41380D0E87F1C2*") OR OriginalFileName="AdFind.exe") NOT ((New_Process_Name="*\\AdFind.exe")))) | eval sigma_attack_tags="attack.discovery attack.t1018 attack.t1087.002 attack.t1482 attack.t1069.002" | eval sigma_title="Renamed AdFind Detection" | eval sigma_description="Detects the use of a renamed Adfind.exe. AdFind continues to be seen across majority of breaches. It is used to domain trust discovery to plan out subsequent steps in the attack chain."
dispatch.earliest_time = -24h@h
alert.track = 0

[Renamed AdFind Detection - sysmon]
description = Detects the use of a renamed Adfind.exe. AdFind continues to be seen across majority of breaches. It is used to domain trust discovery to plan out subsequent steps in the attack chain.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((CommandLine="*domainlist*" OR CommandLine="*trustdmp*" OR CommandLine="*dcmodes*" OR CommandLine="*adinfo*" OR CommandLine="* dclist *" OR CommandLine="*computer_pwdnotreqd*" OR CommandLine="*objectcategory=*" OR CommandLine="*-subnets -f*" OR CommandLine="*name=\"Domain Admins\"*" OR CommandLine="*-sc u:*" OR CommandLine="*domainncs*" OR CommandLine="*dompol*" OR CommandLine="* oudmp *" OR CommandLine="*subnetdmp*" OR CommandLine="*gpodmp*" OR CommandLine="*fspdmp*" OR CommandLine="*users_noexpire*" OR CommandLine="*computers_active*" OR CommandLine="*computers_pwdnotreqd*") OR (Imphash="bca5675746d13a1f246e2da3c2217492" OR Imphash="53e117a96057eaf19c41380d0e87f1c2") OR (Hashes="*IMPHASH=BCA5675746D13A1F246E2DA3C2217492*" OR Hashes="*IMPHASH=53E117A96057EAF19C41380D0E87F1C2*") OR OriginalFileName="AdFind.exe") NOT ((Image="*\\AdFind.exe")))) | eval sigma_attack_tags="attack.discovery attack.t1018 attack.t1087.002 attack.t1482 attack.t1069.002" | eval sigma_title="Renamed AdFind Detection" | eval sigma_description="Detects the use of a renamed Adfind.exe. AdFind continues to be seen across majority of breaches. It is used to domain trust discovery to plan out subsequent steps in the attack chain."
dispatch.earliest_time = -24h@h
alert.track = 0

[Renamed CreateDump Process Dump - winevent]
description = Detects uses of a renamed legitimate createdump.exe LOLOBIN utility to dump process memory
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (OriginalFileName="FX_VER_INTERNALNAME_STR" OR ((Process_Command_Line="* -u *" Process_Command_Line="* -f *" Process_Command_Line="*.dmp*"))) NOT ((New_Process_Name="*\\createdump.exe")))) | eval sigma_attack_tags="attack.defense_evasion attack.t1036 attack.t1003.001" | eval sigma_title="Renamed CreateDump Process Dump" | eval sigma_description="Detects uses of a renamed legitimate createdump.exe LOLOBIN utility to dump process memory"
dispatch.earliest_time = -24h@h
alert.track = 0

[Renamed CreateDump Process Dump - sysmon]
description = Detects uses of a renamed legitimate createdump.exe LOLOBIN utility to dump process memory
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (OriginalFileName="FX_VER_INTERNALNAME_STR" OR ((CommandLine="* -u *" CommandLine="* -f *" CommandLine="*.dmp*"))) NOT ((Image="*\\createdump.exe")))) | eval sigma_attack_tags="attack.defense_evasion attack.t1036 attack.t1003.001" | eval sigma_title="Renamed CreateDump Process Dump" | eval sigma_description="Detects uses of a renamed legitimate createdump.exe LOLOBIN utility to dump process memory"
dispatch.earliest_time = -24h@h
alert.track = 0

[Renamed ZOHO Dctask64 - winevent]
description = Detects a renamed dctask64.exe used for process injection, command execution, process creation with a signed binary by ZOHO Corporation
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) Hashes="*6834B1B94E49701D77CCB3C0895E1AFD*" NOT ((New_Process_Name="*\\dctask64.exe")))) | table Process_Command_Line,ParentCommandLine,Creator_Process_Name | eval sigma_attack_tags="attack.defense_evasion attack.t1036 attack.t1055.001 attack.t1202 attack.t1218" | eval sigma_title="Renamed ZOHO Dctask64" | eval sigma_description="Detects a renamed dctask64.exe used for process injection, command execution, process creation with a signed binary by ZOHO Corporation"
dispatch.earliest_time = -24h@h
alert.track = 0

[Renamed ZOHO Dctask64 - sysmon]
description = Detects a renamed dctask64.exe used for process injection, command execution, process creation with a signed binary by ZOHO Corporation
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) Hashes="*6834B1B94E49701D77CCB3C0895E1AFD*" NOT ((Image="*\\dctask64.exe")))) | table CommandLine,ParentCommandLine,ParentImage | eval sigma_attack_tags="attack.defense_evasion attack.t1036 attack.t1055.001 attack.t1202 attack.t1218" | eval sigma_title="Renamed ZOHO Dctask64" | eval sigma_description="Detects a renamed dctask64.exe used for process injection, command execution, process creation with a signed binary by ZOHO Corporation"
dispatch.earliest_time = -24h@h
alert.track = 0

[Renamed SysInternals Debug View - winevent]
description = Detects suspicious renamed SysInternals DebugView execution
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) Product="Sysinternals DebugView" NOT ((OriginalFileName="Dbgview.exe" New_Process_Name="*\\Dbgview.exe")))) | eval sigma_attack_tags="attack.resource_development attack.t1588.002" | eval sigma_title="Renamed SysInternals Debug View" | eval sigma_description="Detects suspicious renamed SysInternals DebugView execution"
dispatch.earliest_time = -24h@h
alert.track = 0

[Renamed SysInternals Debug View - sysmon]
description = Detects suspicious renamed SysInternals DebugView execution
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) Product="Sysinternals DebugView" NOT ((OriginalFileName="Dbgview.exe" Image="*\\Dbgview.exe")))) | eval sigma_attack_tags="attack.resource_development attack.t1588.002" | eval sigma_title="Renamed SysInternals Debug View" | eval sigma_description="Detects suspicious renamed SysInternals DebugView execution"
dispatch.earliest_time = -24h@h
alert.track = 0

[Renamed PAExec - winevent]
description = Detects execution of renamed version of PAExec. Often used by attackers
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (Description="PAExec Application" OR OriginalFileName="PAExec.exe") NOT ((New_Process_Name="*\\paexec.exe") OR (New_Process_Name="C:\\Windows\\PAExec-*")))) | eval sigma_attack_tags="attack.defense_evasion attack.t1202" | eval sigma_title="Renamed PAExec" | eval sigma_description="Detects execution of renamed version of PAExec. Often used by attackers"
dispatch.earliest_time = -24h@h
alert.track = 0

[Renamed PAExec - sysmon]
description = Detects execution of renamed version of PAExec. Often used by attackers
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Description="PAExec Application" OR OriginalFileName="PAExec.exe") NOT ((Image="*\\paexec.exe") OR (Image="C:\\Windows\\PAExec-*")))) | eval sigma_attack_tags="attack.defense_evasion attack.t1202" | eval sigma_title="Renamed PAExec" | eval sigma_description="Detects execution of renamed version of PAExec. Often used by attackers"
dispatch.earliest_time = -24h@h
alert.track = 0

[Capture Credentials with Rpcping.exe - winevent]
description = Detects using Rpcping.exe to send a RPC test connection to the target server (-s) and force the NTLM hash to be sent in the process.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\rpcping.exe" (Process_Command_Line="*-s*" OR Process_Command_Line="*/s*"))) (((Process_Command_Line="*-u*" Process_Command_Line="*NTLM*")) OR ((Process_Command_Line="*/u*" Process_Command_Line="*NTLM*")) OR ((Process_Command_Line="*-t*" Process_Command_Line="*ncacn_np*")) OR ((Process_Command_Line="*/t*" Process_Command_Line="*ncacn_np*"))))) | eval sigma_attack_tags="attack.credential_access attack.t1003" | eval sigma_title="Capture Credentials with Rpcping.exe" | eval sigma_description="Detects using Rpcping.exe to send a RPC test connection to the target server (-s) and force the NTLM hash to be sent in the process."
dispatch.earliest_time = -24h@h
alert.track = 0

[Capture Credentials with Rpcping.exe - sysmon]
description = Detects using Rpcping.exe to send a RPC test connection to the target server (-s) and force the NTLM hash to be sent in the process.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\rpcping.exe" (CommandLine="*-s*" OR CommandLine="*/s*"))) (((CommandLine="*-u*" CommandLine="*NTLM*")) OR ((CommandLine="*/u*" CommandLine="*NTLM*")) OR ((CommandLine="*-t*" CommandLine="*ncacn_np*")) OR ((CommandLine="*/t*" CommandLine="*ncacn_np*"))))) | eval sigma_attack_tags="attack.credential_access attack.t1003" | eval sigma_title="Capture Credentials with Rpcping.exe" | eval sigma_description="Detects using Rpcping.exe to send a RPC test connection to the target server (-s) and force the NTLM hash to be sent in the process."
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Process Start Locations - winevent]
description = Detects suspicious process run from unusual locations
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*:\\RECYCLER\\*" OR New_Process_Name="*:\\SystemVolumeInformation\\*") OR (New_Process_Name="C:\\Windows\\Tasks\\*" OR New_Process_Name="C:\\Windows\\debug\\*" OR New_Process_Name="C:\\Windows\\fonts\\*" OR New_Process_Name="C:\\Windows\\help\\*" OR New_Process_Name="C:\\Windows\\drivers\\*" OR New_Process_Name="C:\\Windows\\addins\\*" OR New_Process_Name="C:\\Windows\\cursors\\*" OR New_Process_Name="C:\\Windows\\system32\\tasks\\*")))) | eval sigma_attack_tags="attack.defense_evasion attack.t1036 car.2013-05-002" | eval sigma_title="Suspicious Process Start Locations" | eval sigma_description="Detects suspicious process run from unusual locations"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Process Start Locations - sysmon]
description = Detects suspicious process run from unusual locations
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*:\\RECYCLER\\*" OR Image="*:\\SystemVolumeInformation\\*") OR (Image="C:\\Windows\\Tasks\\*" OR Image="C:\\Windows\\debug\\*" OR Image="C:\\Windows\\fonts\\*" OR Image="C:\\Windows\\help\\*" OR Image="C:\\Windows\\drivers\\*" OR Image="C:\\Windows\\addins\\*" OR Image="C:\\Windows\\cursors\\*" OR Image="C:\\Windows\\system32\\tasks\\*")))) | eval sigma_attack_tags="attack.defense_evasion attack.t1036 car.2013-05-002" | eval sigma_title="Suspicious Process Start Locations" | eval sigma_description="Detects suspicious process run from unusual locations"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Rundll32 Activity - winevent]
description = Detects suspicious process related to rundll32 based on arguments
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((Process_Command_Line="*javascript:*" Process_Command_Line="*.RegisterXLL*")) OR ((Process_Command_Line="*url.dll*" Process_Command_Line="*OpenURL*")) OR ((Process_Command_Line="*url.dll*" Process_Command_Line="*OpenURLA*")) OR ((Process_Command_Line="*url.dll*" Process_Command_Line="*FileProtocolHandler*")) OR ((Process_Command_Line="*zipfldr.dll*" Process_Command_Line="*RouteTheCall*")) OR ((Process_Command_Line="*shell32.dll*" Process_Command_Line="*Control_RunDLL*")) OR ((Process_Command_Line="*shell32.dll*" Process_Command_Line="*ShellExec_RunDLL*")) OR ((Process_Command_Line="*mshtml.dll*" Process_Command_Line="*PrintHTML*")) OR ((Process_Command_Line="*advpack.dll*" Process_Command_Line="*LaunchINFSection*")) OR ((Process_Command_Line="*advpack.dll*" Process_Command_Line="*RegisterOCX*")) OR ((Process_Command_Line="*ieadvpack.dll*" Process_Command_Line="*LaunchINFSection*")) OR ((Process_Command_Line="*ieadvpack.dll*" Process_Command_Line="*RegisterOCX*")) OR ((Process_Command_Line="*ieframe.dll*" Process_Command_Line="*OpenURL*")) OR ((Process_Command_Line="*shdocvw.dll*" Process_Command_Line="*OpenURL*")) OR ((Process_Command_Line="*syssetup.dll*" Process_Command_Line="*SetupInfObjectInstallAction*")) OR ((Process_Command_Line="*setupapi.dll*" Process_Command_Line="*InstallHinfSection*")) OR ((Process_Command_Line="*pcwutl.dll*" Process_Command_Line="*LaunchApplication*")) OR ((Process_Command_Line="*dfshim.dll*" Process_Command_Line="*ShOpenVerbApplication*")) OR ((Process_Command_Line="*dfshim.dll*" Process_Command_Line="*ShOpenVerbShortcut*")) OR ((Process_Command_Line="*scrobj.dll*" Process_Command_Line="*GenerateTypeLib*" Process_Command_Line="*http*")) OR ((Process_Command_Line="*shimgvw.dll*" Process_Command_Line="*ImageView_Fullscreen*" Process_Command_Line="*http*"))) NOT (((Process_Command_Line="*shell32.dll,Control_RunDLL desk.cpl,screensaver,@screensaver*")) OR ((Creator_Process_Name="C:\\Windows\\System32\\control.exe" ParentCommandLine="*.cpl*")) OR ((Creator_Process_Name="C:\\Windows\\System32\\control.exe" Process_Command_Line="\"C:\\Windows\\system32\\rundll32.exe\" Shell32.dll,Control_RunDLL \"C:\\Windows\\System32\\*" Process_Command_Line="*.cpl\","))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218.011" | eval sigma_title="Suspicious Rundll32 Activity" | eval sigma_description="Detects suspicious process related to rundll32 based on arguments"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Rundll32 Activity - sysmon]
description = Detects suspicious process related to rundll32 based on arguments
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((CommandLine="*javascript:*" CommandLine="*.RegisterXLL*")) OR ((CommandLine="*url.dll*" CommandLine="*OpenURL*")) OR ((CommandLine="*url.dll*" CommandLine="*OpenURLA*")) OR ((CommandLine="*url.dll*" CommandLine="*FileProtocolHandler*")) OR ((CommandLine="*zipfldr.dll*" CommandLine="*RouteTheCall*")) OR ((CommandLine="*shell32.dll*" CommandLine="*Control_RunDLL*")) OR ((CommandLine="*shell32.dll*" CommandLine="*ShellExec_RunDLL*")) OR ((CommandLine="*mshtml.dll*" CommandLine="*PrintHTML*")) OR ((CommandLine="*advpack.dll*" CommandLine="*LaunchINFSection*")) OR ((CommandLine="*advpack.dll*" CommandLine="*RegisterOCX*")) OR ((CommandLine="*ieadvpack.dll*" CommandLine="*LaunchINFSection*")) OR ((CommandLine="*ieadvpack.dll*" CommandLine="*RegisterOCX*")) OR ((CommandLine="*ieframe.dll*" CommandLine="*OpenURL*")) OR ((CommandLine="*shdocvw.dll*" CommandLine="*OpenURL*")) OR ((CommandLine="*syssetup.dll*" CommandLine="*SetupInfObjectInstallAction*")) OR ((CommandLine="*setupapi.dll*" CommandLine="*InstallHinfSection*")) OR ((CommandLine="*pcwutl.dll*" CommandLine="*LaunchApplication*")) OR ((CommandLine="*dfshim.dll*" CommandLine="*ShOpenVerbApplication*")) OR ((CommandLine="*dfshim.dll*" CommandLine="*ShOpenVerbShortcut*")) OR ((CommandLine="*scrobj.dll*" CommandLine="*GenerateTypeLib*" CommandLine="*http*")) OR ((CommandLine="*shimgvw.dll*" CommandLine="*ImageView_Fullscreen*" CommandLine="*http*"))) NOT (((CommandLine="*shell32.dll,Control_RunDLL desk.cpl,screensaver,@screensaver*")) OR ((ParentImage="C:\\Windows\\System32\\control.exe" ParentCommandLine="*.cpl*")) OR ((ParentImage="C:\\Windows\\System32\\control.exe" CommandLine="\"C:\\Windows\\system32\\rundll32.exe\" Shell32.dll,Control_RunDLL \"C:\\Windows\\System32\\*" CommandLine="*.cpl\","))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218.011" | eval sigma_title="Suspicious Rundll32 Activity" | eval sigma_description="Detects suspicious process related to rundll32 based on arguments"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Call by Ordinal - winevent]
description = Detects suspicious calls of DLLs in rundll32.dll exports by ordinal
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\rundll32.exe" (Process_Command_Line="*,#*" OR Process_Command_Line="*, #*" OR Process_Command_Line="*.dll #*" OR Process_Command_Line="*.ocx #*"))) NOT ((((Process_Command_Line="*EDGEHTML.dll*" Process_Command_Line="*#141*"))) OR (((Creator_Process_Name="*\\Msbuild\\Current\\Bin\\*" OR Creator_Process_Name="*\\VC\\Tools\\MSVC\\*" OR Creator_Process_Name="*\\Tracker.exe*") (Process_Command_Line="*\\FileTracker32.dll,#1*" OR Process_Command_Line="*\\FileTracker32.dll\",#1*" OR Process_Command_Line="*\\FileTracker64.dll,#1*" OR Process_Command_Line="*\\FileTracker64.dll\",#1*")))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218.011" | eval sigma_title="Suspicious Call by Ordinal" | eval sigma_description="Detects suspicious calls of DLLs in rundll32.dll exports by ordinal"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Call by Ordinal - sysmon]
description = Detects suspicious calls of DLLs in rundll32.dll exports by ordinal
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\rundll32.exe" (CommandLine="*,#*" OR CommandLine="*, #*" OR CommandLine="*.dll #*" OR CommandLine="*.ocx #*"))) NOT ((((CommandLine="*EDGEHTML.dll*" CommandLine="*#141*"))) OR (((ParentImage="*\\Msbuild\\Current\\Bin\\*" OR ParentImage="*\\VC\\Tools\\MSVC\\*" OR ParentImage="*\\Tracker.exe*") (CommandLine="*\\FileTracker32.dll,#1*" OR CommandLine="*\\FileTracker32.dll\",#1*" OR CommandLine="*\\FileTracker64.dll,#1*" OR CommandLine="*\\FileTracker64.dll\",#1*")))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218.011" | eval sigma_title="Suspicious Call by Ordinal" | eval sigma_description="Detects suspicious calls of DLLs in rundll32.dll exports by ordinal"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Rundll32 Invoking Inline VBScript - winevent]
description = Detects suspicious process related to rundll32 based on command line that invokes inline VBScript as seen being used by UNC2452
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*rundll32.exe*" Process_Command_Line="*Execute*" Process_Command_Line="*RegRead*" Process_Command_Line="*window.close*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1055" | eval sigma_title="Suspicious Rundll32 Invoking Inline VBScript" | eval sigma_description="Detects suspicious process related to rundll32 based on command line that invokes inline VBScript as seen being used by UNC2452"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Rundll32 Invoking Inline VBScript - sysmon]
description = Detects suspicious process related to rundll32 based on command line that invokes inline VBScript as seen being used by UNC2452
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*rundll32.exe*" CommandLine="*Execute*" CommandLine="*RegRead*" CommandLine="*window.close*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1055" | eval sigma_title="Suspicious Rundll32 Invoking Inline VBScript" | eval sigma_description="Detects suspicious process related to rundll32 based on command line that invokes inline VBScript as seen being used by UNC2452"
dispatch.earliest_time = -24h@h
alert.track = 0

[Rundll32 JS RunHTMLApplication Pattern - winevent]
description = Detects suspicious command line patterns used when rundll32 is used to run JavaScript code
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((Process_Command_Line="*rundll32*" Process_Command_Line="*javascript*" Process_Command_Line="*..\\..\\mshtml,RunHTMLApplication*")) OR Process_Command_Line="*;document.write();GetObject(\"script*"))) | eval sigma_attack_tags="attack.defense_evasion" | eval sigma_title="Rundll32 JS RunHTMLApplication Pattern" | eval sigma_description="Detects suspicious command line patterns used when rundll32 is used to run JavaScript code"
dispatch.earliest_time = -24h@h
alert.track = 0

[Rundll32 JS RunHTMLApplication Pattern - sysmon]
description = Detects suspicious command line patterns used when rundll32 is used to run JavaScript code
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((CommandLine="*rundll32*" CommandLine="*javascript*" CommandLine="*..\\..\\mshtml,RunHTMLApplication*")) OR CommandLine="*;document.write();GetObject(\"script*"))) | eval sigma_attack_tags="attack.defense_evasion" | eval sigma_title="Rundll32 JS RunHTMLApplication Pattern" | eval sigma_description="Detects suspicious command line patterns used when rundll32 is used to run JavaScript code"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Key Manager Access - winevent]
description = Detects the invocation of the Stored User Names and Passwords dialogue (Key Manager)
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\rundll32.exe" Process_Command_Line="*keymgr*" Process_Command_Line="*KRShowKeyMgr*")) | eval sigma_attack_tags="attack.credential_access attack.t1555.004" | eval sigma_title="Suspicious Key Manager Access" | eval sigma_description="Detects the invocation of the Stored User Names and Passwords dialogue (Key Manager)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Key Manager Access - sysmon]
description = Detects the invocation of the Stored User Names and Passwords dialogue (Key Manager)
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\rundll32.exe" CommandLine="*keymgr*" CommandLine="*KRShowKeyMgr*")) | eval sigma_attack_tags="attack.credential_access attack.t1555.004" | eval sigma_title="Suspicious Key Manager Access" | eval sigma_description="Detects the invocation of the Stored User Names and Passwords dialogue (Key Manager)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Rundll32 Without Any CommandLine Params - winevent]
description = Detects suspicious start of rundll32.exe without any parameters as found in CobaltStrike beacon activity
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) Process_Command_Line="*\\rundll32.exe" NOT (((Creator_Process_Name="*\\svchost.exe")) OR (((Creator_Process_Name="*\\AppData\\Local\\*" OR Creator_Process_Name="*\\Microsoft\\Edge\\*")))))) | table Creator_Process_Name,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.t1202" | eval sigma_title="Suspicious Rundll32 Without Any CommandLine Params" | eval sigma_description="Detects suspicious start of rundll32.exe without any parameters as found in CobaltStrike beacon activity"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Rundll32 Without Any CommandLine Params - sysmon]
description = Detects suspicious start of rundll32.exe without any parameters as found in CobaltStrike beacon activity
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) CommandLine="*\\rundll32.exe" NOT (((ParentImage="*\\svchost.exe")) OR (((ParentImage="*\\AppData\\Local\\*" OR ParentImage="*\\Microsoft\\Edge\\*")))))) | table ParentImage,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.t1202" | eval sigma_title="Suspicious Rundll32 Without Any CommandLine Params" | eval sigma_description="Detects suspicious start of rundll32.exe without any parameters as found in CobaltStrike beacon activity"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Rundll32 Script in CommandLine - winevent]
description = Detects suspicious process related to rundll32 based on arguments
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*rundll32*" Process_Command_Line="*mshtml,RunHTMLApplication*" (Process_Command_Line="*javascript:*" OR Process_Command_Line="*vbscript:*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218.011" | eval sigma_title="Suspicious Rundll32 Script in CommandLine" | eval sigma_description="Detects suspicious process related to rundll32 based on arguments"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Rundll32 Script in CommandLine - sysmon]
description = Detects suspicious process related to rundll32 based on arguments
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*rundll32*" CommandLine="*mshtml,RunHTMLApplication*" (CommandLine="*javascript:*" OR CommandLine="*vbscript:*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218.011" | eval sigma_title="Suspicious Rundll32 Script in CommandLine" | eval sigma_description="Detects suspicious process related to rundll32 based on arguments"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Rundll32 Setupapi.dll Activity - winevent]
description = setupapi.dll library provide InstallHinfSection function for processing INF files. INF file may contain instructions allowing to create values in the registry, modify files and install drivers. This technique could be used to obtain persistence via modifying one of Run or RunOnce registry keys, run process or use other DLLs chain calls (see references) InstallHinfSection function in setupapi.dll calls runonce.exe executable regardless of actual content of INF file.
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\runonce.exe" Creator_Process_Name="*\\rundll32.exe" ParentCommandLine="*setupapi.dll*" ParentCommandLine="*InstallHinfSection*")) | table ComputerName,Account_Name,Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.t1218.011" | eval sigma_title="Suspicious Rundll32 Setupapi.dll Activity" | eval sigma_description="setupapi.dll library provide InstallHinfSection function for processing INF files. INF file may contain instructions allowing to create values in the registry, modify files and install drivers. This technique could be used to obtain persistence via modifying one of Run or RunOnce registry keys, run process or use other DLLs chain calls (see references) InstallHinfSection function in setupapi.dll calls runonce.exe executable regardless of actual content of INF file."
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Rundll32 Setupapi.dll Activity - sysmon]
description = setupapi.dll library provide InstallHinfSection function for processing INF files. INF file may contain instructions allowing to create values in the registry, modify files and install drivers. This technique could be used to obtain persistence via modifying one of Run or RunOnce registry keys, run process or use other DLLs chain calls (see references) InstallHinfSection function in setupapi.dll calls runonce.exe executable regardless of actual content of INF file.
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\runonce.exe" ParentImage="*\\rundll32.exe" ParentCommandLine="*setupapi.dll*" ParentCommandLine="*InstallHinfSection*")) | table ComputerName,User,CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.t1218.011" | eval sigma_title="Suspicious Rundll32 Setupapi.dll Activity" | eval sigma_description="setupapi.dll library provide InstallHinfSection function for processing INF files. INF file may contain instructions allowing to create values in the registry, modify files and install drivers. This technique could be used to obtain persistence via modifying one of Run or RunOnce registry keys, run process or use other DLLs chain calls (see references) InstallHinfSection function in setupapi.dll calls runonce.exe executable regardless of actual content of INF file."
dispatch.earliest_time = -24h@h
alert.track = 0

[RunDLL32 Spawning Explorer - winevent]
description = Detects RunDLL32.exe spawning explorer.exe as child, which is very uncommon, often observes Gamarue spawning the explorer.exe process in an unusual way
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((Creator_Process_Name="*\\rundll32.exe" New_Process_Name="*\\explorer.exe")) NOT ((ParentCommandLine="*\\shell32.dll,Control_RunDLL*")))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218.011" | eval sigma_title="RunDLL32 Spawning Explorer" | eval sigma_description="Detects RunDLL32.exe spawning explorer.exe as child, which is very uncommon, often observes Gamarue spawning the explorer.exe process in an unusual way"
dispatch.earliest_time = -24h@h
alert.track = 0

[RunDLL32 Spawning Explorer - sysmon]
description = Detects RunDLL32.exe spawning explorer.exe as child, which is very uncommon, often observes Gamarue spawning the explorer.exe process in an unusual way
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((ParentImage="*\\rundll32.exe" Image="*\\explorer.exe")) NOT ((ParentCommandLine="*\\shell32.dll,Control_RunDLL*")))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218.011" | eval sigma_title="RunDLL32 Spawning Explorer" | eval sigma_description="Detects RunDLL32.exe spawning explorer.exe as child, which is very uncommon, often observes Gamarue spawning the explorer.exe process in an unusual way"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Rundll32 Activity Invoking Sys File - winevent]
description = Detects suspicious process related to rundll32 based on command line that includes a *.sys file as seen being used by UNC2452
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*rundll32.exe*" (Process_Command_Line="*.sys,*" OR Process_Command_Line="*.sys *"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218.011" | eval sigma_title="Suspicious Rundll32 Activity Invoking Sys File" | eval sigma_description="Detects suspicious process related to rundll32 based on command line that includes a *.sys file as seen being used by UNC2452"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Rundll32 Activity Invoking Sys File - sysmon]
description = Detects suspicious process related to rundll32 based on command line that includes a *.sys file as seen being used by UNC2452
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*rundll32.exe*" (CommandLine="*.sys,*" OR CommandLine="*.sys *"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218.011" | eval sigma_title="Suspicious Rundll32 Activity Invoking Sys File" | eval sigma_description="Detects suspicious process related to rundll32 based on command line that includes a *.sys file as seen being used by UNC2452"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Workstation Locking via Rundll32 - winevent]
description = Detects a suspicious call to the user32.dll function that locks the user workstation
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\rundll32.exe" Creator_Process_Name="*\\cmd.exe" Process_Command_Line="*user32.dll,*" Process_Command_Line="*LockWorkStation*")) | table New_Process_Name,Creator_Process_Name | eval sigma_attack_tags="attack.defense_evasion" | eval sigma_title="Suspicious Workstation Locking via Rundll32" | eval sigma_description="Detects a suspicious call to the user32.dll function that locks the user workstation"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Workstation Locking via Rundll32 - sysmon]
description = Detects a suspicious call to the user32.dll function that locks the user workstation
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\rundll32.exe" ParentImage="*\\cmd.exe" CommandLine="*user32.dll,*" CommandLine="*LockWorkStation*")) | table Image,ParentImage | eval sigma_attack_tags="attack.defense_evasion" | eval sigma_title="Suspicious Workstation Locking via Rundll32" | eval sigma_description="Detects a suspicious call to the user32.dll function that locks the user workstation"
dispatch.earliest_time = -24h@h
alert.track = 0

[Run Once Task Execution as Configured in Registry - winevent]
description = This rule detects the execution of Run Once task as configured in the registry
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\runonce.exe" OR Description="Run Once Wrapper") (Process_Command_Line="*/AlternateShellStartup*" OR Process_Command_Line="*/r"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1112" | eval sigma_title="Run Once Task Execution as Configured in Registry" | eval sigma_description="This rule detects the execution of Run Once task as configured in the registry"
dispatch.earliest_time = -24h@h
alert.track = 0

[Run Once Task Execution as Configured in Registry - sysmon]
description = This rule detects the execution of Run Once task as configured in the registry
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\runonce.exe" OR Description="Run Once Wrapper") (CommandLine="*/AlternateShellStartup*" OR CommandLine="*/r"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1112" | eval sigma_title="Run Once Task Execution as Configured in Registry" | eval sigma_description="This rule detects the execution of Run Once task as configured in the registry"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Runscripthelper.exe - winevent]
description = Detects execution of powershell scripts via Runscripthelper.exe
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\Runscripthelper.exe" Process_Command_Line="*surfacecheck*")) | table Process_Command_Line | eval sigma_attack_tags="attack.execution attack.t1059 attack.defense_evasion attack.t1202" | eval sigma_title="Suspicious Runscripthelper.exe" | eval sigma_description="Detects execution of powershell scripts via Runscripthelper.exe"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Runscripthelper.exe - sysmon]
description = Detects execution of powershell scripts via Runscripthelper.exe
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\Runscripthelper.exe" CommandLine="*surfacecheck*")) | table CommandLine | eval sigma_attack_tags="attack.execution attack.t1059 attack.defense_evasion attack.t1202" | eval sigma_title="Suspicious Runscripthelper.exe" | eval sigma_description="Detects execution of powershell scripts via Runscripthelper.exe"
dispatch.earliest_time = -24h@h
alert.track = 0

[Execution of Remote Utilities RAT (RURAT) From Unusual Location - winevent]
description = Detects execution of Remote Utilities RAT (RURAT) from an unsual location (outisde of 'C:\Program Files')
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\rutserv.exe" OR New_Process_Name="*\\rfusclient.exe") OR Product="Remote Utilities") NOT (((New_Process_Name="C:\\Program Files\\Remote Utilities*" OR New_Process_Name="C:\\Program Files (x86)\\Remote Utilities*"))))) | eval sigma_attack_tags="attack.defense_evasion" | eval sigma_title="Execution of Remote Utilities RAT (RURAT) From Unusual Location" | eval sigma_description="Detects execution of Remote Utilities RAT (RURAT) from an unsual location (outisde of 'C:\Program Files')"
dispatch.earliest_time = -24h@h
alert.track = 0

[Execution of Remote Utilities RAT (RURAT) From Unusual Location - sysmon]
description = Detects execution of Remote Utilities RAT (RURAT) from an unsual location (outisde of 'C:\Program Files')
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\rutserv.exe" OR Image="*\\rfusclient.exe") OR Product="Remote Utilities") NOT (((Image="C:\\Program Files\\Remote Utilities*" OR Image="C:\\Program Files (x86)\\Remote Utilities*"))))) | eval sigma_attack_tags="attack.defense_evasion" | eval sigma_title="Execution of Remote Utilities RAT (RURAT) From Unusual Location" | eval sigma_description="Detects execution of Remote Utilities RAT (RURAT) from an unsual location (outisde of 'C:\Program Files')"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Scheduled Task Creation Involving Temp Folder - winevent]
description = Detects the creation of scheduled tasks that involves a temporary folder and runs only once
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\schtasks.exe" Process_Command_Line="* /create *" Process_Command_Line="* /sc once *" Process_Command_Line="*\\Temp\\*")) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.execution attack.persistence attack.t1053.005" | eval sigma_title="Suspicious Scheduled Task Creation Involving Temp Folder" | eval sigma_description="Detects the creation of scheduled tasks that involves a temporary folder and runs only once"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Scheduled Task Creation Involving Temp Folder - sysmon]
description = Detects the creation of scheduled tasks that involves a temporary folder and runs only once
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\schtasks.exe" CommandLine="* /create *" CommandLine="* /sc once *" CommandLine="*\\Temp\\*")) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.execution attack.persistence attack.t1053.005" | eval sigma_title="Suspicious Scheduled Task Creation Involving Temp Folder" | eval sigma_description="Detects the creation of scheduled tasks that involves a temporary folder and runs only once"
dispatch.earliest_time = -24h@h
alert.track = 0

[Scheduled Task Creation - winevent]
description = Detects the creation of scheduled tasks in user session
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\schtasks.exe" Process_Command_Line="* /create *")) NOT (((Account_Name="*AUTHORI*" OR Account_Name="*AUTORI*"))))) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.execution attack.persistence attack.privilege_escalation attack.t1053.005 attack.s0111 car.2013-08-001" | eval sigma_title="Scheduled Task Creation" | eval sigma_description="Detects the creation of scheduled tasks in user session"
dispatch.earliest_time = -24h@h
alert.track = 0

[Scheduled Task Creation - sysmon]
description = Detects the creation of scheduled tasks in user session
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\schtasks.exe" CommandLine="* /create *")) NOT (((User="*AUTHORI*" OR User="*AUTORI*"))))) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.execution attack.persistence attack.privilege_escalation attack.t1053.005 attack.s0111 car.2013-08-001" | eval sigma_title="Scheduled Task Creation" | eval sigma_description="Detects the creation of scheduled tasks in user session"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Modification Of Scheduled Tasks - winevent]
description = Detects when an attacker tries to modify an already existing scheduled tasks to run from a suspicious location
Attackers can create a simple looking task in order to avoid detection on creation as it's often the most focused on
Instead they modify the task after creation to include their malicious payload

search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\schtasks.exe" Process_Command_Line="* /Change *" Process_Command_Line="* /TN *" (Process_Command_Line="*\\AppData\\Local\\Temp*" OR Process_Command_Line="*\\AppData\\Roaming\\*" OR Process_Command_Line="*\\Users\\Public\\*" OR Process_Command_Line="*\\WINDOWS\\Temp\\*" OR Process_Command_Line="*\\Desktop\\*" OR Process_Command_Line="*\\Downloads\\*" OR Process_Command_Line="*\\Temporary Internet*" OR Process_Command_Line="*C:\\ProgramData\\*" OR Process_Command_Line="*C:\\Perflogs\\*" OR Process_Command_Line="*%ProgramData%*" OR Process_Command_Line="*%appdata%*" OR Process_Command_Line="*%comspec%*" OR Process_Command_Line="*%localappdata%*") (Process_Command_Line="*regsvr32*" OR Process_Command_Line="*rundll32*" OR Process_Command_Line="*cmd /c *" OR Process_Command_Line="*cmd /k *" OR Process_Command_Line="*cmd /r *" OR Process_Command_Line="*cmd.exe /c *" OR Process_Command_Line="*cmd.exe /k *" OR Process_Command_Line="*cmd.exe /r *" OR Process_Command_Line="*powershell*" OR Process_Command_Line="*mshta*" OR Process_Command_Line="*wscript*" OR Process_Command_Line="*cscript*" OR Process_Command_Line="*certutil*" OR Process_Command_Line="*bitsadmin*" OR Process_Command_Line="*bash.exe*" OR Process_Command_Line="*bash *" OR Process_Command_Line="*scrcons*" OR Process_Command_Line="*wmic *" OR Process_Command_Line="*wmic.exe*" OR Process_Command_Line="*forfiles*" OR Process_Command_Line="*scriptrunner*" OR Process_Command_Line="*hh.exe*" OR Process_Command_Line="*hh *"))) | eval sigma_attack_tags="attack.execution attack.t1053.005" | eval sigma_title="Suspicious Modification Of Scheduled Tasks" | eval sigma_description="Detects when an attacker tries to modify an already existing scheduled tasks to run from a suspicious location
Attackers can create a simple looking task in order to avoid detection on creation as it's often the most focused on
Instead they modify the task after creation to include their malicious payload
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Modification Of Scheduled Tasks - sysmon]
description = Detects when an attacker tries to modify an already existing scheduled tasks to run from a suspicious location
Attackers can create a simple looking task in order to avoid detection on creation as it's often the most focused on
Instead they modify the task after creation to include their malicious payload

search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\schtasks.exe" CommandLine="* /Change *" CommandLine="* /TN *" (CommandLine="*\\AppData\\Local\\Temp*" OR CommandLine="*\\AppData\\Roaming\\*" OR CommandLine="*\\Users\\Public\\*" OR CommandLine="*\\WINDOWS\\Temp\\*" OR CommandLine="*\\Desktop\\*" OR CommandLine="*\\Downloads\\*" OR CommandLine="*\\Temporary Internet*" OR CommandLine="*C:\\ProgramData\\*" OR CommandLine="*C:\\Perflogs\\*" OR CommandLine="*%ProgramData%*" OR CommandLine="*%appdata%*" OR CommandLine="*%comspec%*" OR CommandLine="*%localappdata%*") (CommandLine="*regsvr32*" OR CommandLine="*rundll32*" OR CommandLine="*cmd /c *" OR CommandLine="*cmd /k *" OR CommandLine="*cmd /r *" OR CommandLine="*cmd.exe /c *" OR CommandLine="*cmd.exe /k *" OR CommandLine="*cmd.exe /r *" OR CommandLine="*powershell*" OR CommandLine="*mshta*" OR CommandLine="*wscript*" OR CommandLine="*cscript*" OR CommandLine="*certutil*" OR CommandLine="*bitsadmin*" OR CommandLine="*bash.exe*" OR CommandLine="*bash *" OR CommandLine="*scrcons*" OR CommandLine="*wmic *" OR CommandLine="*wmic.exe*" OR CommandLine="*forfiles*" OR CommandLine="*scriptrunner*" OR CommandLine="*hh.exe*" OR CommandLine="*hh *"))) | eval sigma_attack_tags="attack.execution attack.t1053.005" | eval sigma_title="Suspicious Modification Of Scheduled Tasks" | eval sigma_description="Detects when an attacker tries to modify an already existing scheduled tasks to run from a suspicious location
Attackers can create a simple looking task in order to avoid detection on creation as it's often the most focused on
Instead they modify the task after creation to include their malicious payload
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Delete All Scheduled Tasks - winevent]
description = Detects the usage of schtasks with the delete flag and the asterisk symbole to delete all tasks from the schedule of the local computer, including tasks scheduled by other users.
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\schtasks.exe" Process_Command_Line="* /delete *" Process_Command_Line="*/tn \*" Process_Command_Line="* /f*")) | eval sigma_attack_tags="attack.impact attack.t1489" | eval sigma_title="Delete All Scheduled Tasks" | eval sigma_description="Detects the usage of schtasks with the delete flag and the asterisk symbole to delete all tasks from the schedule of the local computer, including tasks scheduled by other users."
dispatch.earliest_time = -24h@h
alert.track = 0

[Delete All Scheduled Tasks - sysmon]
description = Detects the usage of schtasks with the delete flag and the asterisk symbole to delete all tasks from the schedule of the local computer, including tasks scheduled by other users.
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\schtasks.exe" CommandLine="* /delete *" CommandLine="*/tn \*" CommandLine="* /f*")) | eval sigma_attack_tags="attack.impact attack.t1489" | eval sigma_title="Delete All Scheduled Tasks" | eval sigma_description="Detects the usage of schtasks with the delete flag and the asterisk symbole to delete all tasks from the schedule of the local computer, including tasks scheduled by other users."
dispatch.earliest_time = -24h@h
alert.track = 0

[Delete Important Scheduled Task - winevent]
description = Detects when adversaries stop services or processes by deleting their respective scheduled tasks in order to conduct data destructive activities
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\schtasks.exe" Process_Command_Line="*/delete*" Process_Command_Line="*/tn*" (Process_Command_Line="*\\Windows\\SystemRestore\\SR*" OR Process_Command_Line="*\\Windows\\Windows Defender\\*" OR Process_Command_Line="*\\Windows\\BitLocker*" OR Process_Command_Line="*\\Windows\\WindowsBackup\\*" OR Process_Command_Line="*\\Windows\\WindowsUpdate\\*" OR Process_Command_Line="*\\Windows\\UpdateOrchestrator\\*" OR Process_Command_Line="*\\Windows\\ExploitGuard*"))) | eval sigma_attack_tags="attack.impact attack.t1489" | eval sigma_title="Delete Important Scheduled Task" | eval sigma_description="Detects when adversaries stop services or processes by deleting their respective scheduled tasks in order to conduct data destructive activities"
dispatch.earliest_time = -24h@h
alert.track = 0

[Delete Important Scheduled Task - sysmon]
description = Detects when adversaries stop services or processes by deleting their respective scheduled tasks in order to conduct data destructive activities
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\schtasks.exe" CommandLine="*/delete*" CommandLine="*/tn*" (CommandLine="*\\Windows\\SystemRestore\\SR*" OR CommandLine="*\\Windows\\Windows Defender\\*" OR CommandLine="*\\Windows\\BitLocker*" OR CommandLine="*\\Windows\\WindowsBackup\\*" OR CommandLine="*\\Windows\\WindowsUpdate\\*" OR CommandLine="*\\Windows\\UpdateOrchestrator\\*" OR CommandLine="*\\Windows\\ExploitGuard*"))) | eval sigma_attack_tags="attack.impact attack.t1489" | eval sigma_title="Delete Important Scheduled Task" | eval sigma_description="Detects when adversaries stop services or processes by deleting their respective scheduled tasks in order to conduct data destructive activities"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Schtasks From Env Var Folder - winevent]
description = Detects Schtask creations that point to a suspicious folder or an environment variable often used by malware
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((New_Process_Name="*\\schtasks.exe" Process_Command_Line="* /create *" (Process_Command_Line="*%AppData%*" OR Process_Command_Line="*\\AppData\\Local\\*" OR Process_Command_Line="*\\AppData\\Roaming\\*" OR Process_Command_Line="*%Public%*" OR Process_Command_Line="*\\Users\\Public*" OR Process_Command_Line="*C:\\Windows\\Temp*" OR Process_Command_Line="*C:\\Perflogs*"))) OR ((ParentCommandLine="*\\svchost.exe -k netsvcs -p -s Schedule" (Process_Command_Line="*%Public%*" OR Process_Command_Line="*\\Users\\Public*" OR Process_Command_Line="*C:\\Windows\\Temp*" OR Process_Command_Line="*C:\\Perflogs*")))) NOT ((((Process_Command_Line="*update_task.xml*" OR Process_Command_Line="*/Create /TN TVInstallRestore /TR*")) OR (ParentCommandLine="*unattended.ini*"))))) | eval sigma_attack_tags="attack.execution attack.t1053.005" | eval sigma_title="Suspicious Schtasks From Env Var Folder" | eval sigma_description="Detects Schtask creations that point to a suspicious folder or an environment variable often used by malware"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Schtasks From Env Var Folder - sysmon]
description = Detects Schtask creations that point to a suspicious folder or an environment variable often used by malware
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((Image="*\\schtasks.exe" CommandLine="* /create *" (CommandLine="*%AppData%*" OR CommandLine="*\\AppData\\Local\\*" OR CommandLine="*\\AppData\\Roaming\\*" OR CommandLine="*%Public%*" OR CommandLine="*\\Users\\Public*" OR CommandLine="*C:\\Windows\\Temp*" OR CommandLine="*C:\\Perflogs*"))) OR ((ParentCommandLine="*\\svchost.exe -k netsvcs -p -s Schedule" (CommandLine="*%Public%*" OR CommandLine="*\\Users\\Public*" OR CommandLine="*C:\\Windows\\Temp*" OR CommandLine="*C:\\Perflogs*")))) NOT ((((CommandLine="*update_task.xml*" OR CommandLine="*/Create /TN TVInstallRestore /TR*")) OR (ParentCommandLine="*unattended.ini*"))))) | eval sigma_attack_tags="attack.execution attack.t1053.005" | eval sigma_title="Suspicious Schtasks From Env Var Folder" | eval sigma_description="Detects Schtask creations that point to a suspicious folder or an environment variable often used by malware"
dispatch.earliest_time = -24h@h
alert.track = 0

[Schtasks From Suspicious Folders - winevent]
description = Detects scheduled task creations that have suspicious action command and folder combinations
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\schtasks.exe" OR OriginalFileName="schtasks.exe") Process_Command_Line="* /create *" (Process_Command_Line="*powershell*" OR Process_Command_Line="*pwsh*" OR Process_Command_Line="*cmd /c *" OR Process_Command_Line="*cmd /k *" OR Process_Command_Line="*cmd /r *" OR Process_Command_Line="*cmd.exe /c *" OR Process_Command_Line="*cmd.exe /k *" OR Process_Command_Line="*cmd.exe /r *") (Process_Command_Line="*C:\\ProgramData\\*" OR Process_Command_Line="*%ProgramData%*"))) | eval sigma_attack_tags="attack.execution attack.t1053.005" | eval sigma_title="Schtasks From Suspicious Folders" | eval sigma_description="Detects scheduled task creations that have suspicious action command and folder combinations"
dispatch.earliest_time = -24h@h
alert.track = 0

[Schtasks From Suspicious Folders - sysmon]
description = Detects scheduled task creations that have suspicious action command and folder combinations
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\schtasks.exe" OR OriginalFileName="schtasks.exe") CommandLine="* /create *" (CommandLine="*powershell*" OR CommandLine="*pwsh*" OR CommandLine="*cmd /c *" OR CommandLine="*cmd /k *" OR CommandLine="*cmd /r *" OR CommandLine="*cmd.exe /c *" OR CommandLine="*cmd.exe /k *" OR CommandLine="*cmd.exe /r *") (CommandLine="*C:\\ProgramData\\*" OR CommandLine="*%ProgramData%*"))) | eval sigma_attack_tags="attack.execution attack.t1053.005" | eval sigma_title="Schtasks From Suspicious Folders" | eval sigma_description="Detects scheduled task creations that have suspicious action command and folder combinations"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Add Scheduled Task Parent - winevent]
description = Detects suspicious scheduled task creations from a parent stored in a temporary folder
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\schtasks.exe" Process_Command_Line="*/Create *" (Creator_Process_Name="*\\AppData\\Local\\*" OR Creator_Process_Name="*\\AppData\\Roaming\\*" OR Creator_Process_Name="*\\Temporary Internet*" OR Creator_Process_Name="*\\Users\\Public\\*"))) NOT ((((Process_Command_Line="*update_task.xml*" OR Process_Command_Line="*unattended.ini*")))))) | eval sigma_attack_tags="attack.execution attack.t1053.005" | eval sigma_title="Suspicious Add Scheduled Task Parent" | eval sigma_description="Detects suspicious scheduled task creations from a parent stored in a temporary folder"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Add Scheduled Task Parent - sysmon]
description = Detects suspicious scheduled task creations from a parent stored in a temporary folder
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\schtasks.exe" CommandLine="*/Create *" (ParentImage="*\\AppData\\Local\\*" OR ParentImage="*\\AppData\\Roaming\\*" OR ParentImage="*\\Temporary Internet*" OR ParentImage="*\\Users\\Public\\*"))) NOT ((((CommandLine="*update_task.xml*" OR CommandLine="*unattended.ini*")))))) | eval sigma_attack_tags="attack.execution attack.t1053.005" | eval sigma_title="Suspicious Add Scheduled Task Parent" | eval sigma_description="Detects suspicious scheduled task creations from a parent stored in a temporary folder"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Add Scheduled Command Pattern - winevent]
description = Detects suspicious scheduled task creations with commands that are uncommon
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\schtasks.exe" Process_Command_Line="*/Create *")) ((((Process_Command_Line="*/sc minute *" OR Process_Command_Line="*/ru system *") (Process_Command_Line="*cmd.exe /c *" OR Process_Command_Line="*cmd /c*" OR Process_Command_Line="*cmd.exe /k *" OR Process_Command_Line="*cmd /k*" OR Process_Command_Line="*cmd.exe /r *" OR Process_Command_Line="*cmd /r*"))) OR (Process_Command_Line="* bypass *" OR Process_Command_Line="*.DownloadString*" OR Process_Command_Line="*.DownloadFile*" OR Process_Command_Line="*FromBase64String*" OR Process_Command_Line="* -w hidden *" OR Process_Command_Line="* IEX*" OR Process_Command_Line="* -enc *" OR Process_Command_Line="* -decode *" OR Process_Command_Line="*/c start /min *" OR Process_Command_Line="* curl *") OR ((Process_Command_Line="*/xml C:\\Users\\*" Process_Command_Line="*\\AppData\\Local\\*")) OR ((Process_Command_Line="*wscript.exe*" Process_Command_Line="*\\AppData\\*"))))) | eval sigma_attack_tags="attack.execution attack.t1053.005" | eval sigma_title="Suspicious Add Scheduled Command Pattern" | eval sigma_description="Detects suspicious scheduled task creations with commands that are uncommon"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Add Scheduled Command Pattern - sysmon]
description = Detects suspicious scheduled task creations with commands that are uncommon
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\schtasks.exe" CommandLine="*/Create *")) ((((CommandLine="*/sc minute *" OR CommandLine="*/ru system *") (CommandLine="*cmd.exe /c *" OR CommandLine="*cmd /c*" OR CommandLine="*cmd.exe /k *" OR CommandLine="*cmd /k*" OR CommandLine="*cmd.exe /r *" OR CommandLine="*cmd /r*"))) OR (CommandLine="* bypass *" OR CommandLine="*.DownloadString*" OR CommandLine="*.DownloadFile*" OR CommandLine="*FromBase64String*" OR CommandLine="* -w hidden *" OR CommandLine="* IEX*" OR CommandLine="* -enc *" OR CommandLine="* -decode *" OR CommandLine="*/c start /min *" OR CommandLine="* curl *") OR ((CommandLine="*/xml C:\\Users\\*" CommandLine="*\\AppData\\Local\\*")) OR ((CommandLine="*wscript.exe*" CommandLine="*\\AppData\\*"))))) | eval sigma_attack_tags="attack.execution attack.t1053.005" | eval sigma_title="Suspicious Add Scheduled Command Pattern" | eval sigma_description="Detects suspicious scheduled task creations with commands that are uncommon"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Schtasks Schedule Type With High Privileges - winevent]
description = Detects scheduled task creations or modification to be run with high privileges on a suspicious schedule type
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\schtasks.exe" OR OriginalFileName="schtasks.exe") (Process_Command_Line="* ONLOGON *" OR Process_Command_Line="* ONSTART *" OR Process_Command_Line="* ONCE *" OR Process_Command_Line="* ONIDLE *") (Process_Command_Line="*NT AUT*" OR Process_Command_Line="* SYSTEM*" OR Process_Command_Line="*HIGHEST*"))) | eval sigma_attack_tags="attack.execution attack.t1053.005" | eval sigma_title="Suspicious Schtasks Schedule Type With High Privileges" | eval sigma_description="Detects scheduled task creations or modification to be run with high privileges on a suspicious schedule type"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Schtasks Schedule Type With High Privileges - sysmon]
description = Detects scheduled task creations or modification to be run with high privileges on a suspicious schedule type
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\schtasks.exe" OR OriginalFileName="schtasks.exe") (CommandLine="* ONLOGON *" OR CommandLine="* ONSTART *" OR CommandLine="* ONCE *" OR CommandLine="* ONIDLE *") (CommandLine="*NT AUT*" OR CommandLine="* SYSTEM*" OR CommandLine="*HIGHEST*"))) | eval sigma_attack_tags="attack.execution attack.t1053.005" | eval sigma_title="Suspicious Schtasks Schedule Type With High Privileges" | eval sigma_description="Detects scheduled task creations or modification to be run with high privileges on a suspicious schedule type"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Schtasks Schedule Types - winevent]
description = Detects scheduled task creations or modification on a suspicious schedule type
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((New_Process_Name="*\\schtasks.exe" OR OriginalFileName="schtasks.exe") (Process_Command_Line="* ONLOGON *" OR Process_Command_Line="* ONSTART *" OR Process_Command_Line="* ONCE *" OR Process_Command_Line="* ONIDLE *"))) NOT ((((Process_Command_Line="*NT AUT*" OR Process_Command_Line="* SYSTEM*" OR Process_Command_Line="*HIGHEST*")))))) | eval sigma_attack_tags="attack.execution attack.t1053.005" | eval sigma_title="Suspicious Schtasks Schedule Types" | eval sigma_description="Detects scheduled task creations or modification on a suspicious schedule type"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Schtasks Schedule Types - sysmon]
description = Detects scheduled task creations or modification on a suspicious schedule type
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((Image="*\\schtasks.exe" OR OriginalFileName="schtasks.exe") (CommandLine="* ONLOGON *" OR CommandLine="* ONSTART *" OR CommandLine="* ONCE *" OR CommandLine="* ONIDLE *"))) NOT ((((CommandLine="*NT AUT*" OR CommandLine="* SYSTEM*" OR CommandLine="*HIGHEST*")))))) | eval sigma_attack_tags="attack.execution attack.t1053.005" | eval sigma_title="Suspicious Schtasks Schedule Types" | eval sigma_description="Detects scheduled task creations or modification on a suspicious schedule type"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Add Scheduled Task From User AppData Temp - winevent]
description = schtasks.exe create task from user AppData\Local\Temp
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\schtasks.exe" Process_Command_Line="*/Create *" Process_Command_Line="*\\AppData\\Local\\Temp*")) NOT ((((Process_Command_Line="*/Create /TN \"klcp_update\" /XML *" Process_Command_Line="*\\klcp_update_task.xml*")))))) | eval sigma_attack_tags="attack.execution attack.t1053.005" | eval sigma_title="Suspicious Add Scheduled Task From User AppData Temp" | eval sigma_description="schtasks.exe create task from user AppData\Local\Temp"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Add Scheduled Task From User AppData Temp - sysmon]
description = schtasks.exe create task from user AppData\Local\Temp
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\schtasks.exe" CommandLine="*/Create *" CommandLine="*\\AppData\\Local\\Temp*")) NOT ((((CommandLine="*/Create /TN \"klcp_update\" /XML *" CommandLine="*\\klcp_update_task.xml*")))))) | eval sigma_attack_tags="attack.execution attack.t1053.005" | eval sigma_title="Suspicious Add Scheduled Task From User AppData Temp" | eval sigma_description="schtasks.exe create task from user AppData\Local\Temp"
dispatch.earliest_time = -24h@h
alert.track = 0

[ScreenConnect Remote Access - winevent]
description = Detects ScreenConnect program starts that establish a remote access to that system (not meeting, not remote support)
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*e=Access&*" Process_Command_Line="*y=Guest&*" Process_Command_Line="*&p=*" Process_Command_Line="*&c=*" Process_Command_Line="*&k=*")) | eval sigma_attack_tags="attack.initial_access attack.t1133" | eval sigma_title="ScreenConnect Remote Access" | eval sigma_description="Detects ScreenConnect program starts that establish a remote access to that system (not meeting, not remote support)"
dispatch.earliest_time = -24h@h
alert.track = 0

[ScreenConnect Remote Access - sysmon]
description = Detects ScreenConnect program starts that establish a remote access to that system (not meeting, not remote support)
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*e=Access&*" CommandLine="*y=Guest&*" CommandLine="*&p=*" CommandLine="*&c=*" CommandLine="*&k=*")) | eval sigma_attack_tags="attack.initial_access attack.t1133" | eval sigma_title="ScreenConnect Remote Access" | eval sigma_description="Detects ScreenConnect program starts that establish a remote access to that system (not meeting, not remote support)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious ScreenSave Change by Reg.exe - winevent]
description = Adversaries may establish persistence by executing malicious content triggered by user inactivity.
Screensavers are programs that execute after a configurable time of user inactivity and consist of Portable Executable (PE) files with a .scr file extension

search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\reg.exe" (Process_Command_Line="*HKEY_CURRENT_USER\\Control Panel\\Desktop*" OR Process_Command_Line="*HKCU\\Control Panel\\Desktop*"))) (((Process_Command_Line="*/v ScreenSaveActive*" Process_Command_Line="*/t REG_SZ*" Process_Command_Line="*/d 1*" Process_Command_Line="*/f*")) OR ((Process_Command_Line="*/v ScreenSaveTimeout*" Process_Command_Line="*/t REG_SZ*" Process_Command_Line="*/d *" Process_Command_Line="*/f*")) OR ((Process_Command_Line="*/v ScreenSaverIsSecure*" Process_Command_Line="*/t REG_SZ*" Process_Command_Line="*/d 0*" Process_Command_Line="*/f*")) OR ((Process_Command_Line="*/v SCRNSAVE.EXE*" Process_Command_Line="*/t REG_SZ*" Process_Command_Line="*/d *" Process_Command_Line="*.scr*" Process_Command_Line="*/f*"))))) | eval sigma_attack_tags="attack.privilege_escalation attack.t1546.002" | eval sigma_title="Suspicious ScreenSave Change by Reg.exe" | eval sigma_description="Adversaries may establish persistence by executing malicious content triggered by user inactivity.
Screensavers are programs that execute after a configurable time of user inactivity and consist of Portable Executable (PE) files with a .scr file extension
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious ScreenSave Change by Reg.exe - sysmon]
description = Adversaries may establish persistence by executing malicious content triggered by user inactivity.
Screensavers are programs that execute after a configurable time of user inactivity and consist of Portable Executable (PE) files with a .scr file extension

search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\reg.exe" (CommandLine="*HKEY_CURRENT_USER\\Control Panel\\Desktop*" OR CommandLine="*HKCU\\Control Panel\\Desktop*"))) (((CommandLine="*/v ScreenSaveActive*" CommandLine="*/t REG_SZ*" CommandLine="*/d 1*" CommandLine="*/f*")) OR ((CommandLine="*/v ScreenSaveTimeout*" CommandLine="*/t REG_SZ*" CommandLine="*/d *" CommandLine="*/f*")) OR ((CommandLine="*/v ScreenSaverIsSecure*" CommandLine="*/t REG_SZ*" CommandLine="*/d 0*" CommandLine="*/f*")) OR ((CommandLine="*/v SCRNSAVE.EXE*" CommandLine="*/t REG_SZ*" CommandLine="*/d *" CommandLine="*.scr*" CommandLine="*/f*"))))) | eval sigma_attack_tags="attack.privilege_escalation attack.t1546.002" | eval sigma_title="Suspicious ScreenSave Change by Reg.exe" | eval sigma_description="Adversaries may establish persistence by executing malicious content triggered by user inactivity.
Screensavers are programs that execute after a configurable time of user inactivity and consist of Portable Executable (PE) files with a .scr file extension
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Script Interpreter Execution From Suspicious Folder - winevent]
description = Detects a suspicious script executions in temporary folders or folders accessible by environment variables
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\powershell.exe" OR New_Process_Name="*\\pwsh.exe" OR New_Process_Name="*\\mshta.exe" OR New_Process_Name="*\\wscript.exe" OR New_Process_Name="*\\cscript.exe" OR New_Process_Name="*\\cmd.exe") OR (Process_Command_Line="* -w hidden *" OR Process_Command_Line="* -ep bypass *" OR Process_Command_Line="*/e:vbscript *" OR Process_Command_Line="*/e:javascript *") OR (OriginalFileName="powershell.exe" OR OriginalFileName="pwsh.dll" OR OriginalFileName="mshta.exe" OR OriginalFileName="wscript.exe" OR OriginalFileName="cscript.exe" OR OriginalFileName="cmd.exe")) (New_Process_Name="*\\Windows\\Temp*" OR New_Process_Name="*\\Temporary Internet*" OR New_Process_Name="*\\AppData\\Local\\Temp*" OR New_Process_Name="*\\AppData\\Roaming\\Temp*" OR New_Process_Name="*C:\\Users\\Public\\*" OR New_Process_Name="*C:\\Perflogs\\*"))) | eval sigma_attack_tags="attack.execution attack.t1059" | eval sigma_title="Script Interpreter Execution From Suspicious Folder" | eval sigma_description="Detects a suspicious script executions in temporary folders or folders accessible by environment variables"
dispatch.earliest_time = -24h@h
alert.track = 0

[Script Interpreter Execution From Suspicious Folder - sysmon]
description = Detects a suspicious script executions in temporary folders or folders accessible by environment variables
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\powershell.exe" OR Image="*\\pwsh.exe" OR Image="*\\mshta.exe" OR Image="*\\wscript.exe" OR Image="*\\cscript.exe" OR Image="*\\cmd.exe") OR (CommandLine="* -w hidden *" OR CommandLine="* -ep bypass *" OR CommandLine="*/e:vbscript *" OR CommandLine="*/e:javascript *") OR (OriginalFileName="powershell.exe" OR OriginalFileName="pwsh.dll" OR OriginalFileName="mshta.exe" OR OriginalFileName="wscript.exe" OR OriginalFileName="cscript.exe" OR OriginalFileName="cmd.exe")) (Image="*\\Windows\\Temp*" OR Image="*\\Temporary Internet*" OR Image="*\\AppData\\Local\\Temp*" OR Image="*\\AppData\\Roaming\\Temp*" OR Image="*C:\\Users\\Public\\*" OR Image="*C:\\Perflogs\\*"))) | eval sigma_attack_tags="attack.execution attack.t1059" | eval sigma_title="Script Interpreter Execution From Suspicious Folder" | eval sigma_description="Detects a suspicious script executions in temporary folders or folders accessible by environment variables"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Script Execution From Temp Folder - winevent]
description = Detects a suspicious script executions from temporary folder
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((New_Process_Name="*\\powershell.exe" OR New_Process_Name="*\\pwsh.exe" OR New_Process_Name="*\\mshta.exe" OR New_Process_Name="*\\wscript.exe" OR New_Process_Name="*\\cscript.exe") (Process_Command_Line="*\\Windows\\Temp*" OR Process_Command_Line="*\\Temporary Internet*" OR Process_Command_Line="*\\AppData\\Local\\Temp*" OR Process_Command_Line="*\\AppData\\Roaming\\Temp*" OR Process_Command_Line="*%TEMP%*" OR Process_Command_Line="*%TMP%*" OR Process_Command_Line="*%LocalAppData%\\Temp*"))) NOT (((Process_Command_Line="* >*" OR Process_Command_Line="*Out-File*" OR Process_Command_Line="*ConvertTo-Json*" OR Process_Command_Line="*-WindowStyle hidden -Verb runAs*" OR Process_Command_Line="*\\Windows\\system32\\config\\systemprofile\\AppData\\Local\\Temp\\Amazon\\EC2-Windows\\*"))))) | eval sigma_attack_tags="attack.execution attack.t1059" | eval sigma_title="Suspicious Script Execution From Temp Folder" | eval sigma_description="Detects a suspicious script executions from temporary folder"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Script Execution From Temp Folder - sysmon]
description = Detects a suspicious script executions from temporary folder
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((Image="*\\powershell.exe" OR Image="*\\pwsh.exe" OR Image="*\\mshta.exe" OR Image="*\\wscript.exe" OR Image="*\\cscript.exe") (CommandLine="*\\Windows\\Temp*" OR CommandLine="*\\Temporary Internet*" OR CommandLine="*\\AppData\\Local\\Temp*" OR CommandLine="*\\AppData\\Roaming\\Temp*" OR CommandLine="*%TEMP%*" OR CommandLine="*%TMP%*" OR CommandLine="*%LocalAppData%\\Temp*"))) NOT (((CommandLine="* >*" OR CommandLine="*Out-File*" OR CommandLine="*ConvertTo-Json*" OR CommandLine="*-WindowStyle hidden -Verb runAs*" OR CommandLine="*\\Windows\\system32\\config\\systemprofile\\AppData\\Local\\Temp\\Amazon\\EC2-Windows\\*"))))) | eval sigma_attack_tags="attack.execution attack.t1059" | eval sigma_title="Suspicious Script Execution From Temp Folder" | eval sigma_description="Detects a suspicious script executions from temporary folder"
dispatch.earliest_time = -24h@h
alert.track = 0

[WSF/JSE/JS/VBA/VBE File Execution - winevent]
description = Detects suspicious file execution by wscript and cscript
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (New_Process_Name="*\\wscript.exe" OR New_Process_Name="*\\cscript.exe") (Process_Command_Line="*.jse*" OR Process_Command_Line="*.vbe*" OR Process_Command_Line="*.js*" OR Process_Command_Line="*.vba*"))) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.execution attack.t1059.005 attack.t1059.007" | eval sigma_title="WSF/JSE/JS/VBA/VBE File Execution" | eval sigma_description="Detects suspicious file execution by wscript and cscript"
dispatch.earliest_time = -24h@h
alert.track = 0

[WSF/JSE/JS/VBA/VBE File Execution - sysmon]
description = Detects suspicious file execution by wscript and cscript
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (Image="*\\wscript.exe" OR Image="*\\cscript.exe") (CommandLine="*.jse*" OR CommandLine="*.vbe*" OR CommandLine="*.js*" OR CommandLine="*.vba*"))) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.execution attack.t1059.005 attack.t1059.007" | eval sigma_title="WSF/JSE/JS/VBA/VBE File Execution" | eval sigma_description="Detects suspicious file execution by wscript and cscript"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential Suspicious Activity Using SeCEdit - winevent]
description = Detects potential suspicious behaviour using secedit.exe. Such as exporting or modifying the security policy
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\secedit.exe" OR OriginalFileName="SeCEdit") (((Process_Command_Line="*/export*" Process_Command_Line="*/cfg*")) OR ((Process_Command_Line="*/configure*" Process_Command_Line="*/db*"))))) | eval sigma_attack_tags="attack.discovery attack.persistence attack.defense_evasion attack.credential_access attack.privilege_escalation attack.t1562.002 attack.t1547.001 attack.t1505.005 attack.t1556.002 attack.t1562 attack.t1574.007 attack.t1564.002 attack.t1546.008 attack.t1546.007 attack.t1547.014 attack.t1547.010 attack.t1547.002 attack.t1557 attack.t1082" | eval sigma_title="Potential Suspicious Activity Using SeCEdit" | eval sigma_description="Detects potential suspicious behaviour using secedit.exe. Such as exporting or modifying the security policy"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential Suspicious Activity Using SeCEdit - sysmon]
description = Detects potential suspicious behaviour using secedit.exe. Such as exporting or modifying the security policy
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\secedit.exe" OR OriginalFileName="SeCEdit") (((CommandLine="*/export*" CommandLine="*/cfg*")) OR ((CommandLine="*/configure*" CommandLine="*/db*"))))) | eval sigma_attack_tags="attack.discovery attack.persistence attack.defense_evasion attack.credential_access attack.privilege_escalation attack.t1562.002 attack.t1547.001 attack.t1505.005 attack.t1556.002 attack.t1562 attack.t1574.007 attack.t1564.002 attack.t1546.008 attack.t1546.007 attack.t1547.014 attack.t1547.010 attack.t1547.002 attack.t1557 attack.t1082" | eval sigma_title="Potential Suspicious Activity Using SeCEdit" | eval sigma_description="Detects potential suspicious behaviour using secedit.exe. Such as exporting or modifying the security policy"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Service DACL Modification Via Set-Service Cmdlet - winevent]
description = Detects suspicious DACL modifications via the 'Set-Service' cmdlet using the 'SecurityDescriptorSddl' flag (Only available with PowerShell 7) that can be used to hide services or make them unstopable
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\pwsh.exe" OR OriginalFileName="pwsh.dll") (Process_Command_Line="*-SecurityDescriptorSddl *" OR Process_Command_Line="*-sd *") ((Process_Command_Line="*Set-Service *" Process_Command_Line="*D;;*" (Process_Command_Line="*;;;IU*" OR Process_Command_Line="*;;;SU*" OR Process_Command_Line="*;;;BA*" OR Process_Command_Line="*;;;SY*" OR Process_Command_Line="*;;;WD*"))))) | eval sigma_attack_tags="attack.persistence attack.t1543.003" | eval sigma_title="Suspicious Service DACL Modification Via Set-Service Cmdlet" | eval sigma_description="Detects suspicious DACL modifications via the 'Set-Service' cmdlet using the 'SecurityDescriptorSddl' flag (Only available with PowerShell 7) that can be used to hide services or make them unstopable"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Service DACL Modification Via Set-Service Cmdlet - sysmon]
description = Detects suspicious DACL modifications via the 'Set-Service' cmdlet using the 'SecurityDescriptorSddl' flag (Only available with PowerShell 7) that can be used to hide services or make them unstopable
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\pwsh.exe" OR OriginalFileName="pwsh.dll") (CommandLine="*-SecurityDescriptorSddl *" OR CommandLine="*-sd *") ((CommandLine="*Set-Service *" CommandLine="*D;;*" (CommandLine="*;;;IU*" OR CommandLine="*;;;SU*" OR CommandLine="*;;;BA*" OR CommandLine="*;;;SY*" OR CommandLine="*;;;WD*"))))) | eval sigma_attack_tags="attack.persistence attack.t1543.003" | eval sigma_title="Suspicious Service DACL Modification Via Set-Service Cmdlet" | eval sigma_description="Detects suspicious DACL modifications via the 'Set-Service' cmdlet using the 'SecurityDescriptorSddl' flag (Only available with PowerShell 7) that can be used to hide services or make them unstopable"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Service DACL Modification - winevent]
description = Detects suspicious DACL modifications that can  be used to hide services or make them unstopable
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\sc.exe" OR OriginalFileName="sc.exe") ((Process_Command_Line="*sdset*" Process_Command_Line="*D;;*" (Process_Command_Line="*;;;IU*" OR Process_Command_Line="*;;;SU*" OR Process_Command_Line="*;;;BA*" OR Process_Command_Line="*;;;SY*" OR Process_Command_Line="*;;;WD*"))))) | eval sigma_attack_tags="attack.persistence attack.t1543.003" | eval sigma_title="Suspicious Service DACL Modification" | eval sigma_description="Detects suspicious DACL modifications that can  be used to hide services or make them unstopable"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Service DACL Modification - sysmon]
description = Detects suspicious DACL modifications that can  be used to hide services or make them unstopable
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\sc.exe" OR OriginalFileName="sc.exe") ((CommandLine="*sdset*" CommandLine="*D;;*" (CommandLine="*;;;IU*" OR CommandLine="*;;;SU*" OR CommandLine="*;;;BA*" OR CommandLine="*;;;SY*" OR CommandLine="*;;;WD*"))))) | eval sigma_attack_tags="attack.persistence attack.t1543.003" | eval sigma_title="Suspicious Service DACL Modification" | eval sigma_description="Detects suspicious DACL modifications that can  be used to hide services or make them unstopable"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Service Binary Directory - winevent]
description = Detects a service binary running in a suspicious directory
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (New_Process_Name="*\\Users\\Public\\*" OR New_Process_Name="*\\$Recycle.bin*" OR New_Process_Name="*\\Users\\All Users\\*" OR New_Process_Name="*\\Users\\Default\\*" OR New_Process_Name="*\\Users\\Contacts\\*" OR New_Process_Name="*\\Users\\Searches\\*" OR New_Process_Name="*C:\\Perflogs\\*" OR New_Process_Name="*\\config\\systemprofile\\*" OR New_Process_Name="*\\Windows\\Fonts\\*" OR New_Process_Name="*\\Windows\\IME\\*" OR New_Process_Name="*\\Windows\\addins\\*") (Creator_Process_Name="*\\services.exe" OR Creator_Process_Name="*\\svchost.exe"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1202" | eval sigma_title="Suspicious Service Binary Directory" | eval sigma_description="Detects a service binary running in a suspicious directory"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Service Binary Directory - sysmon]
description = Detects a service binary running in a suspicious directory
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (Image="*\\Users\\Public\\*" OR Image="*\\$Recycle.bin*" OR Image="*\\Users\\All Users\\*" OR Image="*\\Users\\Default\\*" OR Image="*\\Users\\Contacts\\*" OR Image="*\\Users\\Searches\\*" OR Image="*C:\\Perflogs\\*" OR Image="*\\config\\systemprofile\\*" OR Image="*\\Windows\\Fonts\\*" OR Image="*\\Windows\\IME\\*" OR Image="*\\Windows\\addins\\*") (ParentImage="*\\services.exe" OR ParentImage="*\\svchost.exe"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1202" | eval sigma_title="Suspicious Service Binary Directory" | eval sigma_description="Detects a service binary running in a suspicious directory"
dispatch.earliest_time = -24h@h
alert.track = 0

[Stop Or Remove Antivirus Service - winevent]
description = Detects usage of 'Stop-Service' or 'Remove-Service' powershell cmdlet to disable AV services.
Adversaries may disable security tools to avoid possible detection of their tools and activities by stopping antivirus service

search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (Process_Command_Line="*Stop-Service *" OR Process_Command_Line="*Remove-Service *") (Process_Command_Line="* McAfeeDLPAgentService*" OR Process_Command_Line="* Trend Micro Deep Security Manager*" OR Process_Command_Line="* TMBMServer*" OR Process_Command_Line="*Sophos*" OR Process_Command_Line="*Symantec*"))) | table ComputerName,Account_Name,Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.t1562.001" | eval sigma_title="Stop Or Remove Antivirus Service" | eval sigma_description="Detects usage of 'Stop-Service' or 'Remove-Service' powershell cmdlet to disable AV services.
Adversaries may disable security tools to avoid possible detection of their tools and activities by stopping antivirus service
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Stop Or Remove Antivirus Service - sysmon]
description = Detects usage of 'Stop-Service' or 'Remove-Service' powershell cmdlet to disable AV services.
Adversaries may disable security tools to avoid possible detection of their tools and activities by stopping antivirus service

search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (CommandLine="*Stop-Service *" OR CommandLine="*Remove-Service *") (CommandLine="* McAfeeDLPAgentService*" OR CommandLine="* Trend Micro Deep Security Manager*" OR CommandLine="* TMBMServer*" OR CommandLine="*Sophos*" OR CommandLine="*Symantec*"))) | table ComputerName,User,CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.t1562.001" | eval sigma_title="Stop Or Remove Antivirus Service" | eval sigma_description="Detects usage of 'Stop-Service' or 'Remove-Service' powershell cmdlet to disable AV services.
Adversaries may disable security tools to avoid possible detection of their tools and activities by stopping antivirus service
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Service Path Modification - winevent]
description = Detects service path modification via the 'sc' binary to a suspicious command or path
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\sc.exe" Process_Command_Line="*config*" Process_Command_Line="*binPath*" (Process_Command_Line="*powershell*" OR Process_Command_Line="*cmd *" OR Process_Command_Line="*mshta*" OR Process_Command_Line="*wscript*" OR Process_Command_Line="*cscript*" OR Process_Command_Line="*rundll32*" OR Process_Command_Line="*svchost*" OR Process_Command_Line="*dllhost*" OR Process_Command_Line="*cmd.exe /c*" OR Process_Command_Line="*cmd.exe /k*" OR Process_Command_Line="*cmd.exe /r*" OR Process_Command_Line="*cmd /c*" OR Process_Command_Line="*cmd /k*" OR Process_Command_Line="*cmd /r*" OR Process_Command_Line="*C:\\Users\\Public*" OR Process_Command_Line="*\\Downloads\\*" OR Process_Command_Line="*\\Desktop\\*" OR Process_Command_Line="*\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\*" OR Process_Command_Line="*C:\\Windows\\TEMP\\*" OR Process_Command_Line="*\\AppData\\Local\\Temp*"))) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.persistence attack.privilege_escalation attack.t1543.003" | eval sigma_title="Suspicious Service Path Modification" | eval sigma_description="Detects service path modification via the 'sc' binary to a suspicious command or path"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Service Path Modification - sysmon]
description = Detects service path modification via the 'sc' binary to a suspicious command or path
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\sc.exe" CommandLine="*config*" CommandLine="*binPath*" (CommandLine="*powershell*" OR CommandLine="*cmd *" OR CommandLine="*mshta*" OR CommandLine="*wscript*" OR CommandLine="*cscript*" OR CommandLine="*rundll32*" OR CommandLine="*svchost*" OR CommandLine="*dllhost*" OR CommandLine="*cmd.exe /c*" OR CommandLine="*cmd.exe /k*" OR CommandLine="*cmd.exe /r*" OR CommandLine="*cmd /c*" OR CommandLine="*cmd /k*" OR CommandLine="*cmd /r*" OR CommandLine="*C:\\Users\\Public*" OR CommandLine="*\\Downloads\\*" OR CommandLine="*\\Desktop\\*" OR CommandLine="*\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\*" OR CommandLine="*C:\\Windows\\TEMP\\*" OR CommandLine="*\\AppData\\Local\\Temp*"))) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.persistence attack.privilege_escalation attack.t1543.003" | eval sigma_title="Suspicious Service Path Modification" | eval sigma_description="Detects service path modification via the 'sc' binary to a suspicious command or path"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Stop Windows Service - winevent]
description = Detects the usage of one of the the commands to stop services such as 'net', 'sc'...etc in order to stop critical or important windows services such as AV, Backup...etc. As seen being used in some ransomware scripts
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (Process_Command_Line="*\"Acronis VSS Provider\"*" OR Process_Command_Line="*\"Client Agent 7.60\"*" OR Process_Command_Line="*\"Enterprise Client Service\"*" OR Process_Command_Line="*\"Sophos Agent\"*" OR Process_Command_Line="*\"Sophos AutoUpdate Service\"*" OR Process_Command_Line="*\"Sophos Clean Service\"*" OR Process_Command_Line="*\"Sophos Device Control Service\"*" OR Process_Command_Line="*\"Sophos File Scanner Service\"*" OR Process_Command_Line="*\"Sophos Health Service\"*" OR Process_Command_Line="*\"Sophos MCS Agent\"*" OR Process_Command_Line="*\"Sophos MCS Client\"*" OR Process_Command_Line="*\"Sophos Message Router\"*" OR Process_Command_Line="*\"Sophos Safestore Service\"*" OR Process_Command_Line="*\"Sophos System Protection Service\"*" OR Process_Command_Line="*\"Sophos Web Control Service\"*" OR Process_Command_Line="*\"SQL Backups\"*" OR Process_Command_Line="*\"SQL Server (MSSQLSERVER)\"*" OR Process_Command_Line="*\"SQL Server (SQLEXPRESS)*" OR Process_Command_Line="*\"SQLsafe Backup Service\"*" OR Process_Command_Line="*\"SQLsafe Filter Service\"*" OR Process_Command_Line="*\"Symantec System Recovery\"*" OR Process_Command_Line="*\"Veeam Backup Catalog Data Service\"*" OR Process_Command_Line="*\"Veritas System Recovery\"*" OR Process_Command_Line="*\"Zoolz 2 Service\"*" OR Process_Command_Line="*“Avast Business Console Client Antivirus Service”*" OR Process_Command_Line="*“avast! Antivirus”*" OR Process_Command_Line="*“SQL Backups”*" OR Process_Command_Line="*“Zoolz 2 Service”*" OR Process_Command_Line="*143Svc*" OR Process_Command_Line="*AcronisAgent*" OR Process_Command_Line="*AcrSch2Svc*" OR Process_Command_Line="*Antivirus*" OR Process_Command_Line="*ARSM*" OR Process_Command_Line="*aswBcc*" OR Process_Command_Line="*AVP*" OR Process_Command_Line="*BackupExecAgentAccelerator*" OR Process_Command_Line="*BackupExecAgentBrowser*" OR Process_Command_Line="*BackupExecDeviceMediaService*" OR Process_Command_Line="*BackupExecJobEngine*" OR Process_Command_Line="*BackupExeclobEngine*" OR Process_Command_Line="*BackupExecManagementService*" OR Process_Command_Line="*BackupExecRPCService*" OR Process_Command_Line="*BackupExecVSSProvider*" OR Process_Command_Line="*bedbg*" OR Process_Command_Line="*BITS*" OR Process_Command_Line="*BrokerInfrastructure*" OR Process_Command_Line="*DCAgent*" OR Process_Command_Line="*EhttpSrv*" OR Process_Command_Line="*EhttpSry*" OR Process_Command_Line="*ekrn*" OR Process_Command_Line="*epag*" OR Process_Command_Line="*EPIntegrationService*" OR Process_Command_Line="*EPlntegrationService*" OR Process_Command_Line="*EPProtectedService*" OR Process_Command_Line="*EPRedline*" OR Process_Command_Line="*EPSecurityService*" OR Process_Command_Line="*EPUpdateService*" OR Process_Command_Line="*EraserSvc11710*" OR Process_Command_Line="*EsgShKernel*" OR Process_Command_Line="*ESHASRV*" OR Process_Command_Line="*FA_Scheduler*" OR Process_Command_Line="*HealthTLService*" OR Process_Command_Line="*HISSQLFDLauncherSSHAREPOINIT*" OR Process_Command_Line="*HMS*" OR Process_Command_Line="*IISAdmin*" OR Process_Command_Line="*IMANSVC*" OR Process_Command_Line="*IMAP4Svc*" OR Process_Command_Line="*KAVFS*" OR Process_Command_Line="*KAVFSGT*" OR Process_Command_Line="*kavfsslp*" OR Process_Command_Line="*klnagent*" OR Process_Command_Line="*LogProcessorService*" OR Process_Command_Line="*M8EndpointAgent*" OR Process_Command_Line="*macmnsvc*" OR Process_Command_Line="*masvc*" OR Process_Command_Line="*MBAMService*" OR Process_Command_Line="*MBEndpointAgent*" OR Process_Command_Line="*McAfeeEngineService*" OR Process_Command_Line="*MCAFEEEVENTPARSERSRV*" OR Process_Command_Line="*McAfeeFramework*" OR Process_Command_Line="*McAfeeFrameworkMcAfeeFramework*" OR Process_Command_Line="*MCAFEETOMCATSRV530*" OR Process_Command_Line="*McShield*" OR Process_Command_Line="*McTaskManager*" OR Process_Command_Line="*mfefire*" OR Process_Command_Line="*mfemms*" OR Process_Command_Line="*mfevto*" OR Process_Command_Line="*mfevtp*" OR Process_Command_Line="*mfewc*" OR Process_Command_Line="*MMS*" OR Process_Command_Line="*mozyprobackup*" OR Process_Command_Line="*MsDtsServer*" OR Process_Command_Line="*MsDtsServer100*" OR Process_Command_Line="*MsDtsServer110*" OR Process_Command_Line="*MsDtsServer130*" OR Process_Command_Line="*MSExchangeES*" OR Process_Command_Line="*MSExchangeIS*" OR Process_Command_Line="*MSExchangeMGMT*" OR Process_Command_Line="*MSExchangeMIA*" OR Process_Command_Line="*MSExchangeMTA*" OR Process_Command_Line="*MSExchangeSA*" OR Process_Command_Line="*MSExchangeSRS*" OR Process_Command_Line="*msftesq1SPROO*" OR Process_Command_Line="*msftesql$PROD*" OR Process_Command_Line="*MSOLAP$SQL_2008*" OR Process_Command_Line="*MSOLAP$SYSTEM_BGC*" OR Process_Command_Line="*MSOLAP$TPS*" OR Process_Command_Line="*MSOLAP$TPSAMA*" OR Process_Command_Line="*MSOLAPSTPS*" OR Process_Command_Line="*MSOLAPSTPSAMA*" OR Process_Command_Line="*MSSQ!I.SPROFXENGAGEMEHT*" OR Process_Command_Line="*MSSQ0SHAREPOINT*" OR Process_Command_Line="*MSSQ0SOPHOS*" OR Process_Command_Line="*MSSQL$BKUPEXEC*" OR Process_Command_Line="*MSSQL$ECWDB2*" OR Process_Command_Line="*MSSQL$EPOSERVER*" OR Process_Command_Line="*MSSQL$ITRIS*" OR Process_Command_Line="*MSSQL$PRACTICEMGT*" OR Process_Command_Line="*MSSQL$PRACTTICEBGC*" OR Process_Command_Line="*MSSQL$PROD*" OR Process_Command_Line="*MSSQL$PROFXENGAGEMENT*" OR Process_Command_Line="*MSSQL$SBSMONITORING*" OR Process_Command_Line="*MSSQL$SHAREPOINT*" OR Process_Command_Line="*MSSQL$SOPHOS*" OR Process_Command_Line="*MSSQL$SQL_2008*" OR Process_Command_Line="*MSSQL$SQLEXPRESS*" OR Process_Command_Line="*MSSQL$SYSTEM_BGC*" OR Process_Command_Line="*MSSQL$TPS*" OR Process_Command_Line="*MSSQL$TPSAMA*" OR Process_Command_Line="*MSSQL$VEEAMSQL2008R2*" OR Process_Command_Line="*MSSQL$VEEAMSQL2012*" OR Process_Command_Line="*MSSQLFDLauncher*" OR Process_Command_Line="*MSSQLFDLauncher$ITRIS*" OR Process_Command_Line="*MSSQLFDLauncher$PROFXENGAGEMENT*" OR Process_Command_Line="*MSSQLFDLauncher$S8SMONITORING*" OR Process_Command_Line="*MSSQLFDLauncher$SBSMONITORING*" OR Process_Command_Line="*MSSQLFDLauncher$SHAREPOINT*" OR Process_Command_Line="*MSSQLFDLauncher$SQL_2008*" OR Process_Command_Line="*MSSQLFDLauncher$SYSTEM_BGC*" OR Process_Command_Line="*MSSQLFDLauncher$TPS*" OR Process_Command_Line="*MSSQLFDLauncher$TPSAMA*" OR Process_Command_Line="*MSSQLFDLauncherSPROFXENGAGEMENT*" OR Process_Command_Line="*MSSQLFDLauncherSTPS*" OR Process_Command_Line="*MSSQLFDLauncherSTPSAMA*" OR Process_Command_Line="*MSSQLFOLauncherSSVSTEM_BGC*" OR Process_Command_Line="*MSSQLFOLavocher*" OR Process_Command_Line="*MSSQLLaunchpad$ITRIS*" OR Process_Command_Line="*MSSQLSBKUPEXEC*" OR Process_Command_Line="*MSSQLSECWDB2*" OR Process_Command_Line="*MSSQLSERVER*" OR Process_Command_Line="*MSSQLServerADHelper*" OR Process_Command_Line="*MSSQLServerADHelper100*" OR Process_Command_Line="*MSSQLServerOLAPService*" OR Process_Command_Line="*mSSQLSFRACTICEMGT*" OR Process_Command_Line="*MSSQLSPRACTTICEBGE*" OR Process_Command_Line="*MSSQLSPROO*" OR Process_Command_Line="*MSSQLSSBSMONITORIMG*" OR Process_Command_Line="*MSSQLSSQL_2008*" OR Process_Command_Line="*MSSQLSSQLEXPRESS*" OR Process_Command_Line="*MSSQLSSVSTEM_BGC*" OR Process_Command_Line="*MSSQLSTPS*" OR Process_Command_Line="*MSSQLSTPSAMA*" OR Process_Command_Line="*MSSQLSVEEAMSQL2012*" OR Process_Command_Line="*MSSQLSVIEAMSQL2008112*" OR Process_Command_Line="*MSSQLWEEAMSQL2008R2*" OR Process_Command_Line="*MySQL57*" OR Process_Command_Line="*MySQL80*" OR Process_Command_Line="*MySQLS7*" OR Process_Command_Line="*NetMsmqActivator*" OR Process_Command_Line="*ntrtscan*" OR Process_Command_Line="*OracleClientCache80*" OR Process_Command_Line="*PDVFSService*" OR Process_Command_Line="*POP3Svc*" OR Process_Command_Line="*POVFSService*" OR Process_Command_Line="*ReportServer*" OR Process_Command_Line="*ReportServer$SQL_2008*" OR Process_Command_Line="*ReportServer$SYSTEM_BGC*" OR Process_Command_Line="*ReportServer$TPS*" OR Process_Command_Line="*ReportServer$TPSAMA*" OR Process_Command_Line="*RESvc*" OR Process_Command_Line="*sacsvr*" OR Process_Command_Line="*SamSs*" OR Process_Command_Line="*SAVAdminService*" OR Process_Command_Line="*SAVService*" OR Process_Command_Line="*SDRSVC*" OR Process_Command_Line="*SentinelAgent*" OR Process_Command_Line="*SentinelHelperService*" OR Process_Command_Line="*SepMasterService*" OR Process_Command_Line="*ShMonitor*" OR Process_Command_Line="*Smcinst*" OR Process_Command_Line="*SmcService*" OR Process_Command_Line="*SMTPSvc*" OR Process_Command_Line="*SNAC*" OR Process_Command_Line="*SntpService*" OR Process_Command_Line="*sophossps*" OR Process_Command_Line="*SQ1SafeOLRService*" OR Process_Command_Line="*SQLAgent$BKUPEXEC*" OR Process_Command_Line="*SQLAgent$CITRIX_METAFRAME*" OR Process_Command_Line="*SQLAgent$CXDB*" OR Process_Command_Line="*SQLAgent$ECWDB2*" OR Process_Command_Line="*SQLAgent$EPOSERVER*" OR Process_Command_Line="*SQLAgent$ITRIS*" OR Process_Command_Line="*SQLAgent$PRACTTICEBGC*" OR Process_Command_Line="*SQLAgent$PRACTTICEMGT*" OR Process_Command_Line="*SQLAgent$PROD*" OR Process_Command_Line="*SQLAgent$PROFXENGAGEMENT*" OR Process_Command_Line="*SQLAgent$SBSMONITORING*" OR Process_Command_Line="*SQLAgent$SHAREPOINT*" OR Process_Command_Line="*SQLAgent$SOPHOS*" OR Process_Command_Line="*SQLAgent$SQL_2008*" OR Process_Command_Line="*SQLAgent$SQLEXPRESS*" OR Process_Command_Line="*SQLAgent$SVSTEM_BGC*" OR Process_Command_Line="*SQLAgent$SYSTEM_BGC*" OR Process_Command_Line="*SQLAgent$TPS*" OR Process_Command_Line="*SQLAgent$TPSAMA*" OR Process_Command_Line="*SQLAgent$VEEAMSQL2008R2*" OR Process_Command_Line="*SQLAgent$VEEAMSQL2012*" OR Process_Command_Line="*SQLAgentSCITRIX_METAFRAME*" OR Process_Command_Line="*SQLAgentSCXDB*" OR Process_Command_Line="*SQLAgentSPRACTTICEBGC*" OR Process_Command_Line="*SQLAgentSPROO*" OR Process_Command_Line="*SQLAgentSSBSMONITORING*" OR Process_Command_Line="*SQLAgentSSQL EXPRESS*" OR Process_Command_Line="*SQLAgentSTPS*" OR Process_Command_Line="*SQLAgentSTPSAMA*" OR Process_Command_Line="*SQLAgentSVEEAMSQL2008R2*" OR Process_Command_Line="*SQLBrowser*" OR Process_Command_Line="*SQLSafeOLRService*" OR Process_Command_Line="*SQLSERVERAGENT*" OR Process_Command_Line="*SQLTELEMETRY*" OR Process_Command_Line="*SQLTELEMETRY$ECWDB2*" OR Process_Command_Line="*SQLTELEMETRY$ITRIS*" OR Process_Command_Line="*SQLWriter*" OR Process_Command_Line="*SSISTELEMETRY130*" OR Process_Command_Line="*SstpSvc*" OR Process_Command_Line="*svcGenericHost*" OR Process_Command_Line="*svcienericHost*" OR Process_Command_Line="*swi_filter*" OR Process_Command_Line="*swi_service*" OR Process_Command_Line="*swi_update*" OR Process_Command_Line="*swi_update_64*" OR Process_Command_Line="*Telemetryserver*" OR Process_Command_Line="*ThreatLockerService*" OR Process_Command_Line="*TmCCSF*" OR Process_Command_Line="*tmlisten*" OR Process_Command_Line="*TmPfw*" OR Process_Command_Line="*TrueKey*" OR Process_Command_Line="*TruekeyScheduler*" OR Process_Command_Line="*TrueKeyServiceHelper*" OR Process_Command_Line="*UI0Detect*" OR Process_Command_Line="*UTODetect*" OR Process_Command_Line="*VeeamBackupSvc*" OR Process_Command_Line="*VeeamBrokerSvc*" OR Process_Command_Line="*VeeamCatalogSvc*" OR Process_Command_Line="*VeeamCloudSvc*" OR Process_Command_Line="*VeeamDeploymentService*" OR Process_Command_Line="*VeeamDeploySvc*" OR Process_Command_Line="*VeeamEnterpriseHanagerSvc*" OR Process_Command_Line="*VeeamEnterpriseManagerSvc*" OR Process_Command_Line="*VeeamHvIntegrationSvc*" OR Process_Command_Line="*VeeamMountSvc*" OR Process_Command_Line="*VeeamNFSSvc*" OR Process_Command_Line="*VeeamRESTSvc*" OR Process_Command_Line="*VeeamRISTSvc*" OR Process_Command_Line="*VeeamTransportSvc*" OR Process_Command_Line="*VeemaDep/oySvc*" OR Process_Command_Line="*VSS*" OR Process_Command_Line="*W3Svc*" OR Process_Command_Line="*wbengine*" OR Process_Command_Line="*WdNisSvc*" OR Process_Command_Line="*WeanClOudSve*" OR Process_Command_Line="*Weems JY*" OR Process_Command_Line="*WinDefend*" OR Process_Command_Line="*wozyprobackup*" OR Process_Command_Line="*WRSVC*") (((((OriginalFileName="sc.exe" OR OriginalFileName="net.exe" OR OriginalFileName="net1.exe") OR (New_Process_Name="*\\sc.exe" OR New_Process_Name="*\\net.exe" OR New_Process_Name="*\\net1.exe")) Process_Command_Line="* stop *")) OR (((New_Process_Name="*\\powershell.exe" OR New_Process_Name="*\\pwsh.exe") Process_Command_Line="*Stop-Service *"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1489" | eval sigma_title="Suspicious Stop Windows Service" | eval sigma_description="Detects the usage of one of the the commands to stop services such as 'net', 'sc'...etc in order to stop critical or important windows services such as AV, Backup...etc. As seen being used in some ransomware scripts"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Stop Windows Service - sysmon]
description = Detects the usage of one of the the commands to stop services such as 'net', 'sc'...etc in order to stop critical or important windows services such as AV, Backup...etc. As seen being used in some ransomware scripts
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (CommandLine="*\"Acronis VSS Provider\"*" OR CommandLine="*\"Client Agent 7.60\"*" OR CommandLine="*\"Enterprise Client Service\"*" OR CommandLine="*\"Sophos Agent\"*" OR CommandLine="*\"Sophos AutoUpdate Service\"*" OR CommandLine="*\"Sophos Clean Service\"*" OR CommandLine="*\"Sophos Device Control Service\"*" OR CommandLine="*\"Sophos File Scanner Service\"*" OR CommandLine="*\"Sophos Health Service\"*" OR CommandLine="*\"Sophos MCS Agent\"*" OR CommandLine="*\"Sophos MCS Client\"*" OR CommandLine="*\"Sophos Message Router\"*" OR CommandLine="*\"Sophos Safestore Service\"*" OR CommandLine="*\"Sophos System Protection Service\"*" OR CommandLine="*\"Sophos Web Control Service\"*" OR CommandLine="*\"SQL Backups\"*" OR CommandLine="*\"SQL Server (MSSQLSERVER)\"*" OR CommandLine="*\"SQL Server (SQLEXPRESS)*" OR CommandLine="*\"SQLsafe Backup Service\"*" OR CommandLine="*\"SQLsafe Filter Service\"*" OR CommandLine="*\"Symantec System Recovery\"*" OR CommandLine="*\"Veeam Backup Catalog Data Service\"*" OR CommandLine="*\"Veritas System Recovery\"*" OR CommandLine="*\"Zoolz 2 Service\"*" OR CommandLine="*“Avast Business Console Client Antivirus Service”*" OR CommandLine="*“avast! Antivirus”*" OR CommandLine="*“SQL Backups”*" OR CommandLine="*“Zoolz 2 Service”*" OR CommandLine="*143Svc*" OR CommandLine="*AcronisAgent*" OR CommandLine="*AcrSch2Svc*" OR CommandLine="*Antivirus*" OR CommandLine="*ARSM*" OR CommandLine="*aswBcc*" OR CommandLine="*AVP*" OR CommandLine="*BackupExecAgentAccelerator*" OR CommandLine="*BackupExecAgentBrowser*" OR CommandLine="*BackupExecDeviceMediaService*" OR CommandLine="*BackupExecJobEngine*" OR CommandLine="*BackupExeclobEngine*" OR CommandLine="*BackupExecManagementService*" OR CommandLine="*BackupExecRPCService*" OR CommandLine="*BackupExecVSSProvider*" OR CommandLine="*bedbg*" OR CommandLine="*BITS*" OR CommandLine="*BrokerInfrastructure*" OR CommandLine="*DCAgent*" OR CommandLine="*EhttpSrv*" OR CommandLine="*EhttpSry*" OR CommandLine="*ekrn*" OR CommandLine="*epag*" OR CommandLine="*EPIntegrationService*" OR CommandLine="*EPlntegrationService*" OR CommandLine="*EPProtectedService*" OR CommandLine="*EPRedline*" OR CommandLine="*EPSecurityService*" OR CommandLine="*EPUpdateService*" OR CommandLine="*EraserSvc11710*" OR CommandLine="*EsgShKernel*" OR CommandLine="*ESHASRV*" OR CommandLine="*FA_Scheduler*" OR CommandLine="*HealthTLService*" OR CommandLine="*HISSQLFDLauncherSSHAREPOINIT*" OR CommandLine="*HMS*" OR CommandLine="*IISAdmin*" OR CommandLine="*IMANSVC*" OR CommandLine="*IMAP4Svc*" OR CommandLine="*KAVFS*" OR CommandLine="*KAVFSGT*" OR CommandLine="*kavfsslp*" OR CommandLine="*klnagent*" OR CommandLine="*LogProcessorService*" OR CommandLine="*M8EndpointAgent*" OR CommandLine="*macmnsvc*" OR CommandLine="*masvc*" OR CommandLine="*MBAMService*" OR CommandLine="*MBEndpointAgent*" OR CommandLine="*McAfeeEngineService*" OR CommandLine="*MCAFEEEVENTPARSERSRV*" OR CommandLine="*McAfeeFramework*" OR CommandLine="*McAfeeFrameworkMcAfeeFramework*" OR CommandLine="*MCAFEETOMCATSRV530*" OR CommandLine="*McShield*" OR CommandLine="*McTaskManager*" OR CommandLine="*mfefire*" OR CommandLine="*mfemms*" OR CommandLine="*mfevto*" OR CommandLine="*mfevtp*" OR CommandLine="*mfewc*" OR CommandLine="*MMS*" OR CommandLine="*mozyprobackup*" OR CommandLine="*MsDtsServer*" OR CommandLine="*MsDtsServer100*" OR CommandLine="*MsDtsServer110*" OR CommandLine="*MsDtsServer130*" OR CommandLine="*MSExchangeES*" OR CommandLine="*MSExchangeIS*" OR CommandLine="*MSExchangeMGMT*" OR CommandLine="*MSExchangeMIA*" OR CommandLine="*MSExchangeMTA*" OR CommandLine="*MSExchangeSA*" OR CommandLine="*MSExchangeSRS*" OR CommandLine="*msftesq1SPROO*" OR CommandLine="*msftesql$PROD*" OR CommandLine="*MSOLAP$SQL_2008*" OR CommandLine="*MSOLAP$SYSTEM_BGC*" OR CommandLine="*MSOLAP$TPS*" OR CommandLine="*MSOLAP$TPSAMA*" OR CommandLine="*MSOLAPSTPS*" OR CommandLine="*MSOLAPSTPSAMA*" OR CommandLine="*MSSQ!I.SPROFXENGAGEMEHT*" OR CommandLine="*MSSQ0SHAREPOINT*" OR CommandLine="*MSSQ0SOPHOS*" OR CommandLine="*MSSQL$BKUPEXEC*" OR CommandLine="*MSSQL$ECWDB2*" OR CommandLine="*MSSQL$EPOSERVER*" OR CommandLine="*MSSQL$ITRIS*" OR CommandLine="*MSSQL$PRACTICEMGT*" OR CommandLine="*MSSQL$PRACTTICEBGC*" OR CommandLine="*MSSQL$PROD*" OR CommandLine="*MSSQL$PROFXENGAGEMENT*" OR CommandLine="*MSSQL$SBSMONITORING*" OR CommandLine="*MSSQL$SHAREPOINT*" OR CommandLine="*MSSQL$SOPHOS*" OR CommandLine="*MSSQL$SQL_2008*" OR CommandLine="*MSSQL$SQLEXPRESS*" OR CommandLine="*MSSQL$SYSTEM_BGC*" OR CommandLine="*MSSQL$TPS*" OR CommandLine="*MSSQL$TPSAMA*" OR CommandLine="*MSSQL$VEEAMSQL2008R2*" OR CommandLine="*MSSQL$VEEAMSQL2012*" OR CommandLine="*MSSQLFDLauncher*" OR CommandLine="*MSSQLFDLauncher$ITRIS*" OR CommandLine="*MSSQLFDLauncher$PROFXENGAGEMENT*" OR CommandLine="*MSSQLFDLauncher$S8SMONITORING*" OR CommandLine="*MSSQLFDLauncher$SBSMONITORING*" OR CommandLine="*MSSQLFDLauncher$SHAREPOINT*" OR CommandLine="*MSSQLFDLauncher$SQL_2008*" OR CommandLine="*MSSQLFDLauncher$SYSTEM_BGC*" OR CommandLine="*MSSQLFDLauncher$TPS*" OR CommandLine="*MSSQLFDLauncher$TPSAMA*" OR CommandLine="*MSSQLFDLauncherSPROFXENGAGEMENT*" OR CommandLine="*MSSQLFDLauncherSTPS*" OR CommandLine="*MSSQLFDLauncherSTPSAMA*" OR CommandLine="*MSSQLFOLauncherSSVSTEM_BGC*" OR CommandLine="*MSSQLFOLavocher*" OR CommandLine="*MSSQLLaunchpad$ITRIS*" OR CommandLine="*MSSQLSBKUPEXEC*" OR CommandLine="*MSSQLSECWDB2*" OR CommandLine="*MSSQLSERVER*" OR CommandLine="*MSSQLServerADHelper*" OR CommandLine="*MSSQLServerADHelper100*" OR CommandLine="*MSSQLServerOLAPService*" OR CommandLine="*mSSQLSFRACTICEMGT*" OR CommandLine="*MSSQLSPRACTTICEBGE*" OR CommandLine="*MSSQLSPROO*" OR CommandLine="*MSSQLSSBSMONITORIMG*" OR CommandLine="*MSSQLSSQL_2008*" OR CommandLine="*MSSQLSSQLEXPRESS*" OR CommandLine="*MSSQLSSVSTEM_BGC*" OR CommandLine="*MSSQLSTPS*" OR CommandLine="*MSSQLSTPSAMA*" OR CommandLine="*MSSQLSVEEAMSQL2012*" OR CommandLine="*MSSQLSVIEAMSQL2008112*" OR CommandLine="*MSSQLWEEAMSQL2008R2*" OR CommandLine="*MySQL57*" OR CommandLine="*MySQL80*" OR CommandLine="*MySQLS7*" OR CommandLine="*NetMsmqActivator*" OR CommandLine="*ntrtscan*" OR CommandLine="*OracleClientCache80*" OR CommandLine="*PDVFSService*" OR CommandLine="*POP3Svc*" OR CommandLine="*POVFSService*" OR CommandLine="*ReportServer*" OR CommandLine="*ReportServer$SQL_2008*" OR CommandLine="*ReportServer$SYSTEM_BGC*" OR CommandLine="*ReportServer$TPS*" OR CommandLine="*ReportServer$TPSAMA*" OR CommandLine="*RESvc*" OR CommandLine="*sacsvr*" OR CommandLine="*SamSs*" OR CommandLine="*SAVAdminService*" OR CommandLine="*SAVService*" OR CommandLine="*SDRSVC*" OR CommandLine="*SentinelAgent*" OR CommandLine="*SentinelHelperService*" OR CommandLine="*SepMasterService*" OR CommandLine="*ShMonitor*" OR CommandLine="*Smcinst*" OR CommandLine="*SmcService*" OR CommandLine="*SMTPSvc*" OR CommandLine="*SNAC*" OR CommandLine="*SntpService*" OR CommandLine="*sophossps*" OR CommandLine="*SQ1SafeOLRService*" OR CommandLine="*SQLAgent$BKUPEXEC*" OR CommandLine="*SQLAgent$CITRIX_METAFRAME*" OR CommandLine="*SQLAgent$CXDB*" OR CommandLine="*SQLAgent$ECWDB2*" OR CommandLine="*SQLAgent$EPOSERVER*" OR CommandLine="*SQLAgent$ITRIS*" OR CommandLine="*SQLAgent$PRACTTICEBGC*" OR CommandLine="*SQLAgent$PRACTTICEMGT*" OR CommandLine="*SQLAgent$PROD*" OR CommandLine="*SQLAgent$PROFXENGAGEMENT*" OR CommandLine="*SQLAgent$SBSMONITORING*" OR CommandLine="*SQLAgent$SHAREPOINT*" OR CommandLine="*SQLAgent$SOPHOS*" OR CommandLine="*SQLAgent$SQL_2008*" OR CommandLine="*SQLAgent$SQLEXPRESS*" OR CommandLine="*SQLAgent$SVSTEM_BGC*" OR CommandLine="*SQLAgent$SYSTEM_BGC*" OR CommandLine="*SQLAgent$TPS*" OR CommandLine="*SQLAgent$TPSAMA*" OR CommandLine="*SQLAgent$VEEAMSQL2008R2*" OR CommandLine="*SQLAgent$VEEAMSQL2012*" OR CommandLine="*SQLAgentSCITRIX_METAFRAME*" OR CommandLine="*SQLAgentSCXDB*" OR CommandLine="*SQLAgentSPRACTTICEBGC*" OR CommandLine="*SQLAgentSPROO*" OR CommandLine="*SQLAgentSSBSMONITORING*" OR CommandLine="*SQLAgentSSQL EXPRESS*" OR CommandLine="*SQLAgentSTPS*" OR CommandLine="*SQLAgentSTPSAMA*" OR CommandLine="*SQLAgentSVEEAMSQL2008R2*" OR CommandLine="*SQLBrowser*" OR CommandLine="*SQLSafeOLRService*" OR CommandLine="*SQLSERVERAGENT*" OR CommandLine="*SQLTELEMETRY*" OR CommandLine="*SQLTELEMETRY$ECWDB2*" OR CommandLine="*SQLTELEMETRY$ITRIS*" OR CommandLine="*SQLWriter*" OR CommandLine="*SSISTELEMETRY130*" OR CommandLine="*SstpSvc*" OR CommandLine="*svcGenericHost*" OR CommandLine="*svcienericHost*" OR CommandLine="*swi_filter*" OR CommandLine="*swi_service*" OR CommandLine="*swi_update*" OR CommandLine="*swi_update_64*" OR CommandLine="*Telemetryserver*" OR CommandLine="*ThreatLockerService*" OR CommandLine="*TmCCSF*" OR CommandLine="*tmlisten*" OR CommandLine="*TmPfw*" OR CommandLine="*TrueKey*" OR CommandLine="*TruekeyScheduler*" OR CommandLine="*TrueKeyServiceHelper*" OR CommandLine="*UI0Detect*" OR CommandLine="*UTODetect*" OR CommandLine="*VeeamBackupSvc*" OR CommandLine="*VeeamBrokerSvc*" OR CommandLine="*VeeamCatalogSvc*" OR CommandLine="*VeeamCloudSvc*" OR CommandLine="*VeeamDeploymentService*" OR CommandLine="*VeeamDeploySvc*" OR CommandLine="*VeeamEnterpriseHanagerSvc*" OR CommandLine="*VeeamEnterpriseManagerSvc*" OR CommandLine="*VeeamHvIntegrationSvc*" OR CommandLine="*VeeamMountSvc*" OR CommandLine="*VeeamNFSSvc*" OR CommandLine="*VeeamRESTSvc*" OR CommandLine="*VeeamRISTSvc*" OR CommandLine="*VeeamTransportSvc*" OR CommandLine="*VeemaDep/oySvc*" OR CommandLine="*VSS*" OR CommandLine="*W3Svc*" OR CommandLine="*wbengine*" OR CommandLine="*WdNisSvc*" OR CommandLine="*WeanClOudSve*" OR CommandLine="*Weems JY*" OR CommandLine="*WinDefend*" OR CommandLine="*wozyprobackup*" OR CommandLine="*WRSVC*") (((((OriginalFileName="sc.exe" OR OriginalFileName="net.exe" OR OriginalFileName="net1.exe") OR (Image="*\\sc.exe" OR Image="*\\net.exe" OR Image="*\\net1.exe")) CommandLine="* stop *")) OR (((Image="*\\powershell.exe" OR Image="*\\pwsh.exe") CommandLine="*Stop-Service *"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1489" | eval sigma_title="Suspicious Stop Windows Service" | eval sigma_description="Detects the usage of one of the the commands to stop services such as 'net', 'sc'...etc in order to stop critical or important windows services such as AV, Backup...etc. As seen being used in some ransomware scripts"
dispatch.earliest_time = -24h@h
alert.track = 0

[Serv-U Exploitation CVE-2021-35211 by DEV-0322 - winevent]
description = Detects patterns as noticed in exploitation of Serv-U CVE-2021-35211 vulnerability by threat group DEV-0322
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) Process_Command_Line="*whoami*" ((Process_Command_Line="*./Client/Common/*" OR Process_Command_Line="*.\\Client\\Common\\*") OR Process_Command_Line="*C:\\Windows\\Temp\\Serv-U.bat*"))) | eval sigma_attack_tags="attack.persistence attack.t1136.001 cve.2021.35211" | eval sigma_title="Serv-U Exploitation CVE-2021-35211 by DEV-0322" | eval sigma_description="Detects patterns as noticed in exploitation of Serv-U CVE-2021-35211 vulnerability by threat group DEV-0322"
dispatch.earliest_time = -24h@h
alert.track = 0

[Serv-U Exploitation CVE-2021-35211 by DEV-0322 - sysmon]
description = Detects patterns as noticed in exploitation of Serv-U CVE-2021-35211 vulnerability by threat group DEV-0322
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) CommandLine="*whoami*" ((CommandLine="*./Client/Common/*" OR CommandLine="*.\\Client\\Common\\*") OR CommandLine="*C:\\Windows\\Temp\\Serv-U.bat*"))) | eval sigma_attack_tags="attack.persistence attack.t1136.001 cve.2021.35211" | eval sigma_title="Serv-U Exploitation CVE-2021-35211 by DEV-0322" | eval sigma_description="Detects patterns as noticed in exploitation of Serv-U CVE-2021-35211 vulnerability by threat group DEV-0322"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Serv-U Process Pattern - winevent]
description = Detects a suspicious process pattern which could be a sign of an exploited Serv-U service
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Creator_Process_Name="*\\Serv-U.exe" (New_Process_Name="*\\cmd.exe" OR New_Process_Name="*\\powershell.exe" OR New_Process_Name="*\\pwsh.exe" OR New_Process_Name="*\\wscript.exe" OR New_Process_Name="*\\cscript.exe" OR New_Process_Name="*\\sh.exe" OR New_Process_Name="*\\bash.exe" OR New_Process_Name="*\\schtasks.exe" OR New_Process_Name="*\\regsvr32.exe" OR New_Process_Name="*\\wmic.exe" OR New_Process_Name="*\\mshta.exe" OR New_Process_Name="*\\rundll32.exe" OR New_Process_Name="*\\msiexec.exe" OR New_Process_Name="*\\forfiles.exe" OR New_Process_Name="*\\scriptrunner.exe"))) | eval sigma_attack_tags="attack.credential_access attack.t1555 cve.2021.35211" | eval sigma_title="Suspicious Serv-U Process Pattern" | eval sigma_description="Detects a suspicious process pattern which could be a sign of an exploited Serv-U service"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Serv-U Process Pattern - sysmon]
description = Detects a suspicious process pattern which could be a sign of an exploited Serv-U service
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") ParentImage="*\\Serv-U.exe" (Image="*\\cmd.exe" OR Image="*\\powershell.exe" OR Image="*\\pwsh.exe" OR Image="*\\wscript.exe" OR Image="*\\cscript.exe" OR Image="*\\sh.exe" OR Image="*\\bash.exe" OR Image="*\\schtasks.exe" OR Image="*\\regsvr32.exe" OR Image="*\\wmic.exe" OR Image="*\\mshta.exe" OR Image="*\\rundll32.exe" OR Image="*\\msiexec.exe" OR Image="*\\forfiles.exe" OR Image="*\\scriptrunner.exe"))) | eval sigma_attack_tags="attack.credential_access attack.t1555 cve.2021.35211" | eval sigma_title="Suspicious Serv-U Process Pattern" | eval sigma_description="Detects a suspicious process pattern which could be a sign of an exploited Serv-U service"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Shells Spawn by Java Utility Keytool - winevent]
description = Detects suspicious shell spawn from Java utility keytool process (e.g. adselfservice plus exploitation)
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Creator_Process_Name="*\\keytool.exe" (New_Process_Name="*\\cmd.exe" OR New_Process_Name="*\\sh.exe" OR New_Process_Name="*\\bash.exe" OR New_Process_Name="*\\powershell.exe" OR New_Process_Name="*\\pwsh.exe" OR New_Process_Name="*\\schtasks.exe" OR New_Process_Name="*\\certutil.exe" OR New_Process_Name="*\\whoami.exe" OR New_Process_Name="*\\bitsadmin.exe" OR New_Process_Name="*\\wscript.exe" OR New_Process_Name="*\\cscript.exe" OR New_Process_Name="*\\scrcons.exe" OR New_Process_Name="*\\regsvr32.exe" OR New_Process_Name="*\\hh.exe" OR New_Process_Name="*\\wmic.exe" OR New_Process_Name="*\\mshta.exe" OR New_Process_Name="*\\rundll32.exe" OR New_Process_Name="*\\forfiles.exe" OR New_Process_Name="*\\scriptrunner.exe" OR New_Process_Name="*\\mftrace.exe" OR New_Process_Name="*\\AppVLP.exe" OR New_Process_Name="*\\systeminfo.exe" OR New_Process_Name="*\\reg.exe" OR New_Process_Name="*\\query.exe"))) | eval sigma_attack_tags="attack.initial_access attack.persistence attack.privilege_escalation" | eval sigma_title="Suspicious Shells Spawn by Java Utility Keytool" | eval sigma_description="Detects suspicious shell spawn from Java utility keytool process (e.g. adselfservice plus exploitation)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Shells Spawn by Java Utility Keytool - sysmon]
description = Detects suspicious shell spawn from Java utility keytool process (e.g. adselfservice plus exploitation)
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") ParentImage="*\\keytool.exe" (Image="*\\cmd.exe" OR Image="*\\sh.exe" OR Image="*\\bash.exe" OR Image="*\\powershell.exe" OR Image="*\\pwsh.exe" OR Image="*\\schtasks.exe" OR Image="*\\certutil.exe" OR Image="*\\whoami.exe" OR Image="*\\bitsadmin.exe" OR Image="*\\wscript.exe" OR Image="*\\cscript.exe" OR Image="*\\scrcons.exe" OR Image="*\\regsvr32.exe" OR Image="*\\hh.exe" OR Image="*\\wmic.exe" OR Image="*\\mshta.exe" OR Image="*\\rundll32.exe" OR Image="*\\forfiles.exe" OR Image="*\\scriptrunner.exe" OR Image="*\\mftrace.exe" OR Image="*\\AppVLP.exe" OR Image="*\\systeminfo.exe" OR Image="*\\reg.exe" OR Image="*\\query.exe"))) | eval sigma_attack_tags="attack.initial_access attack.persistence attack.privilege_escalation" | eval sigma_title="Suspicious Shells Spawn by Java Utility Keytool" | eval sigma_description="Detects suspicious shell spawn from Java utility keytool process (e.g. adselfservice plus exploitation)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Shells Spawned by Java - winevent]
description = Detects suspicious shell spawned from Java host process (e.g. log4j exploitation)
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Creator_Process_Name="*\\java.exe" (New_Process_Name="*\\sh.exe" OR New_Process_Name="*\\bash.exe" OR New_Process_Name="*\\powershell.exe" OR New_Process_Name="*\\pwsh.exe" OR New_Process_Name="*\\schtasks.exe" OR New_Process_Name="*\\certutil.exe" OR New_Process_Name="*\\whoami.exe" OR New_Process_Name="*\\bitsadmin.exe" OR New_Process_Name="*\\wscript.exe" OR New_Process_Name="*\\cscript.exe" OR New_Process_Name="*\\scrcons.exe" OR New_Process_Name="*\\regsvr32.exe" OR New_Process_Name="*\\hh.exe" OR New_Process_Name="*\\wmic.exe" OR New_Process_Name="*\\mshta.exe" OR New_Process_Name="*\\rundll32.exe" OR New_Process_Name="*\\forfiles.exe" OR New_Process_Name="*\\scriptrunner.exe" OR New_Process_Name="*\\mftrace.exe" OR New_Process_Name="*\\AppVLP.exe" OR New_Process_Name="*\\curl.exe" OR New_Process_Name="*\\systeminfo.exe" OR New_Process_Name="*\\net.exe" OR New_Process_Name="*\\net1.exe" OR New_Process_Name="*\\reg.exe" OR New_Process_Name="*\\query.exe"))) | eval sigma_attack_tags="attack.initial_access attack.persistence attack.privilege_escalation" | eval sigma_title="Suspicious Shells Spawned by Java" | eval sigma_description="Detects suspicious shell spawned from Java host process (e.g. log4j exploitation)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Shells Spawned by Java - sysmon]
description = Detects suspicious shell spawned from Java host process (e.g. log4j exploitation)
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") ParentImage="*\\java.exe" (Image="*\\sh.exe" OR Image="*\\bash.exe" OR Image="*\\powershell.exe" OR Image="*\\pwsh.exe" OR Image="*\\schtasks.exe" OR Image="*\\certutil.exe" OR Image="*\\whoami.exe" OR Image="*\\bitsadmin.exe" OR Image="*\\wscript.exe" OR Image="*\\cscript.exe" OR Image="*\\scrcons.exe" OR Image="*\\regsvr32.exe" OR Image="*\\hh.exe" OR Image="*\\wmic.exe" OR Image="*\\mshta.exe" OR Image="*\\rundll32.exe" OR Image="*\\forfiles.exe" OR Image="*\\scriptrunner.exe" OR Image="*\\mftrace.exe" OR Image="*\\AppVLP.exe" OR Image="*\\curl.exe" OR Image="*\\systeminfo.exe" OR Image="*\\net.exe" OR Image="*\\net1.exe" OR Image="*\\reg.exe" OR Image="*\\query.exe"))) | eval sigma_attack_tags="attack.initial_access attack.persistence attack.privilege_escalation" | eval sigma_title="Suspicious Shells Spawned by Java" | eval sigma_description="Detects suspicious shell spawned from Java host process (e.g. log4j exploitation)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Shells Spawn by SQL Server - winevent]
description = Detects suspicious shell spawn from MSSQL process, this might be sight of RCE or SQL Injection
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((Creator_Process_Name="*\\sqlservr.exe" (New_Process_Name="*\\cmd.exe" OR New_Process_Name="*\\sh.exe" OR New_Process_Name="*\\bash.exe" OR New_Process_Name="*\\powershell.exe" OR New_Process_Name="*\\pwsh.exe" OR New_Process_Name="*\\bitsadmin.exe" OR New_Process_Name="*\\systeminfo.exe"))) NOT (((Creator_Process_Name="C:\\Program Files\\Microsoft SQL Server\\*" Creator_Process_Name="*DATEV_DBENGINE\\MSSQL\\Binn\\sqlservr.exe" New_Process_Name="C:\\Windows\\System32\\cmd.exe" Process_Command_Line="\"C:\\Windows\\system32\\cmd.exe\" *"))))) | eval sigma_attack_tags="attack.t1505.003 attack.t1190 attack.initial_access attack.persistence attack.privilege_escalation" | eval sigma_title="Suspicious Shells Spawn by SQL Server" | eval sigma_description="Detects suspicious shell spawn from MSSQL process, this might be sight of RCE or SQL Injection"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Shells Spawn by SQL Server - sysmon]
description = Detects suspicious shell spawn from MSSQL process, this might be sight of RCE or SQL Injection
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((ParentImage="*\\sqlservr.exe" (Image="*\\cmd.exe" OR Image="*\\sh.exe" OR Image="*\\bash.exe" OR Image="*\\powershell.exe" OR Image="*\\pwsh.exe" OR Image="*\\bitsadmin.exe" OR Image="*\\systeminfo.exe"))) NOT (((ParentImage="C:\\Program Files\\Microsoft SQL Server\\*" ParentImage="*DATEV_DBENGINE\\MSSQL\\Binn\\sqlservr.exe" Image="C:\\Windows\\System32\\cmd.exe" CommandLine="\"C:\\Windows\\system32\\cmd.exe\" *"))))) | eval sigma_attack_tags="attack.t1505.003 attack.t1190 attack.initial_access attack.persistence attack.privilege_escalation" | eval sigma_title="Suspicious Shells Spawn by SQL Server" | eval sigma_description="Detects suspicious shell spawn from MSSQL process, this might be sight of RCE or SQL Injection"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Processes Spawned by WinRM - winevent]
description = Detects suspicious processes including shells spawnd from WinRM host process
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Creator_Process_Name="*\\wsmprovhost.exe" (New_Process_Name="*\\cmd.exe" OR New_Process_Name="*\\sh.exe" OR New_Process_Name="*\\bash.exe" OR New_Process_Name="*\\powershell.exe" OR New_Process_Name="*\\pwsh.exe" OR New_Process_Name="*\\wsl.exe" OR New_Process_Name="*\\schtasks.exe" OR New_Process_Name="*\\certutil.exe" OR New_Process_Name="*\\whoami.exe" OR New_Process_Name="*\\bitsadmin.exe"))) | eval sigma_attack_tags="attack.t1190 attack.initial_access attack.persistence attack.privilege_escalation" | eval sigma_title="Suspicious Processes Spawned by WinRM" | eval sigma_description="Detects suspicious processes including shells spawnd from WinRM host process"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Processes Spawned by WinRM - sysmon]
description = Detects suspicious processes including shells spawnd from WinRM host process
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") ParentImage="*\\wsmprovhost.exe" (Image="*\\cmd.exe" OR Image="*\\sh.exe" OR Image="*\\bash.exe" OR Image="*\\powershell.exe" OR Image="*\\pwsh.exe" OR Image="*\\wsl.exe" OR Image="*\\schtasks.exe" OR Image="*\\certutil.exe" OR Image="*\\whoami.exe" OR Image="*\\bitsadmin.exe"))) | eval sigma_attack_tags="attack.t1190 attack.initial_access attack.persistence attack.privilege_escalation" | eval sigma_title="Suspicious Processes Spawned by WinRM" | eval sigma_description="Detects suspicious processes including shells spawnd from WinRM host process"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Usage Of ShellExec_RunDLL - winevent]
description = Detects suspicious usage of the ShellExec_RunDLL function to launch other commands as seen in the the raspberry-robin attack
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*ShellExec_RunDLL*" (Process_Command_Line="*regsvr32*" OR Process_Command_Line="*msiexec*" OR Process_Command_Line="*\\Users\\Public\\*" OR Process_Command_Line="*odbcconf*" OR Process_Command_Line="*\\Desktop\\*" OR Process_Command_Line="*\\Temp\\*" OR Process_Command_Line="*Invoke-*" OR Process_Command_Line="*iex*" OR Process_Command_Line="*comspec*"))) | eval sigma_attack_tags="attack.defense_evasion" | eval sigma_title="Suspicious Usage Of ShellExec_RunDLL" | eval sigma_description="Detects suspicious usage of the ShellExec_RunDLL function to launch other commands as seen in the the raspberry-robin attack"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Usage Of ShellExec_RunDLL - sysmon]
description = Detects suspicious usage of the ShellExec_RunDLL function to launch other commands as seen in the the raspberry-robin attack
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*ShellExec_RunDLL*" (CommandLine="*regsvr32*" OR CommandLine="*msiexec*" OR CommandLine="*\\Users\\Public\\*" OR CommandLine="*odbcconf*" OR CommandLine="*\\Desktop\\*" OR CommandLine="*\\Temp\\*" OR CommandLine="*Invoke-*" OR CommandLine="*iex*" OR CommandLine="*comspec*"))) | eval sigma_attack_tags="attack.defense_evasion" | eval sigma_title="Suspicious Usage Of ShellExec_RunDLL" | eval sigma_description="Detects suspicious usage of the ShellExec_RunDLL function to launch other commands as seen in the the raspberry-robin attack"
dispatch.earliest_time = -24h@h
alert.track = 0

[ShimCache Flush - winevent]
description = Detects actions that clear the local ShimCache and remove forensic evidence
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((Process_Command_Line="*rundll32*" Process_Command_Line="*apphelp.dll*" (Process_Command_Line="*ShimFlushCache*" OR Process_Command_Line="*#250*"))) OR ((Process_Command_Line="*rundll32*" Process_Command_Line="*kernel32.dll*" (Process_Command_Line="*BaseFlushAppcompatCache*" OR Process_Command_Line="*#46*")))))) | table New_Process_Name,Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.t1112" | eval sigma_title="ShimCache Flush" | eval sigma_description="Detects actions that clear the local ShimCache and remove forensic evidence"
dispatch.earliest_time = -24h@h
alert.track = 0

[ShimCache Flush - sysmon]
description = Detects actions that clear the local ShimCache and remove forensic evidence
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((CommandLine="*rundll32*" CommandLine="*apphelp.dll*" (CommandLine="*ShimFlushCache*" OR CommandLine="*#250*"))) OR ((CommandLine="*rundll32*" CommandLine="*kernel32.dll*" (CommandLine="*BaseFlushAppcompatCache*" OR CommandLine="*#46*")))))) | table Image,CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.t1112" | eval sigma_title="ShimCache Flush" | eval sigma_description="Detects actions that clear the local ShimCache and remove forensic evidence"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Execution of Shutdown - winevent]
description = Use of the commandline to shutdown or reboot windows
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\shutdown.exe" (Process_Command_Line="*/r *" OR Process_Command_Line="*/s *"))) | eval sigma_attack_tags="attack.impact attack.t1529" | eval sigma_title="Suspicious Execution of Shutdown" | eval sigma_description="Use of the commandline to shutdown or reboot windows"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Execution of Shutdown - sysmon]
description = Use of the commandline to shutdown or reboot windows
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\shutdown.exe" (CommandLine="*/r *" OR CommandLine="*/s *"))) | eval sigma_attack_tags="attack.impact attack.t1529" | eval sigma_title="Suspicious Execution of Shutdown" | eval sigma_description="Use of the commandline to shutdown or reboot windows"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Splwow64 Without Params - winevent]
description = Detects suspicious Splwow64.exe process without any command line parameters
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\splwow64.exe" Process_Command_Line="*splwow64.exe")) | eval sigma_attack_tags="attack.defense_evasion attack.t1202" | eval sigma_title="Suspicious Splwow64 Without Params" | eval sigma_description="Detects suspicious Splwow64.exe process without any command line parameters"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Splwow64 Without Params - sysmon]
description = Detects suspicious Splwow64.exe process without any command line parameters
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\splwow64.exe" CommandLine="*splwow64.exe")) | eval sigma_attack_tags="attack.defense_evasion attack.t1202" | eval sigma_title="Suspicious Splwow64 Without Params" | eval sigma_description="Detects suspicious Splwow64.exe process without any command line parameters"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Spool Service Child Process - winevent]
description = Detects suspicious print spool service (spoolsv.exe) child processes.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((Creator_Process_Name="*\\spoolsv.exe" IntegrityLevel="System")) ((((((New_Process_Name="*\\gpupdate.exe" OR New_Process_Name="*\\whoami.exe" OR New_Process_Name="*\\nltest.exe" OR New_Process_Name="*\\taskkill.exe" OR New_Process_Name="*\\wmic.exe" OR New_Process_Name="*\\taskmgr.exe" OR New_Process_Name="*\\sc.exe" OR New_Process_Name="*\\findstr.exe" OR New_Process_Name="*\\curl.exe" OR New_Process_Name="*\\wget.exe" OR New_Process_Name="*\\certutil.exe" OR New_Process_Name="*\\bitsadmin.exe" OR New_Process_Name="*\\accesschk.exe" OR New_Process_Name="*\\wevtutil.exe" OR New_Process_Name="*\\bcdedit.exe" OR New_Process_Name="*\\fsutil.exe" OR New_Process_Name="*\\cipher.exe" OR New_Process_Name="*\\schtasks.exe" OR New_Process_Name="*\\write.exe" OR New_Process_Name="*\\wuauclt.exe" OR New_Process_Name="*\\systeminfo.exe" OR New_Process_Name="*\\reg.exe" OR New_Process_Name="*\\query.exe") OR (((New_Process_Name="*\\net.exe" OR New_Process_Name="*\\net1.exe") NOT ((Process_Command_Line="*start*"))))) OR ((New_Process_Name="*\\cmd.exe" NOT (((Process_Command_Line="*.spl*" OR Process_Command_Line="*route add*" OR Process_Command_Line="*program files*")))))) OR ((New_Process_Name="*\\netsh.exe" NOT (((Process_Command_Line="*add portopening*" OR Process_Command_Line="*rule name*")))))) OR (((New_Process_Name="*\\powershell.exe" OR New_Process_Name="*\\pwsh.exe") NOT ((Process_Command_Line="*.spl*"))))) OR ((New_Process_Name="*\\rundll32.exe" Process_Command_Line="*rundll32.exe"))))) | table New_Process_Name,Process_Command_Line | eval sigma_attack_tags="attack.execution attack.t1203 attack.privilege_escalation attack.t1068" | eval sigma_title="Suspicious Spool Service Child Process" | eval sigma_description="Detects suspicious print spool service (spoolsv.exe) child processes."
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Spool Service Child Process - sysmon]
description = Detects suspicious print spool service (spoolsv.exe) child processes.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((ParentImage="*\\spoolsv.exe" IntegrityLevel="System")) ((((((Image="*\\gpupdate.exe" OR Image="*\\whoami.exe" OR Image="*\\nltest.exe" OR Image="*\\taskkill.exe" OR Image="*\\wmic.exe" OR Image="*\\taskmgr.exe" OR Image="*\\sc.exe" OR Image="*\\findstr.exe" OR Image="*\\curl.exe" OR Image="*\\wget.exe" OR Image="*\\certutil.exe" OR Image="*\\bitsadmin.exe" OR Image="*\\accesschk.exe" OR Image="*\\wevtutil.exe" OR Image="*\\bcdedit.exe" OR Image="*\\fsutil.exe" OR Image="*\\cipher.exe" OR Image="*\\schtasks.exe" OR Image="*\\write.exe" OR Image="*\\wuauclt.exe" OR Image="*\\systeminfo.exe" OR Image="*\\reg.exe" OR Image="*\\query.exe") OR (((Image="*\\net.exe" OR Image="*\\net1.exe") NOT ((CommandLine="*start*"))))) OR ((Image="*\\cmd.exe" NOT (((CommandLine="*.spl*" OR CommandLine="*route add*" OR CommandLine="*program files*")))))) OR ((Image="*\\netsh.exe" NOT (((CommandLine="*add portopening*" OR CommandLine="*rule name*")))))) OR (((Image="*\\powershell.exe" OR Image="*\\pwsh.exe") NOT ((CommandLine="*.spl*"))))) OR ((Image="*\\rundll32.exe" CommandLine="*rundll32.exe"))))) | table Image,CommandLine | eval sigma_attack_tags="attack.execution attack.t1203 attack.privilege_escalation attack.t1068" | eval sigma_title="Suspicious Spool Service Child Process" | eval sigma_description="Detects suspicious print spool service (spoolsv.exe) child processes."
dispatch.earliest_time = -24h@h
alert.track = 0

[Squirrel Lolbin - winevent]
description = Detects Possible Squirrel Packages Manager as Lolbin
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\update.exe" Process_Command_Line="*.exe*" (Process_Command_Line="*--processStart*" OR Process_Command_Line="*--processStartAndWait*" OR Process_Command_Line="*--createShortcut*"))) NOT ((((Process_Command_Line="*C:\\Users\\*" Process_Command_Line="*\\AppData\\Local\\Discord\\Update.exe*" Process_Command_Line="* --processStart*" Process_Command_Line="*Discord.exe*"))) OR (((Process_Command_Line="*C:\\Users\\*" Process_Command_Line="*\\AppData\\Local\\GitHubDesktop\\Update.exe*" Process_Command_Line="*GitHubDesktop.exe*") (Process_Command_Line="*--createShortcut*" OR Process_Command_Line="*--processStartAndWait*"))) OR (((Process_Command_Line="*C:\\Users\\*" Process_Command_Line="*\\AppData\\Local\\Microsoft\\Teams\\Update.exe*" Process_Command_Line="*Teams.exe*") (Process_Command_Line="*--processStart*" OR Process_Command_Line="*--createShortcut*")))))) | eval sigma_attack_tags="attack.execution attack.defense_evasion attack.t1218" | eval sigma_title="Squirrel Lolbin" | eval sigma_description="Detects Possible Squirrel Packages Manager as Lolbin"
dispatch.earliest_time = -24h@h
alert.track = 0

[Squirrel Lolbin - sysmon]
description = Detects Possible Squirrel Packages Manager as Lolbin
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\update.exe" CommandLine="*.exe*" (CommandLine="*--processStart*" OR CommandLine="*--processStartAndWait*" OR CommandLine="*--createShortcut*"))) NOT ((((CommandLine="*C:\\Users\\*" CommandLine="*\\AppData\\Local\\Discord\\Update.exe*" CommandLine="* --processStart*" CommandLine="*Discord.exe*"))) OR (((CommandLine="*C:\\Users\\*" CommandLine="*\\AppData\\Local\\GitHubDesktop\\Update.exe*" CommandLine="*GitHubDesktop.exe*") (CommandLine="*--createShortcut*" OR CommandLine="*--processStartAndWait*"))) OR (((CommandLine="*C:\\Users\\*" CommandLine="*\\AppData\\Local\\Microsoft\\Teams\\Update.exe*" CommandLine="*Teams.exe*") (CommandLine="*--processStart*" OR CommandLine="*--createShortcut*")))))) | eval sigma_attack_tags="attack.execution attack.defense_evasion attack.t1218" | eval sigma_title="Squirrel Lolbin" | eval sigma_description="Detects Possible Squirrel Packages Manager as Lolbin"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspect Svchost Activity - winevent]
description = It is extremely abnormal for svchost.exe to spawn without any CLI arguments and is normally observed when a malicious process spawns the process and injects code into the process memory space.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((Process_Command_Line="*svchost.exe" New_Process_Name="*\\svchost.exe")) NOT (((Creator_Process_Name="*\\rpcnet.exe" OR Creator_Process_Name="*\\rpcnetp.exe")) OR (NOT Process_Command_Line="*")))) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.privilege_escalation attack.t1055" | eval sigma_title="Suspect Svchost Activity" | eval sigma_description="It is extremely abnormal for svchost.exe to spawn without any CLI arguments and is normally observed when a malicious process spawns the process and injects code into the process memory space."
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspect Svchost Activity - sysmon]
description = It is extremely abnormal for svchost.exe to spawn without any CLI arguments and is normally observed when a malicious process spawns the process and injects code into the process memory space.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((CommandLine="*svchost.exe" Image="*\\svchost.exe")) NOT (((ParentImage="*\\rpcnet.exe" OR ParentImage="*\\rpcnetp.exe")) OR (NOT CommandLine="*")))) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.privilege_escalation attack.t1055" | eval sigma_title="Suspect Svchost Activity" | eval sigma_description="It is extremely abnormal for svchost.exe to spawn without any CLI arguments and is normally observed when a malicious process spawns the process and injects code into the process memory space."
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Svchost Process - winevent]
description = Detects a suspicious svchost process start
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) New_Process_Name="*\\svchost.exe" NOT ((((Creator_Process_Name="*\\services.exe" OR Creator_Process_Name="*\\MsMpEng.exe" OR Creator_Process_Name="*\\Mrt.exe" OR Creator_Process_Name="*\\rpcnet.exe" OR Creator_Process_Name="*\\ngen.exe" OR Creator_Process_Name="*\\TiWorker.exe"))) OR ((NOT Creator_Process_Name="*")) OR ((Creator_Process_Name="")) OR ((Creator_Process_Name="-"))))) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.t1036.005" | eval sigma_title="Suspicious Svchost Process" | eval sigma_description="Detects a suspicious svchost process start"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Svchost Process - sysmon]
description = Detects a suspicious svchost process start
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) Image="*\\svchost.exe" NOT ((((ParentImage="*\\services.exe" OR ParentImage="*\\MsMpEng.exe" OR ParentImage="*\\Mrt.exe" OR ParentImage="*\\rpcnet.exe" OR ParentImage="*\\ngen.exe" OR ParentImage="*\\TiWorker.exe"))) OR ((NOT ParentImage="*")) OR ((ParentImage="")) OR ((ParentImage="-"))))) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.t1036.005" | eval sigma_title="Suspicious Svchost Process" | eval sigma_description="Detects a suspicious svchost process start"
dispatch.earliest_time = -24h@h
alert.track = 0

[Sysprep on AppData Folder - winevent]
description = Detects suspicious sysprep process start with AppData folder as target (as used by Trojan Syndicasec in Thrip report by Symantec)
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\sysprep.exe" Process_Command_Line="*\\AppData\\*")) | eval sigma_attack_tags="attack.execution attack.t1059" | eval sigma_title="Sysprep on AppData Folder" | eval sigma_description="Detects suspicious sysprep process start with AppData folder as target (as used by Trojan Syndicasec in Thrip report by Symantec)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Sysprep on AppData Folder - sysmon]
description = Detects suspicious sysprep process start with AppData folder as target (as used by Trojan Syndicasec in Thrip report by Symantec)
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\sysprep.exe" CommandLine="*\\AppData\\*")) | eval sigma_attack_tags="attack.execution attack.t1059" | eval sigma_title="Sysprep on AppData Folder" | eval sigma_description="Detects suspicious sysprep process start with AppData folder as target (as used by Trojan Syndicasec in Thrip report by Symantec)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious SYSTEM User Process Creation - winevent]
description = Detects a suspicious process creation as SYSTEM user (suspicious program or command line parameter)
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((((IntegrityLevel="System" (Account_Name="*AUTHORI*" OR Account_Name="*AUTORI*"))) ((New_Process_Name="*\\calc.exe" OR New_Process_Name="*\\wscript.exe" OR New_Process_Name="*\\cscript.exe" OR New_Process_Name="*\\hh.exe" OR New_Process_Name="*\\mshta.exe" OR New_Process_Name="*\\forfiles.exe" OR New_Process_Name="*\\ping.exe") OR (Process_Command_Line="* -NoP *" OR Process_Command_Line="* -W Hidden *" OR Process_Command_Line="* -decode *" OR Process_Command_Line="* /decode *" OR Process_Command_Line="* /urlcache *" OR Process_Command_Line="* -urlcache *" OR Process_Command_Line="* -e* JAB*" OR Process_Command_Line="* -e* SUVYI*" OR Process_Command_Line="* -e* SQBFAFgA*" OR Process_Command_Line="* -e* aWV4I*" OR Process_Command_Line="* -e* IAB*" OR Process_Command_Line="* -e* PAA*" OR Process_Command_Line="* -e* aQBlAHgA*" OR Process_Command_Line="*vssadmin delete shadows*" OR Process_Command_Line="*reg SAVE HKLM*" OR Process_Command_Line="* -ma *" OR Process_Command_Line="*Microsoft\\Windows\\CurrentVersion\\Run*" OR Process_Command_Line="*.downloadstring(*" OR Process_Command_Line="*.downloadfile(*" OR Process_Command_Line="* /ticket:*" OR Process_Command_Line="*dpapi::*" OR Process_Command_Line="*event::clear*" OR Process_Command_Line="*event::drop*" OR Process_Command_Line="*id::modify*" OR Process_Command_Line="*kerberos::*" OR Process_Command_Line="*lsadump::*" OR Process_Command_Line="*misc::*" OR Process_Command_Line="*privilege::*" OR Process_Command_Line="*rpc::*" OR Process_Command_Line="*sekurlsa::*" OR Process_Command_Line="*sid::*" OR Process_Command_Line="*token::*" OR Process_Command_Line="*vault::cred*" OR Process_Command_Line="*vault::list*" OR Process_Command_Line="* p::d *" OR Process_Command_Line="*;iex(*" OR Process_Command_Line="*MiniDump*" OR Process_Command_Line="*net user *")))) NOT (((Process_Command_Line="ping 127.0.0.1 -n 5")) OR ((New_Process_Name="*\\PING.EXE" ParentCommandLine="*\\DismFoDInstall.cmd*")) OR ((Creator_Process_Name="C:\\Packages\\Plugins\\Microsoft.GuestConfiguration.ConfigurationforWindows\\*")) OR ((Creator_Process_Name="C:\\Program Files (x86)\\Java\\*" Creator_Process_Name="*\\bin\\javaws.exe" New_Process_Name="C:\\Program Files (x86)\\Java\\*" New_Process_Name="*\\bin\\jp2launcher.exe" Process_Command_Line="* -ma *"))))) | eval sigma_attack_tags="" | eval sigma_title="Suspicious SYSTEM User Process Creation" | eval sigma_description="Detects a suspicious process creation as SYSTEM user (suspicious program or command line parameter)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious SYSTEM User Process Creation - sysmon]
description = Detects a suspicious process creation as SYSTEM user (suspicious program or command line parameter)
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((((IntegrityLevel="System" (User="*AUTHORI*" OR User="*AUTORI*"))) ((Image="*\\calc.exe" OR Image="*\\wscript.exe" OR Image="*\\cscript.exe" OR Image="*\\hh.exe" OR Image="*\\mshta.exe" OR Image="*\\forfiles.exe" OR Image="*\\ping.exe") OR (CommandLine="* -NoP *" OR CommandLine="* -W Hidden *" OR CommandLine="* -decode *" OR CommandLine="* /decode *" OR CommandLine="* /urlcache *" OR CommandLine="* -urlcache *" OR CommandLine="* -e* JAB*" OR CommandLine="* -e* SUVYI*" OR CommandLine="* -e* SQBFAFgA*" OR CommandLine="* -e* aWV4I*" OR CommandLine="* -e* IAB*" OR CommandLine="* -e* PAA*" OR CommandLine="* -e* aQBlAHgA*" OR CommandLine="*vssadmin delete shadows*" OR CommandLine="*reg SAVE HKLM*" OR CommandLine="* -ma *" OR CommandLine="*Microsoft\\Windows\\CurrentVersion\\Run*" OR CommandLine="*.downloadstring(*" OR CommandLine="*.downloadfile(*" OR CommandLine="* /ticket:*" OR CommandLine="*dpapi::*" OR CommandLine="*event::clear*" OR CommandLine="*event::drop*" OR CommandLine="*id::modify*" OR CommandLine="*kerberos::*" OR CommandLine="*lsadump::*" OR CommandLine="*misc::*" OR CommandLine="*privilege::*" OR CommandLine="*rpc::*" OR CommandLine="*sekurlsa::*" OR CommandLine="*sid::*" OR CommandLine="*token::*" OR CommandLine="*vault::cred*" OR CommandLine="*vault::list*" OR CommandLine="* p::d *" OR CommandLine="*;iex(*" OR CommandLine="*MiniDump*" OR CommandLine="*net user *")))) NOT (((CommandLine="ping 127.0.0.1 -n 5")) OR ((Image="*\\PING.EXE" ParentCommandLine="*\\DismFoDInstall.cmd*")) OR ((ParentImage="C:\\Packages\\Plugins\\Microsoft.GuestConfiguration.ConfigurationforWindows\\*")) OR ((ParentImage="C:\\Program Files (x86)\\Java\\*" ParentImage="*\\bin\\javaws.exe" Image="C:\\Program Files (x86)\\Java\\*" Image="*\\bin\\jp2launcher.exe" CommandLine="* -ma *"))))) | eval sigma_attack_tags="" | eval sigma_title="Suspicious SYSTEM User Process Creation" | eval sigma_description="Detects a suspicious process creation as SYSTEM user (suspicious program or command line parameter)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious SYSVOL Domain Group Policy Access - winevent]
description = Detects Access to Domain Group Policies stored in SYSVOL
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*\\SYSVOL\\*" Process_Command_Line="*\\policies\\*")) | eval sigma_attack_tags="attack.credential_access attack.t1552.006" | eval sigma_title="Suspicious SYSVOL Domain Group Policy Access" | eval sigma_description="Detects Access to Domain Group Policies stored in SYSVOL"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious SYSVOL Domain Group Policy Access - sysmon]
description = Detects Access to Domain Group Policies stored in SYSVOL
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*\\SYSVOL\\*" CommandLine="*\\policies\\*")) | eval sigma_attack_tags="attack.credential_access attack.t1552.006" | eval sigma_title="Suspicious SYSVOL Domain Group Policy Access" | eval sigma_description="Detects Access to Domain Group Policies stored in SYSVOL"
dispatch.earliest_time = -24h@h
alert.track = 0

[Shell32 DLL Execution in Suspicious Directory - winevent]
description = Detects shell32.dll executing a DLL in a suspicious directory
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\rundll32.exe" Process_Command_Line="*shell32.dll*" Process_Command_Line="*Control_RunDLL*" (Process_Command_Line="*%AppData%*" OR Process_Command_Line="*%LocalAppData%*" OR Process_Command_Line="*%Temp%*" OR Process_Command_Line="*%tmp%*" OR Process_Command_Line="*\\AppData\\*" OR Process_Command_Line="*\\Temp\\*" OR Process_Command_Line="*\\Users\\Public\\*"))) | eval sigma_attack_tags="attack.defense_evasion attack.execution attack.t1218.011" | eval sigma_title="Shell32 DLL Execution in Suspicious Directory" | eval sigma_description="Detects shell32.dll executing a DLL in a suspicious directory"
dispatch.earliest_time = -24h@h
alert.track = 0

[Shell32 DLL Execution in Suspicious Directory - sysmon]
description = Detects shell32.dll executing a DLL in a suspicious directory
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\rundll32.exe" CommandLine="*shell32.dll*" CommandLine="*Control_RunDLL*" (CommandLine="*%AppData%*" OR CommandLine="*%LocalAppData%*" OR CommandLine="*%Temp%*" OR CommandLine="*%tmp%*" OR CommandLine="*\\AppData\\*" OR CommandLine="*\\Temp\\*" OR CommandLine="*\\Users\\Public\\*"))) | eval sigma_attack_tags="attack.defense_evasion attack.execution attack.t1218.011" | eval sigma_title="Shell32 DLL Execution in Suspicious Directory" | eval sigma_description="Detects shell32.dll executing a DLL in a suspicious directory"
dispatch.earliest_time = -24h@h
alert.track = 0

[Taskmgr as LOCAL_SYSTEM - winevent]
description = Detects the creation of taskmgr.exe process in context of LOCAL_SYSTEM
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (Account_Name="*AUTHORI*" OR Account_Name="*AUTORI*") New_Process_Name="*\\taskmgr.exe")) | eval sigma_attack_tags="attack.defense_evasion attack.t1036" | eval sigma_title="Taskmgr as LOCAL_SYSTEM" | eval sigma_description="Detects the creation of taskmgr.exe process in context of LOCAL_SYSTEM"
dispatch.earliest_time = -24h@h
alert.track = 0

[Taskmgr as LOCAL_SYSTEM - sysmon]
description = Detects the creation of taskmgr.exe process in context of LOCAL_SYSTEM
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (User="*AUTHORI*" OR User="*AUTORI*") Image="*\\taskmgr.exe")) | eval sigma_attack_tags="attack.defense_evasion attack.t1036" | eval sigma_title="Taskmgr as LOCAL_SYSTEM" | eval sigma_description="Detects the creation of taskmgr.exe process in context of LOCAL_SYSTEM"
dispatch.earliest_time = -24h@h
alert.track = 0

[Taskmgr as Parent - winevent]
description = Detects the creation of a process from Windows task manager
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) Creator_Process_Name="*\\taskmgr.exe" NOT (((New_Process_Name="*\\resmon.exe" OR New_Process_Name="*\\mmc.exe" OR New_Process_Name="*\\taskmgr.exe"))))) | table New_Process_Name,Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.t1036" | eval sigma_title="Taskmgr as Parent" | eval sigma_description="Detects the creation of a process from Windows task manager"
dispatch.earliest_time = -24h@h
alert.track = 0

[Taskmgr as Parent - sysmon]
description = Detects the creation of a process from Windows task manager
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ParentImage="*\\taskmgr.exe" NOT (((Image="*\\resmon.exe" OR Image="*\\mmc.exe" OR Image="*\\taskmgr.exe"))))) | table Image,CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.t1036" | eval sigma_title="Taskmgr as Parent" | eval sigma_description="Detects the creation of a process from Windows task manager"
dispatch.earliest_time = -24h@h
alert.track = 0

[Process Access via TrolleyExpress Exclusion - winevent]
description = Detects a possible process memory dump that uses the white-listed Citrix TrolleyExpress.exe filename as a way to dump the lsass process memory
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((Process_Command_Line="*\\TrolleyExpress 7*" OR Process_Command_Line="*\\TrolleyExpress 8*" OR Process_Command_Line="*\\TrolleyExpress 9*" OR Process_Command_Line="*\\TrolleyExpress.exe 7*" OR Process_Command_Line="*\\TrolleyExpress.exe 8*" OR Process_Command_Line="*\\TrolleyExpress.exe 9*" OR Process_Command_Line="*\\TrolleyExpress.exe -ma *") OR ((New_Process_Name="*\\TrolleyExpress.exe" NOT (((OriginalFileName="*CtxInstall*")) OR ((NOT OriginalFileName="*")))))))) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.t1218.011 attack.credential_access attack.t1003.001" | eval sigma_title="Process Access via TrolleyExpress Exclusion" | eval sigma_description="Detects a possible process memory dump that uses the white-listed Citrix TrolleyExpress.exe filename as a way to dump the lsass process memory"
dispatch.earliest_time = -24h@h
alert.track = 0

[Process Access via TrolleyExpress Exclusion - sysmon]
description = Detects a possible process memory dump that uses the white-listed Citrix TrolleyExpress.exe filename as a way to dump the lsass process memory
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((CommandLine="*\\TrolleyExpress 7*" OR CommandLine="*\\TrolleyExpress 8*" OR CommandLine="*\\TrolleyExpress 9*" OR CommandLine="*\\TrolleyExpress.exe 7*" OR CommandLine="*\\TrolleyExpress.exe 8*" OR CommandLine="*\\TrolleyExpress.exe 9*" OR CommandLine="*\\TrolleyExpress.exe -ma *") OR ((Image="*\\TrolleyExpress.exe" NOT (((OriginalFileName="*CtxInstall*")) OR ((NOT OriginalFileName="*")))))))) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.t1218.011 attack.credential_access attack.t1003.001" | eval sigma_title="Process Access via TrolleyExpress Exclusion" | eval sigma_description="Detects a possible process memory dump that uses the white-listed Citrix TrolleyExpress.exe filename as a way to dump the lsass process memory"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious TSCON Start as SYSTEM - winevent]
description = Detects a tscon.exe start as LOCAL SYSTEM
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (Account_Name="*AUTHORI*" OR Account_Name="*AUTORI*") New_Process_Name="*\\tscon.exe")) | eval sigma_attack_tags="attack.command_and_control attack.t1219" | eval sigma_title="Suspicious TSCON Start as SYSTEM" | eval sigma_description="Detects a tscon.exe start as LOCAL SYSTEM"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious TSCON Start as SYSTEM - sysmon]
description = Detects a tscon.exe start as LOCAL SYSTEM
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (User="*AUTHORI*" OR User="*AUTORI*") Image="*\\tscon.exe")) | eval sigma_attack_tags="attack.command_and_control attack.t1219" | eval sigma_title="Suspicious TSCON Start as SYSTEM" | eval sigma_description="Detects a tscon.exe start as LOCAL SYSTEM"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious RDP Redirect Using TSCON - winevent]
description = Detects a suspicious RDP session redirect using tscon.exe
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="* /dest:rdp-tcp:*")) | eval sigma_attack_tags="attack.lateral_movement attack.t1563.002 attack.t1021.001 car.2013-07-002" | eval sigma_title="Suspicious RDP Redirect Using TSCON" | eval sigma_description="Detects a suspicious RDP session redirect using tscon.exe"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious RDP Redirect Using TSCON - sysmon]
description = Detects a suspicious RDP session redirect using tscon.exe
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="* /dest:rdp-tcp:*")) | eval sigma_attack_tags="attack.lateral_movement attack.t1563.002 attack.t1021.001 car.2013-07-002" | eval sigma_title="Suspicious RDP Redirect Using TSCON" | eval sigma_description="Detects a suspicious RDP session redirect using tscon.exe"
dispatch.earliest_time = -24h@h
alert.track = 0

[TrustedPath UAC Bypass Pattern - winevent]
description = Detects indicators of a UAC bypass method by mocking directories
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*C:\\Windows \\System32\\*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1548.002" | eval sigma_title="TrustedPath UAC Bypass Pattern" | eval sigma_description="Detects indicators of a UAC bypass method by mocking directories"
dispatch.earliest_time = -24h@h
alert.track = 0

[TrustedPath UAC Bypass Pattern - sysmon]
description = Detects indicators of a UAC bypass method by mocking directories
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*C:\\Windows \\System32\\*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1548.002" | eval sigma_title="TrustedPath UAC Bypass Pattern" | eval sigma_description="Detects indicators of a UAC bypass method by mocking directories"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Use of CSharp Interactive Console - winevent]
description = Detects the execution of CSharp interactive console by PowerShell
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\csi.exe" (Creator_Process_Name="*\\powershell.exe" OR Creator_Process_Name="*\\pwsh.exe" OR Creator_Process_Name="*\\powershell_ise.exe") OriginalFileName="csi.exe")) | eval sigma_attack_tags="attack.execution attack.t1127" | eval sigma_title="Suspicious Use of CSharp Interactive Console" | eval sigma_description="Detects the execution of CSharp interactive console by PowerShell"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Use of CSharp Interactive Console - sysmon]
description = Detects the execution of CSharp interactive console by PowerShell
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\csi.exe" (ParentImage="*\\powershell.exe" OR ParentImage="*\\pwsh.exe" OR ParentImage="*\\powershell_ise.exe") OriginalFileName="csi.exe")) | eval sigma_attack_tags="attack.execution attack.t1127" | eval sigma_title="Suspicious Use of CSharp Interactive Console" | eval sigma_description="Detects the execution of CSharp interactive console by PowerShell"
dispatch.earliest_time = -24h@h
alert.track = 0

[Detection of PowerShell Execution via Sqlps.exe - winevent]
description = This rule detects execution of a PowerShell code through the sqlps.exe utility, which is included in the standard set of utilities supplied with the MSSQL Server.
Script blocks are not logged in this case, so this utility helps to bypass protection mechanisms based on the analysis of these logs.

search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (Creator_Process_Name="*\\sqlps.exe" OR (((New_Process_Name="*\\sqlps.exe" OR OriginalFileName="sqlps.exe") NOT ((Creator_Process_Name="*\\sqlagent.exe"))))))) | eval sigma_attack_tags="attack.execution attack.t1059.001 attack.defense_evasion attack.t1127" | eval sigma_title="Detection of PowerShell Execution via Sqlps.exe" | eval sigma_description="This rule detects execution of a PowerShell code through the sqlps.exe utility, which is included in the standard set of utilities supplied with the MSSQL Server.
Script blocks are not logged in this case, so this utility helps to bypass protection mechanisms based on the analysis of these logs.
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Detection of PowerShell Execution via Sqlps.exe - sysmon]
description = This rule detects execution of a PowerShell code through the sqlps.exe utility, which is included in the standard set of utilities supplied with the MSSQL Server.
Script blocks are not logged in this case, so this utility helps to bypass protection mechanisms based on the analysis of these logs.

search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (ParentImage="*\\sqlps.exe" OR (((Image="*\\sqlps.exe" OR OriginalFileName="sqlps.exe") NOT ((ParentImage="*\\sqlagent.exe"))))))) | eval sigma_attack_tags="attack.execution attack.t1059.001 attack.defense_evasion attack.t1127" | eval sigma_title="Detection of PowerShell Execution via Sqlps.exe" | eval sigma_description="This rule detects execution of a PowerShell code through the sqlps.exe utility, which is included in the standard set of utilities supplied with the MSSQL Server.
Script blocks are not logged in this case, so this utility helps to bypass protection mechanisms based on the analysis of these logs.
"
dispatch.earliest_time = -24h@h
alert.track = 0

[SQL Client Tools PowerShell Session Detection - winevent]
description = This rule detects execution of a PowerShell code through the sqltoolsps.exe utility, which is included in the standard set of utilities supplied with the Microsoft SQL Server Management studio.
Script blocks are not logged in this case, so this utility helps to bypass protection mechanisms based on the analysis of these logs.

search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\sqltoolsps.exe" OR Creator_Process_Name="*\\sqltoolsps.exe" OR OriginalFileName="\\sqltoolsps.exe") NOT ((Creator_Process_Name="*\\smss.exe")))) | eval sigma_attack_tags="attack.execution attack.t1059.001 attack.defense_evasion attack.t1127" | eval sigma_title="SQL Client Tools PowerShell Session Detection" | eval sigma_description="This rule detects execution of a PowerShell code through the sqltoolsps.exe utility, which is included in the standard set of utilities supplied with the Microsoft SQL Server Management studio.
Script blocks are not logged in this case, so this utility helps to bypass protection mechanisms based on the analysis of these logs.
"
dispatch.earliest_time = -24h@h
alert.track = 0

[SQL Client Tools PowerShell Session Detection - sysmon]
description = This rule detects execution of a PowerShell code through the sqltoolsps.exe utility, which is included in the standard set of utilities supplied with the Microsoft SQL Server Management studio.
Script blocks are not logged in this case, so this utility helps to bypass protection mechanisms based on the analysis of these logs.

search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\sqltoolsps.exe" OR ParentImage="*\\sqltoolsps.exe" OR OriginalFileName="\\sqltoolsps.exe") NOT ((ParentImage="*\\smss.exe")))) | eval sigma_attack_tags="attack.execution attack.t1059.001 attack.defense_evasion attack.t1127" | eval sigma_title="SQL Client Tools PowerShell Session Detection" | eval sigma_description="This rule detects execution of a PowerShell code through the sqltoolsps.exe utility, which is included in the standard set of utilities supplied with the Microsoft SQL Server Management studio.
Script blocks are not logged in this case, so this utility helps to bypass protection mechanisms based on the analysis of these logs.
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Malicious Windows Script Components File Execution by TAEF Detection - winevent]
description = Windows Test Authoring and Execution Framework (TAEF) framework allows you to run automation by executing tests files written on different languages (C, C#, Microsoft COM Scripting interfaces
Adversaries may execute malicious code (such as WSC file with VBScript, dll and so on) directly by running te.exe

search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\te.exe" OR Creator_Process_Name="*\\te.exe" OR OriginalFileName="\\te.exe"))) | eval sigma_attack_tags="attack.t1218" | eval sigma_title="Malicious Windows Script Components File Execution by TAEF Detection" | eval sigma_description="Windows Test Authoring and Execution Framework (TAEF) framework allows you to run automation by executing tests files written on different languages (C, C#, Microsoft COM Scripting interfaces
Adversaries may execute malicious code (such as WSC file with VBScript, dll and so on) directly by running te.exe
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Malicious Windows Script Components File Execution by TAEF Detection - sysmon]
description = Windows Test Authoring and Execution Framework (TAEF) framework allows you to run automation by executing tests files written on different languages (C, C#, Microsoft COM Scripting interfaces
Adversaries may execute malicious code (such as WSC file with VBScript, dll and so on) directly by running te.exe

search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\te.exe" OR ParentImage="*\\te.exe" OR OriginalFileName="\\te.exe"))) | eval sigma_attack_tags="attack.t1218" | eval sigma_title="Malicious Windows Script Components File Execution by TAEF Detection" | eval sigma_description="Windows Test Authoring and Execution Framework (TAEF) framework allows you to run automation by executing tests files written on different languages (C, C#, Microsoft COM Scripting interfaces
Adversaries may execute malicious code (such as WSC file with VBScript, dll and so on) directly by running te.exe
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Malicious PE Execution by Microsoft Visual Studio Debugger - winevent]
description = There is an option for a MS VS Just-In-Time Debugger 'vsjitdebugger.exe' to launch specified executable and attach a debugger.
This option may be used adversaries to execute malicious code by signed verified binary.
The debugger is installed alongside with Microsoft Visual Studio package.

search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) Creator_Process_Name="*\\vsjitdebugger.exe" NOT ((New_Process_Name="*\\vsimmersiveactivatehelper*.exe" OR New_Process_Name="*\\devenv.exe")))) | eval sigma_attack_tags="attack.t1218 attack.defense_evasion" | eval sigma_title="Malicious PE Execution by Microsoft Visual Studio Debugger" | eval sigma_description="There is an option for a MS VS Just-In-Time Debugger 'vsjitdebugger.exe' to launch specified executable and attach a debugger.
This option may be used adversaries to execute malicious code by signed verified binary.
The debugger is installed alongside with Microsoft Visual Studio package.
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Malicious PE Execution by Microsoft Visual Studio Debugger - sysmon]
description = There is an option for a MS VS Just-In-Time Debugger 'vsjitdebugger.exe' to launch specified executable and attach a debugger.
This option may be used adversaries to execute malicious code by signed verified binary.
The debugger is installed alongside with Microsoft Visual Studio package.

search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ParentImage="*\\vsjitdebugger.exe" NOT ((Image="*\\vsimmersiveactivatehelper*.exe" OR Image="*\\devenv.exe")))) | eval sigma_attack_tags="attack.t1218 attack.defense_evasion" | eval sigma_title="Malicious PE Execution by Microsoft Visual Studio Debugger" | eval sigma_description="There is an option for a MS VS Just-In-Time Debugger 'vsjitdebugger.exe' to launch specified executable and attach a debugger.
This option may be used adversaries to execute malicious code by signed verified binary.
The debugger is installed alongside with Microsoft Visual Studio package.
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Userinit Child Process - winevent]
description = Detects a suspicious child process of userinit
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) Creator_Process_Name="*\\userinit.exe" NOT (((Process_Command_Line="*\\netlogon\\*")) OR ((New_Process_Name="*\\explorer.exe") OR (OriginalFileName="explorer.exe"))))) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.t1055" | eval sigma_title="Suspicious Userinit Child Process" | eval sigma_description="Detects a suspicious child process of userinit"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Userinit Child Process - sysmon]
description = Detects a suspicious child process of userinit
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ParentImage="*\\userinit.exe" NOT (((CommandLine="*\\netlogon\\*")) OR ((Image="*\\explorer.exe") OR (OriginalFileName="explorer.exe"))))) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.t1055" | eval sigma_title="Suspicious Userinit Child Process" | eval sigma_description="Detects a suspicious child process of userinit"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious VBoxDrvInst.exe Parameters - winevent]
description = Detect VBoxDrvInst.exe run with parameters allowing processing INF file.
This allows to create values in the registry and install drivers.
For example one could use this technique to obtain persistence via modifying one of Run or RunOnce registry keys

search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\VBoxDrvInst.exe" Process_Command_Line="*driver*" Process_Command_Line="*executeinf*")) | table ComputerName,Account_Name,Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.t1112" | eval sigma_title="Suspicious VBoxDrvInst.exe Parameters" | eval sigma_description="Detect VBoxDrvInst.exe run with parameters allowing processing INF file.
This allows to create values in the registry and install drivers.
For example one could use this technique to obtain persistence via modifying one of Run or RunOnce registry keys
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious VBoxDrvInst.exe Parameters - sysmon]
description = Detect VBoxDrvInst.exe run with parameters allowing processing INF file.
This allows to create values in the registry and install drivers.
For example one could use this technique to obtain persistence via modifying one of Run or RunOnce registry keys

search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\VBoxDrvInst.exe" CommandLine="*driver*" CommandLine="*executeinf*")) | table ComputerName,User,CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.t1112" | eval sigma_title="Suspicious VBoxDrvInst.exe Parameters" | eval sigma_description="Detect VBoxDrvInst.exe run with parameters allowing processing INF file.
This allows to create values in the registry and install drivers.
For example one could use this technique to obtain persistence via modifying one of Run or RunOnce registry keys
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious VBScript UN2452 Pattern - winevent]
description = Detects suspicious inline VBScript keywords as used by UNC2452
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((Process_Command_Line="*Execute*" Process_Command_Line="*CreateObject*" Process_Command_Line="*RegRead*" Process_Command_Line="*window.close*" Process_Command_Line="*\\Microsoft\\Windows\\CurrentVersion*")) NOT ((Process_Command_Line="*\\Software\\Microsoft\\Windows\\CurrentVersion\\Run*")))) | eval sigma_attack_tags="attack.persistence attack.t1547.001" | eval sigma_title="Suspicious VBScript UN2452 Pattern" | eval sigma_description="Detects suspicious inline VBScript keywords as used by UNC2452"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious VBScript UN2452 Pattern - sysmon]
description = Detects suspicious inline VBScript keywords as used by UNC2452
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((CommandLine="*Execute*" CommandLine="*CreateObject*" CommandLine="*RegRead*" CommandLine="*window.close*" CommandLine="*\\Microsoft\\Windows\\CurrentVersion*")) NOT ((CommandLine="*\\Software\\Microsoft\\Windows\\CurrentVersion\\Run*")))) | eval sigma_attack_tags="attack.persistence attack.t1547.001" | eval sigma_title="Suspicious VBScript UN2452 Pattern" | eval sigma_description="Detects suspicious inline VBScript keywords as used by UNC2452"
dispatch.earliest_time = -24h@h
alert.track = 0

[Disabled Volume Snapshots - winevent]
description = Detects commands that temporarily turn off Volume Snapshots
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*reg*" Process_Command_Line="* add *" Process_Command_Line="*\\Services\\VSS\\Diag*" Process_Command_Line="*/d Disabled*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.001" | eval sigma_title="Disabled Volume Snapshots" | eval sigma_description="Detects commands that temporarily turn off Volume Snapshots"
dispatch.earliest_time = -24h@h
alert.track = 0

[Disabled Volume Snapshots - sysmon]
description = Detects commands that temporarily turn off Volume Snapshots
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*reg*" CommandLine="* add *" CommandLine="*\\Services\\VSS\\Diag*" CommandLine="*/d Disabled*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.001" | eval sigma_title="Disabled Volume Snapshots" | eval sigma_description="Detects commands that temporarily turn off Volume Snapshots"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Vsls-Agent Command With AgentExtensionPath Load - winevent]
description = Detects Microsoft Visual Studio vsls-agent.exe lolbin execution with a suspicious library load using the --agentExtensionPath parameter
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\vsls-agent.exe" Process_Command_Line="*--agentExtensionPath*")) NOT ((Process_Command_Line="*Microsoft.VisualStudio.LiveShare.Agent.*")))) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.t1218" | eval sigma_title="Suspicious Vsls-Agent Command With AgentExtensionPath Load" | eval sigma_description="Detects Microsoft Visual Studio vsls-agent.exe lolbin execution with a suspicious library load using the --agentExtensionPath parameter"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Vsls-Agent Command With AgentExtensionPath Load - sysmon]
description = Detects Microsoft Visual Studio vsls-agent.exe lolbin execution with a suspicious library load using the --agentExtensionPath parameter
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\vsls-agent.exe" CommandLine="*--agentExtensionPath*")) NOT ((CommandLine="*Microsoft.VisualStudio.LiveShare.Agent.*")))) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.t1218" | eval sigma_title="Suspicious Vsls-Agent Command With AgentExtensionPath Load" | eval sigma_description="Detects Microsoft Visual Studio vsls-agent.exe lolbin execution with a suspicious library load using the --agentExtensionPath parameter"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious SysAidServer Child - winevent]
description = Detects suspicious child processes of SysAidServer (as seen in MERCURY threat actor intrusions)
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (Creator_Process_Name="*\\java.exe" OR Creator_Process_Name="*\\javaw.exe") ParentCommandLine="*SysAidServer*")) | eval sigma_attack_tags="" | eval sigma_title="Suspicious SysAidServer Child" | eval sigma_description="Detects suspicious child processes of SysAidServer (as seen in MERCURY threat actor intrusions)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious SysAidServer Child - sysmon]
description = Detects suspicious child processes of SysAidServer (as seen in MERCURY threat actor intrusions)
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (ParentImage="*\\java.exe" OR ParentImage="*\\javaw.exe") ParentCommandLine="*SysAidServer*")) | eval sigma_attack_tags="" | eval sigma_title="Suspicious SysAidServer Child" | eval sigma_description="Detects suspicious child processes of SysAidServer (as seen in MERCURY threat actor intrusions)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious WebDav Client Execution - winevent]
description = A General detection for svchost.exe spawning rundll32.exe with command arguments like C:\windows\system32\davclnt.dll,DavSetCookie.
This could be an indicator of exfiltration or use of WebDav to launch code (hosted on WebDav Server).

search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\rundll32.exe" OR OriginalFileName="RUNDLL32.EXE") Process_Command_Line="*C:\\windows\\system32\\davclnt.dll,DavSetCookie*")) | eval sigma_attack_tags="attack.exfiltration attack.t1048.003" | eval sigma_title="Suspicious WebDav Client Execution" | eval sigma_description="A General detection for svchost.exe spawning rundll32.exe with command arguments like C:\windows\system32\davclnt.dll,DavSetCookie.
This could be an indicator of exfiltration or use of WebDav to launch code (hosted on WebDav Server).
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious WebDav Client Execution - sysmon]
description = A General detection for svchost.exe spawning rundll32.exe with command arguments like C:\windows\system32\davclnt.dll,DavSetCookie.
This could be an indicator of exfiltration or use of WebDav to launch code (hosted on WebDav Server).

search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\rundll32.exe" OR OriginalFileName="RUNDLL32.EXE") CommandLine="*C:\\windows\\system32\\davclnt.dll,DavSetCookie*")) | eval sigma_attack_tags="attack.exfiltration attack.t1048.003" | eval sigma_title="Suspicious WebDav Client Execution" | eval sigma_description="A General detection for svchost.exe spawning rundll32.exe with command arguments like C:\windows\system32\davclnt.dll,DavSetCookie.
This could be an indicator of exfiltration or use of WebDav to launch code (hosted on WebDav Server).
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious WERMGR Process Patterns - winevent]
description = Detects suspicious Windows Error Reporting manager (wermgr.exe) process patterns - suspicious parents / children, execution folders, command lines etc.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((Creator_Process_Name="*\\wermgr.exe" (New_Process_Name="*\\nslookup.exe" OR New_Process_Name="*\\ipconfig.exe" OR New_Process_Name="*\\net.exe" OR New_Process_Name="*\\net1.exe" OR New_Process_Name="*\\whoami.exe" OR New_Process_Name="*\\netstat.exe" OR New_Process_Name="*\\systeminfo.exe" OR New_Process_Name="*\\cmd.exe" OR New_Process_Name="*\\powershell.exe"))) OR ((New_Process_Name="*\\wermgr.exe" NOT (((New_Process_Name="*C:\\Windows\\System32\\*" OR New_Process_Name="*C:\\Windows\\SysWOW64\\*")))))))) | eval sigma_attack_tags="" | eval sigma_title="Suspicious WERMGR Process Patterns" | eval sigma_description="Detects suspicious Windows Error Reporting manager (wermgr.exe) process patterns - suspicious parents / children, execution folders, command lines etc."
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious WERMGR Process Patterns - sysmon]
description = Detects suspicious Windows Error Reporting manager (wermgr.exe) process patterns - suspicious parents / children, execution folders, command lines etc.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((ParentImage="*\\wermgr.exe" (Image="*\\nslookup.exe" OR Image="*\\ipconfig.exe" OR Image="*\\net.exe" OR Image="*\\net1.exe" OR Image="*\\whoami.exe" OR Image="*\\netstat.exe" OR Image="*\\systeminfo.exe" OR Image="*\\cmd.exe" OR Image="*\\powershell.exe"))) OR ((Image="*\\wermgr.exe" NOT (((Image="*C:\\Windows\\System32\\*" OR Image="*C:\\Windows\\SysWOW64\\*")))))))) | eval sigma_attack_tags="" | eval sigma_title="Suspicious WERMGR Process Patterns" | eval sigma_description="Detects suspicious Windows Error Reporting manager (wermgr.exe) process patterns - suspicious parents / children, execution folders, command lines etc."
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Where Execution - winevent]
description = Adversaries may enumerate browser bookmarks to learn more about compromised hosts.
Browser bookmarks may reveal personal information about users (ex: banking sites, interests, social media, etc.) as well as details about
internal network resources such as servers, tools/dashboards, or other related infrastructure.

search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\where.exe" OR OriginalFileName="where.exe") (Process_Command_Line="*places.sqlite*" OR Process_Command_Line="*cookies.sqlite*" OR Process_Command_Line="*formhistory.sqlite*" OR Process_Command_Line="*logins.json*" OR Process_Command_Line="*key4.db*" OR Process_Command_Line="*key3.db*" OR Process_Command_Line="*sessionstore.jsonlz4*" OR Process_Command_Line="*History*" OR Process_Command_Line="*Bookmarks*" OR Process_Command_Line="*Cookies*" OR Process_Command_Line="*Login Data*"))) | eval sigma_attack_tags="attack.discovery attack.t1217" | eval sigma_title="Suspicious Where Execution" | eval sigma_description="Adversaries may enumerate browser bookmarks to learn more about compromised hosts.
Browser bookmarks may reveal personal information about users (ex: banking sites, interests, social media, etc.) as well as details about
internal network resources such as servers, tools/dashboards, or other related infrastructure.
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Where Execution - sysmon]
description = Adversaries may enumerate browser bookmarks to learn more about compromised hosts.
Browser bookmarks may reveal personal information about users (ex: banking sites, interests, social media, etc.) as well as details about
internal network resources such as servers, tools/dashboards, or other related infrastructure.

search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\where.exe" OR OriginalFileName="where.exe") (CommandLine="*places.sqlite*" OR CommandLine="*cookies.sqlite*" OR CommandLine="*formhistory.sqlite*" OR CommandLine="*logins.json*" OR CommandLine="*key4.db*" OR CommandLine="*key3.db*" OR CommandLine="*sessionstore.jsonlz4*" OR CommandLine="*History*" OR CommandLine="*Bookmarks*" OR CommandLine="*Cookies*" OR CommandLine="*Login Data*"))) | eval sigma_attack_tags="attack.discovery attack.t1217" | eval sigma_title="Suspicious Where Execution" | eval sigma_description="Adversaries may enumerate browser bookmarks to learn more about compromised hosts.
Browser bookmarks may reveal personal information about users (ex: banking sites, interests, social media, etc.) as well as details about
internal network resources such as servers, tools/dashboards, or other related infrastructure.
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Whoami Execution Anomaly - winevent]
description = Detects the execution of whoami with suspicious parents or parameters
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((((New_Process_Name="*\\whoami.exe" OR OriginalFileName="whoami.exe") NOT ((((Creator_Process_Name="*\\cmd.exe" OR Creator_Process_Name="*\\powershell.exe" OR Creator_Process_Name="*\\pwsh.exe" OR Creator_Process_Name="*\\powershell_ise.exe"))) OR (((Creator_Process_Name="C:\\Program Files\\Microsoft Monitoring Agent\\Agent\\MonitoringHost.exe" OR Creator_Process_Name=""))) OR ((NOT Creator_Process_Name="*"))))) OR (Process_Command_Line="*whoami -all*" OR Process_Command_Line="*whoami /all*" OR Process_Command_Line="*whoami.exe -all*" OR Process_Command_Line="*whoami.exe /all*" OR Process_Command_Line="*whoami.exe >*" OR Process_Command_Line="*whoami >*")))) | eval sigma_attack_tags="attack.discovery attack.t1033 car.2016-03-001" | eval sigma_title="Whoami Execution Anomaly" | eval sigma_description="Detects the execution of whoami with suspicious parents or parameters"
dispatch.earliest_time = -24h@h
alert.track = 0

[Whoami Execution Anomaly - sysmon]
description = Detects the execution of whoami with suspicious parents or parameters
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((((Image="*\\whoami.exe" OR OriginalFileName="whoami.exe") NOT ((((ParentImage="*\\cmd.exe" OR ParentImage="*\\powershell.exe" OR ParentImage="*\\pwsh.exe" OR ParentImage="*\\powershell_ise.exe"))) OR (((ParentImage="C:\\Program Files\\Microsoft Monitoring Agent\\Agent\\MonitoringHost.exe" OR ParentImage=""))) OR ((NOT ParentImage="*"))))) OR (CommandLine="*whoami -all*" OR CommandLine="*whoami /all*" OR CommandLine="*whoami.exe -all*" OR CommandLine="*whoami.exe /all*" OR CommandLine="*whoami.exe >*" OR CommandLine="*whoami >*")))) | eval sigma_attack_tags="attack.discovery attack.t1033 car.2016-03-001" | eval sigma_title="Whoami Execution Anomaly" | eval sigma_description="Detects the execution of whoami with suspicious parents or parameters"
dispatch.earliest_time = -24h@h
alert.track = 0

[WhoAmI as Parameter - winevent]
description = Detects a suspicious process command line that uses whoami as first parameter (as e.g. used by EfsPotato)
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*.exe whoami*")) | eval sigma_attack_tags="attack.discovery attack.t1033 car.2016-03-001" | eval sigma_title="WhoAmI as Parameter" | eval sigma_description="Detects a suspicious process command line that uses whoami as first parameter (as e.g. used by EfsPotato)"
dispatch.earliest_time = -24h@h
alert.track = 0

[WhoAmI as Parameter - sysmon]
description = Detects a suspicious process command line that uses whoami as first parameter (as e.g. used by EfsPotato)
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*.exe whoami*")) | eval sigma_attack_tags="attack.discovery attack.t1033 car.2016-03-001" | eval sigma_title="WhoAmI as Parameter" | eval sigma_description="Detects a suspicious process command line that uses whoami as first parameter (as e.g. used by EfsPotato)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Whoami Execution - winevent]
description = Detects the execution of whoami, which is often used by attackers after exploitation / privilege escalation but rarely used by administrators
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\whoami.exe" OR OriginalFileName="whoami.exe"))) | eval sigma_attack_tags="attack.discovery attack.t1033 car.2016-03-001" | eval sigma_title="Whoami Execution" | eval sigma_description="Detects the execution of whoami, which is often used by attackers after exploitation / privilege escalation but rarely used by administrators"
dispatch.earliest_time = -24h@h
alert.track = 0

[Whoami Execution - sysmon]
description = Detects the execution of whoami, which is often used by attackers after exploitation / privilege escalation but rarely used by administrators
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\whoami.exe" OR OriginalFileName="whoami.exe"))) | eval sigma_attack_tags="attack.discovery attack.t1033 car.2016-03-001" | eval sigma_title="Whoami Execution" | eval sigma_description="Detects the execution of whoami, which is often used by attackers after exploitation / privilege escalation but rarely used by administrators"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential Exploitation Attempt Of Undocumented WindowsServer RCE - winevent]
description = Detects potential exploitation attempt of undocumented Windows Server Pre Auth Remote Code Execution (RCE)
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Creator_Process_Name="*\\svchost.exe" New_Process_Name="*\\svchost.exe" ParentCommandLine="*-k DHCPServer*" Process_Command_Line="*-k DHCPServer*" (Account_Name="*NETWORK SERVICE*" OR Account_Name="*NETZWERKDIENST*" OR Account_Name="*SERVIZIO DI RETE*" OR Account_Name="*SERVICIO DE RED*"))) | eval sigma_attack_tags="" | eval sigma_title="Potential Exploitation Attempt Of Undocumented WindowsServer RCE" | eval sigma_description="Detects potential exploitation attempt of undocumented Windows Server Pre Auth Remote Code Execution (RCE)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential Exploitation Attempt Of Undocumented WindowsServer RCE - sysmon]
description = Detects potential exploitation attempt of undocumented Windows Server Pre Auth Remote Code Execution (RCE)
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") ParentImage="*\\svchost.exe" Image="*\\svchost.exe" ParentCommandLine="*-k DHCPServer*" CommandLine="*-k DHCPServer*" (User="*NETWORK SERVICE*" OR User="*NETZWERKDIENST*" OR User="*SERVIZIO DI RETE*" OR User="*SERVICIO DE RED*"))) | eval sigma_attack_tags="" | eval sigma_title="Potential Exploitation Attempt Of Undocumented WindowsServer RCE" | eval sigma_description="Detects potential exploitation attempt of undocumented Windows Server Pre Auth Remote Code Execution (RCE)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Winrar Compressing Dump Files - winevent]
description = Detects a suspicious winrar execution that involves a file with a .dmp extension, which could be a step in a process of dump file exfiltration
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\rar.exe" OR New_Process_Name="*\\winrar.exe") OR Description="Command line RAR") Process_Command_Line="*.dmp*")) | eval sigma_attack_tags="attack.collection attack.t1560.001" | eval sigma_title="Winrar Compressing Dump Files" | eval sigma_description="Detects a suspicious winrar execution that involves a file with a .dmp extension, which could be a step in a process of dump file exfiltration"
dispatch.earliest_time = -24h@h
alert.track = 0

[Winrar Compressing Dump Files - sysmon]
description = Detects a suspicious winrar execution that involves a file with a .dmp extension, which could be a step in a process of dump file exfiltration
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\rar.exe" OR Image="*\\winrar.exe") OR Description="Command line RAR") CommandLine="*.dmp*")) | eval sigma_attack_tags="attack.collection attack.t1560.001" | eval sigma_title="Winrar Compressing Dump Files" | eval sigma_description="Detects a suspicious winrar execution that involves a file with a .dmp extension, which could be a step in a process of dump file exfiltration"
dispatch.earliest_time = -24h@h
alert.track = 0

[Winrar Execution in Non-Standard Folder - winevent]
description = Detects a suspicious winrar execution in a folder which is not the default installation folder
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\rar.exe" OR New_Process_Name="*\\winrar.exe") OR Description="Command line RAR") NOT (((New_Process_Name="*\\WinRAR*" OR New_Process_Name="*C:\\Windows\\Temp*" OR New_Process_Name="*\\UnRAR.exe*"))))) | eval sigma_attack_tags="attack.collection attack.t1560.001" | eval sigma_title="Winrar Execution in Non-Standard Folder" | eval sigma_description="Detects a suspicious winrar execution in a folder which is not the default installation folder"
dispatch.earliest_time = -24h@h
alert.track = 0

[Winrar Execution in Non-Standard Folder - sysmon]
description = Detects a suspicious winrar execution in a folder which is not the default installation folder
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\rar.exe" OR Image="*\\winrar.exe") OR Description="Command line RAR") NOT (((Image="*\\WinRAR*" OR Image="*C:\\Windows\\Temp*" OR Image="*\\UnRAR.exe*"))))) | eval sigma_attack_tags="attack.collection attack.t1560.001" | eval sigma_title="Winrar Execution in Non-Standard Folder" | eval sigma_description="Detects a suspicious winrar execution in a folder which is not the default installation folder"
dispatch.earliest_time = -24h@h
alert.track = 0

[AWL Bypass with Winrm.vbs and Malicious WsmPty.xsl/WsmTxt.xsl - winevent]
description = Detects execution of attacker-controlled WsmPty.xsl or WsmTxt.xsl via winrm.vbs and copied cscript.exe (can be renamed)
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*winrm*" (Process_Command_Line="*format:pretty*" OR Process_Command_Line="*format:\"pretty\"*" OR Process_Command_Line="*format:\"text\"*" OR Process_Command_Line="*format:text*") NOT (((New_Process_Name="C:\\Windows\\System32\\*" OR New_Process_Name="C:\\Windows\\SysWOW64\\*"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1216" | eval sigma_title="AWL Bypass with Winrm.vbs and Malicious WsmPty.xsl/WsmTxt.xsl" | eval sigma_description="Detects execution of attacker-controlled WsmPty.xsl or WsmTxt.xsl via winrm.vbs and copied cscript.exe (can be renamed)"
dispatch.earliest_time = -24h@h
alert.track = 0

[AWL Bypass with Winrm.vbs and Malicious WsmPty.xsl/WsmTxt.xsl - sysmon]
description = Detects execution of attacker-controlled WsmPty.xsl or WsmTxt.xsl via winrm.vbs and copied cscript.exe (can be renamed)
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*winrm*" (CommandLine="*format:pretty*" OR CommandLine="*format:\"pretty\"*" OR CommandLine="*format:\"text\"*" OR CommandLine="*format:text*") NOT (((Image="C:\\Windows\\System32\\*" OR Image="C:\\Windows\\SysWOW64\\*"))))) | eval sigma_attack_tags="attack.defense_evasion attack.t1216" | eval sigma_title="AWL Bypass with Winrm.vbs and Malicious WsmPty.xsl/WsmTxt.xsl" | eval sigma_description="Detects execution of attacker-controlled WsmPty.xsl or WsmTxt.xsl via winrm.vbs and copied cscript.exe (can be renamed)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Remote Code Execute via Winrm.vbs - winevent]
description = Detects an attempt to execute code or create service on remote host via winrm.vbs.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\cscript.exe" OR OriginalFileName="cscript.exe") ((Process_Command_Line="*winrm*" Process_Command_Line="*invoke Create wmicimv2/Win32_*" Process_Command_Line="*-r:http*")))) | eval sigma_attack_tags="attack.defense_evasion attack.t1216" | eval sigma_title="Remote Code Execute via Winrm.vbs" | eval sigma_description="Detects an attempt to execute code or create service on remote host via winrm.vbs."
dispatch.earliest_time = -24h@h
alert.track = 0

[Remote Code Execute via Winrm.vbs - sysmon]
description = Detects an attempt to execute code or create service on remote host via winrm.vbs.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\cscript.exe" OR OriginalFileName="cscript.exe") ((CommandLine="*winrm*" CommandLine="*invoke Create wmicimv2/Win32_*" CommandLine="*-r:http*")))) | eval sigma_attack_tags="attack.defense_evasion attack.t1216" | eval sigma_title="Remote Code Execute via Winrm.vbs" | eval sigma_description="Detects an attempt to execute code or create service on remote host via winrm.vbs."
dispatch.earliest_time = -24h@h
alert.track = 0

[Compress Data and Lock With Password for Exfiltration With WINZIP - winevent]
description = An adversary may compress or encrypt data that is collected prior to exfiltration using 3rd party utilities
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (Process_Command_Line="*winzip.exe*" OR Process_Command_Line="*winzip64.exe*") Process_Command_Line="*-s\"*" (Process_Command_Line="* -min *" OR Process_Command_Line="* -a *"))) | eval sigma_attack_tags="attack.collection attack.t1560.001" | eval sigma_title="Compress Data and Lock With Password for Exfiltration With WINZIP" | eval sigma_description="An adversary may compress or encrypt data that is collected prior to exfiltration using 3rd party utilities"
dispatch.earliest_time = -24h@h
alert.track = 0

[Compress Data and Lock With Password for Exfiltration With WINZIP - sysmon]
description = An adversary may compress or encrypt data that is collected prior to exfiltration using 3rd party utilities
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (CommandLine="*winzip.exe*" OR CommandLine="*winzip64.exe*") CommandLine="*-s\"*" (CommandLine="* -min *" OR CommandLine="* -a *"))) | eval sigma_attack_tags="attack.collection attack.t1560.001" | eval sigma_title="Compress Data and Lock With Password for Exfiltration With WINZIP" | eval sigma_description="An adversary may compress or encrypt data that is collected prior to exfiltration using 3rd party utilities"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious WMIC ActiveScriptEventConsumer Creation - winevent]
description = Detects WMIC executions in which a event consumer gets created in order to establish persistence
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*ActiveScriptEventConsumer*" Process_Command_Line="* CREATE *")) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.persistence attack.t1546.003" | eval sigma_title="Suspicious WMIC ActiveScriptEventConsumer Creation" | eval sigma_description="Detects WMIC executions in which a event consumer gets created in order to establish persistence"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious WMIC ActiveScriptEventConsumer Creation - sysmon]
description = Detects WMIC executions in which a event consumer gets created in order to establish persistence
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*ActiveScriptEventConsumer*" CommandLine="* CREATE *")) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.persistence attack.t1546.003" | eval sigma_title="Suspicious WMIC ActiveScriptEventConsumer Creation" | eval sigma_description="Detects WMIC executions in which a event consumer gets created in order to establish persistence"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious WMIC Execution - winevent]
description = Detects WMIC executing suspicious or recon commands
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((((New_Process_Name="*\\wmic.exe" OR OriginalFileName="wmic.exe") ((Process_Command_Line="*process*" Process_Command_Line="*call*" Process_Command_Line="*create *")))) OR (((New_Process_Name="*\\wmic.exe" OR OriginalFileName="wmic.exe") ((Process_Command_Line="* path *" (Process_Command_Line="*AntiVirus*" OR Process_Command_Line="*Firewall*") Process_Command_Line="*Product*" Process_Command_Line="* get *" Process_Command_Line="*wmic csproduct get name*"))))))) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.execution attack.t1047 car.2016-03-002" | eval sigma_title="Suspicious WMIC Execution" | eval sigma_description="Detects WMIC executing suspicious or recon commands"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious WMIC Execution - sysmon]
description = Detects WMIC executing suspicious or recon commands
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((((Image="*\\wmic.exe" OR OriginalFileName="wmic.exe") ((CommandLine="*process*" CommandLine="*call*" CommandLine="*create *")))) OR (((Image="*\\wmic.exe" OR OriginalFileName="wmic.exe") ((CommandLine="* path *" (CommandLine="*AntiVirus*" OR CommandLine="*Firewall*") CommandLine="*Product*" CommandLine="* get *" CommandLine="*wmic csproduct get name*"))))))) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.execution attack.t1047 car.2016-03-002" | eval sigma_title="Suspicious WMIC Execution" | eval sigma_description="Detects WMIC executing suspicious or recon commands"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious WMIC Execution - ProcessCallCreate - winevent]
description = Detects WMIC executing 'process call create' with suspicious calls to processes such as 'rundll32', 'regsrv32'...etc
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*process *" Process_Command_Line="*call *" Process_Command_Line="*create *" (Process_Command_Line="*rundll32*" OR Process_Command_Line="*bitsadmin*" OR Process_Command_Line="*regsvr32*" OR Process_Command_Line="*cmd.exe /c *" OR Process_Command_Line="*cmd.exe /k *" OR Process_Command_Line="*cmd.exe /r *" OR Process_Command_Line="*cmd /c *" OR Process_Command_Line="*cmd /k *" OR Process_Command_Line="*cmd /r *" OR Process_Command_Line="*powershell*" OR Process_Command_Line="*pwsh*" OR Process_Command_Line="*certutil*" OR Process_Command_Line="*cscript*" OR Process_Command_Line="*wscript*" OR Process_Command_Line="*mshta*" OR Process_Command_Line="*\\Users\\Public\\*" OR Process_Command_Line="*\\Windows\\Temp\\*" OR Process_Command_Line="*\\AppData\\Local\\*" OR Process_Command_Line="*%temp%*" OR Process_Command_Line="*%tmp%*" OR Process_Command_Line="*%ProgramData%*" OR Process_Command_Line="*%appdata%*" OR Process_Command_Line="*%comspec%*" OR Process_Command_Line="*%localappdata%*"))) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.execution attack.t1047" | eval sigma_title="Suspicious WMIC Execution - ProcessCallCreate" | eval sigma_description="Detects WMIC executing 'process call create' with suspicious calls to processes such as 'rundll32', 'regsrv32'...etc"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious WMIC Execution - ProcessCallCreate - sysmon]
description = Detects WMIC executing 'process call create' with suspicious calls to processes such as 'rundll32', 'regsrv32'...etc
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*process *" CommandLine="*call *" CommandLine="*create *" (CommandLine="*rundll32*" OR CommandLine="*bitsadmin*" OR CommandLine="*regsvr32*" OR CommandLine="*cmd.exe /c *" OR CommandLine="*cmd.exe /k *" OR CommandLine="*cmd.exe /r *" OR CommandLine="*cmd /c *" OR CommandLine="*cmd /k *" OR CommandLine="*cmd /r *" OR CommandLine="*powershell*" OR CommandLine="*pwsh*" OR CommandLine="*certutil*" OR CommandLine="*cscript*" OR CommandLine="*wscript*" OR CommandLine="*mshta*" OR CommandLine="*\\Users\\Public\\*" OR CommandLine="*\\Windows\\Temp\\*" OR CommandLine="*\\AppData\\Local\\*" OR CommandLine="*%temp%*" OR CommandLine="*%tmp%*" OR CommandLine="*%ProgramData%*" OR CommandLine="*%appdata%*" OR CommandLine="*%comspec%*" OR CommandLine="*%localappdata%*"))) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.execution attack.t1047" | eval sigma_title="Suspicious WMIC Execution - ProcessCallCreate" | eval sigma_description="Detects WMIC executing 'process call create' with suspicious calls to processes such as 'rundll32', 'regsrv32'...etc"
dispatch.earliest_time = -24h@h
alert.track = 0

[Execution via WorkFolders.exe - winevent]
description = Detects using WorkFolders.exe to execute an arbitrary control.exe
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\control.exe" Creator_Process_Name="*\\WorkFolders.exe")) NOT ((New_Process_Name="C:\\Windows\\System32\\control.exe")))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218" | eval sigma_title="Execution via WorkFolders.exe" | eval sigma_description="Detects using WorkFolders.exe to execute an arbitrary control.exe"
dispatch.earliest_time = -24h@h
alert.track = 0

[Execution via WorkFolders.exe - sysmon]
description = Detects using WorkFolders.exe to execute an arbitrary control.exe
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\control.exe" ParentImage="*\\WorkFolders.exe")) NOT ((Image="C:\\Windows\\System32\\control.exe")))) | eval sigma_attack_tags="attack.defense_evasion attack.t1218" | eval sigma_title="Execution via WorkFolders.exe" | eval sigma_description="Detects using WorkFolders.exe to execute an arbitrary control.exe"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Windows Update Agent Empty Cmdline - winevent]
description = Detects suspicious Windows Update Agent activity in which a wuauclt.exe process command line doesn't contain any command line flags
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\Wuauclt.exe" OR OriginalFileName="Wuauclt.exe") Process_Command_Line="*\\Wuauclt.exe")) | eval sigma_attack_tags="" | eval sigma_title="Suspicious Windows Update Agent Empty Cmdline" | eval sigma_description="Detects suspicious Windows Update Agent activity in which a wuauclt.exe process command line doesn't contain any command line flags"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Windows Update Agent Empty Cmdline - sysmon]
description = Detects suspicious Windows Update Agent activity in which a wuauclt.exe process command line doesn't contain any command line flags
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\Wuauclt.exe" OR OriginalFileName="Wuauclt.exe") CommandLine="*\\Wuauclt.exe")) | eval sigma_attack_tags="" | eval sigma_title="Suspicious Windows Update Agent Empty Cmdline" | eval sigma_description="Detects suspicious Windows Update Agent activity in which a wuauclt.exe process command line doesn't contain any command line flags"
dispatch.earliest_time = -24h@h
alert.track = 0

[Windows Update Client LOLBIN - winevent]
description = Detects code execution via the Windows Update client (wuauclt)
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((New_Process_Name="*\\wuauclt.exe" OR OriginalFileName="wuauclt.exe") ((Process_Command_Line="*/UpdateDeploymentProvider*" Process_Command_Line="*/RunHandlerComServer*" Process_Command_Line="*.dll*")))) NOT (((Process_Command_Line="* /ClassId *" OR Process_Command_Line="* wuaueng.dll *"))))) | eval sigma_attack_tags="attack.command_and_control attack.execution attack.t1105 attack.t1218" | eval sigma_title="Windows Update Client LOLBIN" | eval sigma_description="Detects code execution via the Windows Update client (wuauclt)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Windows Update Client LOLBIN - sysmon]
description = Detects code execution via the Windows Update client (wuauclt)
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((Image="*\\wuauclt.exe" OR OriginalFileName="wuauclt.exe") ((CommandLine="*/UpdateDeploymentProvider*" CommandLine="*/RunHandlerComServer*" CommandLine="*.dll*")))) NOT (((CommandLine="* /ClassId *" OR CommandLine="* wuaueng.dll *"))))) | eval sigma_attack_tags="attack.command_and_control attack.execution attack.t1105 attack.t1218" | eval sigma_title="Windows Update Client LOLBIN" | eval sigma_description="Detects code execution via the Windows Update client (wuauclt)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Zip A Folder With PowerShell For Staging In Temp - winevent]
description = Use living off the land tools to zip a file and stage it in the Windows temporary folder for later exfiltration
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*Compress-Archive *" Process_Command_Line="* -Path *" Process_Command_Line="* -DestinationPath *" Process_Command_Line="*$env:TEMP\\*")) | eval sigma_attack_tags="attack.collection attack.t1074.001" | eval sigma_title="Zip A Folder With PowerShell For Staging In Temp" | eval sigma_description="Use living off the land tools to zip a file and stage it in the Windows temporary folder for later exfiltration"
dispatch.earliest_time = -24h@h
alert.track = 0

[Zip A Folder With PowerShell For Staging In Temp - sysmon]
description = Use living off the land tools to zip a file and stage it in the Windows temporary folder for later exfiltration
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*Compress-Archive *" CommandLine="* -Path *" CommandLine="* -DestinationPath *" CommandLine="*$env:TEMP\\*")) | eval sigma_attack_tags="attack.collection attack.t1074.001" | eval sigma_title="Zip A Folder With PowerShell For Staging In Temp" | eval sigma_description="Use living off the land tools to zip a file and stage it in the Windows temporary folder for later exfiltration"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious ZipExec Execution - winevent]
description = ZipExec is a Proof-of-Concept (POC) tool to wrap binary-based tools into a password-protected zip file.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((Process_Command_Line="*/generic:Microsoft_Windows_Shell_ZipFolder:filename=*" Process_Command_Line="*.zip*" Process_Command_Line="*/pass:*" Process_Command_Line="*/user:*")) OR ((Process_Command_Line="*/delete*" Process_Command_Line="*Microsoft_Windows_Shell_ZipFolder:filename=*" Process_Command_Line="*.zip*"))))) | eval sigma_attack_tags="attack.execution attack.defense_evasion attack.t1218 attack.t1202" | eval sigma_title="Suspicious ZipExec Execution" | eval sigma_description="ZipExec is a Proof-of-Concept (POC) tool to wrap binary-based tools into a password-protected zip file."
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious ZipExec Execution - sysmon]
description = ZipExec is a Proof-of-Concept (POC) tool to wrap binary-based tools into a password-protected zip file.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((CommandLine="*/generic:Microsoft_Windows_Shell_ZipFolder:filename=*" CommandLine="*.zip*" CommandLine="*/pass:*" CommandLine="*/user:*")) OR ((CommandLine="*/delete*" CommandLine="*Microsoft_Windows_Shell_ZipFolder:filename=*" CommandLine="*.zip*"))))) | eval sigma_attack_tags="attack.execution attack.defense_evasion attack.t1218 attack.t1202" | eval sigma_title="Suspicious ZipExec Execution" | eval sigma_description="ZipExec is a Proof-of-Concept (POC) tool to wrap binary-based tools into a password-protected zip file."
dispatch.earliest_time = -24h@h
alert.track = 0

[Usage of Sysinternals Tools - winevent]
description = Detects the usage of Sysinternals Tools due to accepteula option being seen in the command line.
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (Process_Command_Line="* -accepteula*" OR Process_Command_Line="* /accepteula*"))) | eval sigma_attack_tags="attack.resource_development attack.t1588.002" | eval sigma_title="Usage of Sysinternals Tools" | eval sigma_description="Detects the usage of Sysinternals Tools due to accepteula option being seen in the command line."
dispatch.earliest_time = -24h@h
alert.track = 0

[Usage of Sysinternals Tools - sysmon]
description = Detects the usage of Sysinternals Tools due to accepteula option being seen in the command line.
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (CommandLine="* -accepteula*" OR CommandLine="* /accepteula*"))) | eval sigma_attack_tags="attack.resource_development attack.t1588.002" | eval sigma_title="Usage of Sysinternals Tools" | eval sigma_description="Detects the usage of Sysinternals Tools due to accepteula option being seen in the command line."
dispatch.earliest_time = -24h@h
alert.track = 0

[Use of Sysinternals PsService - winevent]
description = Detects usage of Sysinternals PsService for service reconnaissance or tamper
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (OriginalFileName="psservice.exe" OR (New_Process_Name="*\\PsService.exe" OR New_Process_Name="*\\PsService64.exe")))) | eval sigma_attack_tags="attack.discovery attack.persistence attack.t1543.003" | eval sigma_title="Use of Sysinternals PsService" | eval sigma_description="Detects usage of Sysinternals PsService for service reconnaissance or tamper"
dispatch.earliest_time = -24h@h
alert.track = 0

[Use of Sysinternals PsService - sysmon]
description = Detects usage of Sysinternals PsService for service reconnaissance or tamper
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (OriginalFileName="psservice.exe" OR (Image="*\\PsService.exe" OR Image="*\\PsService64.exe")))) | eval sigma_attack_tags="attack.discovery attack.persistence attack.t1543.003" | eval sigma_title="Use of Sysinternals PsService" | eval sigma_description="Detects usage of Sysinternals PsService for service reconnaissance or tamper"
dispatch.earliest_time = -24h@h
alert.track = 0

[SharpEvtMute EvtMuteHook Load - winevent]
description = Detects the use of SharpEvtHook, a tool to tamper with Windows event logs
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\SharpEvtMute.exe" OR Description="SharpEvtMute" OR (Process_Command_Line="*--Filter \"rule *" OR Process_Command_Line="*--Encoded --Filter \\\"*")))) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.002" | eval sigma_title="SharpEvtMute EvtMuteHook Load" | eval sigma_description="Detects the use of SharpEvtHook, a tool to tamper with Windows event logs"
dispatch.earliest_time = -24h@h
alert.track = 0

[SharpEvtMute EvtMuteHook Load - sysmon]
description = Detects the use of SharpEvtHook, a tool to tamper with Windows event logs
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\SharpEvtMute.exe" OR Description="SharpEvtMute" OR (CommandLine="*--Filter \"rule *" OR CommandLine="*--Encoded --Filter \\\"*")))) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.002" | eval sigma_title="SharpEvtMute EvtMuteHook Load" | eval sigma_description="Detects the use of SharpEvtHook, a tool to tamper with Windows event logs"
dispatch.earliest_time = -24h@h
alert.track = 0

[Sysmon Driver Unload - winevent]
description = Detect possible Sysmon driver unload
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\fltmc.exe" Process_Command_Line="*unload*" Process_Command_Line="*sys*")) | table Process_Command_Line,NewValue | eval sigma_attack_tags="attack.defense_evasion attack.t1070 attack.t1562 attack.t1562.002" | eval sigma_title="Sysmon Driver Unload" | eval sigma_description="Detect possible Sysmon driver unload"
dispatch.earliest_time = -24h@h
alert.track = 0

[Sysmon Driver Unload - sysmon]
description = Detect possible Sysmon driver unload
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\fltmc.exe" CommandLine="*unload*" CommandLine="*sys*")) | table CommandLine,Details | eval sigma_attack_tags="attack.defense_evasion attack.t1070 attack.t1562 attack.t1562.002" | eval sigma_title="Sysmon Driver Unload" | eval sigma_description="Detect possible Sysmon driver unload"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Sysmon as Execution Parent - winevent]
description = Detects suspicious process executions in which Sysmon itself is the parent of a process, which could be a sign of exploitation (e.g. CVE-2022-41120)
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (Creator_Process_Name="*\\Sysmon.exe" OR Creator_Process_Name="*\\Sysmon64.exe") NOT (((New_Process_Name="C:\\Windows\\Sysmon.exe" OR New_Process_Name="C:\\Windows\\Sysmon64.exe" OR New_Process_Name="C:\\Windows\\System32\\conhost.exe" OR New_Process_Name="wevtutil.exe" OR New_Process_Name="C:\\WINDOWS\\system32\\wevtutil.exe" OR New_Process_Name="C:\\Windows\\System32\\WerFault.exe")) OR (New_Process_Name="*\\AppData\\Local\\Temp\\Sysmon.exe")))) | eval sigma_attack_tags="" | eval sigma_title="Suspicious Sysmon as Execution Parent" | eval sigma_description="Detects suspicious process executions in which Sysmon itself is the parent of a process, which could be a sign of exploitation (e.g. CVE-2022-41120)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Sysmon as Execution Parent - sysmon]
description = Detects suspicious process executions in which Sysmon itself is the parent of a process, which could be a sign of exploitation (e.g. CVE-2022-41120)
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (ParentImage="*\\Sysmon.exe" OR ParentImage="*\\Sysmon64.exe") NOT (((Image="C:\\Windows\\Sysmon.exe" OR Image="C:\\Windows\\Sysmon64.exe" OR Image="C:\\Windows\\System32\\conhost.exe" OR Image="wevtutil.exe" OR Image="C:\\WINDOWS\\system32\\wevtutil.exe" OR Image="C:\\Windows\\System32\\WerFault.exe")) OR (Image="*\\AppData\\Local\\Temp\\Sysmon.exe")))) | eval sigma_attack_tags="" | eval sigma_title="Suspicious Sysmon as Execution Parent" | eval sigma_description="Detects suspicious process executions in which Sysmon itself is the parent of a process, which could be a sign of exploitation (e.g. CVE-2022-41120)"
dispatch.earliest_time = -24h@h
alert.track = 0

[UAC Bypass via Event Viewer - winevent]
description = Detects UAC bypass method using Windows event viewer
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) Creator_Process_Name="*\\eventvwr.exe" NOT (((New_Process_Name="*\\mmc.exe" OR New_Process_Name="*:\\Windows\\SysWOW64\\WerFault.exe" OR New_Process_Name="*:\\Windows\\System32\\WerFault.exe"))))) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.privilege_escalation attack.t1548.002 car.2019-04-001" | eval sigma_title="UAC Bypass via Event Viewer" | eval sigma_description="Detects UAC bypass method using Windows event viewer"
dispatch.earliest_time = -24h@h
alert.track = 0

[UAC Bypass via Event Viewer - sysmon]
description = Detects UAC bypass method using Windows event viewer
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ParentImage="*\\eventvwr.exe" NOT (((Image="*\\mmc.exe" OR Image="*:\\Windows\\SysWOW64\\WerFault.exe" OR Image="*:\\Windows\\System32\\WerFault.exe"))))) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.privilege_escalation attack.t1548.002 car.2019-04-001" | eval sigma_title="UAC Bypass via Event Viewer" | eval sigma_description="Detects UAC bypass method using Windows event viewer"
dispatch.earliest_time = -24h@h
alert.track = 0

[Process Creation Using Sysnative Folder - winevent]
description = Detects process creation events that use the Sysnative folder (common for CobaltStrike spawns)
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="C:\\Windows\\Sysnative\\*")) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.t1055" | eval sigma_title="Process Creation Using Sysnative Folder" | eval sigma_description="Detects process creation events that use the Sysnative folder (common for CobaltStrike spawns)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Process Creation Using Sysnative Folder - sysmon]
description = Detects process creation events that use the Sysnative folder (common for CobaltStrike spawns)
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="C:\\Windows\\Sysnative\\*")) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.t1055" | eval sigma_title="Process Creation Using Sysnative Folder" | eval sigma_description="Detects process creation events that use the Sysnative folder (common for CobaltStrike spawns)"
dispatch.earliest_time = -24h@h
alert.track = 0

[System File Execution Location Anomaly - winevent]
description = Detects a Windows program executable started from a suspicious folder
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\svchost.exe" OR New_Process_Name="*\\rundll32.exe" OR New_Process_Name="*\\services.exe" OR New_Process_Name="*\\powershell.exe" OR New_Process_Name="*\\powershell_ise.exe" OR New_Process_Name="*\\pwsh.exe" OR New_Process_Name="*\\regsvr32.exe" OR New_Process_Name="*\\spoolsv.exe" OR New_Process_Name="*\\lsass.exe" OR New_Process_Name="*\\smss.exe" OR New_Process_Name="*\\csrss.exe" OR New_Process_Name="*\\conhost.exe" OR New_Process_Name="*\\wininit.exe" OR New_Process_Name="*\\lsm.exe" OR New_Process_Name="*\\winlogon.exe" OR New_Process_Name="*\\explorer.exe" OR New_Process_Name="*\\taskhost.exe" OR New_Process_Name="*\\Taskmgr.exe" OR New_Process_Name="*\\sihost.exe" OR New_Process_Name="*\\RuntimeBroker.exe" OR New_Process_Name="*\\smartscreen.exe" OR New_Process_Name="*\\dllhost.exe" OR New_Process_Name="*\\audiodg.exe" OR New_Process_Name="*\\wlanext.exe" OR New_Process_Name="*\\dashost.exe" OR New_Process_Name="*\\schtasks.exe" OR New_Process_Name="*\\cscript.exe" OR New_Process_Name="*\\wscript.exe" OR New_Process_Name="*\\wsl.exe" OR New_Process_Name="*\\bitsadmin.exe" OR New_Process_Name="*\\atbroker.exe" OR New_Process_Name="*\\bcdedit.exe" OR New_Process_Name="*\\certutil.exe" OR New_Process_Name="*\\certreq.exe" OR New_Process_Name="*\\cmstp.exe" OR New_Process_Name="*\\consent.exe" OR New_Process_Name="*\\defrag.exe" OR New_Process_Name="*\\dism.exe" OR New_Process_Name="*\\dllhst3g.exe" OR New_Process_Name="*\\eventvwr.exe" OR New_Process_Name="*\\msiexec.exe" OR New_Process_Name="*\\runonce.exe" OR New_Process_Name="*\\winver.exe" OR New_Process_Name="*\\logonui.exe" OR New_Process_Name="*\\userinit.exe" OR New_Process_Name="*\\dwm.exe" OR New_Process_Name="*\\LsaIso.exe" OR New_Process_Name="*\\ntoskrnl.exe" OR New_Process_Name="*\\wsmprovhost.exe" OR New_Process_Name="*\\dfrgui.exe") NOT ((((New_Process_Name="C:\\Windows\\System32\\*" OR New_Process_Name="C:\\Windows\\SysWOW64\\*" OR New_Process_Name="C:\\Windows\\WinSxS\\*")) OR (New_Process_Name="*\\SystemRoot\\System32\\*") OR ((New_Process_Name="C:\\Windows\\explorer.exe" OR New_Process_Name="C:\\Program Files\\PowerShell\\7\\pwsh.exe"))) OR ((New_Process_Name="C:\\Program Files\\WindowsApps\\MicrosoftCorporationII.WindowsSubsystemForLinux*" New_Process_Name="*\\wsl.exe"))))) | table ComputerName,Account_Name,New_Process_Name | eval sigma_attack_tags="attack.defense_evasion attack.t1036" | eval sigma_title="System File Execution Location Anomaly" | eval sigma_description="Detects a Windows program executable started from a suspicious folder"
dispatch.earliest_time = -24h@h
alert.track = 0

[System File Execution Location Anomaly - sysmon]
description = Detects a Windows program executable started from a suspicious folder
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\svchost.exe" OR Image="*\\rundll32.exe" OR Image="*\\services.exe" OR Image="*\\powershell.exe" OR Image="*\\powershell_ise.exe" OR Image="*\\pwsh.exe" OR Image="*\\regsvr32.exe" OR Image="*\\spoolsv.exe" OR Image="*\\lsass.exe" OR Image="*\\smss.exe" OR Image="*\\csrss.exe" OR Image="*\\conhost.exe" OR Image="*\\wininit.exe" OR Image="*\\lsm.exe" OR Image="*\\winlogon.exe" OR Image="*\\explorer.exe" OR Image="*\\taskhost.exe" OR Image="*\\Taskmgr.exe" OR Image="*\\sihost.exe" OR Image="*\\RuntimeBroker.exe" OR Image="*\\smartscreen.exe" OR Image="*\\dllhost.exe" OR Image="*\\audiodg.exe" OR Image="*\\wlanext.exe" OR Image="*\\dashost.exe" OR Image="*\\schtasks.exe" OR Image="*\\cscript.exe" OR Image="*\\wscript.exe" OR Image="*\\wsl.exe" OR Image="*\\bitsadmin.exe" OR Image="*\\atbroker.exe" OR Image="*\\bcdedit.exe" OR Image="*\\certutil.exe" OR Image="*\\certreq.exe" OR Image="*\\cmstp.exe" OR Image="*\\consent.exe" OR Image="*\\defrag.exe" OR Image="*\\dism.exe" OR Image="*\\dllhst3g.exe" OR Image="*\\eventvwr.exe" OR Image="*\\msiexec.exe" OR Image="*\\runonce.exe" OR Image="*\\winver.exe" OR Image="*\\logonui.exe" OR Image="*\\userinit.exe" OR Image="*\\dwm.exe" OR Image="*\\LsaIso.exe" OR Image="*\\ntoskrnl.exe" OR Image="*\\wsmprovhost.exe" OR Image="*\\dfrgui.exe") NOT ((((Image="C:\\Windows\\System32\\*" OR Image="C:\\Windows\\SysWOW64\\*" OR Image="C:\\Windows\\WinSxS\\*")) OR (Image="*\\SystemRoot\\System32\\*") OR ((Image="C:\\Windows\\explorer.exe" OR Image="C:\\Program Files\\PowerShell\\7\\pwsh.exe"))) OR ((Image="C:\\Program Files\\WindowsApps\\MicrosoftCorporationII.WindowsSubsystemForLinux*" Image="*\\wsl.exe"))))) | table ComputerName,User,Image | eval sigma_attack_tags="attack.defense_evasion attack.t1036" | eval sigma_title="System File Execution Location Anomaly" | eval sigma_description="Detects a Windows program executable started from a suspicious folder"
dispatch.earliest_time = -24h@h
alert.track = 0

[Tamper Windows Defender Remove-MpPreference - winevent]
description = Detects attempts to remove windows defender configuration using the 'MpPreference' cmdlet
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*Remove-MpPreference*" (Process_Command_Line="*-ControlledFolderAccessProtectedFolders *" OR Process_Command_Line="*-AttackSurfaceReductionRules_Ids *" OR Process_Command_Line="*-AttackSurfaceReductionRules_Actions *" OR Process_Command_Line="*-CheckForSignaturesBeforeRunningScan *"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.001" | eval sigma_title="Tamper Windows Defender Remove-MpPreference" | eval sigma_description="Detects attempts to remove windows defender configuration using the 'MpPreference' cmdlet"
dispatch.earliest_time = -24h@h
alert.track = 0

[Tamper Windows Defender Remove-MpPreference - sysmon]
description = Detects attempts to remove windows defender configuration using the 'MpPreference' cmdlet
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*Remove-MpPreference*" (CommandLine="*-ControlledFolderAccessProtectedFolders *" OR CommandLine="*-AttackSurfaceReductionRules_Ids *" OR CommandLine="*-AttackSurfaceReductionRules_Actions *" OR CommandLine="*-CheckForSignaturesBeforeRunningScan *"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.001" | eval sigma_title="Tamper Windows Defender Remove-MpPreference" | eval sigma_description="Detects attempts to remove windows defender configuration using the 'MpPreference' cmdlet"
dispatch.earliest_time = -24h@h
alert.track = 0

[Tap Installer Execution - winevent]
description = Well-known TAP software installation. Possible preparation for data exfiltration using tunneling techniques
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) New_Process_Name="*\\tapinstall.exe" NOT ((((New_Process_Name="C:\\Program Files\\Avast Software\\SecureLine VPN\\tapinstall.exe" OR New_Process_Name="C:\\Program Files (x86)\\Avast Software\\SecureLine VPN\\tapinstall.exe")))))) | eval sigma_attack_tags="attack.exfiltration attack.t1048" | eval sigma_title="Tap Installer Execution" | eval sigma_description="Well-known TAP software installation. Possible preparation for data exfiltration using tunneling techniques"
dispatch.earliest_time = -24h@h
alert.track = 0

[Tap Installer Execution - sysmon]
description = Well-known TAP software installation. Possible preparation for data exfiltration using tunneling techniques
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) Image="*\\tapinstall.exe" NOT ((((Image="C:\\Program Files\\Avast Software\\SecureLine VPN\\tapinstall.exe" OR Image="C:\\Program Files (x86)\\Avast Software\\SecureLine VPN\\tapinstall.exe")))))) | eval sigma_attack_tags="attack.exfiltration attack.t1048" | eval sigma_title="Tap Installer Execution" | eval sigma_description="Well-known TAP software installation. Possible preparation for data exfiltration using tunneling techniques"
dispatch.earliest_time = -24h@h
alert.track = 0

[Tasks Folder Evasion - winevent]
description = The Tasks folder in system32 and syswow64 are globally writable paths.
Adversaries can take advantage of this and load or influence any script hosts or ANY .NET Application 
in Tasks to load and execute a custom assembly into cscript, wscript, regsvr32, mshta, eventvwr

search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (Process_Command_Line="*echo *" OR Process_Command_Line="*copy *" OR Process_Command_Line="*type *" OR Process_Command_Line="*file createnew*") (Process_Command_Line="* C:\\Windows\\System32\\Tasks\\*" OR Process_Command_Line="* C:\\Windows\\SysWow64\\Tasks\\*"))) | table Process_Command_Line,ParentProcess | eval sigma_attack_tags="attack.defense_evasion attack.persistence attack.execution attack.t1574.002" | eval sigma_title="Tasks Folder Evasion" | eval sigma_description="The Tasks folder in system32 and syswow64 are globally writable paths.
Adversaries can take advantage of this and load or influence any script hosts or ANY .NET Application 
in Tasks to load and execute a custom assembly into cscript, wscript, regsvr32, mshta, eventvwr
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Tasks Folder Evasion - sysmon]
description = The Tasks folder in system32 and syswow64 are globally writable paths.
Adversaries can take advantage of this and load or influence any script hosts or ANY .NET Application 
in Tasks to load and execute a custom assembly into cscript, wscript, regsvr32, mshta, eventvwr

search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (CommandLine="*echo *" OR CommandLine="*copy *" OR CommandLine="*type *" OR CommandLine="*file createnew*") (CommandLine="* C:\\Windows\\System32\\Tasks\\*" OR CommandLine="* C:\\Windows\\SysWow64\\Tasks\\*"))) | table CommandLine,ParentProcess | eval sigma_attack_tags="attack.defense_evasion attack.persistence attack.execution attack.t1574.002" | eval sigma_title="Tasks Folder Evasion" | eval sigma_description="The Tasks folder in system32 and syswow64 are globally writable paths.
Adversaries can take advantage of this and load or influence any script hosts or ANY .NET Application 
in Tasks to load and execute a custom assembly into cscript, wscript, regsvr32, mshta, eventvwr
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Taskkill Symantec Endpoint Protection - winevent]
description = Detects one of the possible scenarios for disabling symantec endpoint protection.
Symantec Endpoint Protection antivirus software services incorrectly implement the protected service mechanism.
As a result, the NT AUTHORITY/SYSTEM user can execute the taskkill /im command several times ccSvcHst.exe /f, thereby killing the process belonging to the service, and thus shutting down the service.

search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*taskkill*" Process_Command_Line="* /F *" Process_Command_Line="* /IM *" Process_Command_Line="*ccSvcHst.exe*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.001" | eval sigma_title="Taskkill Symantec Endpoint Protection" | eval sigma_description="Detects one of the possible scenarios for disabling symantec endpoint protection.
Symantec Endpoint Protection antivirus software services incorrectly implement the protected service mechanism.
As a result, the NT AUTHORITY/SYSTEM user can execute the taskkill /im command several times ccSvcHst.exe /f, thereby killing the process belonging to the service, and thus shutting down the service.
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Taskkill Symantec Endpoint Protection - sysmon]
description = Detects one of the possible scenarios for disabling symantec endpoint protection.
Symantec Endpoint Protection antivirus software services incorrectly implement the protected service mechanism.
As a result, the NT AUTHORITY/SYSTEM user can execute the taskkill /im command several times ccSvcHst.exe /f, thereby killing the process belonging to the service, and thus shutting down the service.

search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*taskkill*" CommandLine="* /F *" CommandLine="* /IM *" CommandLine="*ccSvcHst.exe*")) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.001" | eval sigma_title="Taskkill Symantec Endpoint Protection" | eval sigma_description="Detects one of the possible scenarios for disabling symantec endpoint protection.
Symantec Endpoint Protection antivirus software services incorrectly implement the protected service mechanism.
As a result, the NT AUTHORITY/SYSTEM user can execute the taskkill /im command several times ccSvcHst.exe /f, thereby killing the process belonging to the service, and thus shutting down the service.
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Command With Teams Objects Pathes - winevent]
description = Detects an access to authentication tokens and accounts of Microsoft Teams desktop application.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (Process_Command_Line="*\\Microsoft\\Teams\\Cookies*" OR Process_Command_Line="*\\Microsoft\\Teams\\Local Storage\\leveldb*") NOT ((New_Process_Name="*\\Microsoft\\Teams\\current\\Teams.exe")))) | eval sigma_attack_tags="attack.credential_access attack.t1528" | eval sigma_title="Suspicious Command With Teams Objects Pathes" | eval sigma_description="Detects an access to authentication tokens and accounts of Microsoft Teams desktop application."
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Command With Teams Objects Pathes - sysmon]
description = Detects an access to authentication tokens and accounts of Microsoft Teams desktop application.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (CommandLine="*\\Microsoft\\Teams\\Cookies*" OR CommandLine="*\\Microsoft\\Teams\\Local Storage\\leveldb*") NOT ((Image="*\\Microsoft\\Teams\\current\\Teams.exe")))) | eval sigma_attack_tags="attack.credential_access attack.t1528" | eval sigma_title="Suspicious Command With Teams Objects Pathes" | eval sigma_description="Detects an access to authentication tokens and accounts of Microsoft Teams desktop application."
dispatch.earliest_time = -24h@h
alert.track = 0

[Terminal Service Process Spawn - winevent]
description = Detects a process spawned by the terminal service server process (this could be an indicator for an exploitation of CVE-2019-0708)
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((ParentCommandLine="*\\svchost.exe*" ParentCommandLine="*termsvcs*")) NOT ((((New_Process_Name="*\\rdpclip.exe" OR New_Process_Name="*:\\Windows\\System32\\csrss.exe" OR New_Process_Name="*:\\Windows\\System32\\wininit.exe" OR New_Process_Name="*:\\Windows\\System32\\winlogon.exe"))) OR ((NOT New_Process_Name="*"))))) | eval sigma_attack_tags="attack.initial_access attack.t1190 attack.lateral_movement attack.t1210 car.2013-07-002" | eval sigma_title="Terminal Service Process Spawn" | eval sigma_description="Detects a process spawned by the terminal service server process (this could be an indicator for an exploitation of CVE-2019-0708)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Terminal Service Process Spawn - sysmon]
description = Detects a process spawned by the terminal service server process (this could be an indicator for an exploitation of CVE-2019-0708)
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((ParentCommandLine="*\\svchost.exe*" ParentCommandLine="*termsvcs*")) NOT ((((Image="*\\rdpclip.exe" OR Image="*:\\Windows\\System32\\csrss.exe" OR Image="*:\\Windows\\System32\\wininit.exe" OR Image="*:\\Windows\\System32\\winlogon.exe"))) OR ((NOT Image="*"))))) | eval sigma_attack_tags="attack.initial_access attack.t1190 attack.lateral_movement attack.t1210 car.2013-07-002" | eval sigma_title="Terminal Service Process Spawn" | eval sigma_description="Detects a process spawned by the terminal service server process (this could be an indicator for an exploitation of CVE-2019-0708)"
dispatch.earliest_time = -24h@h
alert.track = 0

[NirCmd Tool Execution As LOCAL SYSTEM - winevent]
description = Detects the use of NirCmd tool for command execution as SYSTEM user
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="* runassystem *")) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.execution attack.t1569.002 attack.s0029" | eval sigma_title="NirCmd Tool Execution As LOCAL SYSTEM" | eval sigma_description="Detects the use of NirCmd tool for command execution as SYSTEM user"
dispatch.earliest_time = -24h@h
alert.track = 0

[NirCmd Tool Execution As LOCAL SYSTEM - sysmon]
description = Detects the use of NirCmd tool for command execution as SYSTEM user
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="* runassystem *")) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.execution attack.t1569.002 attack.s0029" | eval sigma_title="NirCmd Tool Execution As LOCAL SYSTEM" | eval sigma_description="Detects the use of NirCmd tool for command execution as SYSTEM user"
dispatch.earliest_time = -24h@h
alert.track = 0

[NirCmd Tool Execution - winevent]
description = Detects the use of NirCmd tool for command execution, which could be the result of legitimate administrative activity
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\NirCmd.exe" OR OriginalFileName="NirCmd.exe" OR (Process_Command_Line="* execmd *" OR Process_Command_Line="*.exe script *" OR Process_Command_Line="*.exe shexec *" OR Process_Command_Line="* runinteractive *")) OR (((Process_Command_Line="* exec *" OR Process_Command_Line="* exec2 *") (Process_Command_Line="* show *" OR Process_Command_Line="* hide *")))))) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.execution attack.t1569.002 attack.s0029" | eval sigma_title="NirCmd Tool Execution" | eval sigma_description="Detects the use of NirCmd tool for command execution, which could be the result of legitimate administrative activity"
dispatch.earliest_time = -24h@h
alert.track = 0

[NirCmd Tool Execution - sysmon]
description = Detects the use of NirCmd tool for command execution, which could be the result of legitimate administrative activity
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\NirCmd.exe" OR OriginalFileName="NirCmd.exe" OR (CommandLine="* execmd *" OR CommandLine="*.exe script *" OR CommandLine="*.exe shexec *" OR CommandLine="* runinteractive *")) OR (((CommandLine="* exec *" OR CommandLine="* exec2 *") (CommandLine="* show *" OR CommandLine="* hide *")))))) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.execution attack.t1569.002 attack.s0029" | eval sigma_title="NirCmd Tool Execution" | eval sigma_description="Detects the use of NirCmd tool for command execution, which could be the result of legitimate administrative activity"
dispatch.earliest_time = -24h@h
alert.track = 0

[NSudo Tool Execution - winevent]
description = Detects the use of NSudo tool for command execution
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\NSudo.exe" OR New_Process_Name="*\\NSudoLC.exe" OR New_Process_Name="*\\NSudoLG.exe") OR (OriginalFileName="NSudo.exe" OR OriginalFileName="NSudoLC.exe" OR OriginalFileName="NSudoLG.exe")) (Process_Command_Line="*-U:S *" OR Process_Command_Line="*-U:T *" OR Process_Command_Line="*-U:E *" OR Process_Command_Line="*-P:E *" OR Process_Command_Line="*-M:S *" OR Process_Command_Line="*-M:H *" OR Process_Command_Line="*-U=S *" OR Process_Command_Line="*-U=T *" OR Process_Command_Line="*-U=E *" OR Process_Command_Line="*-P=E *" OR Process_Command_Line="*-M=S *" OR Process_Command_Line="*-M=H *" OR Process_Command_Line="*-ShowWindowMode:Hide*"))) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.execution attack.t1569.002 attack.s0029" | eval sigma_title="NSudo Tool Execution" | eval sigma_description="Detects the use of NSudo tool for command execution"
dispatch.earliest_time = -24h@h
alert.track = 0

[NSudo Tool Execution - sysmon]
description = Detects the use of NSudo tool for command execution
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\NSudo.exe" OR Image="*\\NSudoLC.exe" OR Image="*\\NSudoLG.exe") OR (OriginalFileName="NSudo.exe" OR OriginalFileName="NSudoLC.exe" OR OriginalFileName="NSudoLG.exe")) (CommandLine="*-U:S *" OR CommandLine="*-U:T *" OR CommandLine="*-U:E *" OR CommandLine="*-P:E *" OR CommandLine="*-M:S *" OR CommandLine="*-M:H *" OR CommandLine="*-U=S *" OR CommandLine="*-U=T *" OR CommandLine="*-U=E *" OR CommandLine="*-P=E *" OR CommandLine="*-M=S *" OR CommandLine="*-M=H *" OR CommandLine="*-ShowWindowMode:Hide*"))) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.execution attack.t1569.002 attack.s0029" | eval sigma_title="NSudo Tool Execution" | eval sigma_description="Detects the use of NSudo tool for command execution"
dispatch.earliest_time = -24h@h
alert.track = 0

[PsExec Tool Execution - winevent]
description = Detects PsExec service execution via default service image name
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\PSEXESVC.exe" (Account_Name="*AUTHORI*" OR Account_Name="*AUTORI*"))) | table EventCode,Process_Command_Line,ParentCommandLine,ServiceName,ServiceFileName,TargetFilename,PipeName | eval sigma_attack_tags="attack.execution attack.t1569.002 attack.s0029" | eval sigma_title="PsExec Tool Execution" | eval sigma_description="Detects PsExec service execution via default service image name"
dispatch.earliest_time = -24h@h
alert.track = 0

[PsExec Tool Execution - sysmon]
description = Detects PsExec service execution via default service image name
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\PSEXESVC.exe" (User="*AUTHORI*" OR User="*AUTORI*"))) | table EventCode,CommandLine,ParentCommandLine,ServiceName,ServiceFileName,TargetFilename,PipeName | eval sigma_attack_tags="attack.execution attack.t1569.002 attack.s0029" | eval sigma_title="PsExec Tool Execution" | eval sigma_description="Detects PsExec service execution via default service image name"
dispatch.earliest_time = -24h@h
alert.track = 0

[RunXCmd Tool Execution As System - winevent]
description = Detects the use of RunXCmd tool for command execution
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="* /account=system *" Process_Command_Line="*/exec=*")) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.execution attack.t1569.002 attack.s0029" | eval sigma_title="RunXCmd Tool Execution As System" | eval sigma_description="Detects the use of RunXCmd tool for command execution"
dispatch.earliest_time = -24h@h
alert.track = 0

[RunXCmd Tool Execution As System - sysmon]
description = Detects the use of RunXCmd tool for command execution
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="* /account=system *" CommandLine="*/exec=*")) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.execution attack.t1569.002 attack.s0029" | eval sigma_title="RunXCmd Tool Execution As System" | eval sigma_description="Detects the use of RunXCmd tool for command execution"
dispatch.earliest_time = -24h@h
alert.track = 0

[SMB Relay Attack Tools - winevent]
description = Detects different hacktools used for relay attacks on Windows for privilege escalation
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*PetitPotam*" OR New_Process_Name="*RottenPotato*" OR New_Process_Name="*HotPotato*" OR New_Process_Name="*JuicyPotato*" OR New_Process_Name="*\\just_dce_*" OR New_Process_Name="*Juicy Potato*" OR New_Process_Name="*\\temp\\rot.exe*" OR New_Process_Name="*\\Potato.exe*" OR New_Process_Name="*\\SpoolSample.exe*" OR New_Process_Name="*\\Responder.exe*" OR New_Process_Name="*\\smbrelayx*" OR New_Process_Name="*\\ntlmrelayx*" OR New_Process_Name="*\\LocalPotato*") OR (Process_Command_Line="*Invoke-Tater*" OR Process_Command_Line="* smbrelay*" OR Process_Command_Line="* ntlmrelay*" OR Process_Command_Line="*cme smb *" OR Process_Command_Line="* /ntlm:NTLMhash *" OR Process_Command_Line="*Invoke-PetitPotam*" OR Process_Command_Line="*.exe -t * -p *") OR ((Process_Command_Line="*.exe -c \"{*" Process_Command_Line="*}\" -z"))) NOT ((((New_Process_Name="*HotPotatoes6*" OR New_Process_Name="*HotPotatoes7*" OR New_Process_Name="*HotPotatoes *")))))) | eval sigma_attack_tags="attack.execution attack.t1557.001" | eval sigma_title="SMB Relay Attack Tools" | eval sigma_description="Detects different hacktools used for relay attacks on Windows for privilege escalation"
dispatch.earliest_time = -24h@h
alert.track = 0

[SMB Relay Attack Tools - sysmon]
description = Detects different hacktools used for relay attacks on Windows for privilege escalation
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*PetitPotam*" OR Image="*RottenPotato*" OR Image="*HotPotato*" OR Image="*JuicyPotato*" OR Image="*\\just_dce_*" OR Image="*Juicy Potato*" OR Image="*\\temp\\rot.exe*" OR Image="*\\Potato.exe*" OR Image="*\\SpoolSample.exe*" OR Image="*\\Responder.exe*" OR Image="*\\smbrelayx*" OR Image="*\\ntlmrelayx*" OR Image="*\\LocalPotato*") OR (CommandLine="*Invoke-Tater*" OR CommandLine="* smbrelay*" OR CommandLine="* ntlmrelay*" OR CommandLine="*cme smb *" OR CommandLine="* /ntlm:NTLMhash *" OR CommandLine="*Invoke-PetitPotam*" OR CommandLine="*.exe -t * -p *") OR ((CommandLine="*.exe -c \"{*" CommandLine="*}\" -z"))) NOT ((((Image="*HotPotatoes6*" OR Image="*HotPotatoes7*" OR Image="*HotPotatoes *")))))) | eval sigma_attack_tags="attack.execution attack.t1557.001" | eval sigma_title="SMB Relay Attack Tools" | eval sigma_description="Detects different hacktools used for relay attacks on Windows for privilege escalation"
dispatch.earliest_time = -24h@h
alert.track = 0

[UAC Bypass Tools Using ComputerDefaults - winevent]
description = Detects tools such as UACMe used to bypass UAC with computerdefaults.exe (UACMe 59)
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((IntegrityLevel="High" OR IntegrityLevel="System") New_Process_Name="C:\\Windows\\System32\\ComputerDefaults.exe")) NOT (((Creator_Process_Name="*:\\Windows\\System32*" OR Creator_Process_Name="*:\\Program Files*"))))) | eval sigma_attack_tags="attack.defense_evasion attack.privilege_escalation attack.t1548.002" | eval sigma_title="UAC Bypass Tools Using ComputerDefaults" | eval sigma_description="Detects tools such as UACMe used to bypass UAC with computerdefaults.exe (UACMe 59)"
dispatch.earliest_time = -24h@h
alert.track = 0

[UAC Bypass Tools Using ComputerDefaults - sysmon]
description = Detects tools such as UACMe used to bypass UAC with computerdefaults.exe (UACMe 59)
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((IntegrityLevel="High" OR IntegrityLevel="System") Image="C:\\Windows\\System32\\ComputerDefaults.exe")) NOT (((ParentImage="*:\\Windows\\System32*" OR ParentImage="*:\\Program Files*"))))) | eval sigma_attack_tags="attack.defense_evasion attack.privilege_escalation attack.t1548.002" | eval sigma_title="UAC Bypass Tools Using ComputerDefaults" | eval sigma_description="Detects tools such as UACMe used to bypass UAC with computerdefaults.exe (UACMe 59)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Tor Client or Tor Browser Use - winevent]
description = Detects the use of Tor or Tor-Browser to connect to onion routing networks
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (New_Process_Name="*\\tor.exe" OR New_Process_Name="*\\Tor Browser\\Browser\\firefox.exe"))) | eval sigma_attack_tags="attack.command_and_control attack.t1090.003" | eval sigma_title="Tor Client or Tor Browser Use" | eval sigma_description="Detects the use of Tor or Tor-Browser to connect to onion routing networks"
dispatch.earliest_time = -24h@h
alert.track = 0

[Tor Client or Tor Browser Use - sysmon]
description = Detects the use of Tor or Tor-Browser to connect to onion routing networks
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (Image="*\\tor.exe" OR Image="*\\Tor Browser\\Browser\\firefox.exe"))) | eval sigma_attack_tags="attack.command_and_control attack.t1090.003" | eval sigma_title="Tor Client or Tor Browser Use" | eval sigma_description="Detects the use of Tor or Tor-Browser to connect to onion routing networks"
dispatch.earliest_time = -24h@h
alert.track = 0

[Launch TruffleSnout Executable - winevent]
description = Detect use of TruffleSnout.exe
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (OriginalFileName="TruffleSnout.exe" OR New_Process_Name="*\\TruffleSnout.exe"))) | eval sigma_attack_tags="attack.discovery attack.t1482" | eval sigma_title="Launch TruffleSnout Executable" | eval sigma_description="Detect use of TruffleSnout.exe"
dispatch.earliest_time = -24h@h
alert.track = 0

[Launch TruffleSnout Executable - sysmon]
description = Detect use of TruffleSnout.exe
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (OriginalFileName="TruffleSnout.exe" OR Image="*\\TruffleSnout.exe"))) | eval sigma_attack_tags="attack.discovery attack.t1482" | eval sigma_title="Launch TruffleSnout Executable" | eval sigma_description="Detect use of TruffleSnout.exe"
dispatch.earliest_time = -24h@h
alert.track = 0

[Domain Trust Discovery - winevent]
description = Identifies execution of nltest.exe and dsquery.exe for domain trust discovery. This technique is used by attackers to enumerate Active Directory trusts.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((New_Process_Name="*\\nltest.exe" (Process_Command_Line="*domain_trusts*" OR Process_Command_Line="*all_trusts*" OR Process_Command_Line="*/trusted_domains*" OR Process_Command_Line="*/dclist*"))) OR ((New_Process_Name="*\\dsquery.exe" Process_Command_Line="*trustedDomain*")) OR ((New_Process_Name="*\\dsquery.exe" Process_Command_Line="*-filter*" Process_Command_Line="*trustedDomain*"))))) | eval sigma_attack_tags="attack.discovery attack.t1482" | eval sigma_title="Domain Trust Discovery" | eval sigma_description="Identifies execution of nltest.exe and dsquery.exe for domain trust discovery. This technique is used by attackers to enumerate Active Directory trusts."
dispatch.earliest_time = -24h@h
alert.track = 0

[Domain Trust Discovery - sysmon]
description = Identifies execution of nltest.exe and dsquery.exe for domain trust discovery. This technique is used by attackers to enumerate Active Directory trusts.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((Image="*\\nltest.exe" (CommandLine="*domain_trusts*" OR CommandLine="*all_trusts*" OR CommandLine="*/trusted_domains*" OR CommandLine="*/dclist*"))) OR ((Image="*\\dsquery.exe" CommandLine="*trustedDomain*")) OR ((Image="*\\dsquery.exe" CommandLine="*-filter*" CommandLine="*trustedDomain*"))))) | eval sigma_attack_tags="attack.discovery attack.t1482" | eval sigma_title="Domain Trust Discovery" | eval sigma_description="Identifies execution of nltest.exe and dsquery.exe for domain trust discovery. This technique is used by attackers to enumerate Active Directory trusts."
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential Signing Bypass Via Windows Developer Features - winevent]
description = Detects when a user enable developer features such as 'Developer Mode' or 'Application Sideloading'. Which allows the user to install untrusted packages.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\SystemSettingsAdminFlows.exe" OR OriginalFileName="SystemSettingsAdminFlows.EXE") Process_Command_Line="*TurnOnDeveloperFeatures*" (Process_Command_Line="*DeveloperUnlock*" OR Process_Command_Line="*EnableSideloading*"))) | eval sigma_attack_tags="attack.defense_evasion" | eval sigma_title="Potential Signing Bypass Via Windows Developer Features" | eval sigma_description="Detects when a user enable developer features such as 'Developer Mode' or 'Application Sideloading'. Which allows the user to install untrusted packages."
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential Signing Bypass Via Windows Developer Features - sysmon]
description = Detects when a user enable developer features such as 'Developer Mode' or 'Application Sideloading'. Which allows the user to install untrusted packages.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\SystemSettingsAdminFlows.exe" OR OriginalFileName="SystemSettingsAdminFlows.EXE") CommandLine="*TurnOnDeveloperFeatures*" (CommandLine="*DeveloperUnlock*" OR CommandLine="*EnableSideloading*"))) | eval sigma_attack_tags="attack.defense_evasion" | eval sigma_title="Potential Signing Bypass Via Windows Developer Features" | eval sigma_description="Detects when a user enable developer features such as 'Developer Mode' or 'Application Sideloading'. Which allows the user to install untrusted packages."
dispatch.earliest_time = -24h@h
alert.track = 0

[UAC Bypass Using ChangePK and SLUI - winevent]
description = Detects an UAC bypass that uses changepk.exe and slui.exe (UACMe 61)
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\changepk.exe" Creator_Process_Name="*\\slui.exe" (IntegrityLevel="High" OR IntegrityLevel="System"))) | eval sigma_attack_tags="attack.defense_evasion attack.privilege_escalation attack.t1548.002" | eval sigma_title="UAC Bypass Using ChangePK and SLUI" | eval sigma_description="Detects an UAC bypass that uses changepk.exe and slui.exe (UACMe 61)"
dispatch.earliest_time = -24h@h
alert.track = 0

[UAC Bypass Using ChangePK and SLUI - sysmon]
description = Detects an UAC bypass that uses changepk.exe and slui.exe (UACMe 61)
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\changepk.exe" ParentImage="*\\slui.exe" (IntegrityLevel="High" OR IntegrityLevel="System"))) | eval sigma_attack_tags="attack.defense_evasion attack.privilege_escalation attack.t1548.002" | eval sigma_title="UAC Bypass Using ChangePK and SLUI" | eval sigma_description="Detects an UAC bypass that uses changepk.exe and slui.exe (UACMe 61)"
dispatch.earliest_time = -24h@h
alert.track = 0

[UAC Bypass Using Disk Cleanup - winevent]
description = Detects the pattern of UAC Bypass using scheduled tasks and variable expansion of cleanmgr.exe (UACMe 34)
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*\"\\system32\\cleanmgr.exe /autoclean /d C:" ParentCommandLine="C:\\Windows\\system32\\svchost.exe -k netsvcs -p -s Schedule" (IntegrityLevel="High" OR IntegrityLevel="System"))) | eval sigma_attack_tags="attack.defense_evasion attack.privilege_escalation attack.t1548.002" | eval sigma_title="UAC Bypass Using Disk Cleanup" | eval sigma_description="Detects the pattern of UAC Bypass using scheduled tasks and variable expansion of cleanmgr.exe (UACMe 34)"
dispatch.earliest_time = -24h@h
alert.track = 0

[UAC Bypass Using Disk Cleanup - sysmon]
description = Detects the pattern of UAC Bypass using scheduled tasks and variable expansion of cleanmgr.exe (UACMe 34)
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*\"\\system32\\cleanmgr.exe /autoclean /d C:" ParentCommandLine="C:\\Windows\\system32\\svchost.exe -k netsvcs -p -s Schedule" (IntegrityLevel="High" OR IntegrityLevel="System"))) | eval sigma_attack_tags="attack.defense_evasion attack.privilege_escalation attack.t1548.002" | eval sigma_title="UAC Bypass Using Disk Cleanup" | eval sigma_description="Detects the pattern of UAC Bypass using scheduled tasks and variable expansion of cleanmgr.exe (UACMe 34)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Bypass UAC via CMSTP - winevent]
description = Detect commandline usage of Microsoft Connection Manager Profile Installer (cmstp.exe) to install specially formatted local .INF files
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\cmstp.exe" OR OriginalFileName="CMSTP.EXE") (Process_Command_Line="*/s*" OR Process_Command_Line="*-s*" OR Process_Command_Line="*/au*" OR Process_Command_Line="*-au*" OR Process_Command_Line="*/ni*" OR Process_Command_Line="*-ni*"))) | table ComputerName,Account_Name,Process_Command_Line | eval sigma_attack_tags="attack.privilege_escalation attack.defense_evasion attack.t1548.002 attack.t1218.003" | eval sigma_title="Bypass UAC via CMSTP" | eval sigma_description="Detect commandline usage of Microsoft Connection Manager Profile Installer (cmstp.exe) to install specially formatted local .INF files"
dispatch.earliest_time = -24h@h
alert.track = 0

[Bypass UAC via CMSTP - sysmon]
description = Detect commandline usage of Microsoft Connection Manager Profile Installer (cmstp.exe) to install specially formatted local .INF files
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\cmstp.exe" OR OriginalFileName="CMSTP.EXE") (CommandLine="*/s*" OR CommandLine="*-s*" OR CommandLine="*/au*" OR CommandLine="*-au*" OR CommandLine="*/ni*" OR CommandLine="*-ni*"))) | table ComputerName,User,CommandLine | eval sigma_attack_tags="attack.privilege_escalation attack.defense_evasion attack.t1548.002 attack.t1218.003" | eval sigma_title="Bypass UAC via CMSTP" | eval sigma_description="Detect commandline usage of Microsoft Connection Manager Profile Installer (cmstp.exe) to install specially formatted local .INF files"
dispatch.earliest_time = -24h@h
alert.track = 0

[UAC Bypass Using Consent and Comctl32 - Process - winevent]
description = Detects the pattern of UAC Bypass using consent.exe and comctl32.dll (UACMe 22)
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Creator_Process_Name="*\\consent.exe" New_Process_Name="*\\werfault.exe" (IntegrityLevel="High" OR IntegrityLevel="System"))) | eval sigma_attack_tags="attack.defense_evasion attack.privilege_escalation attack.t1548.002" | eval sigma_title="UAC Bypass Using Consent and Comctl32 - Process" | eval sigma_description="Detects the pattern of UAC Bypass using consent.exe and comctl32.dll (UACMe 22)"
dispatch.earliest_time = -24h@h
alert.track = 0

[UAC Bypass Using Consent and Comctl32 - Process - sysmon]
description = Detects the pattern of UAC Bypass using consent.exe and comctl32.dll (UACMe 22)
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") ParentImage="*\\consent.exe" Image="*\\werfault.exe" (IntegrityLevel="High" OR IntegrityLevel="System"))) | eval sigma_attack_tags="attack.defense_evasion attack.privilege_escalation attack.t1548.002" | eval sigma_title="UAC Bypass Using Consent and Comctl32 - Process" | eval sigma_description="Detects the pattern of UAC Bypass using consent.exe and comctl32.dll (UACMe 22)"
dispatch.earliest_time = -24h@h
alert.track = 0

[UAC Bypass Using DismHost - winevent]
description = Detects the pattern of UAC Bypass using DismHost DLL hijacking (UACMe 63)
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Creator_Process_Name="*C:\\Users\\*" Creator_Process_Name="*\\AppData\\Local\\Temp\\*" Creator_Process_Name="*\\DismHost.exe*" (IntegrityLevel="High" OR IntegrityLevel="System"))) | eval sigma_attack_tags="attack.defense_evasion attack.privilege_escalation attack.t1548.002" | eval sigma_title="UAC Bypass Using DismHost" | eval sigma_description="Detects the pattern of UAC Bypass using DismHost DLL hijacking (UACMe 63)"
dispatch.earliest_time = -24h@h
alert.track = 0

[UAC Bypass Using DismHost - sysmon]
description = Detects the pattern of UAC Bypass using DismHost DLL hijacking (UACMe 63)
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") ParentImage="*C:\\Users\\*" ParentImage="*\\AppData\\Local\\Temp\\*" ParentImage="*\\DismHost.exe*" (IntegrityLevel="High" OR IntegrityLevel="System"))) | eval sigma_attack_tags="attack.defense_evasion attack.privilege_escalation attack.t1548.002" | eval sigma_title="UAC Bypass Using DismHost" | eval sigma_description="Detects the pattern of UAC Bypass using DismHost DLL hijacking (UACMe 63)"
dispatch.earliest_time = -24h@h
alert.track = 0

[UAC Bypass Using Event Viewer RecentViews - winevent]
description = Detects the pattern of UAC Bypass using Event Viewer RecentViews
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (Process_Command_Line="*\\Event Viewer\\RecentViews*" OR Process_Command_Line="*\\EventV~1\\RecentViews*") Process_Command_Line="*>*")) | eval sigma_attack_tags="attack.defense_evasion attack.privilege_escalation" | eval sigma_title="UAC Bypass Using Event Viewer RecentViews" | eval sigma_description="Detects the pattern of UAC Bypass using Event Viewer RecentViews"
dispatch.earliest_time = -24h@h
alert.track = 0

[UAC Bypass Using Event Viewer RecentViews - sysmon]
description = Detects the pattern of UAC Bypass using Event Viewer RecentViews
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (CommandLine="*\\Event Viewer\\RecentViews*" OR CommandLine="*\\EventV~1\\RecentViews*") CommandLine="*>*")) | eval sigma_attack_tags="attack.defense_evasion attack.privilege_escalation" | eval sigma_title="UAC Bypass Using Event Viewer RecentViews" | eval sigma_description="Detects the pattern of UAC Bypass using Event Viewer RecentViews"
dispatch.earliest_time = -24h@h
alert.track = 0

[Bypass UAC via Fodhelper.exe - winevent]
description = Identifies use of Fodhelper.exe to bypass User Account Control. Adversaries use this technique to execute privileged processes.
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Creator_Process_Name="*\\fodhelper.exe")) | table ComputerName,Account_Name,Process_Command_Line | eval sigma_attack_tags="attack.privilege_escalation attack.t1548.002" | eval sigma_title="Bypass UAC via Fodhelper.exe" | eval sigma_description="Identifies use of Fodhelper.exe to bypass User Account Control. Adversaries use this technique to execute privileged processes."
dispatch.earliest_time = -24h@h
alert.track = 0

[Bypass UAC via Fodhelper.exe - sysmon]
description = Identifies use of Fodhelper.exe to bypass User Account Control. Adversaries use this technique to execute privileged processes.
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") ParentImage="*\\fodhelper.exe")) | table ComputerName,User,CommandLine | eval sigma_attack_tags="attack.privilege_escalation attack.t1548.002" | eval sigma_title="Bypass UAC via Fodhelper.exe" | eval sigma_description="Identifies use of Fodhelper.exe to bypass User Account Control. Adversaries use this technique to execute privileged processes."
dispatch.earliest_time = -24h@h
alert.track = 0

[UAC Bypass via Windows Firewall Snap-In Hijack - winevent]
description = Detects attempts to bypass User Account Control (UAC) by hijacking the Microsoft Management Console (MMC) Windows Firewall snap-in
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((Creator_Process_Name="*\\mmc.exe" ParentCommandLine="*WF.msc*")) NOT ((New_Process_Name="*\\WerFault.exe")))) | eval sigma_attack_tags="attack.privilege_escalation attack.t1548" | eval sigma_title="UAC Bypass via Windows Firewall Snap-In Hijack" | eval sigma_description="Detects attempts to bypass User Account Control (UAC) by hijacking the Microsoft Management Console (MMC) Windows Firewall snap-in"
dispatch.earliest_time = -24h@h
alert.track = 0

[UAC Bypass via Windows Firewall Snap-In Hijack - sysmon]
description = Detects attempts to bypass User Account Control (UAC) by hijacking the Microsoft Management Console (MMC) Windows Firewall snap-in
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((ParentImage="*\\mmc.exe" ParentCommandLine="*WF.msc*")) NOT ((Image="*\\WerFault.exe")))) | eval sigma_attack_tags="attack.privilege_escalation attack.t1548" | eval sigma_title="UAC Bypass via Windows Firewall Snap-In Hijack" | eval sigma_description="Detects attempts to bypass User Account Control (UAC) by hijacking the Microsoft Management Console (MMC) Windows Firewall snap-in"
dispatch.earliest_time = -24h@h
alert.track = 0

[UAC Bypass via ICMLuaUtil - winevent]
description = Detects the pattern of UAC Bypass using ICMLuaUtil Elevated COM interface
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((Creator_Process_Name="*\\dllhost.exe" (ParentCommandLine="*/Processid:{3E5FC7F9-9A51-4367-9063-A120244FBEC7}*" OR ParentCommandLine="*/Processid:{D2E7041B-2927-42FB-8E9F-7CE93B6DC937}*"))) NOT ((New_Process_Name="*\\WerFault.exe") OR (OriginalFileName="WerFault.exe")))) | eval sigma_attack_tags="attack.defense_evasion attack.privilege_escalation attack.t1548.002" | eval sigma_title="UAC Bypass via ICMLuaUtil" | eval sigma_description="Detects the pattern of UAC Bypass using ICMLuaUtil Elevated COM interface"
dispatch.earliest_time = -24h@h
alert.track = 0

[UAC Bypass via ICMLuaUtil - sysmon]
description = Detects the pattern of UAC Bypass using ICMLuaUtil Elevated COM interface
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((ParentImage="*\\dllhost.exe" (ParentCommandLine="*/Processid:{3E5FC7F9-9A51-4367-9063-A120244FBEC7}*" OR ParentCommandLine="*/Processid:{D2E7041B-2927-42FB-8E9F-7CE93B6DC937}*"))) NOT ((Image="*\\WerFault.exe") OR (OriginalFileName="WerFault.exe")))) | eval sigma_attack_tags="attack.defense_evasion attack.privilege_escalation attack.t1548.002" | eval sigma_title="UAC Bypass via ICMLuaUtil" | eval sigma_description="Detects the pattern of UAC Bypass using ICMLuaUtil Elevated COM interface"
dispatch.earliest_time = -24h@h
alert.track = 0

[UAC Bypass Using IDiagnostic Profile - winevent]
description = Detects the 'IDiagnosticProfileUAC' UAC bypass technique
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Creator_Process_Name="*\\DllHost.exe" ParentCommandLine="* /Processid:{12C21EA7-2EB8-4B55-9249-AC243DA8C666}*" (IntegrityLevel="High" OR IntegrityLevel="System"))) | eval sigma_attack_tags="attack.execution attack.defense_evasion attack.privilege_escalation attack.t1548.002" | eval sigma_title="UAC Bypass Using IDiagnostic Profile" | eval sigma_description="Detects the 'IDiagnosticProfileUAC' UAC bypass technique"
dispatch.earliest_time = -24h@h
alert.track = 0

[UAC Bypass Using IDiagnostic Profile - sysmon]
description = Detects the 'IDiagnosticProfileUAC' UAC bypass technique
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") ParentImage="*\\DllHost.exe" ParentCommandLine="* /Processid:{12C21EA7-2EB8-4B55-9249-AC243DA8C666}*" (IntegrityLevel="High" OR IntegrityLevel="System"))) | eval sigma_attack_tags="attack.execution attack.defense_evasion attack.privilege_escalation attack.t1548.002" | eval sigma_title="UAC Bypass Using IDiagnostic Profile" | eval sigma_description="Detects the 'IDiagnosticProfileUAC' UAC bypass technique"
dispatch.earliest_time = -24h@h
alert.track = 0

[UAC Bypass Using IEInstal - Process - winevent]
description = Detects the pattern of UAC Bypass using IEInstal.exe (UACMe 64)
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (IntegrityLevel="High" OR IntegrityLevel="System") Creator_Process_Name="*\\ieinstal.exe" New_Process_Name="*\\AppData\\Local\\Temp\\*" New_Process_Name="*consent.exe")) | eval sigma_attack_tags="attack.defense_evasion attack.privilege_escalation attack.t1548.002" | eval sigma_title="UAC Bypass Using IEInstal - Process" | eval sigma_description="Detects the pattern of UAC Bypass using IEInstal.exe (UACMe 64)"
dispatch.earliest_time = -24h@h
alert.track = 0

[UAC Bypass Using IEInstal - Process - sysmon]
description = Detects the pattern of UAC Bypass using IEInstal.exe (UACMe 64)
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (IntegrityLevel="High" OR IntegrityLevel="System") ParentImage="*\\ieinstal.exe" Image="*\\AppData\\Local\\Temp\\*" Image="*consent.exe")) | eval sigma_attack_tags="attack.defense_evasion attack.privilege_escalation attack.t1548.002" | eval sigma_title="UAC Bypass Using IEInstal - Process" | eval sigma_description="Detects the pattern of UAC Bypass using IEInstal.exe (UACMe 64)"
dispatch.earliest_time = -24h@h
alert.track = 0

[UAC Bypass Using MSConfig Token Modification - Process - winevent]
description = Detects the pattern of UAC Bypass using a msconfig GUI hack (UACMe 55)
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (IntegrityLevel="High" OR IntegrityLevel="System") Creator_Process_Name="*\\AppData\\Local\\Temp\\pkgmgr.exe" Process_Command_Line="\"C:\\Windows\\system32\\msconfig.exe\" -5")) | eval sigma_attack_tags="attack.defense_evasion attack.privilege_escalation attack.t1548.002" | eval sigma_title="UAC Bypass Using MSConfig Token Modification - Process" | eval sigma_description="Detects the pattern of UAC Bypass using a msconfig GUI hack (UACMe 55)"
dispatch.earliest_time = -24h@h
alert.track = 0

[UAC Bypass Using MSConfig Token Modification - Process - sysmon]
description = Detects the pattern of UAC Bypass using a msconfig GUI hack (UACMe 55)
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (IntegrityLevel="High" OR IntegrityLevel="System") ParentImage="*\\AppData\\Local\\Temp\\pkgmgr.exe" CommandLine="\"C:\\Windows\\system32\\msconfig.exe\" -5")) | eval sigma_attack_tags="attack.defense_evasion attack.privilege_escalation attack.t1548.002" | eval sigma_title="UAC Bypass Using MSConfig Token Modification - Process" | eval sigma_description="Detects the pattern of UAC Bypass using a msconfig GUI hack (UACMe 55)"
dispatch.earliest_time = -24h@h
alert.track = 0

[UAC Bypass Using NTFS Reparse Point - Process - winevent]
description = Detects the pattern of UAC Bypass using NTFS reparse point and wusa.exe DLL hijacking (UACMe 36)
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((Process_Command_Line="\"C:\\Windows\\system32\\wusa.exe\"  /quiet C:\\Users\\*" Process_Command_Line="*\\AppData\\Local\\Temp\\update.msu" (IntegrityLevel="High" OR IntegrityLevel="System"))) OR ((ParentCommandLine="\"C:\\Windows\\system32\\dism.exe\" /online /quiet /norestart /add-package /packagepath:\"C:\\Windows\\system32\\pe386\" /ignorecheck" (IntegrityLevel="High" OR IntegrityLevel="System") Process_Command_Line="*C:\\Users\\*" Process_Command_Line="*\\AppData\\Local\\Temp\\*" Process_Command_Line="*\\dismhost.exe {*" New_Process_Name="*\\DismHost.exe"))))) | eval sigma_attack_tags="attack.defense_evasion attack.privilege_escalation attack.t1548.002" | eval sigma_title="UAC Bypass Using NTFS Reparse Point - Process" | eval sigma_description="Detects the pattern of UAC Bypass using NTFS reparse point and wusa.exe DLL hijacking (UACMe 36)"
dispatch.earliest_time = -24h@h
alert.track = 0

[UAC Bypass Using NTFS Reparse Point - Process - sysmon]
description = Detects the pattern of UAC Bypass using NTFS reparse point and wusa.exe DLL hijacking (UACMe 36)
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((CommandLine="\"C:\\Windows\\system32\\wusa.exe\"  /quiet C:\\Users\\*" CommandLine="*\\AppData\\Local\\Temp\\update.msu" (IntegrityLevel="High" OR IntegrityLevel="System"))) OR ((ParentCommandLine="\"C:\\Windows\\system32\\dism.exe\" /online /quiet /norestart /add-package /packagepath:\"C:\\Windows\\system32\\pe386\" /ignorecheck" (IntegrityLevel="High" OR IntegrityLevel="System") CommandLine="*C:\\Users\\*" CommandLine="*\\AppData\\Local\\Temp\\*" CommandLine="*\\dismhost.exe {*" Image="*\\DismHost.exe"))))) | eval sigma_attack_tags="attack.defense_evasion attack.privilege_escalation attack.t1548.002" | eval sigma_title="UAC Bypass Using NTFS Reparse Point - Process" | eval sigma_description="Detects the pattern of UAC Bypass using NTFS reparse point and wusa.exe DLL hijacking (UACMe 36)"
dispatch.earliest_time = -24h@h
alert.track = 0

[UAC Bypass Using PkgMgr and DISM - winevent]
description = Detects the pattern of UAC Bypass using pkgmgr.exe and dism.exe (UACMe 23)
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Creator_Process_Name="*\\pkgmgr.exe" New_Process_Name="*\\dism.exe" (IntegrityLevel="High" OR IntegrityLevel="System"))) | eval sigma_attack_tags="attack.defense_evasion attack.privilege_escalation attack.t1548.002" | eval sigma_title="UAC Bypass Using PkgMgr and DISM" | eval sigma_description="Detects the pattern of UAC Bypass using pkgmgr.exe and dism.exe (UACMe 23)"
dispatch.earliest_time = -24h@h
alert.track = 0

[UAC Bypass Using PkgMgr and DISM - sysmon]
description = Detects the pattern of UAC Bypass using pkgmgr.exe and dism.exe (UACMe 23)
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") ParentImage="*\\pkgmgr.exe" Image="*\\dism.exe" (IntegrityLevel="High" OR IntegrityLevel="System"))) | eval sigma_attack_tags="attack.defense_evasion attack.privilege_escalation attack.t1548.002" | eval sigma_title="UAC Bypass Using PkgMgr and DISM" | eval sigma_description="Detects the pattern of UAC Bypass using pkgmgr.exe and dism.exe (UACMe 23)"
dispatch.earliest_time = -24h@h
alert.track = 0

[UAC Bypass Abusing Winsat Path Parsing - Process - winevent]
description = Detects the pattern of UAC Bypass using a path parsing issue in winsat.exe (UACMe 52)
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (IntegrityLevel="High" OR IntegrityLevel="System") Creator_Process_Name="*\\AppData\\Local\\Temp\\system32\\winsat.exe" ParentCommandLine="*C:\\Windows \\system32\\winsat.exe*")) | eval sigma_attack_tags="attack.defense_evasion attack.privilege_escalation attack.t1548.002" | eval sigma_title="UAC Bypass Abusing Winsat Path Parsing - Process" | eval sigma_description="Detects the pattern of UAC Bypass using a path parsing issue in winsat.exe (UACMe 52)"
dispatch.earliest_time = -24h@h
alert.track = 0

[UAC Bypass Abusing Winsat Path Parsing - Process - sysmon]
description = Detects the pattern of UAC Bypass using a path parsing issue in winsat.exe (UACMe 52)
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (IntegrityLevel="High" OR IntegrityLevel="System") ParentImage="*\\AppData\\Local\\Temp\\system32\\winsat.exe" ParentCommandLine="*C:\\Windows \\system32\\winsat.exe*")) | eval sigma_attack_tags="attack.defense_evasion attack.privilege_escalation attack.t1548.002" | eval sigma_title="UAC Bypass Abusing Winsat Path Parsing - Process" | eval sigma_description="Detects the pattern of UAC Bypass using a path parsing issue in winsat.exe (UACMe 52)"
dispatch.earliest_time = -24h@h
alert.track = 0

[UAC Bypass Using Windows Media Player - Process - winevent]
description = Detects the pattern of UAC Bypass using Windows Media Player osksupport.dll (UACMe 32)
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((New_Process_Name="C:\\Program Files\\Windows Media Player\\osk.exe" (IntegrityLevel="High" OR IntegrityLevel="System"))) OR ((New_Process_Name="C:\\Windows\\System32\\cmd.exe" ParentCommandLine="\"C:\\Windows\\system32\\mmc.exe\" \"C:\\Windows\\system32\\eventvwr.msc\" /s" (IntegrityLevel="High" OR IntegrityLevel="System")))))) | eval sigma_attack_tags="attack.defense_evasion attack.privilege_escalation attack.t1548.002" | eval sigma_title="UAC Bypass Using Windows Media Player - Process" | eval sigma_description="Detects the pattern of UAC Bypass using Windows Media Player osksupport.dll (UACMe 32)"
dispatch.earliest_time = -24h@h
alert.track = 0

[UAC Bypass Using Windows Media Player - Process - sysmon]
description = Detects the pattern of UAC Bypass using Windows Media Player osksupport.dll (UACMe 32)
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((Image="C:\\Program Files\\Windows Media Player\\osk.exe" (IntegrityLevel="High" OR IntegrityLevel="System"))) OR ((Image="C:\\Windows\\System32\\cmd.exe" ParentCommandLine="\"C:\\Windows\\system32\\mmc.exe\" \"C:\\Windows\\system32\\eventvwr.msc\" /s" (IntegrityLevel="High" OR IntegrityLevel="System")))))) | eval sigma_attack_tags="attack.defense_evasion attack.privilege_escalation attack.t1548.002" | eval sigma_title="UAC Bypass Using Windows Media Player - Process" | eval sigma_description="Detects the pattern of UAC Bypass using Windows Media Player osksupport.dll (UACMe 32)"
dispatch.earliest_time = -24h@h
alert.track = 0

[UAC Bypass WSReset - winevent]
description = Detects the pattern of UAC Bypass via WSReset usable by default sysmon-config
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\wsreset.exe" (IntegrityLevel="High" OR IntegrityLevel="System"))) | eval sigma_attack_tags="attack.defense_evasion attack.privilege_escalation attack.t1548.002" | eval sigma_title="UAC Bypass WSReset" | eval sigma_description="Detects the pattern of UAC Bypass via WSReset usable by default sysmon-config"
dispatch.earliest_time = -24h@h
alert.track = 0

[UAC Bypass WSReset - sysmon]
description = Detects the pattern of UAC Bypass via WSReset usable by default sysmon-config
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\wsreset.exe" (IntegrityLevel="High" OR IntegrityLevel="System"))) | eval sigma_attack_tags="attack.defense_evasion attack.privilege_escalation attack.t1548.002" | eval sigma_title="UAC Bypass WSReset" | eval sigma_description="Detects the pattern of UAC Bypass via WSReset usable by default sysmon-config"
dispatch.earliest_time = -24h@h
alert.track = 0

[Bypass UAC via WSReset.exe - winevent]
description = Detects use of WSReset.exe to bypass User Account Control (UAC). Adversaries use this technique to execute privileged processes.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) Creator_Process_Name="*\\wsreset.exe" NOT ((New_Process_Name="*\\conhost.exe") OR (OriginalFileName="CONHOST.EXE")))) | eval sigma_attack_tags="attack.privilege_escalation attack.defense_evasion attack.t1548.002" | eval sigma_title="Bypass UAC via WSReset.exe" | eval sigma_description="Detects use of WSReset.exe to bypass User Account Control (UAC). Adversaries use this technique to execute privileged processes."
dispatch.earliest_time = -24h@h
alert.track = 0

[Bypass UAC via WSReset.exe - sysmon]
description = Detects use of WSReset.exe to bypass User Account Control (UAC). Adversaries use this technique to execute privileged processes.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ParentImage="*\\wsreset.exe" NOT ((Image="*\\conhost.exe") OR (OriginalFileName="CONHOST.EXE")))) | eval sigma_attack_tags="attack.privilege_escalation attack.defense_evasion attack.t1548.002" | eval sigma_title="Bypass UAC via WSReset.exe" | eval sigma_description="Detects use of WSReset.exe to bypass User Account Control (UAC). Adversaries use this technique to execute privileged processes."
dispatch.earliest_time = -24h@h
alert.track = 0

[Use of UltraViewer Remote Access Software - winevent]
description = An adversary may use legitimate desktop support and remote access software, such as Team Viewer, Go2Assist, LogMein, AmmyyAdmin, etc, to establish an interactive command and control channel to target systems within networks.
These services are commonly used as legitimate technical support software, and may be allowed by application control within a target environment.
Remote access tools like VNC, Ammyy, and Teamviewer are used frequently when compared with other legitimate software commonly used by adversaries. (Citation: Symantec Living off the Land)

search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (Product="UltraViewer" OR Company="DucFabulous Co,ltd" OR OriginalFileName="UltraViewer_Desktop.exe"))) | eval sigma_attack_tags="attack.command_and_control attack.t1219" | eval sigma_title="Use of UltraViewer Remote Access Software" | eval sigma_description="An adversary may use legitimate desktop support and remote access software, such as Team Viewer, Go2Assist, LogMein, AmmyyAdmin, etc, to establish an interactive command and control channel to target systems within networks.
These services are commonly used as legitimate technical support software, and may be allowed by application control within a target environment.
Remote access tools like VNC, Ammyy, and Teamviewer are used frequently when compared with other legitimate software commonly used by adversaries. (Citation: Symantec Living off the Land)
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Use of UltraViewer Remote Access Software - sysmon]
description = An adversary may use legitimate desktop support and remote access software, such as Team Viewer, Go2Assist, LogMein, AmmyyAdmin, etc, to establish an interactive command and control channel to target systems within networks.
These services are commonly used as legitimate technical support software, and may be allowed by application control within a target environment.
Remote access tools like VNC, Ammyy, and Teamviewer are used frequently when compared with other legitimate software commonly used by adversaries. (Citation: Symantec Living off the Land)

search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Product="UltraViewer" OR Company="DucFabulous Co,ltd" OR OriginalFileName="UltraViewer_Desktop.exe"))) | eval sigma_attack_tags="attack.command_and_control attack.t1219" | eval sigma_title="Use of UltraViewer Remote Access Software" | eval sigma_description="An adversary may use legitimate desktop support and remote access software, such as Team Viewer, Go2Assist, LogMein, AmmyyAdmin, etc, to establish an interactive command and control channel to target systems within networks.
These services are commonly used as legitimate technical support software, and may be allowed by application control within a target environment.
Remote access tools like VNC, Ammyy, and Teamviewer are used frequently when compared with other legitimate software commonly used by adversaries. (Citation: Symantec Living off the Land)
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Use of UltraVNC Remote Access Software - winevent]
description = An adversary may use legitimate desktop support and remote access software,to establish an interactive command and control channel to target systems within networks
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (Description="VNCViewer" OR Product="UltraVNC VNCViewer" OR Company="UltraVNC" OR OriginalFileName="VNCViewer.exe"))) | eval sigma_attack_tags="attack.command_and_control attack.t1219" | eval sigma_title="Use of UltraVNC Remote Access Software" | eval sigma_description="An adversary may use legitimate desktop support and remote access software,to establish an interactive command and control channel to target systems within networks"
dispatch.earliest_time = -24h@h
alert.track = 0

[Use of UltraVNC Remote Access Software - sysmon]
description = An adversary may use legitimate desktop support and remote access software,to establish an interactive command and control channel to target systems within networks
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Description="VNCViewer" OR Product="UltraVNC VNCViewer" OR Company="UltraVNC" OR OriginalFileName="VNCViewer.exe"))) | eval sigma_attack_tags="attack.command_and_control attack.t1219" | eval sigma_title="Use of UltraVNC Remote Access Software" | eval sigma_description="An adversary may use legitimate desktop support and remote access software,to establish an interactive command and control channel to target systems within networks"
dispatch.earliest_time = -24h@h
alert.track = 0

[Uninstall Crowdstrike Falcon - winevent]
description = Adversaries may disable security tools to avoid possible detection of their tools and activities by uninstalling Crowdstrike Falcon
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*\\WindowsSensor.exe*" Process_Command_Line="* /uninstall*" Process_Command_Line="* /quiet*")) | table ComputerName,Account_Name,Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.t1562.001" | eval sigma_title="Uninstall Crowdstrike Falcon" | eval sigma_description="Adversaries may disable security tools to avoid possible detection of their tools and activities by uninstalling Crowdstrike Falcon"
dispatch.earliest_time = -24h@h
alert.track = 0

[Uninstall Crowdstrike Falcon - sysmon]
description = Adversaries may disable security tools to avoid possible detection of their tools and activities by uninstalling Crowdstrike Falcon
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*\\WindowsSensor.exe*" CommandLine="* /uninstall*" CommandLine="* /quiet*")) | table ComputerName,User,CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.t1562.001" | eval sigma_title="Uninstall Crowdstrike Falcon" | eval sigma_description="Adversaries may disable security tools to avoid possible detection of their tools and activities by uninstalling Crowdstrike Falcon"
dispatch.earliest_time = -24h@h
alert.track = 0

[Unusual Child Porcess of dns.exe - winevent]
description = Detects an unexpected process spawning from dns.exe which may indicate activity related to remote code execution or other forms of exploitation as seen in CVE-2020-1350 (SigRed)
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) Creator_Process_Name="*\\dns.exe" NOT ((New_Process_Name="*\\conhost.exe")))) | eval sigma_attack_tags="attack.initial_access attack.t1133" | eval sigma_title="Unusual Child Porcess of dns.exe" | eval sigma_description="Detects an unexpected process spawning from dns.exe which may indicate activity related to remote code execution or other forms of exploitation as seen in CVE-2020-1350 (SigRed)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Unusual Child Porcess of dns.exe - sysmon]
description = Detects an unexpected process spawning from dns.exe which may indicate activity related to remote code execution or other forms of exploitation as seen in CVE-2020-1350 (SigRed)
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ParentImage="*\\dns.exe" NOT ((Image="*\\conhost.exe")))) | eval sigma_attack_tags="attack.initial_access attack.t1133" | eval sigma_title="Unusual Child Porcess of dns.exe" | eval sigma_description="Detects an unexpected process spawning from dns.exe which may indicate activity related to remote code execution or other forms of exploitation as seen in CVE-2020-1350 (SigRed)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Unusual Parent Process for cmd.exe - winevent]
description = Detects suspicious parent process for cmd.exe
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\cmd.exe" (Creator_Process_Name="*\\lsass.exe" OR Creator_Process_Name="*\\csrss.exe" OR Creator_Process_Name="*\\epad.exe" OR Creator_Process_Name="*\\regsvr32.exe" OR Creator_Process_Name="*\\dllhost.exe" OR Creator_Process_Name="*\\LogonUI.exe" OR Creator_Process_Name="*\\wergmgr.exe" OR Creator_Process_Name="*\\spoolsv.exe" OR Creator_Process_Name="*\\jucheck.exe" OR Creator_Process_Name="*\\jusched.exe" OR Creator_Process_Name="*\\ctfmon.exe" OR Creator_Process_Name="*\\taskhostw.exe" OR Creator_Process_Name="*\\GoogleUpdate.exe" OR Creator_Process_Name="*\\sppsvc.exe" OR Creator_Process_Name="*\\sihost.exe" OR Creator_Process_Name="*\\slui.exe" OR Creator_Process_Name="*\\SIHClient.exe" OR Creator_Process_Name="*\\SearchIndexer.exe" OR Creator_Process_Name="*\\SearchProtocolHost.exe" OR Creator_Process_Name="*\\FlashPlayerUpdateService.exe" OR Creator_Process_Name="*\\WerFault.exe" OR Creator_Process_Name="*\\WUDFHost.exe" OR Creator_Process_Name="*\\unsecapp.exe" OR Creator_Process_Name="*\\wlanext.exe"))) | eval sigma_attack_tags="attack.execution attack.t1059" | eval sigma_title="Unusual Parent Process for cmd.exe" | eval sigma_description="Detects suspicious parent process for cmd.exe"
dispatch.earliest_time = -24h@h
alert.track = 0

[Unusual Parent Process for cmd.exe - sysmon]
description = Detects suspicious parent process for cmd.exe
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\cmd.exe" (ParentImage="*\\lsass.exe" OR ParentImage="*\\csrss.exe" OR ParentImage="*\\epad.exe" OR ParentImage="*\\regsvr32.exe" OR ParentImage="*\\dllhost.exe" OR ParentImage="*\\LogonUI.exe" OR ParentImage="*\\wergmgr.exe" OR ParentImage="*\\spoolsv.exe" OR ParentImage="*\\jucheck.exe" OR ParentImage="*\\jusched.exe" OR ParentImage="*\\ctfmon.exe" OR ParentImage="*\\taskhostw.exe" OR ParentImage="*\\GoogleUpdate.exe" OR ParentImage="*\\sppsvc.exe" OR ParentImage="*\\sihost.exe" OR ParentImage="*\\slui.exe" OR ParentImage="*\\SIHClient.exe" OR ParentImage="*\\SearchIndexer.exe" OR ParentImage="*\\SearchProtocolHost.exe" OR ParentImage="*\\FlashPlayerUpdateService.exe" OR ParentImage="*\\WerFault.exe" OR ParentImage="*\\WUDFHost.exe" OR ParentImage="*\\unsecapp.exe" OR ParentImage="*\\wlanext.exe"))) | eval sigma_attack_tags="attack.execution attack.t1059" | eval sigma_title="Unusual Parent Process for cmd.exe" | eval sigma_description="Detects suspicious parent process for cmd.exe"
dispatch.earliest_time = -24h@h
alert.track = 0

[User Discovery And Export Via Get-ADUser Cmdlet - winevent]
description = Detects usage of the Get-ADUser cmdlet to collect user information and output it to a file
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\powershell.exe" OR New_Process_Name="*\\pwsh.exe") OR (OriginalFileName="PowerShell.EXE" OR OriginalFileName="pwsh.dll")) ((Process_Command_Line="*Get-ADUser *" Process_Command_Line="* -Filter \*" (Process_Command_Line="* > *" OR Process_Command_Line="* | Select *" OR Process_Command_Line="*Out-File*" OR Process_Command_Line="*Set-Content*" OR Process_Command_Line="*Add-Content*"))))) | eval sigma_attack_tags="attack.discovery attack.t1033" | eval sigma_title="User Discovery And Export Via Get-ADUser Cmdlet" | eval sigma_description="Detects usage of the Get-ADUser cmdlet to collect user information and output it to a file"
dispatch.earliest_time = -24h@h
alert.track = 0

[User Discovery And Export Via Get-ADUser Cmdlet - sysmon]
description = Detects usage of the Get-ADUser cmdlet to collect user information and output it to a file
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\powershell.exe" OR Image="*\\pwsh.exe") OR (OriginalFileName="PowerShell.EXE" OR OriginalFileName="pwsh.dll")) ((CommandLine="*Get-ADUser *" CommandLine="* -Filter \*" (CommandLine="* > *" OR CommandLine="* | Select *" OR CommandLine="*Out-File*" OR CommandLine="*Set-Content*" OR CommandLine="*Add-Content*"))))) | eval sigma_attack_tags="attack.discovery attack.t1033" | eval sigma_title="User Discovery And Export Via Get-ADUser Cmdlet" | eval sigma_description="Detects usage of the Get-ADUser cmdlet to collect user information and output it to a file"
dispatch.earliest_time = -24h@h
alert.track = 0

[Possible Privilege Escalation via Weak Service Permissions - winevent]
description = Detection of sc.exe utility spawning by user with Medium integrity level to change service ImagePath or FailureCommand
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\sc.exe" IntegrityLevel="Medium")) (((Process_Command_Line="*config*" Process_Command_Line="*binPath*")) OR ((Process_Command_Line="*failure*" Process_Command_Line="*command*"))))) | eval sigma_attack_tags="attack.persistence attack.defense_evasion attack.privilege_escalation attack.t1574.011" | eval sigma_title="Possible Privilege Escalation via Weak Service Permissions" | eval sigma_description="Detection of sc.exe utility spawning by user with Medium integrity level to change service ImagePath or FailureCommand"
dispatch.earliest_time = -24h@h
alert.track = 0

[Possible Privilege Escalation via Weak Service Permissions - sysmon]
description = Detection of sc.exe utility spawning by user with Medium integrity level to change service ImagePath or FailureCommand
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\sc.exe" IntegrityLevel="Medium")) (((CommandLine="*config*" CommandLine="*binPath*")) OR ((CommandLine="*failure*" CommandLine="*command*"))))) | eval sigma_attack_tags="attack.persistence attack.defense_evasion attack.privilege_escalation attack.t1574.011" | eval sigma_title="Possible Privilege Escalation via Weak Service Permissions" | eval sigma_description="Detection of sc.exe utility spawning by user with Medium integrity level to change service ImagePath or FailureCommand"
dispatch.earliest_time = -24h@h
alert.track = 0

[Abuse of Service Permissions to Hide Services in Tools - winevent]
description = Detection of sc.exe utility adding a new service with special permission which hides that service.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\sc.exe" OR OriginalFileName="sc.exe") ((Process_Command_Line="*sdset*" Process_Command_Line="*DCLCWPDTSD*")))) | eval sigma_attack_tags="attack.persistence attack.defense_evasion attack.privilege_escalation attack.t1574.011" | eval sigma_title="Abuse of Service Permissions to Hide Services in Tools" | eval sigma_description="Detection of sc.exe utility adding a new service with special permission which hides that service."
dispatch.earliest_time = -24h@h
alert.track = 0

[Abuse of Service Permissions to Hide Services in Tools - sysmon]
description = Detection of sc.exe utility adding a new service with special permission which hides that service.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\sc.exe" OR OriginalFileName="sc.exe") ((CommandLine="*sdset*" CommandLine="*DCLCWPDTSD*")))) | eval sigma_attack_tags="attack.persistence attack.defense_evasion attack.privilege_escalation attack.t1574.011" | eval sigma_title="Abuse of Service Permissions to Hide Services in Tools" | eval sigma_description="Detection of sc.exe utility adding a new service with special permission which hides that service."
dispatch.earliest_time = -24h@h
alert.track = 0

[Abuse of Service Permissions to Hide Services Via Set-Service - winevent]
description = Detects usage of the 'Set-Service' powershell cmdlet to configure a new SecurityDescriptor that allows a service to be hidden from other utilities such as 'sc.exe', 'Get-Service'...etc. (Works only in powershell 7)
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\pwsh.exe" OR OriginalFileName="pwsh.dll") ((Process_Command_Line="*Set-Service *" Process_Command_Line="*DCLCWPDTSD*")) (Process_Command_Line="*-SecurityDescriptorSddl *" OR Process_Command_Line="*-sd *"))) | eval sigma_attack_tags="attack.persistence attack.defense_evasion attack.privilege_escalation attack.t1574.011" | eval sigma_title="Abuse of Service Permissions to Hide Services Via Set-Service" | eval sigma_description="Detects usage of the 'Set-Service' powershell cmdlet to configure a new SecurityDescriptor that allows a service to be hidden from other utilities such as 'sc.exe', 'Get-Service'...etc. (Works only in powershell 7)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Abuse of Service Permissions to Hide Services Via Set-Service - sysmon]
description = Detects usage of the 'Set-Service' powershell cmdlet to configure a new SecurityDescriptor that allows a service to be hidden from other utilities such as 'sc.exe', 'Get-Service'...etc. (Works only in powershell 7)
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\pwsh.exe" OR OriginalFileName="pwsh.dll") ((CommandLine="*Set-Service *" CommandLine="*DCLCWPDTSD*")) (CommandLine="*-SecurityDescriptorSddl *" OR CommandLine="*-sd *"))) | eval sigma_attack_tags="attack.persistence attack.defense_evasion attack.privilege_escalation attack.t1574.011" | eval sigma_title="Abuse of Service Permissions to Hide Services Via Set-Service" | eval sigma_description="Detects usage of the 'Set-Service' powershell cmdlet to configure a new SecurityDescriptor that allows a service to be hidden from other utilities such as 'sc.exe', 'Get-Service'...etc. (Works only in powershell 7)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Verclsid.exe Runs COM Object - winevent]
description = Detects when verclsid.exe is used to run COM object via GUID
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\verclsid.exe" OR OriginalFileName="verclsid.exe") ((Process_Command_Line="*/S*" Process_Command_Line="*/C*")))) | table Process_Command_Line | eval sigma_attack_tags="attack.defense_evasion attack.t1218" | eval sigma_title="Verclsid.exe Runs COM Object" | eval sigma_description="Detects when verclsid.exe is used to run COM object via GUID"
dispatch.earliest_time = -24h@h
alert.track = 0

[Verclsid.exe Runs COM Object - sysmon]
description = Detects when verclsid.exe is used to run COM object via GUID
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\verclsid.exe" OR OriginalFileName="verclsid.exe") ((CommandLine="*/S*" CommandLine="*/C*")))) | table CommandLine | eval sigma_attack_tags="attack.defense_evasion attack.t1218" | eval sigma_title="Verclsid.exe Runs COM Object" | eval sigma_description="Detects when verclsid.exe is used to run COM object via GUID"
dispatch.earliest_time = -24h@h
alert.track = 0

[VMToolsd Suspicious Child Process - winevent]
description = Detects suspicious child process creations of VMware Tools process which may indicate persistence setup
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((Creator_Process_Name="*\\vmtoolsd.exe" ((New_Process_Name="*\\cmd.exe" OR New_Process_Name="*\\powershell.exe" OR New_Process_Name="*\\pwsh.exe" OR New_Process_Name="*\\rundll32.exe" OR New_Process_Name="*\\regsvr32.exe" OR New_Process_Name="*\\wscript.exe" OR New_Process_Name="*\\cscript.exe") OR (OriginalFileName="Cmd.Exe" OR OriginalFileName="PowerShell.EXE" OR OriginalFileName="pwsh.dll" OR OriginalFileName="RUNDLL32.EXE" OR OriginalFileName="REGSVR32.EXE" OR OriginalFileName="wscript.exe" OR OriginalFileName="cscript.exe")))) NOT (((Process_Command_Line="*\\VMware\\VMware Tools\\poweron-vm-default.bat*" OR Process_Command_Line="*\\VMware\\VMware Tools\\poweroff-vm-default.bat*" OR Process_Command_Line="*\\VMware\\VMware Tools\\resume-vm-default.bat*" OR Process_Command_Line="*\\VMware\\VMware Tools\\suspend-vm-default.bat*"))))) | table Process_Command_Line,ParentCommandLine,NewValue | eval sigma_attack_tags="attack.execution attack.persistence attack.t1059" | eval sigma_title="VMToolsd Suspicious Child Process" | eval sigma_description="Detects suspicious child process creations of VMware Tools process which may indicate persistence setup"
dispatch.earliest_time = -24h@h
alert.track = 0

[VMToolsd Suspicious Child Process - sysmon]
description = Detects suspicious child process creations of VMware Tools process which may indicate persistence setup
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((ParentImage="*\\vmtoolsd.exe" ((Image="*\\cmd.exe" OR Image="*\\powershell.exe" OR Image="*\\pwsh.exe" OR Image="*\\rundll32.exe" OR Image="*\\regsvr32.exe" OR Image="*\\wscript.exe" OR Image="*\\cscript.exe") OR (OriginalFileName="Cmd.Exe" OR OriginalFileName="PowerShell.EXE" OR OriginalFileName="pwsh.dll" OR OriginalFileName="RUNDLL32.EXE" OR OriginalFileName="REGSVR32.EXE" OR OriginalFileName="wscript.exe" OR OriginalFileName="cscript.exe")))) NOT (((CommandLine="*\\VMware\\VMware Tools\\poweron-vm-default.bat*" OR CommandLine="*\\VMware\\VMware Tools\\poweroff-vm-default.bat*" OR CommandLine="*\\VMware\\VMware Tools\\resume-vm-default.bat*" OR CommandLine="*\\VMware\\VMware Tools\\suspend-vm-default.bat*"))))) | table CommandLine,ParentCommandLine,Details | eval sigma_attack_tags="attack.execution attack.persistence attack.t1059" | eval sigma_title="VMToolsd Suspicious Child Process" | eval sigma_description="Detects suspicious child process creations of VMware Tools process which may indicate persistence setup"
dispatch.earliest_time = -24h@h
alert.track = 0

[VsCode Child Process Anomaly - winevent]
description = Detects uncommon or suspicious child processes spawning from a VsCode 'code.exe' process. This could indicate an attempt of persistence via VsCode tasks or terminal profiles.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) Creator_Process_Name="*\\code.exe" ((New_Process_Name="*\\calc.exe" OR New_Process_Name="*\\regsvr32.exe" OR New_Process_Name="*\\rundll32.exe" OR New_Process_Name="*\\cscript.exe" OR New_Process_Name="*\\wscript.exe") OR (((New_Process_Name="*\\powershell.exe" OR New_Process_Name="*\\pwsh.exe" OR New_Process_Name="*\\cmd.exe") (Process_Command_Line="*Invoke-Expressions*" OR Process_Command_Line="*IEX*" OR Process_Command_Line="*Invoke-Command*" OR Process_Command_Line="*ICM*" OR Process_Command_Line="*DownloadString*" OR Process_Command_Line="*rundll32*" OR Process_Command_Line="*regsvr32*" OR Process_Command_Line="*wscript*" OR Process_Command_Line="*cscript*"))) OR (New_Process_Name="*C:\\Users\\Public\\*" OR New_Process_Name="*C:\\Windows\\Temp\\*" OR New_Process_Name="*C:\\Temp\\*")))) | eval sigma_attack_tags="attack.execution attack.defense_evasion attack.t1218 attack.t1202" | eval sigma_title="VsCode Child Process Anomaly" | eval sigma_description="Detects uncommon or suspicious child processes spawning from a VsCode 'code.exe' process. This could indicate an attempt of persistence via VsCode tasks or terminal profiles."
dispatch.earliest_time = -24h@h
alert.track = 0

[VsCode Child Process Anomaly - sysmon]
description = Detects uncommon or suspicious child processes spawning from a VsCode 'code.exe' process. This could indicate an attempt of persistence via VsCode tasks or terminal profiles.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ParentImage="*\\code.exe" ((Image="*\\calc.exe" OR Image="*\\regsvr32.exe" OR Image="*\\rundll32.exe" OR Image="*\\cscript.exe" OR Image="*\\wscript.exe") OR (((Image="*\\powershell.exe" OR Image="*\\pwsh.exe" OR Image="*\\cmd.exe") (CommandLine="*Invoke-Expressions*" OR CommandLine="*IEX*" OR CommandLine="*Invoke-Command*" OR CommandLine="*ICM*" OR CommandLine="*DownloadString*" OR CommandLine="*rundll32*" OR CommandLine="*regsvr32*" OR CommandLine="*wscript*" OR CommandLine="*cscript*"))) OR (Image="*C:\\Users\\Public\\*" OR Image="*C:\\Windows\\Temp\\*" OR Image="*C:\\Temp\\*")))) | eval sigma_attack_tags="attack.execution attack.defense_evasion attack.t1218 attack.t1202" | eval sigma_title="VsCode Child Process Anomaly" | eval sigma_description="Detects uncommon or suspicious child processes spawning from a VsCode 'code.exe' process. This could indicate an attempt of persistence via VsCode tasks or terminal profiles."
dispatch.earliest_time = -24h@h
alert.track = 0

[Java Running with Remote Debugging - winevent]
description = Detects a JAVA process running with remote debugging allowing more than just localhost to connect
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((Process_Command_Line="*transport=dt_socket,address=*" (Process_Command_Line="*jre1.*" OR Process_Command_Line="*jdk1.*"))) NOT (((Process_Command_Line="*address=127.0.0.1*" OR Process_Command_Line="*address=localhost*"))))) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.t1203 attack.execution" | eval sigma_title="Java Running with Remote Debugging" | eval sigma_description="Detects a JAVA process running with remote debugging allowing more than just localhost to connect"
dispatch.earliest_time = -24h@h
alert.track = 0

[Java Running with Remote Debugging - sysmon]
description = Detects a JAVA process running with remote debugging allowing more than just localhost to connect
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((CommandLine="*transport=dt_socket,address=*" (CommandLine="*jre1.*" OR CommandLine="*jdk1.*"))) NOT (((CommandLine="*address=127.0.0.1*" OR CommandLine="*address=localhost*"))))) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.t1203 attack.execution" | eval sigma_title="Java Running with Remote Debugging" | eval sigma_description="Detects a JAVA process running with remote debugging allowing more than just localhost to connect"
dispatch.earliest_time = -24h@h
alert.track = 0

[Use of W32tm as Timer - winevent]
description = When configured with suitable command line arguments, w32tm can act as a delay mechanism
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\w32tm.exe" OR OriginalFileName="w32time.dll") ((Process_Command_Line="*/stripchart*" Process_Command_Line="*/computer:*" Process_Command_Line="*/period:*" Process_Command_Line="*/dataonly*" Process_Command_Line="*/samples:*")))) | eval sigma_attack_tags="attack.discovery attack.t1124" | eval sigma_title="Use of W32tm as Timer" | eval sigma_description="When configured with suitable command line arguments, w32tm can act as a delay mechanism"
dispatch.earliest_time = -24h@h
alert.track = 0

[Use of W32tm as Timer - sysmon]
description = When configured with suitable command line arguments, w32tm can act as a delay mechanism
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\w32tm.exe" OR OriginalFileName="w32time.dll") ((CommandLine="*/stripchart*" CommandLine="*/computer:*" CommandLine="*/period:*" CommandLine="*/dataonly*" CommandLine="*/samples:*")))) | eval sigma_attack_tags="attack.discovery attack.t1124" | eval sigma_title="Use of W32tm as Timer" | eval sigma_description="When configured with suitable command line arguments, w32tm can act as a delay mechanism"
dispatch.earliest_time = -24h@h
alert.track = 0

[Wab Execution From Non Default Location - winevent]
description = Detects execution of wab.exe (Windows Contacts) and Wabmig.exe (Microsoft Address Book Import Tool) from non default locations as seen with bumblebee activity
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\wab.exe" OR New_Process_Name="*\\wabmig.exe") NOT (((New_Process_Name="C:\\Windows\\WinSxS\\*" OR New_Process_Name="C:\\Program Files\\Windows Mail\\*" OR New_Process_Name="C:\\Program Files (x86)\\Windows Mail\\*"))))) | eval sigma_attack_tags="attack.defense_evasion attack.execution" | eval sigma_title="Wab Execution From Non Default Location" | eval sigma_description="Detects execution of wab.exe (Windows Contacts) and Wabmig.exe (Microsoft Address Book Import Tool) from non default locations as seen with bumblebee activity"
dispatch.earliest_time = -24h@h
alert.track = 0

[Wab Execution From Non Default Location - sysmon]
description = Detects execution of wab.exe (Windows Contacts) and Wabmig.exe (Microsoft Address Book Import Tool) from non default locations as seen with bumblebee activity
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\wab.exe" OR Image="*\\wabmig.exe") NOT (((Image="C:\\Windows\\WinSxS\\*" OR Image="C:\\Program Files\\Windows Mail\\*" OR Image="C:\\Program Files (x86)\\Windows Mail\\*"))))) | eval sigma_attack_tags="attack.defense_evasion attack.execution" | eval sigma_title="Wab Execution From Non Default Location" | eval sigma_description="Detects execution of wab.exe (Windows Contacts) and Wabmig.exe (Microsoft Address Book Import Tool) from non default locations as seen with bumblebee activity"
dispatch.earliest_time = -24h@h
alert.track = 0

[Wab/Wabmig Unusual Parent Or Child Processes - winevent]
description = Detects unusual parent or children of the wab.exe (Windows Contacts) and Wabmig.exe (Microsoft Address Book Import Tool) processes as seen being used with bumblebee activity
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((((Creator_Process_Name="*\\WmiPrvSE.exe" OR Creator_Process_Name="*\\svchost.exe" OR Creator_Process_Name="*\\dllhost.exe") (New_Process_Name="*\\wab.exe" OR New_Process_Name="*\\wabmig.exe"))) OR (Creator_Process_Name="*\\wab.exe" OR Creator_Process_Name="*\\wabmig.exe")))) | eval sigma_attack_tags="attack.defense_evasion attack.execution" | eval sigma_title="Wab/Wabmig Unusual Parent Or Child Processes" | eval sigma_description="Detects unusual parent or children of the wab.exe (Windows Contacts) and Wabmig.exe (Microsoft Address Book Import Tool) processes as seen being used with bumblebee activity"
dispatch.earliest_time = -24h@h
alert.track = 0

[Wab/Wabmig Unusual Parent Or Child Processes - sysmon]
description = Detects unusual parent or children of the wab.exe (Windows Contacts) and Wabmig.exe (Microsoft Address Book Import Tool) processes as seen being used with bumblebee activity
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((((ParentImage="*\\WmiPrvSE.exe" OR ParentImage="*\\svchost.exe" OR ParentImage="*\\dllhost.exe") (Image="*\\wab.exe" OR Image="*\\wabmig.exe"))) OR (ParentImage="*\\wab.exe" OR ParentImage="*\\wabmig.exe")))) | eval sigma_attack_tags="attack.defense_evasion attack.execution" | eval sigma_title="Wab/Wabmig Unusual Parent Or Child Processes" | eval sigma_description="Detects unusual parent or children of the wab.exe (Windows Contacts) and Wabmig.exe (Microsoft Address Book Import Tool) processes as seen being used with bumblebee activity"
dispatch.earliest_time = -24h@h
alert.track = 0

[Weak or Abused Passwords In CLI - winevent]
description = Detects weak passwords or often abused passwords (seen used by threat actors) via the CLI. An example would be a threat actor creating a new user via the net command and providing the password inline
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (Process_Command_Line="*Asd123.aaaa*" OR Process_Command_Line="*password123*" OR Process_Command_Line="*123456789*" OR Process_Command_Line="*P@ssw0rd!*"))) | eval sigma_attack_tags="attack.defense_evasion attack.execution" | eval sigma_title="Weak or Abused Passwords In CLI" | eval sigma_description="Detects weak passwords or often abused passwords (seen used by threat actors) via the CLI. An example would be a threat actor creating a new user via the net command and providing the password inline"
dispatch.earliest_time = -24h@h
alert.track = 0

[Weak or Abused Passwords In CLI - sysmon]
description = Detects weak passwords or often abused passwords (seen used by threat actors) via the CLI. An example would be a threat actor creating a new user via the net command and providing the password inline
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (CommandLine="*Asd123.aaaa*" OR CommandLine="*password123*" OR CommandLine="*123456789*" OR CommandLine="*P@ssw0rd!*"))) | eval sigma_attack_tags="attack.defense_evasion attack.execution" | eval sigma_title="Weak or Abused Passwords In CLI" | eval sigma_description="Detects weak passwords or often abused passwords (seen used by threat actors) via the CLI. An example would be a threat actor creating a new user via the net command and providing the password inline"
dispatch.earliest_time = -24h@h
alert.track = 0

[Usage Of Web Request Commands And Cmdlets - winevent]
description = Detects the use of various web request commands with commandline tools and Windows PowerShell cmdlets (including aliases) viq CommandLine
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (Process_Command_Line="*Invoke-WebRequest*" OR Process_Command_Line="*iwr *" OR Process_Command_Line="*wget *" OR Process_Command_Line="*curl *" OR Process_Command_Line="*Net.WebClient*" OR Process_Command_Line="*Start-BitsTransfer*" OR Process_Command_Line="*Resume-BitsTransfer*" OR Process_Command_Line="*[System.Net.WebRequest]::create*" OR Process_Command_Line="*Invoke-RestMethod*" OR Process_Command_Line="*WinHttp.WinHttpRequest*"))) | eval sigma_attack_tags="attack.execution attack.t1059.001" | eval sigma_title="Usage Of Web Request Commands And Cmdlets" | eval sigma_description="Detects the use of various web request commands with commandline tools and Windows PowerShell cmdlets (including aliases) viq CommandLine"
dispatch.earliest_time = -24h@h
alert.track = 0

[Usage Of Web Request Commands And Cmdlets - sysmon]
description = Detects the use of various web request commands with commandline tools and Windows PowerShell cmdlets (including aliases) viq CommandLine
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (CommandLine="*Invoke-WebRequest*" OR CommandLine="*iwr *" OR CommandLine="*wget *" OR CommandLine="*curl *" OR CommandLine="*Net.WebClient*" OR CommandLine="*Start-BitsTransfer*" OR CommandLine="*Resume-BitsTransfer*" OR CommandLine="*[System.Net.WebRequest]::create*" OR CommandLine="*Invoke-RestMethod*" OR CommandLine="*WinHttp.WinHttpRequest*"))) | eval sigma_attack_tags="attack.execution attack.t1059.001" | eval sigma_title="Usage Of Web Request Commands And Cmdlets" | eval sigma_description="Detects the use of various web request commands with commandline tools and Windows PowerShell cmdlets (including aliases) viq CommandLine"
dispatch.earliest_time = -24h@h
alert.track = 0

[Launch WebBrowserPassView Executable - winevent]
description = Detect use of WebBrowserPassView.exe
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (Description="Web Browser Password Viewer" OR New_Process_Name="*\\WebBrowserPassView.exe"))) | eval sigma_attack_tags="attack.credential_access attack.t1555.003" | eval sigma_title="Launch WebBrowserPassView Executable" | eval sigma_description="Detect use of WebBrowserPassView.exe"
dispatch.earliest_time = -24h@h
alert.track = 0

[Launch WebBrowserPassView Executable - sysmon]
description = Detect use of WebBrowserPassView.exe
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Description="Web Browser Password Viewer" OR Image="*\\WebBrowserPassView.exe"))) | eval sigma_attack_tags="attack.credential_access attack.t1555.003" | eval sigma_title="Launch WebBrowserPassView Executable" | eval sigma_description="Detect use of WebBrowserPassView.exe"
dispatch.earliest_time = -24h@h
alert.track = 0

[Chopper Webshell Process Pattern - winevent]
description = Detects patterns found in process executions cause by China Chopper like tiny (ASPX) webshells
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\w3wp.exe" OR Creator_Process_Name="*\\w3wp.exe") (Process_Command_Line="*&ipconfig&echo*" OR Process_Command_Line="*&quser&echo*" OR Process_Command_Line="*&whoami&echo*" OR Process_Command_Line="*&c:&echo*" OR Process_Command_Line="*&cd&echo*" OR Process_Command_Line="*&dir&echo*" OR Process_Command_Line="*&echo [E]*" OR Process_Command_Line="*&echo [S]*"))) | eval sigma_attack_tags="attack.persistence attack.t1505.003 attack.t1018 attack.t1033 attack.t1087" | eval sigma_title="Chopper Webshell Process Pattern" | eval sigma_description="Detects patterns found in process executions cause by China Chopper like tiny (ASPX) webshells"
dispatch.earliest_time = -24h@h
alert.track = 0

[Chopper Webshell Process Pattern - sysmon]
description = Detects patterns found in process executions cause by China Chopper like tiny (ASPX) webshells
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\w3wp.exe" OR ParentImage="*\\w3wp.exe") (CommandLine="*&ipconfig&echo*" OR CommandLine="*&quser&echo*" OR CommandLine="*&whoami&echo*" OR CommandLine="*&c:&echo*" OR CommandLine="*&cd&echo*" OR CommandLine="*&dir&echo*" OR CommandLine="*&echo [E]*" OR CommandLine="*&echo [S]*"))) | eval sigma_attack_tags="attack.persistence attack.t1505.003 attack.t1018 attack.t1033 attack.t1087" | eval sigma_title="Chopper Webshell Process Pattern" | eval sigma_description="Detects patterns found in process executions cause by China Chopper like tiny (ASPX) webshells"
dispatch.earliest_time = -24h@h
alert.track = 0

[Webshell Detection With Command Line Keywords - winevent]
description = Detects certain command line parameters often used during reconnaissance activity via web shells
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((Creator_Process_Name="*\\w3wp.exe" OR Creator_Process_Name="*\\php-cgi.exe" OR Creator_Process_Name="*\\nginx.exe" OR Creator_Process_Name="*\\httpd.exe" OR Creator_Process_Name="*\\caddy.exe" OR Creator_Process_Name="*\\ws_tomcatservice.exe") OR (((Creator_Process_Name="*\\java.exe" OR Creator_Process_Name="*\\javaw.exe") (Creator_Process_Name="*-tomcat-*" OR Creator_Process_Name="*\\tomcat*"))) OR (((Creator_Process_Name="*\\java.exe" OR Creator_Process_Name="*\\javaw.exe") (Process_Command_Line="*catalina.jar*" OR Process_Command_Line="*CATALINA_HOME*")))) ((((OriginalFileName="net.exe" OR OriginalFileName="net1.exe") (Process_Command_Line="* user *" OR Process_Command_Line="* use *" OR Process_Command_Line="* group *"))) OR ((OriginalFileName="ping.exe" Process_Command_Line="* -n *")) OR (Process_Command_Line="*&cd&echo*" OR Process_Command_Line="*cd /d *") OR ((OriginalFileName="wmic.exe" Process_Command_Line="* /node:*")) OR ((New_Process_Name="*\\whoami.exe" OR New_Process_Name="*\\systeminfo.exe" OR New_Process_Name="*\\quser.exe" OR New_Process_Name="*\\ipconfig.exe" OR New_Process_Name="*\\pathping.exe" OR New_Process_Name="*\\tracert.exe" OR New_Process_Name="*\\netstat.exe" OR New_Process_Name="*\\schtasks.exe" OR New_Process_Name="*\\vssadmin.exe" OR New_Process_Name="*\\wevtutil.exe" OR New_Process_Name="*\\tasklist.exe") OR (OriginalFileName="whoami.exe" OR OriginalFileName="sysinfo.exe" OR OriginalFileName="quser.exe" OR OriginalFileName="ipconfig.exe" OR OriginalFileName="pathping.exe" OR OriginalFileName="tracert.exe" OR OriginalFileName="netstat.exe" OR OriginalFileName="schtasks.exe" OR OriginalFileName="VSSADMIN.EXE" OR OriginalFileName="wevtutil.exe" OR OriginalFileName="tasklist.exe")) OR (Process_Command_Line="* Test-NetConnection *" OR Process_Command_Line="*dir \\*")))) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.persistence attack.t1505.003 attack.t1018 attack.t1033 attack.t1087" | eval sigma_title="Webshell Detection With Command Line Keywords" | eval sigma_description="Detects certain command line parameters often used during reconnaissance activity via web shells"
dispatch.earliest_time = -24h@h
alert.track = 0

[Webshell Detection With Command Line Keywords - sysmon]
description = Detects certain command line parameters often used during reconnaissance activity via web shells
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((ParentImage="*\\w3wp.exe" OR ParentImage="*\\php-cgi.exe" OR ParentImage="*\\nginx.exe" OR ParentImage="*\\httpd.exe" OR ParentImage="*\\caddy.exe" OR ParentImage="*\\ws_tomcatservice.exe") OR (((ParentImage="*\\java.exe" OR ParentImage="*\\javaw.exe") (ParentImage="*-tomcat-*" OR ParentImage="*\\tomcat*"))) OR (((ParentImage="*\\java.exe" OR ParentImage="*\\javaw.exe") (CommandLine="*catalina.jar*" OR CommandLine="*CATALINA_HOME*")))) ((((OriginalFileName="net.exe" OR OriginalFileName="net1.exe") (CommandLine="* user *" OR CommandLine="* use *" OR CommandLine="* group *"))) OR ((OriginalFileName="ping.exe" CommandLine="* -n *")) OR (CommandLine="*&cd&echo*" OR CommandLine="*cd /d *") OR ((OriginalFileName="wmic.exe" CommandLine="* /node:*")) OR ((Image="*\\whoami.exe" OR Image="*\\systeminfo.exe" OR Image="*\\quser.exe" OR Image="*\\ipconfig.exe" OR Image="*\\pathping.exe" OR Image="*\\tracert.exe" OR Image="*\\netstat.exe" OR Image="*\\schtasks.exe" OR Image="*\\vssadmin.exe" OR Image="*\\wevtutil.exe" OR Image="*\\tasklist.exe") OR (OriginalFileName="whoami.exe" OR OriginalFileName="sysinfo.exe" OR OriginalFileName="quser.exe" OR OriginalFileName="ipconfig.exe" OR OriginalFileName="pathping.exe" OR OriginalFileName="tracert.exe" OR OriginalFileName="netstat.exe" OR OriginalFileName="schtasks.exe" OR OriginalFileName="VSSADMIN.EXE" OR OriginalFileName="wevtutil.exe" OR OriginalFileName="tasklist.exe")) OR (CommandLine="* Test-NetConnection *" OR CommandLine="*dir \\*")))) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.persistence attack.t1505.003 attack.t1018 attack.t1033 attack.t1087" | eval sigma_title="Webshell Detection With Command Line Keywords" | eval sigma_description="Detects certain command line parameters often used during reconnaissance activity via web shells"
dispatch.earliest_time = -24h@h
alert.track = 0

[Webshell Hacking Activity Patterns - winevent]
description = Detects certain parent child patterns found in cases in which a webshell is used to perform certain credential dumping or exfiltration activities on a compromised system
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((Creator_Process_Name="*\\w3wp.exe" OR Creator_Process_Name="*\\php-cgi.exe" OR Creator_Process_Name="*\\nginx.exe" OR Creator_Process_Name="*\\httpd.exe" OR Creator_Process_Name="*\\caddy.exe" OR Creator_Process_Name="*\\ws_tomcatservice.exe") OR (((Creator_Process_Name="*\\java.exe" OR Creator_Process_Name="*\\javaw.exe") (Creator_Process_Name="*-tomcat-*" OR Creator_Process_Name="*\\tomcat*"))) OR (((Creator_Process_Name="*\\java.exe" OR Creator_Process_Name="*\\javaw.exe") (Process_Command_Line="*catalina.jar*" OR Process_Command_Line="*CATALINA_HOME*")))) (((Process_Command_Line="*rundll32*" Process_Command_Line="*comsvcs*")) OR ((Process_Command_Line="* -hp*" Process_Command_Line="* a *" Process_Command_Line="* -m*")) OR ((Process_Command_Line="*net*" Process_Command_Line="* user *" Process_Command_Line="* /add*")) OR ((Process_Command_Line="*net*" Process_Command_Line="* localgroup *" Process_Command_Line="* administrators *" Process_Command_Line="*/add*")) OR (New_Process_Name="*\\ntdsutil.exe" OR New_Process_Name="*\\ldifde.exe" OR New_Process_Name="*\\adfind.exe" OR New_Process_Name="*\\procdump.exe" OR New_Process_Name="*\\Nanodump.exe" OR New_Process_Name="*\\vssadmin.exe" OR New_Process_Name="*\\fsutil.exe") OR (Process_Command_Line="* -NoP *" OR Process_Command_Line="* -W Hidden *" OR Process_Command_Line="* -decode *" OR Process_Command_Line="* /decode *" OR Process_Command_Line="*reg save *" OR Process_Command_Line="*.downloadstring(*" OR Process_Command_Line="*.downloadfile(*" OR Process_Command_Line="*FromBase64String*" OR Process_Command_Line="* /ticket:*" OR Process_Command_Line="* sekurlsa*" OR Process_Command_Line="*.dmp full*" OR Process_Command_Line="*process call create*" OR Process_Command_Line="*whoami /priv*")))) | eval sigma_attack_tags="attack.persistence attack.t1505.003 attack.t1018 attack.t1033 attack.t1087" | eval sigma_title="Webshell Hacking Activity Patterns" | eval sigma_description="Detects certain parent child patterns found in cases in which a webshell is used to perform certain credential dumping or exfiltration activities on a compromised system"
dispatch.earliest_time = -24h@h
alert.track = 0

[Webshell Hacking Activity Patterns - sysmon]
description = Detects certain parent child patterns found in cases in which a webshell is used to perform certain credential dumping or exfiltration activities on a compromised system
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((ParentImage="*\\w3wp.exe" OR ParentImage="*\\php-cgi.exe" OR ParentImage="*\\nginx.exe" OR ParentImage="*\\httpd.exe" OR ParentImage="*\\caddy.exe" OR ParentImage="*\\ws_tomcatservice.exe") OR (((ParentImage="*\\java.exe" OR ParentImage="*\\javaw.exe") (ParentImage="*-tomcat-*" OR ParentImage="*\\tomcat*"))) OR (((ParentImage="*\\java.exe" OR ParentImage="*\\javaw.exe") (CommandLine="*catalina.jar*" OR CommandLine="*CATALINA_HOME*")))) (((CommandLine="*rundll32*" CommandLine="*comsvcs*")) OR ((CommandLine="* -hp*" CommandLine="* a *" CommandLine="* -m*")) OR ((CommandLine="*net*" CommandLine="* user *" CommandLine="* /add*")) OR ((CommandLine="*net*" CommandLine="* localgroup *" CommandLine="* administrators *" CommandLine="*/add*")) OR (Image="*\\ntdsutil.exe" OR Image="*\\ldifde.exe" OR Image="*\\adfind.exe" OR Image="*\\procdump.exe" OR Image="*\\Nanodump.exe" OR Image="*\\vssadmin.exe" OR Image="*\\fsutil.exe") OR (CommandLine="* -NoP *" OR CommandLine="* -W Hidden *" OR CommandLine="* -decode *" OR CommandLine="* /decode *" OR CommandLine="*reg save *" OR CommandLine="*.downloadstring(*" OR CommandLine="*.downloadfile(*" OR CommandLine="*FromBase64String*" OR CommandLine="* /ticket:*" OR CommandLine="* sekurlsa*" OR CommandLine="*.dmp full*" OR CommandLine="*process call create*" OR CommandLine="*whoami /priv*")))) | eval sigma_attack_tags="attack.persistence attack.t1505.003 attack.t1018 attack.t1033 attack.t1087" | eval sigma_title="Webshell Hacking Activity Patterns" | eval sigma_description="Detects certain parent child patterns found in cases in which a webshell is used to perform certain credential dumping or exfiltration activities on a compromised system"
dispatch.earliest_time = -24h@h
alert.track = 0

[Webshell Recon Detection Via CommandLine & Processes - winevent]
description = Detects processes spawned from web servers (php, tomcat, iis...etc) that perform reconnaissance looking for the existence of popular scripting tools (perl, python, wget) on the system via the help commands
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((Creator_Process_Name="*\\w3wp.exe" OR Creator_Process_Name="*\\php-cgi.exe" OR Creator_Process_Name="*\\nginx.exe" OR Creator_Process_Name="*\\httpd.exe" OR Creator_Process_Name="*\\caddy.exe" OR Creator_Process_Name="*\\ws_tomcatservice.exe") OR (((Creator_Process_Name="*\\java.exe" OR Creator_Process_Name="*\\javaw.exe") (Creator_Process_Name="*-tomcat-*" OR Creator_Process_Name="*\\tomcat*"))) OR (((Creator_Process_Name="*\\java.exe" OR Creator_Process_Name="*\\javaw.exe") (Process_Command_Line="*catalina.jar*" OR Process_Command_Line="*CATALINA_HOME*")))) (Process_Command_Line="*perl --help*" OR Process_Command_Line="*python --help*" OR Process_Command_Line="*python -h*" OR Process_Command_Line="*python3 --help*" OR Process_Command_Line="*python3 -h*" OR Process_Command_Line="*wget --help*" OR Process_Command_Line="*perl -h*"))) | table New_Process_Name,Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.persistence attack.t1505.003" | eval sigma_title="Webshell Recon Detection Via CommandLine & Processes" | eval sigma_description="Detects processes spawned from web servers (php, tomcat, iis...etc) that perform reconnaissance looking for the existence of popular scripting tools (perl, python, wget) on the system via the help commands"
dispatch.earliest_time = -24h@h
alert.track = 0

[Webshell Recon Detection Via CommandLine & Processes - sysmon]
description = Detects processes spawned from web servers (php, tomcat, iis...etc) that perform reconnaissance looking for the existence of popular scripting tools (perl, python, wget) on the system via the help commands
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((ParentImage="*\\w3wp.exe" OR ParentImage="*\\php-cgi.exe" OR ParentImage="*\\nginx.exe" OR ParentImage="*\\httpd.exe" OR ParentImage="*\\caddy.exe" OR ParentImage="*\\ws_tomcatservice.exe") OR (((ParentImage="*\\java.exe" OR ParentImage="*\\javaw.exe") (ParentImage="*-tomcat-*" OR ParentImage="*\\tomcat*"))) OR (((ParentImage="*\\java.exe" OR ParentImage="*\\javaw.exe") (CommandLine="*catalina.jar*" OR CommandLine="*CATALINA_HOME*")))) (CommandLine="*perl --help*" OR CommandLine="*python --help*" OR CommandLine="*python -h*" OR CommandLine="*python3 --help*" OR CommandLine="*python3 -h*" OR CommandLine="*wget --help*" OR CommandLine="*perl -h*"))) | table Image,CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.persistence attack.t1505.003" | eval sigma_title="Webshell Recon Detection Via CommandLine & Processes" | eval sigma_description="Detects processes spawned from web servers (php, tomcat, iis...etc) that perform reconnaissance looking for the existence of popular scripting tools (perl, python, wget) on the system via the help commands"
dispatch.earliest_time = -24h@h
alert.track = 0

[Shells Spawned by Web Servers - winevent]
description = Detects web servers that spawn shell processes which could be the result of a successfully placed web shell or another attack
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((((Creator_Process_Name="*\\w3wp.exe" OR Creator_Process_Name="*\\php.exe" OR Creator_Process_Name="*\\php-cgi.exe" OR Creator_Process_Name="*\\nginx.exe" OR Creator_Process_Name="*\\httpd.exe" OR Creator_Process_Name="*\\caddy.exe" OR Creator_Process_Name="*\\ws_TomcatService.exe" OR Creator_Process_Name="*\\tomcat.exe" OR Creator_Process_Name="*\\UMWorkerProcess.exe") OR (((Creator_Process_Name="*\\java.exe" OR Creator_Process_Name="*\\javaw.exe") (Creator_Process_Name="*-tomcat-*" OR Creator_Process_Name="*\\tomcat*"))) OR (((Creator_Process_Name="*\\java.exe" OR Creator_Process_Name="*\\javaw.exe") (ParentCommandLine="*catalina.jar*" OR ParentCommandLine="*CATALINA_HOME*" OR ParentCommandLine="*catalina.home*")))) (New_Process_Name="*\\cmd.exe" OR New_Process_Name="*\\cscript.exe" OR New_Process_Name="*\\sh.exe" OR New_Process_Name="*\\bash.exe" OR New_Process_Name="*\\powershell.exe" OR New_Process_Name="*\\powershell_ise.exe" OR New_Process_Name="*\\pwsh.exe" OR New_Process_Name="*\\bitsadmin.exe" OR New_Process_Name="*\\arp.exe" OR New_Process_Name="*\\at.exe" OR New_Process_Name="*\\certutil.exe" OR New_Process_Name="*\\dsget.exe" OR New_Process_Name="*\\dsquery.exe" OR New_Process_Name="*\\find.exe" OR New_Process_Name="*\\findstr.exe" OR New_Process_Name="*\\fsutil.exe" OR New_Process_Name="*\\hostname.exe" OR New_Process_Name="*\\ipconfig.exe" OR New_Process_Name="*\\nbtstat.exe" OR New_Process_Name="*\\net.exe" OR New_Process_Name="*\\net1.exe" OR New_Process_Name="*\\netdom.exe" OR New_Process_Name="*\\netsh.exe" OR New_Process_Name="*\\netstat.exe" OR New_Process_Name="*\\nltest.exe" OR New_Process_Name="*\\nslookup.exe" OR New_Process_Name="*\\ntdutil.exe" OR New_Process_Name="*\\pathping.exe" OR New_Process_Name="*\\ping.exe" OR New_Process_Name="*\\qprocess.exe" OR New_Process_Name="*\\query.exe" OR New_Process_Name="*\\qwinsta.exe" OR New_Process_Name="*\\reg.exe" OR New_Process_Name="*\\rundll32.exe" OR New_Process_Name="*\\sc.exe" OR New_Process_Name="*\\schtasks.exe" OR New_Process_Name="*\\systeminfo.exe" OR New_Process_Name="*\\tasklist.exe" OR New_Process_Name="*\\tracert.exe" OR New_Process_Name="*\\ver.exe" OR New_Process_Name="*\\vssadmin.exe" OR New_Process_Name="*\\wevtutil.exe" OR New_Process_Name="*\\whoami.exe" OR New_Process_Name="*\\wmic.exe" OR New_Process_Name="*\\wscript.exe" OR New_Process_Name="*\\wusa.exe"))) NOT (((Process_Command_Line="*Windows\\system32\\cmd.exe /c C:\\ManageEngine\\ADManager \"Plus\\ES\\bin\\elasticsearch.bat -Enode.name=RMP-NODE1 -pelasticsearch-pid.txt")) OR (((Process_Command_Line="*sc query*" Process_Command_Line="*ADManager Plus*")))))) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.persistence attack.t1505.003 attack.t1190" | eval sigma_title="Shells Spawned by Web Servers" | eval sigma_description="Detects web servers that spawn shell processes which could be the result of a successfully placed web shell or another attack"
dispatch.earliest_time = -24h@h
alert.track = 0

[Shells Spawned by Web Servers - sysmon]
description = Detects web servers that spawn shell processes which could be the result of a successfully placed web shell or another attack
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((((ParentImage="*\\w3wp.exe" OR ParentImage="*\\php.exe" OR ParentImage="*\\php-cgi.exe" OR ParentImage="*\\nginx.exe" OR ParentImage="*\\httpd.exe" OR ParentImage="*\\caddy.exe" OR ParentImage="*\\ws_TomcatService.exe" OR ParentImage="*\\tomcat.exe" OR ParentImage="*\\UMWorkerProcess.exe") OR (((ParentImage="*\\java.exe" OR ParentImage="*\\javaw.exe") (ParentImage="*-tomcat-*" OR ParentImage="*\\tomcat*"))) OR (((ParentImage="*\\java.exe" OR ParentImage="*\\javaw.exe") (ParentCommandLine="*catalina.jar*" OR ParentCommandLine="*CATALINA_HOME*" OR ParentCommandLine="*catalina.home*")))) (Image="*\\cmd.exe" OR Image="*\\cscript.exe" OR Image="*\\sh.exe" OR Image="*\\bash.exe" OR Image="*\\powershell.exe" OR Image="*\\powershell_ise.exe" OR Image="*\\pwsh.exe" OR Image="*\\bitsadmin.exe" OR Image="*\\arp.exe" OR Image="*\\at.exe" OR Image="*\\certutil.exe" OR Image="*\\dsget.exe" OR Image="*\\dsquery.exe" OR Image="*\\find.exe" OR Image="*\\findstr.exe" OR Image="*\\fsutil.exe" OR Image="*\\hostname.exe" OR Image="*\\ipconfig.exe" OR Image="*\\nbtstat.exe" OR Image="*\\net.exe" OR Image="*\\net1.exe" OR Image="*\\netdom.exe" OR Image="*\\netsh.exe" OR Image="*\\netstat.exe" OR Image="*\\nltest.exe" OR Image="*\\nslookup.exe" OR Image="*\\ntdutil.exe" OR Image="*\\pathping.exe" OR Image="*\\ping.exe" OR Image="*\\qprocess.exe" OR Image="*\\query.exe" OR Image="*\\qwinsta.exe" OR Image="*\\reg.exe" OR Image="*\\rundll32.exe" OR Image="*\\sc.exe" OR Image="*\\schtasks.exe" OR Image="*\\systeminfo.exe" OR Image="*\\tasklist.exe" OR Image="*\\tracert.exe" OR Image="*\\ver.exe" OR Image="*\\vssadmin.exe" OR Image="*\\wevtutil.exe" OR Image="*\\whoami.exe" OR Image="*\\wmic.exe" OR Image="*\\wscript.exe" OR Image="*\\wusa.exe"))) NOT (((CommandLine="*Windows\\system32\\cmd.exe /c C:\\ManageEngine\\ADManager \"Plus\\ES\\bin\\elasticsearch.bat -Enode.name=RMP-NODE1 -pelasticsearch-pid.txt")) OR (((CommandLine="*sc query*" CommandLine="*ADManager Plus*")))))) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.persistence attack.t1505.003 attack.t1190" | eval sigma_title="Shells Spawned by Web Servers" | eval sigma_description="Detects web servers that spawn shell processes which could be the result of a successfully placed web shell or another attack"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential Recon Activity Using Wevtutil - winevent]
description = Detects usage of the wevtutil utility to perform reconnaissance
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\wevtutil.exe" (Process_Command_Line="* qe *" OR Process_Command_Line="* query-events *") (Process_Command_Line="*Microsoft-Windows-TerminalServices-LocalSessionManager/Operational*" OR Process_Command_Line="*Microsoft-Windows-Terminal-Services-RemoteConnectionManager/Operational*" OR Process_Command_Line="*Security*"))) | eval sigma_attack_tags="attack.discovery" | eval sigma_title="Potential Recon Activity Using Wevtutil" | eval sigma_description="Detects usage of the wevtutil utility to perform reconnaissance"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential Recon Activity Using Wevtutil - sysmon]
description = Detects usage of the wevtutil utility to perform reconnaissance
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\wevtutil.exe" (CommandLine="* qe *" OR CommandLine="* query-events *") (CommandLine="*Microsoft-Windows-TerminalServices-LocalSessionManager/Operational*" OR CommandLine="*Microsoft-Windows-Terminal-Services-RemoteConnectionManager/Operational*" OR CommandLine="*Security*"))) | eval sigma_attack_tags="attack.discovery" | eval sigma_title="Potential Recon Activity Using Wevtutil" | eval sigma_description="Detects usage of the wevtutil utility to perform reconnaissance"
dispatch.earliest_time = -24h@h
alert.track = 0

[Run Whoami as Privileged User - winevent]
description = Detects a whoami.exe executed by privileged accounts that are often misused by threat actors
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) Account_Name="*TrustedInstaller*" (OriginalFileName="whoami.exe" OR New_Process_Name="*\\whoami.exe"))) | eval sigma_attack_tags="attack.privilege_escalation attack.discovery attack.t1033" | eval sigma_title="Run Whoami as Privileged User" | eval sigma_description="Detects a whoami.exe executed by privileged accounts that are often misused by threat actors"
dispatch.earliest_time = -24h@h
alert.track = 0

[Run Whoami as Privileged User - sysmon]
description = Detects a whoami.exe executed by privileged accounts that are often misused by threat actors
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) User="*TrustedInstaller*" (OriginalFileName="whoami.exe" OR Image="*\\whoami.exe"))) | eval sigma_attack_tags="attack.privilege_escalation attack.discovery attack.t1033" | eval sigma_title="Run Whoami as Privileged User" | eval sigma_description="Detects a whoami.exe executed by privileged accounts that are often misused by threat actors"
dispatch.earliest_time = -24h@h
alert.track = 0

[Run Whoami as SYSTEM - winevent]
description = Detects a whoami.exe executed by LOCAL SYSTEM. This may be a sign of a successful local privilege escalation.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (Account_Name="*AUTHORI*" OR Account_Name="*AUTORI*") (OriginalFileName="whoami.exe" OR New_Process_Name="*\\whoami.exe"))) | eval sigma_attack_tags="attack.privilege_escalation attack.discovery attack.t1033" | eval sigma_title="Run Whoami as SYSTEM" | eval sigma_description="Detects a whoami.exe executed by LOCAL SYSTEM. This may be a sign of a successful local privilege escalation."
dispatch.earliest_time = -24h@h
alert.track = 0

[Run Whoami as SYSTEM - sysmon]
description = Detects a whoami.exe executed by LOCAL SYSTEM. This may be a sign of a successful local privilege escalation.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (User="*AUTHORI*" OR User="*AUTORI*") (OriginalFileName="whoami.exe" OR Image="*\\whoami.exe"))) | eval sigma_attack_tags="attack.privilege_escalation attack.discovery attack.t1033" | eval sigma_title="Run Whoami as SYSTEM" | eval sigma_description="Detects a whoami.exe executed by LOCAL SYSTEM. This may be a sign of a successful local privilege escalation."
dispatch.earliest_time = -24h@h
alert.track = 0

[Run Whoami Showing Privileges - winevent]
description = Detects a whoami.exe executed with the /priv command line flag instructing the tool to show all current user privieleges. This is often used after a privilege escalation attempt.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\whoami.exe" OR OriginalFileName="whoami.exe") Process_Command_Line="*/priv*")) | eval sigma_attack_tags="attack.privilege_escalation attack.discovery attack.t1033" | eval sigma_title="Run Whoami Showing Privileges" | eval sigma_description="Detects a whoami.exe executed with the /priv command line flag instructing the tool to show all current user privieleges. This is often used after a privilege escalation attempt."
dispatch.earliest_time = -24h@h
alert.track = 0

[Run Whoami Showing Privileges - sysmon]
description = Detects a whoami.exe executed with the /priv command line flag instructing the tool to show all current user privieleges. This is often used after a privilege escalation attempt.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\whoami.exe" OR OriginalFileName="whoami.exe") CommandLine="*/priv*")) | eval sigma_attack_tags="attack.privilege_escalation attack.discovery attack.t1033" | eval sigma_title="Run Whoami Showing Privileges" | eval sigma_description="Detects a whoami.exe executed with the /priv command line flag instructing the tool to show all current user privieleges. This is often used after a privilege escalation attempt."
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious WindowsTerminal Child Processes - winevent]
description = Detects suspicious children spawned via the Windows Terminal application which could be a sign of persistence via WindowsTerminal (see references section)
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((Creator_Process_Name="*\\WindowsTerminal.exe" ((New_Process_Name="*\\rundll32.exe" OR New_Process_Name="*\\regsvr32.exe" OR New_Process_Name="*\\certutil.exe" OR New_Process_Name="*\\cscript.exe" OR New_Process_Name="*\\wscript.exe" OR New_Process_Name="*\\csc.exe") OR (New_Process_Name="*C:\\Users\\Public\\*" OR New_Process_Name="*\\Downloads\\*" OR New_Process_Name="*\\Desktop\\*" OR New_Process_Name="*\\AppData\\Local\\Temp\\*" OR New_Process_Name="*\\Windows\\TEMP\\*") OR (Process_Command_Line="* iex *" OR Process_Command_Line="* icm*" OR Process_Command_Line="*Invoke-*" OR Process_Command_Line="*Import-Module *" OR Process_Command_Line="*ipmo *" OR Process_Command_Line="*DownloadString(*" OR Process_Command_Line="* /c *" OR Process_Command_Line="* /k *" OR Process_Command_Line="* /r *")))) NOT ((((Process_Command_Line="*Import-Module*" Process_Command_Line="*Microsoft.VisualStudio.DevShell.dll*" Process_Command_Line="*Enter-VsDevShell*"))) OR (((Process_Command_Line="*\\AppData\\Local\\Packages\\Microsoft.WindowsTerminal_*" Process_Command_Line="*\\LocalState\\settings.json*"))) OR (((Process_Command_Line="*C:\\Program Files\\Microsoft Visual Studio\\*" Process_Command_Line="*\\Common7\\Tools\\VsDevCmd.bat*")))))) | eval sigma_attack_tags="attack.execution attack.persistence" | eval sigma_title="Suspicious WindowsTerminal Child Processes" | eval sigma_description="Detects suspicious children spawned via the Windows Terminal application which could be a sign of persistence via WindowsTerminal (see references section)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious WindowsTerminal Child Processes - sysmon]
description = Detects suspicious children spawned via the Windows Terminal application which could be a sign of persistence via WindowsTerminal (see references section)
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((ParentImage="*\\WindowsTerminal.exe" ((Image="*\\rundll32.exe" OR Image="*\\regsvr32.exe" OR Image="*\\certutil.exe" OR Image="*\\cscript.exe" OR Image="*\\wscript.exe" OR Image="*\\csc.exe") OR (Image="*C:\\Users\\Public\\*" OR Image="*\\Downloads\\*" OR Image="*\\Desktop\\*" OR Image="*\\AppData\\Local\\Temp\\*" OR Image="*\\Windows\\TEMP\\*") OR (CommandLine="* iex *" OR CommandLine="* icm*" OR CommandLine="*Invoke-*" OR CommandLine="*Import-Module *" OR CommandLine="*ipmo *" OR CommandLine="*DownloadString(*" OR CommandLine="* /c *" OR CommandLine="* /k *" OR CommandLine="* /r *")))) NOT ((((CommandLine="*Import-Module*" CommandLine="*Microsoft.VisualStudio.DevShell.dll*" CommandLine="*Enter-VsDevShell*"))) OR (((CommandLine="*\\AppData\\Local\\Packages\\Microsoft.WindowsTerminal_*" CommandLine="*\\LocalState\\settings.json*"))) OR (((CommandLine="*C:\\Program Files\\Microsoft Visual Studio\\*" CommandLine="*\\Common7\\Tools\\VsDevCmd.bat*")))))) | eval sigma_attack_tags="attack.execution attack.persistence" | eval sigma_title="Suspicious WindowsTerminal Child Processes" | eval sigma_description="Detects suspicious children spawned via the Windows Terminal application which could be a sign of persistence via WindowsTerminal (see references section)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Detect Execution of winPEAS - winevent]
description = WinPEAS is a script that search for possible paths to escalate privileges on Windows hosts. The checks are explained on book.hacktricks.xyz
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((New_Process_Name="*\\winPEASany.exe" OR New_Process_Name="*\\winPEASany_ofs.exe" OR New_Process_Name="*\\winPEASx64.exe" OR New_Process_Name="*\\winPEASx64_ofs.exe" OR New_Process_Name="*\\winPEASx86.exe" OR New_Process_Name="*\\winPEASx86_ofs.exe") OR OriginalFileName="winPEAS.exe" OR (Process_Command_Line="*serviceinfo" OR Process_Command_Line="*applicationsinfo" OR Process_Command_Line="*windowscreds" OR Process_Command_Line="*browserinfo " OR Process_Command_Line="*fileanalysis") OR Process_Command_Line="*.exe browserinfo *"))) | eval sigma_attack_tags="attack.privilege_escalation attack.t1082 attack.t1087 attack.t1046" | eval sigma_title="Detect Execution of winPEAS" | eval sigma_description="WinPEAS is a script that search for possible paths to escalate privileges on Windows hosts. The checks are explained on book.hacktricks.xyz"
dispatch.earliest_time = -24h@h
alert.track = 0

[Detect Execution of winPEAS - sysmon]
description = WinPEAS is a script that search for possible paths to escalate privileges on Windows hosts. The checks are explained on book.hacktricks.xyz
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((Image="*\\winPEASany.exe" OR Image="*\\winPEASany_ofs.exe" OR Image="*\\winPEASx64.exe" OR Image="*\\winPEASx64_ofs.exe" OR Image="*\\winPEASx86.exe" OR Image="*\\winPEASx86_ofs.exe") OR OriginalFileName="winPEAS.exe" OR (CommandLine="*serviceinfo" OR CommandLine="*applicationsinfo" OR CommandLine="*windowscreds" OR CommandLine="*browserinfo " OR CommandLine="*fileanalysis") OR CommandLine="*.exe browserinfo *"))) | eval sigma_attack_tags="attack.privilege_escalation attack.t1082 attack.t1087 attack.t1046" | eval sigma_title="Detect Execution of winPEAS" | eval sigma_description="WinPEAS is a script that search for possible paths to escalate privileges on Windows hosts. The checks are explained on book.hacktricks.xyz"
dispatch.earliest_time = -24h@h
alert.track = 0

[WMI Backdoor Exchange Transport Agent - winevent]
description = Detects a WMI backdoor in Exchange Transport Agents via WMI event filters
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) Creator_Process_Name="*\\EdgeTransport.exe" NOT ((New_Process_Name="C:\\Windows\\System32\\conhost.exe")))) | eval sigma_attack_tags="attack.persistence attack.t1546.003" | eval sigma_title="WMI Backdoor Exchange Transport Agent" | eval sigma_description="Detects a WMI backdoor in Exchange Transport Agents via WMI event filters"
dispatch.earliest_time = -24h@h
alert.track = 0

[WMI Backdoor Exchange Transport Agent - sysmon]
description = Detects a WMI backdoor in Exchange Transport Agents via WMI event filters
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ParentImage="*\\EdgeTransport.exe" NOT ((Image="C:\\Windows\\System32\\conhost.exe")))) | eval sigma_attack_tags="attack.persistence attack.t1546.003" | eval sigma_title="WMI Backdoor Exchange Transport Agent" | eval sigma_description="Detects a WMI backdoor in Exchange Transport Agents via WMI event filters"
dispatch.earliest_time = -24h@h
alert.track = 0

[WMI Persistence - Script Event Consumer - winevent]
description = Detects WMI script event consumers
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="C:\\WINDOWS\\system32\\wbem\\scrcons.exe" Creator_Process_Name="C:\\Windows\\System32\\svchost.exe")) | eval sigma_attack_tags="attack.persistence attack.privilege_escalation attack.t1546.003" | eval sigma_title="WMI Persistence - Script Event Consumer" | eval sigma_description="Detects WMI script event consumers"
dispatch.earliest_time = -24h@h
alert.track = 0

[WMI Persistence - Script Event Consumer - sysmon]
description = Detects WMI script event consumers
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="C:\\WINDOWS\\system32\\wbem\\scrcons.exe" ParentImage="C:\\Windows\\System32\\svchost.exe")) | eval sigma_attack_tags="attack.persistence attack.privilege_escalation attack.t1546.003" | eval sigma_title="WMI Persistence - Script Event Consumer" | eval sigma_description="Detects WMI script event consumers"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Get ComputerSystem Information with WMIC - winevent]
description = Detects execution of wmic utility with the 'computersystem' flag in order to obtain information about the machine such as the domain, username, model...etc.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\wmic.exe" OR OriginalFileName="wmic.exe") ((Process_Command_Line="* computersystem *" Process_Command_Line="* get *")))) | eval sigma_attack_tags="attack.discovery attack.execution attack.t1047" | eval sigma_title="Suspicious Get ComputerSystem Information with WMIC" | eval sigma_description="Detects execution of wmic utility with the 'computersystem' flag in order to obtain information about the machine such as the domain, username, model...etc."
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Get ComputerSystem Information with WMIC - sysmon]
description = Detects execution of wmic utility with the 'computersystem' flag in order to obtain information about the machine such as the domain, username, model...etc.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\wmic.exe" OR OriginalFileName="wmic.exe") ((CommandLine="* computersystem *" CommandLine="* get *")))) | eval sigma_attack_tags="attack.discovery attack.execution attack.t1047" | eval sigma_title="Suspicious Get ComputerSystem Information with WMIC" | eval sigma_description="Detects execution of wmic utility with the 'computersystem' flag in order to obtain information about the machine such as the domain, username, model...etc."
dispatch.earliest_time = -24h@h
alert.track = 0

[WMI Execution Via Office Process - winevent]
description = Initial execution of malicious document calls wmic to execute the file with regsvr32
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\wbem\\WMIC.exe" OR OriginalFileName="wmic.exe") (Creator_Process_Name="*\\winword.exe" OR Creator_Process_Name="*\\excel.exe" OR Creator_Process_Name="*\\powerpnt.exe"))) | eval sigma_attack_tags="attack.t1204.002 attack.t1047 attack.t1218.010 attack.execution attack.defense_evasion" | eval sigma_title="WMI Execution Via Office Process" | eval sigma_description="Initial execution of malicious document calls wmic to execute the file with regsvr32"
dispatch.earliest_time = -24h@h
alert.track = 0

[WMI Execution Via Office Process - sysmon]
description = Initial execution of malicious document calls wmic to execute the file with regsvr32
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\wbem\\WMIC.exe" OR OriginalFileName="wmic.exe") (ParentImage="*\\winword.exe" OR ParentImage="*\\excel.exe" OR ParentImage="*\\powerpnt.exe"))) | eval sigma_attack_tags="attack.t1204.002 attack.t1047 attack.t1218.010 attack.execution attack.defense_evasion" | eval sigma_title="WMI Execution Via Office Process" | eval sigma_description="Initial execution of malicious document calls wmic to execute the file with regsvr32"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Get Local Groups Information with WMIC - winevent]
description = Adversaries may attempt to find local system groups and permission settings.
The knowledge of local system permission groups can help adversaries determine which groups exist and which users belong to a particular group.
Adversaries may use this information to determine which users have elevated permissions, such as the users found within the local administrators group.

search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\wmic.exe" OR OriginalFileName="wmic.exe") Process_Command_Line="* group*")) | eval sigma_attack_tags="attack.discovery attack.t1069.001" | eval sigma_title="Suspicious Get Local Groups Information with WMIC" | eval sigma_description="Adversaries may attempt to find local system groups and permission settings.
The knowledge of local system permission groups can help adversaries determine which groups exist and which users belong to a particular group.
Adversaries may use this information to determine which users have elevated permissions, such as the users found within the local administrators group.
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious Get Local Groups Information with WMIC - sysmon]
description = Adversaries may attempt to find local system groups and permission settings.
The knowledge of local system permission groups can help adversaries determine which groups exist and which users belong to a particular group.
Adversaries may use this information to determine which users have elevated permissions, such as the users found within the local administrators group.

search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\wmic.exe" OR OriginalFileName="wmic.exe") CommandLine="* group*")) | eval sigma_attack_tags="attack.discovery attack.t1069.001" | eval sigma_title="Suspicious Get Local Groups Information with WMIC" | eval sigma_description="Adversaries may attempt to find local system groups and permission settings.
The knowledge of local system permission groups can help adversaries determine which groups exist and which users belong to a particular group.
Adversaries may use this information to determine which users have elevated permissions, such as the users found within the local administrators group.
"
dispatch.earliest_time = -24h@h
alert.track = 0

[WMIC Hotfix Recon - winevent]
description = Detects wmic known recon method to look for installed hotfixes, often used by pentest and attackers enum scripts
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (OriginalFileName="wmic.exe" OR New_Process_Name="*\\WMIC.exe") ((Process_Command_Line="* qfe *" Process_Command_Line="* get *" Process_Command_Line="*Caption,Description,HotFixID,InstalledOn*")))) | eval sigma_attack_tags="attack.execution attack.t1047" | eval sigma_title="WMIC Hotfix Recon" | eval sigma_description="Detects wmic known recon method to look for installed hotfixes, often used by pentest and attackers enum scripts"
dispatch.earliest_time = -24h@h
alert.track = 0

[WMIC Hotfix Recon - sysmon]
description = Detects wmic known recon method to look for installed hotfixes, often used by pentest and attackers enum scripts
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (OriginalFileName="wmic.exe" OR Image="*\\WMIC.exe") ((CommandLine="* qfe *" CommandLine="* get *" CommandLine="*Caption,Description,HotFixID,InstalledOn*")))) | eval sigma_attack_tags="attack.execution attack.t1047" | eval sigma_title="WMIC Hotfix Recon" | eval sigma_description="Detects wmic known recon method to look for installed hotfixes, often used by pentest and attackers enum scripts"
dispatch.earliest_time = -24h@h
alert.track = 0

[WMI Process Reconnaissance - winevent]
description = An adversary might use WMI to list Processes running on the compromised host or list installed Software hotfix and patches.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((New_Process_Name="*\\WMIC.exe" OR OriginalFileName="wmic.exe") (Process_Command_Line="*process*" OR Process_Command_Line="*qfe*"))) NOT (((Process_Command_Line="*call*" Process_Command_Line="*create*"))))) | eval sigma_attack_tags="attack.execution attack.t1047" | eval sigma_title="WMI Process Reconnaissance" | eval sigma_description="An adversary might use WMI to list Processes running on the compromised host or list installed Software hotfix and patches."
dispatch.earliest_time = -24h@h
alert.track = 0

[WMI Process Reconnaissance - sysmon]
description = An adversary might use WMI to list Processes running on the compromised host or list installed Software hotfix and patches.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((Image="*\\WMIC.exe" OR OriginalFileName="wmic.exe") (CommandLine="*process*" OR CommandLine="*qfe*"))) NOT (((CommandLine="*call*" CommandLine="*create*"))))) | eval sigma_attack_tags="attack.execution attack.t1047" | eval sigma_title="WMI Process Reconnaissance" | eval sigma_description="An adversary might use WMI to list Processes running on the compromised host or list installed Software hotfix and patches."
dispatch.earliest_time = -24h@h
alert.track = 0

[WMI Remote Command Execution - winevent]
description = An adversary might use WMI to execute commands on a remote system
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\WMIC.exe" OR OriginalFileName="wmic.exe") ((Process_Command_Line="*/node:*" Process_Command_Line="*process*" Process_Command_Line="*call*" Process_Command_Line="*create*")))) | eval sigma_attack_tags="attack.execution attack.t1047" | eval sigma_title="WMI Remote Command Execution" | eval sigma_description="An adversary might use WMI to execute commands on a remote system"
dispatch.earliest_time = -24h@h
alert.track = 0

[WMI Remote Command Execution - sysmon]
description = An adversary might use WMI to execute commands on a remote system
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\WMIC.exe" OR OriginalFileName="wmic.exe") ((CommandLine="*/node:*" CommandLine="*process*" CommandLine="*call*" CommandLine="*create*")))) | eval sigma_attack_tags="attack.execution attack.t1047" | eval sigma_title="WMI Remote Command Execution" | eval sigma_description="An adversary might use WMI to execute commands on a remote system"
dispatch.earliest_time = -24h@h
alert.track = 0

[WMI Reconnaissance List Remote Services - winevent]
description = An adversary might use WMI to check if a certain Remote Service is running on a remote device.
When the test completes, a service information will be displayed on the screen if it exists.
A common feedback message is that 'No instance(s) Available' if the service queried is not running.
A common error message is 'Node - (provided IP or default) ERROR Description =The RPC server is unavailable' if the provided remote host is unreachable

search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\WMIC.exe" OR OriginalFileName="wmic.exe") ((Process_Command_Line="*/node:*" Process_Command_Line="*service*")))) | eval sigma_attack_tags="attack.execution attack.t1047" | eval sigma_title="WMI Reconnaissance List Remote Services" | eval sigma_description="An adversary might use WMI to check if a certain Remote Service is running on a remote device.
When the test completes, a service information will be displayed on the screen if it exists.
A common feedback message is that 'No instance(s) Available' if the service queried is not running.
A common error message is 'Node - (provided IP or default) ERROR Description =The RPC server is unavailable' if the provided remote host is unreachable
"
dispatch.earliest_time = -24h@h
alert.track = 0

[WMI Reconnaissance List Remote Services - sysmon]
description = An adversary might use WMI to check if a certain Remote Service is running on a remote device.
When the test completes, a service information will be displayed on the screen if it exists.
A common feedback message is that 'No instance(s) Available' if the service queried is not running.
A common error message is 'Node - (provided IP or default) ERROR Description =The RPC server is unavailable' if the provided remote host is unreachable

search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\WMIC.exe" OR OriginalFileName="wmic.exe") ((CommandLine="*/node:*" CommandLine="*service*")))) | eval sigma_attack_tags="attack.execution attack.t1047" | eval sigma_title="WMI Reconnaissance List Remote Services" | eval sigma_description="An adversary might use WMI to check if a certain Remote Service is running on a remote device.
When the test completes, a service information will be displayed on the screen if it exists.
A common feedback message is that 'No instance(s) Available' if the service queried is not running.
A common error message is 'Node - (provided IP or default) ERROR Description =The RPC server is unavailable' if the provided remote host is unreachable
"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential Tampering With Security Products Via WMIC - winevent]
description = Detects uninstallation or termination of security products using the WMIC utility
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((Process_Command_Line="*wmic*" Process_Command_Line="*product where *" Process_Command_Line="*call uninstall*" Process_Command_Line="*/nointeractive*")) OR ((Process_Command_Line="*wmic*" Process_Command_Line="*caption like *" (Process_Command_Line="*call delete*" OR Process_Command_Line="*call terminate*"))) OR ((Process_Command_Line="*process *" Process_Command_Line="*where *" Process_Command_Line="*delete*"))) (Process_Command_Line="*%carbon%*" OR Process_Command_Line="*%cylance%*" OR Process_Command_Line="*%endpoint%*" OR Process_Command_Line="*%eset%*" OR Process_Command_Line="*%malware%*" OR Process_Command_Line="*%Sophos%*" OR Process_Command_Line="*%symantec%*" OR Process_Command_Line="*Antivirus*" OR Process_Command_Line="*AVG *" OR Process_Command_Line="*Carbon Black*" OR Process_Command_Line="*CarbonBlack*" OR Process_Command_Line="*Cb Defense Sensor 64-bit*" OR Process_Command_Line="*Crowdstrike Sensor*" OR Process_Command_Line="*Cylance *" OR Process_Command_Line="*Dell Threat Defense*" OR Process_Command_Line="*DLP Endpoint*" OR Process_Command_Line="*Endpoint Detection*" OR Process_Command_Line="*Endpoint Protection*" OR Process_Command_Line="*Endpoint Security*" OR Process_Command_Line="*Endpoint Sensor*" OR Process_Command_Line="*ESET File Security*" OR Process_Command_Line="*LogRhythm System Monitor Service*" OR Process_Command_Line="*Malwarebytes*" OR Process_Command_Line="*McAfee Agent*" OR Process_Command_Line="*Microsoft Security Client*" OR Process_Command_Line="*Sophos Anti-Virus*" OR Process_Command_Line="*Sophos AutoUpdate*" OR Process_Command_Line="*Sophos Credential Store*" OR Process_Command_Line="*Sophos Management Console*" OR Process_Command_Line="*Sophos Management Database*" OR Process_Command_Line="*Sophos Management Server*" OR Process_Command_Line="*Sophos Remote Management System*" OR Process_Command_Line="*Sophos Update Manager*" OR Process_Command_Line="*Threat Protection*" OR Process_Command_Line="*VirusScan*" OR Process_Command_Line="*Webroot SecureAnywhere*" OR Process_Command_Line="*Windows Defender*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.001" | eval sigma_title="Potential Tampering With Security Products Via WMIC" | eval sigma_description="Detects uninstallation or termination of security products using the WMIC utility"
dispatch.earliest_time = -24h@h
alert.track = 0

[Potential Tampering With Security Products Via WMIC - sysmon]
description = Detects uninstallation or termination of security products using the WMIC utility
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((CommandLine="*wmic*" CommandLine="*product where *" CommandLine="*call uninstall*" CommandLine="*/nointeractive*")) OR ((CommandLine="*wmic*" CommandLine="*caption like *" (CommandLine="*call delete*" OR CommandLine="*call terminate*"))) OR ((CommandLine="*process *" CommandLine="*where *" CommandLine="*delete*"))) (CommandLine="*%carbon%*" OR CommandLine="*%cylance%*" OR CommandLine="*%endpoint%*" OR CommandLine="*%eset%*" OR CommandLine="*%malware%*" OR CommandLine="*%Sophos%*" OR CommandLine="*%symantec%*" OR CommandLine="*Antivirus*" OR CommandLine="*AVG *" OR CommandLine="*Carbon Black*" OR CommandLine="*CarbonBlack*" OR CommandLine="*Cb Defense Sensor 64-bit*" OR CommandLine="*Crowdstrike Sensor*" OR CommandLine="*Cylance *" OR CommandLine="*Dell Threat Defense*" OR CommandLine="*DLP Endpoint*" OR CommandLine="*Endpoint Detection*" OR CommandLine="*Endpoint Protection*" OR CommandLine="*Endpoint Security*" OR CommandLine="*Endpoint Sensor*" OR CommandLine="*ESET File Security*" OR CommandLine="*LogRhythm System Monitor Service*" OR CommandLine="*Malwarebytes*" OR CommandLine="*McAfee Agent*" OR CommandLine="*Microsoft Security Client*" OR CommandLine="*Sophos Anti-Virus*" OR CommandLine="*Sophos AutoUpdate*" OR CommandLine="*Sophos Credential Store*" OR CommandLine="*Sophos Management Console*" OR CommandLine="*Sophos Management Database*" OR CommandLine="*Sophos Management Server*" OR CommandLine="*Sophos Remote Management System*" OR CommandLine="*Sophos Update Manager*" OR CommandLine="*Threat Protection*" OR CommandLine="*VirusScan*" OR CommandLine="*Webroot SecureAnywhere*" OR CommandLine="*Windows Defender*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1562.001" | eval sigma_title="Potential Tampering With Security Products Via WMIC" | eval sigma_description="Detects uninstallation or termination of security products using the WMIC utility"
dispatch.earliest_time = -24h@h
alert.track = 0

[WMIC Service Start/Stop - winevent]
description = Detects usage of wmic to start or stop a service
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (OriginalFileName="wmic.exe" OR New_Process_Name="*\\WMIC.exe") ((Process_Command_Line="* service *" Process_Command_Line="* call *" (Process_Command_Line="*stopservice*" OR Process_Command_Line="*startservice*"))))) | eval sigma_attack_tags="attack.execution attack.t1047" | eval sigma_title="WMIC Service Start/Stop" | eval sigma_description="Detects usage of wmic to start or stop a service"
dispatch.earliest_time = -24h@h
alert.track = 0

[WMIC Service Start/Stop - sysmon]
description = Detects usage of wmic to start or stop a service
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (OriginalFileName="wmic.exe" OR Image="*\\WMIC.exe") ((CommandLine="* service *" CommandLine="* call *" (CommandLine="*stopservice*" OR CommandLine="*startservice*"))))) | eval sigma_attack_tags="attack.execution attack.t1047" | eval sigma_title="WMIC Service Start/Stop" | eval sigma_description="Detects usage of wmic to start or stop a service"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious WMI Execution Via Office Process - winevent]
description = Office application called wmic to proxye execution through a LOLBIN process. This is often used to break suspicious parent-child chain (Office app spawns LOLBin).
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\wbem\\WMIC.exe" OR OriginalFileName="wmic.exe") (((Creator_Process_Name="*\\winword.exe" OR Creator_Process_Name="*\\excel.exe" OR Creator_Process_Name="*\\powerpnt.exe") Process_Command_Line="*process*" Process_Command_Line="*create*" Process_Command_Line="*call*" (Process_Command_Line="*regsvr32*" OR Process_Command_Line="*rundll32*" OR Process_Command_Line="*msiexec*" OR Process_Command_Line="*mshta*" OR Process_Command_Line="*verclsid*"))))) | eval sigma_attack_tags="attack.t1204.002 attack.t1047 attack.t1218.010 attack.execution attack.defense_evasion" | eval sigma_title="Suspicious WMI Execution Via Office Process" | eval sigma_description="Office application called wmic to proxye execution through a LOLBIN process. This is often used to break suspicious parent-child chain (Office app spawns LOLBin)."
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious WMI Execution Via Office Process - sysmon]
description = Office application called wmic to proxye execution through a LOLBIN process. This is often used to break suspicious parent-child chain (Office app spawns LOLBin).
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\wbem\\WMIC.exe" OR OriginalFileName="wmic.exe") (((ParentImage="*\\winword.exe" OR ParentImage="*\\excel.exe" OR ParentImage="*\\powerpnt.exe") CommandLine="*process*" CommandLine="*create*" CommandLine="*call*" (CommandLine="*regsvr32*" OR CommandLine="*rundll32*" OR CommandLine="*msiexec*" OR CommandLine="*mshta*" OR CommandLine="*verclsid*"))))) | eval sigma_attack_tags="attack.t1204.002 attack.t1047 attack.t1218.010 attack.execution attack.defense_evasion" | eval sigma_title="Suspicious WMI Execution Via Office Process" | eval sigma_description="Office application called wmic to proxye execution through a LOLBIN process. This is often used to break suspicious parent-child chain (Office app spawns LOLBin)."
dispatch.earliest_time = -24h@h
alert.track = 0

[WMIC Tamper Windows Defender - winevent]
description = Detects potential tampering with Windows Defender settings such as adding exclusion using wmic
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (OriginalFileName="wmic.exe" OR New_Process_Name="*\\WMIC.exe") Process_Command_Line="*/Namespace:\\\\root\\Microsoft\\Windows\\Defender*")) | eval sigma_attack_tags="attack.credential_access attack.t1546.008" | eval sigma_title="WMIC Tamper Windows Defender" | eval sigma_description="Detects potential tampering with Windows Defender settings such as adding exclusion using wmic"
dispatch.earliest_time = -24h@h
alert.track = 0

[WMIC Tamper Windows Defender - sysmon]
description = Detects potential tampering with Windows Defender settings such as adding exclusion using wmic
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (OriginalFileName="wmic.exe" OR Image="*\\WMIC.exe") CommandLine="*/Namespace:\\\\root\\Microsoft\\Windows\\Defender*")) | eval sigma_attack_tags="attack.credential_access attack.t1546.008" | eval sigma_title="WMIC Tamper Windows Defender" | eval sigma_description="Detects potential tampering with Windows Defender settings such as adding exclusion using wmic"
dispatch.earliest_time = -24h@h
alert.track = 0

[WMIC Unquoted Services Path Lookup - winevent]
description = Detects wmic known recon method to look for unquoted service paths, often used by pentest and attackers enum scripts
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (OriginalFileName="wmic.exe" OR New_Process_Name="*\\WMIC.exe") ((Process_Command_Line="* service *" Process_Command_Line="* get *" (Process_Command_Line="*name*" OR Process_Command_Line="*displayname*" OR Process_Command_Line="*pathname*" OR Process_Command_Line="*startmode*"))))) | eval sigma_attack_tags="attack.execution attack.t1047" | eval sigma_title="WMIC Unquoted Services Path Lookup" | eval sigma_description="Detects wmic known recon method to look for unquoted service paths, often used by pentest and attackers enum scripts"
dispatch.earliest_time = -24h@h
alert.track = 0

[WMIC Unquoted Services Path Lookup - sysmon]
description = Detects wmic known recon method to look for unquoted service paths, often used by pentest and attackers enum scripts
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (OriginalFileName="wmic.exe" OR Image="*\\WMIC.exe") ((CommandLine="* service *" CommandLine="* get *" (CommandLine="*name*" OR CommandLine="*displayname*" OR CommandLine="*pathname*" OR CommandLine="*startmode*"))))) | eval sigma_attack_tags="attack.execution attack.t1047" | eval sigma_title="WMIC Unquoted Services Path Lookup" | eval sigma_description="Detects wmic known recon method to look for unquoted service paths, often used by pentest and attackers enum scripts"
dispatch.earliest_time = -24h@h
alert.track = 0

[WmiPrvSE Spawned A Process - winevent]
description = Detects wmiprvse spawning processes
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) Creator_Process_Name="*\\WmiPrvSe.exe" NOT ((((SubjectLogonId="0x3e7" OR SubjectLogonId="null")) OR ((Account_Name="*AUTHORI*" OR Account_Name="*AUTORI*")) OR ((New_Process_Name="*\\WmiPrvSE.exe" OR New_Process_Name="*\\WerFault.exe"))) OR ((NOT SubjectLogonId="*"))))) | eval sigma_attack_tags="attack.execution attack.t1047" | eval sigma_title="WmiPrvSE Spawned A Process" | eval sigma_description="Detects wmiprvse spawning processes"
dispatch.earliest_time = -24h@h
alert.track = 0

[WmiPrvSE Spawned A Process - sysmon]
description = Detects wmiprvse spawning processes
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ParentImage="*\\WmiPrvSe.exe" NOT ((((LogonId="0x3e7" OR LogonId="null")) OR ((User="*AUTHORI*" OR User="*AUTORI*")) OR ((Image="*\\WmiPrvSE.exe" OR Image="*\\WerFault.exe"))) OR ((NOT LogonId="*"))))) | eval sigma_attack_tags="attack.execution attack.t1047" | eval sigma_title="WmiPrvSE Spawned A Process" | eval sigma_description="Detects wmiprvse spawning processes"
dispatch.earliest_time = -24h@h
alert.track = 0

[WmiPrvSE Spawned PowerShell - winevent]
description = Detects Powershell as a child of the WmiPrvSE process. Which could be a signe of remote access via WMI
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) ((Creator_Process_Name="*\\wmiprvse.exe" ((New_Process_Name="*\\powershell.exe" OR New_Process_Name="*\\pwsh.exe") OR (OriginalFileName="PowerShell.EXE" OR OriginalFileName="pwsh.dll")))) NOT (((Process_Command_Line="null")) OR ((NOT Process_Command_Line="*"))))) | eval sigma_attack_tags="attack.execution attack.t1047 attack.t1059.001" | eval sigma_title="WmiPrvSE Spawned PowerShell" | eval sigma_description="Detects Powershell as a child of the WmiPrvSE process. Which could be a signe of remote access via WMI"
dispatch.earliest_time = -24h@h
alert.track = 0

[WmiPrvSE Spawned PowerShell - sysmon]
description = Detects Powershell as a child of the WmiPrvSE process. Which could be a signe of remote access via WMI
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ((ParentImage="*\\wmiprvse.exe" ((Image="*\\powershell.exe" OR Image="*\\pwsh.exe") OR (OriginalFileName="PowerShell.EXE" OR OriginalFileName="pwsh.dll")))) NOT (((CommandLine="null")) OR ((NOT CommandLine="*"))))) | eval sigma_attack_tags="attack.execution attack.t1047 attack.t1059.001" | eval sigma_title="WmiPrvSE Spawned PowerShell" | eval sigma_description="Detects Powershell as a child of the WmiPrvSE process. Which could be a signe of remote access via WMI"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious WmiPrvse Child Process Spawned - winevent]
description = Detects suspicious and uncommon child processes of WmiPrvSE
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) Creator_Process_Name="*\\wbem\\WmiPrvSE.exe" ((New_Process_Name="*\\regsvr32.exe" OR New_Process_Name="*\\rundll32.exe" OR New_Process_Name="*\\msiexec.exe" OR New_Process_Name="*\\mshta.exe" OR New_Process_Name="*\\verclsid.exe") OR ((New_Process_Name="*\\cmd.exe" (Process_Command_Line="*powershell*" OR Process_Command_Line="*pwsh*" OR Process_Command_Line="*mshta*" OR Process_Command_Line="*rundll32*" OR Process_Command_Line="*regsvr32*" OR Process_Command_Line="*wscript*" OR Process_Command_Line="*cscript*")))))) | eval sigma_attack_tags="attack.execution attack.defense_evasion attack.t1047 attack.t1204.002 attack.t1218.010" | eval sigma_title="Suspicious WmiPrvse Child Process Spawned" | eval sigma_description="Detects suspicious and uncommon child processes of WmiPrvSE"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious WmiPrvse Child Process Spawned - sysmon]
description = Detects suspicious and uncommon child processes of WmiPrvSE
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) ParentImage="*\\wbem\\WmiPrvSE.exe" ((Image="*\\regsvr32.exe" OR Image="*\\rundll32.exe" OR Image="*\\msiexec.exe" OR Image="*\\mshta.exe" OR Image="*\\verclsid.exe") OR ((Image="*\\cmd.exe" (CommandLine="*powershell*" OR CommandLine="*pwsh*" OR CommandLine="*mshta*" OR CommandLine="*rundll32*" OR CommandLine="*regsvr32*" OR CommandLine="*wscript*" OR CommandLine="*cscript*")))))) | eval sigma_attack_tags="attack.execution attack.defense_evasion attack.t1047 attack.t1204.002 attack.t1218.010" | eval sigma_title="Suspicious WmiPrvse Child Process Spawned" | eval sigma_description="Detects suspicious and uncommon child processes of WmiPrvSE"
dispatch.earliest_time = -24h@h
alert.track = 0

[Microsoft Workflow Compiler - winevent]
description = Detects invocation of Microsoft Workflow Compiler, which may permit the execution of arbitrary unsigned code.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\Microsoft.Workflow.Compiler.exe" OR ((OriginalFileName="Microsoft.Workflow.Compiler.exe" Process_Command_Line="*.xml*"))))) | table Process_Command_Line,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.execution attack.t1127 attack.t1218" | eval sigma_title="Microsoft Workflow Compiler" | eval sigma_description="Detects invocation of Microsoft Workflow Compiler, which may permit the execution of arbitrary unsigned code."
dispatch.earliest_time = -24h@h
alert.track = 0

[Microsoft Workflow Compiler - sysmon]
description = Detects invocation of Microsoft Workflow Compiler, which may permit the execution of arbitrary unsigned code.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\Microsoft.Workflow.Compiler.exe" OR ((OriginalFileName="Microsoft.Workflow.Compiler.exe" CommandLine="*.xml*"))))) | table CommandLine,ParentCommandLine | eval sigma_attack_tags="attack.defense_evasion attack.execution attack.t1127 attack.t1218" | eval sigma_title="Microsoft Workflow Compiler" | eval sigma_description="Detects invocation of Microsoft Workflow Compiler, which may permit the execution of arbitrary unsigned code."
dispatch.earliest_time = -24h@h
alert.track = 0

[UEFI Persistence Via Wpbbin - ProcessCreation - winevent]
description = Detects execution of the binary 'wpbbin' which is used as part of the UEFI based persistence method described in the reference section
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="C:\\Windows\\System32\\wpbbin.exe")) | eval sigma_attack_tags="attack.persistence attack.defense_evasion attack.t1542.001" | eval sigma_title="UEFI Persistence Via Wpbbin - ProcessCreation" | eval sigma_description="Detects execution of the binary 'wpbbin' which is used as part of the UEFI based persistence method described in the reference section"
dispatch.earliest_time = -24h@h
alert.track = 0

[UEFI Persistence Via Wpbbin - ProcessCreation - sysmon]
description = Detects execution of the binary 'wpbbin' which is used as part of the UEFI based persistence method described in the reference section
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="C:\\Windows\\System32\\wpbbin.exe")) | eval sigma_attack_tags="attack.persistence attack.defense_evasion attack.t1542.001" | eval sigma_title="UEFI Persistence Via Wpbbin - ProcessCreation" | eval sigma_description="Detects execution of the binary 'wpbbin' which is used as part of the UEFI based persistence method described in the reference section"
dispatch.earliest_time = -24h@h
alert.track = 0

[Write Protect For Storage Disabled - winevent]
description = Looks for changes to registry to disable any write-protect property for storage devices. This could be a precursor to a ransomware attack and has been an observed technique used by cypherpunk group.
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*reg add*" Process_Command_Line="*\\system\\currentcontrolset\\control*" Process_Command_Line="*write protection*" Process_Command_Line="*0*" (Process_Command_Line="*storage*" OR Process_Command_Line="*storagedevicepolicies*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1562" | eval sigma_title="Write Protect For Storage Disabled" | eval sigma_description="Looks for changes to registry to disable any write-protect property for storage devices. This could be a precursor to a ransomware attack and has been an observed technique used by cypherpunk group."
dispatch.earliest_time = -24h@h
alert.track = 0

[Write Protect For Storage Disabled - sysmon]
description = Looks for changes to registry to disable any write-protect property for storage devices. This could be a precursor to a ransomware attack and has been an observed technique used by cypherpunk group.
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*reg add*" CommandLine="*\\system\\currentcontrolset\\control*" CommandLine="*write protection*" CommandLine="*0*" (CommandLine="*storage*" OR CommandLine="*storagedevicepolicies*"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1562" | eval sigma_title="Write Protect For Storage Disabled" | eval sigma_description="Looks for changes to registry to disable any write-protect property for storage devices. This could be a precursor to a ransomware attack and has been an observed technique used by cypherpunk group."
dispatch.earliest_time = -24h@h
alert.track = 0

[Wscript Shell Run In CommandLine - winevent]
description = Detects the presence of the keywords 'Wscript', 'Shell' and 'Run' in the command, which could indicate a suspicious activity
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") Process_Command_Line="*Wscript.*" Process_Command_Line="*.Shell*" Process_Command_Line="*.Run*")) | eval sigma_attack_tags="attack.execution attack.t1059" | eval sigma_title="Wscript Shell Run In CommandLine" | eval sigma_description="Detects the presence of the keywords 'Wscript', 'Shell' and 'Run' in the command, which could indicate a suspicious activity"
dispatch.earliest_time = -24h@h
alert.track = 0

[Wscript Shell Run In CommandLine - sysmon]
description = Detects the presence of the keywords 'Wscript', 'Shell' and 'Run' in the command, which could indicate a suspicious activity
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") CommandLine="*Wscript.*" CommandLine="*.Shell*" CommandLine="*.Run*")) | eval sigma_attack_tags="attack.execution attack.t1059" | eval sigma_title="Wscript Shell Run In CommandLine" | eval sigma_description="Detects the presence of the keywords 'Wscript', 'Shell' and 'Run' in the command, which could indicate a suspicious activity"
dispatch.earliest_time = -24h@h
alert.track = 0

[WSL Child Process Anomaly - winevent]
description = Detects uncommon or suspicious child processes spawning from a WSL process. This could indicate an attempt to evade parent/child relationship detections or persistence attempts via cron using WSL
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (Creator_Process_Name="*\\wsl.exe" OR Creator_Process_Name="*\\wslhost.exe") ((New_Process_Name="*\\powershell.exe" OR New_Process_Name="*\\pwsh.exe" OR New_Process_Name="*\\cmd.exe" OR New_Process_Name="*\\calc.exe") OR (New_Process_Name="*\\AppData\\Local\\Temp\\*" OR New_Process_Name="*C:\\Users\\Public\\*" OR New_Process_Name="*C:\\Windows\\Temp\\*" OR New_Process_Name="*C:\\Temp\\*" OR New_Process_Name="*\\Downloads\\*" OR New_Process_Name="*\\Desktop\\*")))) | eval sigma_attack_tags="attack.execution attack.defense_evasion attack.t1218 attack.t1202" | eval sigma_title="WSL Child Process Anomaly" | eval sigma_description="Detects uncommon or suspicious child processes spawning from a WSL process. This could indicate an attempt to evade parent/child relationship detections or persistence attempts via cron using WSL"
dispatch.earliest_time = -24h@h
alert.track = 0

[WSL Child Process Anomaly - sysmon]
description = Detects uncommon or suspicious child processes spawning from a WSL process. This could indicate an attempt to evade parent/child relationship detections or persistence attempts via cron using WSL
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (ParentImage="*\\wsl.exe" OR ParentImage="*\\wslhost.exe") ((Image="*\\powershell.exe" OR Image="*\\pwsh.exe" OR Image="*\\cmd.exe" OR Image="*\\calc.exe") OR (Image="*\\AppData\\Local\\Temp\\*" OR Image="*C:\\Users\\Public\\*" OR Image="*C:\\Windows\\Temp\\*" OR Image="*C:\\Temp\\*" OR Image="*\\Downloads\\*" OR Image="*\\Desktop\\*")))) | eval sigma_attack_tags="attack.execution attack.defense_evasion attack.t1218 attack.t1202" | eval sigma_title="WSL Child Process Anomaly" | eval sigma_description="Detects uncommon or suspicious child processes spawning from a WSL process. This could indicate an attempt to evade parent/child relationship detections or persistence attempts via cron using WSL"
dispatch.earliest_time = -24h@h
alert.track = 0

[Wsudo Suspicious Execution - winevent]
description = Detects usage of wsudo (Windows Sudo Utility). Which is a tool that let the user execute programs with different permissions (System, Trusted Installer, Administrator...etc)
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\wsudo.exe" OR OriginalFileName="wsudo.exe" OR Description="Windows sudo utility" OR Creator_Process_Name="*\\wsudo-bridge.exe" OR (Process_Command_Line="*-u System*" OR Process_Command_Line="*-uSystem*" OR Process_Command_Line="*-u TrustedInstaller*" OR Process_Command_Line="*-uTrustedInstaller*" OR Process_Command_Line="* --ti *")))) | eval sigma_attack_tags="attack.execution attack.privilege_escalation attack.t1059" | eval sigma_title="Wsudo Suspicious Execution" | eval sigma_description="Detects usage of wsudo (Windows Sudo Utility). Which is a tool that let the user execute programs with different permissions (System, Trusted Installer, Administrator...etc)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Wsudo Suspicious Execution - sysmon]
description = Detects usage of wsudo (Windows Sudo Utility). Which is a tool that let the user execute programs with different permissions (System, Trusted Installer, Administrator...etc)
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\wsudo.exe" OR OriginalFileName="wsudo.exe" OR Description="Windows sudo utility" OR ParentImage="*\\wsudo-bridge.exe" OR (CommandLine="*-u System*" OR CommandLine="*-uSystem*" OR CommandLine="*-u TrustedInstaller*" OR CommandLine="*-uTrustedInstaller*" OR CommandLine="* --ti *")))) | eval sigma_attack_tags="attack.execution attack.privilege_escalation attack.t1059" | eval sigma_title="Wsudo Suspicious Execution" | eval sigma_description="Detects usage of wsudo (Windows Sudo Utility). Which is a tool that let the user execute programs with different permissions (System, Trusted Installer, Administrator...etc)"
dispatch.earliest_time = -24h@h
alert.track = 0

[Wusa Extracting Cab Files - winevent]
description = Detects usage of the 'wusa.exe' (Windows Update Standalone Installer) utility to extract cab using the '/extract' argument which is not longer supported. This could indicate an attacker using an old technique
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\wusa.exe" Process_Command_Line="*/extract:*")) | eval sigma_attack_tags="attack.execution" | eval sigma_title="Wusa Extracting Cab Files" | eval sigma_description="Detects usage of the 'wusa.exe' (Windows Update Standalone Installer) utility to extract cab using the '/extract' argument which is not longer supported. This could indicate an attacker using an old technique"
dispatch.earliest_time = -24h@h
alert.track = 0

[Wusa Extracting Cab Files - sysmon]
description = Detects usage of the 'wusa.exe' (Windows Update Standalone Installer) utility to extract cab using the '/extract' argument which is not longer supported. This could indicate an attacker using an old technique
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\wusa.exe" CommandLine="*/extract:*")) | eval sigma_attack_tags="attack.execution" | eval sigma_title="Wusa Extracting Cab Files" | eval sigma_description="Detects usage of the 'wusa.exe' (Windows Update Standalone Installer) utility to extract cab using the '/extract' argument which is not longer supported. This could indicate an attacker using an old technique"
dispatch.earliest_time = -24h@h
alert.track = 0

[Wusa Extracting Cab Files From Suspicious Paths - winevent]
description = Detects usage of the 'wusa.exe' (Windows Update Standalone Installer) utility to extract cab using the '/extract' argument from suspicious paths
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") New_Process_Name="*\\wusa.exe" Process_Command_Line="*/extract:*" (Process_Command_Line="*C:\\Users\\Public\\*" OR Process_Command_Line="*\\Desktop\\*" OR Process_Command_Line="*\\Downloads\\*" OR Process_Command_Line="*\\Appdata\\Local\\Temp\\*" OR Process_Command_Line="*\\Windows\\Temp\\*" OR Process_Command_Line="*\\PerfLogs\\*"))) | eval sigma_attack_tags="attack.execution" | eval sigma_title="Wusa Extracting Cab Files From Suspicious Paths" | eval sigma_description="Detects usage of the 'wusa.exe' (Windows Update Standalone Installer) utility to extract cab using the '/extract' argument from suspicious paths"
dispatch.earliest_time = -24h@h
alert.track = 0

[Wusa Extracting Cab Files From Suspicious Paths - sysmon]
description = Detects usage of the 'wusa.exe' (Windows Update Standalone Installer) utility to extract cab using the '/extract' argument from suspicious paths
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") Image="*\\wusa.exe" CommandLine="*/extract:*" (CommandLine="*C:\\Users\\Public\\*" OR CommandLine="*\\Desktop\\*" OR CommandLine="*\\Downloads\\*" OR CommandLine="*\\Appdata\\Local\\Temp\\*" OR CommandLine="*\\Windows\\Temp\\*" OR CommandLine="*\\PerfLogs\\*"))) | eval sigma_attack_tags="attack.execution" | eval sigma_title="Wusa Extracting Cab Files From Suspicious Paths" | eval sigma_description="Detects usage of the 'wusa.exe' (Windows Update Standalone Installer) utility to extract cab using the '/extract' argument from suspicious paths"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious X509Enrollment - Process Creation - winevent]
description = Detect use of X509Enrollment
search = index=wineventlog* ((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security") (Process_Command_Line="*X509Enrollment.CBinaryConverter*" OR Process_Command_Line="*884e2002-217d-11da-b2a4-000e7bbb2b09*"))) | eval sigma_attack_tags="" | eval sigma_title="Suspicious X509Enrollment - Process Creation" | eval sigma_description="Detect use of X509Enrollment"
dispatch.earliest_time = -24h@h
alert.track = 0

[Suspicious X509Enrollment - Process Creation - sysmon]
description = Detect use of X509Enrollment
search = index=sysmon* ((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational") (CommandLine="*X509Enrollment.CBinaryConverter*" OR CommandLine="*884e2002-217d-11da-b2a4-000e7bbb2b09*"))) | eval sigma_attack_tags="" | eval sigma_title="Suspicious X509Enrollment - Process Creation" | eval sigma_description="Detect use of X509Enrollment"
dispatch.earliest_time = -24h@h
alert.track = 0

[XORDump Use - winevent]
description = Detects suspicious use of XORDump process memory dumping utility
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (New_Process_Name="*\\xordump.exe" OR (Process_Command_Line="* -process lsass.exe *" OR Process_Command_Line="* -m comsvcs *" OR Process_Command_Line="* -m dbghelp *" OR Process_Command_Line="* -m dbgcore *")))) | eval sigma_attack_tags="attack.defense_evasion attack.t1036 attack.t1003.001" | eval sigma_title="XORDump Use" | eval sigma_description="Detects suspicious use of XORDump process memory dumping utility"
dispatch.earliest_time = -24h@h
alert.track = 0

[XORDump Use - sysmon]
description = Detects suspicious use of XORDump process memory dumping utility
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (Image="*\\xordump.exe" OR (CommandLine="* -process lsass.exe *" OR CommandLine="* -m comsvcs *" OR CommandLine="* -m dbghelp *" OR CommandLine="* -m dbgcore *")))) | eval sigma_attack_tags="attack.defense_evasion attack.t1036 attack.t1003.001" | eval sigma_title="XORDump Use" | eval sigma_description="Detects suspicious use of XORDump process memory dumping utility"
dispatch.earliest_time = -24h@h
alert.track = 0

[XSL Script Processing - winevent]
description = Extensible Stylesheet Language (XSL) files are commonly used to describe the processing and rendering of data within XML files. Rule detects when adversaries abuse this functionality to execute arbitrary files while potentially bypassing application whitelisting defenses.
search = index=wineventlog* ((((EventCode="4688" (source="WinEventLog:Security" OR sourcetype="WinEventLog:Security"))) (((((New_Process_Name="*\\wmic.exe" Process_Command_Line="*/format*")) NOT (((Process_Command_Line="*/Format:List*" OR Process_Command_Line="*/Format:htable*" OR Process_Command_Line="*/Format:hform*" OR Process_Command_Line="*/Format:table*" OR Process_Command_Line="*/Format:mof*" OR Process_Command_Line="*/Format:value*" OR Process_Command_Line="*/Format:rawxml*" OR Process_Command_Line="*/Format:xml*" OR Process_Command_Line="*/Format:csv*"))))) OR New_Process_Name="*\\msxsl.exe"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1220" | eval sigma_title="XSL Script Processing" | eval sigma_description="Extensible Stylesheet Language (XSL) files are commonly used to describe the processing and rendering of data within XML files. Rule detects when adversaries abuse this functionality to execute arbitrary files while potentially bypassing application whitelisting defenses."
dispatch.earliest_time = -24h@h
alert.track = 0

[XSL Script Processing - sysmon]
description = Extensible Stylesheet Language (XSL) files are commonly used to describe the processing and rendering of data within XML files. Rule detects when adversaries abuse this functionality to execute arbitrary files while potentially bypassing application whitelisting defenses.
search = index=sysmon* ((((EventCode="1" (source="WinEventLog:Microsoft-Windows-Sysmon/Operational" OR sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"))) (((((Image="*\\wmic.exe" CommandLine="*/format*")) NOT (((CommandLine="*/Format:List*" OR CommandLine="*/Format:htable*" OR CommandLine="*/Format:hform*" OR CommandLine="*/Format:table*" OR CommandLine="*/Format:mof*" OR CommandLine="*/Format:value*" OR CommandLine="*/Format:rawxml*" OR CommandLine="*/Format:xml*" OR CommandLine="*/Format:csv*"))))) OR Image="*\\msxsl.exe"))) | eval sigma_attack_tags="attack.defense_evasion attack.t1220" | eval sigma_title="XSL Script Processing" | eval sigma_description="Extensible Stylesheet Language (XSL) files are commonly used to describe the processing and rendering of data within XML files. Rule detects when adversaries abuse this functionality to execute arbitrary files while potentially bypassing application whitelisting defenses."
dispatch.earliest_time = -24h@h
alert.track = 0
